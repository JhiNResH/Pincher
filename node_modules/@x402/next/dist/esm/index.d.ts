import { HTTPAdapter, RoutesConfig, x402ResourceServer, PaywallConfig, PaywallProvider, FacilitatorClient, RouteConfig } from '@x402/core/server';
export { PaywallConfig, PaywallProvider, RouteConfig, RouteConfigurationError, RouteValidationError } from '@x402/core/server';
import { Network, SchemeNetworkServer } from '@x402/core/types';
export { Network, PaymentPayload, PaymentRequired, PaymentRequirements, SchemeNetworkServer } from '@x402/core/types';
import { NextRequest, NextResponse } from 'next/server';

/**
 * Next.js adapter implementation
 */
declare class NextAdapter implements HTTPAdapter {
    private req;
    /**
     * Creates a new NextAdapter instance.
     *
     * @param req - The Next.js request object
     */
    constructor(req: NextRequest);
    /**
     * Gets a header value from the request.
     *
     * @param name - The header name
     * @returns The header value or undefined
     */
    getHeader(name: string): string | undefined;
    /**
     * Gets the HTTP method of the request.
     *
     * @returns The HTTP method
     */
    getMethod(): string;
    /**
     * Gets the path of the request.
     *
     * @returns The request path
     */
    getPath(): string;
    /**
     * Gets the full URL of the request.
     *
     * @returns The full request URL
     */
    getUrl(): string;
    /**
     * Gets the Accept header from the request.
     *
     * @returns The Accept header value or empty string
     */
    getAcceptHeader(): string;
    /**
     * Gets the User-Agent header from the request.
     *
     * @returns The User-Agent header value or empty string
     */
    getUserAgent(): string;
    /**
     * Gets all query parameters from the request URL.
     *
     * @returns Record of query parameter key-value pairs
     */
    getQueryParams(): Record<string, string | string[]>;
    /**
     * Gets a specific query parameter by name.
     *
     * @param name - The query parameter name
     * @returns The query parameter value(s) or undefined
     */
    getQueryParam(name: string): string | string[] | undefined;
    /**
     * Gets the parsed request body.
     *
     * @returns Promise resolving to the parsed request body
     */
    getBody(): Promise<unknown>;
}

/**
 * Configuration for registering a payment scheme with a specific network
 */
interface SchemeRegistration {
    /**
     * The network identifier (e.g., 'eip155:84532', 'solana:mainnet')
     */
    network: Network;
    /**
     * The scheme server implementation for this network
     */
    server: SchemeNetworkServer;
}
/**
 * Next.js payment proxy for x402 protocol (direct server instance).
 *
 * Use this when you want to pass a pre-configured x402ResourceServer instance.
 * This provides more flexibility for testing, custom configuration, and reusing
 * server instances across multiple proxies.
 *
 * @param routes - Route configurations for protected endpoints
 * @param server - Pre-configured x402ResourceServer instance
 * @param paywallConfig - Optional configuration for the built-in paywall UI
 * @param paywall - Optional custom paywall provider (overrides default)
 * @param syncFacilitatorOnStart - Whether to sync with the facilitator on startup (defaults to true)
 * @returns Next.js proxy handler
 *
 * @example
 * ```typescript
 * import { paymentProxy } from "@x402/next";
 * import { x402ResourceServer } from "@x402/core/server";
 * import { registerExactEvmScheme } from "@x402/evm/exact/server";
 *
 * const server = new x402ResourceServer(myFacilitatorClient);
 * registerExactEvmScheme(server, {});
 *
 * export const proxy = paymentProxy(routes, server, paywallConfig);
 * ```
 */
declare function paymentProxy(routes: RoutesConfig, server: x402ResourceServer, paywallConfig?: PaywallConfig, paywall?: PaywallProvider, syncFacilitatorOnStart?: boolean): (req: NextRequest) => Promise<NextResponse<unknown>>;
/**
 * Next.js payment proxy for x402 protocol (configuration-based).
 *
 * Use this when you want to quickly set up proxy with simple configuration.
 * This function creates and configures the x402ResourceServer internally.
 *
 * @param routes - Route configurations for protected endpoints
 * @param facilitatorClients - Optional facilitator client(s) for payment processing
 * @param schemes - Optional array of scheme registrations for server-side payment processing
 * @param paywallConfig - Optional configuration for the built-in paywall UI
 * @param paywall - Optional custom paywall provider (overrides default)
 * @param syncFacilitatorOnStart - Whether to sync with the facilitator on startup (defaults to true)
 * @returns Next.js proxy handler
 *
 * @example
 * ```typescript
 * import { paymentProxyFromConfig } from "@x402/next";
 *
 * export const proxy = paymentProxyFromConfig(
 *   routes,
 *   myFacilitatorClient,
 *   [{ network: "eip155:8453", server: evmSchemeServer }],
 *   paywallConfig
 * );
 * ```
 */
declare function paymentProxyFromConfig(routes: RoutesConfig, facilitatorClients?: FacilitatorClient | FacilitatorClient[], schemes?: SchemeRegistration[], paywallConfig?: PaywallConfig, paywall?: PaywallProvider, syncFacilitatorOnStart?: boolean): (req: NextRequest) => Promise<NextResponse<unknown>>;
/**
 * Wraps a Next.js App Router API route handler with x402 payment protection.
 *
 * Unlike `paymentProxy` which works as middleware, `withX402` wraps individual route handlers
 * and guarantees that payment settlement only occurs after the handler returns a successful
 * response (status < 400). This provides more precise control over when payments are settled.
 *
 * @param routeHandler - The API route handler function to wrap
 * @param routeConfig - Payment configuration for this specific route
 * @param server - Pre-configured x402ResourceServer instance
 * @param paywallConfig - Optional configuration for the built-in paywall UI
 * @param paywall - Optional custom paywall provider (overrides default)
 * @param syncFacilitatorOnStart - Whether to sync with the facilitator on startup (defaults to true)
 * @returns A wrapped Next.js route handler
 *
 * @example
 * ```typescript
 * import { NextRequest, NextResponse } from "next/server";
 * import { withX402 } from "@x402/next";
 * import { x402ResourceServer } from "@x402/core/server";
 * import { registerExactEvmScheme } from "@x402/evm/exact/server";
 *
 * const server = new x402ResourceServer(myFacilitatorClient);
 * registerExactEvmScheme(server, {});
 *
 * const handler = async (request: NextRequest) => {
 *   return NextResponse.json({ data: "protected content" });
 * };
 *
 * export const GET = withX402(
 *   handler,
 *   {
 *     accepts: {
 *       scheme: "exact",
 *       payTo: "0x123...",
 *       price: "$0.01",
 *       network: "eip155:84532",
 *     },
 *     description: "Access to protected API",
 *   },
 *   server,
 * );
 * ```
 */
declare function withX402<T = unknown>(routeHandler: (request: NextRequest) => Promise<NextResponse<T>>, routeConfig: RouteConfig, server: x402ResourceServer, paywallConfig?: PaywallConfig, paywall?: PaywallProvider, syncFacilitatorOnStart?: boolean): (request: NextRequest) => Promise<NextResponse<T>>;

export { NextAdapter, type SchemeRegistration, paymentProxy, paymentProxyFromConfig, withX402 };
