(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,271503,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.toBig=r.shrSL=r.shrSH=r.rotrSL=r.rotrSH=r.rotrBL=r.rotrBH=r.rotr32L=r.rotr32H=r.rotlSL=r.rotlSH=r.rotlBL=r.rotlBH=r.add5L=r.add5H=r.add4L=r.add4H=r.add3L=r.add3H=void 0,r.add=v,r.fromBig=s,r.split=a;let i=BigInt(0x100000000-1),n=BigInt(32);function s(e,t=!1){return t?{h:Number(e&i),l:Number(e>>n&i)}:{h:0|Number(e>>n&i),l:0|Number(e&i)}}function a(e,t=!1){let r=e.length,i=new Uint32Array(r),n=new Uint32Array(r);for(let a=0;a<r;a++){let{h:r,l:o}=s(e[a],t);[i[a],n[a]]=[r,o]}return[i,n]}let o=(e,t)=>BigInt(e>>>0)<<n|BigInt(t>>>0);r.toBig=o;let l=(e,t,r)=>e>>>r;r.shrSH=l;let c=(e,t,r)=>e<<32-r|t>>>r;r.shrSL=c;let d=(e,t,r)=>e>>>r|t<<32-r;r.rotrSH=d;let u=(e,t,r)=>e<<32-r|t>>>r;r.rotrSL=u;let h=(e,t,r)=>e<<64-r|t>>>r-32;r.rotrBH=h;let p=(e,t,r)=>e>>>r-32|t<<64-r;r.rotrBL=p;let f=(e,t)=>t;r.rotr32H=f;let y=(e,t)=>e;r.rotr32L=y;let g=(e,t,r)=>e<<r|t>>>32-r;r.rotlSH=g;let m=(e,t,r)=>t<<r|e>>>32-r;r.rotlSL=m;let w=(e,t,r)=>t<<r-32|e>>>64-r;r.rotlBH=w;let b=(e,t,r)=>e<<r-32|t>>>64-r;function v(e,t,r,i){let n=(t>>>0)+(i>>>0);return{h:e+r+(n/0x100000000|0)|0,l:0|n}}r.rotlBL=b;let E=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0);r.add3L=E;let A=(e,t,r,i)=>t+r+i+(e/0x100000000|0)|0;r.add3H=A;let _=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0);r.add4L=_;let S=(e,t,r,i,n)=>t+r+i+n+(e/0x100000000|0)|0;r.add4H=S;let I=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0);r.add5L=I;let x=(e,t,r,i,n,s)=>t+r+i+n+s+(e/0x100000000|0)|0;r.add5H=x,r.default={fromBig:s,split:a,toBig:o,shrSH:l,shrSL:c,rotrSH:d,rotrSL:u,rotrBH:h,rotrBL:p,rotr32H:f,rotr32L:y,rotlSH:g,rotlSL:m,rotlBH:w,rotlBL:b,add:v,add3L:E,add3H:A,add4L:_,add4H:S,add5H:x,add5L:I}},582602,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.crypto=void 0,r.crypto="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0},147538,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.wrapXOFConstructorWithOpts=r.wrapConstructorWithOpts=r.wrapConstructor=r.Hash=r.nextTick=r.swap32IfBE=r.byteSwapIfBE=r.swap8IfBE=r.isLE=void 0,r.isBytes=n,r.anumber=s,r.abytes=a,r.ahash=function(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");s(e.outputLen),s(e.blockLen)},r.aexists=function(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")},r.aoutput=function(e,t){a(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)},r.u8=function(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},r.u32=function(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))},r.clean=function(...e){for(let t=0;t<e.length;t++)e[t].fill(0)},r.createView=function(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)},r.rotr=function(e,t){return e<<32-t|e>>>t},r.rotl=function(e,t){return e<<t|e>>>32-t>>>0},r.byteSwap=o,r.byteSwap32=l,r.bytesToHex=function(e){if(a(e),c)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=d[e[r]];return t},r.hexToBytes=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(c)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=u(e.charCodeAt(n)),s=u(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i},r.asyncLoop=h,r.utf8ToBytes=p,r.bytesToUtf8=function(e){return new TextDecoder().decode(e)},r.toBytes=f,r.kdfInputToBytes=function(e){return"string"==typeof e&&(e=p(e)),a(e),e},r.concatBytes=function(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];a(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r},r.checkOpts=function(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("options should be object or undefined");return Object.assign(e,t)},r.createHasher=y,r.createOptHasher=g,r.createXOFer=m,r.randomBytes=function(e=32){if(i.crypto&&"function"==typeof i.crypto.getRandomValues)return i.crypto.getRandomValues(new Uint8Array(e));if(i.crypto&&"function"==typeof i.crypto.randomBytes)return Uint8Array.from(i.crypto.randomBytes(e));throw Error("crypto.getRandomValues must be defined")};let i=e.r(582602);function n(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function s(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function a(e,...t){if(!n(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function o(e){return e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255}function l(e){for(let t=0;t<e.length;t++)e[t]=o(e[t]);return e}r.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],r.swap8IfBE=r.isLE?e=>e:e=>o(e),r.byteSwapIfBE=r.swap8IfBE,r.swap32IfBE=r.isLE?e=>e:l;let c="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,d=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function u(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}async function h(e,t,i){let n=Date.now();for(let s=0;s<e;s++){i(s);let e=Date.now()-n;e>=0&&e<t||(await (0,r.nextTick)(),n+=e)}}function p(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function f(e){return"string"==typeof e&&(e=p(e)),a(e),e}function y(e){let t=t=>e().update(f(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function g(e){let t=(t,r)=>e(r).update(f(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}function m(e){let t=(t,r)=>e(r).update(f(t)).digest(),r=e({});return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=t=>e(t),t}r.nextTick=async()=>{},r.Hash=class{},r.wrapConstructor=y,r.wrapConstructorWithOpts=g,r.wrapXOFConstructorWithOpts=m},843549,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shake256=r.shake128=r.keccak_512=r.keccak_384=r.keccak_256=r.keccak_224=r.sha3_512=r.sha3_384=r.sha3_256=r.sha3_224=r.Keccak=void 0,r.keccakP=b;let i=e.r(271503),n=e.r(147538),s=BigInt(0),a=BigInt(1),o=BigInt(2),l=BigInt(7),c=BigInt(256),d=BigInt(113),u=[],h=[],p=[];for(let e=0,t=a,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],u.push(2*(5*i+r)),h.push((e+1)*(e+2)/2%64);let n=s;for(let e=0;e<7;e++)(t=(t<<a^(t>>l)*d)%c)&o&&(n^=a<<(a<<BigInt(e))-a);p.push(n)}let f=(0,i.split)(p,!0),y=f[0],g=f[1],m=(e,t,r)=>r>32?(0,i.rotlBH)(e,t,r):(0,i.rotlSH)(e,t,r),w=(e,t,r)=>r>32?(0,i.rotlBL)(e,t,r):(0,i.rotlSL)(e,t,r);function b(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=m(s,a,1)^r[i],l=w(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=h[r],s=m(t,n,i),a=w(t,n,i),o=u[r];t=e[o],n=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=y[i],e[1]^=g[i]}(0,n.clean)(r)}class v extends n.Hash{constructor(e,t,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=s,(0,n.anumber)(r),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,n.u32)(this.state)}clone(){return this._cloneInto()}keccak(){(0,n.swap32IfBE)(this.state32),b(this.state32,this.rounds),(0,n.swap32IfBE)(this.state32),this.posOut=0,this.pos=0}update(e){(0,n.aexists)(this),e=(0,n.toBytes)(e),(0,n.abytes)(e);let{blockLen:t,state:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(t-this.pos,i-n);for(let t=0;t<s;t++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){(0,n.aexists)(this,!1),(0,n.abytes)(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return(0,n.anumber)(e),this.xofInto(new Uint8Array(e))}digestInto(e){if((0,n.aoutput)(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,n.clean)(this.state)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new v(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}r.Keccak=v;let E=(e,t,r)=>(0,n.createHasher)(()=>new v(t,e,r));r.sha3_224=E(6,144,28),r.sha3_256=E(6,136,32),r.sha3_384=E(6,104,48),r.sha3_512=E(6,72,64),r.keccak_224=E(1,144,28),r.keccak_256=E(1,136,32),r.keccak_384=E(1,104,48),r.keccak_512=E(1,72,64);let A=(e,t,r)=>(0,n.createXOFer)((i={})=>new v(t,e,void 0===i.dkLen?r:i.dkLen,!0));r.shake128=A(31,168,16),r.shake256=A(31,136,32)},744272,(e,t,r)=>{var i=e.i(389978);let{keccak_256:n}=e.r(843549);function s(e){return i.Buffer.allocUnsafe(e).fill(0)}function a(e,t){let r=e.toString(16);r.length%2!=0&&(r="0"+r);let n=r.match(/.{1,2}/g).map(e=>parseInt(e,16));for(;n.length<t;)n.unshift(0);return i.Buffer.from(n)}function o(e,t,r){let i=s(t);return(e=l(e),r)?e.length<t?(e.copy(i),i):e.slice(0,t):e.length<t?(e.copy(i,t-e.length),i):e.slice(-t)}function l(e){if(!i.Buffer.isBuffer(e))if(Array.isArray(e))e=i.Buffer.from(e);else if("string"==typeof e){var t;e=c(e)?i.Buffer.from((t=d(e)).length%2?"0"+t:t,"hex"):i.Buffer.from(e)}else if("number"==typeof e)e=intToBuffer(e);else if(null==e)e=i.Buffer.allocUnsafe(0);else if("bigint"==typeof e)e=a(e);else if(e.toArray)e=i.Buffer.from(e.toArray());else throw Error("invalid type");return e}function c(e){return"string"==typeof e&&e.match(/^0x[0-9A-Fa-f]*$/)}function d(e){return"string"==typeof e&&e.startsWith("0x")?e.slice(2):e}t.exports={zeros:s,setLength:o,setLengthRight:function(e,t){return o(e,t,!0)},isHexString:c,stripHexPrefix:d,toBuffer:l,bufferToHex:function(e){return"0x"+(e=l(e)).toString("hex")},keccak:function(e,t){if(e=l(e),t||(t=256),256!==t)throw Error("unsupported");return i.Buffer.from(n(new Uint8Array(e)))},bitLengthFromBigInt:function(e){return e.toString(2).length},bufferBEFromBigInt:a,twosFromBigInt:function(e,t){return(e<0n?(~e&(1n<<BigInt(t))-1n)+1n:e)&(1n<<BigInt(t))-1n}}},233581,(e,t,r)=>{var i=e.i(389978);let n=e.r(744272);function s(e){if(e.startsWith("int["))return"int256"+e.slice(3);if("int"===e)return"int256";if(e.startsWith("uint["))return"uint256"+e.slice(4);if("uint"===e)return"uint256";if(e.startsWith("fixed["))return"fixed128x128"+e.slice(5);else if("fixed"===e)return"fixed128x128";else if(e.startsWith("ufixed["))return"ufixed128x128"+e.slice(6);else if("ufixed"===e)return"ufixed128x128";return e}function a(e){return Number.parseInt(/^\D+(\d+)$/.exec(e)[1],10)}function o(e){var t=/^\D+(\d+)x(\d+)$/.exec(e);return[Number.parseInt(t[1],10),Number.parseInt(t[2],10)]}function l(e){var t=e.match(/(.*)\[(.*?)\]$/);return t?""===t[2]?"dynamic":Number.parseInt(t[2],10):null}function c(e){var t=typeof e;if("string"===t||"number"===t)return BigInt(e);if("bigint"===t)return e;throw Error("Argument is not a number")}function d(e,t){if("address"===e)return d("uint160",c(t));if("bool"===e)return d("uint8",+!!t);if("string"===e)return d("bytes",new i.Buffer(t,"utf8"));if((p=e).lastIndexOf("]")===p.length-1){if(void 0===t.length)throw Error("Not an array?");if("dynamic"!==(r=l(e))&&0!==r&&t.length>r)throw Error("Elements exceed array size: "+r);for(h in u=[],e=e.slice(0,e.lastIndexOf("[")),"string"==typeof t&&(t=JSON.parse(t)),t)u.push(d(e,t[h]));if("dynamic"===r){var r,s,u,h,p,f=d("uint256",t.length);u.unshift(f)}return i.Buffer.concat(u)}else if("bytes"===e)return t=new i.Buffer(t),u=i.Buffer.concat([d("uint256",t.length),t]),t.length%32!=0&&(u=i.Buffer.concat([u,n.zeros(32-t.length%32)])),u;else if(e.startsWith("bytes")){if((r=a(e))<1||r>32)throw Error("Invalid bytes<N> width: "+r);return n.setLengthRight(t,32)}else if(e.startsWith("uint")){if((r=a(e))%8||r<8||r>256)throw Error("Invalid uint<N> width: "+r);s=c(t);let i=n.bitLengthFromBigInt(s);if(i>r)throw Error("Supplied uint exceeds width: "+r+" vs "+i);if(s<0)throw Error("Supplied uint is negative");return n.bufferBEFromBigInt(s,32)}else if(e.startsWith("int")){if((r=a(e))%8||r<8||r>256)throw Error("Invalid int<N> width: "+r);s=c(t);let i=n.bitLengthFromBigInt(s);if(i>r)throw Error("Supplied int exceeds width: "+r+" vs "+i);let o=n.twosFromBigInt(s,256);return n.bufferBEFromBigInt(o,32)}else if(e.startsWith("ufixed")){if(r=o(e),(s=c(t))<0)throw Error("Supplied ufixed is negative");return d("uint256",s*BigInt(2)**BigInt(r[1]))}else if(e.startsWith("fixed"))return r=o(e),d("int256",c(t)*BigInt(2)**BigInt(r[1]));throw Error("Unsupported or invalid type: "+e)}function u(e,t){if(e.length!==t.length)throw Error("Number of types are not matching the values");for(var r,o,l=[],d=0;d<e.length;d++){var u=s(e[d]),h=t[d];if("bytes"===u)l.push(h);else if("string"===u)l.push(new i.Buffer(h,"utf8"));else if("bool"===u)l.push(new i.Buffer(h?"01":"00","hex"));else if("address"===u)l.push(n.setLength(h,20));else if(u.startsWith("bytes")){if((r=a(u))<1||r>32)throw Error("Invalid bytes<N> width: "+r);l.push(n.setLengthRight(h,r))}else if(u.startsWith("uint")){if((r=a(u))%8||r<8||r>256)throw Error("Invalid uint<N> width: "+r);o=c(h);let e=n.bitLengthFromBigInt(o);if(e>r)throw Error("Supplied uint exceeds width: "+r+" vs "+e);l.push(n.bufferBEFromBigInt(o,r/8))}else if(u.startsWith("int")){if((r=a(u))%8||r<8||r>256)throw Error("Invalid int<N> width: "+r);o=c(h);let e=n.bitLengthFromBigInt(o);if(e>r)throw Error("Supplied int exceeds width: "+r+" vs "+e);let t=n.twosFromBigInt(o,r);l.push(n.bufferBEFromBigInt(t,r/8))}else throw Error("Unsupported or invalid type: "+u)}return i.Buffer.concat(l)}t.exports={rawEncode:function(e,t){var r=[],n=[],a=32*e.length;for(var o in e){var c=s(e[o]),u=d(c,t[o]);"string"===c||"bytes"===c||"dynamic"===l(c)?(r.push(d("uint256",a)),n.push(u),a+=u.length):r.push(u)}return i.Buffer.concat(r.concat(n))},solidityPack:u,soliditySHA3:function(e,t){return n.keccak(u(e,t))}}},618282,(e,t,r)=>{var i=e.i(389978);let n=e.r(744272),s=e.r(233581),a={type:"object",properties:{types:{type:"object",additionalProperties:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"}},required:["name","type"]}}},primaryType:{type:"string"},domain:{type:"object"},message:{type:"object"}},required:["types","primaryType","domain","message"]},o={encodeData(e,t,r,a=!0){let o=["bytes32"],l=[this.hashType(e,r)];if(a){let c=(e,t,o)=>{if(void 0!==r[t])return["bytes32",null==o?"0x0000000000000000000000000000000000000000000000000000000000000000":n.keccak(this.encodeData(t,o,r,a))];if(void 0===o)throw Error(`missing value for field ${e} of type ${t}`);if("bytes"===t)return["bytes32",n.keccak(o)];if("string"===t)return"string"==typeof o&&(o=i.Buffer.from(o,"utf8")),["bytes32",n.keccak(o)];if(t.lastIndexOf("]")===t.length-1){let r=t.slice(0,t.lastIndexOf("[")),i=o.map(t=>c(e,r,t));return["bytes32",n.keccak(s.rawEncode(i.map(([e])=>e),i.map(([,e])=>e)))]}return[t,o]};for(let i of r[e]){let[e,r]=c(i.name,i.type,t[i.name]);o.push(e),l.push(r)}}else for(let s of r[e]){let e=t[s.name];if(void 0!==e)if("bytes"===s.type)o.push("bytes32"),e=n.keccak(e),l.push(e);else if("string"===s.type)o.push("bytes32"),"string"==typeof e&&(e=i.Buffer.from(e,"utf8")),e=n.keccak(e),l.push(e);else if(void 0!==r[s.type])o.push("bytes32"),e=n.keccak(this.encodeData(s.type,e,r,a)),l.push(e);else if(s.type.lastIndexOf("]")===s.type.length-1)throw Error("Arrays currently unimplemented in encodeData");else o.push(s.type),l.push(e)}return s.rawEncode(o,l)},encodeType(e,t){let r="",i=this.findTypeDependencies(e,t).filter(t=>t!==e);for(let n of i=[e].concat(i.sort())){if(!t[n])throw Error("No type definition specified: "+n);r+=n+"("+t[n].map(({name:e,type:t})=>t+" "+e).join(",")+")"}return r},findTypeDependencies(e,t,r=[]){if(e=e.match(/^\w*/)[0],r.includes(e)||void 0===t[e])return r;for(let i of(r.push(e),t[e]))for(let e of this.findTypeDependencies(i.type,t,r))r.includes(e)||r.push(e);return r},hashStruct(e,t,r,i=!0){return n.keccak(this.encodeData(e,t,r,i))},hashType(e,t){return n.keccak(this.encodeType(e,t))},sanitizeData(e){let t={};for(let r in a.properties)e[r]&&(t[r]=e[r]);return t.types&&(t.types=Object.assign({EIP712Domain:[]},t.types)),t},hash(e,t=!0){let r=this.sanitizeData(e),s=[i.Buffer.from("1901","hex")];return s.push(this.hashStruct("EIP712Domain",r.domain,r.types,t)),"EIP712Domain"!==r.primaryType&&s.push(this.hashStruct(r.primaryType,r.message,r.types,t)),n.keccak(i.Buffer.concat(s))}};t.exports={TYPED_MESSAGE_SCHEMA:a,TypedDataUtils:o,hashForSignTypedDataLegacy:function(e){return function(e){let t=Error("Expect argument to be non-empty array");if("object"!=typeof e||!e.length)throw t;let r=e.map(function(e){return"bytes"===e.type?n.toBuffer(e.value):e.value}),i=e.map(function(e){return e.type}),a=e.map(function(e){if(!e.name)throw t;return e.type+" "+e.name});return s.soliditySHA3(["bytes32","bytes32"],[s.soliditySHA3(Array(e.length).fill("string"),a),s.soliditySHA3(i,r)])}(e.data)},hashForSignTypedData_v3:function(e){return o.hash(e.data,!1)},hashForSignTypedData_v4:function(e){return o.hash(e.data)}}},657748,(e,t,r)=>{"use strict";var i=e.r(467174),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=i.useSyncExternalStore,a=i.useRef,o=i.useEffect,l=i.useMemo,c=i.useDebugValue;r.useSyncExternalStoreWithSelector=function(e,t,r,i,d){var u=a(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;var p=s(e,(u=l(function(){function e(e){if(!o){if(o=!0,s=e,e=i(e),void 0!==d&&h.hasValue){var t=h.value;if(d(t,e))return a=t}return a=e}if(t=a,n(s,e))return t;var r=i(e);return void 0!==d&&d(t,r)?(s=e,t):(s=e,a=r)}var s,a,o=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,i,d]))[0],u[1]);return o(function(){h.hasValue=!0,h.value=p},[p]),c(p),p}},726277,(e,t,r)=>{"use strict";t.exports=e.r(657748)},317040,(e,t,r)=>{"use strict";let i=e.r(294790);t.exports=d;let n=function(){function e(e){return void 0!==e&&e}try{if("undefined"!=typeof globalThis)return globalThis;return Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{};function s(e,t){return"silent"===e?1/0:t.levels.values[e]}let a=Symbol("pino.logFuncs"),o=Symbol("pino.hierarchy"),l={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function c(e,t){let r={logger:t,parent:e[o]};t[o]=r}function d(e){var t,r,i;let o,f,y;(e=e||{}).browser=e.browser||{};let g=e.browser.transmit;if(g&&"function"!=typeof g.send)throw Error("pino: transmit option must have a send function");let v=e.browser.write||n;e.browser.write&&(e.browser.asObject=!0);let E=e.serializers||{},A=(t=e.browser.serialize,Array.isArray(t)?t.filter(function(e){return"!stdSerializers.err"!==e}):!0===t&&Object.keys(E)),_=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(_=!1);let S=Object.keys(e.customLevels||{}),I=["error","fatal","warn","info","debug","trace"].concat(S);"function"==typeof v&&I.forEach(function(e){v[e]=v}),(!1===e.enabled||e.browser.disabled)&&(e.level="silent");let x=e.level||"info",T=Object.create(v);T.log||(T.log=m),o={},I.forEach(e=>{o[e]=v[e]?v[e]:n[e]||n[l[e]||"log"]||m}),T[a]=o,c({},T),Object.defineProperty(T,"levelVal",{get:function(){return s(this.level,this)}}),Object.defineProperty(T,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,u(this,k,T,"error"),u(this,k,T,"fatal"),u(this,k,T,"warn"),u(this,k,T,"info"),u(this,k,T,"debug"),u(this,k,T,"trace"),S.forEach(e=>{u(this,k,T,e)})}});let k={transmit:g,serialize:A,asObject:e.browser.asObject,asObjectBindingsOnly:e.browser.asObjectBindingsOnly,formatters:e.browser.formatters,levels:I,timestamp:"function"==typeof(r=e).timestamp?r.timestamp:!1===r.timestamp?w:b,messageKey:e.messageKey||"msg",onChild:e.onChild||m};function C(t,r,i){if(!r)throw Error("missing bindings for child Pino");i=i||{},A&&r.serializers&&(i.serializers=r.serializers);let n=i.serializers;if(A&&n){var s=Object.assign({},E,n),a=!0===e.browser.serialize?Object.keys(s):A;delete r.serializers,h([r],a,s,this._stdErrSerialize)}function o(e){this._childLevel=(0|e._childLevel)+1,this.bindings=r,s&&(this.serializers=s,this._serialize=a),g&&(this._logEvent=p([].concat(e._logEvent.bindings,r)))}o.prototype=this;let l=new o(this);return c(this,l),l.child=function(...e){return C.call(this,t,...e)},l.level=i.level||this.level,t.onChild(l),l}return f=e.customLevels||{},T.levels={values:Object.assign({},d.levels.values,f),labels:Object.assign({},d.levels.labels,(y={},Object.keys(i=f).forEach(function(e){y[i[e]]=e}),y))},T.level=x,T.isLevelEnabled=function(e){return!!this.levels.values[e]&&this.levels.values[e]>=this.levels.values[this.level]},T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=m,T.serializers=E,T._serialize=A,T._stdErrSerialize=_,T.child=function(...e){return C.call(this,k,...e)},g&&(T._logEvent=p()),T}function u(e,t,r,l){var c,d,u,f,y,g,w;if(Object.defineProperty(e,l,{value:s(e.level,r)>s(l,r)?m:r[a][l],writable:!0,enumerable:!0,configurable:!0}),e[l]===m){if(!t.transmit)return;let i=s(t.transmit.level||e.level,r);if(s(l,r)<i)return}e[l]=(c=e,d=t,u=r,f=l,y=c[a][f],function(){let e=d.timestamp(),t=Array(arguments.length),r=Object.getPrototypeOf&&Object.getPrototypeOf(this)===n?n:this;for(var a=0;a<t.length;a++)t[a]=arguments[a];var o=!1;if(d.serialize&&(h(t,this._serialize,this.serializers,this._stdErrSerialize),o=!0),d.asObject||d.formatters?y.call(r,...function(e,t,r,n,s){let{level:a,log:o=e=>e}=s.formatters||{},l=r.slice(),c=l[0],d={},u=(0|e._childLevel)+1;if(u<1&&(u=1),n&&(d.time=n),a?Object.assign(d,a(t,e.levels.values[t])):d.level=e.levels.values[t],s.asObjectBindingsOnly){if(null!==c&&"object"==typeof c)for(;u--&&"object"==typeof l[0];)Object.assign(d,l.shift());return[o(d),...l]}if(null!==c&&"object"==typeof c){for(;u--&&"object"==typeof l[0];)Object.assign(d,l.shift());c=l.length?i(l.shift(),l):void 0}else"string"==typeof c&&(c=i(l.shift(),l));return void 0!==c&&(d[s.messageKey]=c),[o(d)]}(this,f,t,e,d)):y.apply(r,t),d.transmit){let r=d.transmit.level||c._level,i=s(r,u),n=s(f,u);if(n<i)return;!function(e,t,r,i=!1){let n=t.send,s=t.ts,a=t.methodLevel,o=t.methodValue,l=t.val,c=e._logEvent.bindings;i||h(r,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=s,e._logEvent.messages=r.filter(function(e){return -1===c.indexOf(e)}),e._logEvent.level.label=a,e._logEvent.level.value=o,n(a,e._logEvent,l),e._logEvent=p(c)}(this,{ts:e,methodLevel:f,methodValue:n,transmitLevel:r,transmitValue:u.levels.values[d.transmit.level||c._level],send:d.transmit.send,val:s(c._level,u)},t,o)}});let b=function(e){let t=[];e.bindings&&t.push(e.bindings);let r=e[o];for(;r.parent;)(r=r.parent).logger.bindings&&t.push(r.logger.bindings);return t.reverse()}(e);0!==b.length&&(e[l]=(g=b,w=e[l],function(){return w.apply(this,[...g,...arguments])}))}function h(e,t,r,i){for(let n in e)if(i&&e[n]instanceof Error)e[n]=d.stdSerializers.err(e[n]);else if("object"==typeof e[n]&&!Array.isArray(e[n])&&t)for(let i in e[n])t.indexOf(i)>-1&&i in r&&(e[n][i]=r[i](e[n][i]))}function p(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function f(e){let t={type:e.constructor.name,msg:e.message,stack:e.stack};for(let r in e)void 0===t[r]&&(t[r]=e[r]);return t}function y(){return{}}function g(e){return e}function m(){}function w(){return!1}function b(){return Date.now()}d.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},d.stdSerializers={mapHttpRequest:y,mapHttpResponse:y,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:y,res:y,err:f,errWithCause:f},d.stdTimeFunctions=Object.assign({},{nullTime:w,epochTime:b,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}}),t.exports.default=d,t.exports.pino=d},658044,509876,720377,661417,715232,360178,889313,338113,648308,482469,893168,701368,47690,556676,447579,154336,2356,181584,538203,433655,651917,350617,823729,3086,866496,456234,911109,526297,461138,307485,e=>{"use strict";let t,r,i,n,s,a,o,l,c,d,u,h,p,f,y,g,m,w,b,v,E,A,_,S,I,x,T,k,C,P,O,R,N,M,U,D,j,L;var B=e.i(531871),W=e.i(467174),F=e.i(926485),z=e.i(606538),q=e.i(856298),H=(e.i(63771),e.i(48210));e.i(126190);e.i(678534);var K=e.i(868620);class $ extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null==(t=Error.captureStackTrace)||t.call(Error,this,this.constructor)}}class V extends ${static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}}class J extends ${static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}}class Z extends ${constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class G extends ${constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class Y extends ${constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class Q extends ${constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}}class X extends ${constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class ee extends ${constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class et extends ${constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class er extends ${constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class ei extends ${constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class en extends ${constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class es extends ${constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class ea extends ${constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class eo extends ${constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}e.s(["JOSEAlgNotAllowed",()=>Z,"JOSEError",()=>$,"JOSENotSupported",()=>G,"JWEDecompressionFailed",()=>Q,"JWEDecryptionFailed",()=>Y,"JWEInvalid",()=>X,"JWKInvalid",()=>er,"JWKSInvalid",()=>ei,"JWKSMultipleMatchingKeys",()=>es,"JWKSNoMatchingKey",()=>en,"JWKSTimeout",()=>ea,"JWSInvalid",()=>ee,"JWSSignatureVerificationFailed",()=>eo,"JWTClaimValidationFailed",()=>V,"JWTExpired",()=>J,"JWTInvalid",()=>et],188994);var el=e.i(188994);let ec=crypto,ed=async(e,t)=>{let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await ec.subtle.digest(r,t))},eu=new TextEncoder,eh=new TextDecoder;function ep(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t}function ef(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function ey(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return ef(r,t,0),ef(r,e%0x100000000,4),r}function eg(e){let t=new Uint8Array(4);return ef(t,e),t}function em(e){return ep(eg(e.length),e)}async function ew(e,t,r){let i=Math.ceil((t>>3)/32),n=new Uint8Array(32*i);for(let t=0;t<i;t++){let i=new Uint8Array(4+e.length+r.length);i.set(eg(t+1)),i.set(e,4),i.set(r,4+e.length),n.set(await ed("sha256",i),32*t)}return n.slice(0,t>>3)}let eb=e=>{let t=e;"string"==typeof t&&(t=eu.encode(t));let r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))},ev=e=>eb(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),eE=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},eA=e=>{let t=e;t instanceof Uint8Array&&(t=eh.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return eE(t)}catch(e){throw TypeError("The input to be decoded is not correctly encoded.")}};e.s(["decode",0,eA,"encode",0,ev],681624);var e_=e.i(681624);e.s([],252886),e.i(252886);let eS=ec.getRandomValues.bind(ec);function eI(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new G(`Unsupported JWE Algorithm: ${e}`)}}let ex=e=>eS(new Uint8Array(eI(e)>>3)),eT=(e,t)=>{if(t.length<<3!==eI(e))throw new X("Invalid Initialization Vector length")},ek=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new X(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)};function eC(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function eP(e,t){return e.name===t}function eO(e){return parseInt(e.name.slice(4),10)}function eR(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function eN(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!eP(e.algorithm,"AES-GCM"))throw eC("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw eC(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!eP(e.algorithm,"AES-KW"))throw eC("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw eC(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw eC("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!eP(e.algorithm,"PBKDF2"))throw eC("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!eP(e.algorithm,"RSA-OAEP"))throw eC("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(eO(e.algorithm.hash)!==r)throw eC(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}eR(e,r)}function eM(e,t,...r){if(r.length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let eU=(e,...t)=>eM("Key must be ",e,...t);function eD(e,t,...r){return eM(`Key for the ${e} algorithm must be `,t,...r)}let ej=["CryptoKey"];async function eL(e,t,r,i,n,s){let a,o;if(!(t instanceof Uint8Array))throw TypeError(eU(t,"Uint8Array"));let l=parseInt(e.slice(1,4),10),c=await ec.subtle.importKey("raw",t.subarray(l>>3),"AES-CBC",!1,["decrypt"]),d=await ec.subtle.importKey("raw",t.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),u=ep(s,i,r,ey(s.length<<3)),h=new Uint8Array((await ec.subtle.sign("HMAC",d,u)).slice(0,l>>3));try{a=((e,t)=>{if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");let r=e.length,i=0,n=-1;for(;++n<r;)i|=e[n]^t[n];return 0===i})(n,h)}catch(e){}if(!a)throw new Y;try{o=new Uint8Array(await ec.subtle.decrypt({iv:i,name:"AES-CBC"},c,r))}catch(e){}if(!o)throw new Y;return o}async function eB(e,t,r,i,n,s){let a;t instanceof Uint8Array?a=await ec.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(eN(t,e,"decrypt"),a=t);try{return new Uint8Array(await ec.subtle.decrypt({additionalData:s,iv:i,name:"AES-GCM",tagLength:128},a,ep(r,n)))}catch(e){throw new Y}}let eW=async(e,t,r,i,n,s)=>{if(!(t instanceof CryptoKey)&&!(t instanceof Uint8Array))throw TypeError(eU(t,...ej,"Uint8Array"));switch(eT(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&ek(t,parseInt(e.slice(-3),10)),eL(e,t,r,i,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&ek(t,parseInt(e.slice(1,4),10)),eB(e,t,r,i,n,s);default:throw new G("Unsupported JWE Content Encryption Algorithm")}},eF=async()=>{throw new G('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},ez=async()=>{throw new G('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},eq=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};function eH(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}let eK=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function e$(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function eV(e,t,r){if(e instanceof CryptoKey)return eN(e,t,r),e;if(e instanceof Uint8Array)return ec.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(eU(e,...ej,"Uint8Array"))}let eJ=async(e,t,r)=>{let i=await eV(t,e,"wrapKey");e$(i,e);let n=await ec.subtle.importKey("raw",r,...eK);return new Uint8Array(await ec.subtle.wrapKey("raw",n,i,"AES-KW"))},eZ=async(e,t,r)=>{let i=await eV(t,e,"unwrapKey");e$(i,e);let n=await ec.subtle.unwrapKey("raw",r,i,"AES-KW",...eK);return new Uint8Array(await ec.subtle.exportKey("raw",n))};async function eG(e,t,r,i,n=new Uint8Array(0),s=new Uint8Array(0)){let a;if(!(e instanceof CryptoKey))throw TypeError(eU(e,...ej));if(eN(e,"ECDH"),!(t instanceof CryptoKey))throw TypeError(eU(t,...ej));eN(t,"ECDH","deriveBits");let o=ep(em(eu.encode(r)),em(n),em(s),eg(i));return a="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,ew(new Uint8Array(await ec.subtle.deriveBits({name:e.algorithm.name,public:e},t,a)),i,o)}async function eY(e){if(!(e instanceof CryptoKey))throw TypeError(eU(e,...ej));return ec.subtle.generateKey(e.algorithm,!0,["deriveBits"])}function eQ(e){if(!(e instanceof CryptoKey))throw TypeError(eU(e,...ej));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}async function eX(e,t,r,i){if(!(e instanceof Uint8Array)||e.length<8)throw new X("PBES2 Salt Input must be 8 or more octets");let n=ep(eu.encode(t),new Uint8Array([0]),e),s=parseInt(t.slice(13,16),10),a={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:n},o=await function(e,t){if(e instanceof Uint8Array)return ec.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(e instanceof CryptoKey)return eN(e,t,"deriveBits","deriveKey"),e;throw TypeError(eU(e,...ej,"Uint8Array"))}(i,t);if(o.usages.includes("deriveBits"))return new Uint8Array(await ec.subtle.deriveBits(a,o,s));if(o.usages.includes("deriveKey"))return ec.subtle.deriveKey(a,o,{length:s,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let e0=async(e,t,r,i=2048,n=eS(new Uint8Array(16)))=>{let s=await eX(n,e,i,t);return{encryptedKey:await eJ(e.slice(-6),s,r),p2c:i,p2s:ev(n)}},e1=async(e,t,r,i,n)=>{let s=await eX(n,e,i,t);return eZ(e.slice(-6),s,r)};function e2(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new G(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let e3=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}},e5=async(e,t,r)=>{if(!(t instanceof CryptoKey))throw TypeError(eU(t,...ej));if(eN(t,e,"encrypt","wrapKey"),e3(e,t),t.usages.includes("encrypt"))return new Uint8Array(await ec.subtle.encrypt(e2(e),t,r));if(t.usages.includes("wrapKey")){let i=await ec.subtle.importKey("raw",r,...eK);return new Uint8Array(await ec.subtle.wrapKey("raw",i,t,e2(e)))}throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},e8=async(e,t,r)=>{if(!(t instanceof CryptoKey))throw TypeError(eU(t,...ej));if(eN(t,e,"decrypt","unwrapKey"),e3(e,t),t.usages.includes("decrypt"))return new Uint8Array(await ec.subtle.decrypt(e2(e),t,r));if(t.usages.includes("unwrapKey")){let i=await ec.subtle.unwrapKey("raw",r,t,e2(e),...eK);return new Uint8Array(await ec.subtle.exportKey("raw",i))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function e6(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new G(`Unsupported JWE Algorithm: ${e}`)}}let e4=e=>eS(new Uint8Array(e6(e)>>3)),e7=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`},e9=async(e,t,r)=>{if(!(r instanceof CryptoKey))throw TypeError(eU(r,...ej));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError(`key is not a ${e} key`);return e7(eb(new Uint8Array(await ec.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},te=(e,t,r=0)=>{0===r&&(t.unshift(t.length),t.unshift(6));let i=e.indexOf(t[0],r);if(-1===i)return!1;let n=e.subarray(i,i+t.length);return n.length===t.length&&(n.every((e,r)=>e===t[r])||te(e,t,i+1))},tt=e=>{switch(!0){case te(e,[42,134,72,206,61,3,1,7]):return"P-256";case te(e,[43,129,4,0,34]):return"P-384";case te(e,[43,129,4,0,35]):return"P-521";case te(e,[43,101,110]):return"X25519";case te(e,[43,101,111]):return"X448";case te(e,[43,101,112]):return"Ed25519";case te(e,[43,101,113]):return"Ed448";default:throw new G("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},tr=async(e,t,r,i,n)=>{var s;let a,o,l=new Uint8Array(atob(r.replace(e,"")).split("").map(e=>e.charCodeAt(0))),c="spki"===t;switch(i){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${i.slice(-3)}`},o=c?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${i.slice(-3)}`},o=c?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(i.slice(-3),10)||1}`},o=c?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":a={name:"ECDSA",namedCurve:"P-256"},o=c?["verify"]:["sign"];break;case"ES384":a={name:"ECDSA",namedCurve:"P-384"},o=c?["verify"]:["sign"];break;case"ES512":a={name:"ECDSA",namedCurve:"P-521"},o=c?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=tt(l);a=e.startsWith("P-")?{name:"ECDH",namedCurve:e}:{name:e},o=c?[]:["deriveBits"];break}case"EdDSA":a={name:tt(l)},o=c?["verify"]:["sign"];break;default:throw new G('Invalid or unsupported "alg" (Algorithm) value')}return ec.subtle.importKey(t,l,a,null!=(s=null==n?void 0:n.extractable)&&s,o)};function ti(e){let t=[],r=0;for(;r<e.length;){let i=tn(e.subarray(r));t.push(i),r+=i.byteLength}return t}function tn(e){let t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let i=0;if(e[t]<128)i=e[t],t++;else if(128===i){for(i=0;0!==e[t+i]||0!==e[t+i+1];){if(i>e.byteLength)throw TypeError("invalid indefinite form length");i++}let r=t+i+2;return{byteLength:r,contents:e.subarray(t,t+i),raw:e.subarray(0,r)}}else{let r=127&e[t];t++,i=0;for(let n=0;n<r;n++)i=256*i+e[t],t++}let n=t+i;return{byteLength:n,contents:e.subarray(t,n),raw:e.subarray(0,n)}}let ts=async e=>{var t,r;if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:i,keyUsages:n}=function(e){let t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:`SHA-${e.alg.slice(-3)}`},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new G(`${e.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new G('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new G('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new G('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new G('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new G('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),s=[i,null!=(t=e.ext)&&t,null!=(r=e.key_ops)?r:n];if("PBKDF2"===i.name)return ec.subtle.importKey("raw",eA(e.k),...s);let a={...e};return delete a.alg,delete a.use,ec.subtle.importKey("jwk",a,...s)};async function ta(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return tr(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r)}async function to(e,t,r){let i;if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');try{var n;let t;n=e,i=e7((t=ti(ti(tn(eE(n.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""))).contents)[0].contents),eb(t[160===t[0].raw[0]?6:5].raw)),"PUBLIC KEY")}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return tr(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",i,t,r)}async function tl(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return tr(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r)}async function tc(e,t,r){var i;if(!eH(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=r||(r=!0!==e.ext),r)return ts({...e,alg:t,ext:null!=(i=e.ext)&&i});return eA(e.k);case"RSA":if(void 0!==e.oth)throw new G('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return ts({...e,alg:t});default:throw new G('Unsupported "kty" (Key Type) Parameter value')}}let td=(e,t,r)=>{if(e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)){if(!(t instanceof Uint8Array)){if(!(t instanceof CryptoKey))throw TypeError(eD(e,t,...ej,"Uint8Array"));if("secret"!==t.type)throw TypeError(`${ej.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}}else{if(!(t instanceof CryptoKey))throw TypeError(eD(e,t,...ej));if("secret"===t.type)throw TypeError(`${ej.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${ej.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${ej.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${ej.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${ej.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)}};async function tu(e,t,r,i,n){if(!(r instanceof Uint8Array))throw TypeError(eU(r,"Uint8Array"));let s=parseInt(e.slice(1,4),10),a=await ec.subtle.importKey("raw",r.subarray(s>>3),"AES-CBC",!1,["encrypt"]),o=await ec.subtle.importKey("raw",r.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),l=new Uint8Array(await ec.subtle.encrypt({iv:i,name:"AES-CBC"},a,t)),c=ep(n,i,l,ey(n.length<<3));return{ciphertext:l,tag:new Uint8Array((await ec.subtle.sign("HMAC",o,c)).slice(0,s>>3))}}async function th(e,t,r,i,n){let s;r instanceof Uint8Array?s=await ec.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(eN(r,e,"encrypt"),s=r);let a=new Uint8Array(await ec.subtle.encrypt({additionalData:n,iv:i,name:"AES-GCM",tagLength:128},s,t)),o=a.slice(-16);return{ciphertext:a.slice(0,-16),tag:o}}let tp=async(e,t,r,i,n)=>{if(!(r instanceof CryptoKey)&&!(r instanceof Uint8Array))throw TypeError(eU(r,...ej,"Uint8Array"));switch(eT(e,i),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&ek(r,parseInt(e.slice(-3),10)),tu(e,t,r,i,n);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&ek(r,parseInt(e.slice(1,4),10)),th(e,t,r,i,n);default:throw new G("Unsupported JWE Content Encryption Algorithm")}};async function tf(e,t,r,i){let n=e.slice(0,7);i||(i=ex(n));let{ciphertext:s,tag:a}=await tp(n,r,t,i,new Uint8Array(0));return{encryptedKey:s,iv:ev(i),tag:ev(a)}}async function ty(e,t,r,i,n){return eW(e.slice(0,7),t,r,i,n,new Uint8Array(0))}async function tg(e,t,r,i,n){switch(td(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new X("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new X("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let n,s;if(!eH(i.epk))throw new X('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!eQ(t))throw new G("ECDH with the provided key is not allowed or not supported by your javascript runtime");let a=await tc(i.epk,e);if(void 0!==i.apu){if("string"!=typeof i.apu)throw new X('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{n=eA(i.apu)}catch(e){throw new X("Failed to base64url decode the apu")}}if(void 0!==i.apv){if("string"!=typeof i.apv)throw new X('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{s=eA(i.apv)}catch(e){throw new X("Failed to base64url decode the apv")}}let o=await eG(a,t,"ECDH-ES"===e?i.enc:e,"ECDH-ES"===e?e6(i.enc):parseInt(e.slice(-5,-2),10),n,s);if("ECDH-ES"===e)return o;if(void 0===r)throw new X("JWE Encrypted Key missing");return eZ(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new X("JWE Encrypted Key missing");return e8(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let s;if(void 0===r)throw new X("JWE Encrypted Key missing");if("number"!=typeof i.p2c)throw new X('JOSE Header "p2c" (PBES2 Count) missing or invalid');let a=(null==n?void 0:n.maxPBES2Count)||1e4;if(i.p2c>a)throw new X('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof i.p2s)throw new X('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{s=eA(i.p2s)}catch(e){throw new X("Failed to base64url decode the p2s")}return e1(e,t,r,i.p2c,s)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new X("JWE Encrypted Key missing");return eZ(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let n,s;if(void 0===r)throw new X("JWE Encrypted Key missing");if("string"!=typeof i.iv)throw new X('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof i.tag)throw new X('JOSE Header "tag" (Authentication Tag) missing or invalid');try{n=eA(i.iv)}catch(e){throw new X("Failed to base64url decode the iv")}try{s=eA(i.tag)}catch(e){throw new X("Failed to base64url decode the tag")}return ty(e,t,r,n,s)}default:throw new G('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let tm=function(e,t,r,i,n){let s;if(void 0!==n.crit&&void 0===i.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!i||void 0===i.crit)return new Set;if(!Array.isArray(i.crit)||0===i.crit.length||i.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(s=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,i.crit)){if(!s.has(a))throw new G(`Extension Header Parameter "${a}" is not recognized`);if(void 0===n[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(s.get(a)&&void 0===i[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(i.crit)},tw=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function tb(e,t,r){var i;let n,s,a,o,l,c,d;if(!eH(e))throw new X("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new X("JOSE Header missing");if("string"!=typeof e.iv)throw new X("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new X("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new X("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new X("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new X("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new X("JWE AAD incorrect type");if(void 0!==e.header&&!eH(e.header))throw new X("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!eH(e.unprotected))throw new X("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=eA(e.protected);n=JSON.parse(eh.decode(t))}catch(e){throw new X("JWE Protected Header is invalid")}if(!eq(n,e.header,e.unprotected))throw new X("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...n,...e.header,...e.unprotected};if(tm(X,new Map,null==r?void 0:r.crit,n,u),void 0!==u.zip){if(!n||!n.zip)throw new X('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==u.zip)throw new G('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:h,enc:p}=u;if("string"!=typeof h||!h)throw new X("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof p||!p)throw new X("missing JWE Encryption Algorithm (enc) in JWE Header");let f=r&&tw("keyManagementAlgorithms",r.keyManagementAlgorithms),y=r&&tw("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(f&&!f.has(h))throw new Z('"alg" (Algorithm) Header Parameter not allowed');if(y&&!y.has(p))throw new Z('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==e.encrypted_key)try{s=eA(e.encrypted_key)}catch(e){throw new X("Failed to base64url decode the encrypted_key")}let g=!1;"function"==typeof t&&(t=await t(n,e),g=!0);try{a=await tg(h,t,s,u,r)}catch(e){if(e instanceof TypeError||e instanceof X||e instanceof G)throw e;a=e4(p)}try{o=eA(e.iv)}catch(e){throw new X("Failed to base64url decode the iv")}try{l=eA(e.tag)}catch(e){throw new X("Failed to base64url decode the tag")}let m=eu.encode(null!=(i=e.protected)?i:"");c=void 0!==e.aad?ep(m,eu.encode("."),eu.encode(e.aad)):m;try{d=eA(e.ciphertext)}catch(e){throw new X("Failed to base64url decode the ciphertext")}let w=await eW(p,a,d,o,l,c);"DEF"===u.zip&&(w=await ((null==r?void 0:r.inflateRaw)||eF)(w));let b={plaintext:w};if(void 0!==e.protected&&(b.protectedHeader=n),void 0!==e.aad)try{b.additionalAuthenticatedData=eA(e.aad)}catch(e){throw new X("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(b.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(b.unprotectedHeader=e.header),g)?{...b,key:t}:b}async function tv(e,t,r){if(e instanceof Uint8Array&&(e=eh.decode(e)),"string"!=typeof e)throw new X("Compact JWE must be a string or Uint8Array");let{0:i,1:n,2:s,3:a,4:o,length:l}=e.split(".");if(5!==l)throw new X("Invalid Compact JWE");let c=await tb({ciphertext:a,iv:s||void 0,protected:i||void 0,tag:o||void 0,encrypted_key:n||void 0},t,r),d={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...d,key:c.key}:d}async function tE(e,t,r){if(!eH(e))throw new X("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(eH))throw new X("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new X("JWE Recipients has no members");for(let i of e.recipients)try{return await tb({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:i.encrypted_key,header:i.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch(e){}throw new Y}let tA=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:ev(e)};if(!(e instanceof CryptoKey))throw TypeError(eU(e,...ej,"Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:i,use:n,...s}=await ec.subtle.exportKey("jwk",e);return s};async function t_(e){return e9("public","spki",e)}async function tS(e){return e9("private","pkcs8",e)}async function tI(e){return tA(e)}async function tx(e,t,r,i,n={}){let s,a,o;switch(td(e,r,"encrypt"),e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!eQ(r))throw new G("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:l,apv:c}=n,{epk:d}=n;d||(d=(await eY(r)).privateKey);let{x:u,y:h,crv:p,kty:f}=await tI(d),y=await eG(r,d,"ECDH-ES"===e?t:e,"ECDH-ES"===e?e6(t):parseInt(e.slice(-5,-2),10),l,c);if(a={epk:{x:u,crv:p,kty:f}},"EC"===f&&(a.epk.y=h),l&&(a.apu=ev(l)),c&&(a.apv=ev(c)),"ECDH-ES"===e){o=y;break}o=i||e4(t);let g=e.slice(-6);s=await eJ(g,y,o);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=i||e4(t),s=await e5(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=i||e4(t);let{p2c:l,p2s:c}=n;({encryptedKey:s,...a}=await e0(e,r,o,l,c));break}case"A128KW":case"A192KW":case"A256KW":o=i||e4(t),s=await eJ(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=i||e4(t);let{iv:l}=n;({encryptedKey:s,...a}=await tf(e,r,o,l));break}default:throw new G('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:s,parameters:a}}let tT=Symbol();class tk{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,i,n,s,a,o,l;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new X("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!eq(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new X("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(tm(X,new Map,null==t?void 0:t.crit,this._protectedHeader,c),void 0!==c.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new X('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==c.zip)throw new G('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:d,enc:u}=c;if("string"!=typeof d||!d)throw new X('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof u||!u)throw new X('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===d){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===d&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let n;({cek:i,encryptedKey:r,parameters:n}=await tx(d,u,e,this._cek,this._keyManagementParameters)),n&&(t&&tT in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...n}:this.setUnprotectedHeader(n):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...n}:this.setProtectedHeader(n))}if(this._iv||(this._iv=ex(u)),s=this._protectedHeader?eu.encode(ev(JSON.stringify(this._protectedHeader))):eu.encode(""),this._aad?(a=ev(this._aad),n=ep(s,eu.encode("."),eu.encode(a))):n=s,"DEF"===c.zip){let e=await ((null==t?void 0:t.deflateRaw)||ez)(this._plaintext);({ciphertext:o,tag:l}=await tp(u,e,i,this._iv,n))}else({ciphertext:o,tag:l}=await tp(u,this._plaintext,i,this._iv,n));let h={ciphertext:ev(o),iv:ev(this._iv),tag:ev(l)};return r&&(h.encrypted_key=ev(r)),a&&(h.aad=a),this._protectedHeader&&(h.protected=eh.decode(s)),this._sharedUnprotectedHeader&&(h.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(h.header=this._unprotectedHeader),h}}class tC{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class tP{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){let r=new tC(this,e,{crit:null==t?void 0:t.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(e){var t,r,i;let n;if(!this._recipients.length)throw new X("at least one recipient must be added");if(e={deflateRaw:null==e?void 0:e.deflateRaw},1===this._recipients.length){let[t]=this._recipients,r=await new tk(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(t.unprotectedHeader).encrypt(t.key,{...t.options,...e}),i={ciphertext:r.ciphertext,iv:r.iv,recipients:[{}],tag:r.tag};return r.aad&&(i.aad=r.aad),r.protected&&(i.protected=r.protected),r.unprotected&&(i.unprotected=r.unprotected),r.encrypted_key&&(i.recipients[0].encrypted_key=r.encrypted_key),r.header&&(i.recipients[0].header=r.header),i}for(let e=0;e<this._recipients.length;e++){let t=this._recipients[e];if(!eq(this._protectedHeader,this._unprotectedHeader,t.unprotectedHeader))throw new X("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let r={...this._protectedHeader,...this._unprotectedHeader,...t.unprotectedHeader},{alg:i}=r;if("string"!=typeof i||!i)throw new X('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===i||"ECDH-ES"===i)throw new X('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof r.enc||!r.enc)throw new X('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(n){if(n!==r.enc)throw new X('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else n=r.enc;if(tm(X,new Map,t.options.crit,this._protectedHeader,r),void 0!==r.zip&&(!this._protectedHeader||!this._protectedHeader.zip))throw new X('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let s=e4(n),a={ciphertext:"",iv:"",recipients:[],tag:""};for(let o=0;o<this._recipients.length;o++){let l=this._recipients[o],c={};a.recipients.push(c);let d=({...this._protectedHeader,...this._unprotectedHeader,...l.unprotectedHeader}).alg.startsWith("PBES2")?2048+o:void 0;if(0===o){let t=await new tk(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(s).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(l.unprotectedHeader).setKeyManagementParameters({p2c:d}).encrypt(l.key,{...l.options,...e,[tT]:!0});a.ciphertext=t.ciphertext,a.iv=t.iv,a.tag=t.tag,t.aad&&(a.aad=t.aad),t.protected&&(a.protected=t.protected),t.unprotected&&(a.unprotected=t.unprotected),c.encrypted_key=t.encrypted_key,t.header&&(c.header=t.header);continue}let{encryptedKey:u,parameters:h}=await tx((null==(t=l.unprotectedHeader)?void 0:t.alg)||(null==(r=this._protectedHeader)?void 0:r.alg)||(null==(i=this._unprotectedHeader)?void 0:i.alg),n,l.key,s,{p2c:d});c.encrypted_key=ev(u),(l.unprotectedHeader||h)&&(c.header={...l.unprotectedHeader,...h})}return a}}function tO(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"EdDSA":return{name:t.name};default:throw new G(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}function tR(e,t,r){if(t instanceof CryptoKey)return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!eP(e.algorithm,"HMAC"))throw eC("HMAC");let r=parseInt(t.slice(2),10);if(eO(e.algorithm.hash)!==r)throw eC(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!eP(e.algorithm,"RSASSA-PKCS1-v1_5"))throw eC("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(eO(e.algorithm.hash)!==r)throw eC(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!eP(e.algorithm,"RSA-PSS"))throw eC("RSA-PSS");let r=parseInt(t.slice(2),10);if(eO(e.algorithm.hash)!==r)throw eC(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw eC("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!eP(e.algorithm,"ECDSA"))throw eC("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw eC(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}eR(e,r)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(eU(t,...ej));return ec.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw TypeError(eU(t,...ej,"Uint8Array"))}let tN=async(e,t,r,i)=>{let n=await tR(e,t,"verify");e3(e,n);let s=tO(e,n.algorithm);try{return await ec.subtle.verify(s,n,r,i)}catch(e){return!1}};async function tM(e,t,r){var i;let n,s;if(!eH(e))throw new ee("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new ee('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new ee("JWS Protected Header incorrect type");if(void 0===e.payload)throw new ee("JWS Payload missing");if("string"!=typeof e.signature)throw new ee("JWS Signature missing or incorrect type");if(void 0!==e.header&&!eH(e.header))throw new ee("JWS Unprotected Header incorrect type");let a={};if(e.protected)try{let t=eA(e.protected);a=JSON.parse(eh.decode(t))}catch(e){throw new ee("JWS Protected Header is invalid")}if(!eq(a,e.header))throw new ee("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let o={...a,...e.header},l=tm(ee,new Map([["b64",!0]]),null==r?void 0:r.crit,a,o),c=!0;if(l.has("b64")&&"boolean"!=typeof(c=a.b64))throw new ee('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:d}=o;if("string"!=typeof d||!d)throw new ee('JWS "alg" (Algorithm) Header Parameter missing or invalid');let u=r&&tw("algorithms",r.algorithms);if(u&&!u.has(d))throw new Z('"alg" (Algorithm) Header Parameter not allowed');if(c){if("string"!=typeof e.payload)throw new ee("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new ee("JWS Payload must be a string or an Uint8Array instance");let h=!1;"function"==typeof t&&(t=await t(a,e),h=!0),td(d,t,"verify");let p=ep(eu.encode(null!=(i=e.protected)?i:""),eu.encode("."),"string"==typeof e.payload?eu.encode(e.payload):e.payload);try{n=eA(e.signature)}catch(e){throw new ee("Failed to base64url decode the signature")}if(!await tN(d,t,n,p))throw new eo;if(c)try{s=eA(e.payload)}catch(e){throw new ee("Failed to base64url decode the payload")}else s="string"==typeof e.payload?eu.encode(e.payload):e.payload;let f={payload:s};return(void 0!==e.protected&&(f.protectedHeader=a),void 0!==e.header&&(f.unprotectedHeader=e.header),h)?{...f,key:t}:f}async function tU(e,t,r){if(e instanceof Uint8Array&&(e=eh.decode(e)),"string"!=typeof e)throw new ee("Compact JWS must be a string or Uint8Array");let{0:i,1:n,2:s,length:a}=e.split(".");if(3!==a)throw new ee("Invalid Compact JWS");let o=await tM({payload:n,protected:i,signature:s},t,r),l={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...l,key:o.key}:l}async function tD(e,t,r){if(!eH(e))throw new ee("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(eH))throw new ee("JWS Signatures missing or incorrect type");for(let i of e.signatures)try{return await tM({header:i.header,payload:e.payload,protected:i.protected,signature:i.signature},t,r)}catch(e){}throw new eo}let tj=e=>Math.floor(e.getTime()/1e3),tL=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,tB=e=>{let t=tL.exec(e);if(!t)throw TypeError("Invalid time period format");let r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(0x1e187e0*r)}},tW=e=>e.toLowerCase().replace(/^application\//,""),tF=(e,t,r={})=>{var i,n;let s,a,{typ:o}=r;if(o&&("string"!=typeof e.typ||tW(e.typ)!==tW(o)))throw new V('unexpected "typ" JWT header value',"typ","check_failed");try{s=JSON.parse(eh.decode(t))}catch(e){}if(!eH(s))throw new et("JWT Claims Set must be a top-level JSON object");let{requiredClaims:l=[],issuer:c,subject:d,audience:u,maxTokenAge:h}=r;for(let e of(void 0!==h&&l.push("iat"),void 0!==u&&l.push("aud"),void 0!==d&&l.push("sub"),void 0!==c&&l.push("iss"),new Set(l.reverse())))if(!(e in s))throw new V(`missing required "${e}" claim`,e,"missing");if(c&&!(Array.isArray(c)?c:[c]).includes(s.iss))throw new V('unexpected "iss" claim value',"iss","check_failed");if(d&&s.sub!==d)throw new V('unexpected "sub" claim value',"sub","check_failed");if(u&&(i=s.aud,n="string"==typeof u?[u]:u,"string"==typeof i?!n.includes(i):!(Array.isArray(i)&&n.some(Set.prototype.has.bind(new Set(i))))))throw new V('unexpected "aud" claim value',"aud","check_failed");switch(typeof r.clockTolerance){case"string":a=tB(r.clockTolerance);break;case"number":a=r.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,f=tj(p||new Date);if((void 0!==s.iat||h)&&"number"!=typeof s.iat)throw new V('"iat" claim must be a number',"iat","invalid");if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw new V('"nbf" claim must be a number',"nbf","invalid");if(s.nbf>f+a)throw new V('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==s.exp){if("number"!=typeof s.exp)throw new V('"exp" claim must be a number',"exp","invalid");if(s.exp<=f-a)throw new J('"exp" claim timestamp check failed',"exp","check_failed")}if(h){let e=f-s.iat;if(e-a>("number"==typeof h?h:tB(h)))throw new J('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-a)throw new V('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return s};async function tz(e,t,r){var i;let n=await tU(e,t,r);if((null==(i=n.protectedHeader.crit)?void 0:i.includes("b64"))&&!1===n.protectedHeader.b64)throw new et("JWTs MUST NOT use unencoded payload");let s={payload:tF(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...s,key:n.key}:s}async function tq(e,t,r){let i=await tv(e,t,r),n=tF(i.protectedHeader,i.plaintext,r),{protectedHeader:s}=i;if(void 0!==s.iss&&s.iss!==n.iss)throw new V('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==s.sub&&s.sub!==n.sub)throw new V('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(n.aud))throw new V('replicated "aud" claim header parameter mismatch',"aud","mismatch");let a={payload:n,protectedHeader:s};return"function"==typeof t?{...a,key:i.key}:a}class tH{constructor(e){this._flattened=new tk(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let tK=async(e,t,r)=>{let i=await tR(e,t,"sign");return e3(e,i),new Uint8Array(await ec.subtle.sign(tO(e,i.algorithm),i,r))};class t${constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new ee("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!eq(this._protectedHeader,this._unprotectedHeader))throw new ee("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...this._protectedHeader,...this._unprotectedHeader},n=tm(ee,new Map([["b64",!0]]),null==t?void 0:t.crit,this._protectedHeader,i),s=!0;if(n.has("b64")&&"boolean"!=typeof(s=this._protectedHeader.b64))throw new ee('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=i;if("string"!=typeof a||!a)throw new ee('JWS "alg" (Algorithm) Header Parameter missing or invalid');td(a,e,"sign");let o=this._payload;s&&(o=eu.encode(ev(o)));let l=ep(r=this._protectedHeader?eu.encode(ev(JSON.stringify(this._protectedHeader))):eu.encode(""),eu.encode("."),o),c={signature:ev(await tK(a,e,l)),payload:""};return s&&(c.payload=eh.decode(o)),this._unprotectedHeader&&(c.header=this._unprotectedHeader),this._protectedHeader&&(c.protected=eh.decode(r)),c}}class tV{constructor(e){this._flattened=new t$(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class tJ{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class tZ{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){let r=new tJ(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new ee("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let r=this._signatures[t],i=new t$(this._payload);i.setProtectedHeader(r.protectedHeader),i.setUnprotectedHeader(r.unprotectedHeader);let{payload:n,...s}=await i.sign(r.key,r.options);if(0===t)e.payload=n;else if(e.payload!==n)throw new ee("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(s)}return e}}class tG{constructor(e){if(!eH(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:tj(new Date)+tB(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:tj(new Date)+tB(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:tj(new Date)}:this._payload={...this._payload,iat:e},this}}class tY extends tG{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){var r;let i=new tV(eu.encode(JSON.stringify(this._payload)));if(i.setProtectedHeader(this._protectedHeader),Array.isArray(null==(r=this._protectedHeader)?void 0:r.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new et("JWTs MUST NOT use unencoded payload");return i.sign(e,t)}}class tQ extends tG{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new tH(eu.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}let tX=(e,t)=>{if("string"!=typeof e||!e)throw new er(`${t} missing or invalid`)};async function t0(e,t){let r;if(!eH(e))throw TypeError("JWK must be an object");if(null!=t||(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":tX(e.crv,'"crv" (Curve) Parameter'),tX(e.x,'"x" (X Coordinate) Parameter'),tX(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":tX(e.crv,'"crv" (Subtype of Key Pair) Parameter'),tX(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":tX(e.e,'"e" (Exponent) Parameter'),tX(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":tX(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new G('"kty" (Key Type) Parameter missing or unsupported')}let i=eu.encode(JSON.stringify(r));return ev(await ed(t,i))}async function t1(e,t){null!=t||(t="sha256");let r=await t0(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}async function t2(e,t){let r={...e,...null==t?void 0:t.header};if(!eH(r.jwk))throw new ee('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let i=await tc({...r.jwk,ext:!0},r.alg,!0);if(i instanceof Uint8Array||"public"!==i.type)throw new ee('"jwk" (JSON Web Key) Header Parameter must be a public key');return i}function t3(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(t5)}function t5(e){return eH(e)}class t8{constructor(e){if(this._cached=new WeakMap,!t3(e))throw new ei("JSON Web Key Set malformed");this._jwks=function(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}(e)}async getKey(e,t){let{alg:r,kid:i}={...e,...null==t?void 0:t.header},n=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new G('Unsupported "alg" value for a JSON Web Key Set')}}(r),s=this._jwks.keys.filter(e=>{let t=n===e.kty;if(t&&"string"==typeof i&&(t=i===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t}),{0:a,length:o}=s;if(0===o)throw new en;if(1!==o){let e=new es,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of s)try{yield await t6(t,e,r)}catch(e){continue}},e}return t6(this._cached,a,r)}}async function t6(e,t,r){let i=e.get(t)||e.set(t,{}).get(t);if(void 0===i[r]){let e=await tc({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new ei("JSON Web Key Set members must be public keys");i[r]=e}return i[r]}function t4(e){let t=new t8(e);return async function(e,r){return t.getKey(e,r)}}let t7=async(e,t,r)=>{let i,n,s=!1;"function"==typeof AbortController&&(i=new AbortController,n=setTimeout(()=>{s=!0,i.abort()},t));let a=await fetch(e.href,{signal:i?i.signal:void 0,redirect:"manual",headers:r.headers}).catch(e=>{if(s)throw new ea;throw e});if(void 0!==n&&clearTimeout(n),200!==a.status)throw new $("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch(e){throw new $("Failed to parse the JSON Web Key Set HTTP response as JSON")}};class t9 extends t8{constructor(e,t){if(super({keys:[]}),this._jwks=void 0,!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:null==t?void 0:t.agent,headers:null==t?void 0:t.headers},this._timeoutDuration="number"==typeof(null==t?void 0:t.timeoutDuration)?null==t?void 0:t.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==t?void 0:t.cooldownDuration)?null==t?void 0:t.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==t?void 0:t.cacheMaxAge)?null==t?void 0:t.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(e,t)}catch(r){if(r instanceof en&&!1===this.coolingDown())return await this.reload(),super.getKey(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=t7(this._url,this._timeoutDuration,this._options).then(e=>{if(!t3(e))throw new ei("JSON Web Key Set malformed");this._jwks={keys:e.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function re(e,t){let r=new t9(e,t);return async function(e,t){return r.getKey(e,t)}}class rt extends tG{encode(){let e=ev(JSON.stringify({alg:"none"})),t=ev(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){let r;if("string"!=typeof e)throw new et("Unsecured JWT must be a string");let{0:i,1:n,2:s,length:a}=e.split(".");if(3!==a||""!==s)throw new et("Invalid Unsecured JWT");try{if(r=JSON.parse(eh.decode(eA(i))),"none"!==r.alg)throw Error()}catch(e){throw new et("Invalid Unsecured JWT")}return{payload:tF(r,eA(n),t),header:r}}}function rr(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(eh.decode(eA(t)));if(!eH(e))throw Error();return e}catch(e){throw TypeError("Invalid Token or Protected Header formatting")}}function ri(e){let t,r;if("string"!=typeof e)throw new et("JWTs must use Compact JWS serialization, JWT must be a string");let{1:i,length:n}=e.split(".");if(5===n)throw new et("Only JWTs using Compact JWS serialization can be decoded");if(3!==n)throw new et("Invalid JWT");if(!i)throw new et("JWTs must contain a payload");try{t=eA(i)}catch(e){throw new et("Failed to base64url decode the payload")}try{r=JSON.parse(eh.decode(t))}catch(e){throw new et("Failed to parse the decoded payload as JSON")}if(!eH(r))throw new et("Invalid JWT Claims Set");return r}async function rn(e,t){var r;let i,n,s;switch(e){case"HS256":case"HS384":case"HS512":i=parseInt(e.slice(-3),10),n={name:"HMAC",hash:`SHA-${i}`,length:i},s=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return eS(new Uint8Array((i=parseInt(e.slice(-3),10))>>3));case"A128KW":case"A192KW":case"A256KW":n={name:"AES-KW",length:i=parseInt(e.slice(1,4),10)},s=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":n={name:"AES-GCM",length:i=parseInt(e.slice(1,4),10)},s=["encrypt","decrypt"];break;default:throw new G('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return ec.subtle.generateKey(n,null!=(r=null==t?void 0:t.extractable)&&r,s)}function rs(e){var t;let r=null!=(t=null==e?void 0:e.modulusLength)?t:2048;if("number"!=typeof r||r<2048)throw new G("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return r}async function ra(e,t){var r,i,n;let s,a;switch(e){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:rs(t)},a=["sign","verify"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:rs(t)},a=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:rs(t)},a=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},a=["sign","verify"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},a=["sign","verify"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},a=["sign","verify"];break;case"EdDSA":a=["sign","verify"];let o=null!=(r=null==t?void 0:t.crv)?r:"Ed25519";switch(o){case"Ed25519":case"Ed448":s={name:o};break;default:throw new G("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{a=["deriveKey","deriveBits"];let e=null!=(i=null==t?void 0:t.crv)?i:"P-256";switch(e){case"P-256":case"P-384":case"P-521":s={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":s={name:e};break;default:throw new G("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new G('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return ec.subtle.generateKey(s,null!=(n=null==t?void 0:t.extractable)&&n,a)}async function ro(e,t){return ra(e,t)}async function rl(e,t){return rn(e,t)}e.s(["CompactEncrypt",()=>tH,"CompactSign",()=>tV,"EmbeddedJWK",()=>t2,"EncryptJWT",()=>tQ,"FlattenedEncrypt",()=>tk,"FlattenedSign",()=>t$,"GeneralEncrypt",()=>tP,"GeneralSign",()=>tZ,"SignJWT",()=>tY,"UnsecuredJWT",()=>rt,"base64url",0,e_,"calculateJwkThumbprint",()=>t0,"calculateJwkThumbprintUri",()=>t1,"compactDecrypt",()=>tv,"compactVerify",()=>tU,"createLocalJWKSet",()=>t4,"createRemoteJWKSet",()=>re,"cryptoRuntime",0,"WebCryptoAPI","decodeJwt",()=>ri,"decodeProtectedHeader",()=>rr,"errors",0,el,"exportJWK",()=>tI,"exportPKCS8",()=>tS,"exportSPKI",()=>t_,"flattenedDecrypt",()=>tb,"flattenedVerify",()=>tM,"generalDecrypt",()=>tE,"generalVerify",()=>tD,"generateKeyPair",()=>ro,"generateSecret",()=>rl,"importJWK",()=>tc,"importPKCS8",()=>tl,"importSPKI",()=>ta,"importX509",()=>to,"jwtDecrypt",()=>tq,"jwtVerify",()=>tz],937272),e.i(937272);var rc=e.i(496655),rd=e.i(737281),ru=e.i(777596),rh=e.i(569269),rp=e.i(539285),rf=e.i(493617);class ry{constructor(e,t){this.scope=e,this.module=t}storeObject(e,t){this.setItem(e,JSON.stringify(t))}loadObject(e){let t=this.getItem(e);return t?JSON.parse(t):void 0}setItem(e,t){localStorage.setItem(this.scopedKey(e),t)}getItem(e){return localStorage.getItem(this.scopedKey(e))}removeItem(e){localStorage.removeItem(this.scopedKey(e))}clear(){let e=this.scopedKey(""),t=[];for(let r=0;r<localStorage.length;r++){let i=localStorage.key(r);"string"==typeof i&&i.startsWith(e)&&t.push(i)}t.forEach(e=>localStorage.removeItem(e))}scopedKey(e){return`-${this.scope}${this.module?`:${this.module}`:""}:${e}`}static clearAll(){new ry("CBWSDK").clear(),new ry("walletlink").clear()}}var rg=e.i(389978);let rm=-32602,rw=-32603,rb=4001,rv=4100,rE=4200,rA=4900,r_={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."},4902:{standard:"EIP-3085",message:"Unrecognized chain ID."}},rS="Unspecified error message.";function rI(e,t=rS){if(e&&Number.isInteger(e)){var r;let t=e.toString();if(rT(r_,t))return r_[t].message;if((r=e)>=-32099&&r<=-32e3)return"Unspecified server error."}return t}function rx(e){return e&&"object"==typeof e&&!Array.isArray(e)?Object.assign({},e):e}function rT(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function rk(e,t){return"object"==typeof e&&null!==e&&t in e&&"string"==typeof e[t]}let rC=e=>rD(rm,e),rP=e=>rD(rw,e),rO=e=>rj(rb,e),rR=e=>rj(rv,e),rN=e=>rj(rE,e),rM=e=>rj(rA,e),rU=e=>{if(!e||"object"!=typeof e||Array.isArray(e))throw Error("Ethereum Provider custom errors must provide single object argument.");let{code:t,message:r,data:i}=e;if(!r||"string"!=typeof r)throw Error('"message" must be a nonempty string');return new rW(t,r,i)};function rD(e,t){let[r,i]=rL(t);return new rB(e,r||rI(e),i)}function rj(e,t){let[r,i]=rL(t);return new rW(e,r||rI(e),i)}function rL(e){if(e){if("string"==typeof e)return[e];else if("object"==typeof e&&!Array.isArray(e)){let{message:t,data:r}=e;if(t&&"string"!=typeof t)throw Error("Must specify string message.");return[t||void 0,r]}}return[]}class rB extends Error{constructor(e,t,r){if(!Number.isInteger(e))throw Error('"code" must be an integer.');if(!t||"string"!=typeof t)throw Error('"message" must be a nonempty string.');super(t),this.code=e,void 0!==r&&(this.data=r)}}class rW extends rB{constructor(e,t,r){if(!function(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}(e))throw Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,t,r)}}function rF(e){return Math.floor(e)}let rz=/^[0-9]*$/,rq=/^[a-f0-9]*$/;function rH(e){return rK(crypto.getRandomValues(new Uint8Array(e)))}function rK(e){return[...e].map(e=>e.toString(16).padStart(2,"0")).join("")}function r$(e){return new Uint8Array(e.match(/.{1,2}/g).map(e=>Number.parseInt(e,16)))}function rV(e,t=!1){let r=e.toString("hex");return t?`0x${r}`:r}function rJ(e){return rV(r3(e),!0)}function rZ(e){return e.toString(10)}function rG(e){return`0x${BigInt(e).toString(16)}`}function rY(e){return e.startsWith("0x")||e.startsWith("0X")}function rQ(e){return rY(e)?e.slice(2):e}function rX(e){return rY(e)?`0x${e.slice(2)}`:`0x${e}`}function r0(e){if("string"!=typeof e)return!1;let t=rQ(e).toLowerCase();return rq.test(t)}function r1(e,t=!1){let r=function(e,t=!1){if("string"==typeof e){let r=rQ(e).toLowerCase();if(rq.test(r))return t?`0x${r}`:r}throw rC(`"${String(e)}" is not a hexadecimal string`)}(e,!1);return r.length%2==1&&(r=`0${r}`),t?`0x${r}`:r}function r2(e){if("string"==typeof e){let t=rQ(e).toLowerCase();if(r0(t)&&40===t.length)return rX(t)}throw rC(`Invalid Ethereum address: ${String(e)}`)}function r3(e){if(rg.Buffer.isBuffer(e))return e;if("string"==typeof e){if(r0(e)){let t=r1(e,!1);return rg.Buffer.from(t,"hex")}return rg.Buffer.from(e,"utf8")}throw rC(`Not binary data: ${String(e)}`)}function r5(e){if("number"==typeof e&&Number.isInteger(e))return rF(e);if("string"==typeof e){if(rz.test(e))return rF(Number(e));if(r0(e))return rF(Number(BigInt(r1(e,!0))))}throw rC(`Not an integer: ${String(e)}`)}function r8(e){if(null!==e&&("bigint"==typeof e||function(e){if(null==e||"function"!=typeof e.constructor)return!1;let{constructor:t}=e;return"function"==typeof t.config&&"number"==typeof t.EUCLID}(e)))return BigInt(e.toString(10));if("number"==typeof e)return BigInt(r5(e));if("string"==typeof e){if(rz.test(e))return BigInt(e);if(r0(e))return BigInt(r1(e,!0))}throw rC(`Not an integer: ${String(e)}`)}async function r6(){return crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"])}async function r4(e,t){return crypto.subtle.deriveKey({name:"ECDH",public:t},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function r7(e,t){let r=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},e,new TextEncoder().encode(t));return{iv:r,cipherText:i}}async function r9(e,{iv:t,cipherText:r}){let i=await crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,r);return new TextDecoder().decode(i)}function ie(e){switch(e){case"public":return"spki";case"private":return"pkcs8"}}async function it(e,t){let r=ie(e);return rK(new Uint8Array(await crypto.subtle.exportKey(r,t)))}async function ir(e,t){let r=ie(e),i=r$(t).buffer;return await crypto.subtle.importKey(r,new Uint8Array(i),{name:"ECDH",namedCurve:"P-256"},!0,"private"===e?["deriveKey"]:[])}async function ii(e,t){return r7(t,JSON.stringify(e,(e,t)=>t instanceof Error?Object.assign(Object.assign({},t.code?{code:t.code}:{}),{message:t.message}):t))}async function is(e,t){return JSON.parse(await r9(t,e))}let ia={storageKey:"ownPrivateKey",keyType:"private"},io={storageKey:"ownPublicKey",keyType:"public"},il={storageKey:"peerPublicKey",keyType:"public"};class ic{constructor(){this.storage=new ry("CBWSDK","SCWKeyManager"),this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null}async getOwnPublicKey(){return await this.loadKeysIfNeeded(),this.ownPublicKey}async getSharedSecret(){return await this.loadKeysIfNeeded(),this.sharedSecret}async setPeerPublicKey(e){this.sharedSecret=null,this.peerPublicKey=e,await this.storeKey(il,e),await this.loadKeysIfNeeded()}async clear(){this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null,this.storage.removeItem(io.storageKey),this.storage.removeItem(ia.storageKey),this.storage.removeItem(il.storageKey)}async generateKeyPair(){let e=await r6();this.ownPrivateKey=e.privateKey,this.ownPublicKey=e.publicKey,await this.storeKey(ia,e.privateKey),await this.storeKey(io,e.publicKey)}async loadKeysIfNeeded(){null===this.ownPrivateKey&&(this.ownPrivateKey=await this.loadKey(ia)),null===this.ownPublicKey&&(this.ownPublicKey=await this.loadKey(io)),(null===this.ownPrivateKey||null===this.ownPublicKey)&&await this.generateKeyPair(),null===this.peerPublicKey&&(this.peerPublicKey=await this.loadKey(il)),null===this.sharedSecret&&null!==this.ownPrivateKey&&null!==this.peerPublicKey&&(this.sharedSecret=await r4(this.ownPrivateKey,this.peerPublicKey))}async loadKey(e){let t=this.storage.getItem(e.storageKey);return t?ir(e.keyType,t):null}async storeKey(e,t){let r=await it(e.keyType,t);this.storage.setItem(e.storageKey,r)}}let id="4.3.2",iu="@coinbase/wallet-sdk";async function ih(e,t){let r=Object.assign(Object.assign({},e),{jsonrpc:"2.0",id:crypto.randomUUID()}),i=await window.fetch(t,{method:"POST",body:JSON.stringify(r),mode:"cors",headers:{"Content-Type":"application/json","X-Cbw-Sdk-Version":id,"X-Cbw-Sdk-Platform":iu}}),{result:n,error:s}=await i.json();if(s)throw s;return n}let ip="accounts",iy="activeChain",ig="availableChains",im="walletCapabilities";class iw{constructor(e){var t,r,i;this.metadata=e.metadata,this.communicator=e.communicator,this.callback=e.callback,this.keyManager=new ic,this.storage=new ry("CBWSDK","SCWStateManager"),this.accounts=null!=(t=this.storage.loadObject(ip))?t:[],this.chain=this.storage.loadObject(iy)||{id:null!=(i=null==(r=e.metadata.appChainIds)?void 0:r[0])?i:1},this.handshake=this.handshake.bind(this),this.request=this.request.bind(this),this.createRequestMessage=this.createRequestMessage.bind(this),this.decryptResponseMessage=this.decryptResponseMessage.bind(this)}async handshake(e){var t,r,i,n;await (null==(r=(t=this.communicator).waitForPopupLoaded)?void 0:r.call(t));let s=await this.createRequestMessage({handshake:{method:e.method,params:Object.assign({},this.metadata,null!=(i=e.params)?i:{})}}),a=await this.communicator.postRequestAndWaitForResponse(s);if("failure"in a.content)throw a.content.failure;let o=await ir("public",a.sender);await this.keyManager.setPeerPublicKey(o);let l=(await this.decryptResponseMessage(a)).result;if("error"in l)throw l.error;if("eth_requestAccounts"===e.method){let e=l.value;this.accounts=e,this.storage.storeObject(ip,e),null==(n=this.callback)||n.call(this,"accountsChanged",e)}}async request(e){var t;if(0===this.accounts.length)if("wallet_sendCalls"===e.method)return this.sendRequestToPopup(e);else throw rR();switch(e.method){case"eth_requestAccounts":return null==(t=this.callback)||t.call(this,"connect",{chainId:rG(this.chain.id)}),this.accounts;case"eth_accounts":return this.accounts;case"eth_coinbase":return this.accounts[0];case"net_version":return this.chain.id;case"eth_chainId":return rG(this.chain.id);case"wallet_getCapabilities":return this.storage.loadObject(im);case"wallet_switchEthereumChain":return this.handleSwitchChainRequest(e);case"eth_ecRecover":case"personal_sign":case"wallet_sign":case"personal_ecRecover":case"eth_signTransaction":case"eth_sendTransaction":case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":case"wallet_addEthereumChain":case"wallet_watchAsset":case"wallet_sendCalls":case"wallet_showCallsStatus":case"wallet_grantPermissions":return this.sendRequestToPopup(e);default:if(!this.chain.rpcUrl)throw rP("No RPC URL set for chain");return ih(e,this.chain.rpcUrl)}}async sendRequestToPopup(e){var t,r;await (null==(r=(t=this.communicator).waitForPopupLoaded)?void 0:r.call(t));let i=await this.sendEncryptedRequest(e),n=(await this.decryptResponseMessage(i)).result;if("error"in n)throw n.error;return n.value}async cleanup(){var e,t;this.storage.clear(),await this.keyManager.clear(),this.accounts=[],this.chain={id:null!=(t=null==(e=this.metadata.appChainIds)?void 0:e[0])?t:1}}async handleSwitchChainRequest(e){var t;let r=e.params;if(!r||!(null==(t=r[0])?void 0:t.chainId))throw rC();let i=r5(r[0].chainId);if(this.updateChain(i))return null;let n=await this.sendRequestToPopup(e);return null===n&&this.updateChain(i),n}async sendEncryptedRequest(e){let t=await this.keyManager.getSharedSecret();if(!t)throw rR("No valid session found, try requestAccounts before other methods");let r=await ii({action:e,chainId:this.chain.id},t),i=await this.createRequestMessage({encrypted:r});return this.communicator.postRequestAndWaitForResponse(i)}async createRequestMessage(e){let t=await it("public",await this.keyManager.getOwnPublicKey());return{id:crypto.randomUUID(),sender:t,content:e,timestamp:new Date}}async decryptResponseMessage(e){var t,r;let i=e.content;if("failure"in i)throw i.failure;let n=await this.keyManager.getSharedSecret();if(!n)throw rR("Invalid session");let s=await is(i.encrypted,n),a=null==(t=s.data)?void 0:t.chains;if(a){let e=Object.entries(a).map(([e,t])=>({id:Number(e),rpcUrl:t}));this.storage.storeObject(ig,e),this.updateChain(this.chain.id,e)}let o=null==(r=s.data)?void 0:r.capabilities;return o&&this.storage.storeObject(im,o),s}updateChain(e,t){var r;let i=null!=t?t:this.storage.loadObject(ig),n=null==i?void 0:i.find(t=>t.id===e);return!!n&&(n!==this.chain&&(this.chain=n,this.storage.storeObject(iy,n),null==(r=this.callback)||r.call(this,"chainChanged",rG(n.id))),!0)}}var ib=e.i(618282);let iv="Addresses";function iE(e){return void 0!==e.errorMessage}class iA{constructor(e){this.secret=e}async encrypt(e){let t=this.secret;if(64!==t.length)throw Error("secret must be 256 bits");let r=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.importKey("raw",r$(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),n=new TextEncoder,s=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},i,n.encode(e)),a=s.slice(s.byteLength-16),o=s.slice(0,s.byteLength-16),l=new Uint8Array(a),c=new Uint8Array(o);return rK(new Uint8Array([...r,...l,...c]))}async decrypt(e){let t=this.secret;if(64!==t.length)throw Error("secret must be 256 bits");return new Promise((r,i)=>{!async function(){let n=await crypto.subtle.importKey("raw",r$(t),{name:"aes-gcm"},!1,["encrypt","decrypt"]),s=r$(e),a=s.slice(0,12),o=s.slice(12,28),l=new Uint8Array([...s.slice(28),...o]),c={name:"AES-GCM",iv:new Uint8Array(a)};try{let e=await window.crypto.subtle.decrypt(c,n,l),t=new TextDecoder;r(t.decode(e))}catch(e){i(e)}}()})}}class i_{constructor(e,t,r){this.linkAPIUrl=e,this.sessionId=t;const i=`${t}:${r}`;this.auth=`Basic ${btoa(i)}`}async markUnseenEventsAsSeen(e){return Promise.all(e.map(e=>fetch(`${this.linkAPIUrl}/events/${e.eventId}/seen`,{method:"POST",headers:{Authorization:this.auth}}))).catch(e=>console.error("Unabled to mark event as failed:",e))}async fetchUnseenEvents(){var e;let t=await fetch(`${this.linkAPIUrl}/events?unseen=true`,{headers:{Authorization:this.auth}});if(t.ok){let{events:r,error:i}=await t.json();if(i)throw Error(`Check unseen events failed: ${i}`);let n=null!=(e=null==r?void 0:r.filter(e=>"Web3Response"===e.event).map(e=>({type:"Event",sessionId:this.sessionId,eventId:e.id,event:e.event,data:e.data})))?e:[];return this.markUnseenEventsAsSeen(n),n}throw Error(`Check unseen events failed: ${t.status}`)}}(Cb=CK||(CK={}))[Cb.DISCONNECTED=0]="DISCONNECTED",Cb[Cb.CONNECTING=1]="CONNECTING",Cb[Cb.CONNECTED=2]="CONNECTED";class iS{setConnectionStateListener(e){this.connectionStateListener=e}setIncomingDataListener(e){this.incomingDataListener=e}constructor(e,t=WebSocket){this.WebSocketClass=t,this.webSocket=null,this.pendingData=[],this.url=e.replace(/^http/,"ws")}async connect(){if(this.webSocket)throw Error("webSocket object is not null");return new Promise((e,t)=>{var r;let i;try{this.webSocket=i=new this.WebSocketClass(this.url)}catch(e){t(e);return}null==(r=this.connectionStateListener)||r.call(this,CK.CONNECTING),i.onclose=e=>{var r;this.clearWebSocket(),t(Error(`websocket error ${e.code}: ${e.reason}`)),null==(r=this.connectionStateListener)||r.call(this,CK.DISCONNECTED)},i.onopen=t=>{var r;e(),null==(r=this.connectionStateListener)||r.call(this,CK.CONNECTED),this.pendingData.length>0&&([...this.pendingData].forEach(e=>this.sendData(e)),this.pendingData=[])},i.onmessage=e=>{var t,r;if("h"===e.data)null==(t=this.incomingDataListener)||t.call(this,{type:"Heartbeat"});else try{let t=JSON.parse(e.data);null==(r=this.incomingDataListener)||r.call(this,t)}catch(e){}}})}disconnect(){var e;let{webSocket:t}=this;if(t){this.clearWebSocket(),null==(e=this.connectionStateListener)||e.call(this,CK.DISCONNECTED),this.connectionStateListener=void 0,this.incomingDataListener=void 0;try{t.close()}catch(e){}}}sendData(e){let{webSocket:t}=this;if(!t){this.pendingData.push(e),this.connect();return}t.send(e)}clearWebSocket(){let{webSocket:e}=this;e&&(this.webSocket=null,e.onclose=null,e.onerror=null,e.onmessage=null,e.onopen=null)}}class iI{constructor({session:e,linkAPIUrl:t,listener:r}){this.destroyed=!1,this.lastHeartbeatResponse=0,this.nextReqId=rF(1),this._connected=!1,this._linked=!1,this.shouldFetchUnseenEventsOnConnect=!1,this.requestResolutions=new Map,this.handleSessionMetadataUpdated=e=>{e&&new Map([["__destroyed",this.handleDestroyed],["EthereumAddress",this.handleAccountUpdated],["WalletUsername",this.handleWalletUsernameUpdated],["AppVersion",this.handleAppVersionUpdated],["ChainId",t=>e.JsonRpcUrl&&this.handleChainUpdated(t,e.JsonRpcUrl)]]).forEach((t,r)=>{let i=e[r];void 0!==i&&t(i)})},this.handleDestroyed=e=>{var t;"1"===e&&(null==(t=this.listener)||t.resetAndReload())},this.handleAccountUpdated=async e=>{var t;let r=await this.cipher.decrypt(e);null==(t=this.listener)||t.accountUpdated(r)},this.handleMetadataUpdated=async(e,t)=>{var r;let i=await this.cipher.decrypt(t);null==(r=this.listener)||r.metadataUpdated(e,i)},this.handleWalletUsernameUpdated=async e=>{this.handleMetadataUpdated("walletUsername",e)},this.handleAppVersionUpdated=async e=>{this.handleMetadataUpdated("AppVersion",e)},this.handleChainUpdated=async(e,t)=>{var r;let i=await this.cipher.decrypt(e),n=await this.cipher.decrypt(t);null==(r=this.listener)||r.chainUpdated(i,n)},this.session=e,this.cipher=new iA(e.secret),this.listener=r;const i=new iS(`${t}/rpc`,WebSocket);i.setConnectionStateListener(async e=>{let t=!1;switch(e){case CK.DISCONNECTED:if(!this.destroyed){let e=async()=>{await new Promise(e=>setTimeout(e,5e3)),this.destroyed||i.connect().catch(()=>{e()})};e()}break;case CK.CONNECTED:t=await this.handleConnected(),this.updateLastHeartbeat(),setInterval(()=>{this.heartbeat()},1e4),this.shouldFetchUnseenEventsOnConnect&&this.fetchUnseenEventsAPI();case CK.CONNECTING:}this.connected!==t&&(this.connected=t)}),i.setIncomingDataListener(e=>{var t;switch(e.type){case"Heartbeat":this.updateLastHeartbeat();return;case"IsLinkedOK":case"Linked":{let t="IsLinkedOK"===e.type?e.linked:void 0;this.linked=t||e.onlineGuests>0;break}case"GetSessionConfigOK":case"SessionConfigUpdated":this.handleSessionMetadataUpdated(e.metadata);break;case"Event":this.handleIncomingEvent(e)}void 0!==e.id&&(null==(t=this.requestResolutions.get(e.id))||t(e))}),this.ws=i,this.http=new i_(t,e.id,e.key)}connect(){if(this.destroyed)throw Error("instance is destroyed");this.ws.connect()}async destroy(){this.destroyed||(await this.makeRequest({type:"SetSessionConfig",id:rF(this.nextReqId++),sessionId:this.session.id,metadata:{__destroyed:"1"}},{timeout:1e3}),this.destroyed=!0,this.ws.disconnect(),this.listener=void 0)}get connected(){return this._connected}set connected(e){this._connected=e}get linked(){return this._linked}set linked(e){var t,r;this._linked=e,e&&(null==(t=this.onceLinked)||t.call(this)),null==(r=this.listener)||r.linkedUpdated(e)}setOnceLinked(e){return new Promise(t=>{this.linked?e().then(t):this.onceLinked=()=>{e().then(t),this.onceLinked=void 0}})}async handleIncomingEvent(e){var t;if("Event"!==e.type||"Web3Response"!==e.event)return;let r=JSON.parse(await this.cipher.decrypt(e.data));if("WEB3_RESPONSE"!==r.type)return;let{id:i,response:n}=r;null==(t=this.listener)||t.handleWeb3ResponseMessage(i,n)}async checkUnseenEvents(){if(!this.connected){this.shouldFetchUnseenEventsOnConnect=!0;return}await new Promise(e=>setTimeout(e,250));try{await this.fetchUnseenEventsAPI()}catch(e){console.error("Unable to check for unseen events",e)}}async fetchUnseenEventsAPI(){this.shouldFetchUnseenEventsOnConnect=!1,(await this.http.fetchUnseenEvents()).forEach(e=>this.handleIncomingEvent(e))}async publishEvent(e,t,r=!1){let i=await this.cipher.encrypt(JSON.stringify(Object.assign(Object.assign({},t),{origin:location.origin,location:location.href,relaySource:"coinbaseWalletExtension"in window&&window.coinbaseWalletExtension?"injected_sdk":"sdk"}))),n={type:"PublishEvent",id:rF(this.nextReqId++),sessionId:this.session.id,event:e,data:i,callWebhook:r};return this.setOnceLinked(async()=>{let e=await this.makeRequest(n);if("Fail"===e.type)throw Error(e.error||"failed to publish event");return e.eventId})}sendData(e){this.ws.sendData(JSON.stringify(e))}updateLastHeartbeat(){this.lastHeartbeatResponse=Date.now()}heartbeat(){if(Date.now()-this.lastHeartbeatResponse>2e4)return void this.ws.disconnect();try{this.ws.sendData("h")}catch(e){}}async makeRequest(e,t={timeout:6e4}){let r,i=e.id;return this.sendData(e),Promise.race([new Promise((e,n)=>{r=window.setTimeout(()=>{n(Error(`request ${i} timed out`))},t.timeout)}),new Promise(e=>{this.requestResolutions.set(i,t=>{clearTimeout(r),e(t),this.requestResolutions.delete(i)})})])}async handleConnected(){return"Fail"!==(await this.makeRequest({type:"HostSession",id:rF(this.nextReqId++),sessionId:this.session.id,sessionKey:this.session.key})).type&&(this.sendData({type:"IsLinked",id:rF(this.nextReqId++),sessionId:this.session.id}),this.sendData({type:"GetSessionConfig",id:rF(this.nextReqId++),sessionId:this.session.id}),!0)}}class ix{constructor(){this._nextRequestId=0,this.callbacks=new Map}makeRequestId(){this._nextRequestId=(this._nextRequestId+1)%0x7fffffff;let e=this._nextRequestId,t=rX(e.toString(16));return this.callbacks.get(t)&&this.callbacks.delete(t),e}}var iT=e.i(432987),ik=e.i(700391);let iC="session:id",iP="session:secret",iO="session:linked";class iR{constructor(e,t,r,i=!1){this.storage=e,this.id=t,this.secret=r,this.key=(0,ik.bytesToHex)((0,iT.sha256)(`${t}, ${r} WalletLink`)),this._linked=!!i}static create(e){return new iR(e,rH(16),rH(32)).save()}static load(e){let t=e.getItem(iC),r=e.getItem(iO),i=e.getItem(iP);return t&&i?new iR(e,t,i,"1"===r):null}get linked(){return this._linked}set linked(e){this._linked=e,this.persistLinked()}save(){return this.storage.setItem(iC,this.id),this.storage.setItem(iP,this.secret),this.persistLinked(),this}persistLinked(){this.storage.setItem(iO,this._linked?"1":"0")}}function iN(){var e,t;return null!=(t=null==(e=null==window?void 0:window.matchMedia)?void 0:e.call(window,"(prefers-color-scheme: dark)").matches)&&t}function iM(){let e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode('@namespace svg "http://www.w3.org/2000/svg";.-cbwsdk-css-reset,.-cbwsdk-css-reset *{animation:none;animation-delay:0;animation-direction:normal;animation-duration:0;animation-fill-mode:none;animation-iteration-count:1;animation-name:none;animation-play-state:running;animation-timing-function:ease;backface-visibility:visible;background:0;background-attachment:scroll;background-clip:border-box;background-color:rgba(0,0,0,0);background-image:none;background-origin:padding-box;background-position:0 0;background-position-x:0;background-position-y:0;background-repeat:repeat;background-size:auto auto;border:0;border-style:none;border-width:medium;border-color:inherit;border-bottom:0;border-bottom-color:inherit;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:none;border-bottom-width:medium;border-collapse:separate;border-image:none;border-left:0;border-left-color:inherit;border-left-style:none;border-left-width:medium;border-radius:0;border-right:0;border-right-color:inherit;border-right-style:none;border-right-width:medium;border-spacing:0;border-top:0;border-top-color:inherit;border-top-left-radius:0;border-top-right-radius:0;border-top-style:none;border-top-width:medium;box-shadow:none;box-sizing:border-box;caption-side:top;clear:none;clip:auto;color:inherit;columns:auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium none currentColor;column-rule-color:currentColor;column-rule-style:none;column-rule-width:none;column-span:1;column-width:auto;counter-increment:none;counter-reset:none;direction:ltr;empty-cells:show;float:none;font:normal;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:normal;height:auto;hyphens:none;letter-spacing:normal;line-height:normal;list-style:none;list-style-image:none;list-style-position:outside;list-style-type:disc;margin:0;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;opacity:1;orphans:0;outline:0;outline-color:invert;outline-style:none;outline-width:medium;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;perspective:none;perspective-origin:50% 50%;pointer-events:auto;position:static;quotes:"\\201C" "\\201D" "\\2018" "\\2019";tab-size:8;table-layout:auto;text-align:inherit;text-align-last:auto;text-decoration:none;text-decoration-color:inherit;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-shadow:none;text-transform:none;transform:none;transform-style:flat;transition:none;transition-delay:0s;transition-duration:0s;transition-property:none;transition-timing-function:ease;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:0;word-spacing:normal;z-index:auto}.-cbwsdk-css-reset strong{font-weight:bold}.-cbwsdk-css-reset *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;line-height:1}.-cbwsdk-css-reset [class*=container]{margin:0;padding:0}.-cbwsdk-css-reset style{display:none}')),document.documentElement.appendChild(e)}var iU=e.i(194205),iD=e.i(836057),ij=e.i(33228);class iL{constructor(){this.items=new Map,this.nextItemKey=0,this.root=null,this.darkMode=iN()}attach(e){this.root=document.createElement("div"),this.root.className="-cbwsdk-snackbar-root",e.appendChild(this.root),this.render()}presentItem(e){let t=this.nextItemKey++;return this.items.set(t,e),this.render(),()=>{this.items.delete(t),this.render()}}clear(){this.items.clear(),this.render()}render(){this.root&&(0,iD.render)((0,iD.h)("div",null,(0,iD.h)(iB,{darkMode:this.darkMode},Array.from(this.items.entries()).map(([e,t])=>(0,iD.h)(iW,Object.assign({},t,{key:e}))))),this.root)}}let iB=e=>(0,iD.h)("div",{class:(0,iU.clsx)("-cbwsdk-snackbar-container")},(0,iD.h)("style",null,".-cbwsdk-css-reset .-gear-container{margin-left:16px !important;margin-right:9px !important;display:flex;align-items:center;justify-content:center;width:24px;height:24px;transition:opacity .25s}.-cbwsdk-css-reset .-gear-container *{user-select:none}.-cbwsdk-css-reset .-gear-container svg{opacity:0;position:absolute}.-cbwsdk-css-reset .-gear-icon{height:12px;width:12px;z-index:10000}.-cbwsdk-css-reset .-cbwsdk-snackbar{align-items:flex-end;display:flex;flex-direction:column;position:fixed;right:0;top:0;z-index:2147483647}.-cbwsdk-css-reset .-cbwsdk-snackbar *{user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance{display:flex;flex-direction:column;margin:8px 16px 0 16px;overflow:visible;text-align:left;transform:translateX(0);transition:opacity .25s,transform .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header:hover .-gear-container svg{opacity:1}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header{display:flex;align-items:center;background:#fff;overflow:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-cblogo{margin:8px 8px 8px 8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-message{color:#000;font-size:13px;line-height:1.5;user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu{background:#fff;transition:opacity .25s ease-in-out,transform .25s linear,visibility 0s;visibility:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;opacity:0;flex-direction:column;padding-left:8px;padding-right:8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:last-child{margin-bottom:8px !important}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover{background:#f5f7f8;border-radius:6px;transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover span{color:#050f19;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover svg path{fill:#000;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item{visibility:inherit;height:35px;margin-top:8px;margin-bottom:0;display:flex;flex-direction:row;align-items:center;padding:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item *{visibility:inherit;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover{background:rgba(223,95,103,.2);transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover svg path{fill:#df5f67;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover span{color:#df5f67;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-info{color:#aaa;font-size:13px;margin:0 8px 0 32px;position:absolute}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-hidden{opacity:0;text-align:left;transform:translateX(25%);transition:opacity .5s linear}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-expanded .-cbwsdk-snackbar-instance-menu{opacity:1;display:flex;transform:translateY(8px);visibility:visible}"),(0,iD.h)("div",{class:"-cbwsdk-snackbar"},e.children)),iW=({autoExpand:e,message:t,menuItems:r})=>{let[i,n]=(0,ij.useState)(!0),[s,a]=(0,ij.useState)(null!=e&&e);return(0,ij.useEffect)(()=>{let e=[window.setTimeout(()=>{n(!1)},1),window.setTimeout(()=>{a(!0)},1e4)];return()=>{e.forEach(window.clearTimeout)}}),(0,iD.h)("div",{class:(0,iU.clsx)("-cbwsdk-snackbar-instance",i&&"-cbwsdk-snackbar-instance-hidden",s&&"-cbwsdk-snackbar-instance-expanded")},(0,iD.h)("div",{class:"-cbwsdk-snackbar-instance-header",onClick:()=>{a(!s)}},(0,iD.h)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEuNDkyIDEwLjQxOWE4LjkzIDguOTMgMCAwMTguOTMtOC45M2gxMS4xNjNhOC45MyA4LjkzIDAgMDE4LjkzIDguOTN2MTEuMTYzYTguOTMgOC45MyAwIDAxLTguOTMgOC45M0gxMC40MjJhOC45MyA4LjkzIDAgMDEtOC45My04LjkzVjEwLjQxOXoiIGZpbGw9IiMxNjUyRjAiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwLjQxOSAwSDIxLjU4QzI3LjMzNSAwIDMyIDQuNjY1IDMyIDEwLjQxOVYyMS41OEMzMiAyNy4zMzUgMjcuMzM1IDMyIDIxLjU4MSAzMkgxMC40MkM0LjY2NSAzMiAwIDI3LjMzNSAwIDIxLjU4MVYxMC40MkMwIDQuNjY1IDQuNjY1IDAgMTAuNDE5IDB6bTAgMS40ODhhOC45MyA4LjkzIDAgMDAtOC45MyA4LjkzdjExLjE2M2E4LjkzIDguOTMgMCAwMDguOTMgOC45M0gyMS41OGE4LjkzIDguOTMgMCAwMDguOTMtOC45M1YxMC40MmE4LjkzIDguOTMgMCAwMC04LjkzLTguOTNIMTAuNDJ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNS45OTggMjYuMDQ5Yy01LjU0OSAwLTEwLjA0Ny00LjQ5OC0xMC4wNDctMTAuMDQ3IDAtNS41NDggNC40OTgtMTAuMDQ2IDEwLjA0Ny0xMC4wNDYgNS41NDggMCAxMC4wNDYgNC40OTggMTAuMDQ2IDEwLjA0NiAwIDUuNTQ5LTQuNDk4IDEwLjA0Ny0xMC4wNDYgMTAuMDQ3eiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0xMi43NjIgMTQuMjU0YzAtLjgyMi42NjctMS40ODkgMS40ODktMS40ODloMy40OTdjLjgyMiAwIDEuNDg4LjY2NiAxLjQ4OCAxLjQ4OXYzLjQ5N2MwIC44MjItLjY2NiAxLjQ4OC0xLjQ4OCAxLjQ4OGgtMy40OTdhMS40ODggMS40ODggMCAwMS0xLjQ4OS0xLjQ4OHYtMy40OTh6IiBmaWxsPSIjMTY1MkYwIi8+PC9zdmc+",class:"-cbwsdk-snackbar-instance-header-cblogo"})," ",(0,iD.h)("div",{class:"-cbwsdk-snackbar-instance-header-message"},t),(0,iD.h)("div",{class:"-gear-container"},!s&&(0,iD.h)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,iD.h)("circle",{cx:"12",cy:"12",r:"12",fill:"#F5F7F8"})),(0,iD.h)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDYuNzV2LTEuNWwtMS43Mi0uNTdjLS4wOC0uMjctLjE5LS41Mi0uMzItLjc3bC44MS0xLjYyLTEuMDYtMS4wNi0xLjYyLjgxYy0uMjQtLjEzLS41LS4yNC0uNzctLjMyTDYuNzUgMGgtMS41bC0uNTcgMS43MmMtLjI3LjA4LS41My4xOS0uNzcuMzJsLTEuNjItLjgxLTEuMDYgMS4wNi44MSAxLjYyYy0uMTMuMjQtLjI0LjUtLjMyLjc3TDAgNS4yNXYxLjVsMS43Mi41N2MuMDguMjcuMTkuNTMuMzIuNzdsLS44MSAxLjYyIDEuMDYgMS4wNiAxLjYyLS44MWMuMjQuMTMuNS4yMy43Ny4zMkw1LjI1IDEyaDEuNWwuNTctMS43MmMuMjctLjA4LjUyLS4xOS43Ny0uMzJsMS42Mi44MSAxLjA2LTEuMDYtLjgxLTEuNjJjLjEzLS4yNC4yMy0uNS4zMi0uNzdMMTIgNi43NXpNNiA4LjVhMi41IDIuNSAwIDAxMC01IDIuNSAyLjUgMCAwMTAgNXoiIGZpbGw9IiMwNTBGMTkiLz48L3N2Zz4=",class:"-gear-icon",title:"Expand"}))),r&&r.length>0&&(0,iD.h)("div",{class:"-cbwsdk-snackbar-instance-menu"},r.map((e,t)=>(0,iD.h)("div",{class:(0,iU.clsx)("-cbwsdk-snackbar-instance-menu-item",e.isRed&&"-cbwsdk-snackbar-instance-menu-item-is-red"),onClick:e.onClick,key:t},(0,iD.h)("svg",{width:e.svgWidth,height:e.svgHeight,viewBox:"0 0 10 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,iD.h)("path",{"fill-rule":e.defaultFillRule,"clip-rule":e.defaultClipRule,d:e.path,fill:"#AAAAAA"})),(0,iD.h)("span",{class:(0,iU.clsx)("-cbwsdk-snackbar-instance-menu-item-info",e.isRed&&"-cbwsdk-snackbar-instance-menu-item-info-is-red")},e.info)))))},iF="M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z";class iz{constructor(){this.attached=!1,this.snackbar=new iL}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");let e=document.documentElement,t=document.createElement("div");t.className="-cbwsdk-css-reset",e.appendChild(t),this.snackbar.attach(t),this.attached=!0,iM()}showConnecting(e){let t;return t=e.isUnlinkedErrorState?{autoExpand:!0,message:"Connection lost",menuItems:[{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:"M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z",defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:e.onResetConnection}]}:{message:"Confirm on phone",menuItems:[{isRed:!0,info:"Cancel transaction",svgWidth:"11",svgHeight:"11",path:"M10.3711 1.52346L9.21775 0.370117L5.37109 4.21022L1.52444 0.370117L0.371094 1.52346L4.2112 5.37012L0.371094 9.21677L1.52444 10.3701L5.37109 6.53001L9.21775 10.3701L10.3711 9.21677L6.53099 5.37012L10.3711 1.52346Z",defaultFillRule:"inherit",defaultClipRule:"inherit",onClick:e.onCancel},{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:iF,defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:e.onResetConnection}]},this.snackbar.presentItem(t)}}class iq{constructor(){this.root=null,this.darkMode=iN()}attach(){let e=document.documentElement;this.root=document.createElement("div"),this.root.className="-cbwsdk-css-reset",e.appendChild(this.root),iM()}present(e){this.render(e)}clear(){this.render(null)}render(e){!this.root||((0,iD.render)(null,this.root),e&&(0,iD.render)((0,iD.h)(iH,Object.assign({},e,{onDismiss:()=>{this.clear()},darkMode:this.darkMode})),this.root))}}let iH=({title:e,buttonText:t,darkMode:r,onButtonClick:i,onDismiss:n})=>(0,iD.h)(iB,{darkMode:r},(0,iD.h)("div",{class:"-cbwsdk-redirect-dialog"},(0,iD.h)("style",null,".-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;transition:opacity .25s;background-color:rgba(10,11,13,.5)}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop-hidden{opacity:0}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box{display:block;position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);padding:20px;border-radius:8px;background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box p{display:block;font-weight:400;font-size:14px;line-height:20px;padding-bottom:12px;color:#5b636e}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box button{appearance:none;border:none;background:none;color:#0052ff;padding:0;text-decoration:none;display:block;font-weight:600;font-size:16px;line-height:24px}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark{background-color:#0a0b0d;color:#fff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark button{color:#0052ff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light{background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light button{color:#0052ff}"),(0,iD.h)("div",{class:"-cbwsdk-redirect-dialog-backdrop",onClick:n}),(0,iD.h)("div",{class:(0,iU.clsx)("-cbwsdk-redirect-dialog-box",r?"dark":"light")},(0,iD.h)("p",null,e),(0,iD.h)("button",{onClick:i},t)))),iK="https://www.walletlink.org";class i${constructor(){this.attached=!1,this.redirectDialog=new iq}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");this.redirectDialog.attach(),this.attached=!0}redirectToCoinbaseWallet(e){let t=new URL("https://go.cb-w.com/walletlink");t.searchParams.append("redirect_url",function(){try{if(function(){try{return null!==window.frameElement}catch(e){return!1}}()&&window.top)return window.top.location;return window.location}catch(e){return window.location}}().href),e&&t.searchParams.append("wl_url",e);let r=document.createElement("a");r.target="cbw-opener",r.href=t.href,r.rel="noreferrer noopener",r.click()}openCoinbaseWalletDeeplink(e){this.redirectDialog.present({title:"Redirecting to Coinbase Wallet...",buttonText:"Open",onButtonClick:()=>{this.redirectToCoinbaseWallet(e)}}),setTimeout(()=>{this.redirectToCoinbaseWallet(e)},99)}showConnecting(e){return()=>{this.redirectDialog.clear()}}}class iV{constructor(e){this.chainCallbackParams={chainId:"",jsonRpcUrl:""},this.isMobileWeb=function(){var e;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null==(e=null==window?void 0:window.navigator)?void 0:e.userAgent)}(),this.linkedUpdated=e=>{this.isLinked=e;let t=this.storage.getItem(iv);if(e&&(this._session.linked=e),this.isUnlinkedErrorState=!1,t){let r=t.split(" "),i="true"===this.storage.getItem("IsStandaloneSigning");""===r[0]||e||!this._session.linked||i||(this.isUnlinkedErrorState=!0)}},this.metadataUpdated=(e,t)=>{this.storage.setItem(e,t)},this.chainUpdated=(e,t)=>{(this.chainCallbackParams.chainId!==e||this.chainCallbackParams.jsonRpcUrl!==t)&&(this.chainCallbackParams={chainId:e,jsonRpcUrl:t},this.chainCallback&&this.chainCallback(t,Number.parseInt(e,10)))},this.accountUpdated=e=>{this.accountsCallback&&this.accountsCallback([e]),iV.accountRequestCallbackIds.size>0&&(Array.from(iV.accountRequestCallbackIds.values()).forEach(t=>{this.invokeCallback(t,{method:"requestEthereumAccounts",result:[e]})}),iV.accountRequestCallbackIds.clear())},this.resetAndReload=this.resetAndReload.bind(this),this.linkAPIUrl=e.linkAPIUrl,this.storage=e.storage,this.metadata=e.metadata,this.accountsCallback=e.accountsCallback,this.chainCallback=e.chainCallback;const{session:t,ui:r,connection:i}=this.subscribe();this._session=t,this.connection=i,this.relayEventManager=new ix,this.ui=r,this.ui.attach()}subscribe(){let e=iR.load(this.storage)||iR.create(this.storage),{linkAPIUrl:t}=this,r=new iI({session:e,linkAPIUrl:t,listener:this}),i=this.isMobileWeb?new i$:new iz;return r.connect(),{session:e,ui:i,connection:r}}resetAndReload(){this.connection.destroy().then(()=>{let e=iR.load(this.storage);(null==e?void 0:e.id)===this._session.id&&ry.clearAll(),document.location.reload()}).catch(e=>{})}signEthereumTransaction(e){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:e.fromAddress,toAddress:e.toAddress,weiValue:rZ(e.weiValue),data:rV(e.data,!0),nonce:e.nonce,gasPriceInWei:e.gasPriceInWei?rZ(e.gasPriceInWei):null,maxFeePerGas:e.gasPriceInWei?rZ(e.gasPriceInWei):null,maxPriorityFeePerGas:e.gasPriceInWei?rZ(e.gasPriceInWei):null,gasLimit:e.gasLimit?rZ(e.gasLimit):null,chainId:e.chainId,shouldSubmit:!1}})}signAndSubmitEthereumTransaction(e){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:e.fromAddress,toAddress:e.toAddress,weiValue:rZ(e.weiValue),data:rV(e.data,!0),nonce:e.nonce,gasPriceInWei:e.gasPriceInWei?rZ(e.gasPriceInWei):null,maxFeePerGas:e.maxFeePerGas?rZ(e.maxFeePerGas):null,maxPriorityFeePerGas:e.maxPriorityFeePerGas?rZ(e.maxPriorityFeePerGas):null,gasLimit:e.gasLimit?rZ(e.gasLimit):null,chainId:e.chainId,shouldSubmit:!0}})}submitEthereumTransaction(e,t){return this.sendRequest({method:"submitEthereumTransaction",params:{signedTransaction:rV(e,!0),chainId:t}})}getWalletLinkSession(){return this._session}sendRequest(e){let t=null,r=rH(8),i=i=>{this.publishWeb3RequestCanceledEvent(r),this.handleErrorResponse(r,e.method,i),null==t||t()};return new Promise((n,s)=>{t=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:i,onResetConnection:this.resetAndReload}),this.relayEventManager.callbacks.set(r,e=>{if(null==t||t(),iE(e))return s(Error(e.errorMessage));n(e)}),this.publishWeb3RequestEvent(r,e)})}publishWeb3RequestEvent(e,t){let r={type:"WEB3_REQUEST",id:e,request:t};this.publishEvent("Web3Request",r,!0).then(e=>{}).catch(e=>{this.handleWeb3ResponseMessage(r.id,{method:t.method,errorMessage:e.message})}),this.isMobileWeb&&this.openCoinbaseWalletDeeplink(t.method)}openCoinbaseWalletDeeplink(e){if(this.ui instanceof i$)switch(e){case"requestEthereumAccounts":case"switchEthereumChain":return;default:window.addEventListener("blur",()=>{window.addEventListener("focus",()=>{this.connection.checkUnseenEvents()},{once:!0})},{once:!0}),this.ui.openCoinbaseWalletDeeplink()}}publishWeb3RequestCanceledEvent(e){this.publishEvent("Web3RequestCanceled",{type:"WEB3_REQUEST_CANCELED",id:e},!1).then()}publishEvent(e,t,r){return this.connection.publishEvent(e,t,r)}handleWeb3ResponseMessage(e,t){if("requestEthereumAccounts"===t.method){iV.accountRequestCallbackIds.forEach(e=>this.invokeCallback(e,t)),iV.accountRequestCallbackIds.clear();return}this.invokeCallback(e,t)}handleErrorResponse(e,t,r){var i;let n=null!=(i=null==r?void 0:r.message)?i:"Unspecified error message.";this.handleWeb3ResponseMessage(e,{method:t,errorMessage:n})}invokeCallback(e,t){let r=this.relayEventManager.callbacks.get(e);r&&(r(t),this.relayEventManager.callbacks.delete(e))}requestEthereumAccounts(){let{appName:e,appLogoUrl:t}=this.metadata,r={method:"requestEthereumAccounts",params:{appName:e,appLogoUrl:t}},i=rH(8);return new Promise((e,t)=>{this.relayEventManager.callbacks.set(i,r=>{if(iE(r))return t(Error(r.errorMessage));e(r)}),iV.accountRequestCallbackIds.add(i),this.publishWeb3RequestEvent(i,r)})}watchAsset(e,t,r,i,n,s){let a={method:"watchAsset",params:{type:e,options:{address:t,symbol:r,decimals:i,image:n},chainId:s}},o=null,l=rH(8),c=e=>{this.publishWeb3RequestCanceledEvent(l),this.handleErrorResponse(l,a.method,e),null==o||o()};return o=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:c,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(l,r=>{if(null==o||o(),iE(r))return t(Error(r.errorMessage));e(r)}),this.publishWeb3RequestEvent(l,a)})}addEthereumChain(e,t,r,i,n,s){let a={method:"addEthereumChain",params:{chainId:e,rpcUrls:t,blockExplorerUrls:i,chainName:n,iconUrls:r,nativeCurrency:s}},o=null,l=rH(8),c=e=>{this.publishWeb3RequestCanceledEvent(l),this.handleErrorResponse(l,a.method,e),null==o||o()};return o=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:c,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(l,r=>{if(null==o||o(),iE(r))return t(Error(r.errorMessage));e(r)}),this.publishWeb3RequestEvent(l,a)})}switchEthereumChain(e,t){let r={method:"switchEthereumChain",params:Object.assign({chainId:e},{address:t})},i=null,n=rH(8),s=e=>{this.publishWeb3RequestCanceledEvent(n),this.handleErrorResponse(n,r.method,e),null==i||i()};return i=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:s,onResetConnection:this.resetAndReload}),new Promise((e,t)=>{this.relayEventManager.callbacks.set(n,r=>(null==i||i(),iE(r)&&r.errorCode)?t(rU({code:r.errorCode,message:"Unrecognized chain ID. Try adding the chain using addEthereumChain first."})):iE(r)?t(Error(r.errorMessage)):void e(r)),this.publishWeb3RequestEvent(n,r)})}}iV.accountRequestCallbackIds=new Set;let iJ="DefaultChainId",iZ="DefaultJsonRpcUrl";class iG{constructor(e){this._relay=null,this._addresses=[],this.metadata=e.metadata,this._storage=new ry("walletlink",iK),this.callback=e.callback||null;const t=this._storage.getItem(iv);if(t){const e=t.split(" ");""!==e[0]&&(this._addresses=e.map(e=>r2(e)))}this.initializeRelay()}getSession(){let{id:e,secret:t}=this.initializeRelay().getWalletLinkSession();return{id:e,secret:t}}async handshake(){await this._eth_requestAccounts()}get selectedAddress(){return this._addresses[0]||void 0}get jsonRpcUrl(){var e;return null!=(e=this._storage.getItem(iZ))?e:void 0}set jsonRpcUrl(e){this._storage.setItem(iZ,e)}updateProviderInfo(e,t){var r;this.jsonRpcUrl=e;let i=this.getChainId();this._storage.setItem(iJ,t.toString(10)),r5(t)!==i&&(null==(r=this.callback)||r.call(this,"chainChanged",rG(t)))}async watchAsset(e){let t=Array.isArray(e)?e[0]:e;if(!t.type)throw rC("Type is required");if((null==t?void 0:t.type)!=="ERC20")throw rC(`Asset of type '${t.type}' is not supported`);if(!(null==t?void 0:t.options))throw rC("Options are required");if(!(null==t?void 0:t.options.address))throw rC("Address is required");let r=this.getChainId(),{address:i,symbol:n,image:s,decimals:a}=t.options,o=this.initializeRelay(),l=await o.watchAsset(t.type,i,n,a,s,null==r?void 0:r.toString());return!iE(l)&&!!l.result}async addEthereumChain(e){var t,r;let i=e[0];if((null==(t=i.rpcUrls)?void 0:t.length)===0)throw rC("please pass in at least 1 rpcUrl");if(!i.chainName||""===i.chainName.trim())throw rC("chainName is a required field");if(!i.nativeCurrency)throw rC("nativeCurrency is a required field");let n=Number.parseInt(i.chainId,16);if(n===this.getChainId())return!1;let s=this.initializeRelay(),{rpcUrls:a=[],blockExplorerUrls:o=[],chainName:l,iconUrls:c=[],nativeCurrency:d}=i,u=await s.addEthereumChain(n.toString(),a,c,o,l,d);if(iE(u))return!1;if((null==(r=u.result)?void 0:r.isApproved)===!0)return this.updateProviderInfo(a[0],n),null;throw rP("unable to add ethereum chain")}async switchEthereumChain(e){let t=Number.parseInt(e[0].chainId,16),r=this.initializeRelay(),i=await r.switchEthereumChain(t.toString(10),this.selectedAddress||void 0);if(iE(i))throw i;let n=i.result;return n.isApproved&&n.rpcUrl.length>0&&this.updateProviderInfo(n.rpcUrl,t),null}async cleanup(){this.callback=null,this._relay&&this._relay.resetAndReload(),this._storage.clear()}_setAddresses(e,t){var r;if(!Array.isArray(e))throw Error("addresses is not an array");let i=e.map(e=>r2(e));JSON.stringify(i)!==JSON.stringify(this._addresses)&&(this._addresses=i,null==(r=this.callback)||r.call(this,"accountsChanged",i),this._storage.setItem(iv,i.join(" ")))}async request(e){let t=e.params||[];switch(e.method){case"eth_accounts":return[...this._addresses];case"eth_coinbase":return this.selectedAddress||null;case"net_version":return this.getChainId().toString(10);case"eth_chainId":return rG(this.getChainId());case"eth_requestAccounts":return this._eth_requestAccounts();case"eth_ecRecover":case"personal_ecRecover":return this.ecRecover(e);case"personal_sign":return this.personalSign(e);case"eth_signTransaction":return this._eth_signTransaction(t);case"eth_sendRawTransaction":return this._eth_sendRawTransaction(t);case"eth_sendTransaction":return this._eth_sendTransaction(t);case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":return this.signTypedData(e);case"wallet_addEthereumChain":return this.addEthereumChain(t);case"wallet_switchEthereumChain":return this.switchEthereumChain(t);case"wallet_watchAsset":return this.watchAsset(t);default:if(!this.jsonRpcUrl)throw rP("No RPC URL set for chain");return ih(e,this.jsonRpcUrl)}}_ensureKnownAddress(e){let t=r2(e);if(!this._addresses.map(e=>r2(e)).includes(t))throw Error("Unknown Ethereum address")}_prepareTransactionParams(e){let t=e.from?r2(e.from):this.selectedAddress;if(!t)throw Error("Ethereum address is unavailable");this._ensureKnownAddress(t);let r=e.to?r2(e.to):null,i=null!=e.value?r8(e.value):BigInt(0),n=e.data?r3(e.data):rg.Buffer.alloc(0),s=null!=e.nonce?r5(e.nonce):null,a=null!=e.gasPrice?r8(e.gasPrice):null,o=null!=e.maxFeePerGas?r8(e.maxFeePerGas):null,l=null!=e.maxPriorityFeePerGas?r8(e.maxPriorityFeePerGas):null;return{fromAddress:t,toAddress:r,weiValue:i,data:n,nonce:s,gasPriceInWei:a,maxFeePerGas:o,maxPriorityFeePerGas:l,gasLimit:null!=e.gas?r8(e.gas):null,chainId:e.chainId?r5(e.chainId):this.getChainId()}}async ecRecover(e){let{method:t,params:r}=e;if(!Array.isArray(r))throw rC();let i=this.initializeRelay(),n=await i.sendRequest({method:"ethereumAddressFromSignedMessage",params:{message:rJ(r[0]),signature:rJ(r[1]),addPrefix:"personal_ecRecover"===t}});if(iE(n))throw n;return n.result}getChainId(){var e;return Number.parseInt(null!=(e=this._storage.getItem(iJ))?e:"1",10)}async _eth_requestAccounts(){var e,t;if(this._addresses.length>0)return null==(e=this.callback)||e.call(this,"connect",{chainId:rG(this.getChainId())}),this._addresses;let r=this.initializeRelay(),i=await r.requestEthereumAccounts();if(iE(i))throw i;if(!i.result)throw Error("accounts received is empty");return this._setAddresses(i.result),null==(t=this.callback)||t.call(this,"connect",{chainId:rG(this.getChainId())}),this._addresses}async personalSign({params:e}){if(!Array.isArray(e))throw rC();let t=e[1],r=e[0];this._ensureKnownAddress(t);let i=this.initializeRelay(),n=await i.sendRequest({method:"signEthereumMessage",params:{address:r2(t),message:rJ(r),addPrefix:!0,typedDataJson:null}});if(iE(n))throw n;return n.result}async _eth_signTransaction(e){let t=this._prepareTransactionParams(e[0]||{}),r=this.initializeRelay(),i=await r.signEthereumTransaction(t);if(iE(i))throw i;return i.result}async _eth_sendRawTransaction(e){let t=r3(e[0]),r=this.initializeRelay(),i=await r.submitEthereumTransaction(t,this.getChainId());if(iE(i))throw i;return i.result}async _eth_sendTransaction(e){let t=this._prepareTransactionParams(e[0]||{}),r=this.initializeRelay(),i=await r.signAndSubmitEthereumTransaction(t);if(iE(i))throw i;return i.result}async signTypedData(e){let{method:t,params:r}=e;if(!Array.isArray(r))throw rC();let i=r[+("eth_signTypedData_v1"===t)],n=r[+("eth_signTypedData_v1"!==t)];this._ensureKnownAddress(i);let s=this.initializeRelay(),a=await s.sendRequest({method:"signEthereumMessage",params:{address:r2(i),message:rV(({eth_signTypedData_v1:ib.default.hashForSignTypedDataLegacy,eth_signTypedData_v3:ib.default.hashForSignTypedData_v3,eth_signTypedData_v4:ib.default.hashForSignTypedData_v4,eth_signTypedData:ib.default.hashForSignTypedData_v4})[t]({data:function(e){if("string"==typeof e)return JSON.parse(e);if("object"==typeof e)return e;throw rC(`Not a JSON string or an object: ${String(e)}`)}(n)}),!0),typedDataJson:JSON.stringify(n,null,2),addPrefix:!1}});if(iE(a))throw a;return a.result}initializeRelay(){return this._relay||(this._relay=new iV({linkAPIUrl:iK,storage:this._storage,metadata:this.metadata,accountsCallback:this._setAddresses.bind(this),chainCallback:this.updateProviderInfo.bind(this)})),this._relay}}let iY="SignerType",iQ=new ry("CBWSDK","SignerConfigurator");async function iX(e){let{communicator:t,metadata:r,handshakeRequest:i,callback:n}=e;i0(t,r,n).catch(()=>{});let s={id:crypto.randomUUID(),event:"selectSignerType",data:Object.assign(Object.assign({},e.preference),{handshakeRequest:i})},{data:a}=await t.postRequestAndWaitForResponse(s);return a}async function i0(e,t,r){await e.onMessage(({event:e})=>"WalletLinkSessionRequest"===e);let i=new iG({metadata:t,callback:r});e.postMessage({event:"WalletLinkUpdate",data:{session:i.getSession()}}),await i.handshake(),e.postMessage({event:"WalletLinkUpdate",data:{connected:!0}})}let i1=`Coinbase Wallet SDK requires the Cross-Origin-Opener-Policy header to not be set to 'same-origin'. This is to ensure that the SDK can communicate with the Coinbase Smart Wallet app.

Please see https://www.smartwallet.dev/guides/tips/popup-tips#cross-origin-opener-policy for more information.`,{checkCrossOriginOpenerPolicy:i2,getCrossOriginOpenerPolicy:i3}={getCrossOriginOpenerPolicy:()=>void 0===h?"undefined":h,checkCrossOriginOpenerPolicy:async()=>{if("undefined"==typeof window){h="non-browser-env";return}try{let e=`${window.location.origin}${window.location.pathname}`,t=await fetch(e,{method:"HEAD"});if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let r=t.headers.get("Cross-Origin-Opener-Policy");h=null!=r?r:"null","same-origin"===h&&console.error(i1)}catch(e){console.error("Error checking Cross-Origin-Opener-Policy:",e.message),h="error"}}},i5={isRed:!1,info:"Retry",svgWidth:"10",svgHeight:"11",path:iF,defaultFillRule:"evenodd",defaultClipRule:"evenodd"},i8=null;class i6{constructor({url:e="https://keys.coinbase.com/connect",metadata:t,preference:r}){this.popup=null,this.listeners=new Map,this.postMessage=async e=>{(await this.waitForPopupLoaded()).postMessage(e,this.url.origin)},this.postRequestAndWaitForResponse=async e=>{let t=this.onMessage(({requestId:t})=>t===e.id);return this.postMessage(e),await t},this.onMessage=async e=>new Promise((t,r)=>{let i=r=>{if(r.origin!==this.url.origin)return;let n=r.data;e(n)&&(t(n),window.removeEventListener("message",i),this.listeners.delete(i))};window.addEventListener("message",i),this.listeners.set(i,{reject:r})}),this.disconnect=()=>{var e;(e=this.popup)&&!e.closed&&e.close(),this.popup=null,this.listeners.forEach(({reject:e},t)=>{e(rO("Request rejected")),window.removeEventListener("message",t)}),this.listeners.clear()},this.waitForPopupLoaded=async()=>this.popup&&!this.popup.closed?(this.popup.focus(),this.popup):(this.popup=await function(e){let t=(window.innerWidth-420)/2+window.screenX,r=(window.innerHeight-540)/2+window.screenY;function i(){let i=`wallet_${crypto.randomUUID()}`,n=window.open(e,i,`width=420, height=540, left=${t}, top=${r}`);return(null==n||n.focus(),n)?n:null}var n=e;for(let[e,t]of Object.entries({sdkName:iu,sdkVersion:id,origin:window.location.origin,coop:i3()}))n.searchParams.append(e,t.toString());let s=i();if(!s){let e=function(){if(!i8){let e=document.createElement("div");e.className="-cbwsdk-css-reset",document.body.appendChild(e),(i8=new iL).attach(e)}return i8}();return new Promise((t,r)=>{e.presentItem({autoExpand:!0,message:"Popup was blocked. Try again.",menuItems:[Object.assign(Object.assign({},i5),{onClick:()=>{(s=i())?t(s):r(rP("Popup window was blocked")),e.clear()}})]})})}return Promise.resolve(s)}(this.url),this.onMessage(({event:e})=>"PopupUnload"===e).then(this.disconnect).catch(()=>{}),this.onMessage(({event:e})=>"PopupLoaded"===e).then(e=>{this.postMessage({requestId:e.id,data:{version:id,metadata:this.metadata,preference:this.preference,location:window.location.toString()}})}).then(()=>{if(!this.popup)throw rP();return this.popup})),this.url=new URL(e),this.metadata=t,this.preference=r}}var i4=e.i(684761);class i7 extends i4.EventEmitter{}var i9=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r};class ne extends i7{constructor(e){var{metadata:t}=e,r=e.preference,{keysUrl:i}=r,n=i9(r,["keysUrl"]);super(),this.signer=null,this.isCoinbaseWallet=!0,this.metadata=t,this.preference=n,this.communicator=new i6({url:i,metadata:t,preference:n});const s=iQ.getItem(iY);s&&(this.signer=this.initSigner(s))}async request(e){try{if(!function(e){if(!e||"object"!=typeof e||Array.isArray(e))throw rC({message:"Expected a single, non-array, object argument.",data:e});let{method:t,params:r}=e;if("string"!=typeof t||0===t.length)throw rC({message:"'args.method' must be a non-empty string.",data:e});if(void 0!==r&&!Array.isArray(r)&&("object"!=typeof r||null===r))throw rC({message:"'args.params' must be an object or array if provided.",data:e});switch(t){case"eth_sign":case"eth_signTypedData_v2":case"eth_subscribe":case"eth_unsubscribe":throw rN()}}(e),!this.signer)switch(e.method){case"eth_requestAccounts":{let t=await this.requestSignerSelection(e),r=this.initSigner(t);await r.handshake(e),this.signer=r,iQ.setItem(iY,t);break}case"wallet_sendCalls":{let t=this.initSigner("scw");await t.handshake({method:"handshake"});let r=await t.request(e);return await t.cleanup(),r}case"wallet_getCallsStatus":return ih(e,"https://rpc.wallet.coinbase.com");case"net_version":return 1;case"eth_chainId":return rG(1);default:throw rR("Must call 'eth_requestAccounts' before other methods")}return await this.signer.request(e)}catch(i){let e,t,{code:r}=i;return r===rv&&this.disconnect(),Promise.reject((e=function(e,{shouldIncludeStack:t=!1}={}){var r,i;let n={};if(e&&"object"==typeof e&&!Array.isArray(e)&&rT(e,"code")&&Number.isInteger(r=e.code)&&(r_[r.toString()]||(i=r)>=-32099&&i<=-32e3))n.code=e.code,e.message&&"string"==typeof e.message?(n.message=e.message,rT(e,"data")&&(n.data=e.data)):(n.message=rI(n.code),n.data={originalError:rx(e)});else n.code=rw,n.message=rk(e,"message")?e.message:rS,n.data={originalError:rx(e)};return t&&(n.stack=rk(e,"stack")?e.stack:void 0),n}(function(e){var t;if("string"==typeof e)return{message:e,code:rw};if(iE(e)){let r=e.errorMessage,i=null!=(t=e.errorCode)?t:r.match(/(denied|rejected)/i)?rb:void 0;return Object.assign(Object.assign({},e),{message:r,code:i,data:{method:e.method}})}return e}(i),{shouldIncludeStack:!0}),(t=new URL("https://docs.cloud.coinbase.com/wallet-sdk/docs/errors")).searchParams.set("version",id),t.searchParams.set("code",e.code.toString()),t.searchParams.set("message",e.message),Object.assign(Object.assign({},e),{docUrl:t.href})))}}async enable(){return console.warn('.enable() has been deprecated. Please use .request({ method: "eth_requestAccounts" }) instead.'),await this.request({method:"eth_requestAccounts"})}async disconnect(){var e;await (null==(e=this.signer)?void 0:e.cleanup()),this.signer=null,ry.clearAll(),this.emit("disconnect",rM("User initiated disconnection"))}requestSignerSelection(e){return iX({communicator:this.communicator,preference:this.preference,metadata:this.metadata,handshakeRequest:e,callback:this.emit.bind(this)})}initSigner(e){return function(e){let{signerType:t,metadata:r,communicator:i,callback:n}=e;switch(t){case"scw":return new iw({metadata:r,callback:n,communicator:i});case"walletlink":return new iG({metadata:r,callback:n})}}({signerType:e,metadata:this.metadata,communicator:this.communicator,callback:this.emit.bind(this)})}}let nt={options:"all"};function nr(e){new ry("CBWSDK").setItem("VERSION",id),i2();let t={metadata:{appName:e.appName||"Dapp",appLogoUrl:e.appLogoUrl||"",appChainIds:e.appChainIds||[]},preference:Object.assign(nt,null!=(r=e.preference)?r:{})};var r,i=t.preference;if(i){if(!["all","smartWalletOnly","eoaOnly"].includes(i.options))throw Error(`Invalid options: ${i.options}`);if(i.attribution&&void 0!==i.attribution.auto&&void 0!==i.attribution.dataSuffix)throw Error("Attribution cannot contain both auto and dataSuffix properties")}let n=null;return{getProvider:()=>{var e;let r;return n||(n=null!=(e=function({metadata:e,preference:t}){var r,i;let{appName:n,appLogoUrl:s,appChainIds:a}=e;if("smartWalletOnly"!==t.options){let e=globalThis.coinbaseWalletExtension;if(e)return null==(r=e.setAppInfo)||r.call(e,n,s,a,t),e}let o=function(){var e,t;try{let r=globalThis;return null!=(e=r.ethereum)?e:null==(t=r.top)?void 0:t.ethereum}catch(e){return}}();if(null==o?void 0:o.isCoinbaseBrowser)return null==(i=o.setAppInfo)||i.call(o,n,s,a,t),o}(r={metadata:t.metadata,preference:t.preference}))?e:new ne(r)),n}}}var ni=e.i(617303),nn=e.i(830073),ns=e.i(840711),na=e.i(404330),no=e.i(348941),nl=e.i(638187),nc=e.i(661126),nd=e.i(928323),nu=e.i(947903);let nh="/api/v1/sessions",np="/api/v1/sessions/logout",nf="/api/v1/siwe/init",ny="/api/v1/siwe/authenticate",ng="/api/v1/siwe/link",nm="/api/v1/siwe/link_smart_wallet",nw="/api/v1/siwe/unlink",nb="/api/v1/siwe/transfer",nv="/api/v1/siws/init",nE="/api/v1/siws/authenticate",nA="/api/v1/siws/link",n_="/api/v1/siws/unlink",nS="/api/v1/siws/transfer",nI="/api/v1/farcaster/init",nx="/api/v1/farcaster/authenticate",nT="/api/v1/farcaster/link",nk="/api/v1/farcaster/status",nC="/api/v1/farcaster/unlink",nP="/api/v1/farcaster/transfer",nO="/api/v1/passwordless/init",nR="/api/v1/passwordless/authenticate",nN="/api/v1/passwordless/link",nM="/api/v1/passwordless/unlink",nU="/api/v1/passwordless/update",nD="/api/v1/passwordless/transfer",nj="/api/v1/passwordless_sms/init",nL="/api/v1/passwordless_sms/link",nB="/api/v1/passwordless_sms/unlink",nW="/api/v1/passwordless_sms/authenticate",nF="/api/v1/passwordless_sms/update",nz="/api/v1/passwordless_sms/transfer",nq="/api/v1/oauth/init",nH="/api/v1/oauth/authenticate",nK="/api/v1/oauth/link",n$="/api/v1/oauth/unlink",nV="/api/v1/oauth/transfer",nJ="/api/v1/passkeys/link/init",nZ="/api/v1/passkeys/authenticate/init",nG="/api/v1/passkeys/register/init",nY="/api/v1/passkeys/link",nQ="/api/v1/passkeys/authenticate",nX="/api/v1/passkeys/register",n0="/api/v1/telegram/authenticate",n1="/api/v1/telegram/link",n2="/api/v1/telegram/unlink",n3="/api/v1/telegram/transfer",n5="/api/v1/mfa/passwordless_sms/init",n8="/api/v1/mfa/passkeys/init",n6="/api/v1/users/me/accept_terms",n4="/api/v1/analytics_events",n7="/api/v1/custom_jwt_account/authenticate",n9="/api/v1/custom_jwt_account/link",se="/api/v1/guest/authenticate",st="/api/v1/plugins/moonpay_on_ramp/sign",sr="/api/v1/funding/coinbase_on_ramp/init",si="/api/v1/funding/coinbase_on_ramp/status",sn="/api/v1/wallets/revoke",ss="/api/v1/users/me",sa="/api/v1/scan/transaction";e.s(["$",()=>nb,"A",()=>np,"B",()=>n4,"C",()=>se,"D",()=>n5,"E",()=>n8,"F",()=>n6,"G",()=>nM,"H",()=>nB,"I",()=>nw,"J",()=>n_,"K",()=>n$,"L",()=>nC,"M",()=>n2,"N",()=>sn,"O",()=>st,"P",()=>sr,"Q",()=>si,"R",()=>nf,"S",()=>ny,"T",()=>ng,"U",()=>nm,"V",()=>nv,"W",()=>nE,"X",()=>nV,"Y",()=>nS,"Z",()=>n3,"_",()=>nP,"a",()=>nN,"a0",()=>nz,"a1",()=>nD,"a2",()=>nA,"a3",()=>ss,"a4",()=>sa,"a5",()=>"api/v2/farcaster/init","a6",()=>"api/v2/farcaster/authenticate","a8",()=>"/api/v1/recovery/oauth/authenticate","a9",()=>"/api/v1/recovery/oauth/init_icloud","aa",()=>"/api/v1/recovery/oauth/init","b",()=>nO,"c",()=>nT,"d",()=>nI,"e",()=>nk,"f",()=>nx,"g",()=>nK,"h",()=>nq,"i",()=>nX,"j",()=>nQ,"k",()=>nY,"l",()=>nG,"m",()=>nZ,"n",()=>nJ,"o",()=>nH,"p",()=>nR,"q",()=>nW,"r",()=>nL,"s",()=>nj,"t",()=>nF,"u",()=>nU,"v",()=>n0,"w",()=>n1,"x",()=>n7,"y",()=>n9,"z",()=>nh],509876);var so=e.i(533841),sl=e.i(891548),sc=e.i(986350),sd=e.i(605572),su=e.i(227387);function sh(e){"function"==typeof queueMicrotask?queueMicrotask(e):Promise.resolve().then(e).catch(e=>setTimeout(()=>{throw e}))}function sp(){let e=[],t={addEventListener:(e,r,i,n)=>(e.addEventListener(r,i,n),t.add(()=>e.removeEventListener(r,i,n))),requestAnimationFrame(...e){let r=requestAnimationFrame(...e);return t.add(()=>cancelAnimationFrame(r))},nextFrame:(...e)=>t.requestAnimationFrame(()=>t.requestAnimationFrame(...e)),setTimeout(...e){let r=setTimeout(...e);return t.add(()=>clearTimeout(r))},microTask(...e){let r={current:!0};return sh(()=>{r.current&&e[0]()}),t.add(()=>{r.current=!1})},style(e,t,r){let i=e.style.getPropertyValue(t);return Object.assign(e.style,{[t]:r}),this.add(()=>{Object.assign(e.style,{[t]:i})})},group(e){let t=sp();return e(t),this.add(()=>t.dispose())},add:t=>(e.includes(t)||e.push(t),()=>{let r=e.indexOf(t);if(r>=0)for(let t of e.splice(r,1))t()}),dispose(){for(let t of e.splice(0))t()}};return t}function sf(){let[e]=(0,W.useState)(sp);return(0,W.useEffect)(()=>()=>e.dispose(),[e]),e}e.s(["disposables",()=>sp],720377),e.s(["useDisposables",()=>sf],661417);var sy=Object.defineProperty,sg=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?sy(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let sm=new class{constructor(){sg(this,"current",this.detect()),sg(this,"handoffState","pending"),sg(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"undefined"==typeof window||"undefined"==typeof document?"server":"client"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}},sw=(e,t)=>{sm.isServer?(0,W.useEffect)(e,t):(0,W.useLayoutEffect)(e,t)};function sb(e){let t=(0,W.useRef)(e);return sw(()=>{t.current=e},[e]),t}e.s(["useIsoMorphicEffect",()=>sw],715232);let sv=function(e){let t=sb(e);return W.default.useCallback((...e)=>t.current(...e),[t])};function sE(){let e=(0,W.useRef)(!1);return sw(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function sA(){let e,t=(e="undefined"==typeof document,"useSyncExternalStore"in W&&(0,W.useSyncExternalStore)(()=>()=>{},()=>!1,()=>!e)),[r,i]=W.useState(sm.isHandoffComplete);return r&&!1===sm.isHandoffComplete&&i(!1),W.useEffect(()=>{!0!==r&&i(!0)},[r]),W.useEffect(()=>sm.handoff(),[]),!t&&r}e.s(["useEvent",()=>sv],360178);let s_=Symbol();function sS(e,t=!0){return Object.assign(e,{[s_]:t})}function sI(...e){let t=(0,W.useRef)(e);(0,W.useEffect)(()=>{t.current=e},[e]);let r=sv(e=>{for(let r of t.current)null!=r&&("function"==typeof r?r(e):r.current=e)});return e.every(e=>null==e||(null==e?void 0:e[s_]))?void 0:r}e.s(["optionalRef",()=>sS,"useSyncRefs",()=>sI],889313);var sx=e.i(427217);void 0!==sx.default&&"undefined"!=typeof globalThis&&"undefined"!=typeof Element&&(null==(C$=null==sx.default?void 0:sx.default.env)?void 0:C$.NODE_ENV)==="test"&&void 0===(null==(CV=null==Element?void 0:Element.prototype)?void 0:CV.getAnimations)&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var sT=((p=sT||{})[p.None=0]="None",p[p.Closed=1]="Closed",p[p.Enter=2]="Enter",p[p.Leave=4]="Leave",p);function sk(e){let t={};for(let r in e)!0===e[r]&&(t[`data-${r}`]="");return t}function sC(e,t,r,i){let[n,s]=(0,W.useState)(r),{hasFlag:a,addFlag:o,removeFlag:l}=function(e=0){let[t,r]=(0,W.useState)(e),i=(0,W.useCallback)(e=>r(e),[]),n=(0,W.useCallback)(e=>r(t=>t|e),[]),s=(0,W.useCallback)(e=>(t&e)===e,[t]);return{flags:t,setFlag:i,addFlag:n,hasFlag:s,removeFlag:(0,W.useCallback)(e=>r(t=>t&~e),[]),toggleFlag:(0,W.useCallback)(e=>r(t=>t^e),[])}}(e&&n?3:0),c=(0,W.useRef)(!1),d=(0,W.useRef)(!1);return sw(()=>{var n;if(e){if(r&&s(!0),!t){r&&o(3);return}return null==(n=null==i?void 0:i.start)||n.call(i,r),function(e,{prepare:t,run:r,done:i,inFlight:n}){let s=sp();return function(e,{inFlight:t,prepare:r}){if(null!=t&&t.current)return r();let i=e.style.transition;e.style.transition="none",r(),e.offsetHeight,e.style.transition=i}(e,{prepare:t,inFlight:n}),s.nextFrame(()=>{r(),s.requestAnimationFrame(()=>{s.add(function(e,t){var r,i;let n=sp();if(!e)return n.dispose;let s=!1;n.add(()=>{s=!0});let a=null!=(i=null==(r=e.getAnimations)?void 0:r.call(e).filter(e=>e instanceof CSSTransition))?i:[];return 0===a.length?t():Promise.allSettled(a.map(e=>e.finished)).then(()=>{s||t()}),n.dispose}(e,i))})}),s.dispose}(t,{inFlight:c,prepare(){d.current?d.current=!1:d.current=c.current,c.current=!0,d.current||(r?(o(3),l(4)):(o(4),l(2)))},run(){d.current?r?(l(3),o(4)):(l(4),o(3)):r?l(1):o(1)},done(){var e,n,a,o;d.current&&(null!=(o=null==(a=(n=t).getAnimations)?void 0:a.call(n))?o:[]).some(e=>e instanceof CSSTransition&&"finished"!==e.playState)||(c.current=!1,l(7),r||s(!1),null==(e=null==i?void 0:i.end)||e.call(i,r))}})}},[e,r,t,sf()]),e?[n,{closed:a(1),enter:a(2),leave:a(4),transition:a(2)||a(4)}]:[r,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}e.s(["transitionDataAttributes",()=>sk,"useTransition",()=>sC],338113);let sP=(0,W.createContext)(null);sP.displayName="OpenClosedContext";var sO=((f=sO||{})[f.Open=1]="Open",f[f.Closed=2]="Closed",f[f.Closing=4]="Closing",f[f.Opening=8]="Opening",f);function sR(){return(0,W.useContext)(sP)}function sN({value:e,children:t}){return W.default.createElement(sP.Provider,{value:e},t)}function sM({children:e}){return W.default.createElement(sP.Provider,{value:null},e)}function sU(...e){return Array.from(new Set(e.flatMap(e=>"string"==typeof e?e.split(" "):[]))).filter(Boolean).join(" ")}function sD(e,t,...r){if(e in t){let i=t[e];return"function"==typeof i?i(...r):i}let i=Error(`Tried to handle "${e}" but there is no handler defined. Only defined handlers are: ${Object.keys(t).map(e=>`"${e}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,sD),i}e.s(["OpenClosedProvider",()=>sN,"ResetOpenClosedProvider",()=>sM,"State",()=>sO,"useOpenClosed",()=>sR],648308),e.s(["match",()=>sD],482469);var sj=((y=sj||{})[y.None=0]="None",y[y.RenderStrategy=1]="RenderStrategy",y[y.Static=2]="Static",y),sL=((g=sL||{})[g.Unmount=0]="Unmount",g[g.Hidden=1]="Hidden",g);function sB(){let e,t,r=(e=(0,W.useRef)([]),t=(0,W.useCallback)(t=>{for(let r of e.current)null!=r&&("function"==typeof r?r(t):r.current=t)},[]),(...r)=>{if(!r.every(e=>null==e))return e.current=r,t});return(0,W.useCallback)(e=>(function({ourProps:e,theirProps:t,slot:r,defaultTag:i,features:n,visible:s=!0,name:a,mergeRefs:o}){o=null!=o?o:sF;let l=sz(t,e);if(s)return sW(l,r,i,a,o);let c=null!=n?n:0;if(2&c){let{static:e=!1,...t}=l;if(e)return sW(t,r,i,a,o)}if(1&c){let{unmount:e=!0,...t}=l;return sD(+!e,{0:()=>null,1:()=>sW({...t,hidden:!0,style:{display:"none"}},r,i,a,o)})}return sW(l,r,i,a,o)})({mergeRefs:r,...e}),[r])}function sW(e,t={},r,i,n){let{as:s=r,children:a,refName:o="ref",...l}=s$(e,["unmount","static"]),c=void 0!==e.ref?{[o]:e.ref}:{},d="function"==typeof a?a(t):a;"className"in l&&l.className&&"function"==typeof l.className&&(l.className=l.className(t)),l["aria-labelledby"]&&l["aria-labelledby"]===l.id&&(l["aria-labelledby"]=void 0);let u={};if(t){let e=!1,r=[];for(let[i,n]of Object.entries(t))"boolean"==typeof n&&(e=!0),!0===n&&r.push(i.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`));if(e)for(let e of(u["data-headlessui-state"]=r.join(" "),r))u[`data-${e}`]=""}if(sV(s)&&(Object.keys(sK(l)).length>0||Object.keys(sK(u)).length>0))if(!(0,W.isValidElement)(d)||Array.isArray(d)&&d.length>1||sV(d.type)){if(Object.keys(sK(l)).length>0)throw Error(['Passing props on "Fragment"!',"",`The current component <${i} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(sK(l)).concat(Object.keys(sK(u))).map(e=>`  - ${e}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(e=>`  - ${e}`).join(`
`)].join(`
`))}else{var h;let e=d.props,t=null==e?void 0:e.className,r="function"==typeof t?(...e)=>sU(t(...e),l.className):sU(t,l.className),i=sz(d.props,sK(s$(l,["ref"])));for(let e in u)e in i&&delete u[e];return(0,W.cloneElement)(d,Object.assign({},i,u,c,{ref:n((h=d,W.default.version.split(".")[0]>="19"?h.props.ref:h.ref),c.ref)},r?{className:r}:{}))}return(0,W.createElement)(s,Object.assign({},s$(l,["ref"]),!sV(s)&&c,!sV(s)&&u),d)}function sF(...e){return e.every(e=>null==e)?void 0:t=>{for(let r of e)null!=r&&("function"==typeof r?r(t):r.current=t)}}function sz(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let i of e)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=r[e]||(r[e]=[]),r[e].push(i[e])):t[e]=i[e];if(t.disabled||t["aria-disabled"])for(let e in r)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(e)&&(r[e]=[e=>{var t;return null==(t=null==e?void 0:e.preventDefault)?void 0:t.call(e)}]);for(let e in r)Object.assign(t,{[e](t,...i){for(let n of r[e]){if((t instanceof Event||(null==t?void 0:t.nativeEvent)instanceof Event)&&t.defaultPrevented)return;n(t,...i)}}});return t}function sq(...e){if(0===e.length)return{};if(1===e.length)return e[0];let t={},r={};for(let i of e)for(let e in i)e.startsWith("on")&&"function"==typeof i[e]?(null!=r[e]||(r[e]=[]),r[e].push(i[e])):t[e]=i[e];for(let e in r)Object.assign(t,{[e](...t){for(let i of r[e])null==i||i(...t)}});return t}function sH(e){var t;return Object.assign((0,W.forwardRef)(e),{displayName:null!=(t=e.displayName)?t:e.name})}function sK(e){let t=Object.assign({},e);for(let e in t)void 0===t[e]&&delete t[e];return t}function s$(e,t=[]){let r=Object.assign({},e);for(let e of t)e in r&&delete r[e];return r}function sV(e){return e===W.Fragment||e===Symbol.for("react.fragment")}function sJ(e){var t;return!!(e.enter||e.enterFrom||e.enterTo||e.leave||e.leaveFrom||e.leaveTo)||!sV(null!=(t=e.as)?t:s0)||1===W.default.Children.count(e.children)}e.s(["RenderFeatures",()=>sj,"RenderStrategy",()=>sL,"compact",()=>sK,"forwardRefWithAs",()=>sH,"isFragment",()=>sV,"mergeProps",()=>sq,"useRender",()=>sB],893168);let sZ=(0,W.createContext)(null);sZ.displayName="TransitionContext";var sG=((m=sG||{}).Visible="visible",m.Hidden="hidden",m);let sY=(0,W.createContext)(null);function sQ(e){return"children"in e?sQ(e.children):e.current.filter(({el:e})=>null!==e.current).filter(({state:e})=>"visible"===e).length>0}function sX(e,t){let r=sb(e),i=(0,W.useRef)([]),n=sE(),s=sf(),a=sv((e,t=sL.Hidden)=>{let a=i.current.findIndex(({el:t})=>t===e);-1!==a&&(sD(t,{[sL.Unmount](){i.current.splice(a,1)},[sL.Hidden](){i.current[a].state="hidden"}}),s.microTask(()=>{var e;!sQ(i)&&n.current&&(null==(e=r.current)||e.call(r))}))}),o=sv(e=>{let t=i.current.find(({el:t})=>t===e);return t?"visible"!==t.state&&(t.state="visible"):i.current.push({el:e,state:"visible"}),()=>a(e,sL.Unmount)}),l=(0,W.useRef)([]),c=(0,W.useRef)(Promise.resolve()),d=(0,W.useRef)({enter:[],leave:[]}),u=sv((e,r,i)=>{l.current.splice(0),t&&(t.chains.current[r]=t.chains.current[r].filter(([t])=>t!==e)),null==t||t.chains.current[r].push([e,new Promise(e=>{l.current.push(e)})]),null==t||t.chains.current[r].push([e,new Promise(e=>{Promise.all(d.current[r].map(([e,t])=>t)).then(()=>e())})]),"enter"===r?c.current=c.current.then(()=>null==t?void 0:t.wait.current).then(()=>i(r)):i(r)}),h=sv((e,t,r)=>{Promise.all(d.current[t].splice(0).map(([e,t])=>t)).then(()=>{var e;null==(e=l.current.shift())||e()}).then(()=>r(t))});return(0,W.useMemo)(()=>({children:i,register:o,unregister:a,onStart:u,onStop:h,wait:c,chains:d}),[o,a,i,u,h,d,c])}sY.displayName="NestingContext";let s0=W.Fragment,s1=sj.RenderStrategy,s2=sH(function(e,t){let{show:r,appear:i=!1,unmount:n=!0,...s}=e,a=(0,W.useRef)(null),o=sI(...sJ(e)?[a,t]:null===t?[]:[t]);sA();let l=sR();if(void 0===r&&null!==l&&(r=(l&sO.Open)===sO.Open),void 0===r)throw Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[c,d]=(0,W.useState)(r?"visible":"hidden"),u=sX(()=>{r||d("hidden")}),[h,p]=(0,W.useState)(!0),f=(0,W.useRef)([r]);sw(()=>{!1!==h&&f.current[f.current.length-1]!==r&&(f.current.push(r),p(!1))},[f,r]);let y=(0,W.useMemo)(()=>({show:r,appear:i,initial:h}),[r,i,h]);sw(()=>{r?d("visible"):sQ(u)||null===a.current||d("hidden")},[r,u]);let g={unmount:n},m=sv(()=>{var t;h&&p(!1),null==(t=e.beforeEnter)||t.call(e)}),w=sv(()=>{var t;h&&p(!1),null==(t=e.beforeLeave)||t.call(e)}),b=sB();return W.default.createElement(sY.Provider,{value:u},W.default.createElement(sZ.Provider,{value:y},b({ourProps:{...g,as:W.Fragment,children:W.default.createElement(s3,{ref:o,...g,...s,beforeEnter:m,beforeLeave:w})},theirProps:{},defaultTag:W.Fragment,features:s1,visible:"visible"===c,name:"Transition"})))}),s3=sH(function(e,t){var r,i;let{transition:n=!0,beforeEnter:s,afterEnter:a,beforeLeave:o,afterLeave:l,enter:c,enterFrom:d,enterTo:u,entered:h,leave:p,leaveFrom:f,leaveTo:y,...g}=e,[m,w]=(0,W.useState)(null),b=(0,W.useRef)(null),v=sJ(e),E=sI(...v?[b,t,w]:null===t?[]:[t]),A=null==(r=g.unmount)||r?sL.Unmount:sL.Hidden,{show:_,appear:S,initial:I}=function(){let e=(0,W.useContext)(sZ);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),[x,T]=(0,W.useState)(_?"visible":"hidden"),k=function(){let e=(0,W.useContext)(sY);if(null===e)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return e}(),{register:C,unregister:P}=k;sw(()=>C(b),[C,b]),sw(()=>{if(A===sL.Hidden&&b.current)return _&&"visible"!==x?void T("visible"):sD(x,{hidden:()=>P(b),visible:()=>C(b)})},[x,b,C,P,_,A]);let O=sA();sw(()=>{if(v&&O&&"visible"===x&&null===b.current)throw Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[b,x,O,v]);let R=I&&!S,N=S&&_&&I,M=(0,W.useRef)(!1),U=sX(()=>{M.current||(T("hidden"),P(b))},k),D=sv(e=>{M.current=!0,U.onStart(b,e?"enter":"leave",e=>{"enter"===e?null==s||s():"leave"===e&&(null==o||o())})}),j=sv(e=>{let t=e?"enter":"leave";M.current=!1,U.onStop(b,t,e=>{"enter"===e?null==a||a():"leave"===e&&(null==l||l())}),"leave"!==t||sQ(U)||(T("hidden"),P(b))});(0,W.useEffect)(()=>{v&&n||(D(_),j(_))},[_,v,n]);let[,L]=sC(!(!n||!v||!O||R),m,_,{start:D,end:j}),B=sK({ref:E,className:(null==(i=sU(g.className,N&&c,N&&d,L.enter&&c,L.enter&&L.closed&&d,L.enter&&!L.closed&&u,L.leave&&p,L.leave&&!L.closed&&f,L.leave&&L.closed&&y,!L.transition&&_&&h))?void 0:i.trim())||void 0,...sk(L)}),F=0;"visible"===x&&(F|=sO.Open),"hidden"===x&&(F|=sO.Closed),_&&"hidden"===x&&(F|=sO.Opening),_||"visible"!==x||(F|=sO.Closing);let z=sB();return W.default.createElement(sY.Provider,{value:U},W.default.createElement(sN,{value:F},z({ourProps:B,theirProps:g,defaultTag:s0,features:s1,visible:"visible"===x,name:"Transition.Child"})))}),s5=sH(function(e,t){let r=null!==(0,W.useContext)(sZ),i=null!==sR();return W.default.createElement(W.default.Fragment,null,!r&&i?W.default.createElement(s2,{ref:t,...e}):W.default.createElement(s3,{ref:t,...e}))}),s8=Object.assign(s2,{Child:s5,Root:s2});var s6=((w=s6||{}).Space=" ",w.Enter="Enter",w.Escape="Escape",w.Backspace="Backspace",w.Delete="Delete",w.ArrowLeft="ArrowLeft",w.ArrowUp="ArrowUp",w.ArrowRight="ArrowRight",w.ArrowDown="ArrowDown",w.Home="Home",w.End="End",w.PageUp="PageUp",w.PageDown="PageDown",w.Tab="Tab",w);function s4(e,t,r,i){let n=sb(r);(0,W.useEffect)(()=>{function r(e){n.current(e)}return(e=null!=e?e:window).addEventListener(t,r,i),()=>e.removeEventListener(t,r,i)},[e,t,i])}e.s(["Keys",()=>s6],701368);class s7 extends Map{constructor(e){super(),this.factory=e}get(e){let t=super.get(e);return void 0===t&&(t=this.factory(e),this.set(e,t)),t}}var s9=Object.defineProperty,ae=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},at=(e,t,r)=>(ae(e,t,"read from private field"),r?r.call(e):t.get(e)),ar=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},ai=(e,t,r,i)=>(ae(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r);class an{constructor(e){ar(this,CJ,{}),ar(this,CZ,new s7(()=>new Set)),ar(this,CG,new Set),((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?s9(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"disposables",sp()),ai(this,CJ,e),sm.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return at(this,CJ)}subscribe(e,t){if(sm.isServer)return()=>{};let r={selector:e,callback:t,current:e(at(this,CJ))};return at(this,CG).add(r),this.disposables.add(()=>{at(this,CG).delete(r)})}on(e,t){return sm.isServer?()=>{}:(at(this,CZ).get(e).add(t),this.disposables.add(()=>{at(this,CZ).get(e).delete(t)}))}send(e){let t=this.reduce(at(this,CJ),e);if(t!==at(this,CJ)){for(let e of(ai(this,CJ,t),at(this,CG))){let t=e.selector(at(this,CJ));as(e.current,t)||(e.current=t,e.callback(t))}for(let t of at(this,CZ).get(e.type))t(at(this,CJ),e)}}}function as(e,t){return!!Object.is(e,t)||"object"==typeof e&&null!==e&&"object"==typeof t&&null!==t&&(Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&aa(e[Symbol.iterator](),t[Symbol.iterator]()):e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set?e.size===t.size&&aa(e.entries(),t.entries()):!!(ao(e)&&ao(t))&&aa(Object.entries(e)[Symbol.iterator](),Object.entries(t)[Symbol.iterator]()))}function aa(e,t){for(;;){let r=e.next(),i=t.next();if(r.done&&i.done)return!0;if(r.done||i.done||!Object.is(r.value,i.value))return!1}}function ao(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);return null===t||null===Object.getPrototypeOf(t)}function al(e){let[t,r]=e(),i=sp();return(...e)=>{t(...e),i.dispose(),i.microTask(r)}}CJ=new WeakMap,CZ=new WeakMap,CG=new WeakMap,e.s(["Machine",()=>an,"batch",()=>al,"shallowEqual",()=>as],47690);var ac=Object.defineProperty,ad=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?ac(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r},au=((b=au||{})[b.Push=0]="Push",b[b.Pop=1]="Pop",b);let ah={0(e,t){let r=t.id,i=e.stack,n=e.stack.indexOf(r);if(-1!==n){let t=e.stack.slice();return t.splice(n,1),t.push(r),i=t,{...e,stack:i}}return{...e,stack:[...e.stack,r]}},1(e,t){let r=t.id,i=e.stack.indexOf(r);if(-1===i)return e;let n=e.stack.slice();return n.splice(i,1),{...e,stack:n}}};class ap extends an{constructor(){super(...arguments),ad(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),ad(this,"selectors",{isTop:(e,t)=>e.stack[e.stack.length-1]===t,inStack:(e,t)=>e.stack.includes(t)})}static new(){return new ap({stack:[]})}reduce(e,t){return sD(t.type,ah,e,t)}}let af=new s7(()=>ap.new());e.s(["ActionTypes",()=>au,"stackMachines",()=>af],556676);var ay=e.i(726277);function ag(e,t,r=as){return(0,ay.useSyncExternalStoreWithSelector)(sv(t=>e.subscribe(am,t)),sv(()=>e.state),sv(()=>e.state),sv(t),r)}function am(e){return e}function aw(e,t){let r=(0,W.useId)(),i=af.get(t),[n,s]=ag(i,(0,W.useCallback)(e=>[i.selectors.isTop(e,r),i.selectors.inStack(e,r)],[i,r]));return sw(()=>{if(e)return i.actions.push(r),()=>i.actions.pop(r)},[i,e,r]),!!e&&(!s||n)}function ab(e){var t;return sm.isServer?null:null==e?document:null!=(t=null==e?void 0:e.ownerDocument)?t:document}function av(e){var t,r;return sm.isServer?null:null==e?document:null!=(r=null==(t=null==e?void 0:e.getRootNode)?void 0:t.call(e))?r:document}function aE(e){var t,r;return null!=(r=null==(t=av(e))?void 0:t.activeElement)?r:null}function aA(e){return aE(e)===e}e.s(["useSlice",()=>ag],447579),e.s(["getActiveElement",()=>aE,"getOwnerDocument",()=>ab,"getRootNode",()=>av,"isActiveElement",()=>aA],154336);let a_=new Map,aS=new Map;function aI(e){var t;let r=null!=(t=aS.get(e))?t:0;return aS.set(e,r+1),0!==r||(a_.set(e,{"aria-hidden":e.getAttribute("aria-hidden"),inert:e.inert}),e.setAttribute("aria-hidden","true"),e.inert=!0),()=>(function(e){var t;let r=null!=(t=aS.get(e))?t:1;if(1===r?aS.delete(e):aS.set(e,r-1),1!==r)return;let i=a_.get(e);i&&(null===i["aria-hidden"]?e.removeAttribute("aria-hidden"):e.setAttribute("aria-hidden",i["aria-hidden"]),e.inert=i.inert,a_.delete(e))})(e)}function ax(e,{allowed:t,disallowed:r}={}){let i=aw(e,"inert-others");sw(()=>{var e,n;if(!i)return;let s=sp();for(let t of null!=(e=null==r?void 0:r())?e:[])t&&s.add(aI(t));let a=null!=(n=null==t?void 0:t())?n:[];for(let e of a){if(!e)continue;let t=ab(e);if(!t)continue;let r=e.parentElement;for(;r&&r!==t.body;){for(let e of r.children)a.some(t=>e.contains(t))||s.add(aI(e));r=r.parentElement}}return s.dispose},[i,t,r])}function aT(e){return"object"==typeof e&&null!==e&&"nodeType"in e}function ak(e){return aT(e)&&"tagName"in e}function aC(e){return ak(e)&&"accessKey"in e}function aP(e){return ak(e)&&"tabIndex"in e}function aO(e){return ak(e)&&"style"in e}function aR(e){return aC(e)&&"IFRAME"===e.nodeName}function aN(e){return aC(e)&&"INPUT"===e.nodeName}function aM(e){return aC(e)&&"LABEL"===e.nodeName}function aU(e){return aC(e)&&"FIELDSET"===e.nodeName}function aD(e){return aC(e)&&"LEGEND"===e.nodeName}function aj(e){return!!ak(e)&&e.matches('a[href],audio[controls],button,details,embed,iframe,img[usemap],input:not([type="hidden"]),label,select,textarea,video[controls]')}function aL(e,t,r){let i=sb(e=>{let t=e.getBoundingClientRect();0===t.x&&0===t.y&&0===t.width&&0===t.height&&r()});(0,W.useEffect)(()=>{if(!e)return;let r=null===t?null:aC(t)?t:t.current;if(!r)return;let n=sp();if("undefined"!=typeof ResizeObserver){let e=new ResizeObserver(()=>i.current(r));e.observe(r),n.add(()=>e.disconnect())}if("undefined"!=typeof IntersectionObserver){let e=new IntersectionObserver(()=>i.current(r));e.observe(r),n.add(()=>e.disconnect())}return()=>n.dispose()},[t,i,e])}e.s(["useInertOthers",()=>ax],2356),e.s(["hasInlineStyle",()=>aO,"isElement",()=>ak,"isHTMLElement",()=>aC,"isHTMLFieldSetElement",()=>aU,"isHTMLIframeElement",()=>aR,"isHTMLInputElement",()=>aN,"isHTMLLabelElement",()=>aM,"isHTMLLegendElement",()=>aD,"isHTMLorSVGElement",()=>aP,"isInteractiveElement",()=>aj,"isNode",()=>aT],181584),e.s(["useOnDisappear",()=>aL],538203);let aB=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(e=>`${e}:not([tabindex='-1'])`).join(","),aW=["[data-autofocus]"].map(e=>`${e}:not([tabindex='-1'])`).join(",");var aF=((v=aF||{})[v.First=1]="First",v[v.Previous=2]="Previous",v[v.Next=4]="Next",v[v.Last=8]="Last",v[v.WrapAround=16]="WrapAround",v[v.NoScroll=32]="NoScroll",v[v.AutoFocus=64]="AutoFocus",v),az=((E=az||{})[E.Error=0]="Error",E[E.Overflow=1]="Overflow",E[E.Success=2]="Success",E[E.Underflow=3]="Underflow",E),aq=((A=aq||{})[A.Previous=-1]="Previous",A[A.Next=1]="Next",A);function aH(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(aB)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}var aK=((_=aK||{})[_.Strict=0]="Strict",_[_.Loose=1]="Loose",_);function a$(e,t=0){var r;return e!==(null==(r=ab(e))?void 0:r.body)&&sD(t,{0:()=>e.matches(aB),1(){let t=e;for(;null!==t;){if(t.matches(aB))return!0;t=t.parentElement}return!1}})}function aV(e){sp().nextFrame(()=>{let t=aE(e);t&&aP(t)&&!a$(t,0)&&aZ(e)})}var aJ=((S=aJ||{})[S.Keyboard=0]="Keyboard",S[S.Mouse=1]="Mouse",S);function aZ(e){null==e||e.focus({preventScroll:!0})}function aG(e,t=e=>e){return e.slice().sort((e,r)=>{let i=t(e),n=t(r);if(null===i||null===n)return 0;let s=i.compareDocumentPosition(n);return s&Node.DOCUMENT_POSITION_FOLLOWING?-1:s&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function aY(e,t,r=null===e?document.body:av(e)){return aQ(aH(r),t,{relativeTo:e})}function aQ(e,t,{sorted:r=!0,relativeTo:i=null,skipElements:n=[]}={}){var s,a,o;let l=Array.isArray(e)?e.length>0?av(e[0]):document:av(e),c=Array.isArray(e)?r?aG(e):e:64&t?function(e=document.body){return null==e?[]:Array.from(e.querySelectorAll(aW)).sort((e,t)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(t.tabIndex||Number.MAX_SAFE_INTEGER)))}(e):aH(e);n.length>0&&c.length>1&&(c=c.filter(e=>!n.some(t=>null!=t&&"current"in t?(null==t?void 0:t.current)===e:t===e))),i=null!=i?i:null==l?void 0:l.activeElement;let d=(()=>{if(5&t)return 1;if(10&t)return -1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),u=(()=>{if(1&t)return 0;if(2&t)return Math.max(0,c.indexOf(i))-1;if(4&t)return Math.max(0,c.indexOf(i))+1;if(8&t)return c.length-1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),h=32&t?{preventScroll:!0}:{},p=0,f=c.length,y;do{if(p>=f||p+f<=0)return 0;let e=u+p;if(16&t)e=(e+f)%f;else{if(e<0)return 3;if(e>=f)return 1}null==(y=c[e])||y.focus(h),p+=d}while(y!==aE(y))return 6&t&&null!=(o=null==(a=null==(s=y)?void 0:s.matches)?void 0:a.call(s,"textarea,input"))&&o&&y.select(),2}function aX(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function a0(){return aX()||/Android/gi.test(window.navigator.userAgent)}function a1(e,t,r,i){let n=sb(r);(0,W.useEffect)(()=>{if(e)return document.addEventListener(t,r,i),()=>document.removeEventListener(t,r,i);function r(e){n.current(e)}},[e,t,i])}function a2(e,t,r,i){let n=sb(r);(0,W.useEffect)(()=>{if(e)return window.addEventListener(t,r,i),()=>window.removeEventListener(t,r,i);function r(e){n.current(e)}},[e,t,i])}function a3(e,t,r){let i=sb(r),n=(0,W.useCallback)(function(e,r){if(e.defaultPrevented)return;let n=r(e);if(null!==n&&n.getRootNode().contains(n)&&n.isConnected){for(let r of function e(t){return"function"==typeof t?e(t()):Array.isArray(t)||t instanceof Set?t:[t]}(t))if(null!==r&&(r.contains(n)||e.composed&&e.composedPath().includes(r)))return;return a$(n,aK.Loose)||-1===n.tabIndex||e.preventDefault(),i.current(e,n)}},[i,t]),s=(0,W.useRef)(null);a1(e,"pointerdown",e=>{var t,r;a0()||(s.current=(null==(r=null==(t=e.composedPath)?void 0:t.call(e))?void 0:r[0])||e.target)},!0),a1(e,"pointerup",e=>{if(a0()||!s.current)return;let t=s.current;return s.current=null,n(e,()=>t)},!0);let a=(0,W.useRef)({x:0,y:0});a1(e,"touchstart",e=>{a.current.x=e.touches[0].clientX,a.current.y=e.touches[0].clientY},!0),a1(e,"touchend",e=>{let t={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY};if(!(Math.abs(t.x-a.current.x)>=30||Math.abs(t.y-a.current.y)>=30))return n(e,()=>aP(e.target)?e.target:null)},!0),a2(e,"blur",e=>n(e,()=>aR(window.document.activeElement)?window.document.activeElement:null),!0)}function a5(...e){return(0,W.useMemo)(()=>ab(...e),[...e])}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("keydown",e=>{e.metaKey||e.altKey||e.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",e=>{1===e.detail?delete document.documentElement.dataset.headlessuiFocusVisible:0===e.detail&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0)),e.s(["Focus",()=>aF,"FocusResult",()=>az,"FocusableMode",()=>aK,"focusElement",()=>aZ,"focusFrom",()=>aY,"focusIn",()=>aQ,"focusableSelector",()=>aB,"isFocusableElement",()=>a$,"restoreFocusIfNecessary",()=>aV,"sortByDomNode",()=>aG],433655),e.s(["useDocumentEvent",()=>a1],651917),e.s(["useOutsideClick",()=>a3],350617),e.s(["useOwnerDocument",()=>a5],823729);var a8=((I=a8||{})[I.None=1]="None",I[I.Focusable=2]="Focusable",I[I.Hidden=4]="Hidden",I);let a6=sH(function(e,t){var r;let{features:i=1,...n}=e,s={ref:t,"aria-hidden":(2&i)==2||(null!=(r=n["aria-hidden"])?r:void 0),hidden:(4&i)==4||void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(4&i)==4&&(2&i)!=2&&{display:"none"}}};return sB()({ourProps:s,theirProps:n,slot:{},defaultTag:"span",name:"Hidden"})}),a4=(0,W.createContext)(null);function a7({children:e,node:t}){let[r,i]=(0,W.useState)(null),n=a9(null!=t?t:r);return W.default.createElement(a4.Provider,{value:n},e,null===n&&W.default.createElement(a6,{features:a8.Hidden,ref:e=>{var t,r;if(e){for(let n of null!=(r=null==(t=ab(e))?void 0:t.querySelectorAll("html > *, body > *"))?r:[])if(n!==document.body&&n!==document.head&&ak(n)&&null!=n&&n.contains(e)){i(n);break}}}}))}function a9(e=null){var t;return null!=(t=(0,W.useContext)(a4))?t:e}function oe(e){let t={};for(let r of e)Object.assign(t,r(t));return t}let ot=(Cv=()=>new Map,CE={PUSH(e,t){var r;let i=null!=(r=this.get(e))?r:{doc:e,count:0,d:sp(),meta:new Set,computedMeta:{}};return i.count++,i.meta.add(t),i.computedMeta=oe(i.meta),this.set(e,i),this},POP(e,t){let r=this.get(e);return r&&(r.count--,r.meta.delete(t),r.computedMeta=oe(r.meta)),this},SCROLL_PREVENT(e){let t,r={doc:e.doc,d:e.d,meta:()=>e.computedMeta},i=[aX()?{before({doc:e,d:t,meta:r}){function i(e){for(let t of r().containers)for(let r of t())if(r.contains(e))return!0;return!1}t.microTask(()=>{var r;if("auto"!==window.getComputedStyle(e.documentElement).scrollBehavior){let r=sp();r.style(e.documentElement,"scrollBehavior","auto"),t.add(()=>t.microTask(()=>r.dispose()))}let n=null!=(r=window.scrollY)?r:window.pageYOffset,s=null;t.addEventListener(e,"click",t=>{if(aP(t.target))try{let r=t.target.closest("a");if(!r)return;let{hash:n}=new URL(r.href),a=e.querySelector(n);aP(a)&&!i(a)&&(s=a)}catch{}},!0),t.group(r=>{t.addEventListener(e,"touchstart",e=>{if(r.dispose(),aP(e.target)&&aO(e.target))if(i(e.target)){let t=e.target;for(;t.parentElement&&i(t.parentElement);)t=t.parentElement;r.style(t,"overscrollBehavior","contain")}else r.style(e.target,"touchAction","none")})}),t.addEventListener(e,"touchmove",e=>{if(aP(e.target)&&!aN(e.target))if(i(e.target)){let t=e.target;for(;t.parentElement&&""!==t.dataset.headlessuiPortal&&!(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth);)t=t.parentElement;""===t.dataset.headlessuiPortal&&e.preventDefault()}else e.preventDefault()},{passive:!1}),t.add(()=>{var e;n!==(null!=(e=window.scrollY)?e:window.pageYOffset)&&window.scrollTo(0,n),s&&s.isConnected&&(s.scrollIntoView({block:"nearest"}),s=null)})})}}:{},{before({doc:e}){var r;let i=e.documentElement;t=Math.max(0,(null!=(r=e.defaultView)?r:window).innerWidth-i.clientWidth)},after({doc:e,d:r}){let i=e.documentElement,n=Math.max(0,i.clientWidth-i.offsetWidth),s=Math.max(0,t-n);r.style(i,"paddingRight",`${s}px`)}},{before({doc:e,d:t}){t.style(e.documentElement,"overflow","hidden")}}];i.forEach(({before:e})=>null==e?void 0:e(r)),i.forEach(({after:e})=>null==e?void 0:e(r))},SCROLL_ALLOW({d:e}){e.dispose()},TEARDOWN({doc:e}){this.delete(e)}},x=Cv(),T=new Set,{getSnapshot:()=>x,subscribe:e=>(T.add(e),()=>T.delete(e)),dispatch(e,...t){let r=CE[e].call(x,...t);r&&(x=r,T.forEach(e=>e()))}});function or(e,t,r=()=>[document.body]){!function(e,t,r=()=>({containers:[]})){let i=(0,W.useSyncExternalStore)(ot.subscribe,ot.getSnapshot,ot.getSnapshot),n=t?i.get(t):void 0;n&&n.count,sw(()=>{if(!(!t||!e))return ot.dispatch("PUSH",t,r),()=>ot.dispatch("POP",t,r)},[e,t])}(aw(e,"scroll-lock"),t,e=>{var t;return{containers:[...null!=(t=e.containers)?t:[],r]}})}function oi(e){return(0,W.useMemo)(()=>e,Object.values(e))}ot.subscribe(()=>{let e=ot.getSnapshot(),t=new Map;for(let[r]of e)t.set(r,r.documentElement.style.overflow);for(let r of e.values()){let e="hidden"===t.get(r.doc),i=0!==r.count;(i&&!e||!i&&e)&&ot.dispatch(r.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",r),0===r.count&&ot.dispatch("TEARDOWN",r)}}),e.s(["useScrollLock",()=>or],3086),e.s(["useSlot",()=>oi],866496);let on=(0,W.createContext)(()=>{});function os({value:e,children:t}){return W.default.createElement(on.Provider,{value:e},t)}let oa=(0,W.createContext)(!1);function oo(e){return W.default.createElement(oa.Provider,{value:e.force},e.children)}let ol=(0,W.createContext)(void 0);function oc(){return(0,W.useContext)(ol)}e.s(["useDisabled",()=>oc],456234);let od=(0,W.createContext)(null);function ou(){let[e,t]=(0,W.useState)([]);return[e.length>0?e.join(" "):void 0,(0,W.useMemo)(()=>function(e){let r=sv(e=>(t(t=>[...t,e]),()=>t(t=>{let r=t.slice(),i=r.indexOf(e);return -1!==i&&r.splice(i,1),r}))),i=(0,W.useMemo)(()=>({register:r,slot:e.slot,name:e.name,props:e.props,value:e.value}),[r,e.slot,e.name,e.props,e.value]);return W.default.createElement(od.Provider,{value:i},e.children)},[t])]}od.displayName="DescriptionContext";let oh=Object.assign(sH(function(e,t){let r=(0,W.useId)(),i=oc(),{id:n=`headlessui-description-${r}`,...s}=e,a=function e(){let t=(0,W.useContext)(od);if(null===t){let t=Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(t,e),t}return t}(),o=sI(t);sw(()=>a.register(n),[n,a.register]);let l=oi({...a.slot,disabled:i||!1}),c={ref:o,...a.props,id:n};return sB()({ourProps:c,theirProps:s,slot:l,defaultTag:"p",name:a.name||"Description"})}),{});function op(e){let t=sv(e),r=(0,W.useRef)(!1);(0,W.useEffect)(()=>(r.current=!1,()=>{r.current=!0,sh(()=>{r.current&&t()})}),[t])}e.s(["Description",()=>oh,"useDescriptions",()=>ou],911109),e.s(["useOnUnmount",()=>op],526297);var of=((k=of||{})[k.Forwards=0]="Forwards",k[k.Backwards=1]="Backwards",k);function oy(e,t){let r=(0,W.useRef)([]),i=sv(e);(0,W.useEffect)(()=>{let e=[...r.current];for(let[n,s]of t.entries())if(r.current[n]!==s){let n=i(t,e);return r.current=t,n}},[i,...t])}let og=[];function om(){"loading"!==document.readyState&&((()=>{function e(e){if(!aP(e.target)||e.target===document.body||og[0]===e.target)return;let t=e.target;t=t.closest(aB),og.unshift(null!=t?t:e.target),(og=og.filter(e=>null!=e&&e.isConnected)).splice(10)}window.addEventListener("click",e,{capture:!0}),window.addEventListener("mousedown",e,{capture:!0}),window.addEventListener("focus",e,{capture:!0}),document.body.addEventListener("click",e,{capture:!0}),document.body.addEventListener("mousedown",e,{capture:!0}),document.body.addEventListener("focus",e,{capture:!0})})(),document.removeEventListener("DOMContentLoaded",om))}function ow(e){if(!e)return new Set;if("function"==typeof e)return new Set(e());let t=new Set;for(let r of e.current)ak(r.current)&&t.add(r.current);return t}"undefined"!=typeof window&&"undefined"!=typeof document&&(document.addEventListener("DOMContentLoaded",om),om());var ob=((C=ob||{})[C.None=0]="None",C[C.InitialFocus=1]="InitialFocus",C[C.TabLock=2]="TabLock",C[C.FocusLock=4]="FocusLock",C[C.RestoreFocus=8]="RestoreFocus",C[C.AutoFocus=16]="AutoFocus",C);let ov=Object.assign(sH(function(e,t){let r,i=(0,W.useRef)(null),n=sI(i,t),{initialFocus:s,initialFocusFallback:a,containers:o,features:l=15,...c}=e;sA()||(l=0);let d=a5(i.current);!function(e,{ownerDocument:t}){let r=!!(8&e),i=function(e=!0){let t=(0,W.useRef)(og.slice());return oy(([e],[r])=>{!0===r&&!1===e&&sh(()=>{t.current.splice(0)}),!1===r&&!0===e&&(t.current=og.slice())},[e,og,t]),sv(()=>{var e;return null!=(e=t.current.find(e=>null!=e&&e.isConnected))?e:null})}(r);oy(()=>{r||aA(null==t?void 0:t.body)&&aZ(i())},[r]),op(()=>{r&&aZ(i())})}(l,{ownerDocument:d});let u=function(e,{ownerDocument:t,container:r,initialFocus:i,initialFocusFallback:n}){let s=(0,W.useRef)(null),a=aw(!!(1&e),"focus-trap#initial-focus"),o=sE();return oy(()=>{if(0===e)return;if(!a){null!=n&&n.current&&aZ(n.current);return}let l=r.current;l&&sh(()=>{if(!o.current)return;let r=null==t?void 0:t.activeElement;if(null!=i&&i.current){if((null==i?void 0:i.current)===r){s.current=r;return}}else if(l.contains(r)){s.current=r;return}if(null!=i&&i.current)aZ(i.current);else{if(16&e){if(aQ(l,aF.First|aF.AutoFocus)!==az.Error)return}else if(aQ(l,aF.First)!==az.Error)return;if(null!=n&&n.current&&(aZ(n.current),(null==t?void 0:t.activeElement)===n.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}s.current=null==t?void 0:t.activeElement})},[n,a,e]),s}(l,{ownerDocument:d,container:i,initialFocus:s,initialFocusFallback:a});!function(e,{ownerDocument:t,container:r,containers:i,previousActiveElement:n}){let s=sE(),a=!!(4&e);s4(null==t?void 0:t.defaultView,"focus",e=>{if(!a||!s.current)return;let t=ow(i);aC(r.current)&&t.add(r.current);let o=n.current;if(!o)return;let l=e.target;aC(l)?oE(t,l)?(n.current=l,aZ(l)):(e.preventDefault(),e.stopPropagation(),aZ(o)):aZ(n.current)},!0)}(l,{ownerDocument:d,container:i,containers:o,previousActiveElement:u});let h=(r=(0,W.useRef)(0),a2(!0,"keydown",e=>{"Tab"===e.key&&(r.current=+!!e.shiftKey)},!0),r),p=sv(e=>{if(!aC(i.current))return;let t=i.current;sD(h.current,{[of.Forwards]:()=>{aQ(t,aF.First,{skipElements:[e.relatedTarget,a]})},[of.Backwards]:()=>{aQ(t,aF.Last,{skipElements:[e.relatedTarget,a]})}})}),f=aw(!!(2&l),"focus-trap#tab-lock"),y=sf(),g=(0,W.useRef)(!1),m=sB();return W.default.createElement(W.default.Fragment,null,f&&W.default.createElement(a6,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:a8.Focusable}),m({ourProps:{ref:n,onKeyDown(e){"Tab"==e.key&&(g.current=!0,y.requestAnimationFrame(()=>{g.current=!1}))},onBlur(e){if(!(4&l))return;let t=ow(o);aC(i.current)&&t.add(i.current);let r=e.relatedTarget;aP(r)&&"true"!==r.dataset.headlessuiFocusGuard&&(oE(t,r)||(g.current?aQ(i.current,sD(h.current,{[of.Forwards]:()=>aF.Next,[of.Backwards]:()=>aF.Previous})|aF.WrapAround,{relativeTo:e.target}):aP(e.target)&&aZ(e.target)))}},theirProps:c,defaultTag:"div",name:"FocusTrap"}),f&&W.default.createElement(a6,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:a8.Focusable}))}),{features:ob});function oE(e,t){for(let r of e)if(r.contains(t))return!0;return!1}var oA=e.i(606049);let o_=W.Fragment,oS=sH(function(e,t){let{ownerDocument:r=null,...i}=e,n=(0,W.useRef)(null),s=sI(sS(e=>{n.current=e}),t),a=a5(n.current),o=function(e){let t=(0,W.useContext)(oa),r=(0,W.useContext)(ox),[i,n]=(0,W.useState)(()=>{var i;if(!t&&null!==r)return null!=(i=r.current)?i:null;if(sm.isServer)return null;let n=null==e?void 0:e.getElementById("headlessui-portal-root");if(n)return n;if(null===e)return null;let s=e.createElement("div");return s.setAttribute("id","headlessui-portal-root"),e.body.appendChild(s)});return(0,W.useEffect)(()=>{null!==i&&(null!=e&&e.body.contains(i)||null==e||e.body.appendChild(i))},[i,e]),(0,W.useEffect)(()=>{t||null!==r&&n(r.current)},[r,n,t]),i}(null!=r?r:a),l=(0,W.useContext)(oT),c=sf(),d=sB();return op(()=>{var e;o&&o.childNodes.length<=0&&(null==(e=o.parentElement)||e.removeChild(o))}),o?(0,oA.createPortal)(W.default.createElement("div",{"data-headlessui-portal":"",ref:e=>{c.dispose(),l&&e&&c.add(l.register(e))}},d({ourProps:{ref:s},theirProps:i,slot:{},defaultTag:o_,name:"Portal"})),o):null}),oI=W.Fragment,ox=(0,W.createContext)(null),oT=(0,W.createContext)(null);function ok(){let e=(0,W.useContext)(oT),t=(0,W.useRef)([]),r=sv(r=>(t.current.push(r),e&&e.register(r),()=>i(r))),i=sv(r=>{let i=t.current.indexOf(r);-1!==i&&t.current.splice(i,1),e&&e.unregister(r)}),n=(0,W.useMemo)(()=>({register:r,unregister:i,portals:t}),[r,i,t]);return[t,(0,W.useMemo)(()=>function({children:e}){return W.default.createElement(oT.Provider,{value:n},e)},[n])]}let oC=sH(function(e,t){let r=sI(t),{enabled:i=!0,ownerDocument:n,...s}=e,a=sB();return i?W.default.createElement(oS,{...s,ownerDocument:n,ref:r}):a({ourProps:{ref:r},theirProps:s,slot:{},defaultTag:o_,name:"Portal"})}),oP=sH(function(e,t){let{target:r,...i}=e,n={ref:sI(t)},s=sB();return W.default.createElement(ox.Provider,{value:r},s({ourProps:n,theirProps:i,defaultTag:oI,name:"Popover.Group"}))}),oO=Object.assign(oC,{Group:oP});e.s(["Portal",()=>oO,"PortalGroup",()=>oP,"useNestedPortals",()=>ok],461138);var oR=((P=oR||{})[P.Open=0]="Open",P[P.Closed=1]="Closed",P),oN=((O=oN||{})[O.SetTitleId=0]="SetTitleId",O);let oM={0:(e,t)=>e.titleId===t.id?e:{...e,titleId:t.id}},oU=(0,W.createContext)(null);function oD(e){let t=(0,W.useContext)(oU);if(null===t){let t=Error(`<${e} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,oD),t}return t}function oj(e,t){return sD(t.type,oM,e,t)}oU.displayName="DialogContext";let oL=sH(function(e,t){let r=(0,W.useId)(),{id:i=`headlessui-dialog-${r}`,open:n,onClose:s,initialFocus:a,role:o="dialog",autoFocus:l=!0,__demoMode:c=!1,unmount:d=!1,...u}=e,h=(0,W.useRef)(!1);o="dialog"===o||"alertdialog"===o?o:(h.current||(h.current=!0,console.warn(`Invalid role [${o}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog");let p=sR();void 0===n&&null!==p&&(n=(p&sO.Open)===sO.Open);let f=(0,W.useRef)(null),y=sI(f,t),g=a5(f.current),m=+!n,[w,b]=(0,W.useReducer)(oj,{titleId:null,descriptionId:null,panelRef:(0,W.createRef)()}),v=sv(()=>s(!1)),E=sv(e=>b({type:0,id:e})),A=!!sA()&&0===m,[_,S]=ok(),I=a9(),{resolveContainers:x}=function({defaultContainers:e=[],portals:t,mainTreeNode:r}={}){let i=sv(()=>{var i,n;let s=ab(r),a=[];for(let t of e)null!==t&&(ak(t)?a.push(t):"current"in t&&ak(t.current)&&a.push(t.current));if(null!=t&&t.current)for(let e of t.current)a.push(e);for(let e of null!=(i=null==s?void 0:s.querySelectorAll("html > *, body > *"))?i:[])e!==document.body&&e!==document.head&&ak(e)&&"headlessui-portal-root"!==e.id&&(r&&(e.contains(r)||e.contains(null==(n=null==r?void 0:r.getRootNode())?void 0:n.host))||a.some(t=>e.contains(t))||a.push(e));return a});return{resolveContainers:i,contains:sv(e=>i().some(t=>t.contains(e)))}}({mainTreeNode:I,portals:_,defaultContainers:[{get current(){var T;return null!=(T=w.panelRef.current)?T:f.current}}]}),k=null!==p&&(p&sO.Closing)===sO.Closing;ax(!c&&!k&&A,{allowed:sv(()=>{var e,t;return[null!=(t=null==(e=f.current)?void 0:e.closest("[data-headlessui-portal]"))?t:null]}),disallowed:sv(()=>{var e;return[null!=(e=null==I?void 0:I.closest("body > *:not(#headlessui-portal-root)"))?e:null]})});let C=af.get(null);sw(()=>{if(A)return C.actions.push(i),()=>C.actions.pop(i)},[C,i,A]);let P=ag(C,(0,W.useCallback)(e=>C.selectors.isTop(e,i),[C,i]));a3(P,x,e=>{e.preventDefault(),v()}),function(e,t="undefined"!=typeof document?document.defaultView:null,r){let i=aw(e,"escape");s4(t,"keydown",e=>{i&&(e.defaultPrevented||e.key===s6.Escape&&r(e))})}(P,null==g?void 0:g.defaultView,e=>{e.preventDefault(),e.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur(),v()}),or(!c&&!k&&A,g,x),aL(A,f,v);let[O,R]=ou(),N=(0,W.useMemo)(()=>[{dialogState:m,close:v,setTitleId:E,unmount:d},w],[m,v,E,d,w]),M=oi({open:0===m}),U={ref:y,id:i,role:o,tabIndex:-1,"aria-modal":c?void 0:0===m||void 0,"aria-labelledby":w.titleId,"aria-describedby":O,unmount:d},D=!function(){var e;let[t]=(0,W.useState)(()=>"undefined"!=typeof window&&"function"==typeof window.matchMedia?window.matchMedia("(pointer: coarse)"):null),[r,i]=(0,W.useState)(null!=(e=null==t?void 0:t.matches)&&e);return sw(()=>{if(t)return t.addEventListener("change",e),()=>t.removeEventListener("change",e);function e(e){i(e.matches)}},[t]),r}(),j=ob.None;A&&!c&&(j|=ob.RestoreFocus,j|=ob.TabLock,l&&(j|=ob.AutoFocus),D&&(j|=ob.InitialFocus));let L=sB();return W.default.createElement(sM,null,W.default.createElement(oo,{force:!0},W.default.createElement(oO,null,W.default.createElement(oU.Provider,{value:N},W.default.createElement(oP,{target:f},W.default.createElement(oo,{force:!1},W.default.createElement(R,{slot:M},W.default.createElement(S,null,W.default.createElement(ov,{initialFocus:a,initialFocusFallback:f,containers:x,features:j},W.default.createElement(os,{value:v},L({ourProps:U,theirProps:u,slot:M,defaultTag:oB,features:oW,visible:0===m,name:"Dialog"})))))))))))}),oB="div",oW=sj.RenderStrategy|sj.Static,oF=sH(function(e,t){let{transition:r=!1,open:i,...n}=e,s=sR(),a=e.hasOwnProperty("open")||null!==s,o=e.hasOwnProperty("onClose");if(!a&&!o)throw Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!a)throw Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!o)throw Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!s&&"boolean"!=typeof e.open)throw Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${e.open}`);if("function"!=typeof e.onClose)throw Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${e.onClose}`);return(void 0!==i||r)&&!n.static?W.default.createElement(a7,null,W.default.createElement(s8,{show:i,transition:r,unmount:n.unmount},W.default.createElement(oL,{ref:t,...n}))):W.default.createElement(a7,null,W.default.createElement(oL,{ref:t,open:i,...n}))}),oz=sH(function(e,t){let r=(0,W.useId)(),{id:i=`headlessui-dialog-panel-${r}`,transition:n=!1,...s}=e,[{dialogState:a,unmount:o},l]=oD("Dialog.Panel"),c=sI(t,l.panelRef),d=oi({open:0===a}),u=sv(e=>{e.stopPropagation()}),h=n?s5:W.Fragment,p=sB();return W.default.createElement(h,{...n?{unmount:o}:{}},p({ourProps:{ref:c,id:i,onClick:u},theirProps:s,slot:d,defaultTag:"div",name:"Dialog.Panel"}))}),oq=Object.assign(oF,{Panel:oz,Title:(sH(function(e,t){let{transition:r=!1,...i}=e,[{dialogState:n,unmount:s}]=oD("Dialog.Backdrop"),a=oi({open:0===n}),o=r?s5:W.Fragment,l=sB();return W.default.createElement(o,{...r?{unmount:s}:{}},l({ourProps:{ref:t,"aria-hidden":!0},theirProps:i,slot:a,defaultTag:"div",name:"Dialog.Backdrop"}))}),sH(function(e,t){let r=(0,W.useId)(),{id:i=`headlessui-dialog-title-${r}`,...n}=e,[{dialogState:s,setTitleId:a}]=oD("Dialog.Title"),o=sI(t);(0,W.useEffect)(()=>(a(i),()=>a(null)),[i,a]);let l=oi({open:0===s});return sB()({ourProps:{ref:o,id:i},theirProps:n,slot:l,defaultTag:"h2",name:"Dialog.Title"})})),Description:oh});var oH=e.i(465076),oK=e.i(760150),o$=e.i(712854),oV=e.i(720978),oJ=e.i(345467),oZ=e.i(428186),oG=e.i(257808);let oY=BigInt(0),oQ=BigInt(1);function oX(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function o0(e){if(!oX(e))throw Error("Uint8Array expected")}function o1(e,t){if("boolean"!=typeof t)throw Error(e+" boolean expected, got "+t)}function o2(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function o3(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?oY:BigInt("0x"+e)}let o5="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,o8=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function o6(e){if(o0(e),o5)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=o8[e[r]];return t}function o4(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function o7(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(o5)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=o4(e.charCodeAt(n)),s=o4(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i}function o9(e){return o3(o6(e))}function le(e){return o0(e),o3(o6(Uint8Array.from(e).reverse()))}function lt(e,t){return o7(e.toString(16).padStart(2*t,"0"))}function lr(e,t){return lt(e,t).reverse()}function li(e,t,r){let i;if("string"==typeof t)try{i=o7(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(oX(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let n=i.length;if("number"==typeof r&&n!==r)throw Error(e+" of length "+r+" expected, got "+n);return i}function ln(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];o0(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}let ls=e=>"bigint"==typeof e&&oY<=e;function la(e,t,r){return ls(e)&&ls(t)&&ls(r)&&t<=e&&e<r}function lo(e,t,r,i){if(!la(t,r,i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}let ll=e=>(oQ<<BigInt(e))-oQ,lc=e=>new Uint8Array(e),ld={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||oX(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function lu(e,t,r={}){let i=(t,r,i)=>{let n=ld[r];if("function"!=typeof n)throw Error("invalid validator function");let s=e[t];if((!i||void 0!==s)&&!n(s,e))throw Error("param "+String(t)+" is invalid. Expected "+r+", got "+s)};for(let[e,r]of Object.entries(t))i(e,r,!1);for(let[e,t]of Object.entries(r))i(e,t,!0);return e}function lh(e){let t=new WeakMap;return(r,...i)=>{let n=t.get(r);if(void 0!==n)return n;let s=e(r,...i);return t.set(r,s),s}}let lp=BigInt(0),lf=BigInt(1),ly=BigInt(2),lg=BigInt(3),lm=BigInt(4),lw=BigInt(5),lb=BigInt(8);function lv(e,t){let r=e%t;return r>=lp?r:t+r}function lE(e,t,r){let i=e;for(;t-- >lp;)i*=i,i%=r;return i}function lA(e,t){if(e===lp)throw Error("invert: expected non-zero number");if(t<=lp)throw Error("invert: expected positive modulus, got "+t);let r=lv(e,t),i=t,n=lp,s=lf,a=lf,o=lp;for(;r!==lp;){let e=i/r,t=i%r,l=n-a*e,c=s-o*e;i=r,r=t,n=a,s=o,a=l,o=c}if(i!==lf)throw Error("invert: does not exist");return lv(n,t)}function l_(e,t){let r=(e.ORDER+lf)/lm,i=e.pow(t,r);if(!e.eql(e.sqr(i),t))throw Error("Cannot find square root");return i}function lS(e,t){let r=(e.ORDER-lw)/lb,i=e.mul(t,ly),n=e.pow(i,r),s=e.mul(t,n),a=e.mul(e.mul(s,ly),n),o=e.mul(s,e.sub(a,e.ONE));if(!e.eql(e.sqr(o),t))throw Error("Cannot find square root");return o}let lI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function lx(e){return lu(e,lI.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function lT(e,t,r=!1){let i=Array(t.length).fill(r?e.ZERO:void 0),n=t.reduce((t,r,n)=>e.is0(r)?t:(i[n]=t,e.mul(t,r)),e.ONE),s=e.inv(n);return t.reduceRight((t,r,n)=>e.is0(r)?t:(i[n]=e.mul(t,i[n]),e.mul(t,r)),s),i}function lk(e,t){let r=(e.ORDER-lf)/ly,i=e.pow(t,r),n=e.eql(i,e.ONE),s=e.eql(i,e.ZERO),a=e.eql(i,e.neg(e.ONE));if(!n&&!s&&!a)throw Error("invalid Legendre symbol result");return n?1:s?0:-1}function lC(e,t){void 0!==t&&(0,ik.anumber)(t);let r=void 0!==t?t:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function lP(e,t,r=!1,i={}){let n;if(e<=lp)throw Error("invalid field: expected ORDER > 0, got "+e);let{nBitLength:s,nByteLength:a}=lC(e,t);if(a>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let o=Object.freeze({ORDER:e,isLE:r,BITS:s,BYTES:a,MASK:ll(s),ZERO:lp,ONE:lf,create:t=>lv(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return lp<=t&&t<e},is0:e=>e===lp,isOdd:e=>(e&lf)===lf,neg:t=>lv(-t,e),eql:(e,t)=>e===t,sqr:t=>lv(t*t,e),add:(t,r)=>lv(t+r,e),sub:(t,r)=>lv(t-r,e),mul:(t,r)=>lv(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<lp)throw Error("invalid exponent, negatives unsupported");if(r===lp)return e.ONE;if(r===lf)return t;let i=e.ONE,n=t;for(;r>lp;)r&lf&&(i=e.mul(i,n)),n=e.sqr(n),r>>=lf;return i})(o,e,t),div:(t,r)=>lv(t*lA(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>lA(t,e),sqrt:i.sqrt||(t=>(n||(n=e%lm===lg?l_:e%lb===lw?lS:function(e){if(e<BigInt(3))throw Error("sqrt is not defined for small field");let t=e-lf,r=0;for(;t%ly===lp;)t/=ly,r++;let i=ly,n=lP(e);for(;1===lk(n,i);)if(i++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return l_;let s=n.pow(i,t),a=(t+lf)/ly;return function(e,i){if(e.is0(i))return i;if(1!==lk(e,i))throw Error("Cannot find square root");let n=r,o=e.mul(e.ONE,s),l=e.pow(i,t),c=e.pow(i,a);for(;!e.eql(l,e.ONE);){if(e.is0(l))return e.ZERO;let t=1,r=e.sqr(l);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===n)throw Error("Cannot find square root");let i=lf<<BigInt(n-t-1),s=e.pow(o,i);n=t,o=e.sqr(s),l=e.mul(l,o),c=e.mul(c,s)}return c}}(e)),n(o,t))),toBytes:e=>r?lr(e,a):lt(e,a),fromBytes:e=>{if(e.length!==a)throw Error("Field.fromBytes: expected "+a+" bytes, got "+e.length);return r?le(e):o9(e)},invertBatch:e=>lT(o,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(o)}function lO(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function lR(e){let t=lO(e);return t+Math.ceil(t/2)}let lN=BigInt(0),lM=BigInt(1);function lU(e,t){let r=t.negate();return e?r:t}function lD(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function lj(e,t){lD(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1),n=2**e;return{windows:r,windowSize:i,mask:ll(e),maxNumber:n,shiftBy:BigInt(e)}}function lL(e,t,r){let{windowSize:i,mask:n,maxNumber:s,shiftBy:a}=r,o=Number(e&n),l=e>>a;o>i&&(o-=s,l+=lM);let c=t*i,d=c+Math.abs(o)-1,u=0===o;return{nextN:l,offset:d,isZero:u,isNeg:o<0,isNegF:t%2!=0,offsetF:c}}let lB=new WeakMap,lW=new WeakMap;function lF(e){return lW.get(e)||1}function lz(e){return lx(e.Fp),lu(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...lC(e.n,e.nBitLength),...e,...{p:e.Fp.ORDER}})}function lq(e){void 0!==e.lowS&&o1("lowS",e.lowS),void 0!==e.prehash&&o1("prehash",e.prehash)}let lH={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=lH;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let i=t.length/2,n=o2(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let s=i>127?o2(n.length/2|128):"";return o2(e)+s+n+t},decode(e,t){let{Err:r}=lH,i=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[i++]!==e)throw new r("tlv.decode: wrong tlv");let n=t[i++],s=0;if(128&n){let e=127&n;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let a=t.subarray(i,i+e);if(a.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===a[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of a)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=n;let a=t.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(i+s)}}},_int:{encode(e){let{Err:t}=lH;if(e<lK)throw new t("integer: negative integers are not allowed");let r=o2(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=lH;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return o9(e)}},toSig(e){let{Err:t,_int:r,_tlv:i}=lH,n=li("signature",e),{v:s,l:a}=i.decode(48,n);if(a.length)throw new t("invalid signature: left bytes after parsing");let{v:o,l:l}=i.decode(2,s),{v:c,l:d}=i.decode(2,l);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(o),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=lH,i=t.encode(2,r.encode(e.r)),n=t.encode(2,r.encode(e.s));return t.encode(48,i+n)}},lK=BigInt(0),l$=BigInt(1),lV=BigInt(2),lJ=BigInt(3),lZ=BigInt(4),lG=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),lY=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),lQ=BigInt(0),lX=BigInt(1),l0=BigInt(2),l1=(e,t)=>(e+t/l0)/t,l2=lP(lG,void 0,void 0,{sqrt:function(e){let t=BigInt(3),r=BigInt(6),i=BigInt(11),n=BigInt(22),s=BigInt(23),a=BigInt(44),o=BigInt(88),l=e*e*e%lG,c=l*l*e%lG,d=lE(c,t,lG)*c%lG,u=lE(d,t,lG)*c%lG,h=lE(u,l0,lG)*l%lG,p=lE(h,i,lG)*h%lG,f=lE(p,n,lG)*p%lG,y=lE(f,a,lG)*f%lG,g=lE(y,o,lG)*y%lG,m=lE(g,a,lG)*f%lG,w=lE(m,t,lG)*c%lG,b=lE(w,s,lG)*p%lG,v=lE(b,r,lG)*l%lG,E=lE(v,l0,lG);if(!l2.eql(l2.sqr(E),e))throw Error("Cannot find square root");return E}}),l3=(CA={a:lQ,b:BigInt(7),Fp:l2,n:lY,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-lX*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),n=BigInt("0x100000000000000000000000000000000"),s=l1(t*e,lY),a=l1(-r*e,lY),o=lv(e-s*t-a*i,lY),l=lv(-s*r-a*t,lY),c=o>n,d=l>n;if(c&&(o=lY-o),d&&(l=lY-l),o>n||l>n)throw Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:c,k1:o,k2neg:d,k2:l}}}},C_=oZ.sha256,{...(R=e=>(function(e){let t,r=(lu(t=lz(e),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})),{Fp:i,n:n,nByteLength:s,nBitLength:a}=r,o=i.BYTES+1,l=2*i.BYTES+1;function c(e){return lv(e,n)}let{ProjectivePoint:d,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:p}=function(e){var t;let r=function(e){let t=lz(e);lu(t,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:r,Fp:i,a:n}=t;if(r){if(!i.eql(n,i.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...t})}(e),{Fp:i}=r,n=lP(r.n,r.nBitLength),s=r.toBytes||((e,t,r)=>{let n=t.toAffine();return ln(Uint8Array.from([4]),i.toBytes(n.x),i.toBytes(n.y))}),a=r.fromBytes||(e=>{let t=e.subarray(1);return{x:i.fromBytes(t.subarray(0,i.BYTES)),y:i.fromBytes(t.subarray(i.BYTES,2*i.BYTES))}});function o(e){let{a:t,b:n}=r,s=i.sqr(e),a=i.mul(s,e);return i.add(i.add(a,i.mul(e,t)),n)}function l(e,t){let r=i.sqr(t),n=o(e);return i.eql(r,n)}if(!l(r.Gx,r.Gy))throw Error("bad curve params: generator point");let c=i.mul(i.pow(r.a,lJ),lZ),d=i.mul(i.sqr(r.b),BigInt(27));if(i.is0(i.add(c,d)))throw Error("bad curve params: a or b");function u(e){let t,{allowedPrivateKeyLengths:i,nByteLength:n,wrapPrivateKey:s,n:a}=r;if(i&&"bigint"!=typeof e){if(oX(e)&&(e=o6(e)),"string"!=typeof e||!i.includes(e.length))throw Error("invalid private key");e=e.padStart(2*n,"0")}try{t="bigint"==typeof e?e:o9(li("private key",e,n))}catch(t){throw Error("invalid private key, expected hex or "+n+" bytes, got "+typeof e)}return s&&(t=lv(t,a)),lo("private key",t,l$,a),t}function h(e){if(!(e instanceof y))throw Error("ProjectivePoint expected")}let p=lh((e,t)=>{let{px:r,py:n,pz:s}=e;if(i.eql(s,i.ONE))return{x:r,y:n};let a=e.is0();null==t&&(t=a?i.ONE:i.inv(s));let o=i.mul(r,t),l=i.mul(n,t),c=i.mul(s,t);if(a)return{x:i.ZERO,y:i.ZERO};if(!i.eql(c,i.ONE))throw Error("invZ was invalid");return{x:o,y:l}}),f=lh(e=>{if(e.is0()){if(r.allowInfinityPoint&&!i.is0(e.py))return;throw Error("bad point: ZERO")}let{x:t,y:n}=e.toAffine();if(!i.isValid(t)||!i.isValid(n))throw Error("bad point: x or y not FE");if(!l(t,n))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class y{constructor(e,t,r){if(null==e||!i.isValid(e))throw Error("x required");if(null==t||!i.isValid(t)||i.is0(t))throw Error("y required");if(null==r||!i.isValid(r))throw Error("z required");this.px=e,this.py=t,this.pz=r,Object.freeze(this)}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof y)throw Error("projective point not allowed");let n=e=>i.eql(e,i.ZERO);return n(t)&&n(r)?y.ZERO:new y(t,r,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){let t=lT(i,e.map(e=>e.pz));return e.map((e,r)=>e.toAffine(t[r])).map(y.fromAffine)}static fromHex(e){let t=y.fromAffine(a(li("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return y.BASE.multiply(u(e))}static msm(e,t){return function(e,t,r,i){if(!Array.isArray(r))throw Error("array expected");r.forEach((t,r)=>{if(!(t instanceof e))throw Error("invalid point at index "+r)});if(!Array.isArray(i))throw Error("array of scalars expected");i.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)});let n=r.length,s=i.length;if(n!==s)throw Error("arrays of points and scalars must have equal length");let a=e.ZERO,o=function(e){let t;for(t=0;e>oY;e>>=oQ,t+=1);return t}(BigInt(n)),l=1;o>12?l=o-3:o>4?l=o-2:o>0&&(l=2);let c=ll(l),d=Array(Number(c)+1).fill(a),u=Math.floor((t.BITS-1)/l)*l,h=a;for(let e=u;e>=0;e-=l){d.fill(a);for(let t=0;t<s;t++){let n=Number(i[t]>>BigInt(e)&c);d[n]=d[n].add(r[t])}let t=a;for(let e=d.length-1,r=a;e>0;e--)r=r.add(d[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<l;e++)h=h.double()}return h}(y,n,e,t)}_setWindowSize(e){w.setWindowSize(this,e)}assertValidity(){f(this)}hasEvenY(){let{y:e}=this.toAffine();if(i.isOdd)return!i.isOdd(e);throw Error("Field doesn't support isOdd")}equals(e){h(e);let{px:t,py:r,pz:n}=this,{px:s,py:a,pz:o}=e,l=i.eql(i.mul(t,o),i.mul(s,n)),c=i.eql(i.mul(r,o),i.mul(a,n));return l&&c}negate(){return new y(this.px,i.neg(this.py),this.pz)}double(){let{a:e,b:t}=r,n=i.mul(t,lJ),{px:s,py:a,pz:o}=this,l=i.ZERO,c=i.ZERO,d=i.ZERO,u=i.mul(s,s),h=i.mul(a,a),p=i.mul(o,o),f=i.mul(s,a);return f=i.add(f,f),d=i.mul(s,o),d=i.add(d,d),l=i.mul(e,d),c=i.mul(n,p),c=i.add(l,c),l=i.sub(h,c),c=i.add(h,c),c=i.mul(l,c),l=i.mul(f,l),d=i.mul(n,d),p=i.mul(e,p),f=i.sub(u,p),f=i.mul(e,f),f=i.add(f,d),d=i.add(u,u),u=i.add(d,u),u=i.add(u,p),u=i.mul(u,f),c=i.add(c,u),p=i.mul(a,o),p=i.add(p,p),u=i.mul(p,f),l=i.sub(l,u),d=i.mul(p,h),d=i.add(d,d),new y(l,c,d=i.add(d,d))}add(e){h(e);let{px:t,py:n,pz:s}=this,{px:a,py:o,pz:l}=e,c=i.ZERO,d=i.ZERO,u=i.ZERO,p=r.a,f=i.mul(r.b,lJ),g=i.mul(t,a),m=i.mul(n,o),w=i.mul(s,l),b=i.add(t,n),v=i.add(a,o);b=i.mul(b,v),v=i.add(g,m),b=i.sub(b,v),v=i.add(t,s);let E=i.add(a,l);return v=i.mul(v,E),E=i.add(g,w),v=i.sub(v,E),E=i.add(n,s),c=i.add(o,l),E=i.mul(E,c),c=i.add(m,w),E=i.sub(E,c),u=i.mul(p,v),c=i.mul(f,w),u=i.add(c,u),c=i.sub(m,u),u=i.add(m,u),d=i.mul(c,u),m=i.add(g,g),m=i.add(m,g),w=i.mul(p,w),v=i.mul(f,v),m=i.add(m,w),w=i.sub(g,w),w=i.mul(p,w),v=i.add(v,w),g=i.mul(m,v),d=i.add(d,g),g=i.mul(E,v),c=i.mul(b,c),c=i.sub(c,g),g=i.mul(b,m),u=i.mul(E,u),new y(c,d,u=i.add(u,g))}subtract(e){return this.add(e.negate())}is0(){return this.equals(y.ZERO)}wNAF(e){return w.wNAFCached(this,e,y.normalizeZ)}multiplyUnsafe(e){let{endo:t,n:n}=r;lo("scalar",e,lK,n);let s=y.ZERO;if(e===lK)return s;if(this.is0()||e===l$)return this;if(!t||w.hasPrecomputes(this))return w.wNAFCachedUnsafe(this,e,y.normalizeZ);let{k1neg:a,k1:o,k2neg:l,k2:c}=t.splitScalar(e),d=s,u=s,h=this;for(;o>lK||c>lK;)o&l$&&(d=d.add(h)),c&l$&&(u=u.add(h)),h=h.double(),o>>=l$,c>>=l$;return a&&(d=d.negate()),l&&(u=u.negate()),u=new y(i.mul(u.px,t.beta),u.py,u.pz),d.add(u)}multiply(e){let t,n,{endo:s,n:a}=r;if(lo("scalar",e,l$,a),s){let{k1neg:r,k1:a,k2neg:o,k2:l}=s.splitScalar(e),{p:c,f:d}=this.wNAF(a),{p:u,f:h}=this.wNAF(l);c=w.constTimeNegate(r,c),u=w.constTimeNegate(o,u),u=new y(i.mul(u.px,s.beta),u.py,u.pz),t=c.add(u),n=d.add(h)}else{let{p:r,f:i}=this.wNAF(e);t=r,n=i}return y.normalizeZ([t,n])[0]}multiplyAndAddUnsafe(e,t,r){let i=y.BASE,n=(e,t)=>t!==lK&&t!==l$&&e.equals(i)?e.multiply(t):e.multiplyUnsafe(t),s=n(this,t).add(n(e,r));return s.is0()?void 0:s}toAffine(e){return p(this,e)}isTorsionFree(){let{h:e,isTorsionFree:t}=r;if(e===l$)return!0;if(t)return t(y,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:e,clearCofactor:t}=r;return e===l$?this:t?t(y,this):this.multiplyUnsafe(r.h)}toRawBytes(e=!0){return o1("isCompressed",e),this.assertValidity(),s(y,this,e)}toHex(e=!0){return o1("isCompressed",e),o6(this.toRawBytes(e))}}y.BASE=new y(r.Gx,r.Gy,i.ONE),y.ZERO=new y(i.ZERO,i.ONE,i.ZERO);let{endo:g,nBitLength:m}=r,w=(t=g?Math.ceil(m/2):m,{constTimeNegate:lU,hasPrecomputes:e=>1!==lF(e),unsafeLadder(e,t,r=y.ZERO){let i=e;for(;t>lN;)t&lM&&(r=r.add(i)),i=i.double(),t>>=lM;return r},precomputeWindow(e,r){let{windows:i,windowSize:n}=lj(r,t),s=[],a=e,o=a;for(let e=0;e<i;e++){o=a,s.push(o);for(let e=1;e<n;e++)o=o.add(a),s.push(o);a=o.double()}return s},wNAF(e,r,i){let n=y.ZERO,s=y.BASE,a=lj(e,t);for(let e=0;e<a.windows;e++){let{nextN:t,offset:o,isZero:l,isNeg:c,isNegF:d,offsetF:u}=lL(i,e,a);i=t,l?s=s.add(lU(d,r[u])):n=n.add(lU(c,r[o]))}return{p:n,f:s}},wNAFUnsafe(e,r,i,n=y.ZERO){let s=lj(e,t);for(let e=0;e<s.windows&&i!==lN;e++){let{nextN:t,offset:a,isZero:o,isNeg:l}=lL(i,e,s);if(i=t,!o){let e=r[a];n=n.add(l?e.negate():e)}}return n},getPrecomputes(e,t,r){let i=lB.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&lB.set(t,r(i))),i},wNAFCached(e,t,r){let i=lF(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)},wNAFCachedUnsafe(e,t,r,i){let n=lF(e);return 1===n?this.unsafeLadder(e,t,i):this.wNAFUnsafe(n,this.getPrecomputes(n,e,r),t,i)},setWindowSize(e,r){lD(r,t),lW.set(e,r),lB.delete(e)}});return{CURVE:r,ProjectivePoint:y,normPrivateKeyToScalar:u,weierstrassEquation:o,isWithinCurveOrder:function(e){return la(e,l$,r.n)}}}({...r,toBytes(e,t,r){let n=t.toAffine(),s=i.toBytes(n.x);return(o1("isCompressed",r),r)?ln(Uint8Array.from([t.hasEvenY()?2:3]),s):ln(Uint8Array.from([4]),s,i.toBytes(n.y))},fromBytes(e){let t=e.length,r=e[0],n=e.subarray(1);if(t===o&&(2===r||3===r)){let e,t=o9(n);if(!la(t,l$,i.ORDER))throw Error("Point is not on curve");let s=h(t);try{e=i.sqrt(s)}catch(e){throw Error("Point is not on curve"+(e instanceof Error?": "+e.message:""))}return(1&r)==1!=((e&l$)===l$)&&(e=i.neg(e)),{x:t,y:e}}if(t===l&&4===r)return{x:i.fromBytes(n.subarray(0,i.BYTES)),y:i.fromBytes(n.subarray(i.BYTES,2*i.BYTES))};throw Error("invalid Point, expected length of "+o+", or uncompressed "+l+", got "+t)}}),f=(e,t,r)=>o9(e.slice(t,r));class y{constructor(e,t,r){lo("r",e,l$,n),lo("s",t,l$,n),this.r=e,this.s=t,null!=r&&(this.recovery=r),Object.freeze(this)}static fromCompact(e){return new y(f(e=li("compactSignature",e,2*s),0,s),f(e,s,2*s))}static fromDER(e){let{r:t,s:r}=lH.toSig(li("DER",e));return new y(t,r)}assertValidity(){}addRecoveryBit(e){return new y(this.r,this.s,e)}recoverPublicKey(e){let{r:t,s,recovery:a}=this,o=w(li("msgHash",e));if(null==a||![0,1,2,3].includes(a))throw Error("recovery id invalid");let l=2===a||3===a?t+r.n:t;if(l>=i.ORDER)throw Error("recovery id 2 or 3 invalid");let u=(1&a)==0?"02":"03",h=d.fromHex(u+o6(lt(l,i.BYTES))),p=lA(l,n),f=c(-o*p),y=c(s*p),g=d.BASE.multiplyAndAddUnsafe(h,f,y);if(!g)throw Error("point at infinify");return g.assertValidity(),g}hasHighS(){return this.s>n>>l$}normalizeS(){return this.hasHighS()?new y(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return o7(this.toDERHex())}toDERHex(){return lH.hexFromSig(this)}toCompactRawBytes(){return o7(this.toCompactHex())}toCompactHex(){return o6(lt(this.r,s))+o6(lt(this.s,s))}}function g(e){if("bigint"==typeof e)return!1;if(e instanceof d)return!0;let t=li("key",e).length,n=i.BYTES,a=n+1;if(!r.allowedPrivateKeyLengths&&s!==a)return t===a||t===2*n+1}let m=r.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=o9(e),r=8*e.length-a;return r>0?t>>BigInt(r):t},w=r.bits2int_modN||function(e){return c(m(e))},b=ll(a);function v(e){return lo("num < 2^"+a,e,lK,b),lt(e,s)}let E={lowS:r.lowS,prehash:!1},A={lowS:r.lowS,prehash:!1};return d.BASE._setWindowSize(8),{CURVE:r,getPublicKey:function(e,t=!0){return d.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,r=!0){if(!0===g(e))throw Error("first arg must be private key");if(!1===g(t))throw Error("second arg must be public key");return d.fromHex(t).multiply(u(e)).toRawBytes(r)},sign:function(e,t,s=E){let{seed:a,k2sig:o}=function(e,t,s=E){if(["recovered","canonical"].some(e=>e in s))throw Error("sign() legacy options not supported");let{hash:a,randomBytes:o}=r,{lowS:l,prehash:h,extraEntropy:f}=s;null==l&&(l=!0),e=li("msgHash",e),lq(s),h&&(e=li("prehashed msgHash",a(e)));let g=w(e),b=u(t),A=[v(b),v(g)];if(null!=f&&!1!==f){let e=!0===f?o(i.BYTES):f;A.push(li("extraEntropy",e))}return{seed:ln(...A),k2sig:function(e){var t;let r=m(e);if(!p(r))return;let i=lA(r,n),s=d.BASE.multiply(r).toAffine(),a=c(s.x);if(a===lK)return;let o=c(i*c(g+a*b));if(o===lK)return;let u=2*(s.x!==a)|Number(s.y&l$),h=o;return l&&o>n>>l$&&(h=(t=o)>n>>l$?c(-t):t,u^=1),new y(a,h,u)}}}(e,t,s);return(function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let i=lc(e),n=lc(e),s=0,a=()=>{i.fill(1),n.fill(0),s=0},o=(...e)=>r(n,i,...e),l=(e=lc(0))=>{let t;if(n=o((t=[0],Uint8Array.from(t)),e),i=o(),0!==e.length){let t;n=o((t=[1],Uint8Array.from(t)),e),i=o()}},c=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(i=o()).slice();r.push(t),e+=i.length}return ln(...r)};return(e,t)=>{let r;for(a(),l(e);!(r=t(c()));)l();return a(),r}})(r.hash.outputLen,r.nByteLength,r.hmac)(a,o)},verify:function(e,t,i,s=A){let a,o;t=li("msgHash",t),i=li("publicKey",i);let{lowS:l,prehash:u,format:h}=s;if(lq(s),"strict"in s)throw Error("options.strict was renamed to lowS");if(void 0!==h&&"compact"!==h&&"der"!==h)throw Error("format must be compact or der");let p="string"==typeof e||oX(e),f=!p&&!h&&"object"==typeof e&&null!==e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!p&&!f)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(f&&(o=new y(e.r,e.s)),p){try{"compact"!==h&&(o=y.fromDER(e))}catch(e){if(!(e instanceof lH.Err))throw e}o||"der"===h||(o=y.fromCompact(e))}a=d.fromHex(i)}catch(e){return!1}if(!o||l&&o.hasHighS())return!1;u&&(t=r.hash(t));let{r:g,s:m}=o,b=w(t),v=lA(m,n),E=c(b*v),_=c(g*v),S=d.BASE.multiplyAndAddUnsafe(a,E,_)?.toAffine();return!!S&&c(S.x)===g},ProjectivePoint:d,Signature:y,utils:{isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{let e=lR(r.n);return function(e,t,r=!1){let i=e.length,n=lO(t),s=lR(t);if(i<16||i<s||i>1024)throw Error("expected "+s+"-1024 bytes of input, got "+i);let a=lv(r?le(e):o9(e),t-lf)+lf;return r?lr(a,n):lt(a,n)}(r.randomBytes(e),r.n)},precompute:(e=8,t=d.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)}}})({...CA,...{hash:e,hmac:(t,...r)=>(0,oG.hmac)(e,t,(0,ik.concatBytes)(...r)),randomBytes:ik.randomBytes}}))(C_),create:R});l3.ProjectivePoint;let l5=(N=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(e=>e.map(e=>BigInt(e))).map(e=>Array.from(e).reverse()),(e,t)=>{let[r,i,n,s]=N.map(t=>t.reduce((t,r)=>l2.add(l2.mul(t,e),r))),[a,o]=lT(l2,[i,s],!0);return e=l2.mul(r,a),t=l2.mul(t,l2.mul(n,o)),{x:e,y:t}}),l8=function(e,t){if(lx(e),!e.isValid(t.A)||!e.isValid(t.B)||!e.isValid(t.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let r=function(e,t){let r=e.ORDER,i=lK;for(let e=r-l$;e%lV===lK;e/=lV)i+=l$;let n=i,s=lV<<n-l$-l$,a=s*lV,o=(r-l$)/a,l=(o-l$)/lV,c=a-l$,d=e.pow(t,o),u=e.pow(t,(o+l$)/lV),h=(t,r)=>{let i=d,a=e.pow(r,c),o=e.sqr(a);o=e.mul(o,r);let h=e.mul(t,o);h=e.pow(h,l),h=e.mul(h,a),a=e.mul(h,r),o=e.mul(h,t);let p=e.mul(o,a);h=e.pow(p,s);let f=e.eql(h,e.ONE);a=e.mul(o,u),h=e.mul(p,i),o=e.cmov(a,o,f),p=e.cmov(h,p,f);for(let t=n;t>l$;t--){let r=t-lV;r=lV<<r-l$;let n=e.pow(p,r),s=e.eql(n,e.ONE);a=e.mul(o,i),i=e.mul(i,i),n=e.mul(p,i),o=e.cmov(a,o,s),p=e.cmov(n,p,s)}return{isValid:f,value:o}};if(e.ORDER%lZ===lJ){let r=(e.ORDER-lJ)/lZ,i=e.sqrt(e.neg(t));h=(t,n)=>{let s=e.sqr(n),a=e.mul(t,n);s=e.mul(s,a);let o=e.pow(s,r);o=e.mul(o,a);let l=e.mul(o,i),c=e.mul(e.sqr(o),n),d=e.eql(c,t),u=e.cmov(l,o,d);return{isValid:d,value:u}}}return h}(e,t.Z);if(!e.isOdd)throw Error("Fp.isOdd is not implemented!");return i=>{let n,s,a,o,l,c,d,u;n=e.sqr(i),n=e.mul(n,t.Z),s=e.sqr(n),s=e.add(s,n),a=e.add(s,e.ONE),a=e.mul(a,t.B),o=e.cmov(t.Z,e.neg(s),!e.eql(s,e.ZERO)),o=e.mul(o,t.A),s=e.sqr(a),c=e.sqr(o),l=e.mul(c,t.A),s=e.add(s,l),s=e.mul(s,a),c=e.mul(c,o),l=e.mul(c,t.B),s=e.add(s,l),d=e.mul(n,a);let{isValid:h,value:p}=r(s,c);u=e.mul(n,i),u=e.mul(u,p),d=e.cmov(d,a,h),u=e.cmov(u,p,h);let f=e.isOdd(i)===e.isOdd(u);u=e.cmov(e.neg(u),u,f);let y=lT(e,[o],!0)[0];return{x:d=e.mul(d,y),y:u}}}(l2,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:l2.create(BigInt("-11"))});!function(e,t,r){if("function"!=typeof t)throw Error("mapToCurve() must be defined")}(l3.ProjectivePoint,e=>{let{x:t,y:r}=l8(l2.create(e[0]));return l5(t,r)},(l2.ORDER,oZ.sha256));class l6 extends Error{constructor(e,t={}){const r=(()=>{if(t.cause instanceof l6){if(t.cause.details)return t.cause.details;if(t.cause.shortMessage)return t.cause.shortMessage}return t.cause&&"details"in t.cause&&"string"==typeof t.cause.details?t.cause.details:t.cause?.message?t.cause.message:t.details})(),i=t.cause instanceof l6&&t.cause.docsPath||t.docsPath,n=`https://oxlib.sh${i??""}`;super([e||"An error occurred.",...t.metaMessages?["",...t.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${n}`:void 0]:[]].filter(e=>"string"==typeof e).join("\n"),t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=t.cause,this.details=r,this.docs=n,this.docsPath=i,this.shortMessage=e}walk(e){return function e(t,r){return r?.(t)?t:t&&"object"==typeof t&&"cause"in t&&t.cause?e(t.cause,r):r?null:t}(this,e)}}function l4(e,t){if(co(e)>t)throw new ch({givenSize:co(e),maxSize:t})}function l7(e,t={}){let{dir:r,size:i=32}=t;if(0===i)return e;let n=e.replace("0x","");if(n.length>2*i)throw new cf({size:Math.ceil(n.length/2),targetSize:i,type:"Hex"});return`0x${n["right"===r?"padEnd":"padStart"](2*i,"0")}`}function l9(e,t,r){return JSON.stringify(e,(e,r)=>"function"==typeof t?t(e,r):"bigint"==typeof r?r.toString()+"#__bigint":r,r)}let ce=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ct(...e){return`0x${e.reduce((e,t)=>e+t.replace("0x",""),"")}`}function cr(e){return e instanceof Uint8Array?ci(e):Array.isArray(e)?ci(new Uint8Array(e)):e}function ci(e,t={}){let r="";for(let t=0;t<e.length;t++)r+=ce[e[t]];let i=`0x${r}`;return"number"==typeof t.size?(l4(i,t.size),cs(i,t.size)):i}function cn(e,t={}){var r;let i,{signed:n,size:s}=t,a=BigInt(e);s?i=n?(1n<<8n*BigInt(s)-1n)-1n:2n**(8n*BigInt(s))-1n:"number"==typeof e&&(i=BigInt(Number.MAX_SAFE_INTEGER));let o="bigint"==typeof i&&n?-i-1n:0;if(i&&a>i||a<o){let t="bigint"==typeof e?"n":"";throw new cc({max:i?`${i}${t}`:void 0,min:`${o}${t}`,signed:n,size:s,value:`${e}${t}`})}let l=(n&&a<0?(1n<<BigInt(8*s))+BigInt(a):a).toString(16),c=`0x${l}`;return s?(r=c,l7(r,{dir:"left",size:s})):c}function cs(e,t){return l7(e,{dir:"right",size:t})}function ca(e,t,r,i={}){let{strict:n}=i;if("number"==typeof t&&t>0&&t>co(e)-1)throw new cp({offset:t,position:"start",size:co(e)});let s=`0x${e.replace("0x","").slice((t??0)*2,(r??e.length)*2)}`;return n&&function(e,t,r){if("number"==typeof t&&"number"==typeof r&&co(e)!==r-t)throw new cp({offset:r,position:"end",size:co(e)})}(s,t,r),s}function co(e){return Math.ceil((e.length-2)/2)}function cl(e){return function(e,t={}){let{dir:r="left"}=t,i=e.replace("0x",""),n=0;for(let e=0;e<i.length-1;e++)if("0"===i["left"===r?e:i.length-e-1].toString())n++;else break;return"0"===(i="left"===r?i.slice(n):i.slice(0,i.length-n))?"0x":"right"===r&&i.length%2==1?`0x${i}0`:`0x${i}`}(e,{dir:"left"})}class cc extends l6{constructor({max:e,min:t,signed:r,size:i,value:n}){super(`Number \`${n}\` is not in safe${i?` ${8*i}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${t}\` to \`${e}\`)`:`(above \`${t}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class cd extends l6{constructor(e){super(`Value \`${"object"==typeof e?l9(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class cu extends l6{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class ch extends l6{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class cp extends l6{constructor({offset:e,position:t,size:r}){super(`Slice ${"start"===t?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class cf extends l6{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function cy(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}let cg=new TextEncoder;function cm(e){var t;return e instanceof Uint8Array?e:"string"==typeof e?cw(e):(t=e)instanceof Uint8Array?t:new Uint8Array(t)}function cw(e,t={}){let{size:r}=t,i=e;r&&(l4(e,r),i=cs(e,r));let n=i.slice(2);n.length%2&&(n=`0${n}`);let s=n.length/2,a=new Uint8Array(s);for(let e=0,t=0;e<s;e++){let r=cy(n.charCodeAt(t++)),i=cy(n.charCodeAt(t++));if(void 0===r||void 0===i)throw new l6(`Invalid byte sequence ("${n[t-2]}${n[t-1]}" in "${n}").`);a[e]=16*r+i}return a}class cb extends l6{constructor(e){super(`Value \`${"object"==typeof e?l9(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class cv extends l6{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed \`${t}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class cE extends l6{constructor({size:e,targetSize:t,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${t}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let cA=2n**256n-1n;function c_(e,t={}){let{recovered:r}=t;if(void 0===e.r||void 0===e.s||r&&void 0===e.yParity)throw new cH({signature:e});if(e.r<0n||e.r>cA)throw new cK({value:e.r});if(e.s<0n||e.s>cA)throw new c$({value:e.s});if("number"==typeof e.yParity&&0!==e.yParity&&1!==e.yParity)throw new cV({value:e.yParity})}function cS(e){return cI(ci(e))}function cI(e){if(130!==e.length&&132!==e.length)throw new cq({signature:e});let t=BigInt(ca(e,0,32)),r=BigInt(ca(e,32,64)),i=(()=>{let t=Number(`0x${e.slice(130)}`);if(!Number.isNaN(t))try{return cF(t)}catch{throw new cV({value:t})}})();return void 0===i?{r:t,s:r}:{r:t,s:r,yParity:i}}function cx(e){if(void 0!==e.r&&void 0!==e.s)return cT(e)}function cT(e){let t="string"==typeof e?cI(e):e instanceof Uint8Array?cS(e):"string"==typeof e.r?cO(e):e.v?cP(e):{r:e.r,s:e.s,...void 0!==e.yParity?{yParity:e.yParity}:{}};return c_(t),t}function ck(e){return cC(ci(e))}function cC(e){let{r:t,s:r}=l3.Signature.fromDER(cr(e).slice(2));return{r:t,s:r}}function cP(e){return{r:e.r,s:e.s,yParity:cF(e.v)}}function cO(e){let t=(()=>{let t=e.v?Number(e.v):void 0,r=e.yParity?Number(e.yParity):void 0;if("number"==typeof t&&"number"!=typeof r&&(r=cF(t)),"number"!=typeof r)throw new cV({value:e.yParity});return r})();return{r:BigInt(e.r),s:BigInt(e.s),yParity:t}}function cR(e){let[t,r,i]=e;return cT({r:"0x"===r?0n:BigInt(r),s:"0x"===i?0n:BigInt(i),yParity:"0x"===t?0:Number(t)})}function cN(e){return cw(cM(e))}function cM(e){c_(e);let t=e.r,r=e.s;return ct(cn(t,{size:32}),cn(r,{size:32}),"number"==typeof e.yParity?cn(cz(e.yParity),{size:1}):"0x")}function cU(e){return new l3.Signature(e.r,e.s).toDERRawBytes()}function cD(e){let t=new l3.Signature(e.r,e.s);return`0x${t.toDERHex()}`}function cj(e){return{r:e.r,s:e.s,v:cz(e.yParity)}}function cL(e){let{r:t,s:r,yParity:i}=e;return{r:cn(t,{size:32}),s:cn(r,{size:32}),yParity:0===i?"0x0":"0x1"}}function cB(e){let{r:t,s:r,yParity:i}=e;return[i?"0x01":"0x",0n===t?"0x":cl(cn(t)),0n===r?"0x":cl(cn(r))]}function cW(e,t={}){try{return c_(e,t),!0}catch{return!1}}function cF(e){if(0===e||27===e)return 0;if(1===e||28===e)return 1;if(e>=35)return+(e%2==0);throw new cJ({value:e})}function cz(e){if(0===e)return 27;if(1===e)return 28;throw new cV({value:e})}class cq extends l6{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${co(cr(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class cH extends l6{constructor({signature:e}){super(`Signature \`${l9(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class cK extends l6{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class c$ extends l6{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class cV extends l6{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class cJ extends l6{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}e.s(["InvalidRError",()=>cK,"InvalidSError",()=>c$,"InvalidSerializedSizeError",()=>cq,"InvalidVError",()=>cJ,"InvalidYParityError",()=>cV,"MissingPropertiesError",()=>cH,"assert",()=>c_,"extract",()=>cx,"from",()=>cT,"fromBytes",()=>cS,"fromDerBytes",()=>ck,"fromDerHex",()=>cC,"fromHex",()=>cI,"fromLegacy",()=>cP,"fromRpc",()=>cO,"fromTuple",()=>cR,"toBytes",()=>cN,"toDerBytes",()=>cU,"toDerHex",()=>cD,"toHex",()=>cM,"toLegacy",()=>cj,"toRpc",()=>cL,"toTuple",()=>cB,"vToYParity",()=>cF,"validate",()=>cW,"yParityToV",()=>cz],517621);var cZ=e.i(517621),cZ=cZ;class cG extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let t=super.get(e);return super.has(e)&&void 0!==t&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){let e=this.keys().next().value;e&&this.delete(e)}return this}}let cY={checksum:new cG(8192)}.checksum;var cQ=e.i(731495);function cX(e,t={}){let{as:r="string"==typeof e?"Hex":"Bytes"}=t,i=(0,cQ.keccak_256)(cm(e));return"Bytes"===r?i:ci(i)}function c0(e,t={}){let{compressed:r}=t,{prefix:i,x:n,y:s}=e;if(!1===r||"bigint"==typeof n&&"bigint"==typeof s){if(4!==i)throw new c8({prefix:i,cause:new c4});return}if(!0===r||"bigint"==typeof n&&void 0===s){if(3!==i&&2!==i)throw new c8({prefix:i,cause:new c6});return}throw new c5({publicKey:e})}function c1(e){let t=(()=>{if(function(e,t={}){let{strict:r=!1}=t;try{return!function(e,t={}){let{strict:r=!1}=t;if(!e||"string"!=typeof e)throw new cd(e);if(r&&!/^0x[0-9a-fA-F]*$/.test(e)||!e.startsWith("0x"))throw new cu(e)}(e,{strict:r}),!0}catch{return!1}}(e))return c2(e);if(function(e){try{if(!(e instanceof Uint8Array)&&(!e||"object"!=typeof e||!("BYTES_PER_ELEMENT"in e)||1!==e.BYTES_PER_ELEMENT||"Uint8Array"!==e.constructor.name))throw new cb(e);return!0}catch{return!1}}(e))return c2(ci(e));let{prefix:t,x:r,y:i}=e;return"bigint"==typeof r&&"bigint"==typeof i?{prefix:t??4,x:r,y:i}:{prefix:t,x:r}})();return c0(t),t}function c2(e){if(132!==e.length&&130!==e.length&&68!==e.length)throw new c7({publicKey:e});if(130===e.length)return{prefix:4,x:BigInt(ca(e,0,32)),y:BigInt(ca(e,32,64))};if(132===e.length){let t=Number(ca(e,0,1));return{prefix:t,x:BigInt(ca(e,1,33)),y:BigInt(ca(e,33,65))}}return{prefix:Number(ca(e,0,1)),x:BigInt(ca(e,1,33))}}function c3(e,t={}){c0(e);let{prefix:r,x:i,y:n}=e,{includePrefix:s=!0}=t;return ct(s?cn(r,{size:1}):"0x",cn(i,{size:32}),"bigint"==typeof n?cn(n,{size:32}):"0x")}class c5 extends l6{constructor({publicKey:e}){super(`Value \`${l9(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class c8 extends l6{constructor({prefix:e,cause:t}){super(`Prefix "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class c6 extends l6{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class c4 extends l6{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class c7 extends l6{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${co(cr(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let c9=/^0x[a-fA-F0-9]{40}$/;function de(e,t={}){let{strict:r=!0}=t;if(!c9.test(e))throw new dr({address:e,cause:new di});if(r){if(e.toLowerCase()===e)return;if(dt(e)!==e)throw new dr({address:e,cause:new dn})}}function dt(e){if(cY.has(e))return cY.get(e);de(e,{strict:!1});let t=e.substring(2).toLowerCase(),r=cX(function(e,t={}){let{size:r}=t,i=cg.encode(e);if("number"==typeof r){var n;if(i.length>r)throw new cv({givenSize:i.length,maxSize:r});return n=i,function(e,t={}){let{dir:r,size:i=32}=t;if(0===i)return e;if(e.length>i)throw new cE({size:e.length,targetSize:i,type:"Bytes"});let n=new Uint8Array(i);for(let t=0;t<i;t++){let s="right"===r;n[s?t:i-t-1]=e[s?t:e.length-t-1]}return n}(n,{dir:"right",size:r})}return i}(t),{as:"Bytes"}),i=t.split("");for(let e=0;e<40;e+=2)r[e>>1]>>4>=8&&i[e]&&(i[e]=i[e].toUpperCase()),(15&r[e>>1])>=8&&i[e+1]&&(i[e+1]=i[e+1].toUpperCase());let n=`0x${i.join("")}`;return cY.set(e,n),n}class dr extends l6{constructor({address:e,cause:t}){super(`Address "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class di extends l6{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class dn extends l6{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function ds(e={}){let{as:t="Hex"}=e,r=dc({as:t}),i=da({privateKey:r});return{privateKey:r,publicKey:i}}function da(e){let{privateKey:t}=e;return c1(l3.ProjectivePoint.fromPrivateKey(cr(t).slice(2)))}function dl(e){let{as:t="Hex",privateKey:r,publicKey:i}=e,n=l3.ProjectivePoint.fromHex(c3(i).slice(2)).multiply(l3.utils.normPrivateKeyToScalar(cr(r).slice(2))).toRawBytes(!0);return"Hex"===t?ci(n):n}function dc(e={}){let{as:t="Hex"}=e,r=l3.utils.randomPrivateKey();return"Hex"===t?ci(r):r}function dd(e){return function(e,t={}){let r=cX(`0x${c3(e).slice(4)}`).substring(26);return function(e,t={}){let{checksum:r=!1}=t;return(de(e),r)?dt(e):e}(`0x${r}`,t)}(du(e))}function du(e){let{payload:t,signature:r}=e,{r:i,s:n,yParity:s}=r;return c1(new l3.Signature(BigInt(i),BigInt(n)).addRecoveryBit(s).recoverPublicKey(cr(t).substring(2)))}function dh(e){let{extraEntropy:t=!1,hash:r,payload:i,privateKey:n}=e,{r:s,s:a,recovery:o}=l3.sign(cm(i),cm(n),{extraEntropy:"boolean"==typeof t?t:cr(t).slice(2),lowS:!0,...r?{prehash:!0}:{}});return{r:s,s:a,yParity:o}}function dp(e){let{address:t,hash:r,payload:i,publicKey:n,signature:s}=e;if(t){var a;return a=dd({payload:i,signature:s}),de(t,{strict:!1}),de(a,{strict:!1}),t.toLowerCase()===a.toLowerCase()}return l3.verify(s,cm(i),function(e,t={}){return cw(c3(e,t))}(n),...r?[{prehash:!0,lowS:!0}]:[])}e.s(["createKeyPair",()=>ds,"getPublicKey",()=>da,"getSharedSecret",()=>dl,"noble",0,l3,"randomPrivateKey",()=>dc,"recoverAddress",()=>dd,"recoverPublicKey",()=>du,"sign",()=>dh,"verify",()=>dp],758775);var df=e.i(758775),df=df,dy=e.i(127017),dg=e.i(370115),dm=e.i(364664),dw=e.i(187261);e.i(971400);var db=e.i(465107),dv=e.i(414113),dE=e.i(471729),dA=e.i(683174),d_=e.i(868653),dS=e.i(317040),dI=e.i(358195);let dx="custom_context";var dT=Object.defineProperty,dk=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?dT(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class dC{constructor(e){dk(this,"nodeValue"),dk(this,"sizeInBytes"),dk(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class dP{constructor(e){dk(this,"lengthInNodes"),dk(this,"sizeInBytes"),dk(this,"head"),dk(this,"tail"),dk(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let t=new dC(e);if(t.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=t):this.head=t,this.tail=t,this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],t=this.head;for(;null!==t;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let t=e.value;return e=e.next,{done:!1,value:t}}}}}var dO=Object.defineProperty,dR=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?dO(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class dN{constructor(e,t=1024e3){dR(this,"logs"),dR(this,"level"),dR(this,"levelValue"),dR(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=dS.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new dP(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===dS.levels.values.error?console.error(e):t===dS.levels.values.warn?console.warn(e):t===dS.levels.values.debug?console.debug(e):t===dS.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append((0,dI.safeJsonStringify)({timestamp:new Date().toISOString(),log:e}));let t="string"==typeof e?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new dP(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let t=this.getLogArray();return t.push((0,dI.safeJsonStringify)({extraMetadata:e})),new Blob(t,{type:"application/json"})}}var dM=Object.defineProperty;class dU{constructor(e,t=1024e3){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?dM(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"baseChunkLogger"),this.baseChunkLogger=new dN(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let t=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=t,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}var dD=Object.defineProperty;class dj{constructor(e,t=1024e3){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?dD(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"baseChunkLogger"),this.baseChunkLogger=new dN(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var dL=Object.defineProperty,dB=Object.defineProperties,dW=Object.getOwnPropertyDescriptors,dF=Object.getOwnPropertySymbols,dz=Object.prototype.hasOwnProperty,dq=Object.prototype.propertyIsEnumerable,dH=(e,t,r)=>t in e?dL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dK=(e,t)=>{for(var r in t||(t={}))dz.call(t,r)&&dH(e,r,t[r]);if(dF)for(var r of dF(t))dq.call(t,r)&&dH(e,r,t[r]);return e};function d$(e,t=dx){return e[t]||""}function dV(e,t,r=dx){let i=function(e,t,r=dx){let i=d$(e,r);return i.trim()?`${i}/${t}`:t}(e,t,r);return function(e,t,r=dx){return e[r]=t,e}(e.child({context:i}),i,r)}function dJ(e){var t,r,i,n;let s,a,o,l;return"u">typeof e.loggerOverride&&"string"!=typeof e.loggerOverride?{logger:e.loggerOverride,chunkLoggerController:null}:"u">typeof window?(l=new dU(null==(i=(r=e).opts)?void 0:i.level,r.maxSizeInBytes),{logger:(0,dS.default)((a=dK({},r.opts),o={level:"trace",browser:dB(dK({},null==(n=r.opts)?void 0:n.browser),dW({write:e=>l.write(e)}))},dB(a,dW(o)))),chunkLoggerController:l}):(s=new dj(null==(t=e.opts)?void 0:t.level,e.maxSizeInBytes),{logger:(0,dS.default)(dB(dK({},e.opts),dW({level:"trace"})),s),chunkLoggerController:s})}function dZ(e){let[t,r]=e.split(":");return{namespace:t,reference:r}}function dG(e,t=[]){let r=[];return Object.keys(e).forEach(i=>{if(t.length&&!t.includes(i))return;let n=e[i];r.push(...n.accounts)}),r}function dY(e,t){return e.includes(":")?[e]:t.chains||[]}var dQ=Object.defineProperty,dX=Object.defineProperties,d0=Object.getOwnPropertyDescriptors,d1=Object.getOwnPropertySymbols,d2=Object.prototype.hasOwnProperty,d3=Object.prototype.propertyIsEnumerable,d5=(e,t,r)=>t in e?dQ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,d8=(e,t)=>{for(var r in t||(t={}))d2.call(t,r)&&d5(e,r,t[r]);if(d1)for(var r of d1(t))d3.call(t,r)&&d5(e,r,t[r]);return e},d6=(e,t,r)=>d5(e,"symbol"!=typeof t?t+"":t,r);let d4="react-native",d7="node",d9="browser";function ue(){return"u">typeof sx.default&&"u">typeof sx.default.versions&&"u">typeof sx.default.versions.node}function ut(){return!(0,oV.getDocument)()&&!!(0,oV.getNavigator)()&&"ReactNative"===navigator.product}function ur(){return!ue()&&!!(0,oV.getNavigator)()&&!!(0,oV.getDocument)()}function ui(){return ut()?d4:ue()?d7:ur()?d9:"unknown"}function un(){var t;try{return ut()&&"u">typeof(null==e.g?void 0:e.g.Application)?null==(t=e.g.Application)?void 0:t.applicationId:void 0}catch{return}}function us(){return(0,oJ.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function ua(t,r,i){var n;let s,a=function(){if(ui()===d4&&"u">typeof(null==e.g?void 0:e.g.Platform)){let{OS:t,Version:r}=e.g.Platform;return[t,r].join("-")}let t=(0,oK.detect)();if(null===t)return"unknown";let r=t.os?t.os.replace(" ","").toLowerCase():"unknown";return"browser"===t.type?[r,t.name,t.version].join("-"):[r,t.version].join("-")}(),o=(s=ui())===d9?[s,(null==(n=(0,oV.getLocation)())?void 0:n.host)||"unknown"].join(":"):s;return[[t,r].join("-"),["js",i].join("-"),a,o].join("/")}function uo(e,t){return e.filter(e=>t.includes(e)).length===e.length}function ul(e){return Object.fromEntries(e.entries())}function uc(e){return new Map(Object.entries(e))}function ud(e=o$.FIVE_MINUTES,t){let r,i,n,s,a=(0,o$.toMiliseconds)(e||o$.FIVE_MINUTES);return{resolve:e=>{n&&r&&(clearTimeout(n),r(e),s=Promise.resolve(e))},reject:e=>{n&&i&&(clearTimeout(n),i(e))},done:()=>new Promise((e,o)=>{if(s)return e(s);n=setTimeout(()=>{let e=Error(t);s=Promise.reject(e),o(e)},a),r=e,i=o})}}function uu(e,t,r){return new Promise(async(i,n)=>{let s=setTimeout(()=>n(Error(r)),t);try{let t=await e;i(t)}catch(e){n(e)}clearTimeout(s)})}function uh(e,t){if("string"==typeof t&&t.startsWith(`${e}:`))return t;if("topic"===e.toLowerCase()){if("string"!=typeof t)throw Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}if("id"===e.toLowerCase()){if("number"!=typeof t)throw Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw Error(`Unknown expirer target type: ${e}`)}function up(e){let[t,r]=e.split(":"),i={id:void 0,topic:void 0};if("topic"===t&&"string"==typeof r)i.topic=r;else if("id"===t&&Number.isInteger(Number(r)))i.id=Number(r);else throw Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return i}function uf(e,t){return(0,o$.fromMiliseconds)((t||Date.now())+(0,o$.toMiliseconds)(e))}function uy(e){return Date.now()>=(0,o$.toMiliseconds)(e)}function ug(e,t){return`${e}${t?`:${t}`:""}`}function um(e=[],t=[]){return[...new Set([...e,...t])]}async function uw({id:t,topic:r,wcDeepLink:i}){var n,s;try{if(!i)return;let a="string"==typeof i?JSON.parse(i):i,o=a?.href;if("string"!=typeof o)return;let l=function(e,t,r){let i=`requestId=${t}&sessionTopic=${r}`;e.endsWith("/")&&(e=e.slice(0,-1));let n=`${e}`;if(e.startsWith("https://t.me")){let t=e.includes("?")?"&startapp=":"?startapp=";n=`${n}${t}${function(e,t=!1){let r=rg.Buffer.from(e).toString("base64");return t?r.replace(/[=]/g,""):r}(i,!0)}`}else n=`${n}/wc?${i}`;return n}(o,t,r),c=ui();if(c===d9){let e;if(!(null!=(n=(0,oV.getDocument)())&&n.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");s=l,e="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?("u">typeof window&&(window.TelegramWebviewProxy||window.Telegram||window.TelegramWebviewProxyProto)||s.startsWith("https://")||s.startsWith("http://"))&&(e="_blank"):e="_top",window.open(s,e,"noreferrer noopener")}else c===d4&&"u">typeof(null==e.g?void 0:e.g.Linking)&&await e.g.Linking.openURL(l)}catch(e){console.error(e)}}async function ub(e,t){let r="";try{if(ur()&&(r=localStorage.getItem(t)))return r;r=await e.getItem(t)}catch(e){console.error(e)}return r}function uv(e,t){if(!e.includes(t))return null;let r=e.split(/([&,?,=])/),i=r.indexOf(t);return r[i+2]}function uE(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function uA(){return"u">typeof sx.default&&"true"===sx.default.env.IS_VITEST}function u_(e){return rg.Buffer.from(e,"base64").toString("utf-8")}class uS{constructor({limit:e}){d6(this,"limit"),d6(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let e=this.set.values().next().value;e&&this.set.delete(e)}this.set.add(e)}}has(e){return this.set.has(e)}}let uI=BigInt(0x100000000-1),ux=BigInt(32);function uT(e,t=!1){return t?{h:Number(e&uI),l:Number(e>>ux&uI)}:{h:0|Number(e>>ux&uI),l:0|Number(e&uI)}}function uk(e,t=!1){let r=e.length,i=new Uint32Array(r),n=new Uint32Array(r);for(let s=0;s<r;s++){let{h:r,l:a}=uT(e[s],t);[i[s],n[s]]=[r,a]}return[i,n]}let uC=(e,t,r)=>e>>>r,uP=(e,t,r)=>e<<32-r|t>>>r,uO=(e,t,r)=>e>>>r|t<<32-r,uR=(e,t,r)=>e<<32-r|t>>>r,uN=(e,t,r)=>e<<64-r|t>>>r-32,uM=(e,t,r)=>e>>>r-32|t<<64-r;function uU(e,t,r,i){let n=(t>>>0)+(i>>>0);return{h:e+r+(n/0x100000000|0)|0,l:0|n}}let uD=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),uj=(e,t,r,i)=>t+r+i+(e/0x100000000|0)|0,uL=(e,t,r,i)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),uB=(e,t,r,i,n)=>t+r+i+n+(e/0x100000000|0)|0,uW=(e,t,r,i,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0)+(n>>>0),uF=(e,t,r,i,n,s)=>t+r+i+n+s+(e/0x100000000|0)|0,uz="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function uq(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function uH(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function uK(e,...t){if(!uq(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function u$(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.createHasher");uH(e.outputLen),uH(e.blockLen)}function uV(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function uJ(e,t){uK(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}function uZ(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function uG(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function uY(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function uQ(e,t){return e<<32-t|e>>>t}let uX=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function u0(e){return e<<24&0xff000000|e<<8&0xff0000|e>>>8&65280|e>>>24&255}let u1=uX?e=>e:e=>u0(e),u2=uX?e=>e:function(e){for(let t=0;t<e.length;t++)e[t]=u0(e[t]);return e},u3="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,u5=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function u8(e){if(uK(e),u3)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=u5[e[r]];return t}function u6(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function u4(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(u3)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let i=new Uint8Array(r);for(let t=0,n=0;t<r;t++,n+=2){let r=u6(e.charCodeAt(n)),s=u6(e.charCodeAt(n+1));if(void 0===r||void 0===s)throw Error('hex string expected, got non-hex character "'+(e[n]+e[n+1])+'" at index '+n);i[t]=16*r+s}return i}function u7(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function u9(e){return"string"==typeof e&&(e=u7(e)),uK(e),e}function he(...e){let t=0;for(let r=0;r<e.length;r++){let i=e[r];uK(i),t+=i.length}let r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}class ht{}function hr(e){let t=t=>e().update(u9(t)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function hi(e=32){if(uz&&"function"==typeof uz.getRandomValues)return uz.getRandomValues(new Uint8Array(e));if(uz&&"function"==typeof uz.randomBytes)return Uint8Array.from(uz.randomBytes(e));throw Error("crypto.getRandomValues must be defined")}let hn=BigInt(0),hs=BigInt(1),ha=BigInt(2),ho=BigInt(7),hl=BigInt(256),hc=BigInt(113),hd=[],hu=[],hh=[];for(let e=0,t=hs,r=1,i=0;e<24;e++){[r,i]=[i,(2*r+3*i)%5],hd.push(2*(5*i+r)),hu.push((e+1)*(e+2)/2%64);let n=hn;for(let e=0;e<7;e++)(t=(t<<hs^(t>>ho)*hc)%hl)&ha&&(n^=hs<<(hs<<BigInt(e))-hs);hh.push(n)}let hp=uk(hh,!0),hf=hp[0],hy=hp[1],hg=(e,t,r)=>r>32?t<<r-32|e>>>64-r:e<<r|t>>>32-r,hm=(e,t,r)=>r>32?e<<r-32|t>>>64-r:t<<r|e>>>32-r;class hw extends ht{constructor(e,t,r,i=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=r,this.enableXOF=i,this.rounds=n,uH(r),!(0<e&&e<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=uZ(this.state)}clone(){return this._cloneInto()}keccak(){u2(this.state32),function(e,t=24){let r=new Uint32Array(10);for(let i=24-t;i<24;i++){for(let t=0;t<10;t++)r[t]=e[t]^e[t+10]^e[t+20]^e[t+30]^e[t+40];for(let t=0;t<10;t+=2){let i=(t+8)%10,n=(t+2)%10,s=r[n],a=r[n+1],o=hg(s,a,1)^r[i],l=hm(s,a,1)^r[i+1];for(let r=0;r<50;r+=10)e[t+r]^=o,e[t+r+1]^=l}let t=e[2],n=e[3];for(let r=0;r<24;r++){let i=hu[r],s=hg(t,n,i),a=hm(t,n,i),o=hd[r];t=e[o],n=e[o+1],e[o]=s,e[o+1]=a}for(let t=0;t<50;t+=10){for(let i=0;i<10;i++)r[i]=e[t+i];for(let i=0;i<10;i++)e[t+i]^=~r[(i+2)%10]&r[(i+4)%10]}e[0]^=hf[i],e[1]^=hy[i]}uG(r)}(this.state32,this.rounds),u2(this.state32),this.posOut=0,this.pos=0}update(e){uV(this),uK(e=u9(e));let{blockLen:t,state:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(t-this.pos,i-n);for(let t=0;t<s;t++)r[this.pos++]^=e[n++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:r,blockLen:i}=this;e[r]^=t,(128&t)!=0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){uV(this,!1),uK(e),this.finish();let t=this.state,{blockLen:r}=this;for(let i=0,n=e.length;i<n;){this.posOut>=r&&this.keccak();let s=Math.min(r-this.posOut,n-i);e.set(t.subarray(this.posOut,this.posOut+s),i),this.posOut+=s,i+=s}return e}xofInto(e){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return uH(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(uJ(e,this),this.finished)throw Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,uG(this.state)}_cloneInto(e){let{blockLen:t,suffix:r,outputLen:i,rounds:n,enableXOF:s}=this;return e||(e=new hw(t,r,i,s,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=i,e.enableXOF=s,e.destroyed=this.destroyed,e}}let hb=hr(()=>new hw(136,1,32));class hv extends ht{constructor(e,t,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=uY(this.buffer)}update(e){uV(this),uK(e=u9(e));let{view:t,buffer:r,blockLen:i}=this,n=e.length;for(let s=0;s<n;){let a=Math.min(i-this.pos,n-s);if(a===i){let t=uY(e);for(;i<=n-s;s+=i)this.process(t,s);continue}r.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){uV(this),uJ(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:i,isLE:n}=this,{pos:s}=this;t[s++]=128,uG(this.buffer.subarray(s)),this.padOffset>i-s&&(this.process(r,0),s=0);for(let e=s;e<i;e++)t[e]=0;(function(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)})(r,i-8,BigInt(8*this.length),n),this.process(r,0);let a=uY(e),o=this.outputLen;if(o%4)throw Error("_sha2: outputLen should be aligned to 32bit");let l=o/4,c=this.get();if(l>c.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)a.setUint32(4*e,c[e],n)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:r,length:i,finished:n,destroyed:s,pos:a}=this;return e.destroyed=s,e.finished=n,e.length=i,e.pos=a,i%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let hE=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),hA=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),h_=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),hS=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),hI=new Uint32Array(64);class hx extends hv{constructor(e=32){super(64,e,8,!1),this.A=0|hE[0],this.B=0|hE[1],this.C=0|hE[2],this.D=0|hE[3],this.E=0|hE[4],this.F=0|hE[5],this.G=0|hE[6],this.H=0|hE[7]}get(){let{A:e,B:t,C:r,D:i,E:n,F:s,G:a,H:o}=this;return[e,t,r,i,n,s,a,o]}set(e,t,r,i,n,s,a,o){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|a,this.H=0|o}process(e,t){for(let r=0;r<16;r++,t+=4)hI[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=hI[e-15],r=hI[e-2],i=uQ(t,7)^uQ(t,18)^t>>>3,n=uQ(r,17)^uQ(r,19)^r>>>10;hI[e]=n+hI[e-7]+i+hI[e-16]|0}let{A:r,B:i,C:n,D:s,E:a,F:o,G:l,H:c}=this;for(let e=0;e<64;e++){var d,u,h,p;let t=c+(uQ(a,6)^uQ(a,11)^uQ(a,25))+((d=a)&o^~d&l)+hS[e]+hI[e]|0,f=(uQ(r,2)^uQ(r,13)^uQ(r,22))+((u=r)&(h=i)^u&(p=n)^h&p)|0;c=l,l=o,o=a,a=s+t|0,s=n,n=i,i=r,r=t+f|0}r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,a=a+this.E|0,o=o+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(r,i,n,s,a,o,l,c)}roundClean(){uG(hI)}destroy(){this.set(0,0,0,0,0,0,0,0),uG(this.buffer)}}let hT=uk(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),hk=hT[0],hC=hT[1],hP=new Uint32Array(80),hO=new Uint32Array(80);class hR extends hv{constructor(e=64){super(128,e,16,!1),this.Ah=0|h_[0],this.Al=0|h_[1],this.Bh=0|h_[2],this.Bl=0|h_[3],this.Ch=0|h_[4],this.Cl=0|h_[5],this.Dh=0|h_[6],this.Dl=0|h_[7],this.Eh=0|h_[8],this.El=0|h_[9],this.Fh=0|h_[10],this.Fl=0|h_[11],this.Gh=0|h_[12],this.Gl=0|h_[13],this.Hh=0|h_[14],this.Hl=0|h_[15]}get(){let{Ah:e,Al:t,Bh:r,Bl:i,Ch:n,Cl:s,Dh:a,Dl:o,Eh:l,El:c,Fh:d,Fl:u,Gh:h,Gl:p,Hh:f,Hl:y}=this;return[e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y]}set(e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y){this.Ah=0|e,this.Al=0|t,this.Bh=0|r,this.Bl=0|i,this.Ch=0|n,this.Cl=0|s,this.Dh=0|a,this.Dl=0|o,this.Eh=0|l,this.El=0|c,this.Fh=0|d,this.Fl=0|u,this.Gh=0|h,this.Gl=0|p,this.Hh=0|f,this.Hl=0|y}process(e,t){for(let r=0;r<16;r++,t+=4)hP[r]=e.getUint32(t),hO[r]=e.getUint32(t+=4);for(let e=16;e<80;e++){let t=0|hP[e-15],r=0|hO[e-15],i=uO(t,r,1)^uO(t,r,8)^uC(t,r,7),n=uR(t,r,1)^uR(t,r,8)^uP(t,r,7),s=0|hP[e-2],a=0|hO[e-2],o=uO(s,a,19)^uN(s,a,61)^uC(s,a,6),l=uL(n,uR(s,a,19)^uM(s,a,61)^uP(s,a,6),hO[e-7],hO[e-16]),c=uB(l,i,o,hP[e-7],hP[e-16]);hP[e]=0|c,hO[e]=0|l}let{Ah:r,Al:i,Bh:n,Bl:s,Ch:a,Cl:o,Dh:l,Dl:c,Eh:d,El:u,Fh:h,Fl:p,Gh:f,Gl:y,Hh:g,Hl:m}=this;for(let e=0;e<80;e++){let t=uO(d,u,14)^uO(d,u,18)^uN(d,u,41),w=uR(d,u,14)^uR(d,u,18)^uM(d,u,41),b=d&h^~d&f,v=uW(m,w,u&p^~u&y,hC[e],hO[e]),E=uF(v,g,t,b,hk[e],hP[e]),A=0|v,_=uO(r,i,28)^uN(r,i,34)^uN(r,i,39),S=uR(r,i,28)^uM(r,i,34)^uM(r,i,39),I=r&n^r&a^n&a,x=i&s^i&o^s&o;g=0|f,m=0|y,f=0|h,y=0|p,h=0|d,p=0|u,({h:d,l:u}=uU(0|l,0|c,0|E,0|A)),l=0|a,c=0|o,a=0|n,o=0|s,n=0|r,s=0|i;let T=uD(A,S,x);r=uj(T,E,_,I),i=0|T}({h:r,l:i}=uU(0|this.Ah,0|this.Al,0|r,0|i)),({h:n,l:s}=uU(0|this.Bh,0|this.Bl,0|n,0|s)),({h:a,l:o}=uU(0|this.Ch,0|this.Cl,0|a,0|o)),({h:l,l:c}=uU(0|this.Dh,0|this.Dl,0|l,0|c)),({h:d,l:u}=uU(0|this.Eh,0|this.El,0|d,0|u)),({h,l:p}=uU(0|this.Fh,0|this.Fl,0|h,0|p)),({h:f,l:y}=uU(0|this.Gh,0|this.Gl,0|f,0|y)),({h:g,l:m}=uU(0|this.Hh,0|this.Hl,0|g,0|m)),this.set(r,i,n,s,a,o,l,c,d,u,h,p,f,y,g,m)}roundClean(){uG(hP,hO)}destroy(){uG(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class hN extends hR{constructor(){super(48),this.Ah=0|hA[0],this.Al=0|hA[1],this.Bh=0|hA[2],this.Bl=0|hA[3],this.Ch=0|hA[4],this.Cl=0|hA[5],this.Dh=0|hA[6],this.Dl=0|hA[7],this.Eh=0|hA[8],this.El=0|hA[9],this.Fh=0|hA[10],this.Fl=0|hA[11],this.Gh=0|hA[12],this.Gl=0|hA[13],this.Hh=0|hA[14],this.Hl=0|hA[15]}}let hM=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class hU extends hR{constructor(){super(32),this.Ah=0|hM[0],this.Al=0|hM[1],this.Bh=0|hM[2],this.Bl=0|hM[3],this.Ch=0|hM[4],this.Cl=0|hM[5],this.Dh=0|hM[6],this.Dl=0|hM[7],this.Eh=0|hM[8],this.El=0|hM[9],this.Fh=0|hM[10],this.Fl=0|hM[11],this.Gh=0|hM[12],this.Gl=0|hM[13],this.Hh=0|hM[14],this.Hl=0|hM[15]}}let hD=hr(()=>new hx),hj=hr(()=>new hR),hL=hr(()=>new hN),hB=hr(()=>new hU),hW=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),hF=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),hz=new Uint32Array(32);function hq(e,t,r,i,n,s){let a=n[s],o=n[s+1],l=hz[2*e],c=hz[2*e+1],d=hz[2*t],u=hz[2*t+1],h=hz[2*r],p=hz[2*r+1],f=hz[2*i],y=hz[2*i+1],g=uD(l,d,a);c=uj(g,c,u,o),l=0|g,({Dh:y,Dl:f}={Dh:y^c,Dl:f^l}),({Dh:y,Dl:f}={Dh:f,Dl:y}),({h:p,l:h}=uU(p,h,y,f)),({Bh:u,Bl:d}={Bh:u^p,Bl:d^h}),({Bh:u,Bl:d}={Bh:uO(u,d,24),Bl:uR(u,d,24)}),hz[2*e]=l,hz[2*e+1]=c,hz[2*t]=d,hz[2*t+1]=u,hz[2*r]=h,hz[2*r+1]=p,hz[2*i]=f,hz[2*i+1]=y}function hH(e,t,r,i,n,s){let a=n[s],o=n[s+1],l=hz[2*e],c=hz[2*e+1],d=hz[2*t],u=hz[2*t+1],h=hz[2*r],p=hz[2*r+1],f=hz[2*i],y=hz[2*i+1],g=uD(l,d,a);c=uj(g,c,u,o),l=0|g,({Dh:y,Dl:f}={Dh:y^c,Dl:f^l}),({Dh:y,Dl:f}={Dh:uO(y,f,16),Dl:uR(y,f,16)}),({h:p,l:h}=uU(p,h,y,f)),({Bh:u,Bl:d}={Bh:u^p,Bl:d^h}),({Bh:u,Bl:d}={Bh:uN(u,d,63),Bl:uM(u,d,63)}),hz[2*e]=l,hz[2*e+1]=c,hz[2*t]=d,hz[2*t+1]=u,hz[2*r]=h,hz[2*r+1]=p,hz[2*i]=f,hz[2*i+1]=y}class hK extends ht{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,uH(e),uH(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=uZ(this.buffer)}update(e){uV(this),uK(e=u9(e));let{blockLen:t,buffer:r,buffer32:i}=this,n=e.length,s=e.byteOffset,a=e.buffer;for(let o=0;o<n;){this.pos===t&&(u2(i),this.compress(i,0,!1),u2(i),this.pos=0);let l=Math.min(t-this.pos,n-o),c=s+o;if(l===t&&!(c%4)&&o+l<n){let e=new Uint32Array(a,c,Math.floor((n-o)/4));u2(e);for(let r=0;o+t<n;r+=i.length,o+=t)this.length+=t,this.compress(e,r,!1);u2(e);continue}r.set(e.subarray(o,o+l),this.pos),this.pos+=l,this.length+=l,o+=l}return this}digestInto(e){uV(this),uJ(e,this);let{pos:t,buffer32:r}=this;this.finished=!0,uG(this.buffer.subarray(t)),u2(r),this.compress(r,0,!0),u2(r);let i=uZ(e);this.get().forEach((e,t)=>i[t]=u1(e))}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){let{buffer:t,length:r,finished:i,destroyed:n,outputLen:s,pos:a}=this;return e||(e=new this.constructor({dkLen:s})),e.set(...this.get()),e.buffer.set(t),e.destroyed=n,e.finished=i,e.length=r,e.pos=a,e.outputLen=s,e}clone(){return this._cloneInto()}}class h$ extends hK{constructor(e={}){const t=void 0===e.dkLen?64:e.dkLen;super(128,t),this.v0l=0|hF[0],this.v0h=0|hF[1],this.v1l=0|hF[2],this.v1h=0|hF[3],this.v2l=0|hF[4],this.v2h=0|hF[5],this.v3l=0|hF[6],this.v3h=0|hF[7],this.v4l=0|hF[8],this.v4h=0|hF[9],this.v5l=0|hF[10],this.v5h=0|hF[11],this.v6l=0|hF[12],this.v6h=0|hF[13],this.v7l=0|hF[14],this.v7h=0|hF[15],function(e,t={},r,i,n){if(uH(64),e<0||e>64)throw Error("outputLen bigger than keyLen");let{key:s,salt:a,personalization:o}=t;if(void 0!==s&&(s.length<1||s.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==a&&16!==a.length)throw Error("salt must be undefined or 16");if(void 0!==o&&16!==o.length)throw Error("personalization must be undefined or 16")}(t,e,0,0,0);let{key:r,personalization:i,salt:n}=e,s=0;if(void 0!==r&&(s=(r=u9(r)).length),this.v0l^=this.outputLen|s<<8|0x1010000,void 0!==n){const e=uZ(n=u9(n));this.v4l^=u1(e[0]),this.v4h^=u1(e[1]),this.v5l^=u1(e[2]),this.v5h^=u1(e[3])}if(void 0!==i){const e=uZ(i=u9(i));this.v6l^=u1(e[0]),this.v6h^=u1(e[1]),this.v7l^=u1(e[2]),this.v7h^=u1(e[3])}if(void 0!==r){const e=new Uint8Array(this.blockLen);e.set(r),this.update(e)}}get(){let{v0l:e,v0h:t,v1l:r,v1h:i,v2l:n,v2h:s,v3l:a,v3h:o,v4l:l,v4h:c,v5l:d,v5h:u,v6l:h,v6h:p,v7l:f,v7h:y}=this;return[e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y]}set(e,t,r,i,n,s,a,o,l,c,d,u,h,p,f,y){this.v0l=0|e,this.v0h=0|t,this.v1l=0|r,this.v1h=0|i,this.v2l=0|n,this.v2h=0|s,this.v3l=0|a,this.v3h=0|o,this.v4l=0|l,this.v4h=0|c,this.v5l=0|d,this.v5h=0|u,this.v6l=0|h,this.v6h=0|p,this.v7l=0|f,this.v7h=0|y}compress(e,t,r){this.get().forEach((e,t)=>hz[t]=e),hz.set(hF,16);let{h:i,l:n}=uT(BigInt(this.length));hz[24]=hF[8]^n,hz[25]=hF[9]^i,r&&(hz[28]=~hz[28],hz[29]=~hz[29]);let s=0;for(let r=0;r<12;r++)hq(0,4,8,12,e,t+2*hW[s++]),hH(0,4,8,12,e,t+2*hW[s++]),hq(1,5,9,13,e,t+2*hW[s++]),hH(1,5,9,13,e,t+2*hW[s++]),hq(2,6,10,14,e,t+2*hW[s++]),hH(2,6,10,14,e,t+2*hW[s++]),hq(3,7,11,15,e,t+2*hW[s++]),hH(3,7,11,15,e,t+2*hW[s++]),hq(0,5,10,15,e,t+2*hW[s++]),hH(0,5,10,15,e,t+2*hW[s++]),hq(1,6,11,12,e,t+2*hW[s++]),hH(1,6,11,12,e,t+2*hW[s++]),hq(2,7,8,13,e,t+2*hW[s++]),hH(2,7,8,13,e,t+2*hW[s++]),hq(3,4,9,14,e,t+2*hW[s++]),hH(3,4,9,14,e,t+2*hW[s++]);this.v0l^=hz[0]^hz[16],this.v0h^=hz[1]^hz[17],this.v1l^=hz[2]^hz[18],this.v1h^=hz[3]^hz[19],this.v2l^=hz[4]^hz[20],this.v2h^=hz[5]^hz[21],this.v3l^=hz[6]^hz[22],this.v3h^=hz[7]^hz[23],this.v4l^=hz[8]^hz[24],this.v4h^=hz[9]^hz[25],this.v5l^=hz[10]^hz[26],this.v5h^=hz[11]^hz[27],this.v6l^=hz[12]^hz[28],this.v6h^=hz[13]^hz[29],this.v7l^=hz[14]^hz[30],this.v7h^=hz[15]^hz[31],uG(hz)}destroy(){this.destroyed=!0,uG(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let hV=(CS=e=>new h$(e),(M=(e,t)=>CS(t).update(u9(e)).digest()).outputLen=(U=CS({})).outputLen,M.blockLen=U.blockLen,M.create=e=>CS(e),M);function hJ(e){let t=`Ethereum Signed Message:
${e.length}`,r=new TextEncoder().encode(t+e);return"0x"+rg.Buffer.from(hb(r)).toString("hex")}async function hZ(e,t,r,i,n,s){switch(r.t){case"eip191":var a,o,l;let c;return await (a=e,o=t,l=r.s,c=cZ.fromHex(l),df.recoverAddress({payload:hJ(o),signature:c}).toLowerCase()===a.toLowerCase());case"eip1271":return await hG(e,t,r.s,i,n,s);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${r.t}`)}}async function hG(e,t,r,i,n,s){let a=dZ(i);if(!a.namespace||!a.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{let a="0x1626ba7e",o=r.substring(2),l=(o.length/2).toString(16).padStart(64,"0"),c=(t.startsWith("0x")?t:hJ(t)).substring(2),d=a+c+"0000000000000000000000000000000000000000000000000000000000000040"+l+o,u=await fetch(`${s||"https://rpc.walletconnect.org/v1"}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:e,data:d},"latest"]})}),{result:h}=await u.json();return!!h&&h.slice(0,a.length).toLowerCase()===a.toLowerCase()}catch(e){return console.error("isValidEip1271Signature: ",e),!1}}function hY(e){let t=new Uint8Array(hD(function(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);if("object"==typeof e&&null!=e&&e.data)return new Uint8Array(Object.values(e.data));if("object"==typeof e&&e)return new Uint8Array(Object.values(e));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(e)));return dy.default.encode(t)}function hQ(e){let t=rg.Buffer.from(e,"base64"),r=(0,dg.decode)(t).txn;if(!r)throw Error("Invalid signed transaction: missing 'txn' field");let i=(0,dm.encode)(r),n=rg.Buffer.from("TX"),s=hB(rg.Buffer.concat([n,rg.Buffer.from(i)]));return sl.base32.encode(s).replace(/=+$/,"")}function hX(e){let t=[],r=BigInt(e);for(;r>=BigInt(128);)t.push(Number(r&BigInt(127)|BigInt(128))),r>>=BigInt(7);return t.push(Number(r)),rg.Buffer.from(t)}var h0=Object.defineProperty,h1=Object.defineProperties,h2=Object.getOwnPropertyDescriptors,h3=Object.getOwnPropertySymbols,h5=Object.prototype.hasOwnProperty,h8=Object.prototype.propertyIsEnumerable,h6=(e,t,r)=>t in e?h0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;let h4=e=>e?.split(":"),h7=e=>{let t=e&&h4(e);if(t)return t[2]+":"+t[3]},h9=e=>{let t=e&&h4(e);if(t)return t.pop()};async function pe(e){let{cacao:t,projectId:r}=e,{s:i,p:n}=t,s=pt(n,n.iss),a=h9(n.iss);return await hZ(a,s,i,h7(n.iss),r)}let pt=(e,t)=>{let r=`${e.domain} wants you to sign in with your Ethereum account:`,i=h9(t);if(!e.aud&&!e.uri)throw Error("Either `aud` or `uri` is required to construct the message");let n=e.statement||void 0,s=`URI: ${e.aud||e.uri}`,a=`Version: ${e.version}`,o=`Chain ID: ${(e=>{let t=e&&h4(e);if(t)return e.includes("did:pkh:")?t[3]:t[1]})(t)}`,l=`Nonce: ${e.nonce}`,c=`Issued At: ${e.iat}`,d=e.exp?`Expiration Time: ${e.exp}`:void 0,u=e.nbf?`Not Before: ${e.nbf}`:void 0,h=e.requestId?`Request ID: ${e.requestId}`:void 0,p=e.resources?`Resources:${e.resources.map(e=>`
- ${e}`).join("")}`:void 0,f=po(e.resources);return f&&(n=function(e="",t){pr(t);let r="I further authorize the stated URI to perform the following actions on my behalf: ";if(e.includes(r))return e;let i=[],n=0;Object.keys(t.att).forEach(e=>{let r=Object.keys(t.att[e]).map(e=>({ability:e.split("/")[0],action:e.split("/")[1]}));r.sort((e,t)=>e.action.localeCompare(t.action));let s={};r.forEach(e=>{s[e.ability]||(s[e.ability]=[]),s[e.ability].push(e.action)});let a=Object.keys(s).map(t=>(n++,`(${n}) '${t}': '${s[t].join("', '")}' for '${e}'.`));i.push(a.join(", ").replace(".,","."))});let s=i.join(" "),a=`${r}${s}`;return`${e?e+" ":""}${a}`}(n,pn(f))),[r,i,"",n,"",s,a,o,l,c,d,u,h,p].filter(e=>null!=e).join(`
`)};function pr(e){if(!e)throw Error("No recap provided, value is undefined");if(!e.att)throw Error("No `att` property found");let t=Object.keys(e.att);if(!(null!=t&&t.length))throw Error("No resources found in `att` property");t.forEach(t=>{let r=e.att[t];if(Array.isArray(r)||"object"!=typeof r)throw Error(`Resource must be an object: ${t}`);if(!Object.keys(r).length)throw Error(`Resource object is empty: ${t}`);Object.keys(r).forEach(e=>{let t=r[e];if(!Array.isArray(t))throw Error(`Ability limits ${e} must be an array of objects, found: ${t}`);if(!t.length)throw Error(`Value of ${e} is empty array, must be an array with objects`);t.forEach(t=>{if("object"!=typeof t)throw Error(`Ability limits (${e}) must be an array of objects, found: ${t}`)})})})}function pi(e){return pr(e),`urn:recap:${rg.Buffer.from(JSON.stringify(e)).toString("base64").replace(/=/g,"")}`}function pn(e){var t;let r=(t=e.replace("urn:recap:",""),JSON.parse(rg.Buffer.from(t,"base64").toString("utf-8")));return pr(r),r}function ps(e){var t;let r=pn(e);pr(r);let i=null==(t=r.att)?void 0:t.eip155;return i?Object.keys(i).map(e=>e.split("/")[1]):[]}function pa(e){let t=pn(e);pr(t);let r=[];return Object.values(t.att).forEach(e=>{Object.values(e).forEach(e=>{var t;null!=(t=e?.[0])&&t.chains&&r.push(e[0].chains)})}),[...new Set(r.flat())]}function po(e){if(!e)return;let t=e?.[e.length-1];return t&&t.includes("urn:recap:")?t:void 0}function pl(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function pc(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function pd(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function pu(e,...t){if(!pl(e))throw Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw Error("Uint8Array expected of length "+t+", got length="+e.length)}function ph(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function pp(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function pf(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}let py=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function pg(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(e);else if(pl(e))e=pb(e);else throw Error("Uint8Array expected, got "+typeof e);return e}function pm(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error("invalid output length, expected "+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw Error("invalid output, must be aligned");return t}function pw(e,t,r,i){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,r,i);let n=BigInt(32),s=BigInt(0xffffffff),a=Number(r>>n&s),o=Number(r&s),l=4*!!i,c=4*!i;e.setUint32(t+l,a,i),e.setUint32(t+c,o,i)}function pb(e){return Uint8Array.from(e)}let pv=e=>Uint8Array.from(e.split("").map(e=>e.charCodeAt(0))),pE=pv("expand 16-byte k"),pA=pv("expand 32-byte k"),p_=pp(pE),pS=pp(pA);function pI(e,t){return e<<t|e>>>32-t}function px(e){return e.byteOffset%4==0}let pT=0x100000000-1,pk=new Uint32Array,pC=(e,t)=>255&e[t++]|(255&e[t++])<<8;class pP{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,pu(e=pg(e),32);const t=pC(e,0),r=pC(e,2),i=pC(e,4),n=pC(e,6),s=pC(e,8),a=pC(e,10),o=pC(e,12),l=pC(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|n<<9)&8191,this.r[4]=(n>>>4|s<<12)&255,this.r[5]=s>>>1&8190,this.r[6]=(s>>>14|a<<2)&8191,this.r[7]=(a>>>11|o<<5)&8065,this.r[8]=(o>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let t=0;t<8;t++)this.pad[t]=pC(e,16+2*t)}process(e,t,r=!1){let{h:i,r:n}=this,s=n[0],a=n[1],o=n[2],l=n[3],c=n[4],d=n[5],u=n[6],h=n[7],p=n[8],f=n[9],y=pC(e,t+0),g=pC(e,t+2),m=pC(e,t+4),w=pC(e,t+6),b=pC(e,t+8),v=pC(e,t+10),E=pC(e,t+12),A=pC(e,t+14),_=i[0]+(8191&y),S=i[1]+((y>>>13|g<<3)&8191),I=i[2]+((g>>>10|m<<6)&8191),x=i[3]+((m>>>7|w<<9)&8191),T=i[4]+((w>>>4|b<<12)&8191),k=i[5]+(b>>>1&8191),C=i[6]+((b>>>14|v<<2)&8191),P=i[7]+((v>>>11|E<<5)&8191),O=i[8]+((E>>>8|A<<8)&8191),R=i[9]+(A>>>5|2048*!r),N=0,M=0+_*s+5*f*S+5*p*I+5*h*x+5*u*T;N=M>>>13,M&=8191,M+=5*d*k+5*c*C+5*l*P+5*o*O+5*a*R,N+=M>>>13,M&=8191;let U=N+_*a+S*s+5*f*I+5*p*x+5*h*T;N=U>>>13,U&=8191,U+=5*u*k+5*d*C+5*c*P+5*l*O+5*o*R,N+=U>>>13,U&=8191;let D=N+_*o+S*a+I*s+5*f*x+5*p*T;N=D>>>13,D&=8191,D+=5*h*k+5*u*C+5*d*P+5*c*O+5*l*R,N+=D>>>13,D&=8191;let j=N+_*l+S*o+I*a+x*s+5*f*T;N=j>>>13,j&=8191,j+=5*p*k+5*h*C+5*u*P+5*d*O+5*c*R,N+=j>>>13,j&=8191;let L=N+_*c+S*l+I*o+x*a+T*s;N=L>>>13,L&=8191,L+=5*f*k+5*p*C+5*h*P+5*u*O+5*d*R,N+=L>>>13,L&=8191;let B=N+_*d+S*c+I*l+x*o+T*a;N=B>>>13,B&=8191,B+=k*s+5*f*C+5*p*P+5*h*O+5*u*R,N+=B>>>13,B&=8191;let W=N+_*u+S*d+I*c+x*l+T*o;N=W>>>13,W&=8191,W+=k*a+C*s+5*f*P+5*p*O+5*h*R,N+=W>>>13,W&=8191;let F=N+_*h+S*u+I*d+x*c+T*l;N=F>>>13,F&=8191,F+=k*o+C*a+P*s+5*f*O+5*p*R,N+=F>>>13,F&=8191;let z=N+_*p+S*h+I*u+x*d+T*c;N=z>>>13,z&=8191,z+=k*l+C*o+P*a+O*s+5*f*R,N+=z>>>13,z&=8191;let q=N+_*f+S*p+I*h+x*u+T*d;N=q>>>13,q&=8191,q+=k*c+C*l+P*o+O*a+R*s,N+=q>>>13,q&=8191,M=8191&(N=(N=(N<<2)+N|0)+M|0),N>>>=13,U+=N,i[0]=M,i[1]=U,i[2]=D,i[3]=j,i[4]=L,i[5]=B,i[6]=W,i[7]=F,i[8]=z,i[9]=q}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),i=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=i,i=e[t]>>>13,e[t]&=8191;e[0]+=5*i,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+i,i=r[t]>>>13,r[t]&=8191;r[9]-=8192;let n=(1^i)-1;for(let e=0;e<10;e++)r[e]&=n;n=~n;for(let t=0;t<10;t++)e[t]=e[t]&n|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let s=e[0]+t[0];e[0]=65535&s;for(let r=1;r<8;r++)s=(e[r]+t[r]|0)+(s>>>16)|0,e[r]=65535&s;pf(r)}update(e){ph(this),pu(e=pg(e));let{buffer:t,blockLen:r}=this,i=e.length;for(let n=0;n<i;){let s=Math.min(r-this.pos,i-n);if(s===r){for(;r<=i-n;n+=r)this.process(e,n);continue}t.set(e.subarray(n,n+s),this.pos),this.pos+=s,n+=s,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){pf(this.h,this.r,this.buffer,this.pad)}digestInto(e){ph(this),function(e,t){pu(e);let r=t.outputLen;if(e.length<r)throw Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;let{buffer:t,h:r}=this,{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let n=0;for(let t=0;t<8;t++)e[n++]=r[t]>>>0,e[n++]=r[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let pO=(CI=e=>new pP(e),(D=(e,t)=>CI(t).update(pg(e)).digest()).outputLen=(j=CI(new Uint8Array(32))).outputLen,D.blockLen=j.blockLen,D.create=e=>CI(e),D),pR=function(e,t){let{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:a}=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return pd(n),pd(a),pc(s),pc(r),(t,o,l,c,d=0)=>{pu(t),pu(o),pu(l);let u=l.length;if(void 0===c&&(c=new Uint8Array(u)),pu(c),pd(d),d<0||d>=pT)throw Error("arx: counter overflow");if(c.length<u)throw Error(`arx: output (${c.length}) is shorter than data (${u})`);let h=[],p=t.length,f,y;if(32===p)h.push(f=pb(t)),y=pS;else if(16===p&&r)(f=new Uint8Array(32)).set(t),f.set(t,16),y=p_,h.push(f);else throw Error(`arx: invalid 32-byte key, got length=${p}`);px(o)||h.push(o=pb(o));let g=pp(f);if(i){if(24!==o.length)throw Error("arx: extended nonce must be 24 bytes");i(y,g,pp(o.subarray(0,16)),g),o=o.subarray(16)}let m=16-n;if(m!==o.length)throw Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){let e=new Uint8Array(12);e.set(o,s?0:12-o.length),o=e,h.push(o)}return function(e,t,r,i,n,s,a,o){let l=n.length,c=new Uint8Array(64),d=pp(c),u=px(n)&&px(s),h=u?pp(n):pk,p=u?pp(s):pk;for(let f=0;f<l;a++){if(e(t,r,i,d,a,o),a>=pT)throw Error("arx: counter overflow");let y=Math.min(64,l-f);if(u&&64===y){let e=f/4;if(f%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)p[r=e+t]=h[r]^d[t];f+=64;continue}for(let e=0,t;e<y;e++)s[t=f+e]=n[t]^c[e];f+=y}}(e,y,g,pp(o),l,c,d,a),pf(...h),c}}(function(e,t,r,i,n,s=20){let a=e[0],o=e[1],l=e[2],c=e[3],d=t[0],u=t[1],h=t[2],p=t[3],f=t[4],y=t[5],g=t[6],m=t[7],w=r[0],b=r[1],v=r[2],E=a,A=o,_=l,S=c,I=d,x=u,T=h,k=p,C=f,P=y,O=g,R=m,N=n,M=w,U=b,D=v;for(let e=0;e<s;e+=2)C=C+(N=pI(N^(E=E+I|0),16))|0,E=E+(I=pI(I^C,12))|0,C=C+(N=pI(N^E,8))|0,I=pI(I^C,7),P=P+(M=pI(M^(A=A+x|0),16))|0,A=A+(x=pI(x^P,12))|0,P=P+(M=pI(M^A,8))|0,x=pI(x^P,7),O=O+(U=pI(U^(_=_+T|0),16))|0,_=_+(T=pI(T^O,12))|0,O=O+(U=pI(U^_,8))|0,T=pI(T^O,7),R=R+(D=pI(D^(S=S+k|0),16))|0,S=S+(k=pI(k^R,12))|0,R=R+(D=pI(D^S,8))|0,k=pI(k^R,7),O=O+(D=pI(D^(E=E+x|0),16))|0,E=E+(x=pI(x^O,12))|0,O=O+(D=pI(D^E,8))|0,x=pI(x^O,7),R=R+(N=pI(N^(A=A+T|0),16))|0,A=A+(T=pI(T^R,12))|0,R=R+(N=pI(N^A,8))|0,T=pI(T^R,7),C=C+(M=pI(M^(_=_+k|0),16))|0,_=_+(k=pI(k^C,12))|0,C=C+(M=pI(M^_,8))|0,k=pI(k^C,7),P=P+(U=pI(U^(S=S+I|0),16))|0,S=S+(I=pI(I^P,12))|0,P=P+(U=pI(U^S,8))|0,I=pI(I^P,7);let j=0;i[j++]=a+E|0,i[j++]=o+A|0,i[j++]=l+_|0,i[j++]=c+S|0,i[j++]=d+I|0,i[j++]=u+x|0,i[j++]=h+T|0,i[j++]=p+k|0,i[j++]=f+C|0,i[j++]=y+P|0,i[j++]=g+O|0,i[j++]=m+R|0,i[j++]=n+N|0,i[j++]=w+M|0,i[j++]=b+U|0,i[j++]=v+D|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),pN=new Uint8Array(16),pM=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(pN.subarray(r))},pU=new Uint8Array(32);function pD(e,t,r,i,n){var s,a;let o,l,c=e(t,r,pU),d=pO.create(c);n&&pM(d,n),pM(d,i);let u=(s=i.length,a=n?n.length:0,pc(!0),pw(l=new DataView((o=new Uint8Array(16)).buffer,o.byteOffset,o.byteLength),0,BigInt(a),!0),pw(l,8,BigInt(s),!0),o);d.update(u);let h=d.digest();return pf(c,u),h}let pj=((e,t)=>{function r(i,...n){if(pu(i),!py)throw Error("Non little-endian hardware is not yet supported");if(void 0!==e.nonceLength){let t=n[0];if(!t)throw Error("nonce / iv required");e.varSizeNonce?pu(t):pu(t,e.nonceLength)}let s=e.tagLength;s&&void 0!==n[1]&&pu(n[1]);let a=t(i,...n),o=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");pu(t)}},l=!1;return{encrypt(e,t){if(l)throw Error("cannot encrypt() twice with same key + nonce");return l=!0,pu(e),o(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(pu(e),s&&e.length<s)throw Error("invalid ciphertext length: smaller than tagLength="+s);return o(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(r,e),r})({blockSize:64,nonceLength:12,tagLength:16},(e,t,r)=>({encrypt(i,n){let s=i.length;(n=pm(s+16,n,!1)).set(i);let a=n.subarray(0,-16);pR(e,t,a,a,1);let o=pD(pR,e,t,a,r);return n.set(o,s),pf(o),n},decrypt(i,n){n=pm(i.length-16,n,!1);let s=i.subarray(0,-16),a=i.subarray(-16),o=pD(pR,e,t,s,r);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let i=0;i<e.length;i++)r|=e[i]^t[i];return 0===r}(a,o))throw Error("invalid tag");return n.set(i.subarray(0,-16)),pR(e,t,n,n,1),pf(o),n}}));class pL extends ht{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,u$(e);const r=u9(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<n.length;e++)n[e]^=54;this.iHash.update(n),this.oHash=e.create();for(let e=0;e<n.length;e++)n[e]^=106;this.oHash.update(n),uG(n)}update(e){return uV(this),this.iHash.update(e),this}digestInto(e){uV(this),uK(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:r,finished:i,destroyed:n,blockLen:s,outputLen:a}=this;return e.finished=i,e.destroyed=n,e.blockLen=s,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let pB=(e,t,r)=>new pL(e,t).update(r).digest();pB.create=(e,t)=>new pL(e,t);let pW=Uint8Array.from([0]),pF=Uint8Array.of(),pz=BigInt(0),pq=BigInt(1);function pH(e,t=""){if("boolean"!=typeof e)throw Error((t&&`"${t}"`)+"expected boolean, got type="+typeof e);return e}function pK(e,t,r=""){let i=uq(e),n=e?.length,s=void 0!==t;if(!i||s&&n!==t)throw Error((r&&`"${r}" `)+"expected Uint8Array"+(s?` of length ${t}`:"")+", got "+(i?`length=${n}`:`type=${typeof e}`));return e}function p$(e){let t=e.toString(16);return 1&t.length?"0"+t:t}function pV(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);return""===e?pz:BigInt("0x"+e)}function pJ(e){return uK(e),pV(u8(Uint8Array.from(e).reverse()))}function pZ(e,t){return u4(e.toString(16).padStart(2*t,"0"))}function pG(e,t){return pZ(e,t).reverse()}function pY(e,t,r){let i;if("string"==typeof t)try{i=u4(t)}catch(t){throw Error(e+" must be hex string or Uint8Array, cause: "+t)}else if(uq(t))i=Uint8Array.from(t);else throw Error(e+" must be hex string or Uint8Array");let n=i.length;if("number"==typeof r&&n!==r)throw Error(e+" of length "+r+" expected, got "+n);return i}let pQ=e=>"bigint"==typeof e&&pz<=e;function pX(e,t,r,i){if(!(pQ(t)&&pQ(r)&&pQ(i))||!(r<=t)||!(t<i))throw Error("expected valid "+e+": "+r+" <= n < "+i+", got "+t)}function p0(e){let t;for(t=0;e>pz;e>>=pq,t+=1);return t}let p1=e=>(pq<<BigInt(e))-pq;function p2(e,t,r={}){if(!e||"object"!=typeof e)throw Error("expected valid options object");function i(t,r,i){let n=e[t];if(i&&void 0===n)return;let s=typeof n;if(s!==r||null===n)throw Error(`param "${t}" is invalid: expected ${r}, got ${s}`)}Object.entries(t).forEach(([e,t])=>i(e,t,!1)),Object.entries(r).forEach(([e,t])=>i(e,t,!0))}function p3(e){let t=new WeakMap;return(r,...i)=>{let n=t.get(r);if(void 0!==n)return n;let s=e(r,...i);return t.set(r,s),s}}let p5=BigInt(0),p8=BigInt(1),p6=BigInt(2),p4=BigInt(3),p7=BigInt(4),p9=BigInt(5),fe=BigInt(7),ft=BigInt(8),fr=BigInt(9),fi=BigInt(16);function fn(e,t){let r=e%t;return r>=p5?r:t+r}function fs(e,t,r){let i=e;for(;t-- >p5;)i*=i,i%=r;return i}function fa(e,t){if(e===p5)throw Error("invert: expected non-zero number");if(t<=p5)throw Error("invert: expected positive modulus, got "+t);let r=fn(e,t),i=t,n=p5,s=p8;for(;r!==p5;){let e=i/r,t=i%r,a=n-s*e;i=r,r=t,n=s,s=a}if(i!==p8)throw Error("invert: does not exist");return fn(n,t)}function fo(e,t,r){if(!e.eql(e.sqr(t),r))throw Error("Cannot find square root")}function fl(e,t){let r=(e.ORDER+p8)/p7,i=e.pow(t,r);return fo(e,i,t),i}function fc(e,t){let r=(e.ORDER-p9)/ft,i=e.mul(t,p6),n=e.pow(i,r),s=e.mul(t,n),a=e.mul(e.mul(s,p6),n),o=e.mul(s,e.sub(a,e.ONE));return fo(e,o,t),o}function fd(e){if(e<p4)throw Error("sqrt is not defined for small field");let t=e-p8,r=0;for(;t%p6===p5;)t/=p6,r++;let i=p6,n=fy(e);for(;1===fp(n,i);)if(i++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===r)return fl;let s=n.pow(i,t),a=(t+p8)/p6;return function(e,i){if(e.is0(i))return i;if(1!==fp(e,i))throw Error("Cannot find square root");let n=r,o=e.mul(e.ONE,s),l=e.pow(i,t),c=e.pow(i,a);for(;!e.eql(l,e.ONE);){if(e.is0(l))return e.ZERO;let t=1,r=e.sqr(l);for(;!e.eql(r,e.ONE);)if(t++,r=e.sqr(r),t===n)throw Error("Cannot find square root");let i=p8<<BigInt(n-t-1),s=e.pow(o,i);n=t,o=e.sqr(s),l=e.mul(l,o),c=e.mul(c,s)}return c}}let fu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function fh(e,t,r=!1){let i=Array(t.length).fill(r?e.ZERO:void 0),n=t.reduce((t,r,n)=>e.is0(r)?t:(i[n]=t,e.mul(t,r)),e.ONE),s=e.inv(n);return t.reduceRight((t,r,n)=>e.is0(r)?t:(i[n]=e.mul(t,i[n]),e.mul(t,r)),s),i}function fp(e,t){let r=(e.ORDER-p8)/p6,i=e.pow(t,r),n=e.eql(i,e.ONE),s=e.eql(i,e.ZERO),a=e.eql(i,e.neg(e.ONE));if(!n&&!s&&!a)throw Error("invalid Legendre symbol result");return n?1:s?0:-1}function ff(e,t){void 0!==t&&uH(t);let r=void 0!==t?t:e.toString(2).length,i=Math.ceil(r/8);return{nBitLength:r,nByteLength:i}}function fy(e,t,r=!1,i={}){let n;if(e<=p5)throw Error("invalid field: expected ORDER > 0, got "+e);let s,a,o=!1,l;if("object"==typeof t&&null!=t){if(i.sqrt||r)throw Error("cannot specify opts in two arguments");t.BITS&&(s=t.BITS),t.sqrt&&(a=t.sqrt),"boolean"==typeof t.isLE&&(r=t.isLE),"boolean"==typeof t.modFromBytes&&(o=t.modFromBytes),l=t.allowedLengths}else"number"==typeof t&&(s=t),i.sqrt&&(a=i.sqrt);let{nBitLength:c,nByteLength:d}=ff(e,s);if(d>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let u=Object.freeze({ORDER:e,isLE:r,BITS:c,BYTES:d,MASK:p1(c),ZERO:p5,ONE:p8,allowedLengths:l,create:t=>fn(t,e),isValid:t=>{if("bigint"!=typeof t)throw Error("invalid field element: expected bigint, got "+typeof t);return p5<=t&&t<e},is0:e=>e===p5,isValidNot0:e=>!u.is0(e)&&u.isValid(e),isOdd:e=>(e&p8)===p8,neg:t=>fn(-t,e),eql:(e,t)=>e===t,sqr:t=>fn(t*t,e),add:(t,r)=>fn(t+r,e),sub:(t,r)=>fn(t-r,e),mul:(t,r)=>fn(t*r,e),pow:(e,t)=>(function(e,t,r){if(r<p5)throw Error("invalid exponent, negatives unsupported");if(r===p5)return e.ONE;if(r===p8)return t;let i=e.ONE,n=t;for(;r>p5;)r&p8&&(i=e.mul(i,n)),n=e.sqr(n),r>>=p8;return i})(u,e,t),div:(t,r)=>fn(t*fa(r,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>fa(t,e),sqrt:a||(t=>{let r,i,s,a,o,l;return n||(n=e%p7===p4?fl:e%ft===p9?fc:e%fi===fr?(r=fy(e),s=(i=fd(e))(r,r.neg(r.ONE)),a=i(r,s),o=i(r,r.neg(s)),l=(e+fe)/fi,(e,t)=>{let r=e.pow(t,l),i=e.mul(r,s),n=e.mul(r,a),c=e.mul(r,o),d=e.eql(e.sqr(i),t),u=e.eql(e.sqr(n),t);r=e.cmov(r,i,d),i=e.cmov(c,n,u);let h=e.eql(e.sqr(i),t),p=e.cmov(r,i,h);return fo(e,p,t),p}):fd(e)),n(u,t)}),toBytes:e=>r?pG(e,d):pZ(e,d),fromBytes:(t,i=!0)=>{if(l){if(!l.includes(t.length)||t.length>d)throw Error("Field.fromBytes: expected "+l+" bytes, got "+t.length);let e=new Uint8Array(d);e.set(t,r?0:e.length-t.length),t=e}if(t.length!==d)throw Error("Field.fromBytes: expected "+d+" bytes, got "+t.length);let n=r?pJ(t):pV(u8(t));if(o&&(n=fn(n,e)),!i&&!u.isValid(n))throw Error("invalid field element: outside of range 0..ORDER");return n},invertBatch:e=>fh(u,e),cmov:(e,t,r)=>r?t:e});return Object.freeze(u)}function fg(e){if("bigint"!=typeof e)throw Error("field order must be bigint");return Math.ceil(e.toString(2).length/8)}function fm(e){let t=fg(e);return t+Math.ceil(t/2)}let fw=BigInt(0),fb=BigInt(1);function fv(e,t){let r=t.negate();return e?r:t}function fE(e,t){let r=fh(e.Fp,t.map(e=>e.Z));return t.map((t,i)=>e.fromAffine(t.toAffine(r[i])))}function fA(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw Error("invalid window size, expected [1.."+t+"], got W="+e)}function f_(e,t){fA(e,t);let r=Math.ceil(t/e)+1,i=2**(e-1),n=2**e;return{windows:r,windowSize:i,mask:p1(e),maxNumber:n,shiftBy:BigInt(e)}}function fS(e,t,r){let{windowSize:i,mask:n,maxNumber:s,shiftBy:a}=r,o=Number(e&n),l=e>>a;o>i&&(o-=s,l+=fb);let c=t*i;return{nextN:l,offset:c+Math.abs(o)-1,isZero:0===o,isNeg:o<0,isNegF:t%2!=0,offsetF:c}}let fI=new WeakMap,fx=new WeakMap;function fT(e){return fx.get(e)||1}function fk(e){if(e!==fw)throw Error("invalid wNAF")}class fC{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,r=this.ZERO){let i=e;for(;t>fw;)t&fb&&(r=r.add(i)),i=i.double(),t>>=fb;return r}precomputeWindow(e,t){let{windows:r,windowSize:i}=f_(t,this.bits),n=[],s=e,a=s;for(let e=0;e<r;e++){a=s,n.push(a);for(let e=1;e<i;e++)a=a.add(s),n.push(a);s=a.double()}return n}wNAF(e,t,r){if(!this.Fn.isValid(r))throw Error("invalid scalar");let i=this.ZERO,n=this.BASE,s=f_(e,this.bits);for(let e=0;e<s.windows;e++){let{nextN:a,offset:o,isZero:l,isNeg:c,isNegF:d,offsetF:u}=fS(r,e,s);r=a,l?n=n.add(fv(d,t[u])):i=i.add(fv(c,t[o]))}return fk(r),{p:i,f:n}}wNAFUnsafe(e,t,r,i=this.ZERO){let n=f_(e,this.bits);for(let e=0;e<n.windows&&r!==fw;e++){let{nextN:s,offset:a,isZero:o,isNeg:l}=fS(r,e,n);if(r=s,!o){let e=t[a];i=i.add(l?e.negate():e)}}return fk(r),i}getPrecomputes(e,t,r){let i=fI.get(t);return i||(i=this.precomputeWindow(t,e),1!==e&&("function"==typeof r&&(i=r(i)),fI.set(t,i))),i}cached(e,t,r){let i=fT(e);return this.wNAF(i,this.getPrecomputes(i,e,r),t)}unsafe(e,t,r,i){let n=fT(e);return 1===n?this._unsafeLadder(e,t,i):this.wNAFUnsafe(n,this.getPrecomputes(n,e,r),t,i)}createCache(e,t){fA(t,this.bits),fx.set(e,t),fI.delete(e)}hasCache(e){return 1!==fT(e)}}function fP(e,t,r){if(!t)return fy(e,{isLE:r});if(t.ORDER!==e)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return p2(t,fu.reduce((e,t)=>(e[t]="function",e),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),t}BigInt(0),BigInt(1),BigInt(2),BigInt(8),u7("HashToScalar-");let fO=BigInt(0),fR=BigInt(1),fN=BigInt(2),fM=BigInt(1),fU=BigInt(2),fD=BigInt(3),fj=BigInt(5),fL=BigInt(8),fB=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),fW={p:fB,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:fL,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},fF=function(e){let{P:t,type:r,adjustScalarBytes:i,powPminus2:n,randomBytes:s}=(p2(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})),a="x25519"===r;if(!a&&"x448"!==r)throw Error("invalid type");let o=s||hi,l=a?255:448,c=a?32:56,d=BigInt(a?9:5),u=BigInt(a?121665:39081),h=a?fN**BigInt(254):fN**BigInt(447),p=h+(a?BigInt(8)*fN**BigInt(251)-fR:BigInt(4)*fN**BigInt(445)-fR)+fR,f=e=>fn(e,t),y=pG(f(d),c);function g(e,r){let s,o=function(e,r){pX("u",e,fO,t),pX("scalar",r,h,p);let i=fR,s=fO,a=e,o=fR,c=fO;for(let t=BigInt(l-1);t>=fO;t--){let n=r>>t&fR;c^=n,({x_2:i,x_3:a}=w(c,i,a)),({x_2:s,x_3:o}=w(c,s,o)),c=n;let l=i+s,d=f(l*l),h=i-s,p=f(h*h),y=d-p,g=a+o,m=f((a-o)*l),b=f(g*h),v=m+b,E=m-b;a=f(v*v),o=f(e*f(E*E)),i=f(d*p),s=f(y*(d+f(u*y)))}return{x_2:i,x_3:a}=w(c,i,a),{x_2:s,x_3:o}=w(c,s,o),f(i*n(s))}((s=pY("u coordinate",r,c),a&&(s[31]&=127),f(pJ(s))),pJ(i(pY("scalar",e,c))));if(o===fO)throw Error("invalid private or public key received");return pG(f(o),c)}function m(e){return g(e,y)}function w(e,t,r){let i=f(e*(t-r));return{x_2:t=f(t-i),x_3:r=f(r+i)}}let b={secretKey:c,publicKey:c,seed:c},v=(e=o(c))=>(uK(e,b.seed),e);return{keygen:function(e){let t=v(e);return{secretKey:t,publicKey:m(t)}},getSharedSecret:(e,t)=>g(e,t),getPublicKey:e=>m(e),scalarMult:g,scalarMultBase:m,utils:{randomSecretKey:v,randomPrivateKey:v},GuBytes:y.slice(),lengths:b}}({P:L=fy(fW.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:e=>{let t,r,i,n,s,a,o,l,c,d,u,h,p,f,{pow_p_5_8:y,b2:g}=(t=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),a=fs(s=e*e%fB*e%fB,fU,fB)*s%fB,o=fs(a,fM,fB)*e%fB,l=fs(o,fj,fB)*o%fB,c=fs(l,t,fB)*l%fB,d=fs(c,r,fB)*c%fB,u=fs(d,i,fB)*d%fB,h=fs(u,n,fB)*u%fB,p=fs(h,n,fB)*u%fB,f=fs(p,t,fB)*l%fB,{pow_p_5_8:fs(f,fU,fB)*e%fB,b2:s});return fn(fs(y,fD,L)*g,L)},adjustScalarBytes:function(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}}),fz=(e,t)=>(e+(e>=0?t:-t)/fJ)/t;function fq(e){if(!["compact","recovered","der"].includes(e))throw Error('Signature format must be "compact", "recovered", or "der"');return e}function fH(e,t){let r={};for(let i of Object.keys(t))r[i]=void 0===e[i]?t[i]:e[i];return pH(r.lowS,"lowS"),pH(r.prehash,"prehash"),void 0!==r.format&&fq(r.format),r}let fK={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(e,t)=>{let{Err:r}=fK;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(1&t.length)throw new r("tlv.encode: unpadded data");let i=t.length/2,n=p$(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");let s=i>127?p$(n.length/2|128):"";return p$(e)+s+n+t},decode(e,t){let{Err:r}=fK,i=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[i++]!==e)throw new r("tlv.decode: wrong tlv");let n=t[i++],s=0;if(128&n){let e=127&n;if(!e)throw new r("tlv.decode(long): indefinite length not supported");if(e>4)throw new r("tlv.decode(long): byte length is too big");let a=t.subarray(i,i+e);if(a.length!==e)throw new r("tlv.decode: length bytes not complete");if(0===a[0])throw new r("tlv.decode(long): zero leftmost byte");for(let e of a)s=s<<8|e;if(i+=e,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=n;let a=t.subarray(i,i+s);if(a.length!==s)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(i+s)}}},_int:{encode(e){let{Err:t}=fK;if(e<f$)throw new t("integer: negative integers are not allowed");let r=p$(e);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=fK;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return pV(u8(e))}},toSig(e){let{Err:t,_int:r,_tlv:i}=fK,n=pY("signature",e),{v:s,l:a}=i.decode(48,n);if(a.length)throw new t("invalid signature: left bytes after parsing");let{v:o,l:l}=i.decode(2,s),{v:c,l:d}=i.decode(2,l);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(o),s:r.decode(c)}},hexFromSig(e){let{_tlv:t,_int:r}=fK,i=t.encode(2,r.encode(e.r)),n=t.encode(2,r.encode(e.s));return t.encode(48,i+n)}},f$=BigInt(0),fV=BigInt(1),fJ=BigInt(2),fZ=BigInt(3),fG=BigInt(4);function fY(e,t){let r,{BYTES:i}=e;if("bigint"==typeof t)r=t;else{let n=pY("private key",t);try{r=e.fromBytes(n)}catch{throw Error(`invalid private key: expected ui8a of size ${i}, got ${typeof t}`)}}if(!e.isValidNot0(r))throw Error("invalid private key: out of range [1..N-1]");return r}function fQ(e){return Uint8Array.of(e?2:3)}function fX(e,t){return{secretKey:t.BYTES,publicKey:1+e.BYTES,publicKeyUncompressed:1+2*e.BYTES,publicKeyHasPrefix:!0,signature:2*t.BYTES}}function f0(e,t){let r=t=>(function(e){let t,{CURVE:r,curveOpts:i,hash:n,ecdsaOpts:s}=function(e){let t,r,i,n,{CURVE:s,curveOpts:a}=(t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,i=e.allowedPrivateKeyLengths?Array.from(new Set(e.allowedPrivateKeyLengths.map(e=>Math.ceil(e/2)))):void 0,n={Fp:r,Fn:fy(t.n,{BITS:e.nBitLength,allowedLengths:i,modFromBytes:e.wrapPrivateKey}),allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes},{CURVE:t,curveOpts:n}),o={hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:s,curveOpts:a,hash:e.hash,ecdsaOpts:o}}(e),a=function(e,t,r={}){u$(t),p2(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let i=r.randomBytes||hi,n=r.hmac||((e,...r)=>pB(t,e,he(...r))),{Fp:s,Fn:a}=e,{ORDER:o,BITS:l}=a,{keygen:c,getPublicKey:d,getSharedSecret:u,utils:h,lengths:p}=function(e,t={}){let{Fn:r}=e,i=t.randomBytes||hi,n=Object.assign(fX(e.Fp,r),{seed:fm(r.ORDER)});function s(e){try{return!!fY(r,e)}catch{return!1}}function a(e=i(n.seed)){return function(e,t,r=!1){let i=e.length,n=fg(t),s=fm(t);if(i<16||i<s||i>1024)throw Error("expected "+s+"-1024 bytes of input, got "+i);let a=fn(r?pJ(e):pV(u8(e)),t-p8)+p8;return r?pG(a,n):pZ(a,n)}(pK(e,n.seed,"seed"),r.ORDER)}function o(t,i=!0){return e.BASE.multiply(fY(r,t)).toBytes(i)}function l(t){if("bigint"==typeof t)return!1;if(t instanceof e)return!0;let{secretKey:i,publicKey:s,publicKeyUncompressed:a}=n;if(r.allowedLengths||i===s)return;let o=pY("key",t).length;return o===s||o===a}return Object.freeze({getPublicKey:o,getSharedSecret:function(t,i,n=!0){if(!0===l(t))throw Error("first arg must be private key");if(!1===l(i))throw Error("second arg must be public key");let s=fY(r,t);return e.fromHex(i).multiply(s).toBytes(n)},keygen:function(e){let t=a(e);return{secretKey:t,publicKey:o(t)}},Point:e,utils:{isValidSecretKey:s,isValidPublicKey:function(t,r){let{publicKey:i,publicKeyUncompressed:s}=n;try{let n=t.length;return(!0!==r||n===i)&&(!1!==r||n===s)&&!!e.fromBytes(t)}catch{return!1}},randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:e=>fY(r,e),precompute:(t=8,r=e.BASE)=>r.precompute(t,!1)},lengths:n})}(e,r),f={prehash:!1,lowS:"boolean"==typeof r.lowS&&r.lowS,format:void 0,extraEntropy:!1},y="compact";function g(e,t){if(!a.isValidNot0(t))throw Error(`invalid signature ${e}: out of range 1..Point.Fn.ORDER`);return t}class m{constructor(e,t,r){this.r=g("r",e),this.s=g("s",t),null!=r&&(this.recovery=r),Object.freeze(this)}static fromBytes(e,t=y){var r,i;let n,s;if(r=e,fq(i=t),s=p.signature,pK(r,"compact"===i?s:"recovered"===i?s+1:void 0,`${i} signature`),"der"===t){let{r:t,s:r}=fK.toSig(pK(e));return new m(t,r)}"recovered"===t&&(n=e[0],t="compact",e=e.subarray(1));let o=a.BYTES,l=e.subarray(0,o),c=e.subarray(o,2*o);return new m(a.fromBytes(l),a.fromBytes(c),n)}static fromHex(e,t){return this.fromBytes(u4(e),t)}addRecoveryBit(e){return new m(this.r,this.s,e)}recoverPublicKey(t){let r=s.ORDER,{r:i,s:n,recovery:l}=this;if(null==l||![0,1,2,3].includes(l))throw Error("recovery id invalid");if(o*fJ<r&&l>1)throw Error("recovery id is ambiguous for h>1 curve");let c=2===l||3===l?i+o:i;if(!s.isValid(c))throw Error("recovery id 2 or 3 invalid");let d=s.toBytes(c),u=e.fromBytes(he(fQ((1&l)==0),d)),h=a.inv(c),p=b(pY("msgHash",t)),f=a.create(-p*h),y=a.create(n*h),g=e.BASE.multiplyUnsafe(f).add(u.multiplyUnsafe(y));if(g.is0())throw Error("point at infinify");return g.assertValidity(),g}hasHighS(){return this.s>o>>fV}toBytes(e=y){if(fq(e),"der"===e)return u4(fK.hexFromSig(this));let t=a.toBytes(this.r),r=a.toBytes(this.s);if("recovered"===e){if(null==this.recovery)throw Error("recovery bit must be present");return he(Uint8Array.of(this.recovery),t,r)}return he(t,r)}toHex(e){return u8(this.toBytes(e))}assertValidity(){}static fromCompact(e){return m.fromBytes(pY("sig",e),"compact")}static fromDER(e){return m.fromBytes(pY("sig",e),"der")}normalizeS(){return this.hasHighS()?new m(this.r,a.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return u8(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return u8(this.toBytes("compact"))}}let w=r.bits2int||function(e){if(e.length>8192)throw Error("input is too large");let t=pV(u8(e)),r=8*e.length-l;return r>0?t>>BigInt(r):t},b=r.bits2int_modN||function(e){return a.create(w(e))},v=p1(l);function E(e){return pX("num < 2^"+l,e,f$,v),a.toBytes(e)}function A(e,r){return pK(e,void 0,"message"),r?pK(t(e),void 0,"prehashed message"):e}return Object.freeze({keygen:c,getPublicKey:d,getSharedSecret:u,utils:h,lengths:p,Point:e,sign:function(r,s,l={}){let{seed:c,k2sig:d}=function(t,r,n){if(["recovered","canonical"].some(e=>e in n))throw Error("sign() legacy options not supported");let{lowS:s,prehash:l,extraEntropy:c}=fH(n,f),d=b(t=A(t,l)),u=fY(a,r),h=[E(u),E(d)];if(null!=c&&!1!==c){let e=!0===c?i(p.secretKey):c;h.push(pY("extraEntropy",e))}return{seed:he(...h),k2sig:function(t){let r=w(t);if(!a.isValidNot0(r))return;let i=a.inv(r),n=e.BASE.multiply(r).toAffine(),l=a.create(n.x);if(l===f$)return;let c=a.create(i*a.create(d+l*u));if(c===f$)return;let h=2*(n.x!==l)|Number(n.y&fV),p=c;return s&&c>o>>fV&&(p=a.neg(c),h^=1),new m(l,p,h)}}}(r=pY("message",r),s,l);return(function(e,t,r){if("number"!=typeof e||e<2)throw Error("hashLen must be a number");if("number"!=typeof t||t<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let i=e=>new Uint8Array(e),n=i(e),s=i(e),a=0,o=()=>{n.fill(1),s.fill(0),a=0},l=(...e)=>r(s,n,...e),c=(e=i(0))=>{s=l(Uint8Array.of(0),e),n=l(),0!==e.length&&(s=l(Uint8Array.of(1),e),n=l())},d=()=>{if(a++>=1e3)throw Error("drbg: tried 1000 values");let e=0,r=[];for(;e<t;){let t=(n=l()).slice();r.push(t),e+=n.length}return he(...r)};return(e,t)=>{let r;for(o(),c(e);!(r=t(d()));)c();return o(),r}})(t.outputLen,a.BYTES,n)(c,d)},verify:function(t,r,i,n={}){let{lowS:s,prehash:o,format:l}=fH(n,f);if(i=pY("publicKey",i),r=A(pY("message",r),o),"strict"in n)throw Error("options.strict was renamed to lowS");let c=void 0===l?function(e){let t,r="string"==typeof e||uq(e),i=!r&&null!==e&&"object"==typeof e&&"bigint"==typeof e.r&&"bigint"==typeof e.s;if(!r&&!i)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(i)t=new m(e.r,e.s);else if(r){try{t=m.fromBytes(pY("sig",e),"der")}catch(e){if(!(e instanceof fK.Err))throw e}if(!t)try{t=m.fromBytes(pY("sig",e),"compact")}catch{return!1}}return t||!1}(t):m.fromBytes(pY("sig",t),l);if(!1===c)return!1;try{let t=e.fromBytes(i);if(s&&c.hasHighS())return!1;let{r:n,s:o}=c,l=b(r),d=a.inv(o),u=a.create(l*d),h=a.create(n*d),p=e.BASE.multiplyUnsafe(u).add(t.multiplyUnsafe(h));return!p.is0()&&a.create(p.x)===n}catch{return!1}},recoverPublicKey:function(e,t,r={}){let{prehash:i}=fH(r,f);return t=A(t,i),m.fromBytes(e,"recovered").recoverPublicKey(t).toBytes()},Signature:m,hash:t})}(function(e,t={}){let r=function(e,t,r={},i){if(void 0===i&&(i="edwards"===e),!t||"object"!=typeof t)throw Error(`expected valid ${e} CURVE object`);for(let e of["p","n","h"]){let r=t[e];if(!("bigint"==typeof r&&r>fw))throw Error(`CURVE.${e} must be positive bigint`)}let n=fP(t.p,r.Fp,i),s=fP(t.n,r.Fn,i);for(let r of["Gx","Gy","a","weierstrass"===e?"b":"d"])if(!n.isValid(t[r]))throw Error(`CURVE.${r} must be valid field element of CURVE.Fp`);return{CURVE:t=Object.freeze(Object.assign({},t)),Fp:n,Fn:s}}("weierstrass",e,t),{Fp:i,Fn:n}=r,s=r.CURVE,{h:a,n:o}=s;p2(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:l}=t;if(l&&(!i.is0(s.a)||"bigint"!=typeof l.beta||!Array.isArray(l.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let c=fX(i,n);function d(){if(!i.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let u=t.toBytes||function(e,t,r){let{x:n,y:s}=t.toAffine(),a=i.toBytes(n);return(pH(r,"isCompressed"),r)?(d(),he(fQ(!i.isOdd(s)),a)):he(Uint8Array.of(4),a,i.toBytes(s))},h=t.fromBytes||function(e){pK(e,void 0,"Point");let{publicKey:t,publicKeyUncompressed:r}=c,n=e.length,s=e[0],a=e.subarray(1);if(n===t&&(2===s||3===s)){let e,t=i.fromBytes(a);if(!i.isValid(t))throw Error("bad point: is not on curve, wrong x");let r=p(t);try{e=i.sqrt(r)}catch(e){throw Error("bad point: is not on curve, sqrt error"+(e instanceof Error?": "+e.message:""))}return d(),(1&s)==1!==i.isOdd(e)&&(e=i.neg(e)),{x:t,y:e}}if(n===r&&4===s){let e=i.BYTES,t=i.fromBytes(a.subarray(0,e)),r=i.fromBytes(a.subarray(e,2*e));if(!f(t,r))throw Error("bad point: is not on curve");return{x:t,y:r}}throw Error(`bad point: got length ${n}, expected compressed=${t} or uncompressed=${r}`)};function p(e){let t=i.sqr(e),r=i.mul(t,e);return i.add(i.add(r,i.mul(e,s.a)),s.b)}function f(e,t){let r=i.sqr(t),n=p(e);return i.eql(r,n)}if(!f(s.Gx,s.Gy))throw Error("bad curve params: generator point");let y=i.mul(i.pow(s.a,fZ),fG),g=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(y,g)))throw Error("bad curve params: a or b");function m(e,t,r=!1){if(!i.isValid(t)||r&&i.is0(t))throw Error(`bad point coordinate ${e}`);return t}function w(e){if(!(e instanceof _))throw Error("ProjectivePoint expected")}function b(e){if(!l||!l.basises)throw Error("no endo");return function(e,t,r){let[[i,n],[s,a]]=t,o=fz(a*e,r),l=fz(-n*e,r),c=e-o*i-l*s,d=-o*n-l*a,u=c<f$,h=d<f$;u&&(c=-c),h&&(d=-d);let p=p1(Math.ceil(p0(r)/2))+fV;if(c<f$||c>=p||d<f$||d>=p)throw Error("splitScalar (endomorphism): failed, k="+e);return{k1neg:u,k1:c,k2neg:h,k2:d}}(e,l.basises,n.ORDER)}let v=p3((e,t)=>{let{X:r,Y:n,Z:s}=e;if(i.eql(s,i.ONE))return{x:r,y:n};let a=e.is0();null==t&&(t=a?i.ONE:i.inv(s));let o=i.mul(r,t),l=i.mul(n,t),c=i.mul(s,t);if(a)return{x:i.ZERO,y:i.ZERO};if(!i.eql(c,i.ONE))throw Error("invZ was invalid");return{x:o,y:l}}),E=p3(e=>{if(e.is0()){if(t.allowInfinityPoint&&!i.is0(e.Y))return;throw Error("bad point: ZERO")}let{x:r,y:n}=e.toAffine();if(!i.isValid(r)||!i.isValid(n))throw Error("bad point: x or y not field elements");if(!f(r,n))throw Error("bad point: equation left != right");if(!e.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function A(e,t,r,n,s){return r=new _(i.mul(r.X,e),r.Y,r.Z),t=fv(n,t),r=fv(s,r),t.add(r)}class _{constructor(e,t,r){this.X=m("x",e),this.Y=m("y",t,!0),this.Z=m("z",r),Object.freeze(this)}static CURVE(){return s}static fromAffine(e){let{x:t,y:r}=e||{};if(!e||!i.isValid(t)||!i.isValid(r))throw Error("invalid affine point");if(e instanceof _)throw Error("projective point not allowed");return i.is0(t)&&i.is0(r)?_.ZERO:new _(t,r,i.ONE)}static fromBytes(e){let t=_.fromAffine(h(pK(e,void 0,"point")));return t.assertValidity(),t}static fromHex(e){return _.fromBytes(pY("pointHex",e))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(e=8,t=!0){return I.createCache(this,e),t||this.multiply(fZ),this}assertValidity(){E(this)}hasEvenY(){let{y:e}=this.toAffine();if(!i.isOdd)throw Error("Field doesn't support isOdd");return!i.isOdd(e)}equals(e){w(e);let{X:t,Y:r,Z:n}=this,{X:s,Y:a,Z:o}=e,l=i.eql(i.mul(t,o),i.mul(s,n)),c=i.eql(i.mul(r,o),i.mul(a,n));return l&&c}negate(){return new _(this.X,i.neg(this.Y),this.Z)}double(){let{a:e,b:t}=s,r=i.mul(t,fZ),{X:n,Y:a,Z:o}=this,l=i.ZERO,c=i.ZERO,d=i.ZERO,u=i.mul(n,n),h=i.mul(a,a),p=i.mul(o,o),f=i.mul(n,a);return f=i.add(f,f),d=i.mul(n,o),d=i.add(d,d),l=i.mul(e,d),c=i.mul(r,p),c=i.add(l,c),l=i.sub(h,c),c=i.add(h,c),c=i.mul(l,c),l=i.mul(f,l),d=i.mul(r,d),p=i.mul(e,p),f=i.sub(u,p),f=i.mul(e,f),f=i.add(f,d),d=i.add(u,u),u=i.add(d,u),u=i.add(u,p),u=i.mul(u,f),c=i.add(c,u),p=i.mul(a,o),p=i.add(p,p),u=i.mul(p,f),l=i.sub(l,u),d=i.mul(p,h),d=i.add(d,d),new _(l,c,d=i.add(d,d))}add(e){w(e);let{X:t,Y:r,Z:n}=this,{X:a,Y:o,Z:l}=e,c=i.ZERO,d=i.ZERO,u=i.ZERO,h=s.a,p=i.mul(s.b,fZ),f=i.mul(t,a),y=i.mul(r,o),g=i.mul(n,l),m=i.add(t,r),b=i.add(a,o);m=i.mul(m,b),b=i.add(f,y),m=i.sub(m,b),b=i.add(t,n);let v=i.add(a,l);return b=i.mul(b,v),v=i.add(f,g),b=i.sub(b,v),v=i.add(r,n),c=i.add(o,l),v=i.mul(v,c),c=i.add(y,g),v=i.sub(v,c),u=i.mul(h,b),c=i.mul(p,g),u=i.add(c,u),c=i.sub(y,u),u=i.add(y,u),d=i.mul(c,u),y=i.add(f,f),y=i.add(y,f),g=i.mul(h,g),b=i.mul(p,b),y=i.add(y,g),g=i.sub(f,g),g=i.mul(h,g),b=i.add(b,g),f=i.mul(y,b),d=i.add(d,f),f=i.mul(v,b),c=i.mul(m,c),c=i.sub(c,f),f=i.mul(m,y),u=i.mul(v,u),new _(c,d,u=i.add(u,f))}subtract(e){return this.add(e.negate())}is0(){return this.equals(_.ZERO)}multiply(e){let r,i,{endo:s}=t;if(!n.isValidNot0(e))throw Error("invalid scalar: out of range");let a=e=>I.cached(this,e,e=>fE(_,e));if(s){let{k1neg:t,k1:n,k2neg:o,k2:l}=b(e),{p:c,f:d}=a(n),{p:u,f:h}=a(l);i=d.add(h),r=A(s.beta,c,u,t,o)}else{let{p:t,f:n}=a(e);r=t,i=n}return fE(_,[r,i])[0]}multiplyUnsafe(e){let{endo:r}=t;if(!n.isValid(e))throw Error("invalid scalar: out of range");if(e===f$||this.is0())return _.ZERO;if(e===fV)return this;if(I.hasCache(this))return this.multiply(e);if(!r)return I.unsafe(this,e);{let{k1neg:t,k1:i,k2neg:n,k2:s}=b(e),{p1:a,p2:o}=function(e,t,r,i){let n=t,s=e.ZERO,a=e.ZERO;for(;r>fw||i>fw;)r&fb&&(s=s.add(n)),i&fb&&(a=a.add(n)),n=n.double(),r>>=fb,i>>=fb;return{p1:s,p2:a}}(_,this,i,s);return A(r.beta,a,o,t,n)}}multiplyAndAddUnsafe(e,t,r){let i=this.multiplyUnsafe(t).add(e.multiplyUnsafe(r));return i.is0()?void 0:i}toAffine(e){return v(this,e)}isTorsionFree(){let{isTorsionFree:e}=t;return a===fV||(e?e(_,this):I.unsafe(this,o).is0())}clearCofactor(){let{clearCofactor:e}=t;return a===fV?this:e?e(_,this):this.multiplyUnsafe(a)}isSmallOrder(){return this.multiplyUnsafe(a).is0()}toBytes(e=!0){return pH(e,"isCompressed"),this.assertValidity(),u(_,this,e)}toHex(e=!0){return u8(this.toBytes(e))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(e=!0){return this.toBytes(e)}_setWindowSize(e){this.precompute(e)}static normalizeZ(e){return fE(_,e)}static msm(e,t){return function(e,t,r,i){(function(e,t){if(!Array.isArray(e))throw Error("array expected");e.forEach((e,r)=>{if(!(e instanceof t))throw Error("invalid point at index "+r)})})(r,e),function(e,t){if(!Array.isArray(e))throw Error("array of scalars expected");e.forEach((e,r)=>{if(!t.isValid(e))throw Error("invalid scalar at index "+r)})}(i,t);let n=r.length,s=i.length;if(n!==s)throw Error("arrays of points and scalars must have equal length");let a=e.ZERO,o=p0(BigInt(n)),l=1;o>12?l=o-3:o>4?l=o-2:o>0&&(l=2);let c=p1(l),d=Array(Number(c)+1).fill(a),u=Math.floor((t.BITS-1)/l)*l,h=a;for(let e=u;e>=0;e-=l){d.fill(a);for(let t=0;t<s;t++){let n=Number(i[t]>>BigInt(e)&c);d[n]=d[n].add(r[t])}let t=a;for(let e=d.length-1,r=a;e>0;e--)r=r.add(d[e]),t=t.add(r);if(h=h.add(t),0!==e)for(let e=0;e<l;e++)h=h.double()}return h}(_,n,e,t)}static fromPrivateKey(e){return _.BASE.multiply(fY(n,e))}}_.BASE=new _(s.Gx,s.Gy,i.ONE),_.ZERO=new _(i.ZERO,i.ONE,i.ZERO),_.Fp=i,_.Fn=n;let S=n.BITS,I=new fC(_,t.endo?Math.ceil(S/2):S);return _.BASE.precompute(8),_}(r,i),n,s);return t=a.Point,Object.assign({},a,{ProjectivePoint:t,CURVE:Object.assign({},e,ff(t.Fn.ORDER,t.Fn.BITS))})})({...e,hash:t});return{...r(t),create:r}}let f1={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},f2={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},f3={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},f5=fy(f1.p),f8=fy(f2.p),f6=fy(f3.p),f4=f0({...f1,Fp:f5,lowS:!1},hD);f0({...f2,Fp:f8,lowS:!1},hL),f0({...f3,Fp:f6,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},hj);let f7="base10",f9="base16",ye="base64pad",yt="base64url",yr="utf8";function yi(){let e=hi(32);return(0,db.toString)(e,f9)}function yn(e){let t=hD((0,dv.fromString)(e,f9));return(0,db.toString)(t,f9)}function ys(e){let t=hD((0,dv.fromString)(e,yr));return(0,db.toString)(t,f9)}function ya(e){return(0,dv.fromString)(`${e}`,f7)}function yo(e){return Number((0,db.toString)(e,f7))}function yl(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function yc(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4;return t+"=".repeat(r)}function yd(e){if(2===yo(e.type))return(0,db.toString)((0,dE.concat)([e.type,e.sealed]),ye);if(1===yo(e.type)){if(typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,db.toString)((0,dE.concat)([e.type,e.senderPublicKey,e.iv,e.sealed]),ye)}return(0,db.toString)((0,dE.concat)([e.type,e.iv,e.sealed]),ye)}function yu(e){let t=(e.encoding||ye)===yt?yc(e.encoded):e.encoded,r=(0,dv.fromString)(t,ye),i=r.slice(0,1);if(1===yo(i)){let e=r.slice(1,33),t=r.slice(33,45);return{type:i,sealed:r.slice(45),iv:t,senderPublicKey:e}}if(2===yo(i))return{type:i,sealed:r.slice(1),iv:hi(12)};let n=r.slice(1,13);return{type:i,sealed:r.slice(13),iv:n}}function yh(e){let t=e?.type||0;if(1===t){if(typeof e?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof e?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:t,senderPublicKey:e?.senderPublicKey,receiverPublicKey:e?.receiverPublicKey}}function yp(e){return 1===e.type&&"string"==typeof e.senderPublicKey&&"string"==typeof e.receiverPublicKey}function yf(e){return e?.relay||{protocol:"irn"}}function yy(e){let t=dA.RELAY_JSONRPC[e];if(typeof t>"u")throw Error(`Relay Protocol not supported: ${e}`);return t}var yg=Object.defineProperty,ym=Object.defineProperties,yw=Object.getOwnPropertyDescriptors,yb=Object.getOwnPropertySymbols,yv=Object.prototype.hasOwnProperty,yE=Object.prototype.propertyIsEnumerable,yA=(e,t,r)=>t in e?yg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,y_=(e,t)=>{for(var r in t||(t={}))yv.call(t,r)&&yA(e,r,t[r]);if(yb)for(var r of yb(t))yE.call(t,r)&&yA(e,r,t[r]);return e};function yS(e){var t;if(!e.includes("wc:")){let t=u_(e);null!=t&&t.includes("wc:")&&(e=t)}let r=(e=(e=e.includes("wc://")?e.replace("wc://",""):e).includes("wc:")?e.replace("wc:",""):e).indexOf(":"),i=-1!==e.indexOf("?")?e.indexOf("?"):void 0,n=e.substring(0,r),s=e.substring(r+1,i).split("@"),a=Object.fromEntries(new URLSearchParams("u">typeof i?e.substring(i):"").entries()),o="string"==typeof a.methods?a.methods.split(","):void 0;return{protocol:n,topic:(t=s[0]).startsWith("//")?t.substring(2):t,version:parseInt(s[1],10),symKey:a.symKey,relay:function(e,t="-"){let r={},i="relay"+t;return Object.keys(e).forEach(t=>{if(t.startsWith(i)){let n=t.replace(i,""),s=e[t];r[n]=s}}),r}(a),methods:o,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function yI(e){let t=new URLSearchParams;return Object.entries(y_(y_(ym(y_({},function(e,t="-"){let r={};return Object.keys(e).forEach(i=>{e[i]&&(r["relay"+t+i]=e[i])}),r}(e.relay)),yw({symKey:e.symKey})),e.expiryTimestamp&&{expiryTimestamp:e.expiryTimestamp.toString()}),e.methods&&{methods:e.methods.join(",")})).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,r])=>{void 0!==r&&t.append(e,String(r))}),`${e.protocol}:${e.topic}@${e.version}?${t}`}function yx(e,t,r){return`${e}?wc_ev=${r}&topic=${t}`}var yT=Object.defineProperty,yk=Object.defineProperties,yC=Object.getOwnPropertyDescriptors,yP=Object.getOwnPropertySymbols,yO=Object.prototype.hasOwnProperty,yR=Object.prototype.propertyIsEnumerable,yN=(e,t,r)=>t in e?yT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yM=(e,t)=>{for(var r in t||(t={}))yO.call(t,r)&&yN(e,r,t[r]);if(yP)for(var r of yP(t))yR.call(t,r)&&yN(e,r,t[r]);return e},yU=(e,t)=>yk(e,yC(t));function yD(e){let t=[];return e.forEach(e=>{let[r,i]=e.split(":");t.push(`${r}:${i}`)}),t}function yj(e){return e.includes(":")}function yL(e){return yj(e)?e.split(":")[0]:e}function yB(e){var t,r,i;let n={};if(!y$(e))return n;for(let[s,a]of Object.entries(e)){let e=yj(s)?[s]:a.chains,o=a.methods||[],l=a.events||[],c=yL(s);n[c]=yU(yM({},n[c]),{chains:um(e,null==(t=n[c])?void 0:t.chains),methods:um(o,null==(r=n[c])?void 0:r.methods),events:um(l,null==(i=n[c])?void 0:i.events)})}return n}function yW(e,t){var r;let i,n=(r=t=t.map(e=>e.replace("did:pkh:","")),i={},r?.forEach(e=>{var t;let[r,n]=e.split(":");i[r]||(i[r]={accounts:[],chains:[],events:[],methods:[]}),i[r].accounts.push(e),null==(t=i[r].chains)||t.push(`${r}:${n}`)}),i);for(let[t,r]of Object.entries(n))r.methods?r.methods=um(r.methods,e):r.methods=e,r.events=["chainChanged","accountsChanged"];return n}let yF={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},yz={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function yq(e,t){let{message:r,code:i}=yz[e];return{message:t?`${r} ${t}`:r,code:i}}function yH(e,t){let{message:r,code:i}=yF[e];return{message:t?`${r} ${t}`:r,code:i}}function yK(e,t){return!!Array.isArray(e)&&(!("u">typeof t)||!e.length||e.every(t))}function y$(e){return Object.getPrototypeOf(e)===Object.prototype&&Object.keys(e).length}function yV(e){return typeof e>"u"}function yJ(e,t){return!!(t&&yV(e))||"string"==typeof e&&!!e.trim().length}function yZ(e,t){return!!(t&&yV(e))||"number"==typeof e&&!isNaN(e)}function yG(e){return!!(yJ(e,!1)&&e.includes(":"))&&2===e.split(":").length}function yY(e){let t=!0;return yK(e)?e.length&&(t=e.every(e=>yJ(e,!1))):t=!1,t}function yQ(e,t){let r=null;return Object.values(e).forEach(e=>{var i;let n;if(r)return;let s=(i=`${t}, namespace`,n=null,yY(e?.methods)?yY(e?.events)||(n=yH("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):n=yH("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),n);s&&(r=s)}),r}function yX(e,t){let r=null;if(e&&y$(e)){let i,n=yQ(e,t);n&&(r=n);let s=(i=null,Object.values(e).forEach(e=>{var r,n;let s;if(i)return;let a=(r=e?.accounts,n=`${t} namespace`,s=null,yK(r)?r.forEach(e=>{s||function(e){if(yJ(e,!1)&&e.includes(":")){let t=e.split(":");if(3===t.length){let e=t[0]+":"+t[1];return!!t[2]&&yG(e)}}return!1}(e)||(s=yH("UNSUPPORTED_ACCOUNTS",`${n}, account ${e} should be a string and conform to "namespace:chainId:address" format`))}):s=yH("UNSUPPORTED_ACCOUNTS",`${n}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s);a&&(i=a)}),i);s&&(r=s)}else r=yq("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function y0(e){return yJ(e.protocol,!0)}function y1(e){return"u">typeof e}function y2(e,t){let r;return!(!yG(t)||!(r=[],Object.values(e).forEach(e=>{r.push(...yD(e.accounts))}),r).includes(t))}function y3(e,t,r){var i,n;let s,a,o=null,l=(s={},Object.keys(i=e).forEach(e=>{var t;e.includes(":")?s[e]=i[e]:null==(t=i[e].chains)||t.forEach(t=>{s[t]={methods:i[e].methods,events:i[e].events}})}),s),c=(a={},Object.keys(n=t).forEach(e=>{if(e.includes(":"))a[e]=n[e];else{let t=yD(n[e].accounts);t?.forEach(t=>{a[t]={accounts:n[e].accounts.filter(e=>e.includes(`${t}:`)),methods:n[e].methods,events:n[e].events}})}}),a),d=Object.keys(l),u=Object.keys(c),h=y5(Object.keys(e)),p=y5(Object.keys(t)),f=h.filter(e=>!p.includes(e));return f.length&&(o=yq("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(t).toString()}`)),uo(d,u)||(o=yq("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${u.toString()}`)),Object.keys(t).forEach(e=>{if(!e.includes(":")||o)return;let i=yD(t[e].accounts);i.includes(e)||(o=yq("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${e}
        Required: ${e}
        Approved: ${i.toString()}`))}),d.forEach(e=>{o||(uo(l[e].methods,c[e].methods)?uo(l[e].events,c[e].events)||(o=yq("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${e}`)):o=yq("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${e}`))}),o}function y5(e){return[...new Set(e.map(e=>e.includes(":")?e.split(":")[0]:e))]}function y8(){let e=ui();return new Promise(t=>{switch(e){case d9:t(ur()&&navigator?.onLine);break;case d4:t(y6());break;default:t(!0)}})}async function y6(){if(ut()&&null!=e.g&&e.g.NetInfo){let t=await (null==e.g?void 0:e.g.NetInfo.fetch());return t?.isConnected}return!0}let y4={};class y7{static get(e){return y4[e]}static set(e,t){y4[e]=t}static delete(e){delete y4[e]}}function y9(e){return new Uint8Array(e.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function ge({logger:e,name:t}){let r="string"==typeof e?dJ({opts:{level:e,name:t}}).logger:e;return r.level="string"==typeof e?e:e.level,r}var gt=e.i(824064),gr=e.i(717618);e.i(315903);var gi=e.i(506003),gn=Object.defineProperty,gs=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?gn(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class ga extends gi.IEvents{constructor(e){super(),this.opts=e,gs(this,"protocol","wc"),gs(this,"version",2)}}var go=Object.defineProperty;class gl extends gi.IEvents{constructor(e,t){super(),this.core=e,this.logger=t,((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?go(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"records",new Map)}}class gc{constructor(e,t){this.logger=e,this.core=t}}class gd extends gi.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}class gu extends gi.IEvents{constructor(e){super()}}class gh{constructor(e,t,r,i){this.core=e,this.logger=t,this.name=r}}class gp extends gi.IEvents{constructor(e,t){super(),this.relayer=e,this.logger=t}}class gf extends gi.IEvents{constructor(e,t){super(),this.core=e,this.logger=t}}class gy{constructor(e,t,r){this.core=e,this.logger=t,this.store=r}}class gg{constructor(e,t){this.projectId=e,this.logger=t}}class gm{constructor(e,t,r){this.core=e,this.logger=t,this.telemetryEnabled=r}}var gw=Object.defineProperty,gb=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?gw(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};oH.default;class gv{constructor(e){this.opts=e,gb(this,"protocol","wc"),gb(this,"version",2)}}oH.EventEmitter;class gE{constructor(e){this.client=e}}var gA=e.i(630510);e.i(808636);var g_=e.i(599531),gS=e.i(846695),gI=e.i(537910);let gx="core",gT=`wc@2:${gx}:`,gk={database:":memory:"},gC="client_ed25519_seed",gP=o$.ONE_DAY,gO=o$.SIX_HOURS,gR="wss://relay.walletconnect.org",gN="relayer_message",gM="relayer_message_ack",gU="relayer_connection_stalled",gD="relayer_publish",gj="payload",gL="connect",gB="disconnect",gW="error",gF="2.22.4",gz="link_mode",gq="relay",gH="inbound",gK="WALLETCONNECT_LINK_MODE_APPS",g$="subscription_created",gV="subscription_deleted",gJ=(o$.THIRTY_DAYS,o$.FIVE_SECONDS,o$.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:o$.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:o$.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:o$.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:o$.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:o$.ONE_DAY,prompt:!1,tag:0},res:{ttl:o$.ONE_DAY,prompt:!1,tag:0}}}),gZ="pairing_create",gG="pairing_delete",gY="history_created",gQ="history_updated",gX="history_deleted",g0="expirer_created",g1="expirer_deleted",g2="expirer_expired",g3=(o$.ONE_DAY,"https://verify.walletconnect.org"),g5=`${g3}/v3`,g8=["https://verify.walletconnect.com",g3],g6="malformed_pairing_uri",g4="session_approve_started";var g7=function(e,t){if(e.length>=255)throw TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<e.length;n++){var s=e.charAt(n),a=s.charCodeAt(0);if(255!==r[a])throw TypeError(s+" is ambiguous");r[a]=n}var o=e.length,l=e.charAt(0),c=Math.log(o)/Math.log(256),d=Math.log(256)/Math.log(o);function u(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[0]){for(var i=0,n=0;e[t]===l;)i++,t++;for(var s=(e.length-t)*c+1>>>0,a=new Uint8Array(s);e[t];){var d=r[e.charCodeAt(t)];if(255===d)return;for(var u=0,h=s-1;(0!==d||u<n)&&-1!==h;h--,u++)d+=o*a[h]>>>0,a[h]=d%256>>>0,d=d/256>>>0;if(0!==d)throw Error("Non-zero carry");n=u,t++}if(" "!==e[t]){for(var p=s-n;p!==s&&0===a[p];)p++;for(var f=new Uint8Array(i+(s-p)),y=i;p!==s;)f[y++]=a[p++];return f}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,i=0,n=0,s=t.length;n!==s&&0===t[n];)n++,r++;for(var a=(s-n)*d+1>>>0,c=new Uint8Array(a);n!==s;){for(var u=t[n],h=0,p=a-1;(0!==u||h<i)&&-1!==p;p--,h++)u+=256*c[p]>>>0,c[p]=u%o>>>0,u=u/o>>>0;if(0!==u)throw Error("Non-zero carry");i=h,n++}for(var f=a-i;f!==a&&0===c[f];)f++;for(var y=l.repeat(r);f<a;++f)y+=e.charAt(c[f]);return y},decodeUnsafe:u,decode:function(e){var r=u(e);if(r)return r;throw Error(`Non-${t} character`)}}};let g9=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Unknown type, must be binary type")};class me{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class mt{constructor(e,t,r){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return mi(this,e)}}class mr{constructor(e){this.decoders=e}or(e){return mi(this,e)}decode(e){let t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let mi=(e,t)=>new mr({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class mn{constructor(e,t,r,i){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=i,this.encoder=new me(e,t,r),this.decoder=new mt(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}let ms=({name:e,prefix:t,encode:r,decode:i})=>new mn(e,t,r,i),ma=({prefix:e,name:t,alphabet:r})=>{let{encode:i,decode:n}=g7(r,t);return ms({prefix:e,name:t,encode:i,decode:e=>g9(n(e))})},mo=({name:e,prefix:t,bitsPerChar:r,alphabet:i})=>ms({prefix:t,name:e,encode:e=>((e,t,r)=>{let i="="===t[t.length-1],n=(1<<r)-1,s="",a=0,o=0;for(let i=0;i<e.length;++i)for(o=o<<8|e[i],a+=8;a>r;)a-=r,s+=t[n&o>>a];if(a&&(s+=t[n&o<<r-a]),i)for(;s.length*r&7;)s+="=";return s})(e,i,r),decode:t=>((e,t,r,i)=>{let n={};for(let e=0;e<t.length;++e)n[t[e]]=e;let s=e.length;for(;"="===e[s-1];)--s;let a=new Uint8Array(s*r/8|0),o=0,l=0,c=0;for(let t=0;t<s;++t){let s=n[e[t]];if(void 0===s)throw SyntaxError(`Non-${i} character`);l=l<<r|s,(o+=r)>=8&&(o-=8,a[c++]=255&l>>o)}if(o>=r||255&l<<8-o)throw SyntaxError("Unexpected end of data");return a})(t,i,r,e)});var ml=Object.freeze({__proto__:null,identity:ms({prefix:"\0",name:"identity",encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)})}),mc=Object.freeze({__proto__:null,base2:mo({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),md=Object.freeze({__proto__:null,base8:mo({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),mu=Object.freeze({__proto__:null,base10:ma({prefix:"9",name:"base10",alphabet:"0123456789"})}),mh=Object.freeze({__proto__:null,base16:mo({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:mo({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),mp=Object.freeze({__proto__:null,base32:mo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:mo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:mo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:mo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:mo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:mo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:mo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:mo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:mo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),mf=Object.freeze({__proto__:null,base36:ma({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:ma({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),my=Object.freeze({__proto__:null,base58btc:ma({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:ma({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),mg=Object.freeze({__proto__:null,base64:mo({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:mo({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:mo({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:mo({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let mm=Array.from(""),mw=mm.reduce((e,t,r)=>(e[r]=t,e),[]),mb=mm.reduce((e,t,r)=>(e[t.codePointAt(0)]=r,e),[]);var mv=Object.freeze({__proto__:null,base256emoji:ms({prefix:"",name:"base256emoji",encode:function(e){return e.reduce((e,t)=>e+=mw[t],"")},decode:function(e){let t=[];for(let r of e){let e=mb[r.codePointAt(0)];if(void 0===e)throw Error(`Non-base256emoji character: ${r}`);t.push(e)}return new Uint8Array(t)}})});function mE(e,t,r){t=t||[],r=r||0;for(var i=r;e>=0x80000000;)t[r++]=255&e|128,e/=128;for(;-128&e;)t[r++]=255&e|128,e>>>=7;return t[r]=0|e,mE.bytes=r-i+1,t}var mA=function(e){return e<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:e<0x800000000?5:e<0x40000000000?6:e<0x2000000000000?7:e<0x100000000000000?8:e<0x8000000000000000?9:10};let m_=(e,t,r=0)=>(mE(e,t,r),t),mS=(e,t)=>{let r=t.byteLength,i=mA(e),n=i+mA(r),s=new Uint8Array(n+r);return m_(e,s,0),m_(r,s,i),s.set(t,n),new mI(e,r,t,s)};class mI{constructor(e,t,r,i){this.code=e,this.size=t,this.digest=r,this.bytes=i}}let mx=({name:e,code:t,encode:r})=>new mT(e,t,r);class mT{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?mS(this.code,t):t.then(e=>mS(this.code,e))}throw Error("Unknown type, must be binary type")}}let mk=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t));var mC=Object.freeze({__proto__:null,sha256:mx({name:"sha2-256",code:18,encode:mk("SHA-256")}),sha512:mx({name:"sha2-512",code:19,encode:mk("SHA-512")})}),mP=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:g9,digest:e=>mS(0,g9(e))}});new TextEncoder,new TextDecoder;let mO={...ml,...mc,...md,...mu,...mh,...mp,...mf,...my,...mg,...mv};function mR(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function mN(e,t,r,i){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:i}}}({...mC,...mP});let mM=mN("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),mU=mN("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{let t=function(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?mR(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}((e=e.substring(1)).length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),mD={utf8:mM,"utf-8":mM,hex:mO.base16,latin1:mU,ascii:mU,binary:mU,...mO};var mj=Object.defineProperty,mL=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mj(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class mB{constructor(e,t){this.core=e,this.logger=t,mL(this,"keychain",new Map),mL(this,"name","keychain"),mL(this,"version","0.3"),mL(this,"initialized",!1),mL(this,"storagePrefix",gT),mL(this,"init",async()=>{if(!this.initialized){let e=await this.getKeyChain();"u">typeof e&&(this.keychain=e),this.initialized=!0}}),mL(this,"has",e=>(this.isInitialized(),this.keychain.has(e))),mL(this,"set",async(e,t)=>{this.isInitialized(),this.keychain.set(e,t),await this.persist()}),mL(this,"get",e=>{this.isInitialized();let t=this.keychain.get(e);if(typeof t>"u"){let{message:t}=yq("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}),mL(this,"del",async e=>{this.isInitialized(),this.keychain.delete(e),await this.persist()}),this.core=e,this.logger=dV(t,this.name)}get context(){return d$(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ul(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?uc(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}}var mW=Object.defineProperty,mF=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mW(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class mz{constructor(e,t,r){this.core=e,this.logger=t,mF(this,"name","crypto"),mF(this,"keychain"),mF(this,"randomSessionIdentifier",yi()),mF(this,"initialized",!1),mF(this,"clientId"),mF(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),mF(this,"hasKeys",e=>(this.isInitialized(),this.keychain.has(e))),mF(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let e=await this.getClientSeed(),t=dw.generateKeyPair(e),r=dw.encodeIss(t.publicKey);return this.clientId=r,r}),mF(this,"generateKeyPair",()=>{let e,t;this.isInitialized();let r=(e=fF.utils.randomPrivateKey(),t=fF.getPublicKey(e),{privateKey:(0,db.toString)(e,f9),publicKey:(0,db.toString)(t,f9)});return this.setPrivateKey(r.publicKey,r.privateKey)}),mF(this,"signJWT",async e=>{this.isInitialized();let t=await this.getClientSeed(),r=dw.generateKeyPair(t),i=this.randomSessionIdentifier;return await dw.signJWT(i,e,gP,r)}),mF(this,"generateSharedKey",(e,t,r)=>{var i,n,s;let a,o;this.isInitialized();let l=(i=this.getPrivateKey(e),a=fF.getSharedSecret((0,dv.fromString)(i,f9),(0,dv.fromString)(t,f9)),n=void 0,o=function(e,t,r,i=32){u$(e),uH(i);let n=e.outputLen;if(i>255*n)throw Error("Length should be <= 255*HashLen");let s=Math.ceil(i/n);void 0===r&&(r=pF);let a=new Uint8Array(s*n),o=pB.create(e,t),l=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let e=0;e<s;e++)pW[0]=e+1,l.update(0===e?pF:c).update(r).update(pW).digestInto(c),a.set(c,n*e),o._cloneInto(l);return o.destroy(),l.destroy(),uG(c,pW),a.slice(0,i)}(hD,(s=void 0,u$(hD),void 0===s&&(s=new Uint8Array(hD.outputLen)),pB(hD,u9(s),u9(a))),n,32),(0,db.toString)(o,f9));return this.setSymKey(l,r)}),mF(this,"setSymKey",async(e,t)=>{this.isInitialized();let r=t||yn(e);return await this.keychain.set(r,e),r}),mF(this,"deleteKeyPair",async e=>{this.isInitialized(),await this.keychain.del(e)}),mF(this,"deleteSymKey",async e=>{this.isInitialized(),await this.keychain.del(e)}),mF(this,"encode",async(e,t,r)=>{this.isInitialized();let i=yh(r),n=(0,dI.safeJsonStringify)(t);if(2===i.type){var s;let e,t,i;return s=r?.encoding,e=ya(2),t=hi(12),i=yd({type:e,sealed:(0,dv.fromString)(n,yr),iv:t}),s===yt?yl(i):i}if(yp(i)){let t=i.senderPublicKey,r=i.receiverPublicKey;e=await this.generateSharedKey(t,r)}let a=this.getSymKey(e),{type:o,senderPublicKey:l}=i;return function(e){let t=ya("u">typeof e.type?e.type:0);if(1===yo(t)&&typeof e.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let r="u">typeof e.senderPublicKey?(0,dv.fromString)(e.senderPublicKey,f9):void 0,i="u">typeof e.iv?(0,dv.fromString)(e.iv,f9):hi(12),n=yd({type:t,sealed:pj((0,dv.fromString)(e.symKey,f9),i).encrypt((0,dv.fromString)(e.message,yr)),iv:i,senderPublicKey:r});return e.encoding===yt?yl(n):n}({type:o,symKey:a,message:n,senderPublicKey:l,encoding:r?.encoding})}),mF(this,"decode",async(e,t,r)=>{let i;this.isInitialized();let n=yh({type:yo((i=yu({encoded:t,encoding:r?.encoding})).type),senderPublicKey:"u">typeof i.senderPublicKey?(0,db.toString)(i.senderPublicKey,f9):void 0,receiverPublicKey:r?.receiverPublicKey});if(2===n.type){let e=function(e,t){let{sealed:r}=yu({encoded:e,encoding:t});return(0,db.toString)(r,yr)}(t,r?.encoding);return(0,dI.safeJsonParse)(e)}if(yp(n)){let t=n.receiverPublicKey,r=n.senderPublicKey;e=await this.generateSharedKey(t,r)}try{let i=this.getSymKey(e),n=function(e){let t=(0,dv.fromString)(e.symKey,f9),{sealed:r,iv:i}=yu({encoded:e.encoded,encoding:e.encoding}),n=pj(t,i).decrypt(r);if(null===n)throw Error("Failed to decrypt");return(0,db.toString)(n,yr)}({symKey:i,encoded:t,encoding:r?.encoding});return(0,dI.safeJsonParse)(n)}catch(t){this.logger.error(`Failed to decode message from topic: '${e}', clientId: '${await this.getClientId()}'`),this.logger.error(t)}}),mF(this,"getPayloadType",(e,t=ye)=>yo(yu({encoded:e,encoding:t}).type)),mF(this,"getPayloadSenderPublicKey",(e,t=ye)=>{let r=yu({encoded:e,encoding:t});return r.senderPublicKey?(0,db.toString)(r.senderPublicKey,f9):void 0}),this.core=e,this.logger=dV(t,this.name),this.keychain=r||new mB(this.core,this.logger)}get context(){return d$(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(gC)}catch{e=yi(),await this.keychain.set(gC,e)}return function(e,t="utf8"){let r=mD[t];if(!r)throw Error(`Unsupported encoding "${t}"`);return("utf8"===t||"utf-8"===t)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?mR(globalThis.Buffer.from(e,"utf-8")):r.decoder.decode(`${r.prefix}${e}`)}(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}}var mq=Object.defineProperty,mH=Object.defineProperties,mK=Object.getOwnPropertyDescriptors,m$=Object.getOwnPropertySymbols,mV=Object.prototype.hasOwnProperty,mJ=Object.prototype.propertyIsEnumerable,mZ=(e,t,r)=>t in e?mq(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,mG=(e,t,r)=>mZ(e,"symbol"!=typeof t?t+"":t,r);class mY extends gc{constructor(e,t){super(e,t),this.logger=e,this.core=t,mG(this,"messages",new Map),mG(this,"messagesWithoutClientAck",new Map),mG(this,"name","messages"),mG(this,"version","0.3"),mG(this,"initialized",!1),mG(this,"storagePrefix",gT),mG(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let e=await this.getRelayerMessages();"u">typeof e&&(this.messages=e);let t=await this.getRelayerMessagesWithoutClientAck();"u">typeof t&&(this.messagesWithoutClientAck=t),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}finally{this.initialized=!0}}}),mG(this,"set",async(e,t,r)=>{this.isInitialized();let i=ys(t),n=this.messages.get(e);if(typeof n>"u"&&(n={}),"u">typeof n[i])return i;if(n[i]=t,this.messages.set(e,n),r===gH){let r=this.messagesWithoutClientAck.get(e)||{};this.messagesWithoutClientAck.set(e,mH(((e,t)=>{for(var r in t||(t={}))mV.call(t,r)&&mZ(e,r,t[r]);if(m$)for(var r of m$(t))mJ.call(t,r)&&mZ(e,r,t[r]);return e})({},r),mK({[i]:t})))}return await this.persist(),i}),mG(this,"get",e=>{this.isInitialized();let t=this.messages.get(e);return typeof t>"u"&&(t={}),t}),mG(this,"getWithoutAck",e=>{this.isInitialized();let t={};for(let r of e){let e=this.messagesWithoutClientAck.get(r)||{};t[r]=Object.values(e)}return t}),mG(this,"has",(e,t)=>(this.isInitialized(),"u">typeof this.get(e)[ys(t)])),mG(this,"ack",async(e,t)=>{this.isInitialized();let r=this.messagesWithoutClientAck.get(e);if(typeof r>"u")return;let i=ys(t);delete r[i],0===Object.keys(r).length?this.messagesWithoutClientAck.delete(e):this.messagesWithoutClientAck.set(e,r),await this.persist()}),mG(this,"del",async e=>{this.isInitialized(),this.messages.delete(e),this.messagesWithoutClientAck.delete(e),await this.persist()}),this.logger=dV(e,this.name),this.core=t}get context(){return d$(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ul(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ul(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return"u">typeof e?uc(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof e?uc(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}}var mQ=Object.defineProperty,mX=Object.defineProperties,m0=Object.getOwnPropertyDescriptors,m1=Object.getOwnPropertySymbols,m2=Object.prototype.hasOwnProperty,m3=Object.prototype.propertyIsEnumerable,m5=(e,t,r)=>t in e?mQ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,m8=(e,t)=>{for(var r in t||(t={}))m2.call(t,r)&&m5(e,r,t[r]);if(m1)for(var r of m1(t))m3.call(t,r)&&m5(e,r,t[r]);return e},m6=(e,t,r)=>m5(e,"symbol"!=typeof t?t+"":t,r);class m4 extends gd{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,m6(this,"events",new oH.EventEmitter),m6(this,"name","publisher"),m6(this,"queue",new Map),m6(this,"publishTimeout",(0,o$.toMiliseconds)(o$.ONE_MINUTE)),m6(this,"initialPublishTimeout",(0,o$.toMiliseconds)(15*o$.ONE_SECOND)),m6(this,"needsTransportRestart",!1),m6(this,"publish",async(e,t,r)=>{var i,n,s,a,o;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,message:t,opts:r}});let l=r?.ttl||gO,c=r?.prompt||!1,d=r?.tag||0,u=r?.id||(0,g_.getBigIntRpcId)().toString(),h=yy(yf().protocol),p={id:u,method:r?.publishMethod||h.publish,params:m8({topic:e,message:t,ttl:l,prompt:c,tag:d,attestation:r?.attestation},r?.tvf)},f=`Failed to publish payload, please try again. id:${u} tag:${d}`;try{yV(null==(i=p.params)?void 0:i.prompt)&&(null==(n=p.params)||delete n.prompt),yV(null==(s=p.params)?void 0:s.tag)&&(null==(a=p.params)||delete a.tag);let o=new Promise(async e=>{let t=({id:r})=>{var i;(null==(i=p.id)?void 0:i.toString())===r.toString()&&(this.removeRequestFromQueue(r),this.relayer.events.removeListener(gD,t),e())};this.relayer.events.on(gD,t);let i=uu(new Promise((e,t)=>{this.rpcPublish(p,r).then(e).catch(e=>{this.logger.warn(e,e?.message),t(e)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${u} tag:${d}`);try{await i,this.events.removeListener(gD,t)}catch(e){this.queue.set(u,{request:p,opts:r,attempt:1}),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:u,topic:e,message:t,opts:r}}),await uu(o,this.publishTimeout,f)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(o=r?.internal)&&o.throwOnFailedPublish)throw e}finally{this.queue.delete(u)}}),m6(this,"publishCustom",async e=>{var t,r,i,n,s;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:e});let{payload:a,opts:o={}}=e,{attestation:l,tvf:c,publishMethod:d,prompt:u,tag:h,ttl:p=o$.FIVE_MINUTES}=o,f=o.id||(0,g_.getBigIntRpcId)().toString(),y=yy(yf().protocol),g=d||y.publish,m={id:f,method:g,params:m8(mX(m8({},a),m0({ttl:p,prompt:u,tag:h,attestation:l})),c)},w=`Failed to publish custom payload, please try again. id:${f} tag:${h}`;try{yV(null==(t=m.params)?void 0:t.prompt)&&(null==(r=m.params)||delete r.prompt),yV(null==(i=m.params)?void 0:i.tag)&&(null==(n=m.params)||delete n.tag);let e=new Promise(async e=>{let t=({id:r})=>{var i;(null==(i=m.id)?void 0:i.toString())===r.toString()&&(this.removeRequestFromQueue(r),this.relayer.events.removeListener(gD,t),e())};this.relayer.events.on(gD,t);let r=uu(new Promise((e,t)=>{this.rpcPublish(m,o).then(e).catch(e=>{this.logger.warn(e,e?.message),t(e)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${g} id:${f} tag:${h}`);try{await r,this.events.removeListener(gD,t)}catch(e){this.queue.set(f,{request:m,opts:o,attempt:1}),this.logger.warn(e,e?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:f,payload:a,opts:o}}),await uu(e,this.publishTimeout,w)}catch(e){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(e),null!=(s=o?.internal)&&s.throwOnFailedPublish)throw e}finally{this.queue.delete(f)}}),m6(this,"on",(e,t)=>{this.events.on(e,t)}),m6(this,"once",(e,t)=>{this.events.once(e,t)}),m6(this,"off",(e,t)=>{this.events.off(e,t)}),m6(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.relayer=e,this.logger=dV(t,this.name),this.registerEventListeners()}get context(){return d$(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let r=await this.relayer.request(e);return this.relayer.events.emit(gD,m8(m8({},e),t)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var r;let i=e.attempt+1;this.queue.set(t,mX(m8({},e),m0({attempt:i}))),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${null==(r=e.request.params)?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(gt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(gU);return}this.checkQueue()}),this.relayer.on(gM,e=>{this.removeRequestFromQueue(e.id.toString())})}}var m7=Object.defineProperty,m9=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?m7(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class we{constructor(){m9(this,"map",new Map),m9(this,"set",(e,t)=>{let r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])}),m9(this,"get",e=>this.map.get(e)||[]),m9(this,"exists",(e,t)=>this.get(e).includes(t)),m9(this,"delete",(e,t)=>{if(typeof t>"u")return void this.map.delete(e);if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,t))return;let i=r.filter(e=>e!==t);i.length?this.map.set(e,i):this.map.delete(e)}),m9(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var wt=Object.defineProperty,wr=Object.defineProperties,wi=Object.getOwnPropertyDescriptors,wn=Object.getOwnPropertySymbols,ws=Object.prototype.hasOwnProperty,wa=Object.prototype.propertyIsEnumerable,wo=(e,t,r)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wl=(e,t)=>{for(var r in t||(t={}))ws.call(t,r)&&wo(e,r,t[r]);if(wn)for(var r of wn(t))wa.call(t,r)&&wo(e,r,t[r]);return e},wc=(e,t,r)=>wo(e,"symbol"!=typeof t?t+"":t,r);class wd extends gp{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,wc(this,"subscriptions",new Map),wc(this,"topicMap",new we),wc(this,"events",new oH.EventEmitter),wc(this,"name","subscription"),wc(this,"version","0.3"),wc(this,"pending",new Map),wc(this,"cached",[]),wc(this,"initialized",!1),wc(this,"storagePrefix",gT),wc(this,"subscribeTimeout",(0,o$.toMiliseconds)(o$.ONE_MINUTE)),wc(this,"initialSubscribeTimeout",(0,o$.toMiliseconds)(15*o$.ONE_SECOND)),wc(this,"clientId"),wc(this,"batchSubscribeTopicsLimit",500),wc(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),wc(this,"subscribe",async(e,t)=>{var r;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}});try{let i=yf(t),n={topic:e,relay:i,transportType:t?.transportType};null!=(r=t?.internal)&&r.skipSubscribe||this.pending.set(e,n);let s=await this.rpcSubscribe(e,i,t);return"string"==typeof s&&(this.onSubscribe(s,n),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:t}})),s}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}),wc(this,"unsubscribe",async(e,t)=>{this.isInitialized(),"u">typeof t?.id?await this.unsubscribeById(e,t.id,t):await this.unsubscribeByTopic(e,t)}),wc(this,"isSubscribed",e=>new Promise(t=>{t(this.topicMap.topics.includes(e))})),wc(this,"isKnownTopic",e=>new Promise(t=>{t(this.topicMap.topics.includes(e)||this.pending.has(e)||this.cached.some(t=>t.topic===e))})),wc(this,"on",(e,t)=>{this.events.on(e,t)}),wc(this,"once",(e,t)=>{this.events.once(e,t)}),wc(this,"off",(e,t)=>{this.events.off(e,t)}),wc(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),wc(this,"start",async()=>{await this.onConnect()}),wc(this,"stop",async()=>{await this.onDisconnect()}),wc(this,"restart",async()=>{await this.restore(),await this.onRestart()}),wc(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}),wc(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(gt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(g$,async e=>{this.logger.info(`Emitting ${g$}`),this.logger.debug({type:"event",event:g$,data:e}),await this.persist()}),this.events.on(gV,async e=>{this.logger.info(`Emitting ${gV}`),this.logger.debug({type:"event",event:gV,data:e}),await this.persist()})}),this.relayer=e,this.logger=dV(t,this.name),this.clientId=""}get context(){return d$(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let r=this.topicMap.get(e);await Promise.all(r.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{let i=yf(r);await this.restartToComplete({topic:e,id:t,relay:i}),await this.rpcUnsubscribe(e,t,i);let n=yH("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}async rpcSubscribe(e,t,r){var i,n;let s=await this.getSubscriptionId(e);if(null!=(i=r?.internal)&&i.skipSubscribe)return s;r&&r?.transportType!==gq||await this.restartToComplete({topic:e,id:e,relay:t});let a={method:yy(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let o=null==(n=r?.internal)?void 0:n.throwOnFailedPublish;try{if(r?.transportType===gz)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(e=>this.logger.warn(e))},(0,o$.toMiliseconds)(o$.ONE_SECOND)),s;let t=new Promise(async t=>{let r=i=>{i.topic===e&&(this.events.removeListener(g$,r),t(i.id))};this.events.on(g$,r);try{let i=await uu(new Promise((e,t)=>{this.relayer.request(a).catch(e=>{this.logger.warn(e,e?.message),t(e)}).then(e)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(g$,r),t(i)}catch{}}),i=await uu(t,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!i&&o)throw Error(`Subscribing to ${e} failed, please try again`);return i?s:null}catch(e){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(gU),o)throw e}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t={method:yy(e[0].relay.protocol).batchSubscribe,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:t});try{await await uu(new Promise(e=>{this.relayer.request(t).catch(e=>this.logger.warn(e)).then(e)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(gU)}}async rpcBatchFetchMessages(e){let t;if(!e.length)return;let r={method:yy(e[0].relay.protocol).batchFetchMessages,params:{topics:e.map(e=>e.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{t=await await uu(new Promise((e,t)=>{this.relayer.request(r).catch(e=>{this.logger.warn(e),t(e)}).then(e)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(gU)}return t}rpcUnsubscribe(e,t,r){let i={method:yy(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,t){this.setSubscription(e,wr(wl({},t),wi({id:e}))),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(e=>{this.setSubscription(e.id,wl({},e)),this.pending.delete(e.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,wl({},t)),this.topicMap.set(t.topic,e),this.events.emit(g$,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:t}=yq("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(gV,wr(wl({},r),wi({reason:t})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){let t=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(t)}}this.events.emit("subscription_resubscribed")}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(e=>{var t;return e.topic===(null==(t=this.subscriptions.get(e.id))?void 0:t.topic)})){let{message:e}=yq("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async e=>wr(wl({},e),wi({id:await this.getSubscriptionId(e.topic)}))))))}async batchFetchMessages(e){var t;if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await (t=(0,o$.toMiliseconds)(o$.ONE_SECOND),new Promise(e=>setTimeout(e,t))),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}async restartToComplete(e){this.relayer.connected||this.relayer.connecting||(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ys(e+await this.getClientId())}}var wu=Object.defineProperty,wh=Object.getOwnPropertySymbols,wp=Object.prototype.hasOwnProperty,wf=Object.prototype.propertyIsEnumerable,wy=(e,t,r)=>t in e?wu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wg=(e,t)=>{for(var r in t||(t={}))wp.call(t,r)&&wy(e,r,t[r]);if(wh)for(var r of wh(t))wf.call(t,r)&&wy(e,r,t[r]);return e},wm=(e,t,r)=>wy(e,"symbol"!=typeof t?t+"":t,r);class ww extends gu{constructor(t){var r;super(t),wm(this,"protocol","wc"),wm(this,"version",2),wm(this,"core"),wm(this,"logger"),wm(this,"events",new oH.EventEmitter),wm(this,"provider"),wm(this,"messages"),wm(this,"subscriber"),wm(this,"publisher"),wm(this,"name","relayer"),wm(this,"transportExplicitlyClosed",!1),wm(this,"initialized",!1),wm(this,"connectionAttemptInProgress",!1),wm(this,"relayUrl"),wm(this,"projectId"),wm(this,"packageName"),wm(this,"bundleId"),wm(this,"hasExperiencedNetworkDisruption",!1),wm(this,"pingTimeout"),wm(this,"heartBeatTimeout",(0,o$.toMiliseconds)(o$.THIRTY_SECONDS+o$.FIVE_SECONDS)),wm(this,"reconnectTimeout"),wm(this,"connectPromise"),wm(this,"reconnectInProgress",!1),wm(this,"requestsInFlight",[]),wm(this,"connectTimeout",(0,o$.toMiliseconds)(15*o$.ONE_SECOND)),wm(this,"request",async e=>{var t,r;this.logger.debug("Publishing Request Payload");let i=e.id||(0,g_.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:e.method,topic:null==(t=e.params)?void 0:t.topic},"relayer.request - publishing...");let n=`${i}:${(null==(r=e.params)?void 0:r.tag)||""}`;this.requestsInFlight.push(n);let s=await this.provider.request(e);return this.requestsInFlight=this.requestsInFlight.filter(e=>e!==n),s}catch(e){throw this.logger.debug(`Failed to Publish Request: ${i}`),e}}),wm(this,"resetPingTimeout",()=>{ue()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var e,t,r,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(i=null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.terminate)||i.call(r)}catch(e){this.logger.warn(e,e?.message)}},this.heartBeatTimeout))}),wm(this,"onPayloadHandler",e=>{this.onProviderPayload(e),this.resetPingTimeout()}),wm(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),wm(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),wm(this,"onProviderErrorHandler",e=>{this.logger.fatal(`Fatal socket error: ${e.message}`),this.events.emit("relayer_error",e),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),wm(this,"registerProviderListeners",()=>{this.provider.on(gj,this.onPayloadHandler),this.provider.on(gL,this.onConnectHandler),this.provider.on(gB,this.onDisconnectHandler),this.provider.on(gW,this.onProviderErrorHandler)}),this.core=t.core,this.logger=ge({logger:null!=(r=t.logger)?r:"error",name:this.name}),this.messages=new mY(this.logger,t.core),this.subscriber=new wd(this,this.logger),this.publisher=new m4(this,this.logger),this.projectId=t?.projectId,this.relayUrl=t?.relayUrl||gR,ut()&&"u">typeof(null==e.g?void 0:e.g.Platform)&&(null==e.g?void 0:e.g.Platform.OS)==="android"?this.packageName=un():ut()&&"u">typeof(null==e.g?void 0:e.g.Platform)&&(null==e.g?void 0:e.g.Platform.OS)==="ios"&&(this.bundleId=un()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return d$(this.logger)}get connected(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===1}get connecting(){var e,t,r;return(null==(r=null==(t=null==(e=this.provider)?void 0:e.connection)?void 0:t.socket)?void 0:r.readyState)===0||void 0!==this.connectPromise}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:gq},"outbound")}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var r,i,n;this.isInitialized(),null!=t&&t.transportType&&t?.transportType!=="relay"||await this.toEstablishConnection();let s=typeof(null==(r=t?.internal)?void 0:r.throwOnFailedPublish)>"u"||(null==(i=t?.internal)?void 0:i.throwOnFailedPublish),a=(null==(n=this.subscriber.topicMap.get(e))?void 0:n[0])||"",o,l=t=>{t.topic===e&&(this.subscriber.off(g$,l),o())};return await Promise.all([new Promise(e=>{o=e,this.subscriber.on(g$,l)}),new Promise(async(r,i)=>{a=await this.subscriber.subscribe(e,wg({internal:{throwOnFailedPublish:s}},t)).catch(e=>{s&&i(e)})||a,r()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await uu(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,r)=>{await this.connect(e).then(t).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await y8())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let t=e.sort((e,t)=>e.publishedAt-t.publishedAt);for(let e of(this.logger.debug(`Batch of ${t.length} message events sorted`),t))try{await this.onMessageEvent(e)}catch(e){this.logger.warn(e,"Error while processing batch message event: "+e?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:r}=e;if(!t.sessionExists){let e=uf(o$.FIVE_MINUTES);await this.core.pairing.pairings.set(r,{topic:r,expiry:e,relay:{protocol:"irn"},active:!1})}this.events.emit(gN,e),await this.recordMessageEvent(e,gH)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(e,t)=>{let r=()=>{t(Error("Connection interrupted while trying to connect"))};this.provider.once(gB,r),await uu(new Promise((e,t)=>{this.provider.connect().then(e).catch(t)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(e=>{t(e)}).finally(()=>{this.provider.off(gB,r),clearTimeout(this.reconnectTimeout)}),await new Promise(async(e,r)=>{let i=()=>{t(Error("Connection interrupted while trying to subscribe"))};this.provider.once(gB,i),await this.subscriber.start().then(e).catch(r).finally(()=>{this.provider.off(gB,i)})}),this.hasExperiencedNetworkDisruption=!1,e()})}catch(e){await this.subscriber.stop(),this.logger.warn({},e.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(e=>setTimeout(e,(0,o$.toMiliseconds)(+t))),t++}}startPingTimeout(){var e,t,r,i,n;if(ue())try{null!=(t=null==(e=this.provider)?void 0:e.connection)&&t.socket&&(null==(n=null==(i=null==(r=this.provider)?void 0:r.connection)?void 0:i.socket)||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(e){this.logger.warn(e,e?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new gA.JsonRpcProvider(new gI.default(function({protocol:e,version:t,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a,bundleId:o,packageName:l}){var c,d;let u,h=r.split("?"),p=ua(e,t,i),f=(c=h[1]||"",d={auth:n,ua:p,projectId:s,useOnCloseEvent:a||void 0,packageName:l||void 0,bundleId:o||void 0},u=new URLSearchParams(c),Object.entries(d).sort(([e],[t])=>e.localeCompare(t)).forEach(([e,t])=>{null!=t&&u.set(e,String(t))}),u.toString());return h[0]+"?"+f}({sdkVersion:gF,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:r,message:i}=e;await this.messages.set(r,i,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:r}=e;if(!r||0===r.length)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let i=this.messages.has(t,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),(0,gS.isJsonRpcRequest)(e)){if(!e.method.endsWith("_subscription"))return;let t=e.params,{topic:r,message:i,publishedAt:n,attestation:s}=t.data,a={topic:r,message:i,publishedAt:n,transportType:gq,attestation:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(wg({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else(0,gS.isJsonRpcResponse)(e)&&this.events.emit(gM,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,gH),this.events.emit(gN,e))}async acknowledgePayload(e){let t=(0,g_.formatJsonRpcResult)(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(gj,this.onPayloadHandler),this.provider.off(gL,this.onConnectHandler),this.provider.off(gB,this.onDisconnectHandler),this.provider.off(gW,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let t=await y8();(function(t){var r,i;switch(ui()){case d9:r=t,!ut()&&ur()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)));break;case d4:i=t,ut()&&null!=e.g&&e.g.NetInfo&&e.g?.NetInfo.addEventListener(e=>i(e?.isConnected))}})(async e=>{t!==e&&(t=e,e?await this.transportOpen().catch(e=>this.logger.error(e,e?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(gt.HEARTBEAT_EVENTS.pulse,async()=>{var e;if(!this.transportExplicitlyClosed&&!this.connected&&(!(ur()&&(0,oV.getDocument)())||(null==(e=(0,oV.getDocument)())?void 0:e.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(e){this.logger.warn(e,e?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,o$.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function wb(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function wv(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let wE="[object Arguments]",wA="[object Object]";function w_(){}function wS(e){if(!e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&"[object Object]"===Object.prototype.toString.call(e)}var wI=Object.defineProperty,wx=Object.getOwnPropertySymbols,wT=Object.prototype.hasOwnProperty,wk=Object.prototype.propertyIsEnumerable,wC=(e,t,r)=>t in e?wI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wP=(e,t)=>{for(var r in t||(t={}))wT.call(t,r)&&wC(e,r,t[r]);if(wx)for(var r of wx(t))wk.call(t,r)&&wC(e,r,t[r]);return e},wO=(e,t,r)=>wC(e,"symbol"!=typeof t?t+"":t,r);class wR extends gh{constructor(e,t,r,i=gT,n){super(e,t,r,i),this.core=e,this.logger=t,this.name=r,wO(this,"map",new Map),wO(this,"version","0.3"),wO(this,"cached",[]),wO(this,"initialized",!1),wO(this,"getKey"),wO(this,"storagePrefix",gT),wO(this,"recentlyDeleted",[]),wO(this,"recentlyDeletedLimit",200),wO(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>{var t;this.getKey&&null!==e&&!yV(e)?this.map.set(this.getKey(e),e):(null==(t=e?.proposer)?void 0:t.publicKey)?this.map.set(e.id,e):e?.topic&&this.map.set(e.topic,e)}),this.cached=[],this.initialized=!0)}),wO(this,"set",async(e,t)=>{this.isInitialized(),this.map.has(e)?await this.update(e,t):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:e,value:t}),this.map.set(e,t),await this.persist())}),wO(this,"get",e=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:e}),this.getData(e))),wO(this,"getAll",e=>(this.isInitialized(),e?this.values.filter(t=>Object.keys(e).every(r=>{var i;return i=t[r],function e(t,r,i,n,s,a,o){let l=o(t,r,i,n,s,a);if(void 0!==l)return l;if(typeof t==typeof r)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return t===r;case"number":return t===r||Object.is(t,r)}return function t(r,i,n,s){if(Object.is(r,i))return!0;let a=wv(r),o=wv(i);if(a===wE&&(a=wA),o===wE&&(o=wA),a!==o)return!1;switch(a){case"[object String]":return r.toString()===i.toString();case"[object Number]":{let e=r.valueOf(),t=i.valueOf();return e===t||Number.isNaN(e)&&Number.isNaN(t)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(r.valueOf(),i.valueOf());case"[object RegExp]":return r.source===i.source&&r.flags===i.flags;case"[object Function]":return r===i}let l=(n=n??new Map).get(r),c=n.get(i);if(null!=l&&null!=c)return l===i;n.set(r,i),n.set(i,r);try{switch(a){case"[object Map]":if(r.size!==i.size)return!1;for(let[t,a]of r.entries())if(!i.has(t)||!e(a,i.get(t),t,r,i,n,s))return!1;return!0;case"[object Set]":{if(r.size!==i.size)return!1;let t=Array.from(r.values()),a=Array.from(i.values());for(let o=0;o<t.length;o++){let l=t[o],c=a.findIndex(t=>e(l,t,void 0,r,i,n,s));if(-1===c)return!1;a.splice(c,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof rg.Buffer&&rg.Buffer.isBuffer(r)!==rg.Buffer.isBuffer(i)||r.length!==i.length)return!1;for(let t=0;t<r.length;t++)if(!e(r[t],i[t],t,r,i,n,s))return!1;return!0;case"[object ArrayBuffer]":return r.byteLength===i.byteLength&&t(new Uint8Array(r),new Uint8Array(i),n,s);case"[object DataView]":return r.byteLength===i.byteLength&&r.byteOffset===i.byteOffset&&t(new Uint8Array(r),new Uint8Array(i),n,s);case"[object Error]":return r.name===i.name&&r.message===i.message;case wA:{if(!(t(r.constructor,i.constructor,n,s)||wS(r)&&wS(i)))return!1;let a=[...Object.keys(r),...wb(r)],o=[...Object.keys(i),...wb(i)];if(a.length!==o.length)return!1;for(let t=0;t<a.length;t++){let o=a[t],l=r[o];if(!Object.hasOwn(i,o))return!1;let c=i[o];if(!e(l,c,o,r,i,n,s))return!1}return!0}default:return!1}}finally{n.delete(r),n.delete(i)}}(t,r,a,o)}(i,e[r],void 0,void 0,void 0,void 0,w_)})):this.values)),wO(this,"update",async(e,t)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:e,update:t});let r=wP(wP({},this.getData(e)),t);this.map.set(e,r),await this.persist()}),wO(this,"delete",async(e,t)=>{this.isInitialized(),this.map.has(e)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:e,reason:t}),this.map.delete(e),this.addToRecentlyDeleted(e),await this.persist())}),this.logger=dV(t,this.name),this.storagePrefix=i,this.getKey=n}get context(){return d$(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:t}=yq("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(t),Error(t)}let{message:t}=yq("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(t),Error(t)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:e}=yq("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}}var wN=Object.defineProperty,wM=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wN(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wU{constructor(e,t){this.core=e,this.logger=t,wM(this,"name","pairing"),wM(this,"version","0.3"),wM(this,"events",new oH.default),wM(this,"pairings"),wM(this,"initialized",!1),wM(this,"storagePrefix",gT),wM(this,"ignoredPayloadTypes",[1]),wM(this,"registeredMethods",[]),wM(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),wM(this,"register",({methods:e})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...e])]}),wM(this,"create",async e=>{this.isInitialized();let t=yi(),r=await this.core.crypto.setSymKey(t),i=uf(o$.FIVE_MINUTES),n={protocol:"irn"},s={topic:r,expiry:i,relay:n,active:!1,methods:e?.methods},a=yI({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:t,relay:n,expiryTimestamp:i,methods:e?.methods});return this.events.emit(gZ,s),this.core.expirer.set(r,i),await this.pairings.set(r,s),await this.core.relayer.subscribe(r,{transportType:e?.transportType,internal:e?.internal}),{topic:r,uri:a}}),wM(this,"pair",async e=>{let t;this.isInitialized();let r=this.core.eventClient.createEvent({properties:{topic:e?.uri,trace:["pairing_started"]}});this.isValidPair(e,r);let{topic:i,symKey:n,relay:s,expiryTimestamp:a,methods:o}=yS(e.uri);if(r.props.properties.topic=i,r.addTrace("pairing_uri_validation_success"),r.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(i)){if(t=this.pairings.get(i),r.addTrace("existing_pairing"),t.active)throw r.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);r.addTrace("pairing_not_expired")}let l=a||uf(o$.FIVE_MINUTES),c={topic:i,relay:s,expiry:l,active:!1,methods:o};this.core.expirer.set(i,l),await this.pairings.set(i,c),r.addTrace("store_new_pairing"),e.activatePairing&&await this.activate({topic:i}),this.events.emit(gZ,c),r.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(n,i),r.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{r.setError("no_internet_connection")}try{await this.core.relayer.subscribe(i,{relay:s})}catch(e){throw r.setError("subscribe_pairing_topic_failure"),e}return r.addTrace("subscribe_pairing_topic_success"),c}),wM(this,"activate",async({topic:e})=>{this.isInitialized();let t=uf(o$.FIVE_MINUTES);this.core.expirer.set(e,t),await this.pairings.update(e,{active:!0,expiry:t})}),wM(this,"ping",async e=>{this.isInitialized(),await this.isValidPing(e),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:t}=e;if(this.pairings.keys.includes(t)){let e=await this.sendRequest(t,"wc_pairingPing",{}),{done:r,resolve:i,reject:n}=ud();this.events.once(ug("pairing_ping",e),({error:e})=>{e?n(e):i()}),await r()}}),wM(this,"updateExpiry",async({topic:e,expiry:t})=>{this.isInitialized(),await this.pairings.update(e,{expiry:t})}),wM(this,"updateMetadata",async({topic:e,metadata:t})=>{this.isInitialized(),await this.pairings.update(e,{peerMetadata:t})}),wM(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),wM(this,"disconnect",async e=>{this.isInitialized(),await this.isValidDisconnect(e);let{topic:t}=e;this.pairings.keys.includes(t)&&(await this.sendRequest(t,"wc_pairingDelete",yH("USER_DISCONNECTED")),await this.deletePairing(t))}),wM(this,"formatUriFromPairing",e=>{this.isInitialized();let{topic:t,relay:r,expiry:i,methods:n}=e,s=this.core.crypto.keychain.get(t);return yI({protocol:this.core.protocol,version:this.core.version,topic:t,symKey:s,relay:r,expiryTimestamp:i,methods:n})}),wM(this,"sendRequest",async(e,t,r)=>{let i=(0,g_.formatJsonRpcRequest)(t,r),n=await this.core.crypto.encode(e,i),s=gJ[t].req;return this.core.history.set(e,i),this.core.relayer.publish(e,n,s),i.id}),wM(this,"sendResult",async(e,t,r)=>{let i=(0,g_.formatJsonRpcResult)(e,r),n=await this.core.crypto.encode(t,i),s=gJ[(await this.core.history.get(t,e)).request.method].res;await this.core.relayer.publish(t,n,s),await this.core.history.resolve(i)}),wM(this,"sendError",async(e,t,r)=>{let i=(0,g_.formatJsonRpcError)(e,r),n=await this.core.crypto.encode(t,i),s=(await this.core.history.get(t,e)).request.method,a=gJ[s]?gJ[s].res:gJ.unregistered_method.res;await this.core.relayer.publish(t,n,a),await this.core.history.resolve(i)}),wM(this,"deletePairing",async(e,t)=>{await this.core.relayer.unsubscribe(e),await Promise.all([this.pairings.delete(e,yH("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(e),t?Promise.resolve():this.core.expirer.del(e)])}),wM(this,"cleanup",async()=>{let e=this.pairings.getAll().filter(e=>uy(e.expiry));await Promise.all(e.map(e=>this.deletePairing(e.topic)))}),wM(this,"onRelayEventRequest",async e=>{let{topic:t,payload:r}=e;switch(r.method){case"wc_pairingPing":return await this.onPairingPingRequest(t,r);case"wc_pairingDelete":return await this.onPairingDeleteRequest(t,r);default:return await this.onUnknownRpcMethodRequest(t,r)}}),wM(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r}=e,i=(await this.core.history.get(t,r.id)).request.method;return"wc_pairingPing"===i?this.onPairingPingResponse(t,r):this.onUnknownRpcMethodResponse(i)}),wM(this,"onPairingPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult(r,e,!0),this.events.emit("pairing_ping",{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),wM(this,"onPairingPingResponse",(e,t)=>{let{id:r}=t;setTimeout(()=>{(0,gS.isJsonRpcResult)(t)?this.events.emit(ug("pairing_ping",r),{}):(0,gS.isJsonRpcError)(t)&&this.events.emit(ug("pairing_ping",r),{error:t.error})},500)}),wM(this,"onPairingDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e}),await this.deletePairing(e),this.events.emit(gG,{id:r,topic:e})}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),wM(this,"onUnknownRpcMethodRequest",async(e,t)=>{let{id:r,method:i}=t;try{if(this.registeredMethods.includes(i))return;let t=yH("WC_METHOD_UNSUPPORTED",i);await this.sendError(r,e,t),this.logger.error(t)}catch(t){await this.sendError(r,e,t),this.logger.error(t)}}),wM(this,"onUnknownRpcMethodResponse",e=>{this.registeredMethods.includes(e)||this.logger.error(yH("WC_METHOD_UNSUPPORTED",e))}),wM(this,"isValidPair",(e,t)=>{var r;if(!y1(e)){let{message:r}=yq("MISSING_OR_INVALID",`pair() params: ${e}`);throw t.setError(g6),Error(r)}if(!function(e){function t(e){try{return"u">typeof new URL(e)}catch{return!1}}try{if(yJ(e,!1)){if(t(e))return!0;let r=u_(e);return t(r)}}catch{}return!1}(e.uri)){let{message:r}=yq("MISSING_OR_INVALID",`pair() uri: ${e.uri}`);throw t.setError(g6),Error(r)}let i=yS(e?.uri);if(!(null!=(r=i?.relay)&&r.protocol)){let{message:e}=yq("MISSING_OR_INVALID","pair() uri#relay-protocol");throw t.setError(g6),Error(e)}if(!(null!=i&&i.symKey)){let{message:e}=yq("MISSING_OR_INVALID","pair() uri#symKey");throw t.setError(g6),Error(e)}if(null!=i&&i.expiryTimestamp&&(0,o$.toMiliseconds)(i?.expiryTimestamp)<Date.now()){t.setError("pairing_expired");let{message:e}=yq("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(e)}}),wM(this,"isValidPing",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),wM(this,"isValidDisconnect",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidPairingTopic(t)}),wM(this,"isValidPairingTopic",async e=>{if(!yJ(e,!1)){let{message:t}=yq("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.pairings.keys.includes(e)){let{message:t}=yq("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(uy(this.pairings.get(e).expiry)){await this.deletePairing(e);let{message:t}=yq("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}),this.core=e,this.logger=dV(t,this.name),this.pairings=new wR(this.core,this.logger,this.name,this.storagePrefix)}get context(){return d$(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}registerRelayerEvents(){this.core.relayer.on(gN,async e=>{let{topic:t,message:r,transportType:i}=e;if(this.pairings.keys.includes(t)&&i!==gz&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let e=await this.core.crypto.decode(t,r);(0,gS.isJsonRpcRequest)(e)?(this.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e})):(0,gS.isJsonRpcResponse)(e)&&(await this.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e}),this.core.history.delete(t,e.id)),await this.core.relayer.messages.ack(t,r)}catch(e){this.logger.error(e)}})}registerExpirerEvents(){this.core.expirer.on(g2,async e=>{let{topic:t}=up(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}var wD=Object.defineProperty,wj=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wD(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wL extends gl{constructor(e,t){super(e,t),this.core=e,this.logger=t,wj(this,"records",new Map),wj(this,"events",new oH.EventEmitter),wj(this,"name","history"),wj(this,"version","0.3"),wj(this,"cached",[]),wj(this,"initialized",!1),wj(this,"storagePrefix",gT),wj(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.records.set(e.id,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),wj(this,"set",(e,t,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:r}),this.records.has(t.id))return;let i={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:r,expiry:uf(o$.THIRTY_DAYS)};this.records.set(i.id,i),this.persist(),this.events.emit(gY,i)}),wj(this,"resolve",async e=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:e}),!this.records.has(e.id))return;let t=await this.getRecord(e.id);typeof t.response>"u"&&(t.response=(0,gS.isJsonRpcError)(e)?{error:e.error}:{result:e.result},this.records.set(t.id,t),this.persist(),this.events.emit(gQ,t))}),wj(this,"get",async(e,t)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t}),await this.getRecord(t))),wj(this,"delete",(e,t)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(r=>{r.topic===e&&("u">typeof t&&r.id!==t||(this.records.delete(r.id),this.events.emit(gX,r)))}),this.persist()}),wj(this,"exists",async(e,t)=>(this.isInitialized(),!!this.records.has(t)&&(await this.getRecord(t)).topic===e)),wj(this,"on",(e,t)=>{this.events.on(e,t)}),wj(this,"once",(e,t)=>{this.events.once(e,t)}),wj(this,"off",(e,t)=>{this.events.off(e,t)}),wj(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=dV(t,this.name)}get context(){return d$(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if("u">typeof t.response)return;let r={topic:t.topic,request:(0,g_.formatJsonRpcRequest)(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:t}=yq("NO_MATCHING_KEY",`${this.name}: ${e}`);throw Error(t)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:e}=yq("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(gY,e=>{this.logger.info(`Emitting ${gY}`),this.logger.debug({type:"event",event:gY,record:e})}),this.events.on(gQ,e=>{this.logger.info(`Emitting ${gQ}`),this.logger.debug({type:"event",event:gQ,record:e})}),this.events.on(gX,e=>{this.logger.info(`Emitting ${gX}`),this.logger.debug({type:"event",event:gX,record:e})}),this.core.heartbeat.on(gt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,o$.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(gX,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}}var wB=Object.defineProperty,wW=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wB(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wF extends gf{constructor(e,t){super(e,t),this.core=e,this.logger=t,wW(this,"expirations",new Map),wW(this,"events",new oH.EventEmitter),wW(this,"name","expirer"),wW(this,"version","0.3"),wW(this,"cached",[]),wW(this,"initialized",!1),wW(this,"storagePrefix",gT),wW(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(e=>this.expirations.set(e.target,e)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),wW(this,"has",e=>{try{let t=this.formatTarget(e);return"u">typeof this.getExpiration(t)}catch{return!1}}),wW(this,"set",(e,t)=>{this.isInitialized();let r=this.formatTarget(e),i={target:r,expiry:t};this.expirations.set(r,i),this.checkExpiry(r,i),this.events.emit(g0,{target:r,expiration:i})}),wW(this,"get",e=>{this.isInitialized();let t=this.formatTarget(e);return this.getExpiration(t)}),wW(this,"del",e=>{if(this.isInitialized(),this.has(e)){let t=this.formatTarget(e),r=this.getExpiration(t);this.expirations.delete(t),this.events.emit(g1,{target:t,expiration:r})}}),wW(this,"on",(e,t)=>{this.events.on(e,t)}),wW(this,"once",(e,t)=>{this.events.once(e,t)}),wW(this,"off",(e,t)=>{this.events.off(e,t)}),wW(this,"removeListener",(e,t)=>{this.events.removeListener(e,t)}),this.logger=dV(t,this.name)}get context(){return d$(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if("string"==typeof e)return uh("topic",e);if("number"==typeof e)return uh("id",e);let{message:t}=yq("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:e}=yq("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(e),Error(e)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:t}=yq("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(t),Error(t)}return t}checkExpiry(e,t){let{expiry:r}=t;(0,o$.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(g2,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(gt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(g0,e=>{this.logger.info(`Emitting ${g0}`),this.logger.debug({type:"event",event:g0,data:e}),this.persist()}),this.events.on(g2,e=>{this.logger.info(`Emitting ${g2}`),this.logger.debug({type:"event",event:g2,data:e}),this.persist()}),this.events.on(g1,e=>{this.logger.info(`Emitting ${g1}`),this.logger.debug({type:"event",event:g1,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}}var wz=Object.defineProperty,wq=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wz(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wH extends gy{constructor(e,t,r){super(e,t,r),this.core=e,this.logger=t,this.store=r,wq(this,"name","verify-api"),wq(this,"abortController"),wq(this,"isDevEnv"),wq(this,"verifyUrlV3",g5),wq(this,"storagePrefix",gT),wq(this,"version",2),wq(this,"publicKey"),wq(this,"fetchPromise"),wq(this,"init",async()=>{var e;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,o$.toMiliseconds)(null==(e=this.publicKey)?void 0:e.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),wq(this,"register",async e=>{if(!ur()||this.isDevEnv)return;let t=window.location.origin,{id:r,decryptedId:i}=e,n=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${t}&id=${r}&decryptedId=${i}`;try{let e=(0,oV.getDocument)(),t=this.startAbortTimer(5*o$.ONE_SECOND),i=await new Promise((i,s)=>{let a=()=>{window.removeEventListener("message",l),e.body.removeChild(o),s("attestation aborted")};this.abortController.signal.addEventListener("abort",a);let o=e.createElement("iframe");o.src=n,o.style.display="none",o.addEventListener("error",a,{signal:this.abortController.signal});let l=n=>{if(n.data&&"string"==typeof n.data)try{let s=JSON.parse(n.data);if("verify_attestation"===s.type){if((0,dw.decodeJWT)(s.attestation).payload.id!==r)return;clearInterval(t),e.body.removeChild(o),this.abortController.signal.removeEventListener("abort",a),window.removeEventListener("message",l),i(null===s.attestation?"":s.attestation)}}catch(e){this.logger.warn(e)}};e.body.appendChild(o),window.addEventListener("message",l,{signal:this.abortController.signal})});return this.logger.debug(i,"jwt attestation"),i}catch(e){this.logger.warn(e)}return""}),wq(this,"resolve",async e=>{if(this.isDevEnv)return"";let{attestationId:t,hash:r,encryptedId:i}=e;if(""===t)return void this.logger.debug("resolve: attestationId is empty, skipping");if(t){if((0,dw.decodeJWT)(t).payload.id!==i)return;let e=await this.isValidJwtAttestation(t);if(e)return e.isVerified?e:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!r)return;let n=this.getVerifyUrl(e?.verifyUrl);return this.fetchAttestation(r,n)}),wq(this,"fetchAttestation",async(e,t)=>{this.logger.debug(`resolving attestation: ${e} from url: ${t}`);let r=this.startAbortTimer(5*o$.ONE_SECOND),i=await fetch(`${t}/attestation/${e}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(r),200===i.status?await i.json():void 0}),wq(this,"getVerifyUrl",e=>{let t=e||g3;return g8.includes(t)||(this.logger.info(`verify url: ${t}, not included in trusted list, assigning default: ${g3}`),t=g3),t}),wq(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let e=this.startAbortTimer(o$.FIVE_SECONDS),t=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(e),await t.json()}catch(e){this.logger.warn(e)}}),wq(this,"persistPublicKey",async e=>{this.logger.debug(e,"persisting public key to local storage"),await this.store.setItem(this.storeKey,e),this.publicKey=e}),wq(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),wq(this,"isValidJwtAttestation",async e=>{let t=await this.getPublicKey();try{if(t)return this.validateAttestation(e,t)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}let r=await this.fetchAndPersistPublicKey();try{if(r)return this.validateAttestation(e,r)}catch(e){this.logger.error(e),this.logger.warn("error validating attestation")}}),wq(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),wq(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async e=>{let t=await this.fetchPublicKey();t&&(await this.persistPublicKey(t),e(t))});let e=await this.fetchPromise;return this.fetchPromise=void 0,e}),wq(this,"validateAttestation",(e,t)=>{let r=function(e,t){let r,i,[n,s,a]=e.split("."),o=rg.Buffer.from(yc(a),"base64");if(64!==o.length)throw Error("Invalid signature length");let l=o.slice(0,32),c=o.slice(32,64),d=hD(`${n}.${s}`),u=(r=rg.Buffer.from(t.x,"base64"),i=rg.Buffer.from(t.y,"base64"),(0,dE.concat)([new Uint8Array([4]),r,i]));if(!f4.verify((0,dE.concat)([l,c]),d,u))throw Error("Invalid signature");return(0,dw.decodeJWT)(e).payload}(e,t.publicKey),i={hasExpired:(0,o$.toMiliseconds)(r.exp)<Date.now(),payload:r};if(i.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:i.payload.origin,isScam:i.payload.isScam,isVerified:i.payload.isVerified}}),this.logger=dV(t,this.name),this.abortController=new AbortController,this.isDevEnv=uA(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return d$(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,o$.toMiliseconds)(e))}}var wK=Object.defineProperty,w$=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?wK(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class wV extends gg{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,w$(this,"context","echo"),w$(this,"registerDeviceToken",async e=>{let{clientId:t,token:r,notificationType:i,enableEncrypted:n=!1}=e,s=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:t,type:i,token:r,always_raw:n})})}),this.logger=dV(t,this.context)}}var wJ=Object.defineProperty,wZ=Object.getOwnPropertySymbols,wG=Object.prototype.hasOwnProperty,wY=Object.prototype.propertyIsEnumerable,wQ=(e,t,r)=>t in e?wJ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,wX=(e,t)=>{for(var r in t||(t={}))wG.call(t,r)&&wQ(e,r,t[r]);if(wZ)for(var r of wZ(t))wY.call(t,r)&&wQ(e,r,t[r]);return e},w0=(e,t,r)=>wQ(e,"symbol"!=typeof t?t+"":t,r);class w1 extends gm{constructor(e,t,r=!0){super(e,t,r),this.core=e,this.logger=t,w0(this,"context","event-client"),w0(this,"storagePrefix",gT),w0(this,"storageVersion",.1),w0(this,"events",new Map),w0(this,"shouldPersist",!1),w0(this,"init",async()=>{if(!uA())try{let e={eventId:uE(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:ua(this.core.relayer.protocol,this.core.relayer.version,gF)}}};await this.sendEvent([e])}catch(e){this.logger.warn(e)}}),w0(this,"createEvent",e=>{let{event:t="ERROR",type:r="",properties:{topic:i,trace:n}}=e,s=uE(),a=this.core.projectId||"",o=wX({eventId:s,timestamp:Date.now(),props:{event:t,type:r,properties:{topic:i,trace:n}},bundleId:a,domain:this.getAppDomain()},this.setMethods(s));return this.telemetryEnabled&&(this.events.set(s,o),this.shouldPersist=!0),o}),w0(this,"getEvent",e=>{let{eventId:t,topic:r}=e;if(t)return this.events.get(t);let i=Array.from(this.events.values()).find(e=>e.props.properties.topic===r);if(i)return wX(wX({},i),this.setMethods(i.eventId))}),w0(this,"deleteEvent",e=>{let{eventId:t}=e;this.events.delete(t),this.shouldPersist=!0}),w0(this,"setEventListeners",()=>{this.core.heartbeat.on(gt.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(e=>{(0,o$.fromMiliseconds)(Date.now())-(0,o$.fromMiliseconds)(e.timestamp)>86400&&(this.events.delete(e.eventId),this.shouldPersist=!0)})})}),w0(this,"setMethods",e=>({addTrace:t=>this.addTrace(e,t),setError:t=>this.setError(e,t)})),w0(this,"addTrace",(e,t)=>{let r=this.events.get(e);r&&(r.props.properties.trace.push(t),this.events.set(e,r),this.shouldPersist=!0)}),w0(this,"setError",(e,t)=>{let r=this.events.get(e);r&&(r.props.type=t,r.timestamp=Date.now(),this.events.set(e,r),this.shouldPersist=!0)}),w0(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),w0(this,"restore",async()=>{try{let e=await this.core.storage.getItem(this.storageKey)||[];if(!e.length)return;e.forEach(e=>{this.events.set(e.eventId,wX(wX({},e),this.setMethods(e.eventId)))})}catch(e){this.logger.warn(e)}}),w0(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let e=[];for(let[t,r]of this.events)r.props.type&&e.push(r);if(0!==e.length)try{if((await this.sendEvent(e)).ok)for(let t of e)this.events.delete(t.eventId),this.shouldPersist=!0}catch(e){this.logger.warn(e)}}),w0(this,"sendEvent",async e=>{let t=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${gF}${t}`,{method:"POST",body:JSON.stringify(e)})}),w0(this,"getAppDomain",()=>us().url),this.logger=dV(t,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var w2=Object.defineProperty,w3=Object.getOwnPropertySymbols,w5=Object.prototype.hasOwnProperty,w8=Object.prototype.propertyIsEnumerable,w6=(e,t,r)=>t in e?w2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w4=(e,t)=>{for(var r in t||(t={}))w5.call(t,r)&&w6(e,r,t[r]);if(w3)for(var r of w3(t))w8.call(t,r)&&w6(e,r,t[r]);return e},w7=(e,t,r)=>w6(e,"symbol"!=typeof t?t+"":t,r);class w9 extends ga{constructor(e){var t;super(e),w7(this,"protocol","wc"),w7(this,"version",2),w7(this,"name",gx),w7(this,"relayUrl"),w7(this,"projectId"),w7(this,"customStoragePrefix"),w7(this,"events",new oH.EventEmitter),w7(this,"logger"),w7(this,"heartbeat"),w7(this,"relayer"),w7(this,"crypto"),w7(this,"storage"),w7(this,"history"),w7(this,"expirer"),w7(this,"pairing"),w7(this,"verify"),w7(this,"echoClient"),w7(this,"linkModeSupportedApps"),w7(this,"eventClient"),w7(this,"initialized",!1),w7(this,"logChunkController"),w7(this,"on",(e,t)=>this.events.on(e,t)),w7(this,"once",(e,t)=>this.events.once(e,t)),w7(this,"off",(e,t)=>this.events.off(e,t)),w7(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),w7(this,"dispatchEnvelope",({topic:e,message:t,sessionExists:r})=>{if(!e||!t)return;let i={topic:e,message:t,publishedAt:Date.now(),transportType:gz};this.relayer.onLinkMessageEvent(i,{sessionExists:r})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(e){console.warn("Failed to copy global core",e)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||gR,this.customStoragePrefix=null!=e&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const{logger:i,chunkLoggerController:n}=dJ({opts:function(e){return dB(dK({},e),dW({level:e?.level||"info"}))}({level:"string"==typeof e?.logger&&e.logger?e.logger:"error",name:gx}),maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=n,null!=(t=this.logChunkController)&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var e,t;null!=(e=this.logChunkController)&&e.downloadLogsBlobInBrowser&&(null==(t=this.logChunkController)||t.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=dV(i,this.name),this.heartbeat=new gt.HeartBeat,this.crypto=new mz(this,this.logger,e?.keychain),this.history=new wL(this,this.logger),this.expirer=new wF(this,this.logger),this.storage=null!=e&&e.storage?e.storage:new gr.default(w4(w4({},gk),e?.storageOptions)),this.relayer=new ww({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new wU(this,this.logger),this.verify=new wH(this,this.logger,this.storage),this.echoClient=new wV(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new w1(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let t=new w9(e);await t.initialize();let r=await t.crypto.getClientId();return await t.storage.setItem("WALLETCONNECT_CLIENT_ID",r),t}get context(){return d$(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return null==(e=this.logChunkController)?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(gK,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(gK)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,r=`${t}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[t]}catch(e){console.warn("Failed to get global WalletConnect core",e);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${(null==(t=e.opts)?void 0:t.customStoragePrefix)||""}`;globalThis[r]=e}catch(e){console.warn("Failed to set global WalletConnect core",e)}}isGlobalCoreDisabled(){try{return"u">typeof sx.default&&"true"===sx.default.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let be="client",bt=`wc@2:${be}:`,br="WALLETCONNECT_DEEPLINK_CHOICE",bi=(o$.THIRTY_DAYS,"Proposal expired"),bn=o$.SEVEN_DAYS,bs={wc_sessionPropose:{req:{ttl:o$.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:o$.ONE_DAY,prompt:!1,tag:1104},res:{ttl:o$.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:o$.ONE_DAY,prompt:!1,tag:1106},res:{ttl:o$.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:o$.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:o$.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:o$.ONE_DAY,prompt:!1,tag:1112},res:{ttl:o$.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:o$.ONE_DAY,prompt:!1,tag:1114},res:{ttl:o$.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:o$.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:o$.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:o$.FIVE_MINUTES,prompt:!1,tag:1119}}},ba={min:o$.FIVE_MINUTES,max:o$.SEVEN_DAYS},bo="IDLE",bl="ACTIVE",bc={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},bd=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],bu="wc@1.5:auth:",bh=`${bu}:PUB_KEY`;var bp=Object.defineProperty,bf=Object.defineProperties,by=Object.getOwnPropertyDescriptors,bg=Object.getOwnPropertySymbols,bm=Object.prototype.hasOwnProperty,bw=Object.prototype.propertyIsEnumerable,bb=(e,t,r)=>t in e?bp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,bv=(e,t)=>{for(var r in t||(t={}))bm.call(t,r)&&bb(e,r,t[r]);if(bg)for(var r of bg(t))bw.call(t,r)&&bb(e,r,t[r]);return e},bE=(e,t,r)=>bb(e,"symbol"!=typeof t?t+"":t,r);class bA extends gE{constructor(t){super(t),bE(this,"name","engine"),bE(this,"events",new oH.default),bE(this,"initialized",!1),bE(this,"requestQueue",{state:bo,queue:[]}),bE(this,"sessionRequestQueue",{state:bo,queue:[]}),bE(this,"emittedSessionRequests",new uS({limit:500})),bE(this,"requestQueueDelay",o$.ONE_SECOND),bE(this,"expectedPairingMethodMap",new Map),bE(this,"recentlyDeletedMap",new Map),bE(this,"recentlyDeletedLimit",200),bE(this,"relayMessageCache",[]),bE(this,"pendingSessions",new Map),bE(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(bs)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,o$.toMiliseconds)(this.requestQueueDelay)))}),bE(this,"connect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let t=bf(bv({},e),by({requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}}));await this.isValidConnect(t),t.optionalNamespaces=function(e,t){var r,i,n,s,a,o;let l=yB(e),c=yB(t),d={};for(let e of Object.keys(l).concat(Object.keys(c)))d[e]={chains:um(null==(r=l[e])?void 0:r.chains,null==(i=c[e])?void 0:i.chains),methods:um(null==(n=l[e])?void 0:n.methods,null==(s=c[e])?void 0:s.methods),events:um(null==(a=l[e])?void 0:a.events,null==(o=c[e])?void 0:o.events)};return d}(t.requiredNamespaces,t.optionalNamespaces),t.requiredNamespaces={};let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:s,scopedProperties:a,relays:o}=t,l=r,c,d=!1;try{if(l){let e=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=e.active}}catch(e){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),e}if(!l||!d){let{topic:e,uri:t}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=e,c=t}if(!l){let{message:e}=yq("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw Error(e)}let u=await this.client.core.crypto.generateKeyPair(),h=bs.wc_sessionPropose.req.ttl||o$.FIVE_MINUTES,p=uf(h),f=bf(bv(bv({requiredNamespaces:i,optionalNamespaces:n,relays:o??[{protocol:"irn"}],proposer:{publicKey:u,metadata:this.client.metadata},expiryTimestamp:p,pairingTopic:l},s&&{sessionProperties:s}),a&&{scopedProperties:a}),by({id:(0,g_.payloadId)()})),y=ug("session_connect",f.id),{reject:g,resolve:m,done:w}=ud(h,bi),b=({id:e})=>{e===f.id&&(this.client.events.off("proposal_expire",b),this.pendingSessions.delete(f.id),this.events.emit(y,{error:{message:bi,code:0}}))};return this.client.events.on("proposal_expire",b),this.events.once(y,({error:e,session:t})=>{this.client.events.off("proposal_expire",b),e?g(e):t&&m(t)}),await this.sendProposeSession({proposal:f,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f.id}}}),await this.setProposal(f.id,f),{uri:c,approval:w}}),bE(this,"pair",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(e)}catch(e){throw this.client.logger.error("pair() failed"),e}}),bE(this,"approve",async e=>{var t,r,i;let n=this.client.core.eventClient.createEvent({properties:{topic:null==(t=e?.id)?void 0:t.toString(),trace:[g4]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(e){throw n.setError("no_internet_connection"),e}try{await this.isValidProposalId(e?.id)}catch(t){throw this.client.logger.error(`approve() -> proposal.get(${e?.id}) failed`),n.setError("proposal_not_found"),t}try{await this.isValidApprove(e)}catch(e){throw this.client.logger.error("approve() -> isValidApprove() failed"),n.setError("session_approve_namespace_validation_failure"),e}let{id:s,relayProtocol:a,namespaces:o,sessionProperties:l,scopedProperties:c,sessionConfig:d}=e,u=this.client.proposal.get(s);this.client.core.eventClient.deleteEvent({eventId:n.eventId});let{pairingTopic:h,proposer:p,requiredNamespaces:f,optionalNamespaces:y}=u,g=null==(r=this.client.core.eventClient)?void 0:r.getEvent({topic:h});g||(g=null==(i=this.client.core.eventClient)?void 0:i.createEvent({type:g4,properties:{topic:h,trace:[g4,"session_namespaces_validation_success"]}}));let m=await this.client.core.crypto.generateKeyPair(),w=p.publicKey,b=await this.client.core.crypto.generateSharedKey(m,w),v=bv(bv(bv({relay:{protocol:a??"irn"},namespaces:o,controller:{publicKey:m,metadata:this.client.metadata},expiry:uf(bn)},l&&{sessionProperties:l}),c&&{scopedProperties:c}),d&&{sessionConfig:d});g.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(b,{transportType:gq,internal:{skipSubscribe:!0}})}catch(e){throw g.setError("subscribe_session_topic_failure"),e}g.addTrace("subscribe_session_topic_success");let E=bf(bv({},v),by({topic:b,requiredNamespaces:f,optionalNamespaces:y,pairingTopic:h,acknowledged:!1,self:v.controller,peer:{publicKey:p.publicKey,metadata:p.metadata},controller:m,transportType:gq}));await this.client.session.set(b,E),g.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:b,proposal:u,pairingProposalResponse:{relay:{protocol:a??"irn"},responderPublicKey:m},sessionSettleRequest:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:s}}}),g.addTrace("session_approve_publish_success")}catch(e){throw this.client.logger.error(e),this.client.session.delete(b,yH("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(b),e}return this.client.core.eventClient.deleteEvent({eventId:g.eventId}),await this.client.core.pairing.updateMetadata({topic:h,metadata:p.metadata}),await this.deleteProposal(s),await this.client.core.pairing.activate({topic:h}),await this.setExpiry(b,uf(bn)),{topic:b,acknowledged:()=>Promise.resolve(this.client.session.get(b))}}),bE(this,"reject",async e=>{let t;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(e)}catch(e){throw this.client.logger.error("reject() -> isValidReject() failed"),e}let{id:r,reason:i}=e;try{t=this.client.proposal.get(r).pairingTopic}catch(e){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),e}t&&await this.sendError({id:r,topic:t,error:i,rpcOpts:bs.wc_sessionPropose.reject}),await this.deleteProposal(r)}),bE(this,"update",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(e)}catch(e){throw this.client.logger.error("update() -> isValidUpdate() failed"),e}let{topic:t,namespaces:r}=e,{done:i,resolve:n,reject:s}=ud(),a=(0,g_.payloadId)(),o=(0,g_.getBigIntRpcId)().toString(),l=this.client.session.get(t).namespaces;return this.events.once(ug("session_update",a),({error:e})=>{e?s(e):n()}),await this.client.session.update(t,{namespaces:r}),await this.sendRequest({topic:t,method:"wc_sessionUpdate",params:{namespaces:r},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:o}).catch(e=>{this.client.logger.error(e),this.client.session.update(t,{namespaces:l}),s(e)}),{acknowledged:i}}),bE(this,"extend",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(e)}catch(e){throw this.client.logger.error("extend() -> isValidExtend() failed"),e}let{topic:t}=e,r=(0,g_.payloadId)(),{done:i,resolve:n,reject:s}=ud();return this.events.once(ug("session_extend",r),({error:e})=>{e?s(e):n()}),await this.setExpiry(t,uf(bn)),this.sendRequest({topic:t,method:"wc_sessionExtend",params:{},clientRpcId:r,throwOnFailedPublish:!0}).catch(e=>{s(e)}),{acknowledged:i}}),bE(this,"request",async e=>{this.isInitialized();try{await this.isValidRequest(e)}catch(e){throw this.client.logger.error("request() -> isValidRequest() failed"),e}let{chainId:t,request:r,topic:i,expiry:n=bs.wc_sessionRequest.req.ttl}=e,s=this.client.session.get(i);s?.transportType===gq&&await this.confirmOnlineStateOrThrow();let a=(0,g_.payloadId)(),o=(0,g_.getBigIntRpcId)().toString(),{done:l,resolve:c,reject:d}=ud(n,"Request expired. Please try again.");this.events.once(ug("session_request",a),({error:e,result:t})=>{e?d(e):c(t)});let u="wc_sessionRequest",h=this.getAppLinkIfEnabled(s.peer.metadata,s.transportType);if(h)return await this.sendRequest({clientRpcId:a,relayRpcId:o,topic:i,method:u,params:{request:bf(bv({},r),by({expiryTimestamp:uf(n)})),chainId:t},expiry:n,throwOnFailedPublish:!0,appLink:h}).catch(e=>d(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:a}),await l();let p={request:bf(bv({},r),by({expiryTimestamp:uf(n)})),chainId:t};return await Promise.all([new Promise(async e=>{await this.sendRequest({clientRpcId:a,relayRpcId:o,topic:i,method:u,params:p,expiry:n,throwOnFailedPublish:!0,tvf:this.getTVFParams(a,p)}).catch(e=>d(e)),this.client.events.emit("session_request_sent",{topic:i,request:r,chainId:t,id:a}),e()}),new Promise(async e=>{var t;if(!(null!=(t=s.sessionConfig)&&t.disableDeepLink)){let e=await ub(this.client.core.storage,br);await uw({id:a,topic:i,wcDeepLink:e})}e()}),l()]).then(e=>e[2])}),bE(this,"respond",async e=>{var t,r;this.isInitialized();let i=this.client.core.eventClient.createEvent({properties:{topic:e?.topic||(null==(r=null==(t=e?.response)?void 0:t.id)?void 0:r.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(e)}catch(e){throw i.addTrace(e?.message),i.setError("session_request_response_validation_failure"),e}i.addTrace("session_request_response_validation_success");let{topic:n,response:s}=e,{id:a}=s,o=this.client.session.get(n);o.transportType===gq&&await this.confirmOnlineStateOrThrow();let l=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);try{i.addTrace("session_request_response_publish_started"),(0,gS.isJsonRpcResult)(s)?await this.sendResult({id:a,topic:n,result:s.result,throwOnFailedPublish:!0,appLink:l}):(0,gS.isJsonRpcError)(s)&&await this.sendError({id:a,topic:n,error:s.error,appLink:l}),this.cleanupAfterResponse(e)}catch(e){throw i.addTrace(e?.message),i.setError("session_request_response_publish_failure"),e}}),bE(this,"ping",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(e)}catch(e){throw this.client.logger.error("ping() -> isValidPing() failed"),e}let{topic:t}=e;if(this.client.session.keys.includes(t)){let e=(0,g_.payloadId)(),r=(0,g_.getBigIntRpcId)().toString(),{done:i,resolve:n,reject:s}=ud();this.events.once(ug("session_ping",e),({error:e})=>{e?s(e):n()}),await Promise.all([this.sendRequest({topic:t,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:e,relayRpcId:r}),i()])}else this.client.core.pairing.pairings.keys.includes(t)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:t}))}),bE(this,"emit",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(e);let{topic:t,event:r,chainId:i}=e,n=(0,g_.getBigIntRpcId)().toString(),s=(0,g_.payloadId)();await this.sendRequest({topic:t,method:"wc_sessionEvent",params:{event:r,chainId:i},throwOnFailedPublish:!0,relayRpcId:n,clientRpcId:s})}),bE(this,"disconnect",async e=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(e);let{topic:t}=e;if(this.client.session.keys.includes(t))await this.sendRequest({topic:t,method:"wc_sessionDelete",params:yH("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:t,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(t))await this.client.core.pairing.disconnect({topic:t});else{let{message:e}=yq("MISMATCHED_TOPIC",`Session or pairing topic not found: ${t}`);throw Error(e)}}),bE(this,"find",e=>(this.isInitialized(),this.client.session.getAll().filter(t=>(function(e,t){let{requiredNamespaces:r}=t,i=Object.keys(e.namespaces),n=Object.keys(r),s=!0;return!!uo(n,i)&&(i.forEach(t=>{let{accounts:i,methods:n,events:a}=e.namespaces[t],o=yD(i),l=r[t];uo(dY(t,l),o)&&uo(l.methods,n)&&uo(l.events,a)||(s=!1)}),s)})(t,e)))),bE(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),bE(this,"authenticate",async(e,t)=>{var r,i,n,s,a;let o;this.isInitialized(),this.isValidAuthenticate(e);let l=t&&this.client.core.linkModeSupportedApps.includes(t)&&(null==(r=this.client.metadata.redirect)?void 0:r.linkMode),c=l?gz:gq;c===gq&&await this.confirmOnlineStateOrThrow();let{chains:d,statement:u="",uri:h,domain:p,nonce:f,type:y,exp:g,nbf:m,methods:w=[],expiry:b}=e,v=[...e.resources||[]],{topic:E,uri:A}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:c});this.client.logger.info({message:"Generated new pairing",pairing:{topic:E,uri:A}});let _=await this.client.core.crypto.generateKeyPair(),S=yn(_);if(await Promise.all([this.client.auth.authKeys.set(bh,{responseTopic:S,publicKey:_}),this.client.auth.pairingTopics.set(S,{topic:S,pairingTopic:E})]),await this.client.core.relayer.subscribe(S,{transportType:c}),this.client.logger.info(`sending request to new pairing topic: ${E}`),w.length>0){let e,t,{namespace:r}=dZ(d[0]),o=pi(function(e,t,r,i={}){return r?.sort((e,t)=>e.localeCompare(t)),{att:{[e]:function(e,t,r={}){return Object.assign({},...(t=t?.sort((e,t)=>e.localeCompare(t))).map(t=>({[`${e}/${t}`]:[r]})))}(t,r,i)}}}(r,"request",w));po(v)&&(i=o,n=v.pop(),o=pi((s=pn(i),a=pn(n),pr(s),pr(a),e=Object.keys(s.att).concat(Object.keys(a.att)).sort((e,t)=>e.localeCompare(t)),t={att:{}},e.forEach(e=>{var r,i;Object.keys((null==(r=s.att)?void 0:r[e])||{}).concat(Object.keys((null==(i=a.att)?void 0:i[e])||{})).sort((e,t)=>e.localeCompare(t)).forEach(r=>{var i,n;t.att[e]=h1(((e,t)=>{for(var r in t||(t={}))h5.call(t,r)&&h6(e,r,t[r]);if(h3)for(var r of h3(t))h8.call(t,r)&&h6(e,r,t[r]);return e})({},t.att[e]),h2({[r]:(null==(i=s.att[e])?void 0:i[r])||(null==(n=a.att[e])?void 0:n[r])}))})}),t))),v.push(o)}let I=b&&b>bs.wc_sessionAuthenticate.req.ttl?b:bs.wc_sessionAuthenticate.req.ttl,x={authPayload:{type:y??"caip122",chains:d,statement:u,aud:h,domain:p,version:"1",nonce:f,iat:new Date().toISOString(),exp:g,nbf:m,resources:v},requester:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:uf(I)},T={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:d,methods:[...new Set(["personal_sign",...w])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:E,proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:uf(bs.wc_sessionPropose.req.ttl),id:(0,g_.payloadId)()},{done:k,resolve:C,reject:P}=ud(I,"Request expired"),O=(0,g_.payloadId)(),R=ug("session_connect",T.id),N=ug("session_request",O),M=async({error:e,session:t})=>{this.events.off(N,U),e?P(e):t&&C({session:t})},U=async e=>{var r,i,n;let s;if(await this.deletePendingAuthRequest(O,{message:"fulfilled",code:0}),e.error){let t=yH("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return e.error.code===t.code?void 0:(this.events.off(R,M),P(e.error.message))}await this.deleteProposal(T.id),this.events.off(R,M);let{cacaos:a,responder:o}=e.result,l=[],d=[];for(let e of a){await pe({cacao:e,projectId:this.client.core.projectId})||(this.client.logger.error(e,"Signature verification failed"),P(yH("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:t}=e,r=po(t.resources),i=[h7(t.iss)],n=h9(t.iss);if(r){let e=ps(r),t=pa(r);l.push(...e),i.push(...t)}for(let e of i)d.push(`${e}:${n}`)}let u=await this.client.core.crypto.generateSharedKey(_,o.publicKey);l.length>0&&(s={topic:u,acknowledged:!0,self:{publicKey:_,metadata:this.client.metadata},peer:o,controller:o.publicKey,expiry:uf(bn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:E,namespaces:yW([...new Set(l)],[...new Set(d)]),transportType:c},await this.client.core.relayer.subscribe(u,{transportType:c}),await this.client.session.set(u,s),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:o.metadata}),s=this.client.session.get(u)),null!=(r=this.client.metadata.redirect)&&r.linkMode&&null!=(i=o.metadata.redirect)&&i.linkMode&&null!=(n=o.metadata.redirect)&&n.universal&&t&&(this.client.core.addLinkModeSupportedApp(o.metadata.redirect.universal),this.client.session.update(u,{transportType:gz})),C({auths:a,session:s})};this.events.once(R,M),this.events.once(N,U);try{if(l){let e=(0,g_.formatJsonRpcRequest)("wc_sessionAuthenticate",x,O);this.client.core.history.set(E,e);let r=await this.client.core.crypto.encode("",e,{type:2,encoding:yt});o=yx(t,E,r)}else await Promise.all([this.sendRequest({topic:E,method:"wc_sessionAuthenticate",params:x,expiry:e.expiry,throwOnFailedPublish:!0,clientRpcId:O}),this.sendRequest({topic:E,method:"wc_sessionPropose",params:T,expiry:bs.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(e){throw this.events.off(R,M),this.events.off(N,U),e}return await this.setProposal(T.id,T),await this.setAuthRequest(O,{request:bf(bv({},x),by({verifyContext:{}})),pairingTopic:E,transportType:c}),{uri:o??A,response:k}}),bE(this,"approveSessionAuthenticate",async e=>{let t,{id:r,auths:i}=e,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(e){throw n.setError("no_internet_connection"),e}let s=this.getPendingAuthRequest(r);if(!s)throw n.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${r}`);let a=s.transportType||gq;a===gq&&await this.confirmOnlineStateOrThrow();let o=s.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),c=yn(o),d={type:1,receiverPublicKey:o,senderPublicKey:l},u=[],h=[];for(let e of i){if(!await pe({cacao:e,projectId:this.client.core.projectId})){n.setError("invalid_cacao");let e=yH("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:c,error:e,encodeOpts:d}),Error(e.message)}n.addTrace("cacaos_verified");let{p:t}=e,i=po(t.resources),s=[h7(t.iss)],a=h9(t.iss);if(i){let e=ps(i),t=pa(i);u.push(...e),s.push(...t)}for(let e of s)h.push(`${e}:${a}`)}let p=await this.client.core.crypto.generateSharedKey(l,o);if(n.addTrace("create_authenticated_session_topic"),u?.length>0){t={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:o,metadata:s.requester.metadata},controller:o,expiry:uf(bn),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:s.pairingTopic,namespaces:yW([...new Set(u)],[...new Set(h)]),transportType:a},n.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(e){throw n.setError("subscribe_authenticated_session_topic_failure"),e}n.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(p,t),n.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:s.pairingTopic,metadata:s.requester.metadata})}n.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:c,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:d,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(s.requester.metadata,a)})}catch(e){throw n.setError("authenticated_session_approve_publish_failure"),e}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:s.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:t}}),bE(this,"rejectSessionAuthenticate",async e=>{this.isInitialized();let{id:t,reason:r}=e,i=this.getPendingAuthRequest(t);if(!i)throw Error(`Could not find pending auth request with id ${t}`);i.transportType===gq&&await this.confirmOnlineStateOrThrow();let n=i.requester.publicKey,s=await this.client.core.crypto.generateKeyPair(),a=yn(n);await this.sendError({id:t,topic:a,error:r,encodeOpts:{type:1,receiverPublicKey:n,senderPublicKey:s},rpcOpts:bs.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(t,{message:"rejected",code:0}),await this.deleteProposal(t)}),bE(this,"formatAuthMessage",e=>{this.isInitialized();let{request:t,iss:r}=e;return pt(t,r)}),bE(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let e=this.relayMessageCache.shift();e&&await this.onRelayMessage(e)}catch(e){this.client.logger.error(e)}},50)}),bE(this,"cleanupDuplicatePairings",async e=>{if(e.pairingTopic)try{let t=this.client.core.pairing.pairings.get(e.pairingTopic),r=this.client.core.pairing.pairings.getAll().filter(r=>{var i,n;return(null==(i=r.peerMetadata)?void 0:i.url)&&(null==(n=r.peerMetadata)?void 0:n.url)===e.peer.metadata.url&&r.topic&&r.topic!==t.topic});if(0===r.length)return;this.client.logger.info(`Cleaning up ${r.length} duplicate pairing(s)`),await Promise.all(r.map(e=>this.client.core.pairing.disconnect({topic:e.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(e){this.client.logger.error(e)}}),bE(this,"deleteSession",async e=>{var t;let{topic:r,expirerHasDeleted:i=!1,emitEvent:n=!0,id:s=0}=e,{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await this.client.session.delete(r,yH("USER_DISCONNECTED")),this.addToRecentlyDeleted(r,"session"),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r),this.client.core.storage.removeItem(br).catch(e=>this.client.logger.warn(e)),this.getPendingSessionRequests().forEach(e=>{e.topic===r&&this.deletePendingSessionRequest(e.id,yH("USER_DISCONNECTED"))}),r===(null==(t=this.sessionRequestQueue.queue[0])?void 0:t.topic)&&(this.sessionRequestQueue.state=bo),n&&this.client.events.emit("session_delete",{id:s,topic:r})}),bE(this,"deleteProposal",async(e,t)=>{if(t)try{let t=this.client.proposal.get(e),r=this.client.core.eventClient.getEvent({topic:t.pairingTopic});r?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(e,yH("USER_DISCONNECTED")),t?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"proposal")}),bE(this,"deletePendingSessionRequest",async(e,t,r=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)]),this.addToRecentlyDeleted(e,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(t=>t.id!==e),r&&(this.sessionRequestQueue.state=bo,this.client.events.emit("session_request_expire",{id:e}))}),bE(this,"deletePendingAuthRequest",async(e,t,r=!1)=>{await Promise.all([this.client.auth.requests.delete(e,t),r?Promise.resolve():this.client.core.expirer.del(e)])}),bE(this,"setExpiry",async(e,t)=>{this.client.session.keys.includes(e)&&(this.client.core.expirer.set(e,t),await this.client.session.update(e,{expiry:t}))}),bE(this,"setProposal",async(e,t)=>{this.client.core.expirer.set(e,uf(bs.wc_sessionPropose.req.ttl)),await this.client.proposal.set(e,t)}),bE(this,"setAuthRequest",async(e,t)=>{let{request:r,pairingTopic:i,transportType:n=gq}=t;this.client.core.expirer.set(e,r.expiryTimestamp),await this.client.auth.requests.set(e,{authPayload:r.authPayload,requester:r.requester,expiryTimestamp:r.expiryTimestamp,id:e,pairingTopic:i,verifyContext:r.verifyContext,transportType:n})}),bE(this,"setPendingSessionRequest",async e=>{let{id:t,topic:r,params:i,verifyContext:n}=e,s=i.request.expiryTimestamp||uf(bs.wc_sessionRequest.req.ttl);this.client.core.expirer.set(t,s),await this.client.pendingRequest.set(t,{id:t,topic:r,params:i,verifyContext:n})}),bE(this,"sendRequest",async t=>{let r,i,{topic:n,method:s,params:a,expiry:o,relayRpcId:l,clientRpcId:c,throwOnFailedPublish:d,appLink:u,tvf:h,publishOpts:p={}}=t,f=(0,g_.formatJsonRpcRequest)(s,a,c),y=!!u;try{let e=y?yt:ye;r=await this.client.core.crypto.encode(n,f,{encoding:e})}catch(e){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),e}if(bd.includes(s)){let e=ys(JSON.stringify(f)),t=ys(r);i=await this.client.core.verify.register({id:t,decryptedId:e})}let g=bv(bv({},bs[s].req),p);if(g.attestation=i,o&&(g.ttl=o),l&&(g.id=l),this.client.core.history.set(n,f),y){let t=yx(u,n,r);await e.g.Linking.openURL(t,this.client.name)}else{let e;g.tvf=bf(bv({},h),by({correlationId:f.id})),d?(e=bv({},g.internal),g.internal=bf(e,by({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(n,r,g)):this.client.core.relayer.publish(n,r,g).catch(e=>this.client.logger.error(e))}return f.id}),bE(this,"sendProposeSession",async e=>{let{proposal:t,publishOpts:r}=e,i=(0,g_.formatJsonRpcRequest)("wc_sessionPropose",t,t.id);this.client.core.history.set(t.pairingTopic,i);let n=await this.client.core.crypto.encode(t.pairingTopic,i,{encoding:ye}),s=ys(JSON.stringify(i)),a=ys(n),o=await this.client.core.verify.register({id:a,decryptedId:s});await this.client.core.relayer.publishCustom({payload:{pairingTopic:t.pairingTopic,sessionProposal:n},opts:bf(bv({},r),by({publishMethod:"wc_proposeSession",attestation:o}))})}),bE(this,"sendApproveSession",async e=>{let{sessionTopic:t,pairingProposalResponse:r,proposal:i,sessionSettleRequest:n,publishOpts:s}=e,a=(0,g_.formatJsonRpcResult)(i.id,r),o=await this.client.core.crypto.encode(i.pairingTopic,a,{encoding:ye}),l=(0,g_.formatJsonRpcRequest)("wc_sessionSettle",n,s?.id),c=await this.client.core.crypto.encode(t,l,{encoding:ye});this.client.core.history.set(t,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:t,pairingTopic:i.pairingTopic,sessionProposalResponse:o,sessionSettlementRequest:c},opts:bf(bv({},s),by({publishMethod:"wc_approveSession"}))})}),bE(this,"sendResult",async t=>{let r,i,n,{id:s,topic:a,result:o,throwOnFailedPublish:l,encodeOpts:c,appLink:d}=t,u=(0,g_.formatJsonRpcResult)(s,o),h=d&&"u">typeof(null==e.g?void 0:e.g.Linking);try{let e,t,i=h?yt:ye;r=await this.client.core.crypto.encode(a,u,(e=bv({},c||{}),t={encoding:i},bf(e,by(t))))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${a} failed`),e}try{let e=(i=await this.client.core.history.get(a,s)).request;try{n=this.getTVFParams(s,e.params,o)}catch(e){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${e?.message}`)}}catch(e){throw this.client.logger.error(`sendResult() -> history.get(${a}, ${s}) failed`),e}if(h){let t=yx(d,a,r);await e.g.Linking.openURL(t,this.client.name)}else{let e,t=bs[i.request.method].res;t.tvf=bf(bv({},n),by({correlationId:s})),l?(e=bv({},t.internal),t.internal=bf(e,by({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(a,r,t)):this.client.core.relayer.publish(a,r,t).catch(e=>this.client.logger.error(e))}await this.client.core.history.resolve(u)}),bE(this,"sendError",async t=>{let r,i,{id:n,topic:s,error:a,encodeOpts:o,rpcOpts:l,appLink:c}=t,d=(0,g_.formatJsonRpcError)(n,a),u=c&&"u">typeof(null==e.g?void 0:e.g.Linking);try{let e,t,i=u?yt:ye;r=await this.client.core.crypto.encode(s,d,(e=bv({},o||{}),t={encoding:i},bf(e,by(t))))}catch(e){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),e}try{i=await this.client.core.history.get(s,n)}catch(e){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),e}if(u){let t=yx(c,s,r);await e.g.Linking.openURL(t,this.client.name)}else{let e=i.request.method,t=l||bs[e].res;this.client.core.relayer.publish(s,r,t)}await this.client.core.history.resolve(d)}),bE(this,"cleanup",async()=>{let e=[],t=[];this.client.session.getAll().forEach(t=>{let r=!1;uy(t.expiry)&&(r=!0),this.client.core.crypto.keychain.has(t.topic)||(r=!0),r&&e.push(t.topic)}),this.client.proposal.getAll().forEach(e=>{uy(e.expiryTimestamp)&&t.push(e.id)}),await Promise.all([...e.map(e=>this.deleteSession({topic:e})),...t.map(e=>this.deleteProposal(e))])}),bE(this,"onProviderMessageEvent",async e=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(e):await this.onRelayMessage(e)}),bE(this,"onRelayEventRequest",async e=>{this.requestQueue.queue.push(e),await this.processRequestsQueue()}),bE(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===bl)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=bl;let e=this.requestQueue.queue.shift();if(e)try{await this.processRequest(e)}catch(e){this.client.logger.warn(e)}}this.requestQueue.state=bo}),bE(this,"processRequest",async e=>{let{topic:t,payload:r,attestation:i,transportType:n,encryptedId:s}=e,a=r.method;if(!this.shouldIgnorePairingRequest({topic:t,requestMethod:a}))switch(a){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:t,payload:r,attestation:i,encryptedId:s});case"wc_sessionSettle":return await this.onSessionSettleRequest(t,r);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(t,r);case"wc_sessionExtend":return await this.onSessionExtendRequest(t,r);case"wc_sessionPing":return await this.onSessionPingRequest(t,r);case"wc_sessionDelete":return await this.onSessionDeleteRequest(t,r);case"wc_sessionRequest":return await this.onSessionRequest({topic:t,payload:r,attestation:i,encryptedId:s,transportType:n});case"wc_sessionEvent":return await this.onSessionEventRequest(t,r);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:t,payload:r,attestation:i,encryptedId:s,transportType:n});default:return this.client.logger.info(`Unsupported request method ${a}`)}}),bE(this,"onRelayEventResponse",async e=>{let{topic:t,payload:r,transportType:i}=e,n=(await this.client.core.history.get(t,r.id)).request.method;switch(n){case"wc_sessionPropose":return this.onSessionProposeResponse(t,r,i);case"wc_sessionSettle":return this.onSessionSettleResponse(t,r);case"wc_sessionUpdate":return this.onSessionUpdateResponse(t,r);case"wc_sessionExtend":return this.onSessionExtendResponse(t,r);case"wc_sessionPing":return this.onSessionPingResponse(t,r);case"wc_sessionRequest":return this.onSessionRequestResponse(t,r);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(t,r);default:return this.client.logger.info(`Unsupported response method ${n}`)}}),bE(this,"onRelayEventUnknownPayload",e=>{let{topic:t}=e,{message:r}=yq("MISSING_OR_INVALID",`Decoded payload on topic ${t} is not identifiable as a JSON-RPC request or a response.`);throw Error(r)}),bE(this,"shouldIgnorePairingRequest",e=>{let{topic:t,requestMethod:r}=e,i=this.expectedPairingMethodMap.get(t);return!(!i||i.includes(r))&&!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),bE(this,"onSessionProposeRequest",async e=>{let{topic:t,payload:r,attestation:i,encryptedId:n}=e,{params:s,id:a}=r;try{let e=this.client.core.eventClient.getEvent({topic:t});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),e?.setError("proposal_listener_not_found")),this.isValidConnect(bv({},r.params));let o=s.expiryTimestamp||uf(bs.wc_sessionPropose.req.ttl),l=bv({id:a,pairingTopic:t,expiryTimestamp:o,attestation:i,encryptedId:n},s);await this.setProposal(a,l);let c=await this.getVerifyContext({attestationId:i,hash:ys(JSON.stringify(r)),encryptedId:n,metadata:l.proposer.metadata});e?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:a,params:l,verifyContext:c})}catch(e){await this.sendError({id:a,topic:t,error:e,rpcOpts:bs.wc_sessionPropose.autoReject}),this.client.logger.error(e)}}),bE(this,"onSessionProposeResponse",async(e,t,r)=>{let{id:i}=t;if((0,gS.isJsonRpcResult)(t)){let{result:n}=t;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:n});let s=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:s});let a=s.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:a});let o=n.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:o});let l=await this.client.core.crypto.generateSharedKey(a,o);this.pendingSessions.set(i,{sessionTopic:l,pairingTopic:e,proposalId:i,publicKey:a});let c=await this.client.core.relayer.subscribe(l,{transportType:r});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:c}),await this.client.core.pairing.activate({topic:e})}else if((0,gS.isJsonRpcError)(t)){await this.deleteProposal(i);let e=ug("session_connect",i);if(0===this.events.listenerCount(e))throw Error(`emitting ${e} without any listeners, 954`);this.events.emit(e,{error:t.error})}}),bE(this,"onSessionSettleRequest",async(e,t)=>{let{id:r,params:i}=t;try{let r,n;this.isValidSessionSettleRequest(i);let{relay:s,controller:a,expiry:o,namespaces:l,sessionProperties:c,scopedProperties:d,sessionConfig:u}=t.params,h=[...this.pendingSessions.values()].find(t=>t.sessionTopic===e);if(!h)return this.client.logger.error(`Pending session not found for topic ${e}`);let p=this.client.proposal.get(h.proposalId),f=(r=bv(bv(bv({topic:e,relay:s,expiry:o,namespaces:l,acknowledged:!0,pairingTopic:h.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:h.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},c&&{sessionProperties:c}),d&&{scopedProperties:d}),u&&{sessionConfig:u}),n={transportType:gq},bf(r,by(n)));await this.client.session.set(f.topic,f),await this.setExpiry(f.topic,f.expiry),await this.client.core.pairing.updateMetadata({topic:h.pairingTopic,metadata:f.peer.metadata}),this.client.events.emit("session_connect",{session:f}),this.events.emit(ug("session_connect",h.proposalId),{session:f}),this.pendingSessions.delete(h.proposalId),this.deleteProposal(h.proposalId,!1),this.cleanupDuplicatePairings(f),await this.sendResult({id:t.id,topic:e,result:!0})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),bE(this,"onSessionSettleResponse",async(e,t)=>{let{id:r}=t;(0,gS.isJsonRpcResult)(t)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(ug("session_approve",r),{})):(0,gS.isJsonRpcError)(t)&&(await this.client.session.delete(e,yH("USER_DISCONNECTED")),this.events.emit(ug("session_approve",r),{error:t.error}))}),bE(this,"onSessionUpdateRequest",async(e,t)=>{let{params:r,id:i}=t;try{let t=`${e}_session_update`,n=y7.get(t);if(n&&this.isRequestOutOfSync(n,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:e,error:yH("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(bv({topic:e},r));try{y7.set(t,i),await this.client.session.update(e,{namespaces:r.namespaces}),await this.sendResult({id:i,topic:e,result:!0})}catch(e){throw y7.delete(t),e}this.client.events.emit("session_update",{id:i,topic:e,params:r})}catch(t){await this.sendError({id:i,topic:e,error:t}),this.client.logger.error(t)}}),bE(this,"isRequestOutOfSync",(e,t)=>t.toString().slice(0,-3)<e.toString().slice(0,-3)),bE(this,"onSessionUpdateResponse",(e,t)=>{let{id:r}=t,i=ug("session_update",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,gS.isJsonRpcResult)(t)?this.events.emit(ug("session_update",r),{}):(0,gS.isJsonRpcError)(t)&&this.events.emit(ug("session_update",r),{error:t.error})}),bE(this,"onSessionExtendRequest",async(e,t)=>{let{id:r}=t;try{this.isValidExtend({topic:e}),await this.setExpiry(e,uf(bn)),await this.sendResult({id:r,topic:e,result:!0}),this.client.events.emit("session_extend",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),bE(this,"onSessionExtendResponse",(e,t)=>{let{id:r}=t,i=ug("session_extend",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,gS.isJsonRpcResult)(t)?this.events.emit(ug("session_extend",r),{}):(0,gS.isJsonRpcError)(t)&&this.events.emit(ug("session_extend",r),{error:t.error})}),bE(this,"onSessionPingRequest",async(e,t)=>{let{id:r}=t;try{this.isValidPing({topic:e}),await this.sendResult({id:r,topic:e,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:r,topic:e})}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),bE(this,"onSessionPingResponse",(e,t)=>{let{id:r}=t,i=ug("session_ping",r);setTimeout(()=>{if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners 2176`);(0,gS.isJsonRpcResult)(t)?this.events.emit(ug("session_ping",r),{}):(0,gS.isJsonRpcError)(t)&&this.events.emit(ug("session_ping",r),{error:t.error})},500)}),bE(this,"onSessionDeleteRequest",async(e,t)=>{let{id:r}=t;try{this.isValidDisconnect({topic:e,reason:t.params}),await Promise.all([new Promise(t=>{this.client.core.relayer.once(gD,async()=>{t(await this.deleteSession({topic:e,id:r}))})}),this.sendResult({id:r,topic:e,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:e,error:yH("USER_DISCONNECTED")})]).catch(e=>this.client.logger.error(e))}catch(e){this.client.logger.error(e)}}),bE(this,"onSessionRequest",async e=>{var t,r,i;let{topic:n,payload:s,attestation:a,encryptedId:o,transportType:l}=e,{id:c,params:d}=s;try{await this.isValidRequest(bv({topic:n},d));let e=this.client.session.get(n),s=await this.getVerifyContext({attestationId:a,hash:ys(JSON.stringify((0,g_.formatJsonRpcRequest)("wc_sessionRequest",d,c))),encryptedId:o,metadata:e.peer.metadata,transportType:l}),u={id:c,topic:n,params:d,verifyContext:s};await this.setPendingSessionRequest(u),l===gz&&null!=(t=e.peer.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(null==(r=e.peer.metadata.redirect)?void 0:r.universal),null!=(i=this.client.signConfig)&&i.disableRequestQueue?this.emitSessionRequest(u):(this.addSessionRequestToSessionRequestQueue(u),this.processSessionRequestQueue())}catch(e){await this.sendError({id:c,topic:n,error:e}),this.client.logger.error(e)}}),bE(this,"onSessionRequestResponse",(e,t)=>{let{id:r}=t,i=ug("session_request",r);if(0===this.events.listenerCount(i))throw Error(`emitting ${i} without any listeners`);(0,gS.isJsonRpcResult)(t)?this.events.emit(ug("session_request",r),{result:t.result}):(0,gS.isJsonRpcError)(t)&&this.events.emit(ug("session_request",r),{error:t.error})}),bE(this,"onSessionEventRequest",async(e,t)=>{let{id:r,params:i}=t;try{let t=`${e}_session_event_${i.event.name}`,n=y7.get(t);if(n&&this.isRequestOutOfSync(n,r))return void this.client.logger.info(`Discarding out of sync request - ${r}`);this.isValidEmit(bv({topic:e},i)),this.client.events.emit("session_event",{id:r,topic:e,params:i}),y7.set(t,r)}catch(t){await this.sendError({id:r,topic:e,error:t}),this.client.logger.error(t)}}),bE(this,"onSessionAuthenticateResponse",(e,t)=>{let{id:r}=t;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:e,payload:t}),(0,gS.isJsonRpcResult)(t)?this.events.emit(ug("session_request",r),{result:t.result}):(0,gS.isJsonRpcError)(t)&&this.events.emit(ug("session_request",r),{error:t.error})}),bE(this,"onSessionAuthenticateRequest",async e=>{var t;let{topic:r,payload:i,attestation:n,encryptedId:s,transportType:a}=e;try{let{requester:e,authPayload:o,expiryTimestamp:l}=i.params,c=await this.getVerifyContext({attestationId:n,hash:ys(JSON.stringify(i)),encryptedId:s,metadata:e.metadata,transportType:a}),d={requester:e,pairingTopic:r,id:i.id,authPayload:o,verifyContext:c,expiryTimestamp:l};await this.setAuthRequest(i.id,{request:d,pairingTopic:r,transportType:a}),a===gz&&null!=(t=e.metadata.redirect)&&t.universal&&this.client.core.addLinkModeSupportedApp(e.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:r,params:i.params,id:i.id,verifyContext:c})}catch(s){this.client.logger.error(s);let e=i.params.requester.publicKey,t=await this.client.core.crypto.generateKeyPair(),n=this.getAppLinkIfEnabled(i.params.requester.metadata,a);await this.sendError({id:i.id,topic:r,error:s,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:t},rpcOpts:bs.wc_sessionAuthenticate.autoReject,appLink:n})}}),bE(this,"addSessionRequestToSessionRequestQueue",e=>{this.sessionRequestQueue.queue.push(e)}),bE(this,"cleanupAfterResponse",e=>{this.deletePendingSessionRequest(e.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=bo,this.processSessionRequestQueue()},(0,o$.toMiliseconds)(this.requestQueueDelay))}),bE(this,"cleanupPendingSentRequestsForTopic",({topic:e,error:t})=>{let r=this.client.core.history.pending;r.length>0&&r.filter(t=>t.topic===e&&"wc_sessionRequest"===t.request.method).forEach(e=>{let r=ug("session_request",e.request.id);if(0===this.events.listenerCount(r))throw Error(`emitting ${r} without any listeners`);this.events.emit(ug("session_request",e.request.id),{error:t})})}),bE(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===bl)return void this.client.logger.info("session request queue is already active.");let e=this.sessionRequestQueue.queue[0];if(!e)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(e)}catch(e){this.client.logger.error(e)}}),bE(this,"emitSessionRequest",e=>{this.emittedSessionRequests.has(e.id)?this.client.logger.warn({id:e.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${e.id}`):(this.sessionRequestQueue.state=bl,this.emittedSessionRequests.add(e.id),this.client.events.emit("session_request",e))}),bE(this,"onPairingCreated",e=>{if(e.methods&&this.expectedPairingMethodMap.set(e.topic,e.methods),e.active)return;let t=this.client.proposal.getAll().find(t=>t.pairingTopic===e.topic);t&&this.onSessionProposeRequest({topic:e.topic,payload:(0,g_.formatJsonRpcRequest)("wc_sessionPropose",bf(bv({},t),by({requiredNamespaces:t.requiredNamespaces,optionalNamespaces:t.optionalNamespaces,relays:t.relays,proposer:t.proposer,sessionProperties:t.sessionProperties,scopedProperties:t.scopedProperties})),t.id),attestation:t.attestation,encryptedId:t.encryptedId})}),bE(this,"isValidConnect",async e=>{let t;if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(e)}`);throw Error(t)}let{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:n,sessionProperties:s,scopedProperties:a,relays:o}=e;if(yV(r)||await this.isValidPairingTopic(r),t=!1,o?o&&yK(o)&&o.length&&o.forEach(e=>{t=y0(e)}):t=!0,!t){let{message:e}=yq("MISSING_OR_INVALID",`connect() relays: ${o}`);throw Error(e)}if(i&&!yV(i)&&0!==y$(i)){let e="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(e):this.client.logger.warn(e),this.validateNamespaces(i,"requiredNamespaces")}if(n&&!yV(n)&&0!==y$(n)&&this.validateNamespaces(n,"optionalNamespaces"),s&&!yV(s)&&this.validateSessionProps(s,"sessionProperties"),a&&!yV(a)){this.validateSessionProps(a,"scopedProperties");let e=Object.keys(i||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(t=>e.includes(t.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(e)}`)}}),bE(this,"validateNamespaces",(e,t)=>{let r=function(e,t,r){let i=null;if(e&&y$(e)){let n,s=yQ(e,t);s&&(i=s);let a=(n=null,Object.entries(e).forEach(([e,i])=>{var s,a;let o;if(n)return;let l=(s=dY(e,i),a=`${t} ${r}`,o=null,yK(s)&&s.length?s.forEach(e=>{o||yG(e)||(o=yH("UNSUPPORTED_CHAINS",`${a}, chain ${e} should be a string and conform to "namespace:chainId" format`))}):yG(e)||(o=yH("UNSUPPORTED_CHAINS",`${a}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),o);l&&(n=l)}),n);a&&(i=a)}else i=yq("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return i}(e,"connect()",t);if(r)throw Error(r.message)}),bE(this,"isValidApprove",async e=>{if(!y1(e))throw Error(yq("MISSING_OR_INVALID",`approve() params: ${e}`).message);let{id:t,namespaces:r,relayProtocol:i,sessionProperties:n,scopedProperties:s}=e;this.checkRecentlyDeleted(t),await this.isValidProposalId(t);let a=this.client.proposal.get(t),o=yX(r,"approve()");if(o)throw Error(o.message);let l=y3(a.requiredNamespaces,r,"approve()");if(l)throw Error(l.message);if(!yJ(i,!0)){let{message:e}=yq("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw Error(e)}if(n&&!yV(n)&&this.validateSessionProps(n,"sessionProperties"),s&&!yV(s)){this.validateSessionProps(s,"scopedProperties");let e=new Set(Object.keys(r));if(!Object.keys(s).every(t=>e.has(t.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(s)}, approved namespaces: ${Array.from(e).join(", ")}`)}}),bE(this,"isValidReject",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`reject() params: ${e}`);throw Error(t)}let{id:t,reason:r}=e;if(this.checkRecentlyDeleted(t),await this.isValidProposalId(t),!r||"object"!=typeof r||!r.code||!yZ(r.code,!1)||!r.message||!yJ(r.message,!1)){let{message:e}=yq("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(r)}`);throw Error(e)}}),bE(this,"isValidSessionSettleRequest",e=>{let t;if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${e}`);throw Error(t)}let{relay:r,controller:i,namespaces:n,expiry:s}=e;if(!y0(r)){let{message:e}=yq("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(e)}let a=(t=null,yJ(i?.publicKey,!1)||(t=yq("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),t);if(a)throw Error(a.message);let o=yX(n,"onSessionSettleRequest()");if(o)throw Error(o.message);if(uy(s)){let{message:e}=yq("EXPIRED","onSessionSettleRequest()");throw Error(e)}}),bE(this,"isValidUpdate",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`update() params: ${e}`);throw Error(t)}let{topic:t,namespaces:r}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t);let i=this.client.session.get(t),n=yX(r,"update()");if(n)throw Error(n.message);let s=y3(i.requiredNamespaces,r,"update()");if(s)throw Error(s.message)}),bE(this,"isValidExtend",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`extend() params: ${e}`);throw Error(t)}let{topic:t}=e;this.checkRecentlyDeleted(t),await this.isValidSessionTopic(t)}),bE(this,"isValidRequest",async e=>{var t;let r;if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`request() params: ${e}`);throw Error(t)}let{topic:i,request:n,chainId:s,expiry:a}=e;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);let{namespaces:o}=this.client.session.get(i);if(!y2(o,s)){let{message:e}=yq("MISSING_OR_INVALID",`request() chainId: ${s}`);throw Error(e)}if(yV(n)||!yJ(n.method,!1)){let{message:e}=yq("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw Error(e)}if(!(yJ(t=n.method,!1)&&(r=[],Object.values(o).forEach(e=>{yD(e.accounts).includes(s)&&r.push(...e.methods)}),r).includes(t))){let{message:e}=yq("MISSING_OR_INVALID",`request() method: ${n.method}`);throw Error(e)}if(a&&(!yZ(a,!1)||!(a<=ba.max)||!(a>=ba.min))){let{message:e}=yq("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${ba.min} and ${ba.max}`);throw Error(e)}}),bE(this,"isValidRespond",async e=>{var t;if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`respond() params: ${e}`);throw Error(t)}let{topic:r,response:i}=e;try{await this.isValidSessionTopic(r)}catch(r){throw null!=(t=e?.response)&&t.id&&this.cleanupAfterResponse(e),r}if(yV(i)||yV(i.result)&&yV(i.error)||!yZ(i.id,!1)||!yJ(i.jsonrpc,!1)){let{message:e}=yq("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw Error(e)}let n=this.client.pendingRequest.get(i.id);if(n.topic!==r){let{message:e}=yq("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${n.topic}, received topic: ${r}`);throw Error(e)}}),bE(this,"isValidPing",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`ping() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),bE(this,"isValidEmit",async e=>{var t;let r;if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`emit() params: ${e}`);throw Error(t)}let{topic:i,event:n,chainId:s}=e;await this.isValidSessionTopic(i);let{namespaces:a}=this.client.session.get(i);if(!y2(a,s)){let{message:e}=yq("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw Error(e)}if(yV(n)||!yJ(n.name,!1)||!(yJ(t=n.name,!1)&&(r=[],Object.values(a).forEach(e=>{yD(e.accounts).includes(s)&&r.push(...e.events)}),r).includes(t))){let{message:e}=yq("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw Error(e)}}),bE(this,"isValidDisconnect",async e=>{if(!y1(e)){let{message:t}=yq("MISSING_OR_INVALID",`disconnect() params: ${e}`);throw Error(t)}let{topic:t}=e;await this.isValidSessionOrPairingTopic(t)}),bE(this,"isValidAuthenticate",e=>{let{chains:t,uri:r,domain:i,nonce:n}=e;if(!Array.isArray(t)||0===t.length)throw Error("chains is required and must be a non-empty array");if(!yJ(r,!1))throw Error("uri is required parameter");if(!yJ(i,!1))throw Error("domain is required parameter");if(!yJ(n,!1))throw Error("nonce is required parameter");if([...new Set(t.map(e=>dZ(e).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:s}=dZ(t[0]);if("eip155"!==s)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),bE(this,"getVerifyContext",async e=>{let{attestationId:t,hash:r,encryptedId:i,metadata:n,transportType:s}=e,a={verified:{verifyUrl:n.verifyUrl||g3,validation:"UNKNOWN",origin:n.url||""}};try{if(s===gz){let e=this.getAppLinkIfEnabled(n,s);return a.verified.validation=e&&new URL(e).origin===new URL(n.url).origin?"VALID":"INVALID",a}let e=await this.client.core.verify.resolve({attestationId:t,hash:r,encryptedId:i,verifyUrl:n.verifyUrl});e&&(a.verified.origin=e.origin,a.verified.isScam=e.isScam,a.verified.validation=e.origin===new URL(n.url).origin?"VALID":"INVALID")}catch(e){this.client.logger.warn(e)}return this.client.logger.debug(`Verify context: ${JSON.stringify(a)}`),a}),bE(this,"validateSessionProps",(e,t)=>{Object.values(e).forEach((r,i)=>{if(null==r){let{message:n}=yq("MISSING_OR_INVALID",`${t} must contain an existing value for each key. Received: ${r} for key ${Object.keys(e)[i]}`);throw Error(n)}})}),bE(this,"getPendingAuthRequest",e=>{let t=this.client.auth.requests.get(e);return"object"==typeof t?t:void 0}),bE(this,"addToRecentlyDeleted",(e,t)=>{if(this.recentlyDeletedMap.set(e,t),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let e=0,t=this.recentlyDeletedLimit/2;for(let r of this.recentlyDeletedMap.keys()){if(e++>=t)break;this.recentlyDeletedMap.delete(r)}}}),bE(this,"checkRecentlyDeleted",e=>{let t=this.recentlyDeletedMap.get(e);if(t){let{message:r}=yq("MISSING_OR_INVALID",`Record was recently deleted - ${t}: ${e}`);throw Error(r)}}),bE(this,"isLinkModeEnabled",(t,r)=>{var i,n,s,a,o,l,c,d,u;return!!t&&r===gz&&(null==(n=null==(i=this.client.metadata)?void 0:i.redirect)?void 0:n.linkMode)===!0&&(null==(a=null==(s=this.client.metadata)?void 0:s.redirect)?void 0:a.universal)!==void 0&&(null==(l=null==(o=this.client.metadata)?void 0:o.redirect)?void 0:l.universal)!==""&&(null==(c=t?.redirect)?void 0:c.universal)!==void 0&&(null==(d=t?.redirect)?void 0:d.universal)!==""&&(null==(u=t?.redirect)?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&"u">typeof(null==e.g?void 0:e.g.Linking)}),bE(this,"getAppLinkIfEnabled",(e,t)=>{var r;return this.isLinkModeEnabled(e,t)?null==(r=e?.redirect)?void 0:r.universal:void 0}),bE(this,"handleLinkModeMessage",({url:e})=>{if(!e||!e.includes("wc_ev")||!e.includes("topic"))return;let t=uv(e,"topic")||"",r=decodeURIComponent(uv(e,"wc_ev")||""),i=this.client.session.keys.includes(t);i&&this.client.session.update(t,{transportType:gz}),this.client.core.dispatchEnvelope({topic:t,message:r,sessionExists:i})}),bE(this,"registerLinkModeListeners",async()=>{var t;if(uA()||ut()&&null!=(t=this.client.metadata.redirect)&&t.linkMode){let t=null==e.g?void 0:e.g.Linking;if("u">typeof t){t.addEventListener("url",this.handleLinkModeMessage,this.client.name);let e=await t.getInitialURL();e&&setTimeout(()=>{this.handleLinkModeMessage({url:e})},50)}}}),bE(this,"getTVFParams",(e,t,r)=>{var i,n,s;if(!(null!=(i=t.request)&&i.method))return{};let a={correlationId:e,rpcMethods:[t.request.method],chainId:t.chainId};try{a.txHashes=this.extractTxHashesFromResult(t.request,r),a.contractAddresses=this.isValidContractData(t.request.params)?[null==(s=null==(n=t.request.params)?void 0:n[0])?void 0:s.to]:[]}catch(e){this.client.logger.warn(e,"Error getting TVF params")}return a}),bE(this,"isValidContractData",e=>{var t;if(!e)return!1;try{let r=e?.data||(null==(t=e?.[0])?void 0:t.data);if(!r.startsWith("0x"))return!1;let i=r.slice(2);return!!/^[0-9a-fA-F]*$/.test(i)&&i.length%2==0}catch{}return!1}),bE(this,"extractTxHashesFromResult",(e,t)=>{var r,i,n,s,a;try{if(!t)return[];let o=e.method,l=bc[o];if("sui_signTransaction"===o){let e,r,i,s;return[(n=t.transactionBytes,e=new Uint8Array(rg.Buffer.from(n,"base64")),r=Array.from("TransactionData::").map(e=>e.charCodeAt(0)),(i=new Uint8Array(r.length+e.length)).set(r),i.set(e,r.length),s=hV(i,{dkLen:32}),dy.default.encode(s))]}if("near_signTransaction"===o)return[hY(t)];if("near_signTransactions"===o)return t.map(e=>hY(e));if("xrpl_signTransactionFor"===o||"xrpl_signTransaction"===o)return[null==(r=t.tx_json)?void 0:r.hash];if("polkadot_signTransaction"===o){let r,n,s,a;return[(i={transaction:e.params.transactionPayload,signature:t.signature},s=Uint8Array.from(rg.Buffer.from(i.signature,"hex")),a=function({publicKey:e,signature:t,payload:r}){var i,n,s;let a,o=y9(r.method),l=128|parseInt((null==(i=r.version)?void 0:i.toString())||"4"),c=(n=r.address,a=dy.default.decode(n)[0],42===a?0:60===a?2:1),d="00"===r.era?new Uint8Array([0]):y9(r.era);if(1!==d.length&&2!==d.length)throw Error("Invalid era length");let u=parseInt(r.nonce,16),h=new Uint8Array([255&u,u>>8&255]),p=new Uint8Array([0,...e,c,...t,...d,...h,...function(e){if(e<BigInt(1)<<BigInt(6))return new Uint8Array([Number(e<<BigInt(2))]);if(e<BigInt(1)<<BigInt(14)){let t=e<<BigInt(2)|BigInt(1);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255))])}if(e<BigInt(1)<<BigInt(30)){let t=e<<BigInt(2)|BigInt(2);return new Uint8Array([Number(t&BigInt(255)),Number(t>>BigInt(8)&BigInt(255)),Number(t>>BigInt(16)&BigInt(255)),Number(t>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(s=r.tip).startsWith("0x")?s.slice(2):s}`)),...o]);return new Uint8Array([...function(e){if(e<64)return new Uint8Array([e<<2]);if(e<16384){let t=e<<2|1;return new Uint8Array([255&t,t>>8&255])}if(e<0x40000000){let t=e<<2|2;return new Uint8Array([255&t,t>>8&255,t>>16&255,t>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(p.length+1),l,...p])}({publicKey:function(e){let t=dy.default.decode(e);if(t.length<33)throw Error("Too short to contain a public key");return t.slice(1,33)}(i.transaction.address),signature:s,payload:i.transaction}),r=y9(rg.Buffer.from(a).toString("hex")),n=(0,d_.blake2b)(r,void 0,32),"0x"+rg.Buffer.from(n).toString("hex"))]}if("algo_signTxn"===o)return yK(t)?t.map(e=>hQ(e)):[hQ(t)];if("cosmos_signDirect"===o){let e,r,i,n,s;return[(e=rg.Buffer.from(t.signed.bodyBytes,"base64"),r=rg.Buffer.from(t.signed.authInfoBytes,"base64"),i=rg.Buffer.from(t.signature.signature,"base64"),(n=[]).push(rg.Buffer.from([10])),n.push(hX(e.length)),n.push(e),n.push(rg.Buffer.from([18])),n.push(hX(r.length)),n.push(r),n.push(rg.Buffer.from([26])),n.push(hX(i.length)),n.push(i),s=hD(rg.Buffer.concat(n)),rg.Buffer.from(s).toString("hex").toUpperCase())]}if("wallet_sendCalls"===o){let e=[];try{if("string"==typeof t)return e.push(t),e;if("object"!=typeof t)return e;null!=t&&t.id&&e.push(t.id);let r=null==(a=null==(s=t?.capabilities)?void 0:s.caip345)?void 0:a.transactionHashes;r&&e.push(...r)}catch(e){console.warn("getWalletSendCallsHashes failed: ",e)}return e}if("string"==typeof t)return[t];let c=t[l.key];if(yK(c))return"solana_signAllTransactions"===o?c.map(e=>(function(e){let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);let i=r[0];if(0===i)throw Error("No signatures found");if(r.length<1+64*i)throw Error("Transaction data too short for claimed signature count");if(r.length<100)throw Error("Transaction too short");let n=rg.Buffer.from(e,"base64").slice(1,65);return dy.default.encode(n)})(e)):c;if("string"==typeof c)return[c]}catch(e){this.client.logger.warn(e,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[e,r]of Object.entries(t))for(let t of r)try{await this.onProviderMessageEvent({topic:e,message:t,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${e}, message: ${t}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:e}=yq("NOT_INITIALIZED",this.name);throw Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(gN,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:r,attestation:i,transportType:n}=e,{publicKey:s}=this.client.auth.authKeys.keys.includes(bh)?this.client.auth.authKeys.get(bh):{responseTopic:void 0,publicKey:void 0};try{let e=await this.client.core.crypto.decode(t,r,{receiverPublicKey:s,encoding:n===gz?yt:ye});(0,gS.isJsonRpcRequest)(e)?(this.client.core.history.set(t,e),await this.onRelayEventRequest({topic:t,payload:e,attestation:i,transportType:n,encryptedId:ys(r)})):(0,gS.isJsonRpcResponse)(e)?(await this.client.core.history.resolve(e),await this.onRelayEventResponse({topic:t,payload:e,transportType:n}),this.client.core.history.delete(t,e.id)):await this.onRelayEventUnknownPayload({topic:t,payload:e,transportType:n}),await this.client.core.relayer.messages.ack(t,r)}catch(e){this.client.logger.error(e)}}registerExpirerEvents(){this.client.core.expirer.on(g2,async e=>{let{topic:t,id:r}=up(e.target);return r&&this.client.pendingRequest.keys.includes(r)?await this.deletePendingSessionRequest(r,yq("EXPIRED"),!0):r&&this.client.auth.requests.keys.includes(r)?await this.deletePendingAuthRequest(r,yq("EXPIRED"),!0):void(t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r})))})}registerPairingEvents(){this.client.core.pairing.events.on(gZ,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(gG,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!yJ(e,!1)){let{message:t}=yq("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=yq("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw Error(t)}if(uy(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=yq("EXPIRED",`pairing topic: ${e}`);throw Error(t)}}async isValidSessionTopic(e){if(!yJ(e,!1)){let{message:t}=yq("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=yq("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw Error(t)}if(uy(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=yq("EXPIRED",`session topic: ${e}`);throw Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=yq("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(yJ(e,!1)){let{message:t}=yq("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw Error(t)}else{let{message:t}=yq("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw Error(t)}}async isValidProposalId(e){if("number"!=typeof e){let{message:t}=yq("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=yq("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw Error(t)}if(uy(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=yq("EXPIRED",`proposal id: ${e}`);throw Error(t)}}}class b_ extends wR{constructor(e,t){super(e,t,"proposal",bt),this.core=e,this.logger=t}}class bS extends wR{constructor(e,t){super(e,t,"session",bt),this.core=e,this.logger=t}}class bI extends wR{constructor(e,t){super(e,t,"request",bt,e=>e.id),this.core=e,this.logger=t}}class bx extends wR{constructor(e,t){super(e,t,"authKeys",bu,()=>bh),this.core=e,this.logger=t}}class bT extends wR{constructor(e,t){super(e,t,"pairingTopics",bu),this.core=e,this.logger=t}}class bk extends wR{constructor(e,t){super(e,t,"requests",bu,e=>e.id),this.core=e,this.logger=t}}var bC=Object.defineProperty,bP=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bC(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bO{constructor(e,t){this.core=e,this.logger=t,bP(this,"authKeys"),bP(this,"pairingTopics"),bP(this,"requests"),this.authKeys=new bx(this.core,this.logger),this.pairingTopics=new bT(this.core,this.logger),this.requests=new bk(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var bR=Object.defineProperty,bN=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?bR(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class bM extends gv{constructor(e){super(e),bN(this,"protocol","wc"),bN(this,"version",2),bN(this,"name",be),bN(this,"metadata"),bN(this,"core"),bN(this,"logger"),bN(this,"events",new oH.EventEmitter),bN(this,"engine"),bN(this,"session"),bN(this,"proposal"),bN(this,"pendingRequest"),bN(this,"auth"),bN(this,"signConfig"),bN(this,"on",(e,t)=>this.events.on(e,t)),bN(this,"once",(e,t)=>this.events.once(e,t)),bN(this,"off",(e,t)=>this.events.off(e,t)),bN(this,"removeListener",(e,t)=>this.events.removeListener(e,t)),bN(this,"removeAllListeners",e=>this.events.removeAllListeners(e)),bN(this,"connect",async e=>{try{return await this.engine.connect(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"pair",async e=>{try{return await this.engine.pair(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"approve",async e=>{try{return await this.engine.approve(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"reject",async e=>{try{return await this.engine.reject(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"update",async e=>{try{return await this.engine.update(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"extend",async e=>{try{return await this.engine.extend(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"request",async e=>{try{return await this.engine.request(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"respond",async e=>{try{return await this.engine.respond(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"ping",async e=>{try{return await this.engine.ping(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"emit",async e=>{try{return await this.engine.emit(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"disconnect",async e=>{try{return await this.engine.disconnect(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"find",e=>{try{return this.engine.find(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(e){throw this.logger.error(e.message),e}}),bN(this,"authenticate",async(e,t)=>{try{return await this.engine.authenticate(e,t)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"formatAuthMessage",e=>{try{return this.engine.formatAuthMessage(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"approveSessionAuthenticate",async e=>{try{return await this.engine.approveSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),bN(this,"rejectSessionAuthenticate",async e=>{try{return await this.engine.rejectSessionAuthenticate(e)}catch(e){throw this.logger.error(e.message),e}}),this.name=e?.name||be,this.metadata=function(e){var t,r;let i=us();try{let n,s;return null!=e&&e.url&&i.url&&new URL(e.url).host!==new URL(i.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${e.url} differs from the actual page url:${i.url}. This is probably unintended and can lead to issues.`),e.url=i.url),null!=(t=e?.icons)&&t.length&&e.icons.length>0&&(e.icons=e.icons.filter(e=>""!==e)),n=d8(d8({},i),e),s={url:e?.url||i.url,name:e?.name||i.name,description:e?.description||i.description,icons:null!=(r=e?.icons)&&r.length&&e.icons.length>0?e.icons:i.icons},dX(n,d0(s))}catch(t){return console.warn("Error populating app metadata",t),e||i}}(e?.metadata),this.signConfig=e?.signConfig;const t=ge({logger:e?.logger||"error",name:this.name});this.logger=t,this.core=e?.core||new w9(e),this.session=new bS(this.core,this.logger),this.proposal=new b_(this.core,this.logger),this.pendingRequest=new bI(this.core,this.logger),this.engine=new bA(this),this.auth=new bO(this.core,this.logger)}static async init(e){let t=new bM(e);return await t.initialize(),t}get context(){return d$(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var bU=e.i(529722);function bD(e){return null==e||"object"!=typeof e&&"function"!=typeof e}function bj(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function bL(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}let bB="[object String]",bW="[object Number]",bF="[object Boolean]",bz="[object Arguments]";function bq(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function bH(e,t,r,i=new Map,n){let s=n?.(e,t,r,i);if(null!=s)return s;if(bD(e))return e;if(i.has(e))return i.get(e);if(Array.isArray(e)){let t=Array(e.length);i.set(e,t);for(let s=0;s<e.length;s++)t[s]=bH(e[s],s,r,i,n);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){let t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){let t=new Map;for(let[s,a]of(i.set(e,t),e))t.set(s,bH(a,s,r,i,n));return t}if(e instanceof Set){let t=new Set;for(let s of(i.set(e,t),e))t.add(bH(s,void 0,r,i,n));return t}if("u">typeof rg.Buffer&&rg.Buffer.isBuffer(e))return e.subarray();if(bq(e)){let t=new(Object.getPrototypeOf(e)).constructor(e.length);i.set(e,t);for(let s=0;s<e.length;s++)t[s]=bH(e[s],s,r,i,n);return t}if(e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){let t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return i.set(e,t),bK(t,e,r,i,n),t}if("u">typeof File&&e instanceof File){let t=new File([e],e.name,{type:e.type});return i.set(e,t),bK(t,e,r,i,n),t}if(e instanceof Blob){let t=new Blob([e],{type:e.type});return i.set(e,t),bK(t,e,r,i,n),t}if(e instanceof Error){let t=new e.constructor;return i.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,bK(t,e,r,i,n),t}if("object"==typeof e&&function(e){switch(bL(e)){case bz:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case bF:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case bW:case"[object Object]":case"[object RegExp]":case"[object Set]":case bB:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(e)){let t=Object.create(Object.getPrototypeOf(e));return i.set(e,t),bK(t,e,r,i,n),t}return e}function bK(e,t,r=e,i,n){let s=[...Object.keys(t),...bj(t)];for(let a=0;a<s.length;a++){let o=s[a],l=Object.getOwnPropertyDescriptor(e,o);(null==l||l.writable)&&(e[o]=bH(t[o],o,r,i,n))}}function b$(e){var t;return t=(t,r,i,n)=>{let s;if(null!=s)return s;if("object"==typeof e)switch(Object.prototype.toString.call(e)){case bW:case bB:case bF:{let t=new e.constructor(e?.valueOf());return bK(t,e),t}case bz:{let t={};return bK(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}},bH(e,void 0,e,new Map,t)}function bV(e){return null!==e&&"object"==typeof e&&"[object Arguments]"===bL(e)}function bJ(e){return"object"==typeof e&&null!==e}function bZ(){}let bG="error",bY="universal_provider",bQ=`wc@2:${bY}:`,bX="https://rpc.walletconnect.org/v1/",b0="generic",b1=`${bX}bundler`,b2="call_status",b3="default_chain_changed";var b5=Object.defineProperty,b8=Object.defineProperties,b6=Object.getOwnPropertyDescriptors,b4=Object.getOwnPropertySymbols,b7=Object.prototype.hasOwnProperty,b9=Object.prototype.propertyIsEnumerable,ve=(e,t,r)=>t in e?b5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vt=(e,t)=>{for(var r in t||(t={}))b7.call(t,r)&&ve(e,r,t[r]);if(b4)for(var r of b4(t))b9.call(t,r)&&ve(e,r,t[r]);return e},vr=(e,t)=>b8(e,b6(t));function vi(e,t,r){var i;let n=dZ(e);return(null==(i=t.rpcMap)?void 0:i[n.reference])||`${bX}?chainId=${n.namespace}:${n.reference}&projectId=${r}`}function vn(e){return e.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function vs(e){return Object.fromEntries(Object.entries(e).filter(([e,t])=>{var r,i;return(null==(r=t?.chains)?void 0:r.length)&&(null==(i=t?.chains)?void 0:i.length)>0}))}function va(e={},t={}){return function(e,...t){return function(e,...t){let r=t.slice(0,-1),i=t[t.length-1],n=e;for(let e=0;e<r.length;e++)n=function e(t,r,i,n){if(bD(t)&&(t=Object(t)),null==r||"object"!=typeof r)return t;if(n.has(r))return function(e){if(bD(e))return e;if(Array.isArray(e)||bq(e)||e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);let t=Object.getPrototypeOf(e),r=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new r(e);if(e instanceof RegExp){let t=new r(e);return t.lastIndex=e.lastIndex,t}if(e instanceof DataView)return new r(e.buffer.slice(0));if(e instanceof Error){let t=new r(e.message);return t.stack=e.stack,t.name=e.name,t.cause=e.cause,t}return"u">typeof File&&e instanceof File?new r([e],e.name,{type:e.type,lastModified:e.lastModified}):"object"==typeof e?Object.assign(Object.create(t),e):e}(n.get(r));if(n.set(r,t),Array.isArray(r)){r=r.slice();for(let e=0;e<r.length;e++)r[e]=r[e]??void 0}let s=[...Object.keys(r),...bj(r)];for(let a=0;a<s.length;a++){let o=s[a],l=r[o],c=t[o];if(bV(l)&&(l={...l}),bV(c)&&(c={...c}),"u">typeof rg.Buffer&&rg.Buffer.isBuffer(l)&&(l=b$(l)),Array.isArray(l))if("object"==typeof c&&null!=c){let e=[],t=Reflect.ownKeys(c);for(let r=0;r<t.length;r++){let i=t[r];e[i]=c[i]}c=e}else c=[];let d=i(c,l,o,t,r,n);null!=d?t[o]=d:Array.isArray(l)||bJ(c)&&bJ(l)?t[o]=e(c,l,i,n):null==c&&function(e){if("object"!=typeof e||null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){let t=e[Symbol.toStringTag];return null!=t&&!!Object.getOwnPropertyDescriptor(e,Symbol.toStringTag)?.writable&&e.toString()===`[object ${t}]`}let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(l)?t[o]=e({},l,i,n):null==c&&bq(l)?t[o]=b$(l):(void 0===c||void 0!==l)&&(t[o]=l)}return t}(n,r[e],i,new Map);return n}(e,...t,bZ)}(vs(vo(e)),vs(vo(t)))}function vo(e){var t,r,i,n,s;let a={};if(!y$(e))return a;for(let[o,l]of Object.entries(e)){let e=yj(o)?[o]:l.chains,c=l.methods||[],d=l.events||[],u=l.rpcMap||{},h=yL(o);a[h]=vr(vt(vt({},a[h]),l),{chains:um(e,null==(t=a[h])?void 0:t.chains),methods:um(c,null==(r=a[h])?void 0:r.methods),events:um(d,null==(i=a[h])?void 0:i.events)}),(y$(u)||y$((null==(n=a[h])?void 0:n.rpcMap)||{}))&&(a[h].rpcMap=vt(vt({},u),null==(s=a[h])?void 0:s.rpcMap))}return a}function vl(e){return e.includes(":")?e.split(":")[2]:e}function vc(e){let t={};for(let[r,i]of Object.entries(e)){let e=i.methods||[],n=i.events||[],s=i.accounts||[],a=yj(r)?[r]:i.chains?i.chains:vn(i.accounts);t[r]={chains:a,methods:e,events:n,accounts:s}}return t}function vd(e){return"number"==typeof e?e:e.includes("0x")?parseInt(e,16):isNaN(Number(e=e.includes(":")?e.split(":")[1]:e))?e:Number(e)}let vu={},vh=e=>vu[e],vp=(e,t)=>{vu[e]=t};var vf=Object.defineProperty,vy=Object.getOwnPropertySymbols,vg=Object.prototype.hasOwnProperty,vm=Object.prototype.propertyIsEnumerable,vw=(e,t,r)=>t in e?vf(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vb=(e,t)=>{for(var r in t||(t={}))vg.call(t,r)&&vw(e,r,t[r]);if(vy)for(var r of vy(t))vm.call(t,r)&&vw(e,r,t[r]);return e};let vv="eip155",vE=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],vA=e=>e&&e.startsWith("0x")?BigInt(e).toString(10):e,v_=e=>e&&e.startsWith("0x")?e:`0x${BigInt(e).toString(16)}`,vS=e=>Object.keys(e).filter(e=>vE.includes(e)).reduce((t,r)=>(t[r]=vI(e[r]),t),{}),vI=e=>"string"==typeof e&&function(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!==t&&!Array.isArray(t)}catch{return!1}}(e)?JSON.parse(e):e;var vx=Object.defineProperty;class vT{constructor(e){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vx(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return t||(t=new vT(e)),t}}var vk=Object.defineProperty,vC=Object.defineProperties,vP=Object.getOwnPropertyDescriptors,vO=Object.getOwnPropertySymbols,vR=Object.prototype.hasOwnProperty,vN=Object.prototype.propertyIsEnumerable,vM=(e,t,r)=>t in e?vk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;async function vU(e,t){let r,i=dZ(e.result.capabilities.caip345.caip2),n=e.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(e=>vD(i.reference,e,t))),a=s.filter(e=>"fulfilled"===e.status).map(e=>e.value).filter(e=>e);s.filter(e=>"rejected"===e.status).forEach(e=>console.warn("Failed to fetch transaction receipt:",e.reason));let o=!a.length||a.some(e=>!e),l=a.every(e=>e?.status==="0x1"),c=a.every(e=>e?.status==="0x0"),d=a.some(e=>e?.status==="0x0");return o?r=100:l?r=200:c?r=500:d&&(r=600),{id:e.result.id,version:e.request.version,atomic:e.request.atomicRequired,chainId:e.request.chainId,capabilities:e.result.capabilities,receipts:a,status:r}}async function vD(e,t,r){return await r(parseInt(e)).request((0,g_.formatJsonRpcRequest)("eth_getTransactionReceipt",[t]))}async function vj({sendCalls:e,storage:t}){let r=await t.getItem(b2);await t.setItem(b2,vC(((e,t)=>{for(var r in t||(t={}))vR.call(t,r)&&vM(e,r,t[r]);if(vO)for(var r of vO(t))vN.call(t,r)&&vM(e,r,t[r]);return e})({},r),vP({[e.result.id]:{request:e.request,result:e.result,expiry:uf(86400)}})))}async function vL({resultId:e,storage:t}){let r=await t.getItem(b2);if(r){for(let i in delete r[e],await t.setItem(b2,r),r)uy(r[i].expiry)&&delete r[i];await t.setItem(b2,r)}}async function vB({resultId:e,storage:t}){let r=await t.getItem(b2),i=r?.[e];if(i&&!uy(i.expiry))return i;await vL({resultId:e,storage:t})}var vW=Object.defineProperty,vF=Object.defineProperties,vz=Object.getOwnPropertyDescriptors,vq=Object.getOwnPropertySymbols,vH=Object.prototype.hasOwnProperty,vK=Object.prototype.propertyIsEnumerable,v$=(e,t,r)=>t in e?vW(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vV=(e,t)=>{for(var r in t||(t={}))vH.call(t,r)&&v$(e,r,t[r]);if(vq)for(var r of vq(t))vK.call(t,r)&&v$(e,r,t[r]);return e},vJ=(e,t,r)=>v$(e,"symbol"!=typeof t?t+"":t,r);class vZ{constructor(e){vJ(this,"name","eip155"),vJ(this,"client"),vJ(this,"chainId"),vJ(this,"namespace"),vJ(this,"httpProviders"),vJ(this,"events"),vJ(this,"storage"),this.namespace=e.namespace,this.events=vh("events"),this.client=vh("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=vT.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t);let r=this.chainId;this.chainId=parseInt(e),this.events.emit(b3,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){let r=t||vi(`${this.name}:${e}`,this.namespace,this.client.core.projectId);return new gA.JsonRpcProvider(new bU.HttpConnection(r,vh("disableProviderPing")))}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(t=>{var r;let i=parseInt(t.includes(":")?t.split(":")[1]:t);e[i]=this.createHttpProvider(i,null==(r=this.namespace.rpcMap)?void 0:r[t])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}getHttpProvider(e){let t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=vF(vV({},this.httpProviders),vz({[t]:this.createHttpProvider(t)})),this.httpProviders[t])}async handleSwitchChain(e){var t,r;let i=e.request.params?null==(t=e.request.params[0])?void 0:t.chainId:"0x0",n=parseInt(i=i.startsWith("0x")?i:`0x${i}`,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:null==(r=this.namespace.chains)?void 0:r[0]}),this.setDefaultChain(`${n}`);else throw Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,r,i,n,s;let a,o=null==(r=null==(t=e.request)?void 0:t.params)?void 0:r[0],l=(null==(n=null==(i=e.request)?void 0:i.params)?void 0:n[1])||[];if(!o)throw Error("Missing address parameter in `wallet_getCapabilities` request");let c=this.client.session.get(e.topic),d=(null==(s=c?.sessionProperties)?void 0:s.capabilities)||{},u=`${o}${l.join(",")}`,h=d?.[u];if(h)return h;try{a=((e,t,r)=>{let{sessionProperties:i={},scopedProperties:n={}}=e,s={};if(!y$(n)&&!y$(i))return;let a=vS(i);for(let e of r){let r=vA(e);if(!r)continue;s[v_(r)]=a;let i=n?.[`${vv}:${r}`];if(i){let e=i?.[`${vv}:${r}:${t}`];s[v_(r)]=vb(vb({},s[v_(r)]),vS(e||i))}}for(let[e,t]of Object.entries(s))0===Object.keys(t).length&&delete s[e];return Object.keys(s).length>0?s:void 0})(c,o,l)}catch(e){console.warn("Failed to extract capabilities from session",e)}if(a)return a;let p=await this.client.request(e);try{let t,r,i,n;await this.client.session.update(e.topic,{sessionProperties:(i=vV({},c.sessionProperties||{}),n={capabilities:(t=vV({},d||{}),r={[u]:p},vF(t,vz(r)))},vF(i,vz(n)))})}catch(e){console.warn("Failed to update session with capabilities",e)}return p}async getCallStatus(e){var t,r,i;let n=this.client.session.get(e.topic),s=null==(t=n.sessionProperties)?void 0:t.bundler_name;if(s){let t=this.getBundlerUrl(e.chainId,s);try{return await this.getUserOperationReceipt(t,e)}catch(e){console.warn("Failed to fetch call status from bundler",e,t)}}let a=null==(r=n.sessionProperties)?void 0:r.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(e){console.warn("Failed to fetch call status from custom bundler",e,a)}let o=await vB({resultId:null==(i=e.request.params)?void 0:i[0],storage:this.storage});if(o)try{return await vU(o,this.getHttpProvider.bind(this))}catch(e){console.warn("Failed to fetch call status from stored send calls",e,o)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var r;let i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,g_.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(r=t.request.params)?void 0:r[0]]))});if(!n.ok)throw Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${b1}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,r,i;let n=await this.client.request(e),s=null==(t=e.request.params)?void 0:t[0],a=n?.id,o=n?.capabilities||{},l=null==(r=o?.caip345)?void 0:r.caip2,c=null==(i=o?.caip345)?void 0:i.transactionHashes;return a&&l&&null!=c&&c.length&&await vj({sendCalls:{request:s,result:n},storage:this.storage}),n}}var vG=Object.defineProperty,vY=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?vG(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r};class vQ{constructor(e){vY(this,"name",b0),vY(this,"client"),vY(this,"httpProviders"),vY(this,"events"),vY(this,"namespace"),vY(this,"chainId"),this.namespace=e.namespace,this.events=vh("events"),this.client=vh("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t);let r=this.chainId;this.chainId=e,this.events.emit(b3,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw Error("ChainId not found");return dZ(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(e=>e.split(":")[1]===this.chainId.toString()).map(e=>e.split(":")[2]))]:[]}createHttpProviders(){var e,t;let r={};return null==(t=null==(e=this.namespace)?void 0:e.accounts)||t.forEach(e=>{var t,i;let n=dZ(e),s=null==(i=null==(t=this.namespace)?void 0:t.rpcMap)?void 0:i[`${n.namespace}:${n.reference}`];r[n.reference]=this.createHttpProvider(e,s)}),r}getHttpProvider(e){let t=dZ(e).reference,r=this.httpProviders[t];if(typeof r>"u")throw Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,t){let r=this.createHttpProvider(e,t);r&&(this.httpProviders[e]=r)}createHttpProvider(e,t){let r=t||vi(e,this.namespace,this.client.core.projectId);return new gA.JsonRpcProvider(new bU.default(r,vh("disableProviderPing")))}}var vX=Object.defineProperty,v0=Object.defineProperties,v1=Object.getOwnPropertyDescriptors,v2=Object.getOwnPropertySymbols,v3=Object.prototype.hasOwnProperty,v5=Object.prototype.propertyIsEnumerable,v8=(e,t,r)=>t in e?vX(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v6=(e,t)=>{for(var r in t||(t={}))v3.call(t,r)&&v8(e,r,t[r]);if(v2)for(var r of v2(t))v5.call(t,r)&&v8(e,r,t[r]);return e},v4=(e,t,r)=>v8(e,"symbol"!=typeof t?t+"":t,r);class v7{constructor(e){var t,r;v4(this,"client"),v4(this,"namespaces"),v4(this,"optionalNamespaces"),v4(this,"sessionProperties"),v4(this,"scopedProperties"),v4(this,"events",new oH.default),v4(this,"rpcProviders",{}),v4(this,"session"),v4(this,"providerOpts"),v4(this,"logger"),v4(this,"uri"),v4(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=ge({logger:null!=(t=e.logger)?t:bG,name:null!=(r=this.providerOpts.name)?r:bY}),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){let t=new v7(e);return await t.initialize(),t}async request(e,t,r){let[i,n]=this.validateChain(t);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(i).request({request:v6({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:r})}sendAsync(e,t,r,i){let n=new Date().getTime();this.request(e,r,i).then(e=>t(null,(0,g_.formatJsonRpcResult)(n,e))).catch(e=>t(e,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(e=this.session)?void 0:e.topic,reason:yH("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();let{uri:r,response:i}=await this.client.authenticate(e,t);r&&(this.uri=r,this.events.emit("display_uri",r));let n=await i();if(this.session=n.session,this.session){let e=vc(this.session.namespaces);this.namespaces=va(this.namespaces,e),await this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){let{uri:t,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));let i=await r();this.session=i;let n=vc(i.namespaces);return this.namespaces=va(this.namespaces,n),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;let[r,i]=this.validateChain(e);this.getProvider(r).setDefaultChain(i,t)}catch(e){if(!/Please call connect/.test(e.message))throw e}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");let t=this.client.pairing.getAll();if(!yK(t))return;for(let r of t)e.deletePairings?this.client.core.expirer.set(r.topic,0):await this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(e){this.logger.warn(e,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await bM.init({core:this.providerOpts.core,logger:this.providerOpts.logger||bG,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error(r,"Failed to get session"),Error(`The provided session: ${null==(t=null==(e=this.providerOpts)?void 0:e.session)?void 0:t.topic} doesn't exist in the Sign client`)}else{let e=this.client.session.getAll();this.session=e[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(e=>yL(e)))];vp("client",this.client),vp("events",this.events),vp("disableProviderPing",this.disableProviderPing),e.forEach(e=>{if(!this.session)return;let t=function(e,t){let r=Object.keys(t.namespaces).filter(t=>t.includes(e));if(!r.length)return[];let i=[];return r.forEach(e=>{let r=t.namespaces[e].accounts;i.push(...r)}),i}(e,this.session);if(t?.length===0)return;let r=vn(t),i=v0(v6({},va(this.namespaces,this.optionalNamespaces)[e]),v1({accounts:t,chains:r}));"eip155"===e?this.rpcProviders[e]=new vZ({namespace:i}):this.rpcProviders[e]=new vQ({namespace:i})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;let{topic:r}=e;r===(null==(t=this.session)?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;let{params:r,topic:i}=e;if(i!==(null==(t=this.session)?void 0:t.topic))return;let{event:n}=r;if("accountsChanged"===n.name){let e=n.data;e&&yK(e)&&this.events.emit("accountsChanged",e.map(vl))}else if("chainChanged"===n.name){let e=r.chainId,t=r.event.data,i=yL(e),n=vd(e)!==vd(t)?`${i}:${vd(t)}`:e;this.onChainChanged({currentCaipChainId:n})}else this.events.emit(n.name,n.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var r,i;if(e!==(null==(r=this.session)?void 0:r.topic))return;let{namespaces:n}=t,s=null==(i=this.client)?void 0:i.session.get(e);this.session=v0(v6({},s),v1({namespaces:n})),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===(null==(t=this.session)?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",v0(v6({},yH("USER_DISCONNECTED")),v1({data:e.topic}))))}),this.on(b3,e=>{this.onChainChanged(v0(v6({},e),v1({internal:!0})))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[b0]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace(null==(t=this.session)?void 0:t.namespaces[e])})}setNamespaces(e){let{namespaces:t={},optionalNamespaces:r={},sessionProperties:i,scopedProperties:n}=e;this.optionalNamespaces=va(t,r),this.sessionProperties=i,this.scopedProperties=n}validateChain(e){let[t,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,r];if(t&&!Object.keys(this.namespaces||{}).map(e=>yL(e)).includes(t))throw Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&r)return[t,r];let i=yL(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){let[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:t,internal:r=!1}){if(!this.namespaces)return;let[i,n]=this.validateChain(e);n&&(this.updateNamespaceChain(i,n),r?(this.events.emit("chainChanged",n),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:t})):this.getProvider(i).setDefaultChain(n),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:t,previousCaipChainId:r}){var i,n;try{if(r===t)return;let s=null==(n=null==(i=this.session)?void 0:i.namespaces[e])?void 0:n.accounts;if(!s)return;let a=s.filter(e=>e.includes(`${t}:`)).map(vl);if(!yK(a))return;this.events.emit("accountsChanged",a)}catch(e){this.logger.warn(e,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,t){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${t}`;this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=t):this.namespaces[r]={chains:[],methods:[],events:[],defaultChain:t}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var r;let i=(null==(r=this.session)?void 0:r.topic)||"";await this.client.core.storage.setItem(`${bQ}/${e}${i}`,t)}async getFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${bQ}/${e}${r}`)}async deleteFromStore(e){var t;let r=(null==(t=this.session)?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${bQ}/${e}${r}`)}async cleanupStorage(){var e;try{if((null==(e=this.client)?void 0:e.session.length)>0)return;for(let e of(await this.client.core.storage.getKeys()))e.startsWith(bQ)&&await this.client.core.storage.removeItem(e)}catch(e){this.logger.warn(e,"Failed to cleanup storage")}}}let v9=["eth_sendTransaction","personal_sign"],Ee=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Et=["chainChanged","accountsChanged"],Er=["chainChanged","accountsChanged","message","disconnect","connect"],Ei=async()=>{let{createAppKit:t}=await e.A(391200);return t};var En=Object.defineProperty,Es=Object.defineProperties,Ea=Object.getOwnPropertyDescriptors,Eo=Object.getOwnPropertySymbols,El=Object.prototype.hasOwnProperty,Ec=Object.prototype.propertyIsEnumerable,Ed=(e,t,r)=>t in e?En(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Eu=(e,t)=>{for(var r in t||(t={}))El.call(t,r)&&Ed(e,r,t[r]);if(Eo)for(var r of Eo(t))Ec.call(t,r)&&Ed(e,r,t[r]);return e},Eh=(e,t,r)=>Ed(e,"symbol"!=typeof t?t+"":t,r);function Ep(e){return Number(e[0].split(":")[1])}function Ef(e){return`0x${e.toString(16)}`}class Ey{constructor(){Eh(this,"events",new oH.EventEmitter),Eh(this,"namespace","eip155"),Eh(this,"accounts",[]),Eh(this,"signer"),Eh(this,"chainId",1),Eh(this,"modal"),Eh(this,"rpc"),Eh(this,"STORAGE_KEY","wc@2:ethereum_provider:"),Eh(this,"on",(e,t)=>(this.events.on(e,t),this)),Eh(this,"once",(e,t)=>(this.events.once(e,t),this)),Eh(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),Eh(this,"off",(e,t)=>(this.events.off(e,t),this)),Eh(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){let t=new Ey;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,r){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),r)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);let{required:r,optional:i}=function(e){let{chains:t,optionalChains:r,methods:i,optionalMethods:n,events:s,optionalEvents:a,rpcMap:o}=e;if(!yK(t))throw Error("Invalid chains");let l={chains:t,methods:i||v9,events:s||Et,rpcMap:Eu({},t.length?{[Ep(t)]:o[Ep(t)]}:{})},c=s?.filter(e=>!Et.includes(e)),d=i?.filter(e=>!v9.includes(e));if(!r&&!a&&!n&&!(null!=c&&c.length)&&!(null!=d&&d.length))return{required:t.length?l:void 0};let u={chains:[...new Set(c?.length&&d?.length||!r?l.chains.concat(r||[]):r)],methods:[...new Set(l.methods.concat(null!=n&&n.length?n:Ee))],events:[...new Set(l.events.concat(null!=a&&a.length?a:Er))],rpcMap:o};return{required:t.length?l:void 0,optional:r.length?u:void 0}}(this.rpc);try{let t=await new Promise(async(t,n)=>{var s,a;let o,l;this.rpc.showQrModal&&(null==(s=this.modal)||s.open(),null==(a=this.modal)||a.subscribeState(e=>{e.open||this.signer.session||(this.signer.abortPairingAttempt(),n(Error("Connection request reset. Please try again.")))}));let c=null!=e&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect((o=Eu({namespaces:Eu({},r&&{[this.namespace]:r})},i&&{optionalNamespaces:{[this.namespace]:i}}),l={pairingTopic:e?.pairingTopic,scopedProperties:c},Es(o,Ea(l)))).then(e=>{t(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),n(Error(e.message))})});if(!t)return;let n=dG(t.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:n),this.setAccounts(n),this.events.emit("connect",{chainId:Ef(this.chainId)})}catch(e){throw this.signer.logger.error(e),e}finally{null==(t=this.modal)||t.close()}}async authenticate(e,t){var r;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e?.chains});try{let r=await new Promise(async(r,i)=>{var n,s;let a,o;this.rpc.showQrModal&&(null==(n=this.modal)||n.open(),null==(s=this.modal)||s.subscribeState(e=>{e.open||this.signer.session||(this.signer.abortPairingAttempt(),i(Error("Connection request reset. Please try again.")))})),await this.signer.authenticate((a=Eu({},e),o={chains:this.rpc.chains},Es(a,Ea(o))),t).then(e=>{r(e)}).catch(e=>{var t;null==(t=this.modal)||t.showErrorMessage("Unable to connect"),i(Error(e.message))})}),i=r.session;if(i){let e=dG(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit("connect",{chainId:Ef(this.chainId)})}return r}catch(e){throw this.signer.logger.error(e),e}finally{null==(r=this.modal)||r.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{let{params:t}=e,{event:r}=t;"accountsChanged"===r.name?(this.accounts=this.parseAccounts(r.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===r.name?this.setChainId(this.formatChainId(r.data)):this.events.emit(r.name,r.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{let t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",Ef(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Es(Eu({},yH("USER_DISCONNECTED")),Ea({data:e.topic,name:"USER_DISCONNECTED"})))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return"string"==typeof e&&e.startsWith(`${this.namespace}:`)}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){let t=e.filter(e=>this.isCompatibleChainId(e)).map(e=>this.parseChainId(e));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",Ef(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){let t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){let[t,r,i]=e.split(":");return{chainId:`${t}:${r}`,address:i}}setAccounts(e){this.accounts=e.filter(e=>this.parseChainId(this.parseAccountId(e).chainId)===this.chainId).map(e=>this.parseAccountId(e).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,r;let i=null!=(t=e?.chains)?t:[],n=null!=(r=e?.optionalChains)?r:[],s=i.concat(n);if(!s.length)throw Error("No chains specified in either `chains` or `optionalChains`");let a=i.length?e?.methods||v9:[],o=i.length?e?.events||Et:[],l=e?.optionalMethods||[],c=e?.optionalEvents||[],d=e?.rpcMap||this.buildRpcMap(s,e.projectId),u=e?.qrModalOptions||void 0;return{chains:i?.map(e=>this.formatChainId(e)),optionalChains:n.map(e=>this.formatChainId(e)),methods:a,events:o,optionalMethods:l,optionalEvents:c,rpcMap:d,showQrModal:!!(null!=e&&e.showQrModal),qrModalOptions:u,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){let r={};return e.forEach(e=>{r[e]=this.getRpcUrl(e,t)}),r}async initialize(e){var t;if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Ep(this.rpc.chains):Ep(this.rpc.optionalChains),this.signer=await v7.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let e;try{let r,i,n,s,a=await Ei(),{convertWCMToAppKitOptions:o}=await Promise.resolve().then(function(){return Ex}),l=o((r=Eu({},this.rpc.qrModalOptions),i={chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId},Es(r,Ea(i))));if(!l.networks.length)throw Error("No networks found for WalletConnect");e=a((n=Eu({},l),s={universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:(null==(t=this.rpc.qrModalOptions)?void 0:t.enableMobileFullScreen)===!0},Es(n,Ea(s))))}catch(e){throw console.warn(e),Error("To use QR modal, please install @reown/appkit package")}if(e)try{this.modal=e}catch(e){throw this.signer.logger.error(e),Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;let{chains:t,optionalChains:r,rpcMap:i}=e;t&&yK(t)&&(this.rpc.chains=t.map(e=>this.formatChainId(e)),t.forEach(e=>{this.rpc.rpcMap[e]=i?.[e]||this.getRpcUrl(e)})),r&&yK(r)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=r?.map(e=>this.formatChainId(e)),r.forEach(e=>{this.rpc.rpcMap[e]=i?.[e]||this.getRpcUrl(e)}))}getRpcUrl(e,t){var r;return(null==(r=this.rpc.rpcMap)?void 0:r[e])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t?.accounts),this.setAccounts(t?.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(e=>this.signer.logger.warn(e))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return"string"==typeof e||e instanceof String?[this.parseAccount(e)]:e.map(e=>this.parseAccount(e))}}var Eg=Object.defineProperty,Em=Object.defineProperties,Ew=Object.getOwnPropertyDescriptors,Eb=Object.getOwnPropertySymbols,Ev=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable,EA=(e,t,r)=>t in e?Eg(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,E_=(e,t)=>{for(var r in t||(t={}))Ev.call(t,r)&&EA(e,r,t[r]);if(Eb)for(var r of Eb(t))EE.call(t,r)&&EA(e,r,t[r]);return e};let ES=e=>{let[t,r]=e.split(":");return EI({id:r,caipNetworkId:e,chainNamespace:t,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function EI(e){return E_({formatters:void 0,fees:void 0,serializers:void 0},e)}var Ex=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function(e){var t,r,i,n,s,a,o;let l=null==(t=e.chains)?void 0:t.map(ES).filter(Boolean);if(0===l.length)throw Error("At least one chain must be specified");let c=l.find(t=>{var r;return t.id===(null==(r=e.defaultChain)?void 0:r.id)}),d={projectId:e.projectId,networks:l,themeMode:e.themeMode,themeVariables:function(e){if(e)return{"--w3m-font-family":e["--wcm-font-family"],"--w3m-accent":e["--wcm-accent-color"],"--w3m-color-mix":e["--wcm-background-color"],"--w3m-z-index":e["--wcm-z-index"]?Number(e["--wcm-z-index"]):void 0,"--w3m-qr-color":e["--wcm-accent-color"],"--w3m-font-size-master":e["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":e["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}(e.themeVariables),chainImages:e.chainImages,connectorImages:e.walletImages,defaultNetwork:c,metadata:Em(E_({},e.metadata),Ew({name:(null==(r=e.metadata)?void 0:r.name)||"WalletConnect",description:(null==(i=e.metadata)?void 0:i.description)||"Connect to WalletConnect-compatible wallets",url:(null==(n=e.metadata)?void 0:n.url)||"https://walletconnect.org",icons:(null==(s=e.metadata)?void 0:s.icons)||["https://walletconnect.org/walletconnect-logo.png"]})),showWallets:!0,featuredWalletIds:"NONE"===e.explorerRecommendedWalletIds?[]:Array.isArray(e.explorerRecommendedWalletIds)?e.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===e.explorerExcludedWalletIds?[]:Array.isArray(e.explorerExcludedWalletIds)?e.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(a=e.mobileWallets)&&a.length||null!=(o=e.desktopWallets)&&o.length){let t=[...(e.mobileWallets||[]).map(e=>({id:e.id,name:e.name,links:e.links})),...(e.desktopWallets||[]).map(e=>({id:e.id,name:e.name,links:{native:e.links.native,universal:e.links.universal}}))],r=[...d.featuredWalletIds||[],...d.excludeWalletIds||[]],i=t.filter(e=>!r.includes(e.id));i.length&&(d.customWallets=i)}return d},defineChain:EI}),ET=e.i(954575);e.i(11834);var Ek=e.i(115093),EC=e.i(624239);e.i(852759);var EP=e.i(884608),EO=e.i(590425),ER=e.i(721018),EN=Object.defineProperty,EM=(e,t)=>{for(var r in t)EN(e,r,{get:t[r],enumerable:!0})},EU={84532:{usdcAddress:"0x036CbD53842c5426634e7929541eC2318f3dCF7e",usdcName:"USDC"},8453:{usdcAddress:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",usdcName:"USD Coin"},43113:{usdcAddress:"0x5425890298aed601595a70AB815c96711a31Bc65",usdcName:"USD Coin"},43114:{usdcAddress:"0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",usdcName:"USD Coin"},4689:{usdcAddress:"0xcdf79194c6c285077a58da47641d4dbe51f63542",usdcName:"Bridged USDC"},103:{usdcAddress:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",usdcName:"USDC"},101:{usdcAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",usdcName:"USDC"},1328:{usdcAddress:"0x4fcf1784b31630811181f670aea7a7bef803eaed",usdcName:"USDC"},1329:{usdcAddress:"0xe15fc38f6d8c56af07bbcbe3baf5708a2bf42392",usdcName:"USDC"},137:{usdcAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",usdcName:"USD Coin"},80002:{usdcAddress:"0x41E94Eb019C0762f9Bfcf9Fb1E58725BfB0e7582",usdcName:"USDC"},3338:{usdcAddress:"0xbbA60da06c2c5424f03f7434542280FCAd453d10",usdcName:"USDC"},2741:{usdcAddress:"0x84a71ccd554cc1b02749b35d22f684cc8ec987e1",usdcName:"Bridged USDC"},11124:{usdcAddress:"0xe4C7fBB0a626ed208021ccabA6Be1566905E2dFc",usdcName:"Bridged USDC"},1514:{usdcAddress:"0xF1815bd50389c46847f0Bda824eC8da914045D14",usdcName:"Bridged USDC"},41923:{usdcAddress:"0x12a272A581feE5577A5dFa371afEB4b2F3a8C2F8",usdcName:"Bridged USDC (Stargate)"},0x135a9d92:{usdcAddress:"0x2e08028E3C4c2356572E096d8EF835cD5C6030bD",usdcName:"Bridged USDC (SKALE Bridge)"}},ED=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationUsed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"Blacklisted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newBlacklister",type:"address"}],name:"BlacklisterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"burner",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newMasterMinter",type:"address"}],name:"MasterMinterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!1,internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"MinterConfigured",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"oldMinter",type:"address"}],name:"MinterRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"previousOwner",type:"address"},{indexed:!1,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[],name:"Pause",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newAddress",type:"address"}],name:"PauserChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newRescuer",type:"address"}],name:"RescuerChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"UnBlacklisted",type:"event"},{anonymous:!1,inputs:[],name:"Unpause",type:"event"},{inputs:[],name:"CANCEL_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"RECEIVE_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"TRANSFER_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"authorizationState",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"blacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"blacklister",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_amount",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"},{internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"configureMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"currency",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"decrement",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"increment",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"tokenName",type:"string"},{internalType:"string",name:"tokenSymbol",type:"string"},{internalType:"string",name:"tokenCurrency",type:"string"},{internalType:"uint8",name:"tokenDecimals",type:"uint8"},{internalType:"address",name:"newMasterMinter",type:"address"},{internalType:"address",name:"newPauser",type:"address"},{internalType:"address",name:"newBlacklister",type:"address"},{internalType:"address",name:"newOwner",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"newName",type:"string"}],name:"initializeV2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"lostAndFound",type:"address"}],name:"initializeV2_1",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"accountsToBlacklist",type:"address[]"},{internalType:"string",name:"newSymbol",type:"string"}],name:"initializeV2_2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"isBlacklisted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"isMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"masterMinter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_amount",type:"uint256"}],name:"mint",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"minterAllowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"pauser",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"removeMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IERC20",name:"tokenContract",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"rescueERC20",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"rescuer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"unBlacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newBlacklister",type:"address"}],name:"updateBlacklister",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newMasterMinter",type:"address"}],name:"updateMasterMinter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newPauser",type:"address"}],name:"updatePauser",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newRescuer",type:"address"}],name:"updateRescuer",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"pure",type:"function"}];e.s([],880583),e.i(880583),(Cx=CY||(CY={})).assertEqual=e=>{},Cx.assertIs=function(e){},Cx.assertNever=function(e){throw Error()},Cx.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},Cx.getValidEnumValues=e=>{let t=Cx.objectKeys(e).filter(t=>"number"!=typeof e[e[t]]),r={};for(let i of t)r[i]=e[i];return Cx.objectValues(r)},Cx.objectValues=e=>Cx.objectKeys(e).map(function(t){return e[t]}),Cx.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},Cx.find=(e,t)=>{for(let r of e)if(t(r))return r},Cx.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,Cx.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},Cx.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t,(CQ||(CQ={})).mergeShapes=(e,t)=>({...e,...t});let Ej=CY.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),EL=e=>{switch(typeof e){case"undefined":return Ej.undefined;case"string":return Ej.string;case"number":return Number.isNaN(e)?Ej.nan:Ej.number;case"boolean":return Ej.boolean;case"function":return Ej.function;case"bigint":return Ej.bigint;case"symbol":return Ej.symbol;case"object":if(Array.isArray(e))return Ej.array;if(null===e)return Ej.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return Ej.promise;if("undefined"!=typeof Map&&e instanceof Map)return Ej.map;if("undefined"!=typeof Set&&e instanceof Set)return Ej.set;if("undefined"!=typeof Date&&e instanceof Date)return Ej.date;return Ej.object;default:return Ej.unknown}};e.s(["ZodParsedType",0,Ej,"getParsedType",0,EL,"objectUtil",()=>CQ,"util",()=>CY],472361);let EB=CY.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),EW=e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:");class EF extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},i=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(i);else if("invalid_return_type"===n.code)i(n.returnTypeError);else if("invalid_arguments"===n.code)i(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,i=0;for(;i<n.path.length;){let r=n.path[i];i===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],i++}}};return i(this),r}static assert(e){if(!(e instanceof EF))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,CY.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let i of this.issues)if(i.path.length>0){let r=i.path[0];t[r]=t[r]||[],t[r].push(e(i))}else r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}EF.create=e=>new EF(e),e.s(["ZodError",()=>EF,"ZodIssueCode",0,EB,"quotelessJson",0,EW],600363);let Ez=(e,t)=>{let r;switch(e.code){case EB.invalid_type:r=e.received===Ej.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case EB.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,CY.jsonStringifyReplacer)}`;break;case EB.unrecognized_keys:r=`Unrecognized key(s) in object: ${CY.joinValues(e.keys,", ")}`;break;case EB.invalid_union:r="Invalid input";break;case EB.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${CY.joinValues(e.options)}`;break;case EB.invalid_enum_value:r=`Invalid enum value. Expected ${CY.joinValues(e.options)}, received '${e.received}'`;break;case EB.invalid_arguments:r="Invalid function arguments";break;case EB.invalid_return_type:r="Invalid function return type";break;case EB.invalid_date:r="Invalid date";break;case EB.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:CY.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case EB.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type||"bigint"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case EB.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case EB.custom:r="Invalid input";break;case EB.invalid_intersection_types:r="Intersection results could not be merged";break;case EB.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case EB.not_finite:r="Number must be finite";break;default:r=t.defaultError,CY.assertNever(e)}return{message:r}},Eq=Ez;function EH(e){Eq=e}function EK(){return Eq}e.s(["getErrorMap",()=>EK,"setErrorMap",()=>EH],235309),e.i(235309),e.s(["defaultErrorMap",0,Ez,"getErrorMap",()=>EK,"setErrorMap",()=>EH],348473),e.i(348473);let E$=e=>{let{data:t,path:r,errorMaps:i,issueData:n}=e,s=[...r,...n.path||[]],a={...n,path:s};if(void 0!==n.message)return{...n,path:s,message:n.message};let o="";for(let e of i.filter(e=>!!e).slice().reverse())o=e(a,{data:t,defaultError:o}).message;return{...n,path:s,message:o}},EV=[];function EJ(e,t){let r=Eq,i=E$({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===Ez?void 0:Ez].filter(e=>!!e)});e.common.issues.push(i)}class EZ{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let i of t){if("aborted"===i.status)return EG;"dirty"===i.status&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,i=await e.value;r.push({key:t,value:i})}return EZ.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let i of t){let{key:t,value:n}=i;if("aborted"===t.status||"aborted"===n.status)return EG;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||i.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let EG=Object.freeze({status:"aborted"}),EY=e=>({status:"dirty",value:e}),EQ=e=>({status:"valid",value:e}),EX=e=>"aborted"===e.status,E0=e=>"dirty"===e.status,E1=e=>"valid"===e.status,E2=e=>"undefined"!=typeof Promise&&e instanceof Promise;e.s(["DIRTY",0,EY,"EMPTY_PATH",0,EV,"INVALID",0,EG,"OK",0,EQ,"ParseStatus",()=>EZ,"addIssueToContext",()=>EJ,"isAborted",0,EX,"isAsync",0,E2,"isDirty",0,E0,"isValid",0,E1,"makeIssue",0,E$],752754),e.i(752754),e.s([],85562),e.i(85562),e.i(472361),(CT=CX||(CX={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},CT.toString=e=>"string"==typeof e?e:e?.message;class E3{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let E5=(e,t)=>{if(E1(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new EF(e.common.issues);return this._error=t,this._error}}};function E8(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:i,description:n}=e;if(t&&(r||i))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{let{message:s}=e;return"invalid_enum_value"===t.code?{message:s??n.defaultError}:void 0===n.data?{message:s??i??n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:s??r??n.defaultError}},description:n}}class E6{get description(){return this._def.description}_getType(e){return EL(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:EL(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new EZ,ctx:{common:e.parent.common,data:e.data,parsedType:EL(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(E2(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:EL(e)},i=this._parseSync({data:e,path:r.path,parent:r});return E5(r,i)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:EL(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return E1(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>E1(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:EL(e)},i=this._parse({data:e,path:r.path,parent:r});return E5(r,await (E2(i)?i:Promise.resolve(i)))}refine(e,t){return this._refinement((r,i)=>{let n=e(r),s=()=>i.addIssue({code:EB.custom,..."string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(r):t});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(s(),!1)):!!n||(s(),!1)})}refinement(e,t){return this._refinement((r,i)=>!!e(r)||(i.addIssue("function"==typeof t?t(r,i):t),!1))}_refinement(e){return new AH({schema:this,typeName:C0.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return AK.create(this,this._def)}nullable(){return A$.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return AT.create(this)}promise(){return Aq.create(this,this._def)}or(e){return AC.create([this,e],this._def)}and(e){return AR.create(this,e,this._def)}transform(e){return new AH({...E8(this._def),schema:this,typeName:C0.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new AV({...E8(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:C0.ZodDefault})}brand(){return new AY({typeName:C0.ZodBranded,type:this,...E8(this._def)})}catch(e){return new AJ({...E8(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:C0.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return AQ.create(this,e)}readonly(){return AX.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let E4=/^c[^\s-]{8,}$/i,E7=/^[0-9a-z]+$/,E9=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ae=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,At=/^[a-z0-9_-]{21}$/i,Ar=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Ai=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,An=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,As=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Aa=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ao=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Al=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ac=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ad=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Au="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ah=RegExp(`^${Au}$`);function Ap(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function Af(e){let t=`${Au}T${Ap(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class Ay extends E6{_parse(e){var t,i,n,s;let a;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Ej.string){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.string,received:t.parsedType}),EG}let o=new EZ;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(EJ(a=this._getOrReturnCtx(e,a),{code:EB.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(EJ(a=this._getOrReturnCtx(e,a),{code:EB.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(a=this._getOrReturnCtx(e,a),t?EJ(a,{code:EB.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&EJ(a,{code:EB.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)An.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"email",code:EB.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)r||(r=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),r.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"emoji",code:EB.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)Ae.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"uuid",code:EB.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)At.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"nanoid",code:EB.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)E4.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"cuid",code:EB.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)E7.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"cuid2",code:EB.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)E9.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"ulid",code:EB.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{EJ(a=this._getOrReturnCtx(e,a),{validation:"url",code:EB.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"regex",code:EB.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(EJ(a=this._getOrReturnCtx(e,a),{code:EB.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(EJ(a=this._getOrReturnCtx(e,a),{code:EB.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(EJ(a=this._getOrReturnCtx(e,a),{code:EB.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?Af(l).test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{code:EB.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?Ah.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{code:EB.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${Ap(l)}$`).test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{code:EB.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?Ai.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"duration",code:EB.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,!(("v4"===(i=l.version)||!i)&&As.test(t)||("v6"===i||!i)&&Ao.test(t))&&1&&(EJ(a=this._getOrReturnCtx(e,a),{validation:"ip",code:EB.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!Ar.test(e))return!1;try{let[r]=e.split(".");if(!r)return!1;let i=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(i));if("object"!=typeof n||null===n||"typ"in n&&n?.typ!=="JWT"||!n.alg||t&&n.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(EJ(a=this._getOrReturnCtx(e,a),{validation:"jwt",code:EB.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(n=e.data,!(("v4"===(s=l.version)||!s)&&Aa.test(n)||("v6"===s||!s)&&Al.test(n))&&1&&(EJ(a=this._getOrReturnCtx(e,a),{validation:"cidr",code:EB.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?Ac.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"base64",code:EB.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?Ad.test(e.data)||(EJ(a=this._getOrReturnCtx(e,a),{validation:"base64url",code:EB.invalid_string,message:l.message}),o.dirty()):CY.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:EB.invalid_string,...CX.errToObj(r)})}_addCheck(e){return new Ay({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...CX.errToObj(e)})}url(e){return this._addCheck({kind:"url",...CX.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...CX.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...CX.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...CX.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...CX.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...CX.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...CX.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...CX.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...CX.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...CX.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...CX.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...CX.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...CX.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...CX.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...CX.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...CX.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...CX.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...CX.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...CX.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...CX.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...CX.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...CX.errToObj(t)})}nonempty(e){return this.min(1,CX.errToObj(e))}trim(){return new Ay({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ay({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ay({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Ay.create=e=>new Ay({checks:[],typeName:C0.ZodString,coerce:e?.coerce??!1,...E8(e)});class Ag extends E6{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Ej.number){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.number,received:t.parsedType}),EG}let r=new EZ;for(let i of this._def.checks)"int"===i.kind?CY.isInteger(e.data)||(EJ(t=this._getOrReturnCtx(e,t),{code:EB.invalid_type,expected:"integer",received:"float",message:i.message}),r.dirty()):"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),r.dirty()):"multipleOf"===i.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,i=(t.toString().split(".")[1]||"").length,n=r>i?r:i;return Number.parseInt(e.toFixed(n).replace(".",""))%Number.parseInt(t.toFixed(n).replace(".",""))/10**n}(e.data,i.value)&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):"finite"===i.kind?Number.isFinite(e.data)||(EJ(t=this._getOrReturnCtx(e,t),{code:EB.not_finite,message:i.message}),r.dirty()):CY.assertNever(i);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,CX.toString(t))}gt(e,t){return this.setLimit("min",e,!1,CX.toString(t))}lte(e,t){return this.setLimit("max",e,!0,CX.toString(t))}lt(e,t){return this.setLimit("max",e,!1,CX.toString(t))}setLimit(e,t,r,i){return new Ag({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:CX.toString(i)}]})}_addCheck(e){return new Ag({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:CX.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:CX.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:CX.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:CX.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:CX.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:CX.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:CX.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:CX.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:CX.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&CY.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks)if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;else"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value);return Number.isFinite(t)&&Number.isFinite(e)}}Ag.create=e=>new Ag({checks:[],typeName:C0.ZodNumber,coerce:e?.coerce||!1,...E8(e)});class Am extends E6{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Ej.bigint)return this._getInvalidInput(e);let r=new EZ;for(let i of this._def.checks)"min"===i.kind?(i.inclusive?e.data<i.value:e.data<=i.value)&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"max"===i.kind?(i.inclusive?e.data>i.value:e.data>=i.value)&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),r.dirty()):"multipleOf"===i.kind?e.data%i.value!==BigInt(0)&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.not_multiple_of,multipleOf:i.value,message:i.message}),r.dirty()):CY.assertNever(i);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.bigint,received:t.parsedType}),EG}gte(e,t){return this.setLimit("min",e,!0,CX.toString(t))}gt(e,t){return this.setLimit("min",e,!1,CX.toString(t))}lte(e,t){return this.setLimit("max",e,!0,CX.toString(t))}lt(e,t){return this.setLimit("max",e,!1,CX.toString(t))}setLimit(e,t,r,i){return new Am({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:CX.toString(i)}]})}_addCheck(e){return new Am({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:CX.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:CX.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:CX.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:CX.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:CX.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}Am.create=e=>new Am({checks:[],typeName:C0.ZodBigInt,coerce:e?.coerce??!1,...E8(e)});class Aw extends E6{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Ej.boolean){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.boolean,received:t.parsedType}),EG}return EQ(e.data)}}Aw.create=e=>new Aw({typeName:C0.ZodBoolean,coerce:e?.coerce||!1,...E8(e)});class Ab extends E6{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Ej.date){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.date,received:t.parsedType}),EG}if(Number.isNaN(e.data.getTime()))return EJ(this._getOrReturnCtx(e),{code:EB.invalid_date}),EG;let r=new EZ;for(let i of this._def.checks)"min"===i.kind?e.data.getTime()<i.value&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):"max"===i.kind?e.data.getTime()>i.value&&(EJ(t=this._getOrReturnCtx(e,t),{code:EB.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):CY.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ab({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:CX.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:CX.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Ab.create=e=>new Ab({checks:[],coerce:e?.coerce||!1,typeName:C0.ZodDate,...E8(e)});class Av extends E6{_parse(e){if(this._getType(e)!==Ej.symbol){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.symbol,received:t.parsedType}),EG}return EQ(e.data)}}Av.create=e=>new Av({typeName:C0.ZodSymbol,...E8(e)});class AE extends E6{_parse(e){if(this._getType(e)!==Ej.undefined){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.undefined,received:t.parsedType}),EG}return EQ(e.data)}}AE.create=e=>new AE({typeName:C0.ZodUndefined,...E8(e)});class AA extends E6{_parse(e){if(this._getType(e)!==Ej.null){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.null,received:t.parsedType}),EG}return EQ(e.data)}}AA.create=e=>new AA({typeName:C0.ZodNull,...E8(e)});class A_ extends E6{constructor(){super(...arguments),this._any=!0}_parse(e){return EQ(e.data)}}A_.create=e=>new A_({typeName:C0.ZodAny,...E8(e)});class AS extends E6{constructor(){super(...arguments),this._unknown=!0}_parse(e){return EQ(e.data)}}AS.create=e=>new AS({typeName:C0.ZodUnknown,...E8(e)});class AI extends E6{_parse(e){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.never,received:t.parsedType}),EG}}AI.create=e=>new AI({typeName:C0.ZodNever,...E8(e)});class Ax extends E6{_parse(e){if(this._getType(e)!==Ej.undefined){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.void,received:t.parsedType}),EG}return EQ(e.data)}}Ax.create=e=>new Ax({typeName:C0.ZodVoid,...E8(e)});class AT extends E6{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==Ej.array)return EJ(t,{code:EB.invalid_type,expected:Ej.array,received:t.parsedType}),EG;if(null!==i.exactLength){let e=t.data.length>i.exactLength.value,n=t.data.length<i.exactLength.value;(e||n)&&(EJ(t,{code:e?EB.too_big:EB.too_small,minimum:n?i.exactLength.value:void 0,maximum:e?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(null!==i.minLength&&t.data.length<i.minLength.value&&(EJ(t,{code:EB.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),null!==i.maxLength&&t.data.length>i.maxLength.value&&(EJ(t,{code:EB.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>i.type._parseAsync(new E3(t,e,t.path,r)))).then(e=>EZ.mergeArray(r,e));let n=[...t.data].map((e,r)=>i.type._parseSync(new E3(t,e,t.path,r)));return EZ.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new AT({...this._def,minLength:{value:e,message:CX.toString(t)}})}max(e,t){return new AT({...this._def,maxLength:{value:e,message:CX.toString(t)}})}length(e,t){return new AT({...this._def,exactLength:{value:e,message:CX.toString(t)}})}nonempty(e){return this.min(1,e)}}AT.create=(e,t)=>new AT({type:e,minLength:null,maxLength:null,exactLength:null,typeName:C0.ZodArray,...E8(t)});class Ak extends E6{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=CY.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Ej.object){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.object,received:t.parsedType}),EG}let{status:t,ctx:r}=this._processInputParams(e),{shape:i,keys:n}=this._getCached(),s=[];if(!(this._def.catchall instanceof AI&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||s.push(e);let a=[];for(let e of n){let t=i[e],n=r.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new E3(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof AI){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of s)a.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)s.length>0&&(EJ(r,{code:EB.unrecognized_keys,keys:s}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of s){let i=r.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new E3(r,i,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of a){let r=await t.key,i=await t.value;e.push({key:r,value:i,alwaysSet:t.alwaysSet})}return e}).then(e=>EZ.mergeObjectSync(t,e)):EZ.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return CX.errToObj,new Ak({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let i=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:CX.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Ak({...this._def,unknownKeys:"strip"})}passthrough(){return new Ak({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ak({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ak({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:C0.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ak({...this._def,catchall:e})}pick(e){let t={};for(let r of CY.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new Ak({...this._def,shape:()=>t})}omit(e){let t={};for(let r of CY.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new Ak({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof Ak){let r={};for(let i in t.shape){let n=t.shape[i];r[i]=AK.create(e(n))}return new Ak({...t._def,shape:()=>r})}if(t instanceof AT)return new AT({...t._def,type:e(t.element)});if(t instanceof AK)return AK.create(e(t.unwrap()));if(t instanceof A$)return A$.create(e(t.unwrap()));if(t instanceof AN)return AN.create(t.items.map(t=>e(t)));else return t}(this)}partial(e){let t={};for(let r of CY.objectKeys(this.shape)){let i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new Ak({...this._def,shape:()=>t})}required(e){let t={};for(let r of CY.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof AK;)e=e._def.innerType;t[r]=e}return new Ak({...this._def,shape:()=>t})}keyof(){return AW(CY.objectKeys(this.shape))}}Ak.create=(e,t)=>new Ak({shape:()=>e,unknownKeys:"strip",catchall:AI.create(),typeName:C0.ZodObject,...E8(t)}),Ak.strictCreate=(e,t)=>new Ak({shape:()=>e,unknownKeys:"strict",catchall:AI.create(),typeName:C0.ZodObject,...E8(t)}),Ak.lazycreate=(e,t)=>new Ak({shape:e,unknownKeys:"strip",catchall:AI.create(),typeName:C0.ZodObject,...E8(t)});class AC extends E6{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new EF(e.ctx.common.issues));return EJ(t,{code:EB.invalid_union,unionErrors:r}),EG});{let e,i=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},s=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:r}),r.common.issues.length&&i.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=i.map(e=>new EF(e));return EJ(t,{code:EB.invalid_union,unionErrors:n}),EG}}get options(){return this._def.options}}AC.create=(e,t)=>new AC({options:e,typeName:C0.ZodUnion,...E8(t)});let AP=e=>{if(e instanceof AL)return AP(e.schema);if(e instanceof AH)return AP(e.innerType());if(e instanceof AB)return[e.value];if(e instanceof AF)return e.options;if(e instanceof Az)return CY.objectValues(e.enum);else if(e instanceof AV)return AP(e._def.innerType);else if(e instanceof AE)return[void 0];else if(e instanceof AA)return[null];else if(e instanceof AK)return[void 0,...AP(e.unwrap())];else if(e instanceof A$)return[null,...AP(e.unwrap())];else if(e instanceof AY)return AP(e.unwrap());else if(e instanceof AX)return AP(e.unwrap());else if(e instanceof AJ)return AP(e._def.innerType);else return[]};class AO extends E6{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ej.object)return EJ(t,{code:EB.invalid_type,expected:Ej.object,received:t.parsedType}),EG;let r=this.discriminator,i=t.data[r],n=this.optionsMap.get(i);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(EJ(t,{code:EB.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),EG)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let i=new Map;for(let r of t){let t=AP(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(i.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);i.set(n,r)}}return new AO({typeName:C0.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...E8(r)})}}class AR extends E6{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=(e,i)=>{if(EX(e)||EX(i))return EG;let n=function e(t,r){let i=EL(t),n=EL(r);if(t===r)return{valid:!0,data:t};if(i===Ej.object&&n===Ej.object){let i=CY.objectKeys(r),n=CY.objectKeys(t).filter(e=>-1!==i.indexOf(e)),s={...t,...r};for(let i of n){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};s[i]=n.data}return{valid:!0,data:s}}if(i===Ej.array&&n===Ej.array){if(t.length!==r.length)return{valid:!1};let i=[];for(let n=0;n<t.length;n++){let s=e(t[n],r[n]);if(!s.valid)return{valid:!1};i.push(s.data)}return{valid:!0,data:i}}if(i===Ej.date&&n===Ej.date&&+t==+r)return{valid:!0,data:t};return{valid:!1}}(e.value,i.value);return n.valid?((E0(e)||E0(i))&&t.dirty(),{status:t.value,value:n.data}):(EJ(r,{code:EB.invalid_intersection_types}),EG)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>i(e,t)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}AR.create=(e,t,r)=>new AR({left:e,right:t,typeName:C0.ZodIntersection,...E8(r)});class AN extends E6{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ej.array)return EJ(r,{code:EB.invalid_type,expected:Ej.array,received:r.parsedType}),EG;if(r.data.length<this._def.items.length)return EJ(r,{code:EB.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),EG;!this._def.rest&&r.data.length>this._def.items.length&&(EJ(r,{code:EB.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...r.data].map((e,t)=>{let i=this._def.items[t]||this._def.rest;return i?i._parse(new E3(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(i).then(e=>EZ.mergeArray(t,e)):EZ.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new AN({...this._def,rest:e})}}AN.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new AN({items:e,typeName:C0.ZodTuple,rest:null,...E8(t)})};class AM extends E6{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ej.object)return EJ(r,{code:EB.invalid_type,expected:Ej.object,received:r.parsedType}),EG;let i=[],n=this._def.keyType,s=this._def.valueType;for(let e in r.data)i.push({key:n._parse(new E3(r,e,r.path,e)),value:s._parse(new E3(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?EZ.mergeObjectAsync(t,i):EZ.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return new AM(t instanceof E6?{keyType:e,valueType:t,typeName:C0.ZodRecord,...E8(r)}:{keyType:Ay.create(),valueType:e,typeName:C0.ZodRecord,...E8(t)})}}class AU extends E6{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ej.map)return EJ(r,{code:EB.invalid_type,expected:Ej.map,received:r.parsedType}),EG;let i=this._def.keyType,n=this._def.valueType,s=[...r.data.entries()].map(([e,t],s)=>({key:i._parse(new E3(r,e,r.path,[s,"key"])),value:n._parse(new E3(r,t,r.path,[s,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of s){let i=await r.key,n=await r.value;if("aborted"===i.status||"aborted"===n.status)return EG;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of s){let i=r.key,n=r.value;if("aborted"===i.status||"aborted"===n.status)return EG;("dirty"===i.status||"dirty"===n.status)&&t.dirty(),e.set(i.value,n.value)}return{status:t.value,value:e}}}}AU.create=(e,t,r)=>new AU({valueType:t,keyType:e,typeName:C0.ZodMap,...E8(r)});class AD extends E6{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==Ej.set)return EJ(r,{code:EB.invalid_type,expected:Ej.set,received:r.parsedType}),EG;let i=this._def;null!==i.minSize&&r.data.size<i.minSize.value&&(EJ(r,{code:EB.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),null!==i.maxSize&&r.data.size>i.maxSize.value&&(EJ(r,{code:EB.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());let n=this._def.valueType;function s(e){let r=new Set;for(let i of e){if("aborted"===i.status)return EG;"dirty"===i.status&&t.dirty(),r.add(i.value)}return{status:t.value,value:r}}let a=[...r.data.values()].map((e,t)=>n._parse(new E3(r,e,r.path,t)));return r.common.async?Promise.all(a).then(e=>s(e)):s(a)}min(e,t){return new AD({...this._def,minSize:{value:e,message:CX.toString(t)}})}max(e,t){return new AD({...this._def,maxSize:{value:e,message:CX.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}AD.create=(e,t)=>new AD({valueType:e,minSize:null,maxSize:null,typeName:C0.ZodSet,...E8(t)});class Aj extends E6{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==Ej.function)return EJ(t,{code:EB.invalid_type,expected:Ej.function,received:t.parsedType}),EG;function r(e,r){return E$({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Eq,Ez].filter(e=>!!e),issueData:{code:EB.invalid_arguments,argumentsError:r}})}function i(e,r){return E$({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Eq,Ez].filter(e=>!!e),issueData:{code:EB.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Aq){let e=this;return EQ(async function(...t){let a=new EF([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw a.addIssue(r(t,e)),a}),l=await Reflect.apply(s,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw a.addIssue(i(l,e)),a})})}{let e=this;return EQ(function(...t){let a=e._def.args.safeParse(t,n);if(!a.success)throw new EF([r(t,a.error)]);let o=Reflect.apply(s,this,a.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new EF([i(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Aj({...this._def,args:AN.create(e).rest(AS.create())})}returns(e){return new Aj({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new Aj({args:e||AN.create([]).rest(AS.create()),returns:t||AS.create(),typeName:C0.ZodFunction,...E8(r)})}}class AL extends E6{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}AL.create=(e,t)=>new AL({getter:e,typeName:C0.ZodLazy,...E8(t)});class AB extends E6{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return EJ(t,{received:t.data,code:EB.invalid_literal,expected:this._def.value}),EG}return{status:"valid",value:e.data}}get value(){return this._def.value}}function AW(e,t){return new AF({values:e,typeName:C0.ZodEnum,...E8(t)})}AB.create=(e,t)=>new AB({value:e,typeName:C0.ZodLiteral,...E8(t)});class AF extends E6{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return EJ(t,{expected:CY.joinValues(r),received:t.parsedType,code:EB.invalid_type}),EG}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return EJ(t,{received:t.data,code:EB.invalid_enum_value,options:r}),EG}return EQ(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return AF.create(e,{...this._def,...t})}exclude(e,t=this._def){return AF.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}AF.create=AW;class Az extends E6{_parse(e){let t=CY.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==Ej.string&&r.parsedType!==Ej.number){let e=CY.objectValues(t);return EJ(r,{expected:CY.joinValues(e),received:r.parsedType,code:EB.invalid_type}),EG}if(this._cache||(this._cache=new Set(CY.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=CY.objectValues(t);return EJ(r,{received:r.data,code:EB.invalid_enum_value,options:e}),EG}return EQ(e.data)}get enum(){return this._def.values}}Az.create=(e,t)=>new Az({values:e,typeName:C0.ZodNativeEnum,...E8(t)});class Aq extends E6{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==Ej.promise&&!1===t.common.async?(EJ(t,{code:EB.invalid_type,expected:Ej.promise,received:t.parsedType}),EG):EQ((t.parsedType===Ej.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Aq.create=(e,t)=>new Aq({type:e,typeName:C0.ZodPromise,...E8(t)});class AH extends E6{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===C0.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,n={addIssue:e=>{EJ(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===i.type){let e=i.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return EG;let i=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===i.status?EG:"dirty"===i.status||"dirty"===t.value?EY(i.value):i});{if("aborted"===t.value)return EG;let i=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===i.status?EG:"dirty"===i.status||"dirty"===t.value?EY(i.value):i}}if("refinement"===i.type){let e=e=>{let t=i.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?EG:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===i.status?EG:("dirty"===i.status&&t.dirty(),e(i.value),{status:t.value,value:i.value})}}if("transform"===i.type)if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>E1(e)?Promise.resolve(i.transform(e.value,n)).then(e=>({status:t.value,value:e})):EG);else{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!E1(e))return EG;let s=i.transform(e.value,n);if(s instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}CY.assertNever(i)}}AH.create=(e,t,r)=>new AH({schema:e,typeName:C0.ZodEffects,effect:t,...E8(r)}),AH.createWithPreprocess=(e,t,r)=>new AH({schema:t,effect:{type:"preprocess",transform:e},typeName:C0.ZodEffects,...E8(r)});class AK extends E6{_parse(e){return this._getType(e)===Ej.undefined?EQ(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}AK.create=(e,t)=>new AK({innerType:e,typeName:C0.ZodOptional,...E8(t)});class A$ extends E6{_parse(e){return this._getType(e)===Ej.null?EQ(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}A$.create=(e,t)=>new A$({innerType:e,typeName:C0.ZodNullable,...E8(t)});class AV extends E6{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===Ej.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}AV.create=(e,t)=>new AV({innerType:e,typeName:C0.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...E8(t)});class AJ extends E6{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return E2(i)?i.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new EF(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===i.status?i.value:this._def.catchValue({get error(){return new EF(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}AJ.create=(e,t)=>new AJ({innerType:e,typeName:C0.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...E8(t)});class AZ extends E6{_parse(e){if(this._getType(e)!==Ej.nan){let t=this._getOrReturnCtx(e);return EJ(t,{code:EB.invalid_type,expected:Ej.nan,received:t.parsedType}),EG}return{status:"valid",value:e.data}}}AZ.create=e=>new AZ({typeName:C0.ZodNaN,...E8(e)});let AG=Symbol("zod_brand");class AY extends E6{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class AQ extends E6{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?EG:"dirty"===e.status?(t.dirty(),EY(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?EG:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new AQ({in:e,out:t,typeName:C0.ZodPipeline})}}class AX extends E6{_parse(e){let t=this._def.innerType._parse(e),r=e=>(E1(e)&&(e.value=Object.freeze(e.value)),e);return E2(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function A0(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function A1(e,t={},r){return e?A_.create().superRefine((i,n)=>{let s=e(i);if(s instanceof Promise)return s.then(e=>{if(!e){let e=A0(t,i),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}});if(!s){let e=A0(t,i),s=e.fatal??r??!0;n.addIssue({code:"custom",...e,fatal:s})}}):A_.create()}AX.create=(e,t)=>new AX({innerType:e,typeName:C0.ZodReadonly,...E8(t)});let A2={object:Ak.lazycreate};(Ck=C0||(C0={})).ZodString="ZodString",Ck.ZodNumber="ZodNumber",Ck.ZodNaN="ZodNaN",Ck.ZodBigInt="ZodBigInt",Ck.ZodBoolean="ZodBoolean",Ck.ZodDate="ZodDate",Ck.ZodSymbol="ZodSymbol",Ck.ZodUndefined="ZodUndefined",Ck.ZodNull="ZodNull",Ck.ZodAny="ZodAny",Ck.ZodUnknown="ZodUnknown",Ck.ZodNever="ZodNever",Ck.ZodVoid="ZodVoid",Ck.ZodArray="ZodArray",Ck.ZodObject="ZodObject",Ck.ZodUnion="ZodUnion",Ck.ZodDiscriminatedUnion="ZodDiscriminatedUnion",Ck.ZodIntersection="ZodIntersection",Ck.ZodTuple="ZodTuple",Ck.ZodRecord="ZodRecord",Ck.ZodMap="ZodMap",Ck.ZodSet="ZodSet",Ck.ZodFunction="ZodFunction",Ck.ZodLazy="ZodLazy",Ck.ZodLiteral="ZodLiteral",Ck.ZodEnum="ZodEnum",Ck.ZodEffects="ZodEffects",Ck.ZodNativeEnum="ZodNativeEnum",Ck.ZodOptional="ZodOptional",Ck.ZodNullable="ZodNullable",Ck.ZodDefault="ZodDefault",Ck.ZodCatch="ZodCatch",Ck.ZodPromise="ZodPromise",Ck.ZodBranded="ZodBranded",Ck.ZodPipeline="ZodPipeline",Ck.ZodReadonly="ZodReadonly";let A3=(e,t={message:`Input not instance of ${e.name}`})=>A1(t=>t instanceof e,t),A5=Ay.create,A8=Ag.create,A6=AZ.create,A4=Am.create,A7=Aw.create,A9=Ab.create,_e=Av.create,_t=AE.create,_r=AA.create,_i=A_.create,_n=AS.create,_s=AI.create,_a=Ax.create,_o=AT.create,_l=Ak.create,_c=Ak.strictCreate,_d=AC.create,_u=AO.create,_h=AR.create,_p=AN.create,_f=AM.create,_y=AU.create,_g=AD.create,_m=Aj.create,_w=AL.create,_b=AB.create,_v=AF.create,_E=Az.create,_A=Aq.create,__=AH.create,_S=AK.create,_I=A$.create,_x=AH.createWithPreprocess,_T=AQ.create,_k=()=>A5().optional(),_C=()=>A8().optional(),_P=()=>A7().optional(),_O={string:e=>Ay.create({...e,coerce:!0}),number:e=>Ag.create({...e,coerce:!0}),boolean:e=>Aw.create({...e,coerce:!0}),bigint:e=>Am.create({...e,coerce:!0}),date:e=>Ab.create({...e,coerce:!0})};e.s(["BRAND",0,AG,"NEVER",0,EG,"Schema",()=>E6,"ZodAny",()=>A_,"ZodArray",()=>AT,"ZodBigInt",()=>Am,"ZodBoolean",()=>Aw,"ZodBranded",()=>AY,"ZodCatch",()=>AJ,"ZodDate",()=>Ab,"ZodDefault",()=>AV,"ZodDiscriminatedUnion",()=>AO,"ZodEffects",()=>AH,"ZodEnum",()=>AF,"ZodFirstPartyTypeKind",()=>C0,"ZodFunction",()=>Aj,"ZodIntersection",()=>AR,"ZodLazy",()=>AL,"ZodLiteral",()=>AB,"ZodMap",()=>AU,"ZodNaN",()=>AZ,"ZodNativeEnum",()=>Az,"ZodNever",()=>AI,"ZodNull",()=>AA,"ZodNullable",()=>A$,"ZodNumber",()=>Ag,"ZodObject",()=>Ak,"ZodOptional",()=>AK,"ZodPipeline",()=>AQ,"ZodPromise",()=>Aq,"ZodReadonly",()=>AX,"ZodRecord",()=>AM,"ZodSchema",()=>E6,"ZodSet",()=>AD,"ZodString",()=>Ay,"ZodSymbol",()=>Av,"ZodTransformer",()=>AH,"ZodTuple",()=>AN,"ZodType",()=>E6,"ZodUndefined",()=>AE,"ZodUnion",()=>AC,"ZodUnknown",()=>AS,"ZodVoid",()=>Ax,"any",()=>_i,"array",()=>_o,"bigint",()=>A4,"boolean",()=>A7,"coerce",0,_O,"custom",()=>A1,"date",()=>A9,"datetimeRegex",()=>Af,"discriminatedUnion",()=>_u,"effect",()=>__,"enum",()=>_v,"function",()=>_m,"instanceof",()=>A3,"intersection",()=>_h,"late",0,A2,"lazy",()=>_w,"literal",()=>_b,"map",()=>_y,"nan",()=>A6,"nativeEnum",()=>_E,"never",()=>_s,"null",()=>_r,"nullable",()=>_I,"number",()=>A8,"object",()=>_l,"oboolean",()=>_P,"onumber",()=>_C,"optional",()=>_S,"ostring",()=>_k,"pipeline",()=>_T,"preprocess",()=>_x,"promise",()=>_A,"record",()=>_f,"set",()=>_g,"strictObject",()=>_c,"string",()=>A5,"symbol",()=>_e,"transformer",()=>__,"tuple",()=>_p,"undefined",()=>_t,"union",()=>_d,"unknown",()=>_n,"void",()=>_a],683206),e.i(683206),e.i(600363),e.s(["BRAND",0,AG,"DIRTY",0,EY,"EMPTY_PATH",0,EV,"INVALID",0,EG,"NEVER",0,EG,"OK",0,EQ,"ParseStatus",()=>EZ,"Schema",()=>E6,"ZodAny",()=>A_,"ZodArray",()=>AT,"ZodBigInt",()=>Am,"ZodBoolean",()=>Aw,"ZodBranded",()=>AY,"ZodCatch",()=>AJ,"ZodDate",()=>Ab,"ZodDefault",()=>AV,"ZodDiscriminatedUnion",()=>AO,"ZodEffects",()=>AH,"ZodEnum",()=>AF,"ZodError",()=>EF,"ZodFirstPartyTypeKind",()=>C0,"ZodFunction",()=>Aj,"ZodIntersection",()=>AR,"ZodIssueCode",0,EB,"ZodLazy",()=>AL,"ZodLiteral",()=>AB,"ZodMap",()=>AU,"ZodNaN",()=>AZ,"ZodNativeEnum",()=>Az,"ZodNever",()=>AI,"ZodNull",()=>AA,"ZodNullable",()=>A$,"ZodNumber",()=>Ag,"ZodObject",()=>Ak,"ZodOptional",()=>AK,"ZodParsedType",0,Ej,"ZodPipeline",()=>AQ,"ZodPromise",()=>Aq,"ZodReadonly",()=>AX,"ZodRecord",()=>AM,"ZodSchema",()=>E6,"ZodSet",()=>AD,"ZodString",()=>Ay,"ZodSymbol",()=>Av,"ZodTransformer",()=>AH,"ZodTuple",()=>AN,"ZodType",()=>E6,"ZodUndefined",()=>AE,"ZodUnion",()=>AC,"ZodUnknown",()=>AS,"ZodVoid",()=>Ax,"addIssueToContext",()=>EJ,"any",()=>_i,"array",()=>_o,"bigint",()=>A4,"boolean",()=>A7,"coerce",0,_O,"custom",()=>A1,"date",()=>A9,"datetimeRegex",()=>Af,"defaultErrorMap",0,Ez,"discriminatedUnion",()=>_u,"effect",()=>__,"enum",()=>_v,"function",()=>_m,"getErrorMap",()=>EK,"getParsedType",0,EL,"instanceof",()=>A3,"intersection",()=>_h,"isAborted",0,EX,"isAsync",0,E2,"isDirty",0,E0,"isValid",0,E1,"late",0,A2,"lazy",()=>_w,"literal",()=>_b,"makeIssue",0,E$,"map",()=>_y,"nan",()=>A6,"nativeEnum",()=>_E,"never",()=>_s,"null",()=>_r,"nullable",()=>_I,"number",()=>A8,"object",()=>_l,"objectUtil",()=>CQ,"oboolean",()=>_P,"onumber",()=>_C,"optional",()=>_S,"ostring",()=>_k,"pipeline",()=>_T,"preprocess",()=>_x,"promise",()=>_A,"quotelessJson",0,EW,"record",()=>_f,"set",()=>_g,"setErrorMap",()=>EH,"strictObject",()=>_c,"string",()=>A5,"symbol",()=>_e,"transformer",()=>__,"tuple",()=>_p,"undefined",()=>_t,"union",()=>_d,"unknown",()=>_n,"util",()=>CY,"void",()=>_a],834919);var _R=e.i(834919),_R=_R,_N=e.i(918305),_M=e.i(214508),_U=e.i(485112),_D=e.i(865737);let _j=(0,_D.defineChain)({id:43113,name:"Avalanche Fuji",nativeCurrency:{decimals:18,name:"Avalanche Fuji",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax-test.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://testnet.snowtrace.io",apiUrl:"https://api-testnet.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:7096959}},testnet:!0});var _L=e.i(377578);let _B=(0,_D.defineChain)({..._L.chainConfig,id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}},contracts:{..._L.chainConfig.contracts,disputeGameFactory:{1:{address:"0x43edB88C4B80fDD2AdFF2412A7BebF9dF42cB40e"}},l2OutputOracle:{1:{address:"0x56315b90c40730925ec5485cf004d835058518A0"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:5022},portal:{1:{address:"0x49048044D57e1C92A77f79988d21Fa8fAF74E97e",blockCreated:0x10ac19f}},l1StandardBridge:{1:{address:"0x3154Cf16ccdb4C6d922629664174b904d80F2C35",blockCreated:0x10ac19f}}},sourceId:1});({..._B,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://mainnet-preconf.base.org"]}}});let _W=(0,_D.defineChain)({id:1329,name:"Sei Network",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc.sei-apis.com/"],webSocket:["wss://evm-ws.sei-apis.com/"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com",apiUrl:"https://seitrace.com/pacific-1/api"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11"}}}),_F=(0,_D.defineChain)({id:1328,name:"Sei Testnet",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc-testnet.sei-apis.com"],webSocket:["wss://evm-ws-testnet.sei-apis.com"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x5e201b3}},testnet:!0}),_z=(0,_D.defineChain)({id:137,name:"Polygon",blockTime:2e3,nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0x18938b0}}}),_q=(0,_D.defineChain)({id:80002,name:"Polygon Amoy",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://rpc-amoy.polygon.technology"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://amoy.polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3127388}},testnet:!0}),_H=(0,_D.defineChain)({id:3338,name:"Peaq",nativeCurrency:{decimals:18,name:"peaq",symbol:"PEAQ"},rpcUrls:{default:{http:["https://quicknode1.peaq.xyz","https://quicknode2.peaq.xyz","https://quicknode3.peaq.xyz"],webSocket:["wss://quicknode1.peaq.xyz","wss://quicknode2.peaq.xyz","wss://quicknode3.peaq.xyz"]}},blockExplorers:{default:{name:"Subscan",url:"https://peaq.subscan.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3566354}}}),_K=(0,_D.defineChain)({id:43114,name:"Avalanche",blockTime:1700,nativeCurrency:{decimals:18,name:"Avalanche",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://snowtrace.io",apiUrl:"https://api.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0xb5b35e}}}),_$=(0,_D.defineChain)({id:4690,name:"IoTeX Testnet",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.testnet.iotex.io"],webSocket:["wss://babel-api.testnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://testnet.iotexscan.io"}},contracts:{multicall3:{address:"0xb5cecD6894c6f473Ec726A176f1512399A2e355d",blockCreated:0x17383c8}},testnet:!0}),_V=(0,_D.defineChain)({id:4689,name:"IoTeX",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.mainnet.iotex.io"],webSocket:["wss://babel-api.mainnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://iotexscan.io"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x15230d6}}});var _J=e.i(604371),_Z=e.i(619497),_G=e.i(504992),_Y=e.i(110256),_Q=e.i(455289),_X=e.i(123980),_0=e.i(435348);let _1=32n*e.i(891444).maxUint16,_2={block:(0,_G.defineBlock)({format(e){let t=e.transactions?.map(e=>{if("string"==typeof e)return e;let t=_2.transaction?.format(e);return"0x71"===t.typeHex?t.type="eip712":"0xff"===t.typeHex&&(t.type="priority"),t});return{l1BatchNumber:e.l1BatchNumber?(0,_J.hexToBigInt)(e.l1BatchNumber):null,l1BatchTimestamp:e.l1BatchTimestamp?(0,_J.hexToBigInt)(e.l1BatchTimestamp):null,transactions:t}}}),transaction:(0,_Q.defineTransaction)({format(e){let t={};return"0x71"===e.type?t.type="eip712":"0xff"===e.type&&(t.type="priority"),{...t,l1BatchNumber:e.l1BatchNumber?(0,_J.hexToBigInt)(e.l1BatchNumber):null,l1BatchTxIndex:e.l1BatchTxIndex?(0,_J.hexToBigInt)(e.l1BatchTxIndex):null}}}),transactionReceipt:(0,_X.defineTransactionReceipt)({format:e=>({l1BatchNumber:e.l1BatchNumber?(0,_J.hexToBigInt)(e.l1BatchNumber):null,l1BatchTxIndex:e.l1BatchTxIndex?(0,_J.hexToBigInt)(e.l1BatchTxIndex):null,logs:e.logs.map(e=>({...(0,_Y.formatLog)(e),l1BatchNumber:e.l1BatchNumber?(0,_J.hexToBigInt)(e.l1BatchNumber):null,transactionLogIndex:(0,_J.hexToNumber)(e.transactionLogIndex),logType:e.logType})),l2ToL1Logs:e.l2ToL1Logs.map(e=>({blockNumber:(0,_J.hexToBigInt)(e.blockHash),blockHash:e.blockHash,l1BatchNumber:e.l1BatchNumber?(0,_J.hexToBigInt)(e.l1BatchNumber):null,transactionIndex:(0,_J.hexToBigInt)(e.transactionIndex),shardId:(0,_J.hexToBigInt)(e.shardId),isService:e.isService,sender:e.sender,key:e.key,value:e.value,transactionHash:e.transactionHash,logIndex:(0,_J.hexToBigInt)(e.logIndex)}))})}),transactionRequest:(0,_0.defineTransactionRequest)({exclude:["customSignature","factoryDeps","gasPerPubdata","paymaster","paymasterInput"],format:e=>e.gasPerPubdata||e.paymaster&&e.paymasterInput||e.factoryDeps||e.customSignature?{eip712Meta:{...e.gasPerPubdata?{gasPerPubdata:(0,na.toHex)(e.gasPerPubdata)}:{gasPerPubdata:(0,na.toHex)(50000n)},...e.paymaster&&e.paymasterInput?{paymasterParams:{paymaster:e.paymaster,paymasterInput:Array.from((0,_Z.hexToBytes)(e.paymasterInput))}}:{},...e.factoryDeps?{factoryDeps:e.factoryDeps.map(e=>Array.from((0,_Z.hexToBytes)(e)))}:{},...e.customSignature?{customSignature:Array.from((0,_Z.hexToBytes)(e.customSignature))}:{}},type:"0x71"}:{}})};var _3=e.i(964268),_5=e.i(542086),_8=e.i(581),_6=e.i(295518),_4=e.i(391167),_7=e.i(881794),_9=_4;class Se extends _9.BaseError{constructor(){super('Transaction is not an EIP712 transaction.\n\nTransaction must:\n  - include `type: "eip712"`\n  - include one of the following: `customSignature`, `paymaster`, `paymasterInput`, `gasPerPubdata`, `factoryDeps`',{name:"InvalidEip712TransactionError"})}}function St(e){return"eip712"===e.type||"customSignature"in e&&!!e.customSignature||"paymaster"in e&&!!e.paymaster||"paymasterInput"in e&&!!e.paymasterInput||"gasPerPubdata"in e&&"bigint"==typeof e.gasPerPubdata||"factoryDeps"in e&&!!e.factoryDeps||!1}function Sr(e){let{chainId:t,to:r,from:i,paymaster:n,paymasterInput:s}=e;if(!St(e))throw new Se;if(!t||t<=0)throw new _7.InvalidChainIdError({chainId:t});if(r&&!(0,no.isAddress)(r))throw new _6.InvalidAddressError({address:r});if(i&&!(0,no.isAddress)(i))throw new _6.InvalidAddressError({address:i});if(n&&!(0,no.isAddress)(n))throw new _6.InvalidAddressError({address:n});if(n&&!s)throw new _4.BaseError("`paymasterInput` must be provided when `paymaster` is defined");if(!n&&s)throw new _4.BaseError("`paymaster` must be provided when `paymasterInput` is defined")}var Si=e.i(258479),Sn=e.i(38133),Ss=_4;class Sa extends Ss.BaseError{constructor({givenLength:e,maxBytecodeSize:t}){super(`Bytecode cannot be longer than ${t} bytes. Given length: ${e}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class So extends Ss.BaseError{constructor({givenLengthInWords:e}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${e}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class Sl extends Ss.BaseError{constructor({givenLength:e}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${e}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function Sc(e){let t=(0,_Z.toBytes)(e);if(t.length%32!=0)throw new Sl({givenLength:t.length});if(t.length>_1)throw new Sa({givenLength:t.length,maxBytecodeSize:_1});let r=(0,Sn.sha256)(t),i=(0,_Z.toBytes)(r),n=t.length/32;if(n%2==0)throw new So({givenLengthInWords:n});let s=(0,_Z.toBytes)(n),a=(0,Si.pad)(s,{size:2}),o=new Uint8Array([1,0]);return i.set(o,0),i.set(a,2),i}let Sd={blockTime:1e3,formatters:_2,serializers:{transaction:function(e,t){return St(e)?function(e){let{chainId:t,gas:r,nonce:i,to:n,from:s,value:a,maxFeePerGas:o,maxPriorityFeePerGas:l,customSignature:c,factoryDeps:d,paymaster:u,paymasterInput:h,gasPerPubdata:p,data:f}=e;Sr(e);let y=[i?(0,na.toHex)(i):"0x",l?(0,na.toHex)(l):"0x",o?(0,na.toHex)(o):"0x",r?(0,na.toHex)(r):"0x",n??"0x",a?(0,na.toHex)(a):"0x",f??"0x",(0,na.toHex)(t),(0,na.toHex)(""),(0,na.toHex)(""),(0,na.toHex)(t),s??"0x",p?(0,na.toHex)(p):(0,na.toHex)(50000n),d??[],c??"0x",u&&h?[u,h]:[]];return(0,_3.concatHex)(["0x71",(0,_5.toRlp)(y)])}(e):(0,_8.serializeTransaction)(e,t)}},custom:{getEip712Domain:e=>{Sr(e);let t=function(e){let{gas:t,nonce:r,to:i,from:n,value:s,maxFeePerGas:a,maxPriorityFeePerGas:o,factoryDeps:l,paymaster:c,paymasterInput:d,gasPerPubdata:u,data:h}=e;return{txType:113n,from:BigInt(n),to:i?BigInt(i):0n,gasLimit:t??0n,gasPerPubdataByteLimit:u??50000n,maxFeePerGas:a??0n,maxPriorityFeePerGas:o??0n,paymaster:c?BigInt(c):0n,nonce:r?BigInt(r):0n,value:s??0n,data:h??"0x",factoryDeps:l?.map(e=>(0,na.toHex)(Sc(e)))??[],paymasterInput:d||"0x"}}(e);return{domain:{name:"zkSync",version:"2",chainId:e.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:t}}}},Su=(0,_D.defineChain)({...Sd,blockTime:200,id:2741,name:"Abstract",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.mainnet.abs.xyz"],webSocket:["wss://api.mainnet.abs.xyz/ws"]}},blockExplorers:{default:{name:"Etherscan",url:"https://abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.mainnet.abs.xyz"}},contracts:{multicall3:{address:"0xAa4De41dba0Ca5dCBb288b7cC6b708F3aaC759E7",blockCreated:5288},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:5263}}}),Sh=(0,_D.defineChain)({...Sd,blockTime:200,id:11124,name:"Abstract Testnet",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.testnet.abs.xyz"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.testnet.abs.xyz"}},testnet:!0,contracts:{multicall3:{address:"0xF9cda624FBC7e059355ce98a31693d299FACd963",blockCreated:358349},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:431682}}}),Sp=(0,_D.defineChain)({id:1514,name:"Story",nativeCurrency:{decimals:18,name:"IP Token",symbol:"IP"},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:340998},ensRegistry:{address:"0x5dc881dda4e4a8d312be3544ad13118d1a04cb17",blockCreated:648924},ensUniversalResolver:{address:"0xddfb18888a9466688235887dec2a10c4f5effee9",blockCreated:649114}},rpcUrls:{default:{http:["https://mainnet.storyrpc.io"]}},blockExplorers:{default:{name:"Story explorer",url:"https://storyscan.io",apiUrl:"https://storyscan.io/api/v2"}},ensTlds:[".ip"],testnet:!1}),Sf=(0,_D.defineChain)({id:41923,name:"EDU Chain",nativeCurrency:{decimals:18,name:"EDU",symbol:"EDU"},rpcUrls:{default:{http:["https://rpc.edu-chain.raas.gelato.cloud"]}},blockExplorers:{default:{name:"EDU Chain Explorer",url:"https://educhain.blockscout.com/"}},testnet:!1});var Sy=e.i(189973),Sg=e.i(746807),Sm=e.i(756742);async function Sw({hash:e,privateKey:t,to:r="object"}){let{r:i,s:n,recovery:s}=Sy.secp256k1.sign(e.slice(2),t.slice(2),{lowS:!0,extraEntropy:!!(0,nc.isHex)(!1,{strict:!1})&&(0,_Z.hexToBytes)(!1)}),a={r:(0,na.numberToHex)(i,{size:32}),s:(0,na.numberToHex)(n,{size:32}),v:s?28n:27n,yParity:s};return"bytes"===r||"hex"===r?(0,Sm.serializeSignature)({...a,to:r}):a}async function Sb(e){let{chainId:t,nonce:r,privateKey:i,to:n="object"}=e,s=e.contractAddress??e.address,a=await Sw({hash:(0,nd.hashAuthorization)({address:s,chainId:t,nonce:r}),privateKey:i,to:n});return"object"===n?{address:s,chainId:t,nonce:r,...a}:a}var Sv=e.i(10813);async function SE({message:e,privateKey:t}){return await Sw({hash:(0,Sv.hashMessage)(e),privateKey:t,to:"hex"})}var SA=e.i(516274);async function S_(e){let{privateKey:t,transaction:r,serializer:i=_8.serializeTransaction}=e,n="eip4844"===r.type?{...r,sidecars:!1}:r,s=await Sw({hash:(0,SA.keccak256)(await i(n)),privateKey:t});return await i(r,s)}var SS=e.i(798177);async function SI(e){let{privateKey:t,...r}=e;return await Sw({hash:(0,SS.hashTypedData)(r),privateKey:t,to:"hex"})}var Sx=e.i(611672),ST=e.i(34744),Sk=e.i(88667),SC=e.i(313077),SP=e.i(432574);let SO=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],name:"AccountNonceOrderingUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"aaVersion",type:"uint8"}],name:"AccountVersionUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"deployerAddress",type:"address"},{indexed:!0,internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"contractAddress",type:"address"}],name:"ContractDeployed",type:"event"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"create2Account",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"createAccount",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"extendedAccountVersion",outputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_keccak256BytecodeHash",type:"bytes32"}],name:"forceDeployKeccak256",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment",name:"_deployment",type:"tuple"},{internalType:"address",name:"_sender",type:"address"}],name:"forceDeployOnAddress",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment[]",name:"_deployments",type:"tuple[]"}],name:"forceDeployOnAddresses",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"getAccountInfo",outputs:[{components:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"supportedAAVersion",type:"uint8"},{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],internalType:"struct IContractDeployer.AccountInfo",name:"info",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"uint256",name:"_senderNonce",type:"uint256"}],name:"getNewAddressCreate",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"getNewAddressCreate2",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_version",type:"uint8"}],name:"updateAccountVersion",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"_nonceOrdering",type:"uint8"}],name:"updateNonceOrdering",outputs:[],stateMutability:"nonpayable",type:"function"}],SR="/docs/contract/encodeDeployData";function SN(e,t,r,i){let n=[t,r,i];return({create:{functionName:"create",argsContractDeployer:n},create2:{functionName:"create2",argsContractDeployer:n},createAccount:{functionName:"createAccount",argsContractDeployer:[...n,1]},create2Account:{functionName:"create2Account",argsContractDeployer:[...n,1]}})[e||"create"]}var SM=e.i(673042),SU=e.i(793887),SD=e.i(647384),Sj=e.i(439933),SL=e.i(215739),SB=e.i(488455),SW=e.i(656356),SF=e.i(706158),Sz=e.i(287289);function Sq(e){if(!St(e))throw new Se;(0,Sz.assertRequest)(e)}var SH=e.i(674098),SK=e.i(495732);async function S$(e,t){let{account:r=e.account,chain:i=e.chain,...n}=t,s=r?(0,SM.parseAccount)(r):e.account;if(!s)throw new SL.AccountNotFoundError({docsPath:"/docs/actions/wallet/signTransaction"});if(Sq({account:s,chain:i,...t}),!i?.custom?.getEip712Domain)throw new _4.BaseError("`getEip712Domain` not found on chain.");if(!i?.serializers?.transaction)throw new _4.BaseError("transaction serializer not found on chain.");let a=await (0,SF.getAction)(e,SU.getChainId,"getChainId")({});null!==i&&(0,SB.assertCurrentChain)({currentChainId:a,chain:i});let o=i?.custom.getEip712Domain({...n,chainId:a,from:s.address,type:"eip712"}),l=await (0,SK.signTypedData)(e,{...o,account:s});return i?.serializers?.transaction({chainId:a,...n,customSignature:l,type:"eip712"},{r:"0x0",s:"0x0",v:0n})}async function SV(e,t){return St(t)?S$(e,t):await (0,SH.signTransaction)(e,t)}async function SJ(e,t){let{account:r=e.account,chain:i=e.chain}=t,n=r?(0,SM.parseAccount)(r):e.account;if(!n)throw new SL.AccountNotFoundError({docsPath:"/docs/actions/wallet/sendTransaction"});try{let r;Sq(t);let s=await (0,SD.prepareTransactionRequest)(e,{...t,nonceManager:n.nonceManager,parameters:["gas","nonce","fees"]});null!==i&&(r=await (0,SF.getAction)(e,SU.getChainId,"getChainId")({}),(0,SB.assertCurrentChain)({currentChainId:r,chain:i}));let a=await SV(e,{...s,chainId:r});return await (0,SF.getAction)(e,Sj.sendRawTransaction,"sendRawTransaction")({serializedTransaction:a})}catch(e){throw(0,SW.getTransactionError)(e,{...t,account:n,chain:i})}}var SZ=e.i(148815);async function SG(e,t){return St(t)?SJ(e,t):(0,SZ.sendTransaction)(e,t)}function SY([e,t]){return`${e}=${function e(t){return Array.isArray(t)?"%5B"+t.map(e).join("%2C%20")+"%5D":"bigint"==typeof t?`${t}n`:encodeURIComponent(String(null!=t&&null===Object.getPrototypeOf(t)?{...t}:t))}(t)}`}var SQ=class extends Error{cause=this.cause;context;constructor(...[e,t]){let r,i;t&&Object.entries(Object.getOwnPropertyDescriptors(t)).forEach(([t,n])=>{"cause"===t?i={cause:n.value}:(void 0===r&&(r={__code:e}),Object.defineProperty(r,t,n))}),super(function(e,t={}){{let r=`Solana error #${e}; Decode this error by running \`npx @solana/errors decode -- ${e}`;return Object.keys(t).length&&(r+=` '${btoa(Object.entries(t).map(SY).join("&"))}'`),`${r}\``}}(e,r),i),this.context=Object.freeze(void 0===r?{__code:e}:r),this.name="SolanaError"}};function SX(...e){"captureStackTrace"in Error&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(...e)}function S0({errorCodeBaseOffset:e,getErrorContext:t,orderedErrorNames:r,rpcEnumError:i},n){let s,a;"string"==typeof i?s=i:(s=Object.keys(i)[0],a=i[s]);let o=e+r.indexOf(s),l=t(o,s,a),c=new SQ(o,l);return SX(c,n),c}var S1=["GenericError","InvalidArgument","InvalidInstructionData","InvalidAccountData","AccountDataTooSmall","InsufficientFunds","IncorrectProgramId","MissingRequiredSignature","AccountAlreadyInitialized","UninitializedAccount","UnbalancedInstruction","ModifiedProgramId","ExternalAccountLamportSpend","ExternalAccountDataModified","ReadonlyLamportChange","ReadonlyDataModified","DuplicateAccountIndex","ExecutableModified","RentEpochModified","NotEnoughAccountKeys","AccountDataSizeChanged","AccountNotExecutable","AccountBorrowFailed","AccountBorrowOutstanding","DuplicateAccountOutOfSync","Custom","InvalidError","ExecutableDataModified","ExecutableLamportChange","ExecutableAccountNotRentExempt","UnsupportedProgramId","CallDepth","MissingAccount","ReentrancyNotAllowed","MaxSeedLengthExceeded","InvalidSeeds","InvalidRealloc","ComputationalBudgetExceeded","PrivilegeEscalation","ProgramEnvironmentSetupFailure","ProgramFailedToComplete","ProgramFailedToCompile","Immutable","IncorrectAuthority","BorshIoError","AccountNotRentExempt","InvalidAccountOwner","ArithmeticOverflow","UnsupportedSysvar","IllegalOwner","MaxAccountsDataAllocationsExceeded","MaxAccountsExceeded","MaxInstructionTraceLengthExceeded","BuiltinProgramsMustConsumeComputeUnits"],S2=["AccountInUse","AccountLoadedTwice","AccountNotFound","ProgramAccountNotFound","InsufficientFundsForFee","InvalidAccountForFee","AlreadyProcessed","BlockhashNotFound","CallChainTooDeep","MissingSignatureForFee","InvalidAccountIndex","SignatureFailure","InvalidProgramForExecution","SanitizeFailure","ClusterMaintenance","AccountBorrowOutstanding","WouldExceedMaxBlockCostLimit","UnsupportedVersion","InvalidWritableAccount","WouldExceedMaxAccountCostLimit","WouldExceedAccountDataBlockLimit","TooManyAccountLocks","AddressLookupTableNotFound","InvalidAddressLookupTableOwner","InvalidAddressLookupTableData","InvalidAddressLookupTableIndex","InvalidRentPayingAccount","WouldExceedMaxVoteCostLimit","WouldExceedAccountDataTotalLimit","DuplicateInstruction","InsufficientFundsForRent","MaxLoadedAccountsDataSizeExceeded","InvalidLoadedAccountsDataSizeLimit","ResanitizationNeeded","ProgramExecutionTemporarilyRestricted","UnbalancedTransaction"];function S3(e){var t;let r;if("object"==typeof(t=e)&&null!==t&&"code"in t&&"message"in t&&("number"==typeof t.code||"bigint"==typeof t.code)&&"string"==typeof t.message){let{code:t,data:i,message:n}=e,s=Number(t);if(-32002===s){let{err:e,...t}=i,n=e?{cause:function e(t){return"object"==typeof t&&"InstructionError"in t?function e(t,r){let i=Number(t);return S0({errorCodeBaseOffset:4615001,getErrorContext:(e,t,r)=>4615e3===e?{errorName:t,index:i,...void 0!==r?{instructionErrorContext:r}:null}:4615026===e?{code:Number(r),index:i}:{index:i},orderedErrorNames:S1,rpcEnumError:r},e)}(...t.InstructionError):S0({errorCodeBaseOffset:7050001,getErrorContext:(e,t,r)=>705e4===e?{errorName:t,...void 0!==r?{transactionErrorContext:r}:null}:7050030===e?{index:Number(r)}:7050031===e||7050035===e?{accountIndex:Number(r.account_index)}:void 0,orderedErrorNames:S2,rpcEnumError:t},e)}(e)}:null;r=new SQ(-32002,{...t,...n})}else{let e;switch(s){case -32603:case -32602:case -32600:case -32601:case -32700:case -32012:case -32001:case -32004:case -32014:case -32010:case -32009:case -32007:case -32006:case -32015:e={__serverMessage:n};break;default:"object"!=typeof i||Array.isArray(i)||(e=i)}r=new SQ(s,e)}}else{let t="object"==typeof e&&null!==e&&"message"in e&&"string"==typeof e.message?e.message:"Malformed JSON-RPC error with no message attribute";r=new SQ(10,{error:e,message:t})}return SX(r,S3),r}var S5=((CC=S5||{})[CC.WRITABLE_SIGNER=3]="WRITABLE_SIGNER",CC[CC.READONLY_SIGNER=2]="READONLY_SIGNER",CC[CC.WRITABLE=1]="WRITABLE",CC[CC.READONLY=0]="READONLY",CC);function S8(e,t){return"fixedSize"in t?t.fixedSize:t.getSizeFromValue(e)}function S6(e){return Object.freeze({...e,encode:t=>{let r=new Uint8Array(S8(t,e));return e.write(t,r,0),r}})}function S4(e){return Object.freeze({...e,decode:(t,r=0)=>e.read(t,r)[0]})}function S7(e){return"fixedSize"in e&&"number"==typeof e.fixedSize}function S9(e,t,r,i=0){let n=r.length-i;if(n<t)throw new SQ(8078001,{bytesLength:n,codecDescription:e,expected:t})}function Ie(e,t,r){if(t<0||t>r)throw new SQ(8078014,{bytesLength:r,codecDescription:e,offset:t})}function It(e,t){return S4({fixedSize:t,read:(r,i)=>{let n,s;S9("fixCodecSize",t,r,i),(i>0||r.length>t)&&(r=r.slice(i,i+t)),S7(e)&&(n=r,s=e.fixedSize,r=function(e,t){if(e.length>=t)return e;let r=new Uint8Array(t).fill(0);return r.set(e),r}(n.length<=s?n:n.slice(0,s),s));let[a]=e.read(r,0);return[a,i+t]}})}function Ir(e,t){return S4({...e,read:(r,i)=>{let[n,s]=e.read(r,i);return[t(n,r,i),s]}})}var Ii="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function In(){if(!globalThis.isSecureContext)throw new SQ(361e4)}function Is(){if(In(),void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.subtle?.exportKey)throw new SQ(3610003)}function Ia(){let e;return It((C1||(e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",C1=S4({read(t,r){let i=0===r?t:t.slice(r);if(0===i.length)return["",0];let n=i.findIndex(e=>0!==e);n=-1===n?i.length:n;let s=e[0].repeat(n);return n===i.length?[s,t.length]:[s+function(e,t){let r=BigInt(t.length),i=[];for(;e>0n;)i.unshift(t[Number(e%r)]),e/=r;return i.join("")}(i.slice(n).reduce((e,t)=>256n*e+BigInt(t),0n),e),t.length]}})),C1),32)}async function Io(e){if(Is(),"public"!==e.type||"Ed25519"!==e.algorithm.name)throw new SQ(2800003);let t=await crypto.subtle.exportKey("raw",e);return Ia().decode(new Uint8Array(t))}var Il=Object.freeze({name:"Ed25519"});async function Ic(e,t=!1){let r=e.byteLength;if(32!==r)throw new SQ(3704001,{actualLength:r});let i=new Uint8Array([48,46,2,1,0,48,5,6,3,43,101,112,4,34,4,32,...e]);return await crypto.subtle.importKey("pkcs8",i,Il,t,["sign"])}async function Id(e,t=!1){if(Is(),!1===e.extractable)throw new SQ(3610007,{key:e});let r=await crypto.subtle.exportKey("jwk",e);return await crypto.subtle.importKey("jwk",{crv:"Ed25519",ext:t,key_ops:["verify"],kty:"OKP",x:r.x},"Ed25519",t,["verify"])}async function Iu(e,t){if(In(),void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.subtle?.sign)throw new SQ(3610005);return new Uint8Array(await crypto.subtle.sign(Il,e,t))}async function Ih(e,t,r){if(In(),void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.subtle?.verify)throw new SQ(3610006);return await crypto.subtle.verify(Il,e,t,r)}async function Ip(e,t=!1){if(void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.getRandomValues)throw new SQ(3611e3);if(64!==e.byteLength)throw new SQ(3704e3,{byteLength:e.byteLength});let[r,i]=await Promise.all([crypto.subtle.importKey("raw",e.slice(32),Il,!0,["verify"]),Ic(e.slice(0,32),t)]),n=new Uint8Array(32);crypto.getRandomValues(n);let s=await Iu(i,n);if(!await Ih(r,s,n))throw new SQ(3704004);return{privateKey:i,publicKey:r}}async function If(e,t=!1){let r=Ic(e,t),[i,n]=await Promise.all([(t?r:Ic(e,!0)).then(async e=>await Id(e,!0)),r]);return{privateKey:n,publicKey:i}}function Iy(e,t,r,i){if(i<t||i>r)throw new SQ(8078011,{codecDescription:e,max:r,min:t,value:i})}var Ig=((CP=Ig||{})[CP.Little=0]="Little",CP[CP.Big=1]="Big",CP);function Im(e){return e?.endian!==1}function Iw(e){return S4({fixedSize:e.size,read(t,r=0){var i,n,s;let a,o;!function(e,t,r=0){if(t.length-r<=0)throw new SQ(8078e3,{codecDescription:e})}(e.name,t,r),S9(e.name,e.size,t,r);let l=new DataView((i=t,n=r,s=e.size,a=i.byteOffset+(n??0),o=s??i.byteLength,i.buffer.slice(a,a+o)));return[e.get(l,Im(e.config)),r+e.size]}})}var Ib=()=>S4({maxSize:3,read:(e,t)=>{let r=0,i=0;for(;++i;){let n=i-1,s=e[t+n];if(r|=(127&s)<<7*n,(128&s)==0)break}return[r,t+i]}}),Iv=()=>Iw({get:e=>e.getUint8(0),name:"u8",size:1});function IE(e){return e.reduce((e,t)=>null===e||null===t?null:e+t,0)}function IA(e){return S7(e)?e.fixedSize:null}function I_(e){return S7(e)?e.fixedSize:e.maxSize??null}function IS(e,t={}){let r=t.size??((e={})=>Iw({config:e,get:(e,t)=>e.getUint32(0,t),name:"u32",size:4}))(),i=II(r,IA(e)),n=II(r,I_(e))??void 0;return S4({...null!==i?{fixedSize:i}:{maxSize:n},read:(t,i)=>{let n=[];if("object"==typeof r&&0===t.slice(i).length)return[n,i];if("remainder"===r){for(;i<t.length;){let[r,s]=e.read(t,i);i=s,n.push(r)}return[n,i]}let[s,a]="number"==typeof r?[r,i]:r.read(t,i);i=a;for(let r=0;r<s;r+=1){let[r,s]=e.read(t,i);i=s,n.push(r)}return[n,i]}})}function II(e,t){return"number"!=typeof e?null:0===e?0:null===t?null:t*e}function Ix(){return S6({getSizeFromValue:e=>e.length,write:(e,t,r)=>(t.set(e,r),r+e.length)})}function IT(){return S4({read:(e,t)=>{let r=e.slice(t);return[r,t+r.length]}})}function Ik(e){let t=e.map(([,e])=>e),r=IE(t.map(IA)),i=IE(t.map(I_))??void 0;return S4({...null===r?{maxSize:i}:{fixedSize:r},read:(t,r)=>{let i={};return e.forEach(([e,n])=>{let[s,a]=n.read(t,r);r=a,i[e]=s}),[i,r]}})}function IC(e,...t){return t.reduce((e,t)=>t(e),e)}function IP(){return C3||(C3=Iv()),C3}function IO(){return S4({maxSize:1,read:(e,t)=>{let r=e[t];if((128&r)==0)return["legacy",t];{let e=128^r;if(e>0)throw new SQ(5663021,{unsupportedVersion:e});return[e,t+1]}}})}function IR(e){let t=Object.values(e);if(0===t.length)throw new SQ(5663016);return t.map(e=>e||new Uint8Array(64).fill(0))}function IN(e){var t,r,i,n;let s,a,{messageBytes:o,signatures:l}=e,[c,d,u]=(s=IE((n=[IO(),(t=Iv(),r=function(e,t){if(S7(e)){let r=t(e.fixedSize);if(r<0)throw new SQ(8078013,{bytesLength:r,codecDescription:"resizeDecoder"});return S4({...e,fixedSize:r})}return e}(t,e=>e+2),i={postOffset:({postOffset:e})=>e+2},S4({...r,read:(e,t)=>{let n=t=>{var r,i;return r=t,0===(i=e.length)?0:(r%i+i)%i},s=i.preOffset?i.preOffset({bytes:e,preOffset:t,wrapBytes:n}):t;Ie("offsetDecoder",s,e.length);let[a,o]=r.read(e,s),l=i.postOffset?i.postOffset({bytes:e,newPreOffset:s,postOffset:o,preOffset:t,wrapBytes:n}):o;return Ie("offsetDecoder",l,e.length),[a,l]}})),IS(Ia(),{size:Ib()})]).map(IA)),a=IE(n.map(I_))??void 0,S4({...null===s?{maxSize:a}:{fixedSize:s},read:(e,t)=>{let r=[];return n.forEach(i=>{let[n,s]=i.read(e,t);r.push(n),t=s}),[r,t]}})).decode(o),h=u.slice(0,d);if(h.length!==l.length)throw new SQ(5663017,{numRequiredSignatures:d,signaturesLength:l.length,signerAddresses:h});let p={};return h.forEach((e,t)=>{let r=l[t];r.every(e=>0===e)?p[e]=null:p[e]=r}),{messageBytes:o,signatures:Object.freeze(p)}}async function IM(e,t){let r,i;if(await Promise.all(e.map(async e=>{let n=await Io(e.publicKey),s=t.signatures[n];if(void 0===s)return void(i||=new Set).add(n);if(i)return;let a=await Iu(e.privateKey,t.messageBytes);null!==s&&a.length===s.length&&a.every((e,t)=>e===s[t])||((r||={})[n]=a)})),i&&i.size>0)throw new SQ(5663015,{expectedAddresses:Object.keys(t.signatures),unexpectedAddresses:[...i]});return r?Object.freeze({...t,signatures:Object.freeze({...t.signatures,...r})}):t}Symbol("AddressMapTypeProperty");var IU=((CO=IU||{})[CO.Little=0]="Little",CO[CO.Big=1]="Big",CO);Object.freeze({name:"Ed25519"}),new Uint8Array([255,115,111,108,97,110,97,32,111,102,102,99,104,97,105,110]);var ID=((CR=ID||{})[CR.RESTRICTED_ASCII_1232_BYTES_MAX=0]="RESTRICTED_ASCII_1232_BYTES_MAX",CR[CR.UTF8_1232_BYTES_MAX=1]="UTF8_1232_BYTES_MAX",CR[CR.UTF8_65535_BYTES_MAX=2]="UTF8_65535_BYTES_MAX",CR);function Ij(e){return"modifyAndSignTransactions"in e&&"function"==typeof e.modifyAndSignTransactions}function IL(e){return"signTransactions"in e&&"function"==typeof e.signTransactions}async function IB(e){let t=await Io(e.publicKey);return Object.freeze({address:t,keyPair:e,signMessages:r=>Promise.all(r.map(async r=>Object.freeze({[t]:await Iu(e.privateKey,r.content)}))),signTransactions:r=>Promise.all(r.map(async r=>Object.freeze({[t]:(await IM([e],r)).signatures[t]})))})}async function IW(e,t){return await IB(await Ip(e,t))}async function IF(e,t){return await IB(await If(e,t))}function Iz(e){return JSON.parse(function(e){let t=[],r=!1;for(let n=0;n<e.length;n++){let s=!1;if("\\"===e[n]&&(t.push(e[n++]),s=!s),'"'===e[n]){t.push(e[n]),s||(r=!r);continue}if(!r){let r=function(e,t){if(!e[t]?.match(/[-\d]/))return null;let r=e.slice(t).match(/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?/);return r?r[0]:null}(e,n);if(r?.length){var i;n+=r.length-1,r.match(/\.|[eE]-/)?t.push(r):t.push((i=r,`{"$n":"${i}"}`));continue}}t.push(e[n])}return t.join("")}(e),(e,t)=>{var r;return(r=t)&&"object"==typeof r&&"$n"in r&&"string"==typeof r.$n?function({$n:e}){if(e.match(/[eE]/)){let[t,r]=e.split(/[eE]/);return BigInt(t)*BigInt(10)**BigInt(r)}return BigInt(e)}(t):t})}var Iq=0n;function IH(e){let t;return{id:(t=Iq,Iq++,t.toString()),jsonrpc:"2.0",method:e.methodName,params:e.params}}function IK(e,t){return JSON.stringify(e,(e,t)=>{var r;return"bigint"==typeof t?(r=t,{$n:`${r}`}):t},t).replace(/\{\s*"\$n"\s*:\s*"(-?\d+)"\s*\}/g,"$1")}function I$(e){return!(null==e||"object"!=typeof e||Array.isArray(e))&&"jsonrpc"in e&&"2.0"===e.jsonrpc&&"method"in e&&"string"==typeof e.method&&"params"in e}function IV(e){return"bigint"==typeof e?Number(e):e}var IJ={};function IZ(e){return function t(r,i){if(Array.isArray(r))return r.map((e,r)=>t(e,{...i,keyPath:[...i.keyPath,r]}));if("object"!=typeof r||null===r)return e.reduce((e,t)=>t(e,i),r);{let e={};for(let n in r){if(!Object.prototype.hasOwnProperty.call(r,n))continue;let s={...i,keyPath:[...i.keyPath,n]};e[n]=t(r[n],s)}return e}}}function IG(e,t){return r=>{let i=IZ(e);return Object.freeze({...r,params:i(r.params,t)})}}var IY={accountNotifications:1,blockNotifications:1,getAccountInfo:1,getBalance:1,getBlock:1,getBlockHeight:0,getBlockProduction:0,getBlocks:2,getBlocksWithLimit:2,getEpochInfo:0,getFeeForMessage:1,getInflationGovernor:0,getInflationReward:1,getLargestAccounts:0,getLatestBlockhash:0,getLeaderSchedule:1,getMinimumBalanceForRentExemption:1,getMultipleAccounts:1,getProgramAccounts:1,getSignaturesForAddress:1,getSlot:0,getSlotLeader:0,getStakeMinimumDelegation:0,getSupply:0,getTokenAccountBalance:1,getTokenAccountsByDelegate:2,getTokenAccountsByOwner:2,getTokenLargestAccounts:1,getTokenSupply:1,getTransaction:1,getTransactionCount:0,getVoteAccounts:0,isBlockhashValid:1,logsNotifications:1,programNotifications:1,requestAirdrop:2,sendTransaction:1,signatureNotifications:1,simulateTransaction:1};function IQ(e){let t=e?.onIntegerOverflow;return r=>IC(r,t?e=>{var r;return IG([(r=(...r)=>t(e,...r),(e,{keyPath:t})=>("bigint"==typeof e&&r&&(e>Number.MAX_SAFE_INTEGER||e<-Number.MAX_SAFE_INTEGER)&&r(t,e),e))],{keyPath:[]})(e)}:e=>e,IG([IV],{keyPath:[]}),function({defaultCommitment:e,optionsObjectPositionByMethod:t}){return r=>{let{params:i,methodName:n}=r;if(!Array.isArray(i))return r;let s=t[n];return null==s?r:Object.freeze({methodName:n,params:function({commitmentPropertyName:e,params:t,optionsObjectPositionInParams:r,overrideCommitment:i}){let n=t[r];if(void 0===n||n&&"object"==typeof n&&!Array.isArray(n)){if(n&&e in n){if(!n[e]||"finalized"===n[e]){let i=[...t],{[e]:s,...a}=n;return Object.keys(a).length>0?i[r]=a:r===i.length-1?i.length--:i[r]=void 0,i}}else if("finalized"!==i){let s=[...t];return s[r]={...n,[e]:i},s}}return t}({commitmentPropertyName:"sendTransaction"===n?"preflightCommitment":"commitment",optionsObjectPositionInParams:s,overrideCommitment:e,params:i})})}}({defaultCommitment:e?.defaultCommitment,optionsObjectPositionByMethod:IY}))}function IX(e){var t,r;return t=[function(t,{keyPath:r}){var i;return"number"==typeof t&&Number.isInteger(t)||"bigint"==typeof t?(i=r,e.some(e=>{if(e.length!==i.length)return!1;for(let t=i.length-1;t>=0;t--){let r=i[t],n=e[t];if(n!==r&&(n!==IJ||"number"!=typeof r))return!1}return!0}))?Number(t):BigInt(t):t}],r={keyPath:[]},e=>IZ(t)(e,r)}var I0=[["data","parsed","info","tokenAmount","decimals"],["data","parsed","info","tokenAmount","uiAmount"],["data","parsed","info","rentExemptReserve","decimals"],["data","parsed","info","rentExemptReserve","uiAmount"],["data","parsed","info","delegatedAmount","decimals"],["data","parsed","info","delegatedAmount","uiAmount"],["data","parsed","info","extensions",IJ,"state","olderTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",IJ,"state","newerTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",IJ,"state","preUpdateAverageRate"],["data","parsed","info","extensions",IJ,"state","currentRate"]],I1=[...I0,["data","parsed","info","lastExtendedSlotStartIndex"],["data","parsed","info","slashPenalty"],["data","parsed","info","warmupCooldownRate"],["data","parsed","info","decimals"],["data","parsed","info","numRequiredSigners"],["data","parsed","info","numValidSigners"],["data","parsed","info","stake","delegation","warmupCooldownRate"],["data","parsed","info","exemptionThreshold"],["data","parsed","info","burnPercent"],["data","parsed","info","commission"],["data","parsed","info","votes",IJ,"confirmationCount"]],I2=[["index"],["instructions",IJ,"accounts",IJ],["instructions",IJ,"programIdIndex"],["instructions",IJ,"stackHeight"]],I3=[["addressTableLookups",IJ,"writableIndexes",IJ],["addressTableLookups",IJ,"readonlyIndexes",IJ],["header","numReadonlySignedAccounts"],["header","numReadonlyUnsignedAccounts"],["header","numRequiredSignatures"],["instructions",IJ,"accounts",IJ],["instructions",IJ,"programIdIndex"],["instructions",IJ,"stackHeight"]],I5=["getAccountInfo","getBalance","getBlock","getBlockCommitment","getBlockHeight","getBlockProduction","getBlocks","getBlocksWithLimit","getBlockTime","getClusterNodes","getEpochInfo","getEpochSchedule","getFeeForMessage","getFirstAvailableBlock","getGenesisHash","getHealth","getHighestSnapshotSlot","getIdentity","getInflationGovernor","getInflationRate","getInflationReward","getLargestAccounts","getLatestBlockhash","getLeaderSchedule","getMaxRetransmitSlot","getMaxShredInsertSlot","getMinimumBalanceForRentExemption","getMultipleAccounts","getProgramAccounts","getRecentPerformanceSamples","getRecentPrioritizationFees","getSignaturesForAddress","getSignatureStatuses","getSlot","getSlotLeader","getSlotLeaders","getStakeMinimumDelegation","getSupply","getTokenAccountBalance","getTokenAccountsByDelegate","getTokenAccountsByOwner","getTokenLargestAccounts","getTokenSupply","getTransaction","getTransactionCount","getVersion","getVoteAccounts","index","isBlockhashValid","minimumLedgerSlot","requestAirdrop","sendTransaction","simulateTransaction"];function I8(e){return I$(e)&&I5.includes(e.method)}var I6=Object.prototype.toString,I4=Object.keys||function(e){let t=[];for(let r in e)t.push(r);return t};function I7(e){let t=function e(t,r){let i,n,s,a,o,l,c;if(!0===t)return"true";if(!1===t)return"false";switch(typeof t){case"object":if(null===t)return null;if("toJSON"in t&&"function"==typeof t.toJSON)return e(t.toJSON(),r);if("[object Array]"===(c=I6.call(t))){for(i=0,s="[",n=t.length-1;i<n;i++)s+=e(t[i],!0)+",";return n>-1&&(s+=e(t[i],!0)),s+"]"}if("[object Object]"!==c)return JSON.stringify(t);for(n=(a=I4(t).sort()).length,s="",i=0;i<n;)void 0!==(l=e(t[o=a[i]],!1))&&(s&&(s+=","),s+=JSON.stringify(o)+":"+l),i++;return"{"+s+"}";case"function":case"undefined":return r?null:void 0;case"bigint":return`${t.toString()}n`;case"string":return JSON.stringify(t);default:return isFinite(t)?t:null}}(e,!1);if(void 0!==t)return""+t}var I9={defaultCommitment:"confirmed",onIntegerOverflow(e,t,r){throw function e(t,r,i){let n="";if("number"==typeof r[0]){let e=r[0]+1,t=e%10,i=e%100;n=1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"}else n=`\`${r[0].toString()}\``;let s=r.length>1?r.slice(1).map(e=>"number"==typeof e?`[${e}]`:e).join("."):void 0,a=new SQ(81e5,{argumentLabel:n,keyPath:r,methodName:t,optionalPathLabel:s?` at path \`${s}\``:"",value:i,...void 0!==s?{path:s}:void 0});return SX(a,e),a}(e.methodName,t,r)}},xe=globalThis.AbortController;function xt(e){return I$(e)?I7([e.method,e.params]):void 0}function xr(e,t){var r,i,n,s,a;return i=IC(function(e){let t,{fromJson:r,headers:i,toJson:n,url:s}=e,a=i&&function(e){let t={};for(let r in e)t[r.toLowerCase()]=e[r];return t}(i);return async function({payload:e,signal:i}){let o=n?n(e):JSON.stringify(e),l={...t,body:o,headers:{...a,accept:"application/json","content-length":o.length.toString(),"content-type":"application/json; charset=utf-8"},method:"POST",signal:i},c=await fetch(s,l);if(!c.ok)throw new SQ(8100002,{headers:c.headers,message:c.statusText,statusCode:c.status});return r?r(await c.text(),e):await c.json()}}({...{...r={url:e,...t},headers:{...!1,...r.headers?function(e){let t={};for(let r in e)t[r.toLowerCase()]=e[r];return t}(r.headers):void 0,"solana-client":"js/5.1.0"}},fromJson:(e,t)=>I8(t)?Iz(e):JSON.parse(e),toJson:e=>I8(e)?IK(e):JSON.stringify(e)}),e=>{let t;return async function(r){let{payload:i,signal:n}=r,s=xt(i);if(void 0===s)return await e(r);if(t||(queueMicrotask(()=>{t=void 0}),t={}),null==t[s]){let i=new xe,n=(async()=>{try{return await e({...r,signal:i.signal})}catch(e){if(e===(C6||={}))return;throw e}})();t[s]={abortController:i,numConsumers:0,responsePromise:n}}let a=t[s];if(a.numConsumers++,!n)return await a.responsePromise;{let e=a.responsePromise;return await new Promise((t,r)=>{let i=e=>{n.removeEventListener("abort",i),a.numConsumers-=1,queueMicrotask(()=>{0===a.numConsumers&&a.abortController.abort(C6||={})}),r(e.target.reason)};n.addEventListener("abort",i),e.then(t).catch(r).finally(()=>{n.removeEventListener("abort",i)})})}}}),a={api:(s={requestTransformer:IQ(I9),responseTransformer:(n={allowedNumericKeyPaths:(C8||(C8={getAccountInfo:I1.map(e=>["value",...e]),getBlock:[["transactions",IJ,"meta","preTokenBalances",IJ,"accountIndex"],["transactions",IJ,"meta","preTokenBalances",IJ,"uiTokenAmount","decimals"],["transactions",IJ,"meta","postTokenBalances",IJ,"accountIndex"],["transactions",IJ,"meta","postTokenBalances",IJ,"uiTokenAmount","decimals"],["transactions",IJ,"meta","rewards",IJ,"commission"],...I2.map(e=>["transactions",IJ,"meta","innerInstructions",IJ,...e]),...I3.map(e=>["transactions",IJ,"transaction","message",...e]),["rewards",IJ,"commission"]],getClusterNodes:[[IJ,"featureSet"],[IJ,"shredVersion"]],getInflationGovernor:[["initial"],["foundation"],["foundationTerm"],["taper"],["terminal"]],getInflationRate:[["foundation"],["total"],["validator"]],getInflationReward:[[IJ,"commission"]],getMultipleAccounts:I1.map(e=>["value",IJ,...e]),getProgramAccounts:I1.flatMap(e=>[["value",IJ,"account",...e],[IJ,"account",...e]]),getRecentPerformanceSamples:[[IJ,"samplePeriodSecs"]],getTokenAccountBalance:[["value","decimals"],["value","uiAmount"]],getTokenAccountsByDelegate:I0.map(e=>["value",IJ,"account",...e]),getTokenAccountsByOwner:I0.map(e=>["value",IJ,"account",...e]),getTokenLargestAccounts:[["value",IJ,"decimals"],["value",IJ,"uiAmount"]],getTokenSupply:[["value","decimals"],["value","uiAmount"]],getTransaction:[["meta","preTokenBalances",IJ,"accountIndex"],["meta","preTokenBalances",IJ,"uiTokenAmount","decimals"],["meta","postTokenBalances",IJ,"accountIndex"],["meta","postTokenBalances",IJ,"uiTokenAmount","decimals"],["meta","rewards",IJ,"commission"],...I2.map(e=>["meta","innerInstructions",IJ,...e]),...I3.map(e=>["transaction","message",...e])],getVersion:[["feature-set"]],getVoteAccounts:[["current",IJ,"commission"],["delinquent",IJ,"commission"]],simulateTransaction:[["value","loadedAccountsDataSize"],...I1.map(e=>["value","accounts",IJ,...e]),...I2.map(e=>["value","innerInstructions",IJ,...e])]}),C8)},(e,t)=>{let r=t.methodName,i=n?.allowedNumericKeyPaths&&r?n.allowedNumericKeyPaths[r]:void 0;return IC(e,e=>(e=>{if("error"in e)throw S3(e.error);return e})(e,t),e=>e.result,e=>IX(i??[])(e,t))})},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...e){let[t,r]=e,i=r.toString();return function(...e){let t=Object.freeze({methodName:i,params:e}),r=s?.requestTransformer?s?.requestTransformer(t):t;return Object.freeze({execute:async({signal:e,transport:t})=>{let i=IH(r),n=await t({payload:i,signal:e});return s?.responseTransformer?s.responseTransformer(n,r):n}})}}})),transport:i},new Proxy(a.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(e,t,r){if("then"!==t)return function(...i){let n=t.toString(),s=Reflect.get(e,n,r);if(!s)throw new SQ(8100003,{method:n,params:i});return function({transport:e},t){return{send:async r=>await t.execute({signal:r?.abortSignal,transport:e})}}(a,s(...i))}}})}var xi=globalThis.AbortController,xn=globalThis.EventTarget;function xs(){return Symbol(void 0)}var xa=Symbol();function xo(e){return{on(t,r,i){function n(e){e instanceof CustomEvent?r(e.detail):r()}return e.addEventListener(t,n,i),()=>{e.removeEventListener(t,n)}}}}function xl(e){return null!==e&&("object"==typeof e||"function"==typeof e)}var xc=new WeakMap;async function xd(e){let t,r=new Promise((r,i)=>{for(let n of(t={reject:i,resolve:r},e)){if(!xl(n)){Promise.resolve(n).then(r,i);continue}let e=xc.get(n);void 0===e?((e=function(e){let t=new Set,r={deferreds:t,settled:!1};return Promise.resolve(e).then(e=>{for(let{resolve:r}of t)r(e);t.clear(),r.settled=!0},e=>{for(let{reject:r}of t)r(e);t.clear(),r.settled=!0}),r}(n)).deferreds.add(t),xc.set(n,e)):e.settled?Promise.resolve(n).then(r,i):e.deferreds.add(t)}});return await r.finally(()=>{for(let r of e)xl(r)&&xc.get(r).deferreds.delete(t)})}var xu=globalThis.AbortController,xh=new WeakMap;function xp(e,t,r){let i;if(void 0===r)return;let n=((i=xh.get(t))||xh.set(t,i={}),i);!n[r]&&e>0&&(n[r]=0);let s=e+n[r];return s<=0?delete n[r]:n[r]=s,s}var xf=new WeakMap;async function xy({channel:e,responseTransformer:t,signal:r,subscribeRequest:i,unsubscribeMethodName:n}){var s;let a,o,l,c,d,u,h;e.on("error",()=>{a=void 0,xh.delete(e)},{signal:r});let p=new Promise((t,i)=>{function s(){if(0===xp(-1,e,a)){let t=IH({methodName:n,params:[a]});a=void 0,e.send(t).catch(()=>{})}i(this.reason)}r.aborted?s.call(r):r.addEventListener("abort",s)}),f=IH(i);await e.send(f);let y=new Promise((t,i)=>{let n=new xu;r.addEventListener("abort",n.abort.bind(n));let s={signal:n.signal};e.on("error",e=>{n.abort(),i(e)},s),e.on("message",e=>{e&&"object"==typeof e&&"id"in e&&e.id===f.id&&(n.abort(),"error"in e?i(S3(e.error)):t(e.result))},s)});if(null==(a=await xd([p,y])))throw new SQ(8190001);xp(1,e,a);let g=((o=xf.get(e))||xf.set(e,o=new WeakMap),l=t??e,(c=o.get(l))||o.set(l,(s=e=>{if(!("method"in e))return;let r=t?t(e.params.result,i):e.params.result;return[`notification:${e.params.subscription}`,r]},c={...h=xo(u=new xn),on(t,r,i){d||(d={dispose:e.on("message",e=>{let t=s(e);if(!t)return;let[r,i]=t;u.dispatchEvent(new CustomEvent(r,{detail:i}))}),numSubscribers:0}),d.numSubscribers++;let n=h.on(t,r,i),a=!0;function o(){a&&(a=!1,i?.signal.removeEventListener("abort",o),d.numSubscribers--,0===d.numSubscribers&&(d.dispose(),d=void 0),n())}return i?.signal.addEventListener("abort",o),o}})),c),m=`notification:${a}`;return{on(t,r,i){switch(t){case"notification":return g.on(m,r,i);case"error":return e.on("error",r,i);default:throw new SQ(9900004,{channelName:t,supportedChannelNames:["notification","error"]})}}}}var xg=globalThis.EventTarget,xm=globalThis.WebSocket,xw={defaultCommitment:"confirmed",onIntegerOverflow(e,t,r){throw function e(t,r,i){let n="";if("number"==typeof r[0]){let e=r[0]+1,t=e%10,i=e%100;n=1==t&&11!=i?e+"st":2==t&&12!=i?e+"nd":3==t&&13!=i?e+"rd":e+"th"}else n=`\`${r[0].toString()}\``;let s=r.length>1?r.slice(1).map(e=>"number"==typeof e?`[${e}]`:e).join("."):void 0,a=new SQ(81e5,{argumentLabel:n,keyPath:r,methodName:t,optionalPathLabel:s?` at path \`${s}\``:"",value:i,...void 0!==s?{path:s}:void 0});return SX(a,e),a}(e.methodName,t,r)}},xb=globalThis.AbortController,xv={jsonrpc:"2.0",method:"ping"};function xE(e){return IC(e,e=>Object.freeze({...e,on:(t,r,i)=>"message"!==t?e.on(t,r,i):e.on("message",e=>r(Iz(e)),i)}),e=>Object.freeze({...e,send:t=>e.send(IK(t))}))}function xA(e,t){var r,i,n,s;let a,o;return r=function({createChannel:e}){var t;return IC((t=e,async({execute:e,signal:r})=>{let i=await t({abortSignal:r});return await e({channel:i,signal:r})}),e=>{let t;return t=new Map,function(r){let{request:i,signal:n}=r,s=I7([i.methodName,i.params]),a=t.get(s);if(!a){let i=new xb,n=e({...r,signal:i.signal});n.then(e=>{e.on("error",()=>{t.delete(s),i.abort()},{signal:i.signal})}).catch(()=>{}),t.set(s,a={abortController:i,dataPublisherPromise:n,numSubscribers:0})}return a.numSubscribers++,n.addEventListener("abort",()=>{a.numSubscribers--,0===a.numSubscribers&&queueMicrotask(()=>{0===a.numSubscribers&&(t.delete(s),a.abortController.abort())})},{signal:a.abortController.signal}),a.dataPublisherPromise}})}({createChannel:function(e){if(!1===/^wss?:/i.test(e.url)){let t=e.url.match(/^([^:]+):/);throw new DOMException(t?`Failed to construct 'WebSocket': The URL's scheme must be either 'ws' or 'wss'. '${t[1]}:' is not allowed.`:`Failed to construct 'WebSocket': The URL '${e.url}' is invalid.`)}let{intervalMs:t,...r}=e;return function(e,{maxSubscriptionsPerChannel:t,minChannels:r}){let i={entries:[],freeChannelIndex:-1};function n(){let e;if(i.entries.length<r){i.freeChannelIndex=-1;return}for(let r=0;r<i.entries.length;r++){let n=(i.freeChannelIndex+r+2)%i.entries.length,s=i.entries[n];s.subscriptionCount<t&&(!e||e.subscriptionCount>=s.subscriptionCount)&&(e={poolIndex:n,subscriptionCount:s.subscriptionCount})}i.freeChannelIndex=e?.poolIndex??-1}return function({abortSignal:t}){let r;function s(){let e=i.entries.findIndex(e=>e===r);i.entries.splice(e,1),r.dispose(),n()}if(-1===i.freeChannelIndex){let t=new xb,n=e({abortSignal:t.signal});n.then(e=>{e.on("error",s,{signal:t.signal})}).catch(s),r={channel:n,dispose(){t.abort()},subscriptionCount:0},i.entries.push(r)}else r=i.entries[i.freeChannelIndex];return r.subscriptionCount++,t.addEventListener("abort",function(){r.subscriptionCount--,0===r.subscriptionCount?s():-1!==i.freeChannelIndex&&(i.freeChannelIndex--,n())}),n(),r.channel}}(({abortSignal:i})=>(function({sendBufferHighWatermark:e,signal:t,url:r}){let i,n,s;if(t.aborted)return Promise.reject(t.reason);let a=!1,o=new Set;function l(){o.forEach(e=>{e()}),o.clear()}function c(){l(),a||n(t.reason),y.readyState!==xm.CLOSED&&y.readyState!==xm.CLOSING&&y.close(1e3)}function d(e){if(!t.aborted&&!a){let t=new SQ(8190004,{errorEvent:e});n(t),h.dispatchEvent(new CustomEvent("error",{detail:t}))}}function u(e){t.aborted||h.dispatchEvent(new CustomEvent("message",{detail:e.data}))}let h=new xg,p=xo(h);function f(){a=!0,s({...p,async send(t){if(y.readyState!==xm.OPEN)throw new SQ(8190003);if(!i&&y.bufferedAmount>e){let t,r=new Promise((r,n)=>{let s=setInterval(()=>{y.readyState===xm.OPEN&&y.bufferedAmount>e||(clearInterval(s),i=void 0,r())},16);t=()=>{i=void 0,clearInterval(s),n(new SQ(8190002))}});i={onCancel:t,promise:r}}i&&(!ArrayBuffer.isView(t)||t instanceof DataView||(t=new t.constructor(t)),await i.promise),y.send(t)}})}let y=new xm(r);return t.addEventListener("abort",c),y.addEventListener("close",function e(r){l(),i?.onCancel(),t.removeEventListener("abort",c),y.removeEventListener("close",e),y.removeEventListener("error",d),y.removeEventListener("message",u),y.removeEventListener("open",f),t.aborted||r.wasClean&&1e3===r.code||h.dispatchEvent(new CustomEvent("error",{detail:new SQ(8190003,{cause:r})}))}),y.addEventListener("error",d),y.addEventListener("message",u),y.addEventListener("open",f),new Promise((e,t)=>{n=t,s=e})})({...r,sendBufferHighWatermark:e.sendBufferHighWatermark??131072,signal:i}).then(e.jsonSerializer).then(e=>(function({abortSignal:e,channel:t,intervalMs:r}){let i;function n(){t.send(xv).catch(e=>{var t;(t=e)instanceof Error&&"SolanaError"===t.name&&8190003===t.context.__code&&a.abort()})}function s(){clearInterval(i),i=setInterval(n,r)}let a=new xb;return a.signal.addEventListener("abort",()=>{clearInterval(i)}),e.addEventListener("abort",()=>{a.abort()}),t.on("error",()=>{a.abort()},{signal:a.signal}),t.on("message",s,{signal:a.signal}),globalThis.navigator.onLine&&s(),globalThis.addEventListener("offline",function(){clearInterval(i)},{signal:a.signal}),globalThis.addEventListener("online",function(){n(),s()},{signal:a.signal}),{...t,send:(...e)=>(a.signal.aborted||s(),t.send(...e))}})({abortSignal:i,channel:e,intervalMs:t??5e3})),{maxSubscriptionsPerChannel:e.maxSubscriptionsPerChannel??100,minChannels:e.minChannels??1})}({...t,url:e,jsonSerializer:xE})}),i={api:(a=IQ(xw),n={allowedNumericKeyPaths:(C7||(C7={accountNotifications:I1.map(e=>["value",...e]),blockNotifications:[["value","block","transactions",IJ,"meta","preTokenBalances",IJ,"accountIndex"],["value","block","transactions",IJ,"meta","preTokenBalances",IJ,"uiTokenAmount","decimals"],["value","block","transactions",IJ,"meta","postTokenBalances",IJ,"accountIndex"],["value","block","transactions",IJ,"meta","postTokenBalances",IJ,"uiTokenAmount","decimals"],["value","block","transactions",IJ,"meta","rewards",IJ,"commission"],["value","block","transactions",IJ,"meta","innerInstructions",IJ,"index"],["value","block","transactions",IJ,"meta","innerInstructions",IJ,"instructions",IJ,"programIdIndex"],["value","block","transactions",IJ,"meta","innerInstructions",IJ,"instructions",IJ,"accounts",IJ],["value","block","transactions",IJ,"transaction","message","addressTableLookups",IJ,"writableIndexes",IJ],["value","block","transactions",IJ,"transaction","message","addressTableLookups",IJ,"readonlyIndexes",IJ],["value","block","transactions",IJ,"transaction","message","instructions",IJ,"programIdIndex"],["value","block","transactions",IJ,"transaction","message","instructions",IJ,"accounts",IJ],["value","block","transactions",IJ,"transaction","message","header","numReadonlySignedAccounts"],["value","block","transactions",IJ,"transaction","message","header","numReadonlyUnsignedAccounts"],["value","block","transactions",IJ,"transaction","message","header","numRequiredSignatures"],["value","block","rewards",IJ,"commission"]],programNotifications:I1.flatMap(e=>[["value",IJ,"account",...e],[IJ,"account",...e]])}),C7)},o=(e,t)=>{let r=t.methodName,i=n?.allowedNumericKeyPaths&&r?n.allowedNumericKeyPaths[r]:void 0;return IC(e,e=>IX(i??[])(e,t))},s={planExecutor:({request:e,...t})=>xy({...t,responseTransformer:o,subscribeRequest:{...e,methodName:e.methodName.replace(/Notifications$/,"Subscribe")},unsubscribeMethodName:e.methodName.replace(/Notifications$/,"Unsubscribe")}),requestTransformer:a},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...e){let[t,r]=e,i=r.toString();return function(...e){let t={methodName:i,params:e},r=s.requestTransformer?s.requestTransformer(t):t;return{execute:e=>s.planExecutor({...e,request:r}),request:r}}}})),transport:r},new Proxy(i.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(e,t,r){if("then"!==t)return function(...n){var s,a;let o=t.toString(),l=Reflect.get(e,o,r);if(!l)throw new SQ(819e4,{notificationName:o});let c=l(...n);return s=i.transport,a=c,{async subscribe({abortSignal:e}){let t=await s({signal:e,...a});return function({abortSignal:e,dataChannelName:t,dataPublisher:r,errorChannelName:i}){let n=new Map;function s(e){for(let[t,r]of n.entries())r.__hasPolled?(n.delete(t),r.onError(e)):r.publishQueue.push({__type:1,err:e})}let a=new xi;e.addEventListener("abort",()=>{a.abort(),s(C4||=xs())});let o={signal:a.signal},l=xa;return r.on(i,e=>{l===xa&&(l=e,a.abort(),s(e))},o),r.on(t,e=>{n.forEach((t,r)=>{if(t.__hasPolled){let{onData:i}=t;n.set(r,{__hasPolled:!1,publishQueue:[]}),i(e)}else t.publishQueue.push({__type:0,data:e})})},o),{async *[Symbol.asyncIterator](){if(e.aborted)return;if(l!==xa)throw l;let t=Symbol();n.set(t,{__hasPolled:!1,publishQueue:[]});try{for(;;){let e=n.get(t);if(!e)throw new SQ(99e5);if(e.__hasPolled)throw new SQ(9900001);let r=e.publishQueue;try{if(r.length)for(let t of(e.publishQueue=[],r))if(0===t.__type)yield t.data;else throw t.err;else yield await new Promise((e,r)=>{n.set(t,{__hasPolled:!0,onData:e,onError:r})})}catch(e){if(e===(C4||=xs()))return;throw e}}}finally{n.delete(t)}}}}({abortSignal:e,dataChannelName:"notification",dataPublisher:t,errorChannelName:"error"})}}}}})}var x_=((CN=x_||{})[CN.Uninitialized=0]="Uninitialized",CN[CN.Initialized=1]="Initialized",CN[CN.Frozen=2]="Frozen",CN),xS=((CM=xS||{})[CM.MintTokens=0]="MintTokens",CM[CM.FreezeAccount=1]="FreezeAccount",CM[CM.AccountOwner=2]="AccountOwner",CM[CM.CloseAccount=3]="CloseAccount",CM),xI=((CU=xI||{})[CU.CreateAssociatedToken=0]="CreateAssociatedToken",CU[CU.CreateAssociatedTokenIdempotent=1]="CreateAssociatedTokenIdempotent",CU[CU.RecoverNestedAssociatedToken=2]="RecoverNestedAssociatedToken",CU),xx=((CD=xx||{})[CD.Mint=0]="Mint",CD[CD.Token=1]="Token",CD[CD.Multisig=2]="Multisig",CD),xT=((Cj=xT||{})[Cj.InitializeMint=0]="InitializeMint",Cj[Cj.InitializeAccount=1]="InitializeAccount",Cj[Cj.InitializeMultisig=2]="InitializeMultisig",Cj[Cj.Transfer=3]="Transfer",Cj[Cj.Approve=4]="Approve",Cj[Cj.Revoke=5]="Revoke",Cj[Cj.SetAuthority=6]="SetAuthority",Cj[Cj.MintTo=7]="MintTo",Cj[Cj.Burn=8]="Burn",Cj[Cj.CloseAccount=9]="CloseAccount",Cj[Cj.FreezeAccount=10]="FreezeAccount",Cj[Cj.ThawAccount=11]="ThawAccount",Cj[Cj.TransferChecked=12]="TransferChecked",Cj[Cj.ApproveChecked=13]="ApproveChecked",Cj[Cj.MintToChecked=14]="MintToChecked",Cj[Cj.BurnChecked=15]="BurnChecked",Cj[Cj.InitializeAccount2=16]="InitializeAccount2",Cj[Cj.SyncNative=17]="SyncNative",Cj[Cj.InitializeAccount3=18]="InitializeAccount3",Cj[Cj.InitializeMultisig2=19]="InitializeMultisig2",Cj[Cj.InitializeMint2=20]="InitializeMint2",Cj[Cj.GetAccountDataSize=21]="GetAccountDataSize",Cj[Cj.InitializeImmutableOwner=22]="InitializeImmutableOwner",Cj[Cj.AmountToUiAmount=23]="AmountToUiAmount",Cj[Cj.UiAmountToAmount=24]="UiAmountToAmount",Cj),xk=((CL=xk||{})[CL.Uninitialized=0]="Uninitialized",CL[CL.Initialized=1]="Initialized",CL[CL.Frozen=2]="Frozen",CL),xC=((CB=xC||{})[CB.MintTokens=0]="MintTokens",CB[CB.FreezeAccount=1]="FreezeAccount",CB[CB.AccountOwner=2]="AccountOwner",CB[CB.CloseAccount=3]="CloseAccount",CB[CB.TransferFeeConfig=4]="TransferFeeConfig",CB[CB.WithheldWithdraw=5]="WithheldWithdraw",CB[CB.CloseMint=6]="CloseMint",CB[CB.InterestRate=7]="InterestRate",CB[CB.PermanentDelegate=8]="PermanentDelegate",CB[CB.ConfidentialTransferMint=9]="ConfidentialTransferMint",CB[CB.TransferHookProgramId=10]="TransferHookProgramId",CB[CB.ConfidentialTransferFeeConfig=11]="ConfidentialTransferFeeConfig",CB[CB.MetadataPointer=12]="MetadataPointer",CB[CB.GroupPointer=13]="GroupPointer",CB[CB.GroupMemberPointer=14]="GroupMemberPointer",CB[CB.ScaledUiAmount=15]="ScaledUiAmount",CB[CB.Pause=16]="Pause",CB),xP=((CW=xP||{})[CW.Uninitialized=0]="Uninitialized",CW[CW.TransferFeeConfig=1]="TransferFeeConfig",CW[CW.TransferFeeAmount=2]="TransferFeeAmount",CW[CW.MintCloseAuthority=3]="MintCloseAuthority",CW[CW.ConfidentialTransferMint=4]="ConfidentialTransferMint",CW[CW.ConfidentialTransferAccount=5]="ConfidentialTransferAccount",CW[CW.DefaultAccountState=6]="DefaultAccountState",CW[CW.ImmutableOwner=7]="ImmutableOwner",CW[CW.MemoTransfer=8]="MemoTransfer",CW[CW.NonTransferable=9]="NonTransferable",CW[CW.InterestBearingConfig=10]="InterestBearingConfig",CW[CW.CpiGuard=11]="CpiGuard",CW[CW.PermanentDelegate=12]="PermanentDelegate",CW[CW.NonTransferableAccount=13]="NonTransferableAccount",CW[CW.TransferHook=14]="TransferHook",CW[CW.TransferHookAccount=15]="TransferHookAccount",CW[CW.ConfidentialTransferFee=16]="ConfidentialTransferFee",CW[CW.ConfidentialTransferFeeAmount=17]="ConfidentialTransferFeeAmount",CW[CW.ScaledUiAmountConfig=18]="ScaledUiAmountConfig",CW[CW.PausableConfig=19]="PausableConfig",CW[CW.PausableAccount=20]="PausableAccount",CW[CW.MetadataPointer=21]="MetadataPointer",CW[CW.TokenMetadata=22]="TokenMetadata",CW[CW.GroupPointer=23]="GroupPointer",CW[CW.TokenGroup=24]="TokenGroup",CW[CW.GroupMemberPointer=25]="GroupMemberPointer",CW[CW.TokenGroupMember=26]="TokenGroupMember",CW),xO=((CF=xO||{})[CF.CreateAssociatedToken=0]="CreateAssociatedToken",CF[CF.CreateAssociatedTokenIdempotent=1]="CreateAssociatedTokenIdempotent",CF[CF.RecoverNestedAssociatedToken=2]="RecoverNestedAssociatedToken",CF),xR=((Cz=xR||{})[Cz.Mint=0]="Mint",Cz[Cz.Token=1]="Token",Cz[Cz.Multisig=2]="Multisig",Cz),xN=((Cq=xN||{})[Cq.InitializeMint=0]="InitializeMint",Cq[Cq.InitializeAccount=1]="InitializeAccount",Cq[Cq.InitializeMultisig=2]="InitializeMultisig",Cq[Cq.Transfer=3]="Transfer",Cq[Cq.Approve=4]="Approve",Cq[Cq.Revoke=5]="Revoke",Cq[Cq.SetAuthority=6]="SetAuthority",Cq[Cq.MintTo=7]="MintTo",Cq[Cq.Burn=8]="Burn",Cq[Cq.CloseAccount=9]="CloseAccount",Cq[Cq.FreezeAccount=10]="FreezeAccount",Cq[Cq.ThawAccount=11]="ThawAccount",Cq[Cq.TransferChecked=12]="TransferChecked",Cq[Cq.ApproveChecked=13]="ApproveChecked",Cq[Cq.MintToChecked=14]="MintToChecked",Cq[Cq.BurnChecked=15]="BurnChecked",Cq[Cq.InitializeAccount2=16]="InitializeAccount2",Cq[Cq.SyncNative=17]="SyncNative",Cq[Cq.InitializeAccount3=18]="InitializeAccount3",Cq[Cq.InitializeMultisig2=19]="InitializeMultisig2",Cq[Cq.InitializeMint2=20]="InitializeMint2",Cq[Cq.GetAccountDataSize=21]="GetAccountDataSize",Cq[Cq.InitializeImmutableOwner=22]="InitializeImmutableOwner",Cq[Cq.AmountToUiAmount=23]="AmountToUiAmount",Cq[Cq.UiAmountToAmount=24]="UiAmountToAmount",Cq[Cq.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",Cq[Cq.InitializeTransferFeeConfig=26]="InitializeTransferFeeConfig",Cq[Cq.TransferCheckedWithFee=27]="TransferCheckedWithFee",Cq[Cq.WithdrawWithheldTokensFromMint=28]="WithdrawWithheldTokensFromMint",Cq[Cq.WithdrawWithheldTokensFromAccounts=29]="WithdrawWithheldTokensFromAccounts",Cq[Cq.HarvestWithheldTokensToMint=30]="HarvestWithheldTokensToMint",Cq[Cq.SetTransferFee=31]="SetTransferFee",Cq[Cq.InitializeConfidentialTransferMint=32]="InitializeConfidentialTransferMint",Cq[Cq.UpdateConfidentialTransferMint=33]="UpdateConfidentialTransferMint",Cq[Cq.ConfigureConfidentialTransferAccount=34]="ConfigureConfidentialTransferAccount",Cq[Cq.ApproveConfidentialTransferAccount=35]="ApproveConfidentialTransferAccount",Cq[Cq.EmptyConfidentialTransferAccount=36]="EmptyConfidentialTransferAccount",Cq[Cq.ConfidentialDeposit=37]="ConfidentialDeposit",Cq[Cq.ConfidentialWithdraw=38]="ConfidentialWithdraw",Cq[Cq.ConfidentialTransfer=39]="ConfidentialTransfer",Cq[Cq.ApplyConfidentialPendingBalance=40]="ApplyConfidentialPendingBalance",Cq[Cq.EnableConfidentialCredits=41]="EnableConfidentialCredits",Cq[Cq.DisableConfidentialCredits=42]="DisableConfidentialCredits",Cq[Cq.EnableNonConfidentialCredits=43]="EnableNonConfidentialCredits",Cq[Cq.DisableNonConfidentialCredits=44]="DisableNonConfidentialCredits",Cq[Cq.ConfidentialTransferWithFee=45]="ConfidentialTransferWithFee",Cq[Cq.InitializeDefaultAccountState=46]="InitializeDefaultAccountState",Cq[Cq.UpdateDefaultAccountState=47]="UpdateDefaultAccountState",Cq[Cq.Reallocate=48]="Reallocate",Cq[Cq.EnableMemoTransfers=49]="EnableMemoTransfers",Cq[Cq.DisableMemoTransfers=50]="DisableMemoTransfers",Cq[Cq.CreateNativeMint=51]="CreateNativeMint",Cq[Cq.InitializeNonTransferableMint=52]="InitializeNonTransferableMint",Cq[Cq.InitializeInterestBearingMint=53]="InitializeInterestBearingMint",Cq[Cq.UpdateRateInterestBearingMint=54]="UpdateRateInterestBearingMint",Cq[Cq.EnableCpiGuard=55]="EnableCpiGuard",Cq[Cq.DisableCpiGuard=56]="DisableCpiGuard",Cq[Cq.InitializePermanentDelegate=57]="InitializePermanentDelegate",Cq[Cq.InitializeTransferHook=58]="InitializeTransferHook",Cq[Cq.UpdateTransferHook=59]="UpdateTransferHook",Cq[Cq.InitializeConfidentialTransferFee=60]="InitializeConfidentialTransferFee",Cq[Cq.WithdrawWithheldTokensFromMintForConfidentialTransferFee=61]="WithdrawWithheldTokensFromMintForConfidentialTransferFee",Cq[Cq.WithdrawWithheldTokensFromAccountsForConfidentialTransferFee=62]="WithdrawWithheldTokensFromAccountsForConfidentialTransferFee",Cq[Cq.HarvestWithheldTokensToMintForConfidentialTransferFee=63]="HarvestWithheldTokensToMintForConfidentialTransferFee",Cq[Cq.EnableHarvestToMint=64]="EnableHarvestToMint",Cq[Cq.DisableHarvestToMint=65]="DisableHarvestToMint",Cq[Cq.WithdrawExcessLamports=66]="WithdrawExcessLamports",Cq[Cq.InitializeMetadataPointer=67]="InitializeMetadataPointer",Cq[Cq.UpdateMetadataPointer=68]="UpdateMetadataPointer",Cq[Cq.InitializeGroupPointer=69]="InitializeGroupPointer",Cq[Cq.UpdateGroupPointer=70]="UpdateGroupPointer",Cq[Cq.InitializeGroupMemberPointer=71]="InitializeGroupMemberPointer",Cq[Cq.UpdateGroupMemberPointer=72]="UpdateGroupMemberPointer",Cq[Cq.InitializeScaledUiAmountMint=73]="InitializeScaledUiAmountMint",Cq[Cq.UpdateMultiplierScaledUiMint=74]="UpdateMultiplierScaledUiMint",Cq[Cq.InitializePausableConfig=75]="InitializePausableConfig",Cq[Cq.Pause=76]="Pause",Cq[Cq.Resume=77]="Resume",Cq[Cq.InitializeTokenMetadata=78]="InitializeTokenMetadata",Cq[Cq.UpdateTokenMetadataField=79]="UpdateTokenMetadataField",Cq[Cq.RemoveTokenMetadataKey=80]="RemoveTokenMetadataKey",Cq[Cq.UpdateTokenMetadataUpdateAuthority=81]="UpdateTokenMetadataUpdateAuthority",Cq[Cq.EmitTokenMetadata=82]="EmitTokenMetadata",Cq[Cq.InitializeTokenGroup=83]="InitializeTokenGroup",Cq[Cq.UpdateTokenGroupMaxSize=84]="UpdateTokenGroupMaxSize",Cq[Cq.UpdateTokenGroupUpdateAuthority=85]="UpdateTokenGroupUpdateAuthority",Cq[Cq.InitializeTokenGroupMember=86]="InitializeTokenGroupMember",Cq);new Uint8Array([250,166,180,250,13,12,184,70]),new Uint8Array([121,113,108,39,54,51,0,4]),new Uint8Array([152,32,222,176,223,237,116,134]),new Uint8Array([210,225,30,162,88,184,77,141]),new Uint8Array([234,18,32,56,89,141,37,181]),new Uint8Array([108,37,171,143,248,30,18,110]),new Uint8Array([161,105,88,1,237,221,216,203]),new Uint8Array([221,233,49,45,181,202,220,200]),new Uint8Array([215,228,166,228,84,100,86,123]),_R.union([_R.string().transform(e=>e.replace(/[^0-9.-]+/g,"")),_R.number()]).pipe(_R.coerce.number().min(1e-4).max(0x3b9ac9ff));var xM=_R.enum(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","solana-devnet","solana","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia"]),xU=new Map([["abstract",2741],["abstract-testnet",11124],["base-sepolia",84532],["base",8453],["avalanche-fuji",43113],["avalanche",43114],["iotex",4689],["sei",1329],["sei-testnet",1328],["polygon",137],["polygon-amoy",80002],["peaq",3338],["story",1514],["educhain",41923],["skale-base-sepolia",0x135a9d92]]),xD=["solana-devnet","solana"];Object.fromEntries(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia",...xD].map(e=>[xU.get(e),e]));var xj={id:0x135a9d92,name:"SKALE Base Sepolia",nativeCurrency:{name:"Credits",symbol:"CREDITS",decimals:18},rpcUrls:{default:{http:["https://base-sepolia-testnet.skalenodes.com/v1/jubilant-horrible-ancha"]}},blockExplorers:{default:{name:"Blockscout",url:"https://base-sepolia-testnet-explorer.skalenodes.com",apiUrl:"https://base-sepolia-testnet-explorer.skalenodes.com/api"}}};function xL(e){let t=x$(e);return(0,_N.createPublicClient)({chain:t,transport:(0,EC.http)()}).extend(_M.publicActions)}function xB(){return xL("base-sepolia")}function xW(){return xL("avalanche-fuji")}function xF(e,t){let r=x$(e),i=(0,Ek.createWalletClient)({chain:r,transport:(0,EC.http)(),account:function(e,t={}){let{nonceManager:r}=t,i=(0,na.toHex)(Sy.secp256k1.getPublicKey(e.slice(2),!1));return{...function(e){if("string"==typeof e){if(!(0,no.isAddress)(e,{strict:!1}))throw new _6.InvalidAddressError({address:e});return{address:e,type:"json-rpc"}}if(!(0,no.isAddress)(e.address,{strict:!1}))throw new _6.InvalidAddressError({address:e.address});return{address:e.address,nonceManager:e.nonceManager,sign:e.sign,signAuthorization:e.signAuthorization,signMessage:e.signMessage,signTransaction:e.signTransaction,signTypedData:e.signTypedData,source:"custom",type:"local"}}({address:(0,Sg.publicKeyToAddress)(i),nonceManager:r,sign:async({hash:t})=>Sw({hash:t,privateKey:e,to:"hex"}),signAuthorization:async t=>Sb({...t,privateKey:e}),signMessage:async({message:t})=>SE({message:t,privateKey:e}),signTransaction:async(t,{serializer:r}={})=>S_({privateKey:e,transaction:t,serializer:r}),signTypedData:async t=>SI({...t,privateKey:e})}),publicKey:i,source:"privateKey"}}(t)});return xJ(r)?i.extend(_M.publicActions).extend(e=>({sendTransaction:t=>SG(e,t),signTransaction:t=>SV(e,t),deployContract:t=>(function(e,t){let{abi:r,args:i,bytecode:n,deploymentType:s,salt:a,...o}=t,l=function(e){let{abi:t,args:r,bytecode:i,deploymentType:n,salt:s}=e;if(!r||0===r.length){let{functionName:e,argsContractDeployer:t}=SN(n,s??ST.zeroHash,(0,na.toHex)(Sc(i)),"0x");return(0,SP.encodeFunctionData)({abi:SO,functionName:e,args:t})}let a=t.find(e=>"type"in e&&"constructor"===e.type);if(!a)throw new Sk.AbiConstructorNotFoundError({docsPath:SR});if(!("inputs"in a)||!a.inputs||0===a.inputs.length)throw new Sk.AbiConstructorParamsNotFoundError({docsPath:SR});let o=(0,SC.encodeAbiParameters)(a.inputs,r),{functionName:l,argsContractDeployer:c}=SN(n,s??ST.zeroHash,(0,na.toHex)(Sc(i)),o);return(0,SP.encodeFunctionData)({abi:SO,functionName:l,args:c})}({abi:r,args:i,bytecode:n,deploymentType:s,salt:a});return o.factoryDeps=o.factoryDeps||[],o.factoryDeps.includes(n)||o.factoryDeps.push(n),SJ(e,{...o,data:l,to:"create2"===s||"create2Account"===s?"0x0000000000000000000000000000000000010000":"0x0000000000000000000000000000000000008006"})})(e,t),writeContract:t=>(0,Sx.writeContract)(Object.assign(e,{sendTransaction:t=>SG(e,t)}),t)})):i.extend(_M.publicActions)}function xz(e){return xF("base-sepolia",e)}function xq(e){return xF("avalanche-fuji",e)}function xH(e){return"object"==typeof e&&null!==e&&"chain"in e&&"transport"in e}function xK(e){return"object"==typeof e&&null!==e&&"string"==typeof e.address&&"string"==typeof e.type&&"function"==typeof e.sign&&"function"==typeof e.signMessage&&"function"==typeof e.signTypedData&&"function"==typeof e.signTransaction}function x$(e){if(!e)throw Error("NETWORK environment variable is not set");switch(e){case"abstract":return Su;case"abstract-testnet":return Sh;case"base":return _B;case"base-sepolia":return _U.baseSepolia;case"avalanche":return _K;case"avalanche-fuji":return _j;case"sei":return _W;case"sei-testnet":return _F;case"polygon":return _z;case"polygon-amoy":return _q;case"peaq":return _H;case"story":return Sp;case"educhain":return Sf;case"iotex":return _V;case"iotex-testnet":return _$;case"skale-base-sepolia":return xj;default:throw Error(`Unsupported network: ${e}`)}}var xV=new Set([2741,11124]);function xJ(e){return xV.has(e.id)}function xZ(e){return xr(e||"https://api.devnet.solana.com")}function xG(e){return xr(e||"https://api.mainnet-beta.solana.com")}function xY(e,t){if("solana-devnet"===e)return xZ(t);if("solana"===e)return xG(t);throw Error("Invalid network")}function xQ(e,t){if("solana-devnet"===e)return xA(t?xX(t):"wss://api.devnet.solana.com");if("solana"===e)return xA(t?xX(t):"wss://api.mainnet-beta.solana.com");throw Error("Invalid network")}function xX(e){return e.startsWith("http")?e.replace("http","ws"):e}function x0(e){if(!xD.find(t=>t===e))throw Error(`Unsupported SVM network: ${e}`);return xY(e)}async function x1(e){let t=sl.base58.decode(e);if(64===t.length)return await IW(t);if(32===t.length)return await IF(t);throw Error(`Unexpected key length: ${t.length}. Expected 32 or 64 bytes.`)}function x2(e){return"object"==typeof e&&null!==e&&(IL(e)||Ij(e)||"signAndSendTransactions"in e&&"function"==typeof e.signAndSendTransactions)}EM({},{authorizationPrimaryType:()=>x5,authorizationTypes:()=>x3,config:()=>EU,createClientAvalancheFuji:()=>xW,createClientSepolia:()=>xB,createConnectedClient:()=>xL,createSigner:()=>xF,createSignerAvalancheFuji:()=>xq,createSignerSepolia:()=>xz,getChainFromNetwork:()=>x$,isAccount:()=>xK,isSignerWallet:()=>xH,isZkStackChain:()=>xJ,usdcABI:()=>ED});var x3={TransferWithAuthorization:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"validAfter",type:"uint256"},{name:"validBefore",type:"uint256"},{name:"nonce",type:"bytes32"}]},x5="TransferWithAuthorization";EM({},{SvmAddressRegex:()=>x8});var x8=/^[1-9A-HJ-NP-Za-km-z]{32,44}$/,x6=/^0x[0-9a-fA-F]{40}$/,x4=/^0x[a-fA-F0-9]{40}|[A-Za-z0-9][A-Za-z0-9-]{0,34}[A-Za-z0-9]$/,x7=["exact"],x9=[1],Te=["insufficient_funds","invalid_exact_evm_payload_authorization_valid_after","invalid_exact_evm_payload_authorization_valid_before","invalid_exact_evm_payload_authorization_value","invalid_exact_evm_payload_signature","invalid_exact_evm_payload_undeployed_smart_wallet","invalid_exact_evm_payload_recipient_mismatch","invalid_exact_svm_payload_transaction","invalid_exact_svm_payload_transaction_amount_mismatch","invalid_exact_svm_payload_transaction_create_ata_instruction","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_payee","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_asset","invalid_exact_svm_payload_transaction_instructions","invalid_exact_svm_payload_transaction_instructions_length","invalid_exact_svm_payload_transaction_instructions_compute_limit_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction_too_high","invalid_exact_svm_payload_transaction_instruction_not_spl_token_transfer_checked","invalid_exact_svm_payload_transaction_instruction_not_token_2022_transfer_checked","invalid_exact_svm_payload_transaction_fee_payer_included_in_instruction_accounts","invalid_exact_svm_payload_transaction_fee_payer_transferring_funds","invalid_exact_svm_payload_transaction_not_a_transfer_instruction","invalid_exact_svm_payload_transaction_receiver_ata_not_found","invalid_exact_svm_payload_transaction_sender_ata_not_found","invalid_exact_svm_payload_transaction_simulation_failed","invalid_exact_svm_payload_transaction_transfer_to_incorrect_ata","invalid_network","invalid_payload","invalid_payment_requirements","invalid_scheme","invalid_payment","payment_expired","unsupported_scheme","invalid_x402_version","invalid_transaction_state","invalid_x402_version","settle_exact_svm_block_height_exceeded","settle_exact_svm_transaction_confirmation_timed_out","unsupported_scheme","unexpected_settle_error","unexpected_verify_error"],Tt=e=>Number.isInteger(Number(e))&&Number(e)>=0,Tr=_R.string().regex(x6).or(_R.string().regex(x8)),Ti=_R.string().regex(x4).or(_R.string().regex(x8)),Tn=_R.object({scheme:_R.enum(x7),network:xM,maxAmountRequired:_R.string().refine(Tt),resource:_R.string().url(),description:_R.string(),mimeType:_R.string(),outputSchema:_R.record(_R.any()).optional(),payTo:Tr,maxTimeoutSeconds:_R.number().int(),asset:Ti,extra:_R.record(_R.any()).optional()}),Ts=_R.object({from:_R.string().regex(x6),to:_R.string().regex(x6),value:_R.string().refine(Tt).refine(e=>e.length<=18),validAfter:_R.string().refine(Tt),validBefore:_R.string().refine(Tt),nonce:_R.string().regex(/^0x[0-9a-fA-F]{64}$/)}),Ta=_R.object({signature:_R.string().regex(/^0x[0-9a-fA-F]+$/),authorization:Ts}),To=_R.object({transaction:_R.string().regex(/^[A-Za-z0-9+/]*={0,2}$/)}),Tl=_R.object({x402Version:_R.number().refine(e=>x9.includes(e)),scheme:_R.enum(x7),network:xM,payload:_R.union([Ta,To])});_R.object({x402Version:_R.number().refine(e=>x9.includes(e)),error:_R.enum(Te).optional(),accepts:_R.array(Tn).optional(),payer:_R.string().regex(x4).optional()});var Tc=_R.enum(["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"]),Td=_R.object({type:_R.literal("http"),method:Tc,queryParams:_R.record(_R.string(),_R.string()).optional(),bodyType:_R.enum(["json","form-data","multipart-form-data","text","binary"]).optional(),bodyFields:_R.record(_R.string(),_R.any()).optional(),headerFields:_R.record(_R.string(),_R.any()).optional()});_R.discriminatedUnion("type",[Td]);var Tu=_R.object({resource:_R.string(),type:_R.enum(["http"]),x402Version:_R.number().refine(e=>x9.includes(e)),accepts:_R.array(Tn),lastUpdated:_R.date(),metadata:_R.record(_R.any()).optional()});_R.object({paymentPayload:Tl,paymentRequirements:Tn}),_R.object({paymentPayload:Tl,paymentRequirements:Tn}),_R.object({isValid:_R.boolean(),invalidReason:_R.enum(Te).optional(),payer:Tr.optional()}),_R.object({success:_R.boolean(),errorReason:_R.enum(Te).optional(),payer:Tr.optional(),transaction:_R.string().regex(x4),network:xM}),_R.object({type:_R.string().optional(),limit:_R.number().optional(),offset:_R.number().optional()}),_R.object({x402Version:_R.number().refine(e=>x9.includes(e)),items:_R.array(Tu),pagination:_R.object({limit:_R.number(),offset:_R.number(),total:_R.number()})});var Th=_R.object({x402Version:_R.number().refine(e=>x9.includes(e)),scheme:_R.enum(x7),network:xM,extra:_R.record(_R.any()).optional()});function Tp(e){try{let t=S6({getSizeFromValue:e=>{try{return atob(e).length}catch{throw new SQ(8078012,{alphabet:Ii,base:64,value:e})}},write(e,t,r){try{let i=atob(e).split("").map(e=>e.charCodeAt(0));return t.set(i,r),i.length+r}catch{throw new SQ(8078012,{alphabet:Ii,base:64,value:e})}}}).encode(e.transaction);return Ir(Ik([["signatures",IS(It(IT(),64),{size:Ib()})],["messageBytes",IT()]]),IN).decode(t)}catch(e){throw console.error("error",e),Error("invalid_exact_svm_payload_transaction")}}function Tf(e){let t,r=Ir(Ik([["version",IO()],["header",Ik([["numSignerAccounts",IP()],["numReadonlySignerAccounts",IP()],["numReadonlyNonSignerAccounts",IP()]])],["staticAccounts",IS(Ia(),{size:Ib()})],["lifetimeToken",It((t="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",S4({read(e,r){let i=0===r?e:e.slice(r);if(0===i.length)return["",0];let n=i.findIndex(e=>0!==e);n=-1===n?i.length:n;let s=t[0].repeat(n);return n===i.length?[s,e.length]:[s+function(e,t){let r=BigInt(t.length),i=[];for(;e>0n;)i.unshift(t[Number(e%r)]),e/=r;return i.join("")}(i.slice(n).reduce((e,t)=>256n*e+BigInt(t),0n),t),e.length]}})),32)],["instructions",IS((!C5&&(C5=Ir(Ik([["programAddressIndex",Iv()],["accountIndices",IS(Iv(),{size:Ib()})],["data",function(e,t){let r=(r,i)=>{let[n,s]=t.read(r,i),a=Number(n);return((i=s)>0||r.length>a)&&(r=r.slice(i,i+a)),S9("addDecoderSizePrefix",a,r),[e.decode(r),i+a]};if(S7(t)&&S7(e))return S4({...e,fixedSize:t.fixedSize+e.fixedSize,read:r});let i=S7(t)?t.fixedSize:t.maxSize??null,n=S7(e)?e.fixedSize:e.maxSize??null,s=null!==i&&null!==n?i+n:null;return S4({...e,...null!==s?{maxSize:s}:{},read:r})}(IT(),Ib())]]),e=>{if(e.accountIndices.length&&e.data.byteLength)return e;let{accountIndices:t,data:r,...i}=e;return{...i,...t.length?{accountIndices:t}:null,...r.byteLength?{data:r}:null}})),C5),{size:Ib()})],["addressTableLookups",IS(function(){if(!C2){let e=IS(Iv(),{size:Ib()});C2=Ik([["lookupTableAddress",Ia()],["writableIndexes",e],["readonlyIndexes",e]])}return C2}(),{size:Ib()})]]),({addressTableLookups:e,...t})=>"legacy"!==t.version&&e?.length?{...t,addressTableLookups:e}:t).decode(e.messageBytes),i=r.staticAccounts??[];for(let e of r.instructions??[]){let t=i[e.programAddressIndex].toString();if(t==="TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA".toString()||t==="TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb".toString()){let t=e.accountIndices??[];if(t.length>=4){let e=i[t[3]].toString();if(e)return e}}}return""}async function Ty(e,t,r){var i,n;let s,a,o,l,c=(i=await Tg(e,t),l=(a=IE((s=(n=[["signatures",function(){var e,t=function(e,t={}){let r=t.size??((e={})=>{var t;return S6({fixedSize:(t={config:e,name:"u32",range:[0,Number("0xffffffff")],set:(e,t,r)=>e.setUint32(0,Number(t),r),size:4}).size,write(e,r,i){t.range&&Iy(t.name,t.range[0],t.range[1],e);let n=new ArrayBuffer(t.size);return t.set(new DataView(n),e,Im(t.config)),r.set(new Uint8Array(n),i),i+t.size}})})(),i=II(r,IA(e)),n=II(r,I_(e))??void 0;return S6({...null!==i?{fixedSize:i}:{getSizeFromValue:t=>("object"==typeof r?S8(t.length,r):0)+[...t].reduce((t,r)=>t+S8(r,e),0),maxSize:n},write:(t,i,n)=>("number"==typeof r&&function(e,t,r){if(t!==r)throw new SQ(8078007,{actual:r,codecDescription:e,expected:t})}("array",r,t.length),"object"==typeof r&&(n=r.write(t.length,i,n)),t.forEach(t=>{n=e.write(t,i,n)}),n)})}((e=Ix(),S6({fixedSize:64,write:(t,r,i)=>{let n=e.encode(t),s=n.length>64?n.slice(0,64):n;return r.set(s,i),i+64}})),{size:S6({getSizeFromValue:e=>e<=127?1:e<=16383?2:3,maxSize:3,write:(e,t,r)=>{Iy("shortU16",0,65535,e);let i=[0];for(let t=0;;t+=1){let r=Number(e)>>7*t;if(0===r)break;let n=127&r;i[t]=n,t>0&&(i[t-1]|=128)}return t.set(i,r),r+i.length}})});return S6({...!S7(t)?{...t,getSizeFromValue:e=>t.getSizeFromValue(IR(e))}:t,write:(e,r,i)=>t.write(IR(e),r,i)})}()],["messageBytes",Ix()]]).map(([,e])=>e)).map(IA)),o=IE(s.map(I_))??void 0,S6({...null===a?{getSizeFromValue:e=>n.map(([t,r])=>S8(e[t],r)).reduce((e,t)=>e+t,0),maxSize:o}:{fixedSize:a},write:(e,t,r)=>(n.forEach(([i,n])=>{r=n.write(e[i],t,r)}),r)})).encode(i),S4({read:(e,t=0)=>[btoa(String.fromCharCode(...e.slice(t))),e.length]}).decode(l));return await r.simulateTransaction(c,{sigVerify:!0,replaceRecentBlockhash:!1,commitment:"confirmed",encoding:"base64",accounts:void 0,innerInstructions:void 0,minContextSlot:void 0}).send()}async function Tg(e,t){if(Ij(e)){let[r]=await e.modifyAndSignTransactions([t]);if(!r)throw Error("transaction_signer_failed_to_return_transaction");return r}if(IL(e)){var r,i;let[n]=await e.signTransactions([t]);if(!n)throw Error("transaction_signer_failed_to_return_signatures");return r=t,i=n,Object.freeze({...r,signatures:Object.freeze({...r.signatures,...i})})}throw Error("transaction_signer_must_support_offline_signing")}_R.object({kinds:_R.array(Th)}),EM({},{createDevnetRpcClient:()=>xZ,createMainnetRpcClient:()=>xG,createSignerFromBase58:()=>x1,createSvmConnectedClient:()=>x0,decodeTransactionFromPayload:()=>Tp,getRpcClient:()=>xY,getRpcSubscriptions:()=>xQ,getTokenPayerFromTransaction:()=>Tf,isSignerWallet:()=>x2,signAndSimulateTransaction:()=>Ty,signTransactionWithSigner:()=>Tg}),_R.object({paymentHeader:_R.string(),paymentRequirements:Tn});var Tm=((CH=Tm||{})[CH.RequestUnits=0]="RequestUnits",CH[CH.RequestHeapFrame=1]="RequestHeapFrame",CH[CH.SetComputeUnitLimit=2]="SetComputeUnitLimit",CH[CH.SetComputeUnitPrice=3]="SetComputeUnitPrice",CH[CH.SetLoadedAccountsDataSizeLimit=4]="SetLoadedAccountsDataSizeLimit",CH);e.s([],307485),e.i(640692),e.i(237446);class Tw{static parse(e){try{return new Tw(e)}catch(e){return null}}static throwIfNotWellFormedJwt(e){return ri(e),e}get subject(){return this._decoded.sub}get expiration(){return this._decoded.exp}get issuer(){return this._decoded.iss}get audience(){return this._decoded.aud}isExpired(e=0){return Date.now()>=1e3*(this.expiration-e)}constructor(e){this.value=e,this._decoded=ri(e)}}class Tb extends Tw{static parse(e){try{return new Tb(e)}catch(e){return null}}get appId(){return this._decoded.aid?this._decoded.aid:this.audience}}let Tv=({style:e,...t})=>(0,B.jsxs)("svg",{viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{height:"28px",width:"28px",...e},...t,children:[(0,B.jsx)("rect",{width:"1024",height:"1024",fill:"#0052FF",rx:100,ry:100}),(0,B.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 512C152 710.823 313.177 872 512 872C710.823 872 872 710.823 872 512C872 313.177 710.823 152 512 152C313.177 152 152 313.177 152 512ZM420 396C406.745 396 396 406.745 396 420V604C396 617.255 406.745 628 420 628H604C617.255 628 628 617.255 628 604V420C628 406.745 617.255 396 604 396H420Z",fill:"white"})]}),TE="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PScwIDAgMTAyNCAxMDI0JyBmaWxsPSdub25lJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHN0eWxlPSdoZWlnaHQ6MjhweDt3aWR0aDoyOHB4Jz48cmVjdCB3aWR0aD0nMTAyNCcgaGVpZ2h0PScxMDI0JyBmaWxsPScjMDA1MkZGJyByeD0nMTAwJyByeT0nMTAwJz48L3JlY3Q+PHBhdGggZmlsbC1ydWxlPSdldmVub2RkJyBjbGlwLXJ1bGU9J2V2ZW5vZGQnIGQ9J00xNTIgNTEyQzE1MiA3MTAuODIzIDMxMy4xNzcgODcyIDUxMiA4NzJDNzEwLjgyMyA4NzIgODcyIDcxMC44MjMgODcyIDUxMkM4NzIgMzEzLjE3NyA3MTAuODIzIDE1MiA1MTIgMTUyQzMxMy4xNzcgMTUyIDE1MiAzMTMuMTc3IDE1MiA1MTJaTTQyMCAzOTZDNDA2Ljc0NSAzOTYgMzk2IDQwNi43NDUgMzk2IDQyMFY2MDRDMzk2IDYxNy4yNTUgNDA2Ljc0NSA2MjggNDIwIDYyOEg2MDRDNjE3LjI1NSA2MjggNjI4IDYxNy4yNTUgNjI4IDYwNFY0MjBDNjI4IDQwNi43NDUgNjE3LjI1NSAzOTYgNjA0IDM5Nkg0MjBaJyBmaWxsPSd3aGl0ZSc+PC9wYXRoPjwvc3ZnPg==",TA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAALZJREFUaEPtmjEOhDAMBNc/O14GvOzys3CAKK6eAlmaVGl2Zc+kTOU685vkc9/bnD2prZK5/TZY24z9P+g4F5hNh7/GdoG37WlAA5CATwgCxHENYISwQAMQII5rACOEBRqAAHFcAxghLNAABIjjGsAIYYEGIEAc1wBGCAs0AAHiuAYwQligAQgQxzWAEcICDUCAOK4BjBAWaAACxHENYISwQAMQII6fBjr+VHkW3+u+tfyxMpJaDgYzYxb/ALZVAAAAAElFTkSuQmCC";class T_ extends ru.E{async initialize(){await this.importPromise,await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:TA,id:"com.coinbase.wallet"}}async promptConnection(){try{await this.importPromise;let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new rp.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([e[0]])}catch(e){throw(0,rf.f)(e)}}constructor(t,r,n,s,a){super("base_account",t,r,n),this.connectorType="base_account",this.walletClientType="base_account",this.displayName="Base",this.setBaseAccountSdk=a,this.proxyProvider=new ru.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.baseAccountConfig={...s,appChainIds:[r.id].concat(t.map(e=>e.id))},i?(this.proxyProvider.setWalletProvider(i.getProvider()),this.setBaseAccountSdk(i)):this.importPromise=e.A(39232).then(({createBaseAccountSDK:e})=>{i=e(this.baseAccountConfig),this.proxyProvider.setWalletProvider(i.getProvider()),this.setBaseAccountSdk(i)}).catch(console.error)}}let TS=[1,0xaa36a7,137,10,8453,84532,42161,7777777,43114,56];class TI extends ru.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:TE,id:"com.coinbase.wallet"}}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new rp.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([e[0]])}catch(e){throw(0,rf.f)(e)}}updateConnectionPreference(e){this.coinbaseWalletConfig={...this.coinbaseWalletConfig,preference:{...this.coinbaseWalletConfig.preference,options:e}},this.walletClientType="smartWalletOnly"===e?"coinbase_smart_wallet":"coinbase_wallet",n=nr({...this.coinbaseWalletConfig}),this.proxyProvider.setWalletProvider(n.getProvider())}constructor(e,t,r,i){if(super("coinbase_wallet",e,t,r),this.connectorType="coinbase_wallet",this.displayName="Coinbase Wallet",this.proxyProvider=new ru.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.coinbaseWalletConfig={...i,appChainIds:[t.id].concat(e.map(e=>e.id))},this.walletClientType="smartWalletOnly"===this.coinbaseWalletConfig.preference?.options?"coinbase_smart_wallet":"coinbase_wallet","coinbase_smart_wallet"===this.walletClientType&&(this.displayName="Coinbase Smart Wallet"),!n){let e="eoaOnly"!==this.coinbaseWalletConfig.preference?.options?(this.coinbaseWalletConfig.appChainIds??[]).filter(e=>!TS.includes(e)):[];e.length>0&&!e.every(e=>z.DEFAULT_SUPPORTED_CHAIN_IDS.has(e))&&console.info(`The configured chains are not supported by Coinbase Smart Wallet: ${e.join(", ")}`),n=nr(this.coinbaseWalletConfig)}this.proxyProvider.setWalletProvider(n.getProvider())}}let Tx=({...e})=>(0,B.jsx)("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:(0,B.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.37126 11.0323C2.37126 12.696 3.90598 13.4421 5.40654 13.4468C8.91753 13.4468 12.8021 11.2897 12.7819 7.67984C12.7673 5.07728 10.3748 2.86167 7.54357 2.88296C4.8495 2.88296 2.21821 4.6411 2.21803 7.03628C2.21803 7.67951 2.58722 8.30178 3.55231 8.37184C2.74763 9.16826 2.37126 10.1225 2.37126 11.0323ZM7.55283 8.68012C8.11562 8.68012 8.57186 8.13217 8.57186 7.45624C8.57186 6.78032 8.11562 6.23237 7.55283 6.23237C6.99003 6.23237 6.53379 6.78032 6.53379 7.45624C6.53379 8.13217 6.99003 8.68012 7.55283 8.68012ZM10.4747 8.68012C11.0375 8.68012 11.4937 8.13217 11.4937 7.45625C11.4937 6.78032 11.0375 6.23237 10.4747 6.23237C9.91186 6.23237 9.45562 6.78032 9.45562 7.45625C9.45562 8.13217 9.91186 8.68012 10.4747 8.68012Z",fill:e.color||"var(--privy-color-foreground-3)"})});class TT extends ru.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return await this.isConnected()?(await this.proxyProvider.request({method:"wallet_switchEthereumChain",params:[(0,ru.t)(e?.chainId||"0x1")]}),this.getConnectedWallet()):null}get walletBranding(){return{name:"Privy Wallet",icon:Tx,id:"io.privy.wallet"}}disconnect(){this.connected=!1}async promptConnection(){}constructor({provider:e,chains:t,defaultChain:r,rpcConfig:i,imported:n,walletIndex:s}){super("privy",t,r,i),this.connectorType="embedded",this.proxyProvider=e,this.walletIndex=s,n&&(this.connectorType="embedded_imported"),this.subscribeListeners()}}async function Tk(){let e=Po();return e?e.getAccessToken():Promise.resolve(rf.u.get(nn.P)||rf.u.get(nn.C)||null)}let TC=["eth_sign","eth_populateTransactionRequest","eth_signTransaction","personal_sign","eth_signTypedData_v4","csw_signUserOperation","secp256k1_sign"];function TP(e){return e?{"privy-ui":"t"}:void 0}class TO{async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new rp.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(nR,{email:this.meta.email,code:this.meta.emailCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new rp.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(nN,{email:this.meta.email,code:this.meta.emailCode})}catch(e){throw(0,rp.f)(e)}}async sendCodeEmail({email:e,captchaToken:t,withPrivyUi:r}){if(!this.api)throw new rp.a("Auth flow has no API instance");if(e&&(this.meta.email=e),t&&(this.meta.captchaToken=t),!this.meta.email)throw new rp.a("Email must be set when initialzing authentication.");let i=TP(r);try{return await this.api.post(nO,{email:this.meta.email,token:this.meta.captchaToken},{headers:{...i}})}catch(e){throw(0,rp.f)(e)}}constructor({email:e,captchaToken:t,disableSignup:r}){this.meta={email:e,captchaToken:t,disableSignup:r??!1}}}class TR extends TO{async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode||!this.meta.oldAddress)throw new rp.a("Email, email code, and an old email address must be set prior to calling update.");try{return await this.api.post(nU,{oldAddress:this.meta.oldAddress,newAddress:this.meta.email,code:this.meta.emailCode})}catch(e){throw(0,rp.f)(e)}}constructor(e,t,r){super({email:t,captchaToken:r}),this.meta={email:t,captchaToken:r,oldAddress:e,disableSignup:!1}}}class TN{execute(e){return null===this.promise&&(this.promise=(async()=>{try{return await this.fn(e)}finally{this.promise=null}})()),this.promise}constructor(e){this.promise=null,this.fn=e}}class TM{get meta(){return this._meta}async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new rp.a("Auth flow must be initialized first");try{let e=await this.api.post(nx,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});if(!e)throw new rp.a("No response from authentication");return e}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(nT,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid})}catch(e){throw(0,rp.f)(e)}}async _startChannelOnce(){if(!this.api)throw new rp.a("Auth flow has no API instance");let e=await this.api.post(nI,{token:this.captchaToken});ns.isMobile&&!ns.isIOS&&e.connect_uri&&(0,so.o)(e.connect_uri,"_blank"),this._meta={...this._meta,connectUri:e.connect_uri,channelToken:e.channel_token}}async initializeFarcasterConnect(){if(!this.api)throw new rp.a("Auth flow has no API instance");await this.startChannelOnce.execute()}async _pollForReady(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new rp.a("Auth flow must be initialized first");let e=await this.api.get(nk,{headers:{"farcaster-channel-token":this.meta.channelToken}});return"completed"===e.state&&(this.message=e.message,this.signature=e.signature,this.fid=e.fid,!0)}constructor(e,t=!1){this._meta={disableSignup:!1},this.captchaToken=e,this.startChannelOnce=new TN(this._startChannelOnce.bind(this)),this.pollForReady=new TN(this._pollForReady.bind(this)),this._meta.disableSignup=t}}function TU(){return"undefined"!=typeof window&&"chrome-extension:"===window.location.protocol&&"chrome"in window}function TD(){if(!TU())return;let e=window.chrome;return e?.runtime?.id}function Tj(){if(!TU())return!1;let e=window.chrome;return"function"==typeof e?.identity?.launchWebAuthFlow}async function TL(e){return new Promise((t,r)=>{Tj()?window.chrome.identity.launchWebAuthFlow({url:e,interactive:!0},async e=>{try{let r=function(){if(!TU())return;let e=window.chrome;return e?.runtime?.lastError?.message}();if(r||!e){let e=`WebAuthFlow failed: ${r||"Response URI missing"}`;throw Error(e)}let i=new URL(e),n=TD();if(!n)throw Error("Invalid extension context");if("chrome-extension:"===i.protocol){if(i.hostname!==n)throw Error("Invalid responseUri origin")}else{if("https:"!==i.protocol)throw Error("Invalid responseUri protocol");{let e=i.hostname.split(".");if(3!==e.length||"chromiumapp"!==e[1]||"org"!==e[2]||e[0]!==n)throw Error("Invalid responseUri origin")}}let s=i.searchParams.get("privy_oauth_state"),a=i.searchParams.get("privy_oauth_code");if(!s||!a)throw Error("Invalid responseUri - missing required parameters");t({privyOAuthState:s,privyOAuthCode:a})}catch(e){r(e)}}):r(Error("Chrome identity API not available"))})}function TB(e){return crypto.getRandomValues(new Uint8Array(e))}function TW(){return e_.encode(TB(36))}function TF(){return TW()}async function Tz(e,t="S256"){if("S256"!=t)return e;{let t=await async function(e){let t=(new TextEncoder).encode(e);return new Uint8Array(await crypto.subtle.digest("SHA-256",t))}(e);return e_.encode(t)}}class Tq{addCaptchaToken(e){this.meta.captchaToken=e}isActive(){return!!(this.meta.authorizationCode&&this.meta.stateCode&&this.meta.provider)}async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new rp.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling authenticate.");if("undefined"===this.meta.authorizationCode)throw new rp.a("User denied confirmation during OAuth flow");let e=function(){let e=rf.u.get(nn.a);if(!e)throw new rp.a("Authentication error.");return e}();try{let t=await this.api.post(nH,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:e,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});return rf.u.del(nn.a),rf.u.del(nn.H),rf.u.del(nn.O),t}catch(t){let e=(0,rp.f)(t);if(e.privyErrorCode)throw new rp.a(e.message||"Invalid code during OAuth flow.",void 0,e.privyErrorCode);if("User denied confirmation during OAuth flow"===e.message)throw new rp.a("Invalid code during oauth flow.",void 0,rp.b.OAUTH_USER_DENIED);throw new rp.a("Invalid code during OAuth flow.",void 0,rp.b.UNKNOWN_AUTH_ERROR)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new rp.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling link.");if("undefined"===this.meta.authorizationCode)throw new rp.a("User denied confirmation during OAuth flow");let e=rf.u.get(nn.a);if(!e)throw new rp.a("Authentication error.");try{let t=await this.api.post(nK,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:e});return rf.u.del(nn.a),t}catch(e){throw(0,rp.f)(e)}}async getAuthorizationUrl(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.provider)throw new rp.a("Provider must be set when initializing OAuth authentication.");let e=TW();rf.u.put(nn.a,e);let t=TF();rf.u.put(nn.S,t);let r=await Tz(e);this.meta.withPrivyUi||rf.u.put(nn.H,!0),this.meta.disableSignup?rf.u.put(nn.O,!0):rf.u.del(nn.O);let i=TP(this.meta.withPrivyUi),n=window.location.href,s=function(){let e=TD();if(e)return`https://${e}.chromiumapp.org`}();s&&(n=s);try{return await this.api.post(nq,{provider:this.meta.provider,redirect_to:this.meta.customOAuthRedirectUrl||n,token:this.meta.captchaToken,code_challenge:r,state_code:t},{headers:{...i}})}catch(e){throw(0,rp.f)(e)}}constructor(e){this.meta=e}}function TH(){let e=new URL(window.location.href);e.searchParams.delete("privy_oauth_code"),e.searchParams.delete("privy_oauth_provider"),e.searchParams.delete("privy_oauth_state"),rf.u.del(nn.S),window.history.replaceState({},"",e)}class TK{async initRegisterFlow(e){if(!this.api)throw new rp.a("Auth flow has no API instance");this.authenticateForRegistration=!0,this.meta.initRegisterResponse=await this.initRegisterOnce.execute(e)}async initAuthenticationFlow(e){if(!this.api)throw new rp.a("Auth flow has no API instance");this.authenticateForRegistration=!1,this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute(e)}async initLinkFlow(){if(!this.api)throw new rp.a("Auth flow has no API instance");this.meta.initLinkResponse=await this.initLinkOnce.execute()}async register(){let t=await e.A(492887);if(!this.api)throw new rp.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new rp.a("WebAuthn is not supported in this browser");this.meta.initRegisterResponse||(this.meta.initRegisterResponse=await this.initRegisterOnce.execute());try{let e=this.meta.initRegisterResponse.options,r=await t.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(e)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(nX,{relying_party:this.meta.initRegisterResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(r)})}catch(e){if("NotAllowedError"===e.name)throw new rp.a("Passkey request timed out or rejected by user.",void 0,rp.b.PASSKEY_NOT_ALLOWED);throw(0,rp.f)(e)}}async authenticate(){if(this.authenticateForRegistration)return this.register();let t=await e.A(492887);if(!this.api)throw new rp.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new rp.a("WebAuthn is not supported in this browser");this.meta.initAuthenticateResponse||(this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute());let r=this.meta.allowedCredentialsIds?.map(e=>({type:"public-key",id:e}))??this.meta.initAuthenticateResponse.options.allow_credentials;try{let e=await t.startAuthentication({optionsJSON:this._transformInitAuthenticateOptionsToCamelCase({...this.meta.initAuthenticateResponse.options,allow_credentials:r})});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(nQ,{relying_party:this.meta.initAuthenticateResponse.relying_party,challenge:this.meta.initAuthenticateResponse.options.challenge,authenticator_response:this._transformAuthenticationResponseToSnakeCase(e)})}catch(e){if("NotAllowedError"===e.name)throw new rp.a("Passkey request timed out or rejected by user.",void 0,rp.b.PASSKEY_NOT_ALLOWED);throw(0,rp.f)(e)}}async link(){let t=await e.A(492887);if(!this.api)throw new rp.a("Auth flow has no API instance");if(!t.browserSupportsWebAuthn())throw new rp.a("WebAuthn is not supported in this browser");this.meta.initLinkResponse||(this.meta.initLinkResponse=await this.initLinkOnce.execute());try{let e=this.meta.initLinkResponse.options,r=await t.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(e)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(nY,{relying_party:this.meta.initLinkResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(r)})}catch(e){if("NotAllowedError"===e.name)throw new rp.a("Passkey request timed out or rejected by user.",void 0,rp.b.PASSKEY_NOT_ALLOWED);throw(0,rp.f)(e)}}async _initRegisterOnce(e){if(!this.api)throw new rp.a("Auth flow has no API instance");let t=TP(e);return await this.api.post(nG,{token:this.meta.captchaToken},{headers:{...t}})}async _initAuthenticateOnce(e){if(!this.api)throw new rp.a("Auth flow has no API instance");let t=TP(e);return await this.api.post(nZ,{token:this.meta.captchaToken},{headers:{...t}})}async _initLinkOnce(){if(!this.api)throw new rp.a("Auth flow has no API instance");return await this.api.post(nJ,{})}_transformInitLinkOptionsToCamelCase(e){return{rp:e.rp,user:{id:e.user.id,name:e.user.name,displayName:e.user.display_name},challenge:e.challenge,pubKeyCredParams:e.pub_key_cred_params.map(e=>({type:e.type,alg:e.alg})),timeout:e.timeout,excludeCredentials:e.exclude_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports})),authenticatorSelection:{authenticatorAttachment:e.authenticator_selection?.authenticator_attachment,requireResidentKey:e.authenticator_selection?.require_resident_key,residentKey:e.authenticator_selection?.resident_key,userVerification:e.authenticator_selection?.user_verification},attestation:e.attestation,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props?.rk,hmacCreateSecret:e.extensions?.hmac_create_secret},hints:this.meta.hints}}_transformRegistrationResponseToSnakeCase(e){return{id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,attestation_object:e.response.attestationObject,authenticator_data:e.response.authenticatorData},authenticator_attachment:e.authenticatorAttachment,client_extension_results:{app_id:e.clientExtensionResults.appid,cred_props:e.clientExtensionResults.credProps,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret},type:e.type}}_transformInitAuthenticateOptionsToCamelCase(e){return{rpId:e.rp_id,challenge:e.challenge,allowCredentials:e.allow_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports}))||[],timeout:e.timeout,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props,hmacCreateSecret:e.extensions?.hmac_create_secret},userVerification:e.user_verification}}_transformAuthenticationResponseToSnakeCase(e){return{id:e.id,raw_id:e.rawId,response:{client_data_json:e.response.clientDataJSON,authenticator_data:e.response.authenticatorData,signature:e.response.signature,user_handle:e.response.userHandle},authenticator_attachment:e.authenticatorAttachment,client_extension_results:{app_id:e.clientExtensionResults.appid,cred_props:e.clientExtensionResults.credProps,hmac_create_secret:e.clientExtensionResults.hmacCreateSecret},type:e.type}}constructor({captchaToken:e,setPasskeyAuthState:t,hints:r}){this.authenticateForRegistration=!1,this.initRegisterOnce=new TN(this._initRegisterOnce.bind(this)),this.initAuthenticateOnce=new TN(this._initAuthenticateOnce.bind(this)),this.initLinkOnce=new TN(this._initLinkOnce.bind(this)),this.meta={captchaToken:e,setPasskeyAuthState:t,hints:r}}}let T$=({address:e,chainId:t,nonce:r})=>`${window.location.host} wants you to sign in with your Ethereum account:
${e}

By signing, you are proving you own this wallet and logging in. This does not initiate a transaction or cost any fees.

URI: ${window.location.origin}
Version: 1
Chain ID: ${t}
Nonce: ${r}
Issued At: ${(new Date).toISOString()}
Resources:
- https://privy.io`;class TV{get meta(){return{connectorType:this.wallet?.connectorType,walletClientType:this.wallet?.walletClientType,chainId:this.wallet?.chainId,address:this.wallet?.address,disableSignup:this._meta.disableSignup}}async authenticate(){if(!this.client)throw new rp.a("SiweFlow has no client instance");try{if(this.preparedMessage&&this.signature)return await this.client.authenticateWithSiweInternal({message:this.preparedMessage,signature:this.signature,chainId:this.wallet?.chainId,walletClientType:this.walletClientType??this.wallet?.walletClientType,connectorType:this.connectorType??this.wallet?.connectorType,mode:this._meta.disableSignup?"no-signup":"login-or-sign-up"});if(!this.wallet)throw new rp.a("SiweFlow has no wallet instance");let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiweInternal({message:e,signature:t,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.client)throw new rp.a("SiweFlow has no client instance");try{if(!this.wallet)throw new rp.a("SiweFlow has no wallet instance");let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiweInternal({message:e,signature:t,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType})}catch(e){throw(0,rp.f)(e)}}async sign(){if(!this.client)throw new rp.a("SiweFlow has no client instance");if(await this.buildMessage(),!this.preparedMessage)throw new rp.a("Could not prepare SIWE message");if(!this.wallet)throw new rp.a("SiweFlow has no wallet instance");let e=await this.wallet.sign(this.preparedMessage);return{message:this.preparedMessage,signature:e}}async _getNonceOnce(){if(!this.client)throw new rp.a("SiweFlow has no client instance");if(!this.wallet)throw new rp.a("UI SiweFlow has no wallet instance");return await this.client.generateSiweNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new rp.a("SiweFlow has no client instance");if(!this.wallet)throw new rp.a("SiweFlow has no wallet instance");let e=this.wallet.address,t=this.wallet.chainId.replace("eip155:","");return this.nonce||(this.nonce=await this.getNonceOnce.execute()),this.preparedMessage=T$({address:e,chainId:t,nonce:this.nonce}),this.preparedMessage}constructor(e,t,r,i=!1,n){this._meta={disableSignup:!1},this.getNonceOnce=new TN(this._getNonceOnce.bind(this)),this.wallet=t,this.captchaToken=r,this.client=e,this._meta.disableSignup=i,this.preparedMessage=n?.message,this.signature=n?.signature,this.walletClientType=n?.walletClientType,this.connectorType=n?.connectorType}}class TJ{get meta(){return{connectorType:this.wallet.connectorType,walletClientType:this.wallet.walletClientType,disableSignup:this._meta.disableSignup,messageType:this._meta.messageType,address:this.wallet?.address}}set messageType(e){this._meta.messageType=e}async authenticate(){if(!this.client)throw new rp.a("SiwsFlow has no client instance");try{let{message:e,signature:t}=await this.sign();return await this.client.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up",messageType:this.meta.messageType})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.client)throw new rp.a("SiwsFlow has no client instance");try{let{message:e,signature:t}=await this.sign();return await this.client.linkWithSiwsInternal({message:e,signature:t,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,messageType:this.meta.messageType})}catch(e){throw(0,rp.f)(e)}}async sign(){let e,t;if(!this.client)throw new rp.a("SiwsFlow has no client instance");await this.buildMessage();let r="transaction"===this.meta.messageType;if(!this.preparedMessage)throw new rp.a("Could not prepare SIWS message");if(!r&&!this.wallet.provider.signMessage||r&&!this.wallet.provider.signTransaction)throw new rp.a("Wallet does not support the necessary signing methods");if(r&&this._plugin){let r=await this.wallet.provider.signTransaction({transaction:sl.base64.decode(this.preparedMessage)});e=sl.base64.encode(r.signedTransaction),t=this._plugin.getSignatureFromTransaction(r.signedTransaction,this.wallet.address)}else{e=this.preparedMessage;let r=await this.wallet.provider.signMessage({message:(new TextEncoder).encode(this.preparedMessage)});t=sl.base64.encode(r.signature)}return{message:e,signature:t}}async _getNonceOnce(){if(!this.client)throw new rp.a("SiwsFlow has no client instance");return await this.client.generateSiwsNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new rp.a("SiwsFlow has no client instance");let e=this.wallet.address;return this.nonce||(this.nonce=await this.getNonceOnce.execute()),"transaction"===this.meta.messageType&&this._plugin?this.preparedMessage=this._plugin.createSiwsMemoTransaction({address:e,nonce:this.nonce}):this.preparedMessage=(0,so.p)({address:e,nonce:this.nonce}),this.preparedMessage}constructor(e,t,r,i=!1,n="plain",s){this._meta={disableSignup:!1,messageType:"plain"},this.getNonceOnce=new TN(this._getNonceOnce.bind(this)),this.wallet=e,this.captchaToken=r,this.client=t,this._meta.disableSignup=i,this._meta.messageType=n,this._plugin=s}}class TZ{async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new rp.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(nW,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new rp.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(nL,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode})}catch(e){throw(0,rp.f)(e)}}async sendSmsCode({phoneNumber:e,captchaToken:t,withPrivyUi:r}){if(!this.api)throw new rp.a("Auth flow has no API instance");if(e&&(this.meta.phoneNumber=e),t&&(this.meta.captchaToken=t),!this.meta.phoneNumber)throw new rp.a("phone nNumber must be set when initialzing authentication.");let i=TP(r);try{return await this.api.post(nj,{phoneNumber:this.meta.phoneNumber,token:this.meta.captchaToken},{headers:{...i}})}catch(e){throw(0,rp.f)(e)}}constructor({phoneNumber:e,captchaToken:t,disableSignup:r}){this.meta={phoneNumber:e,captchaToken:t,disableSignup:r??!1}}}class TG extends TZ{async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode||!this.meta.oldPhoneNumber)throw new rp.a("Phone number, sms code, and an old phone number must be set prior to calling update.");try{return await this.api.post(nF,{old_phone_number:this.meta.oldPhoneNumber,new_phone_number:this.meta.phoneNumber,code:this.meta.smsCode})}catch(e){throw(0,rp.f)(e)}}constructor(e,t,r){super({phoneNumber:t,captchaToken:r}),this.meta={phoneNumber:t,captchaToken:r,oldPhoneNumber:e,disableSignup:!1}}}let TY=(0,W.createContext)({enabled:!1,siteKey:"",provider:void 0,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:rp.n,setError:rp.n,setExecuting:rp.n,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:rp.d,reset:rp.n,execute:rp.n});class TQ extends rp.c{constructor(e,t,r){super(e||"Captcha failed"),this.type="Captcha",t instanceof Error&&(this.cause=t),this.privyErrorCode=r}}let TX=({children:e,appId:t,captchaSiteKey:r,enabledCaptchaProvider:i})=>{let n=(0,W.useRef)(null),s=(0,W.useRef)(null),[a,o]=(0,W.useState)(),[l,c]=(0,W.useState)(),[d,u]=(0,W.useState)(!1),h=(0,W.useMemo)(()=>i?d||a||l?!d||a||l?a&&!l?{status:"success",token:a}:l?{status:"error",error:l}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"},[i,a,l,d]),p=(0,W.useMemo)(()=>i?"turnstile"===i?{remove:()=>{n.current?.remove(),u(!1),c(void 0),o(void 0)},reset:()=>{n.current?.reset(),u(!1),c(void 0),o(void 0)},execute:()=>{u(!0),n.current?.execute()},waitForResult:async()=>{try{return await (0,ru.p)(()=>n.current?.getResponse(),{interval:200,timeout:2e4})}catch(e){throw new TQ("Captcha failed",null,rp.b.CAPTCHA_TIMEOUT)}}}:{remove:()=>{s.current?.removeCaptcha(),u(!1),c(void 0),o(void 0)},reset:()=>{s.current?.resetCaptcha(),u(!1),c(void 0),o(void 0)},execute:()=>{u(!0),s.current?.execute()},waitForResult:async()=>{try{return await (0,ru.p)(()=>s.current?.getResponse(),{interval:200,timeout:2e4})}catch(e){throw new TQ("Captcha failed",null,rp.b.CAPTCHA_TIMEOUT)}}}:null,[i]),f=(0,W.useMemo)(()=>{if(!i||!p)return{...h,enabled:!1,siteKey:"",appId:t,setToken:rp.n,setError:rp.n,setExecuting:rp.n,waitForResult:()=>Promise.resolve(void 0),remove:rp.d,reset:rp.n,execute:rp.n,provider:void 0,ref:{current:null}};let e={...h,enabled:!0,appId:t,setToken:o,setError:c,setExecuting:u};return"turnstile"===i?{...e,provider:"turnstile",ref:n,siteKey:r.split("t:")[1]??"",...p}:{...e,provider:"hcaptcha",ref:s,siteKey:r.split("h:")[1]??"",...p}},[h,i,p,t,r]);return(0,B.jsx)(TY.Provider,{value:f,children:e})},T0=()=>(0,W.useContext)(TY);class T1{async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(n0,{captcha_token:this.meta.captchaToken,telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(n1,{telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData})}catch(e){throw(0,rp.f)(e)}}constructor(e,t=!1){this.meta={disableSignup:!1},this.meta={captchaToken:e,disableSignup:!1},this.meta.disableSignup=t}}function T2(e){let t={detail:"",retryable:!1};return e?.privyErrorCode===rp.b.LINKED_TO_ANOTHER_USER&&(t.detail="This account has already been linked to another user."),e?.privyErrorCode===rp.b.DISALLOWED_LOGIN_METHOD&&(t.detail="Login with Telegram not allowed."),e?.privyErrorCode===rp.b.INVALID_DATA&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===rp.b.CANNOT_LINK_MORE_OF_TYPE&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===rp.b.INVALID_CREDENTIALS&&(t.retryable=!0,t.detail="Something went wrong. Try again."),e?.privyErrorCode===rp.b.TOO_MANY_REQUESTS&&(t.detail="Too many requests. Please wait before trying again."),e?.privyErrorCode===rp.b.TOO_MANY_REQUESTS&&e.message.includes("rate limit")&&(t.detail="Request limit reached for Telegram. Please wait a moment and try again."),e instanceof TQ&&(t.retryable=!0,t.detail="Something went wrong. Try again."),t}function T3(e){return Object.fromEntries(decodeURIComponent(e).split("&").map(e=>e.split("=").map(decodeURIComponent)))}function T5(){let e=new URL(window.location.href);e.searchParams.delete("id"),e.searchParams.delete("hash"),e.searchParams.delete("auth_date"),e.searchParams.delete("first_name"),e.searchParams.delete("last_name"),e.searchParams.delete("username"),e.searchParams.delete("photo_url"),e.hash="",window.history.replaceState({},"",e)}let T8=(0,W.lazy)(()=>e.A(733816)),T6=(0,W.lazy)(()=>e.A(892573)),T4=e=>{let t=T0();return(0,W.useEffect)(()=>t.remove,[t.remove]),t.enabled&&t.provider?(0,B.jsx)(W.Suspense,{fallback:null,children:(0,B.jsxs)("div",{className:"hidden h-0 w-0",children:["turnstile"===t.provider&&(0,B.jsx)(T8,{...e,captchaContext:t}),"hcaptcha"===t.provider&&(0,B.jsx)(T6,{...e,captchaContext:t})]})}):null};var T7=Object.freeze({__proto__:null,AccountNotFoundScreen:()=>e.A(869725),AffirmativeConsentScreen:()=>e.A(313783),AllowlistRejectionScreen:()=>e.A(858237),AuthenticateWithWalletScreen:()=>e.A(296100),AwaitingEvmToSolBridgingScreen:()=>e.A(843815),AwaitingExternalEthereumTransferScreen:()=>e.A(844148),AwaitingPasswordlessCodeScreen:()=>e.A(908980),AwaitingSolToEvmBridgingScreen:()=>e.A(900926),CaptchaScreen:()=>e.A(754629),CoinbaseOnrampStatusScreen:()=>e.A(169051),ConnectLedgerScreen:()=>e.A(512248),ConnectOnlyLandingScreen:()=>e.A(961849),ConnectOnlyStatusScreen:()=>e.A(805319),ConnectOrCreateScreen:()=>e.A(651696),ConnectionStatusScreen:()=>e.A(298724),CrossAppAuthScreen:()=>e.A(662250),DelegatedActionsConsentScreen:()=>e.A(657741),DelegatedActionsRevokeScreen:()=>e.A(49047),EmbeddedWalletConnectingScreen:()=>e.A(346917),EmbeddedWalletCreatedScreen:()=>e.A(763429),EmbeddedWalletKeyExportScreen:()=>e.A(86),EmbeddedWalletOnAccountCreateScreen:()=>e.A(209384),EmbeddedWalletPasswordCreateScreen:()=>e.A(822728),EmbeddedWalletPasswordUpdateScreen:()=>e.A(559805),EmbeddedWalletPasswordUpdateSplashScreen:()=>e.A(15680),ErrorScreen:()=>e.A(460589),FarcasterConnectStatusScreen:()=>e.A(114086),FarcasterSignerStatusScreen:()=>e.A(849212),FundSolWalletWithExternalSolanaWallet:()=>e.A(331952),FundingAmountEditScreen:()=>e.A(339753),FundingMethodSelectionScreen:()=>e.A(948330),InAppBrowserLoginNotPossible:()=>e.A(726030),InstallWalletScreen:()=>e.A(252372),LandingScreen:()=>e.A(508022),LinkConflictScreen:()=>e.A(825105),LinkEmailScreen:()=>e.A(305332),LinkPasskeyScreen:()=>e.A(472564),LinkPhoneScreen:()=>e.A(973500),LoginFailedScreen:()=>e.A(464513),ManualTransferScreen:()=>e.A(978213),MfaAuthEnrollmentFlowScreen:()=>e.A(550621),MfaAuthVerifyFlowScreen:()=>e.A(434769),MfaEnrollmentFlowScreen:()=>e.A(496091),MoonpayStatusScreen:()=>e.A(332915),OAuthStatusScreen:()=>e.A(221707),PasskeySelectSignupOrLogin:()=>e.A(680806),PasskeyStatusScreen:()=>e.A(864784),PasswordRecoveryScreen:()=>e.A(843039),RecoveryOAuthScreen:()=>e.A(489078),RecoverySelectionScreen:()=>e.A(911872),SendTransactionScreen:()=>e.A(942344),SetAutomaticRecoveryScreen:()=>e.A(756764),SignRequestScreen:()=>e.A(201519),StandardSignAndSendTransactionScreen:()=>e.A(341951),TelegramAuthScreen:()=>e.A(321879),TransferFromWalletScreen:()=>e.A(927654),UpdateEmailScreen:()=>e.A(965745),UpdatePhoneScreen:()=>e.A(663960),UserLimitReachedScreen:()=>e.A(915326),WalletInterstitialScreen:()=>e.A(606836)});let T9=(0,su.create)(()=>({inProgressMfaFlow:void 0})),ke=(0,sc.createGlobalStyle)([":root{","};"],e=>kt(e.palette)),kt=e=>(0,sc.css)(["",""],Object.entries({"--privy-color-background":e.background,"--privy-color-background-2":e.background2,"--privy-color-background-3":e.background3,"--privy-color-foreground":e.foreground,"--privy-color-foreground-2":e.foreground2,"--privy-color-foreground-3":e.foreground3,"--privy-color-foreground-4":e.foreground4,"--privy-color-foreground-accent":e.foregroundAccent,"--privy-color-accent":e.accent,"--privy-color-accent-light":e.accentLight,"--privy-color-accent-hover":e.accentHover,"--privy-color-accent-dark":e.accentDark,"--privy-color-accent-darkest":e.accentDarkest,"--privy-color-success":e.success,"--privy-color-success-dark":e.successDark,"--privy-color-success-light":e.successLight,"--privy-color-success-bg":e.successBg,"--privy-color-error":e.error,"--privy-color-error-light":e.errorLight,"--privy-color-error-bg":e.errorBg,"--privy-color-error-bg-hover":e.errorBgHover,"--privy-color-warn":e.warn,"--privy-color-warn-light":e.warnLight,"--privy-color-warn-bg":e.warnBg,"--privy-color-warning-dark":e.warningDark,"--privy-color-error-dark":e.errorDark,"--privy-color-info-bg":e.infoBg,"--privy-color-info-bg-hover":e.infoBgHover,"--privy-color-border-default":e.borderDefault,"--privy-color-border-hover":e.borderHover,"--privy-color-border-focus":e.borderFocus,"--privy-color-border-error":e.borderError,"--privy-color-border-success":e.borderSuccess,"--privy-color-border-warning":e.borderWarning,"--privy-color-border-info":e.borderInfo,"--privy-color-border-interactive":e.borderInteractive,"--privy-color-border-interactive-hover":e.borderInteractiveHover,"--privy-color-background-hover":e.backgroundHover,"--privy-color-background-clicked":e.backgroundClicked,"--privy-color-background-disabled":e.backgroundDisabled,"--privy-color-background-interactive":e.backgroundInteractive,"--privy-color-background-interactive-hover":e.backgroundInteractiveHover,"--privy-color-background-interactive-clicked":e.backgroundInteractiveClicked,"--privy-color-background-interactive-disabled":e.backgroundInteractiveDisabled,"--privy-color-foreground-hover":e.foregroundHover,"--privy-color-foreground-clicked":e.foregroundClicked,"--privy-color-foreground-disabled":e.foregroundDisabled,"--privy-color-foreground-interactive":e.foregroundInteractive,"--privy-color-foreground-interactive-hover":e.foregroundInteractiveHover,"--privy-link-navigation-color":e.linkNavigationColor,"--privy-link-navigation-decoration":e.linkNavigationDecoration,"--privy-accent-has-good-contrast":e.accentHasGoodContrast,"--privy-color-icon-default":e.iconDefault,"--privy-color-icon-muted":e.iconMuted,"--privy-color-icon-subtle":e.iconSubtle,"--privy-color-icon-inverse":e.iconInverse,"--privy-color-icon-success":e.iconSuccess,"--privy-color-icon-warning":e.iconWarning,"--privy-color-icon-error":e.iconError,"--privy-color-icon-interactive":e.iconInteractive,"--privy-color-icon-default-hover":e.iconDefaultHover,"--privy-color-icon-muted-hover":e.iconMutedHover,"--privy-color-icon-subtle-hover":e.iconSubtleHover,"--privy-color-icon-default-clicked":e.iconDefaultClicked,"--privy-color-icon-muted-clicked":e.iconMutedClicked,"--privy-color-icon-subtle-clicked":e.iconSubtleClicked,"--privy-color-icon-default-disabled":e.iconDefaultDisabled,"--privy-color-icon-muted-disabled":e.iconMutedDisabled,"--privy-color-icon-subtle-disabled":e.iconSubtleDisabled,"--privy-color-icon-error-hover":e.iconErrorHover,"--privy-color-icon-interactive-hover":e.iconInteractiveHover,"--privy-color-icon-error-clicked":e.iconErrorClicked,"--privy-color-icon-interactive-clicked":e.iconInteractiveClicked,"--privy-color-icon-muted-disabled-alt":e.iconMutedDisabledAlt,"--privy-color-icon-subtle-disabled-alt":e.iconSubtleDisabledAlt,"--privy-border-radius-xs":"6px","--privy-border-radius-sm":"8px","--privy-border-radius-md":"12px","--privy-border-radius-mdlg":"16px","--privy-border-radius-lg":"24px","--privy-border-radius-full":"9999px","--privy-height-modal-full":"620px","--privy-height-modal-compact":"480px"}).map(([e,t])=>`${e}: ${t};`).join("\n")),kr=sc.styled.div.withConfig({displayName:"StylesWrapper",componentId:"sc-188229e4-0"})([""," color:var(--privy-color-foreground-2);h3{font-size:16px;line-height:24px;font-weight:500;color:var(--privy-color-foreground-2);}h4{font-size:14px;line-height:20px;font-weight:500;color:var(--privy-color-foreground);}p{font-size:13px;line-height:20px;color:var(--privy-color-foreground-2);}button:focus,input:focus,optgroup:focus,select:focus,textarea:focus{outline:none;border-color:var(--privy-color-accent-light);box-shadow:0 0 0 3px var(--privy-color-border-focus);}.mobile-only{@media (min-width:441px){display:none;}}@keyframes fadein{0%{opacity:0;}100%{opacity:1;}}"],"\n  *,\n  ::before,\n  ::after {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n  }\n\n  line-height: 1.15;\n  -webkit-text-size-adjust: 100%;\n  -moz-tab-size: 4;\n  tab-size: 4;\n  font-feature-settings: normal;\n\n  margin: 0;\n  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n\n  hr {\n    height: 0;\n    color: inherit;\n    border-top-width: 1px;\n  }\n\n  abbr:where([title]) {\n    text-decoration: underline dotted;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: inherit;\n    font-weight: inherit;\n    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n    display: inline;\n  }\n\n  a {\n    color: inherit;\n    text-decoration: inherit;\n  }\n\n  b,\n  strong {\n    font-weight: bolder;\n  }\n\n  code,\n  kbd,\n  samp,\n  pre {\n    font-family: ui-monospace, SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;\n    font-size: 1em;\n  }\n\n  small {\n    font-size: 80%;\n  }\n\n  sub,\n  sup {\n    font-size: 75%;\n    line-height: 0;\n    position: relative;\n    vertical-align: baseline;\n  }\n\n  sub {\n    bottom: -0.25em;\n  }\n\n  sup {\n    top: -0.5em;\n  }\n\n  table {\n    text-indent: 0;\n    border-color: inherit;\n    border-collapse: collapse;\n  }\n\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n  }\n\n  button,\n  select {\n    text-transform: none;\n  }\n\n  button,\n  [type='button'],\n  [type='reset'],\n  [type='submit'] {\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n  }\n\n  ::-moz-focus-inner {\n    border-style: none;\n    padding: 0;\n  }\n\n  :-moz-focusring {\n    outline: 1px dotted ButtonText;\n  }\n\n  :-moz-ui-invalid {\n    box-shadow: none;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  progress {\n    vertical-align: baseline;\n  }\n\n  ::-webkit-inner-spin-button,\n  ::-webkit-outer-spin-button {\n    height: auto;\n  }\n\n  [type='search'] {\n    -webkit-appearance: textfield;\n    outline-offset: -2px;\n  }\n\n  ::-webkit-search-decoration {\n    -webkit-appearance: none;\n  }\n\n  ::-webkit-file-upload-button {\n    -webkit-appearance: button;\n    font: inherit;\n  }\n\n  summary {\n    display: list-item;\n  }\n\n  blockquote,\n  dl,\n  dd,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6,\n  hr,\n  figure,\n  p,\n  pre {\n    margin: 0;\n  }\n\n  fieldset {\n    margin: 0;\n    padding: 0;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  ol,\n  ul,\n  menu {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  textarea {\n    resize: vertical;\n  }\n\n  input::placeholder,\n  textarea::placeholder {\n    opacity: 1;\n    color: #9ca3af;\n  }\n\n  button,\n  [role='button'] {\n    cursor: pointer;\n  }\n\n  :disabled {\n    cursor: default;\n  }\n\n  img,\n  svg,\n  video,\n  canvas,\n  audio,\n  iframe,\n  embed,\n  object {\n    display: block;\n  }\n\n  img,\n  video {\n    max-width: 100%;\n    height: auto;\n  }\n\n  [hidden] {\n    display: none;\n  }\n"),ki=({children:e,open:t,onClick:r,...i})=>(0,B.jsx)(s8,{show:t,as:W.default.Fragment,children:(0,B.jsxs)(oq,{onClose:r,...i,as:ks,children:[(0,B.jsx)(s5,{as:W.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,B.jsx)(kn,{id:"privy-dialog-backdrop","aria-hidden":"true"})}),(0,B.jsx)(ka,{children:(0,B.jsx)(s5,{as:W.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,B.jsx)(oz,{as:ko,children:e})})})]})}),kn=sc.styled.div.withConfig({displayName:"Backdrop",componentId:"sc-3cfde0b5-0"})(["position:fixed;inset:0;transition:backdrop-filter 100ms ease;backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);&.entering,&.leaving{backdrop-filter:unset;-webkit-backdrop-filter:unset;}"]),ks=sc.styled.div.withConfig({displayName:"DialogWrapper",componentId:"sc-3cfde0b5-1"})(["position:relative;z-index:999999;"]),ka=sc.styled.div.withConfig({displayName:"DialogContainer",componentId:"sc-3cfde0b5-2"})(["position:fixed;inset:0;display:flex;align-items:center;justify-content:center;width:100vw;min-height:100vh;"]),ko=sc.styled.div.withConfig({displayName:"Panel",componentId:"sc-3cfde0b5-3"})(["padding:0;background:transparent;border:none;width:100%;pointer-events:auto;outline:none;display:block;@media (max-width:440px){opacity:1;transform:translate3d(0,0,0);transition:transform 200ms ease-in;position:fixed;bottom:0;&.entering,&.leaving{opacity:0;transform:translate3d(0,100%,0);transition:transform 150ms ease-in 0ms,opacity 0ms ease 150ms;}}@media (min-width:441px){opacity:1;transition:opacity 100ms ease-in;&.entering,&.leaving{opacity:0;transition-delay:5ms;}margin:auto;width:360px;box-shadow:0px 8px 36px rgba(55,65,81,0.15);border-radius:var(--privy-border-radius-lg);}"]),kl=(0,W.lazy)(()=>e.A(387799)),kc=(0,W.lazy)(()=>T7.MfaAuthVerifyFlowScreen().then(e=>({default:e.default.component}))),kd=()=>(0,B.jsx)(kg,{children:(0,B.jsx)(ru.L,{})}),ku=()=>{let{currentScreen:e}=(0,rc.a)(),t=T9(e=>e.inProgressMfaFlow),r=()=>T9.setState({inProgressMfaFlow:void 0}),{component:i,isLoading:n}=(()=>{let{ready:e}=(0,rc.u)(),{currentScreen:t}=(0,rc.a)(),[r,i]=(0,W.useState)(null),[n,s]=(0,W.useState)(!1),a=function(e){let[t,r]=(0,W.useState)(!1),i=(0,W.useRef)(null),n=(0,W.useRef)(null),s=(0,W.useRef)(null);return(0,W.useEffect)(()=>{if(i.current&&(clearTimeout(i.current),i.current=null),n.current&&(clearTimeout(n.current),n.current=null),e)s.current=Date.now(),i.current=setTimeout(()=>{r(!0)},150);else if(null!==s.current){let e=Date.now()-s.current;e>=150?n.current=setTimeout(()=>{r(!1),s.current=null},Math.max(0,400-(e-150))):(i.current&&(clearTimeout(i.current),i.current=null),r(!1),s.current=null)}return()=>{i.current&&clearTimeout(i.current),n.current&&clearTimeout(n.current)}},[e]),t}(n);return(0,W.useEffect)(()=>{t?(s(!0),T7[t]().then(r=>{(!t||e||r.default.isShownBeforeReady)&&(i(()=>r.default.component),s(!1))}).catch(()=>{i(null),s(!1)})):(i(null),s(!1))},[t,e]),{component:r,isLoading:a}})();return function(){let{isModalOpen:e}=(0,rc.u)(),{headless:t}=(0,nn.u)(),{currentScreen:r}=(0,rc.a)(),{status:i,execute:n,reset:s,enabled:a}=T0(),[o,l]=(0,W.useState)(!1);(0,W.useEffect)(()=>{!e&&a&&s()},[e,a,s]),(0,W.useEffect)(()=>{r?T7[r]().then(e=>{l(!!e.default.isCaptchaRequired)}).catch(()=>{l(!1)}):l(!1)},[r]),(0,W.useEffect)(()=>{e&&o&&!t&&"ready"===i&&a&&n()},[e,o,t,i,a,n])}(),e||"txn"!==t?n?(0,B.jsx)(kd,{}):i?(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(ru.H,{$if:!!t,children:(0,B.jsx)(W.Suspense,{children:(0,B.jsx)(i,{})})}),(0,B.jsxs)(W.Suspense,{children:["txn"===t&&(0,B.jsx)(kl,{onClose:r}),"auth"===t&&(0,B.jsx)(kc,{})]})]}):null:(0,B.jsxs)(W.Suspense,{children:[(0,B.jsx)(kl,{onClose:r}),";"]})},kh=()=>{let e=(0,W.useRef)(null);return(0,B.jsx)(ky,{style:{height:(0,ru.u)(e)},id:"privy-modal-content",children:(0,B.jsx)("div",{ref:e,children:(0,B.jsx)(ku,{})})})},kp=({open:e})=>{var t;let r=(0,nn.u)(),{gracefulClosePrivyModal:i}=(()=>{let{closePrivyModal:e}=(0,rp.u)(),{onUserCloseViaDialogOrKeybindRef:t}=(0,rc.a)();return{gracefulClosePrivyModal:(0,W.useCallback)(()=>{if(!t?.current)return e({shouldCallAuthOnSuccess:!1});t.current()},[e])}})(),n=T9(e=>e.inProgressMfaFlow);return t={onMfaRequired:()=>{r.mfa.noPromptOnMfaRequired||T9.setState({inProgressMfaFlow:"txn"})}},(0,sd.u)("configureMfa",t),r.render.standalone?(0,B.jsx)(kr,{children:(0,B.jsx)(kf,{id:"privy-modal-content",children:(0,B.jsx)(ku,{})})}):(0,B.jsx)(ki,{open:!(!e&&!n),id:"privy-dialog","aria-label":"log in or sign up","aria-labelledby":"privy-dialog-title",onClick:()=>i(),children:(0,B.jsx)(kr,{children:(0,B.jsx)(kh,{})})})},kf=sc.styled.div.withConfig({displayName:"ContentWrapper",componentId:"sc-9b080f09-0"})(["display:flex;flex-direction:column;text-align:center;font-size:14px;line-height:20px;width:100%;background:var(--privy-color-background);padding:0 16px;"]),ky=(0,sc.styled)(kf).withConfig({displayName:"BaseModal",componentId:"sc-9b080f09-1"})(["transition:height 150ms ease-out;overflow-x:hidden;overflow-y:auto;scrollbar-width:none;max-height:calc(100svh - 32px);border-radius:var(--privy-border-radius-lg) var(--privy-border-radius-lg) 0 0;box-shadow:0px 0px 36px rgba(55,65,81,0.15);@media (min-width:441px){box-shadow:0px 8px 36px rgba(55,65,81,0.15);border-radius:var(--privy-border-radius-lg);}"]),kg=sc.styled.div.withConfig({displayName:"LoadingScreenContainer",componentId:"sc-9b080f09-2"})(["display:flex;align-items:center;justify-content:center;min-height:300px;padding:2rem;"]);function km(e){let t=(0,W.useRef)(null),r=(0,W.useRef)();return(0,W.useEffect)(()=>{r.current?.remove(),r.current=function({botUsername:e,scriptHost:t}){let r=document.createElement("script"),{origin:i}=new URL(t);return r.async=!0,r.src=`${i}/js/telegram-login.js`,r.setAttribute("data-telegram-login",e),r.setAttribute("data-request-access","write"),r.setAttribute("data-lang","en"),r}(e),t.current?.after(r.current)},[e]),(0,B.jsx)("div",{ref:t,hidden:!0})}let kw=()=>{let{ready:e}=(0,rh.u)(),{client:t}=(0,rp.u)();return(0,W.useEffect)(()=>{let r=()=>{if(!t.connectors||!e)return;let r=t.connectors.wallets.map(e=>({address:e.address,connectorType:e.connectorType,walletClientType:e.walletClientType,connectedAt:e.connectedAt,id:e.meta.id}));rf.u.put(nn.b,r)};return t.connectors?.on("walletsUpdated",r),()=>{t.connectors?.off("walletsUpdated",r)}},[e,t.connectors]),null};class kb extends ru.E{async initialize(){let e=await this.createProvider();this.provider=e,this.proxyProvider.setWalletProvider(e),this.subscribeListeners(),e.session&&(this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,ru.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown"),this.connected=!0,await this.syncAccounts()),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),this.getConnectedWallet()}async isConnected(){return!!this.walletProvider?.connected}get walletBranding(){let e=this.walletProvider?.session?.peer.metadata.icons?.[0];return{name:(0,ru.s)(this.walletProvider?.session?.peer.metadata.name||"")||"WalletConnect",icon:"string"==typeof e?e:rf.W,id:this.walletProvider?.session?.peer.metadata.name.toLowerCase()||"wallet_connect_v2"}}async resetConnection(e){this.walletProvider&&this.walletProvider.connected&&(await this.walletProvider.disconnect(),this.walletProvider.signer.session=void 0,this.walletClientType=e,this.redirectUri=void 0,this.fallbackUniversalRedirectUri=void 0,(0,so.d)(),this.onDisconnect())}async promptConnection(){if(this.provider)return new Promise((e,t)=>{(async()=>{let t="",r=await Promise.race([this.walletProvider?.enable(),this.proxyProvider.walletTimeout()]);if(r?.length&&(t=r[0]),!t||""===t)throw new rp.P("Unable to retrieve address");this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,ru.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown",this.proxyProvider.rpcTimeoutDuration=(0,ru.c)(this.rpcConfig,this.walletClientType)),this.connected=!0,await this.syncAccounts(r),e()})().catch(e=>{t(e?(0,rf.f)(e):new rp.P("Unknown error during connection"))})})}disconnect(){this.walletProvider?.disconnect().then(()=>this.onDisconnect()).catch(()=>console.warn("Unable to disconnect WalletConnect provider"))}get walletProvider(){return this.proxyProvider.walletProvider}setWalletProvider(e){this.proxyProvider.setWalletProvider(e)}async createProvider(){let e={};for(let t of this.chains){let r=(0,ru.a)(t.id,this.chains,this.rpcConfig,this.privyAppId);r&&(e[t.id]=r)}let t=this.shouldEnforceDefaultChainOnConnect?[this.defaultChain.id]:[],r=this.chains.map(e=>e.id),i=await Ey.init({projectId:this.walletConnectCloudProjectId,chains:t,optionalChains:r,optionalEvents:Er,optionalMethods:Ee,rpcMap:e,showQrModal:!1,metadata:{description:this.privyAppName,name:this.privyAppName,url:window.location.origin,icons:[]}});return i.on("display_uri",e=>{if(i.signer.abortPairingAttempt(),(0,so.r)(),!this.showPrivyQrModal)throw new rp.P("WalletConnect modal not available - Privy handles wallet connections through its own UI");if(ns.isMobile&&this.walletEntry){let{redirect:t,href:r}=(0,so.b)(e,this.walletEntry);(0,so.o)(t,"_self"),(0,so.s)({href:r,name:this.walletEntry.metadata?.shortName||this.walletEntry.name});let i=(0,so.a)(e,this.walletEntry);return this.redirectUri=t,this.fallbackUniversalRedirectUri=i?.redirect,this.showPrivyQrModal({native:t,universal:t})}if(this.redirectUri=void 0,this.walletEntry){let t=(0,so.a)(e,this.walletEntry);this.fallbackUniversalRedirectUri=t?.redirect}this.showPrivyQrModal({native:e,universal:void 0})}),i.on("connect",()=>{i.session?.peer.metadata.url&&(this.walletEntry=(0,ru.g)(i.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown")}),i}async enableProvider(){return this.walletProvider?.connected?Promise.resolve(this.walletProvider.accounts):await this.walletProvider?.enable()}setWalletEntry(e,t){this.walletEntry=e,this.showPrivyQrModal=t}constructor({walletConnectCloudProjectId:e,rpcConfig:t,chains:r,defaultChain:i,shouldEnforceDefaultChainOnConnect:n,privyAppId:s,privyAppName:a,walletClientType:o}){super(o||"unknown",r,i,t),this.connectorType="wallet_connect_v2",this.privyAppId=s,this.privyAppName=a,this.walletConnectCloudProjectId=e,this.rpcConfig=t,this.shouldEnforceDefaultChainOnConnect=n,this.proxyProvider=new ru.P(void 0,this.rpcTimeoutDuration),o&&(this.walletEntry=(0,ru.b)(o),this.walletClientType=o)}}let kv=["error","invalid_request_arguments","wallet_not_on_device","invalid_recovery_pin","insufficient_funds","missing_or_invalid_mfa","mfa_verification_max_attempts_reached","mfa_timeout","twilio_verification_failed"];class kE extends Error{constructor(e,t){super(t),this.type=e}}function kA(e){let t=e.type;return"string"==typeof t&&kv.includes(t)}function k_(e){return kA(e)&&"wallet_not_on_device"===e.type}function kS(e){return kA(e)&&("invalid_recovery_pin"===e.type||"invalid_request_arguments"===e.type)}function kI(e){return!!kA(e)&&"mfa_timeout"===e.type}function kx(e){return!!kA(e)&&"missing_or_invalid_mfa"===e.type}function kT(e){return!!kA(e)&&"mfa_verification_max_attempts_reached"===e.type}function kk(e){return!(!kA(e)||!e.message.includes("code 429"))}function kC(e){let t;return"string"==typeof(t=e.type)&&"client_error"===t&&"MFA canceled"===e.message}async function kP(e,t,r,i,n,s=!1){let a=s,o=async o=>{if(a&&t&&t.length>0){o===+!s?n("configureMfa","onMfaRequired",{mfaMethods:t}):i.current?.reject(new kE("missing_or_invalid_mfa","MFA verification failed, retry."));let a=await new Promise((e,t)=>{r.current={resolve:e,reject:t},setTimeout(()=>{let e=new kE("mfa_timeout","Timed out waiting for MFA code");i.current?.reject(e),t(e)},3e5)});return await e(a)}return await e()},l=null;for(let e=0;e<4;e++)try{l=await o(e),i.current?.resolve(void 0);break}catch(e){if("missing_or_invalid_mfa"!==e.type)throw i.current?.resolve(void 0),e;a=!0}if(null===l){let e=new kE("mfa_verification_max_attempts_reached","Max MFA verification attempts reached");throw i.current?.reject(e),e}return l}let kO=(C9=0,()=>"id-"+C9++);function kR(e){return void 0!==e.error}let kN=new class{enqueue(e,t){this.callbacks[e]=t}dequeue(e,t){let r=this.callbacks[t];if(!r)throw Error(`cannot dequeue ${e} event: no event found for id ${t}`);switch(delete this.callbacks[t],e){case"privy:iframe:ready":case"privy:user-signer:sign":case"privy:wallets:add":case"privy:wallets:import":case"privy:wallets:set-recovery":case"privy:wallets:connect":case"privy:wallets:recover":case"privy:wallets:rpc":case"privy:wallet:create":case"privy:mfa:verify":case"privy:mfa:init-enrollment":case"privy:mfa:submit-enrollment":case"privy:mfa:unenroll":case"privy:mfa:clear":case"privy:auth:unlink-passkey":case"privy:farcaster:init-signer":case"privy:farcaster:sign":case"privy:solana-wallet:create":case"privy:delegated-actions:consent":return r;default:throw Error(`invalid wallet event type ${e}`)}}constructor(){this.callbacks={}}},kM=new Map,kU=(e,t)=>"bigint"==typeof t?t.toString():t;function kD(e,t,r,i){let n=r.contentWindow;if(!n)throw Error("iframe not initialized");let s=`${e}${JSON.stringify(t,kU)}`;if("privy:wallet:create"===e){let e=kM.get(s);if(e)return e}let a=new Promise((r,s)=>{let a=kO();kN.enqueue(a,{resolve:r,reject:s}),n.postMessage({id:a,event:e,data:t},i)}).finally(()=>{kM.delete(s)});return kM.set(s,a),a}function kj(e){let t=(0,nn.c)(),r=(0,W.useRef)(null),i=(0,W.useRef)(e.mfaMethods),n=(0,sd.a)(),[s,a]=(0,W.useState)(!1);return(0,W.useEffect)(()=>{i.current=e.mfaMethods},[e.mfaMethods]),(0,W.useEffect)(()=>{if(!s)return;let t=r.current;if(!t)return;function a(t){var r;t&&t.origin===e.origin&&"string"==typeof(r=t.data).event&&/^privy:.+/.test(r.event)&&function(e){switch(e.event){case"privy:iframe:ready":let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data);case"privy:user-signer:sign":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:add":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:set-recovery":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:connect":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:recover":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallets:rpc":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:wallet:create":let r=kN.dequeue(e.event,e.id);return kR(e)?r.reject(new kE(e.error.type,e.error.message)):r.resolve(e.data);case"privy:wallets:import":let i=kN.dequeue(e.event,e.id);return kR(e)?i.reject(new kE(e.error.type,e.error.message)):i.resolve(e.data);case"privy:mfa:verify":let n=kN.dequeue(e.event,e.id);return kR(e)?n.reject(new kE(e.error.type,e.error.message)):n.resolve(e.data);case"privy:mfa:init-enrollment":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:submit-enrollment":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:unenroll":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:mfa:clear":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:auth:unlink-passkey":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:solana-wallet:create":let s=kN.dequeue(e.event,e.id);return kR(e)?s.reject(new kE(e.error.type,e.error.message)):s.resolve(e.data);case"privy:farcaster:init-signer":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:farcaster:sign":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}case"privy:delegated-actions:consent":{let t=kN.dequeue(e.event,e.id);return kR(e)?t.reject(new kE(e.error.type,e.error.message)):t.resolve(e.data)}default:console.warn("Unsupported wallet proxy method:",e)}}(t.data)}let o={signWithUserSigner:r=>kP(i=>kD("privy:user-signer:sign",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),addWallet:r=>kP(i=>kD("privy:wallets:add",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),setRecovery:r=>kP(i=>kD("privy:wallets:set-recovery",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),connect:r=>kP(i=>kD("privy:wallets:connect",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),recover:r=>kP(i=>kD("privy:wallets:recover",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n,!r.recoveryAccessToken&&!r.recoveryPassword&&!r.recoverySecretOverride),rpc:r=>kP(i=>kD("privy:wallets:rpc",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),create:r=>kD("privy:wallet:create",r,t,e.origin),importWallet:r=>kD("privy:wallets:import",r,t,e.origin),createSolana:r=>kP(i=>kD("privy:solana-wallet:create",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),createDelegatedAction:r=>kD("privy:delegated-actions:consent",r,t,e.origin),verifyMfa:r=>kP(i=>kD("privy:mfa:verify",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n,!0),initEnrollMfa:r=>kP(i=>kD("privy:mfa:init-enrollment",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),submitEnrollMfa:r=>kP(i=>kD("privy:mfa:submit-enrollment",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),unenrollMfa:r=>kP(i=>kD("privy:mfa:unenroll",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),clearMfa:r=>kD("privy:mfa:clear",r,t,e.origin),unlinkPasskeyAccount:r=>kP(i=>kD("privy:auth:unlink-passkey",{...r,...i},t,e.origin),i.current,e.mfaPromise,e.mfaSubmitPromise,n),initFarcasterSigner:r=>kD("privy:farcaster:init-signer",r,t,e.origin),signFarcasterMessage:r=>kD("privy:farcaster:sign",r,t,e.origin)};window.addEventListener("message",a);let l=new AbortController;return(0,ru.i)(()=>kD("privy:iframe:ready",{},t,e.origin),{abortSignal:l.signal}).then(()=>e.onLoad(o),(...t)=>{console.warn("Privy iframe failed to load: ",...t),e.onLoadFailed()}),()=>{window.removeEventListener("message",a),l.abort()}},[s]),t?(0,B.jsx)("iframe",{ref:r,width:"0",height:"0",style:{display:"none",height:"0px",width:"0px"},onLoad:()=>a(!0),src:(0,ET.constructURL)({origin:e.origin,path:`/apps/${e.appId}/embedded-wallets`,query:{caid:e.clientAnalyticsId,client_id:e.appClientId}})}):null}let kL=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"privy"===e.walletClientType&&e.delegated),kB="popup-privy-oauth",kW="PRIVY_OAUTH_USE_BROADCAST_CHANNEL";class kF{async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(nH,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(nK,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(e){throw(0,rp.f)(e)}}constructor({authorizationCode:e,stateCode:t,codeVerifier:r,provider:i}){this.meta={authorizationCode:e,stateCode:t,codeVerifier:r,provider:i}}}async function kz({api:e,requesterAppId:t,providerAppId:r}){let i=(await e.get(`/api/v1/apps/${t}/cross-app/connections`)).connections.find(e=>e.provider_app_id===r);if(!i)throw new rp.a("Invalid connected app");return{name:i.provider_app_name,logoUrl:i.provider_app_icon_url||void 0,apiUrl:i.provider_app_custom_api_url,readOnly:i.read_only,customAuthAuthorizeUrl:i.provider_app_custom_auth_authorize_url,customAuthTransactUrl:i.provider_app_custom_auth_transact_url}}let kq=async({user:e,address:t,client:r,request:i,requesterAppId:n,reconnect:s})=>{r.createAnalyticsEvent({eventName:"cross_app_request_started",payload:{address:t,method:i.method}});let a=e?.linkedAccounts.find(e=>"cross_app"===e.type&&(e.embeddedWallets.some(e=>e.address===t)||e.smartWallets.some(e=>e.address===t)));if(!e||!a)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Cannot request a signature with this wallet address",address:t}}),new rp.a("Cannot request a signature with this wallet address");let o=r.getProviderAccessToken(a.providerApp.id),l=await kz({api:r.api,requesterAppId:n,providerAppId:a.providerApp.id});if(!o){if(l.readOnly)throw console.error("cannot transact against a read-only provider app"),new rp.a("Cannot transact against a read-only provider app");await s({appId:a.providerApp.id,action:"link"})&&(o=r.getProviderAccessToken(a.providerApp.id))}if(!o)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Transactions require a valid token",address:t}}),new rp.a("Transactions require a valid token");let c=new URL(l.customAuthTransactUrl||`${l.apiUrl}/oauth/transact`);c.searchParams.set("token",o||""),c.searchParams.set("request",kH(i));let d=(0,nu.trigger)({location:c.href});if(!d)throw r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Missing token",address:t}}),new rp.a("Failed to initialize signature request");return new Promise((e,n)=>{let s=setTimeout(()=>{c(),n(new rp.a("Request timeout")),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Request timeout",address:t}})},12e4),o=setInterval(()=>{d.closed&&(c(),n(new rp.a("User rejected request")),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"User rejected request",address:t}}))},300),l=s=>{s.data&&("set"===s.data.token?.action&&void 0!==s.data.token?.value?r.storeProviderAccessToken(a.providerApp.id,s.data.token.value):"clear"===s.data.token?.action&&r.storeProviderAccessToken(a.providerApp.id,null),"PRIVY_CROSS_APP_ACTION_RESPONSE"===s.data.type&&s.data.result&&(c(),e(s.data.result),r.createAnalyticsEvent({eventName:"cross_app_request_success",payload:{address:t,method:i.method}})),"PRIVY_CROSS_APP_ACTION_ERROR"===s.data.type&&s.data.error&&(c(),n(s.data.error),r.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:s.data.error,address:t}})))};window.addEventListener("message",l);let c=()=>{d.close(),clearInterval(o),clearTimeout(s),window.removeEventListener("message",l)}})},kH=e=>JSON.stringify({content:{request:{request:kK(e,na.toHex)}},timestamp:Date.now(),callbackUrl:window.origin}),kK=(e,t)=>"bigint"==typeof e?t(e):Array.isArray(e)?e.map(e=>kK(e,t)):e&&"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,r])=>[e,kK(r,t)])):e;function k$({isCreatingWallet:e,skipSplashScreen:t}){return e?"EmbeddedWalletPasswordCreateScreen":t?"EmbeddedWalletPasswordUpdateScreen":"EmbeddedWalletPasswordUpdateSplashScreen"}function kV({walletAction:e,availableRecoveryMethods:t,legacySetWalletPasswordFlow:r,isResettingPassword:i,showAutomaticRecovery:n}){return n?"SetAutomaticRecoveryScreen":r||1===t.length?k$({isCreatingWallet:"create"===e,skipSplashScreen:i}):"RecoverySelectionScreen"}function kJ(e){switch(e){case"user-passcode":return"PasswordRecoveryScreen";case"google-drive":case"icloud":return"RecoveryOAuthScreen";default:throw Error("Recovery method not supported")}}function kZ(e,t,r,i,n,s,a){return{...e,funding:e?.funding?{...e.funding,fundingResult:{status:t,address:e.funding.address,fundingMethod:void 0,transactionHash:r,amount:e.funding.amount,assetType:n?s?.symbol||"ETH":a.nativeCurrency.symbol||"ETH",metadata:{walletClientType:i}}}:void 0,solanaFundingData:e?.solanaFundingData,sendTransaction:e?.sendTransaction}}let kG=new Map([["FundingMethodSelectionScreen",null],["TransferFromWalletScreen","external"],["FundingAmountEditScreen","external"],["ConnectOnlyLandingScreen","external"],["ConnectOnlyStatusScreen","external"],["AwaitingExternalEthereumTransferScreen","external"],["AwaitingEvmToSolBridgingScreen","external"],["AwaitingSolToEvmBridgingScreen","external"],["ManualTransferScreen","manual"],["MoonpayStatusScreen","moonpay"]]);function kY(e){let t=e.toLowerCase();return!!window?.webkit?.messageHandlers?.ReactNativeWebView||!!window?.ReactNativeWebView||["fbav","fban","instagram","snapchat","linkedinapp"].some(e=>t.includes(e))}async function kQ({rpc:e,address:t}){return(await e.getBalance(t,{commitment:"confirmed"}).send()).value??0n}let kX={apple_oauth:"apple",custom_auth:"custom",discord_oauth:"discord",email:"email",farcaster:"farcaster",github_oauth:"github",google_oauth:"google",instagram_oauth:"instagram",linkedin_oauth:"linkedin",passkey:"passkey",phone:"sms",spotify_oauth:"spotify",telegram:"telegram",tiktok_oauth:"tiktok",line_oauth:"line",twitch_oauth:"twitch",twitter_oauth:"twitter",wallet:"siwe",smart_wallet:"siwe",cross_app:"privy:"},k0=e=>{if((0,rc.i)(e))return{displayName:e.replace("custom:",""),loginMethod:"custom"};let t=kX[e];return"wallet"===e||"phone"===e?{displayName:e,loginMethod:t}:{displayName:t,loginMethod:t}},k1=(e,t)=>!(0,rc.b)(e)&&("all-users"===t||"users-without-wallets"===t&&!k2(e).length),k2=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"ethereum"===e.chainType),k3=(e,t)=>!(0,rc.c)(e)&&("all-users"===t||"users-without-wallets"===t&&!k5(e).length),k5=e=>e.linkedAccounts.filter(e=>"wallet"===e.type&&"solana"===e.chainType);async function k8(e,t,r,i){let n=(0,ni.toViemTransactionSerializable)(e),{chain:s,...a}=await (async()=>i?await i():await t.prepareTransactionRequest({...n,account:{address:r,type:"json-rpc"}}))();return{...a,type:ni.STRING_TO_NUMBER_TXN_TYPE[a.type]}}let k6=({disabled:e})=>{let{migrate:t}=(()=>{let e=(0,nn.u)(),{user:t}=(0,rc.u)(),{client:r,refreshSessionAndUser:i,walletProxy:n}=(0,rp.u)();return{migrate:(0,W.useCallback)(async()=>{if("legacy-embedded-wallets-only"===e.embeddedWallets.mode)return{success:!0};if(!t)throw new rp.a("User must be authenticated before migrating wallets",rp.b.MUST_BE_AUTHENTICATED);if(!n)throw new rp.a("Cannot connect to wallet proxy");let s=await r.getAccessToken();if(!s)throw new rp.a("User must be authenticated before migrating wallets",rp.b.MUST_BE_AUTHENTICATED);let a=t.linkedAccounts.filter(e=>"wallet"===e.type&&"privy"===e.walletClientType&&(0,rf.i)(e)&&!(0,rc.d)(e));if(0===a.length)return{success:!0};let o=a.filter(e=>e.imported),l=a.filter(e=>!e.imported);if(l.length>0){let e=l.find(e=>"ethereum"===e.chainType&&0===e.walletIndex)??l.find(e=>"solana"===e.chainType&&0===e.walletIndex)??null;if(!e)throw new rp.a("Primary wallet not found");let{entropyId:t,entropyIdVerifier:r}=(0,rh.t)(e);try{await n.connect({accessToken:s,entropyId:t,entropyIdVerifier:r})}catch(i){if(!k_(i)||"privy"!==e.recoveryMethod)throw i;await n.recover({accessToken:s,entropyId:t,entropyIdVerifier:r})}await n.createDelegatedAction({accessToken:s,rootWallet:{address:e.address,chainType:e.chainType,imported:!1},delegatedWallets:l.map(e=>({address:e.address,chainType:e.chainType,walletIndex:e.walletIndex??0}))})}for(let e of o){let{entropyId:t,entropyIdVerifier:r}=(0,rh.t)(e);try{await n.connect({accessToken:s,entropyId:t,entropyIdVerifier:r})}catch(i){if(!k_(i)||"privy"!==e.recoveryMethod)throw i;await n.recover({accessToken:s,entropyId:t,entropyIdVerifier:r})}await n.createDelegatedAction({accessToken:s,rootWallet:{address:e.address,chainType:e.chainType,imported:!0},delegatedWallets:[{address:e.address,chainType:e.chainType,walletIndex:e.walletIndex??0}]})}return await i(),{success:!0}},[e.embeddedWallets.mode,t,n,r,i])}})(),{user:r}=(0,rc.u)(),{walletProxy:i}=(0,rp.u)(),n=(0,W.useRef)(!1);return(0,W.useEffect)(()=>{!e&&!n.current&&r&&i&&(n.current=!0,t().catch(e=>{console.debug("Unable to migrate wallets: ",e)}).finally(()=>{n.current=!1}))},[r,i,e,t]),null},k4=(0,su.create)(()=>({ethereum:[]}));class k7{async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(n7,{token:this.meta.token})}catch(e){throw(0,rp.f)(e)}}async link(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(n9,{token:this.meta.token})}catch(e){throw(0,rp.f)(e)}}constructor(e){this.meta={token:e}}}let k9=(0,su.create)(()=>({jwtAuthFlowState:{status:"not-enabled"}}));function Ce({customAuth:e}){let{jwtAuthFlowState:t}=function({customAuth:e}){let t=(0,sd.a)(),r=(0,W.useRef)(),i=(0,W.useCallback)(e=>(r.current=e,()=>{r.current=void 0}),[]),n=e?.getCustomAccessToken??(()=>Promise.resolve(void 0)),{state:s}=function({subscribe:e,getExternalJwt:t,enabled:r=!0,onAuthenticated:i,onUnauthenticated:n,onError:s}){let{client:a,onCustomAuthAuthenticated:o}=(0,rp.u)(),{logout:l,authenticated:c,ready:d}=(0,so.u)();if(!a)throw new rp.a("`useSyncJwtBasedAuthState` must be used within a `PrivyProvider`");let[u,h]=(0,W.useState)({status:"initial"}),p=(0,W.useRef)(),f=(0,W.useRef)(!1),y=(0,W.useRef)(t);(0,W.useEffect)(()=>{y.current=t},[t]);let g=(0,W.useRef)(i);(0,W.useEffect)(()=>{g.current=i},[i]);let m=(0,W.useRef)(n);(0,W.useEffect)(()=>{m.current=n},[n]);let w=(0,W.useRef)(s);return(0,W.useEffect)(()=>{w.current=s},[s]),(0,W.useEffect)(()=>{if(!r||!d)return;let t=async()=>{if(!f.current){f.current=!0;try{h({status:"loading"});let e=await y.current();if(void 0!==p.current&&p.current===e)return void h({status:"done"});if(!e)return c&&(await l(),m.current?.()),p.current=e,void h({status:"done"});a.startAuthFlow(new k7(e));let{user:t,isNewUser:r=!1}=await a.authenticate();if(!t)throw new rp.a("Failed to sync with custom auth provider");g.current?.({user:t,isNewUser:r}),o(t,r),p.current=e,h({status:"done"})}catch(e){if(console.warn(e),await l().catch(()=>{}),m.current?.(),e instanceof rp.e&&e.privyErrorCode===rp.b.LINKED_TO_ANOTHER_USER)return h({status:"initial"}),void setTimeout(()=>{t()},0);w.current?.(e),h({status:"error",error:e})}finally{f.current=!1}}};return t(),e(t)},[e,a,o,c,l,r,d]),r?{state:u}:{state:{status:"not-enabled"}}}({enabled:!0===e?.enabled,subscribe:i,getExternalJwt:n,onAuthenticated:({user:e,isNewUser:r})=>{t("login","onComplete",{user:e,isNewUser:r,wasAlreadyAuthenticated:!1,loginMethod:"custom",loginAccount:null}),t("customAuth","onAuthenticated",{user:e})},onUnauthenticated:()=>{t("customAuth","onUnauthenticated")},onError:e=>{t("login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR)}});return(0,W.useEffect)(()=>{(async()=>{e&&!e.isLoading&&r.current?.()})()},[e?.enabled,e?.getCustomAccessToken,e?.isLoading]),{jwtAuthFlowState:s}}({customAuth:e});return(0,W.useEffect)(()=>{k9.setState({jwtAuthFlowState:t})},[t]),null}let Ct=(0,W.createContext)(!1),Cr=t=>{let r=t.client,i=t.privy,n=(0,so.c)(),d=(0,nn.u)();(0,ru.d)((0,ru.e)(d?.appearance.walletList??[]));let[u,h]=(0,W.useState)(!1),p=T9(e=>e.inProgressMfaFlow),[f,y]=(0,W.useState)(!1),[g,m]=(0,W.useState)(null),w=k4(e=>e.ethereum),[b,v]=(0,W.useState)(void 0),[E,A]=(0,W.useState)(!1),[_,S]=(0,W.useState)(null),[I,x]=(0,W.useState)(!1),[T,k]=(0,W.useState)({status:"disconnected",connectedWallet:null,connectError:null,connector:null,connectRetry:rp.n}),[C,P]=(0,W.useState)({status:"initial"}),[O,R]=(0,W.useState)({status:"initial"}),[N,M]=(0,W.useState)({status:"initial"}),[U,D]=(0,W.useState)({status:"initial"}),[j,L]=(0,W.useState)({status:"initial"}),[F,z]=(0,W.useState)({status:"initial"}),[H,K]=(0,W.useState)(null),$=(0,nn.c)(),[V,J]=(0,W.useState)({}),[Z,G]=(0,W.useState)(null),Y=(0,W.useRef)(null),[Q,X]=(0,W.useState)(!1),[ee,et]=(0,W.useState)(!1),er=(0,W.useRef)(null),ei=(0,W.useRef)(null),en=(0,W.useRef)(sd.p),[es,ea]=(0,W.useState)(!1),[eo,el]=(0,W.useState)(!1),ec=(0,W.useCallback)(e=>{el(e),!e&&_&&T7[_]().then(e=>{e.default.isUnauthenticatedScreem&&S(null)})},[_]);r.onStoreCustomerAccessToken=e=>{e&&(0,sd.e)(en,"accessToken","onAccessTokenGranted",{accessToken:e})},r.onDeleteCustomerAccessToken=()=>{m(null),ec(!1),(0,sd.e)(en,"accessToken","onAccessTokenRemoved")};let ed=(0,W.useRef)(null),eu=(0,W.useRef)(null),eh=(0,W.useRef)(!1),ep=({showWalletUIs:e})=>eh.current?eh.current:void 0!==e?!e:!d.embeddedWallets.showWalletUIs,ef=e=>{S(e),setTimeout(()=>{h(!0)},15)};(0,W.useEffect)(()=>{if(!g)return void r.connectors?.removeEmbeddedWalletConnectors();let e=(0,rc.b)(g),n=(0,rc.e)(g),s=(0,rc.f)(g);e&&n.length||r.connectors?.removeEmbeddedWalletConnectors(),s.length||r.connectors?.removeImportedWalletConnectors(),r.connectors?H?(e&&r.connectors.addEmbeddedWalletConnectors({walletProxy:H,user:g,embeddedWallets:n,defaultChain:d.defaultChain,appId:t.appId,privyClient:i}),s.forEach(e=>r.connectors?.addImportedWalletConnector(H,e.address,d.defaultChain,t.appId))):console.debug("Failed to add embedded wallet connector: Wallet proxy not initialized"):console.debug("Failed to add embedded wallet connector: Client connectors not initialized")},[H,g]),(0,W.useEffect)(()=>{H&&Y.current?.(H)},[H]);let ey=(0,W.useCallback)((e,t)=>{m(e),A(t),ec(!0),et(!0)},[]);(0,W.useEffect)(()=>{ee&&H&&g&&(async()=>{let e=k1(g,d.embeddedWallets.ethereum.createOnLogin),t=k3(g,d.embeddedWallets.solana.createOnLogin),r=await Tk();if(r){if(e&&t){let e=await H.create({accessToken:r});return await H.createSolana({accessToken:r,ethereumAddress:e?.address}),void et(!1)}if(t)return await H.createSolana({accessToken:r,ethereumAddress:(0,rc.b)(g)?.address}),await eR.refreshSessionAndUser(),void et(!1);if(e)return await H.create({accessToken:r}),void et(!1)}})().catch(console.error)},[ee&&H&&g]),(0,W.useEffect)(()=>{if(d.externalWallets.solana.connectors)return d.externalWallets.solana.connectors.onMount(),()=>d.externalWallets.solana.connectors?.onUnmount()},[d.externalWallets.solana.connectors]),(0,W.useEffect)(()=>{!f&&$&&async function(){let e,t,i,n,s,a=eg(),o=em(),l=(e=new Set,t=[],n=(i=()=>(function(e){if("undefined"==typeof window)return;let t=t=>e(t.detail);return window.addEventListener("eip6963:announceProvider",t),window.dispatchEvent(new CustomEvent("eip6963:requestProvider")),()=>window.removeEventListener("eip6963:announceProvider",t)})(r=>{t.some(({info:e})=>e.uuid===r.info.uuid)||(t=[...t,r],e.forEach(e=>e(t,{added:[r]})))}))(),{_listeners:()=>e,clear(){e.forEach(e=>e([],{removed:[...t]})),t=[]},destroy(){this.clear(),e.clear(),n?.()},findProvider:({rdns:e})=>t.find(t=>t.info.rdns===e),getProviders:()=>t,reset(){this.clear(),n?.(),n=i()},subscribe:(r,{emitImmediately:i}={})=>(e.add(r),i&&r(t,{added:t}),()=>e.delete(r))});r.initializeConnectorManager({walletConnectCloudProjectId:d.walletConnectCloudProjectId,rpcConfig:d.rpcConfig,chains:d.chains,defaultChain:d.defaultChain,store:l,walletList:d.appearance.walletList,shouldEnforceDefaultChainOnConnect:d.shouldEnforceDefaultChainOnConnect,externalWalletConfig:d.externalWallets,appName:d.name??"Privy",walletChainType:d.appearance.walletChainType,setBaseAccountSdk:v}),r.connectors?.on("connectorInitialized",()=>{s&&clearTimeout(s);let e=r.connectors.walletConnectors.length,t=r.connectors.walletConnectors.reduce((e,t)=>e+ +!!t.initialized,0);t===e?ea(!0):s=setTimeout(()=>{console.debug({message:"Unable to initialize all expected connectors before timeout",initialized:t,expected:e}),ea(!0)},1500)}),r.connectors?.initialize().then(()=>{eA()});let c=await r.getAuthenticatedUser(),u=!!c;d.legal.requireUsersAcceptTerms&&c&&!c.hasAcceptedTerms?(await r.logout(),eR.setReadyToTrue(!0),(0,sd.e)(en,"logout","onSuccess")):(d.customAuth?.enabled||(ec(!!c),c&&(0,sd.e)(en,"login","onComplete",{user:c,isNewUser:!1,wasAlreadyAuthenticated:!0,loginMethod:null,loginAccount:null}),m(c)),a?eu.current=u?"link":"login":o&&!u?(eu.current="login",J({telegramAuthModalData:{seamlessAuth:!0}}),ef("TelegramAuthScreen")):eR.setReadyToTrue(!!c))}()},[r,Z,f,$]),(0,W.useEffect)(()=>{if(f){if(!g||!g.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType))return void X(!!H);if([...w].some(e=>"privy"===e.walletClientType))return void X(!0);X(!!H)}},[f,g,w,H]),(0,W.useEffect)(()=>{r.connectors?.setWalletList(d.appearance.walletList)},[d.appearance.walletList.join()]);let eg=()=>{let e=function(){let e=new URLSearchParams(window.location.search),t=e.get("privy_oauth_code"),r=e.get("privy_oauth_state"),i=e.get("privy_oauth_provider");if(!t||!r||!i)return{inProgress:!1};let n=!1;try{n=!!window.opener.location.origin}catch{}return{inProgress:!0,authorizationCode:t,stateCode:r,provider:i,withPrivyUi:!rf.u.get(nn.H),popupFlow:null!==window.opener&&n,disableSignup:!!rf.u.get(nn.O)}}();return e.inProgress&&e.popupFlow?window.opener.location.origin!==window.location.origin?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Origins between parent and child windows do not match."}):"error"===e.authorizationCode?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Something went wrong. Try again."}):void window.opener.postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:e.stateCode,authorizationCode:e.authorizationCode}):(e.inProgress&&e.provider.startsWith("privy:")&&!e.popupFlow&&(new BroadcastChannel(kB).postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:e.stateCode,authorizationCode:e.authorizationCode}),window.close()),!!e.inProgress&&!!e.withPrivyUi&&(r.startAuthFlow(new Tq({...e,customOAuthRedirectUrl:d.customOAuthRedirectUrl})),ef("OAuthStatusScreen"),!0))},em=()=>{let e,t=(e=function(){let e=new URLSearchParams(window.location.search),t=Number(e.get("id")||""),r=e.get("hash"),i=Number(e.get("auth_date")||""),n=e.get("first_name");if(t&&n&&i&&r)return Object.fromEntries(e.entries())}())?(T5(),{flowType:"login-url",authData:e}):(e=function(){let e=window.location.hash;if(!e||!e.startsWith("#tgWebAppData"))return;let t=T3(e.replace("#tgWebAppData=","")),{user:r,auth_date:i,hash:n}=t;return r&&i&&n?t:void 0}())?(T5(),{flowType:"web-app",authData:e}):void 0;if(!t||!d.loginMethods.telegram||!d.loginConfig.telegramAuthConfiguration?.seamlessAuthEnabled)return;let i=new T1;return r.startAuthFlow(i),"login-url"===t.flowType&&(i.meta.telegramWebAppData=void 0,i.meta.telegramAuthResult=t.authData),"web-app"===t.flowType&&(i.meta.telegramAuthResult=void 0,i.meta.telegramWebAppData=t.authData),!0},ew=async(e,t,i,n)=>{if("solana_adapter"!==e)eb(await r.connectors?.createEthereumWalletConnector({connectorType:e,walletClientType:t})||null,t,i,n);else{let e=r.connectors?.findSolanaWalletConnector(t);if(!e)return;eb(e,t,i,n)}};async function eb(e,t,r,i){if(!e)return k({status:"disconnected",connectedWallet:null,connectError:new rp.P("Unable to connect to wallet."),connector:null,connectRetry:rp.n}),i?.(null,r);k({status:"disconnected",connectedWallet:null,connectError:null,connector:e,connectRetry:rp.n}),e instanceof kb&&t&&await e.resetConnection(t),k({connector:e,status:"connecting",connectedWallet:null,connectError:null,connectRetry:()=>eb(e,t,r,i)});try{let t=await e.connect({showPrompt:!0});if((!t||(0,ru.f)(t))&&d.shouldEnforceDefaultChainOnConnect&&!d.chains.find(e=>e.id===Number(t?.chainId.replace("eip155:","")))&&("wallet_connect_v2"!==t?.connectorType||"metamask"!==t?.walletClientType)){k(t=>({...t,connector:e,status:"switching_to_supported_chain",connectedWallet:null,connectError:null,connectRetry:rp.n}));try{await t?.switchChain(d.defaultChain.id),t&&(t.chainId=(0,ru.h)((0,na.toHex)(d.defaultChain.id)))}catch{console.warn(`Unable to switch to default chain: ${d.defaultChain.id}`)}}return k(e=>({...e,status:"connected",connectedWallet:t,connectError:null,connectRetry:rp.n})),t&&(0,sd.e)(en,"connectWallet","onSuccess",{wallet:t}),i?.(t,r)}catch(e){return e instanceof rp.c?(console.warn(e.cause?e.cause:e.message),(0,sd.e)(en,"connectWallet","onError",e.privyErrorCode||rp.b.GENERIC_CONNECT_WALLET_ERROR)):(console.warn(e),(0,sd.e)(en,"connectWallet","onError",rp.b.UNKNOWN_CONNECT_WALLET_ERROR)),k(t=>({...t,status:"disconnected",connectedWallet:null,connectError:e})),i?.(null,r)}}let ev=async(e,t,i)=>{if(null===e||!(0,ru.f)(e))return;let n=new TV(r,e,t,i);r.startAuthFlow(n)},eE=async(e,t,i,s="plain")=>{let a=n(so.e);if("transaction"===s&&!a)throw new rp.a("useSolanaLedger plugin hook must be mounted");if(null===e||!(0,ru.l)(e))return;let o=new TJ(e,r,t,i,s,a);r.startAuthFlow(o)},eA=async()=>{let e=new URLSearchParams(window.location.search),t=e.get("privy_connector"),i=e.get("privy_wallet_client"),n="true"===e.get("privy_connect_only");if(!t||!i)return;let s=(0,ru.n)({connectorType:t,walletClientType:i});if(!s||!s.isInstalled)return ef("LoginFailedScreen");if(!r.connectors)throw new rp.a("Connector not initialized");await ef(n?"ConnectOnlyStatusScreen":"ConnectionStatusScreen");let a=new URL(window.location.href);a.searchParams.delete("privy_connector"),a.searchParams.delete("privy_wallet_client"),a.searchParams.delete("privy_connect_only"),window.history.pushState({},"",a),ew(t,i,void 0,n?void 0:"solana_adapter"===t?eE:ev)};(0,W.useEffect)(()=>{f&&eo&&null===g&&r.getAuthenticatedUser().then(m)},[f,eo,g,r]);let e_=e=>{if(!eo)throw(0,sd.e)(en,"linkAccount","onError",rp.b.MUST_BE_AUTHENTICATED,{linkMethod:e}),new rp.a("User must be authenticated before linking an account.")},eS=()=>{k4.setState(e=>{let t=r.connectors?.wallets.filter(ru.f).map(e=>({...e,linked:(e=>{if(!eo||!g)return!1;if("privy"===e.walletClientType)return!0;for(let t of g.linkedAccounts)if("wallet"===t.type&&t.address===e.address&&"privy"!==t.walletClientType)return!0;return!1})(e),loginOrLink:async()=>{if(!await e.isConnected())throw new rp.a("Wallet is not connected");if("embedded"===e.connectorType&&"privy"===e.walletClientType)throw new rp.a("Cannot link or login with embedded wallet");(async e=>{let t;if(!r.connectors)throw new rp.a("Connector not initialized");t="ethereum"===e.type?r.connectors.findWalletConnector(e.connectorType,e.walletClientType)||null:r.connectors.findSolanaWalletConnector(e.walletClientType)||null,k(r=>({...r,connector:t,status:"connected",connectedWallet:e,connectError:null,connectRetry:rp.n})),d.captcha.enabledProvider&&!eo?(J({captchaModalData:{callback:t=>(0,ru.f)(e)?ev(e,t):eE(e,t),userIntentRequired:!1,onSuccessNavigateTo:"ConnectionStatusScreen",onErrorNavigateTo:"ErrorScreen"}}),await ef("CaptchaScreen")):((0,ru.f)(e)?await ev(e):await eE(e),await ef("ConnectionStatusScreen"))})(e)},fund:async t=>{await eR.fundWallet(e.address,t)},unlink:async()=>{if(!eo)throw new rp.a("User is not authenticated.");if("embedded"===e.connectorType&&"privy"===e.walletClientType)throw new rp.a("Cannot unlink an embedded wallet");m(await r.unlinkEthereumWallet(e.address))}}))||[];return(0,ru.j)(e.ethereum,t)?{}:{ethereum:t}})};(0,W.useEffect)(()=>{eS()},[g?.linkedAccounts,eo,f]),(0,W.useEffect)(()=>{if(f){if(!r.connectors)throw new rp.a("Connector not initialized");eS(),r.connectors.on("walletsUpdated",eS)}},[f]),(0,W.useEffect)(()=>{[...d.loginMethodsAndOrder?.primary??[],...d.loginMethodsAndOrder?.overflow??[]].filter(e=>e.startsWith("privy:")).forEach(e=>r.getCrossAppProviderDetails(e.replace("privy:","")))},[!!r]);let eI=({transaction:e,sponsor:n,uiOptions:s,fundWalletConfig:a,address:o,signOnly:l})=>new Promise(async(c,u)=>{let{requesterAppId:h}=s||{},p=l?"signTransaction":"sendTransaction",f=o?(0,rc.h)(g,o):(0,rc.b)(g);if(!f&&o){let t=(0,rc.k)(k4.getState().ethereum,o);if(t){if(n)throw new rp.a("Cannot sponsor transactions for externally connected wallet.");try{let r=await t.getEthereumProvider(),i={...e,from:o,chainId:e.chainId||Number(t.chainId.replace("eip155:","")),value:void 0!==e.value?(0,na.toHex)(e.value):void 0},n=await r.request({method:"sendTransaction"===p?"eth_sendTransaction":"eth_signTransaction",params:[i]});return(0,sd.e)(en,p,"onSuccess",{hash:n}),void c({hash:n})}catch(e){return(0,sd.e)(en,p,"onError",rp.b.TRANSACTION_FAILURE),void u(e??new rf.P("Unable to "+p+e))}}}if(!f)return(0,sd.e)(en,p,"onError",rp.b.EMBEDDED_WALLET_NOT_FOUND),void u(new rp.a("No embedded or connected wallet found for address."));if(!eo||!g)return(0,sd.e)(en,p,"onError",rp.b.MUST_BE_AUTHENTICATED),void u(Error("User must be authenticated before signing with a Privy wallet"));let y=f.address,m=f.walletIndex??0,{entropyId:w,entropyIdVerifier:b}=(0,rh.g)(g,f),v=eN.wallets.find(e=>"privy"===e.walletClientType&&(0,nl.getAddress)(e.address)===(0,nl.getAddress)(y));if(!v)return(0,sd.e)(en,p,"onError",rp.b.EMBEDDED_WALLET_NOT_FOUND),void u(Error("Must have a Privy wallet before signing"));let E=await v.getEthereumProvider(),A=await E.request({method:"eth_chainId"}),_=e.chainId?Number(e.chainId):(0,rf.b)(A);if(!d.chains.map(e=>e.id).includes(_))throw new rp.P(`Chain ID ${_} is not supported. It must be added to the config.supportedChains property of the PrivyProvider.`,rp.b.UNSUPPORTED_CHAIN_ID);let S={...e,from:e.from??y,chainId:_},I=await Tk();if(!I||!H)return(0,sd.e)(en,p,"onError",rp.b.EMBEDDED_WALLET_NOT_FOUND),void u(Error("Must have valid access token and Privy wallet to send transaction"));let x=(0,EP.g)(S.chainId,d.chains,d.rpcConfig,{appId:t.appId}),T=(0,rc.d)(f),k=async({transactionRequest:e})=>{try{let t;if(!await eR.recoverEmbeddedWallet({address:y}))throw(0,sd.e)(en,p,"onError",rp.b.UNKNOWN_CONNECT_WALLET_ERROR),u(Error("Unable to connect to wallet")),Error("Unable to connect to wallet");if(n){let t=await (async({transactionRequest:e})=>{if(!T)throw new rp.a("Sponsoring is only supported for wallets on the TEE stack");if(l)throw new rp.a("Cannot sponsor a sign transaction request");let t=e=>null==e?void 0:(0,na.toHex)(e),r=await (0,q.rpc)(i,async({message:e})=>await H.signWithUserSigner({accessToken:I,requesterAppId:h,message:e}),{chain_type:"ethereum",method:"eth_sendTransaction",caip2:(0,ru.h)((0,na.toHex)(e.chainId)),sponsor:!0,params:{transaction:{from:e.from,to:e.to,chain_id:t(e.chainId),data:(0,nc.isHex)(e.data)?e.data?e.data:(0,na.toHex)(Uint8Array.from(e.data)):void 0,value:t(e.value)}},wallet_id:f.id});if(r.data&&"hash"in r.data)return r.data.hash;throw new rf.P("Unable to sign transaction")})({transactionRequest:e});return(0,sd.e)(en,"sendTransaction","onSuccess",{hash:t}),t}if(T){let r=e=>null==e?void 0:(0,na.toHex)(e),n=await (0,q.rpc)(i,async({message:e})=>await H.signWithUserSigner({accessToken:I,requesterAppId:h,message:e}),{chain_type:"ethereum",method:"eth_signTransaction",params:{transaction:{from:e.from,to:e.to,nonce:r(e.nonce),chain_id:r(e.chainId),data:(0,nc.isHex)(e.data)?e.data?e.data:(0,na.toHex)(Uint8Array.from(e.data)):void 0,value:r(e.value),type:e.type,gas_limit:r(e.gasLimit??e.gas),gas_price:r(e.gasPrice??e.gas),max_fee_per_gas:r(e.maxFeePerGas),max_priority_fee_per_gas:r(e.maxPriorityFeePerGas)}},wallet_id:f.id});if(!n.data||!("signed_transaction"in n.data))throw new rf.P("Unable to sign transaction");t=n.data.signed_transaction}else t=await async function({accessToken:e,entropyId:t,entropyIdVerifier:r,transactingWalletIndex:i,walletProxy:n,transactionRequest:s,requesterAppId:a}){return(await n.rpc({entropyId:t,entropyIdVerifier:r,hdWalletIndex:i??0,chainType:"ethereum",accessToken:e,requesterAppId:a,request:{method:"eth_signTransaction",params:[s]}})).response.data}({accessToken:I,entropyId:w,entropyIdVerifier:b,transactingWalletIndex:m,walletProxy:H,transactionRequest:e,requesterAppId:h});if(l)return(0,sd.e)(en,"signTransaction","onSuccess",{signature:t}),t;{let e=await x.sendRawTransaction({serializedTransaction:t});return(0,sd.e)(en,"sendTransaction","onSuccess",{hash:e}),e}}catch(e){throw(0,sd.e)(en,p,"onError",rp.b.TRANSACTION_FAILURE),e}};if(ep({showWalletUIs:s?.showWalletUIs})){let e=l||n?S:await k8(S,x,S.from);try{let t=await k({transactionRequest:e});l?(0,sd.e)(en,"signTransaction","onSuccess",{signature:t}):(0,sd.e)(en,"sendTransaction","onSuccess",{hash:t}),c({hash:t})}catch(e){(0,sd.e)(en,p,"onError",rp.b.TRANSACTION_FAILURE),u(e)}}else{let e={connectingWalletAddress:y,recoveryMethod:f.recoveryMethod,entropyId:w,entropyIdVerifier:b,onCompleteNavigateTo:"SendTransactionScreen",isUnifiedWallet:T,onFailure:e=>{(0,sd.e)(en,p,"onError",rp.b.UNKNOWN_CONNECT_WALLET_ERROR),u(e)}},t=d.fundingConfig&&(0,rf.a)(d.fundingConfig.options).length>=1?(0,rf.p)({address:y,appConfig:d,fundWalletConfig:a,methodScreen:"FundingMethodSelectionScreen",chainIdOverride:S.chainId,comingFromSendTransactionScreen:!0}):void 0;J({connectWallet:e,sendTransaction:{transactionRequest:S,transactingWalletIndex:m,transactingWalletAddress:y,entropyId:w,entropyIdVerifier:b,signOnly:l,scanTransaction:async()=>{let e=await k8(S,x,S.from);return await r.scanTransaction({metadata:{domain:d.embeddedWallets.transactionScanning.domain},chain_id:e.chainId.toString(),request:{method:"eth_sendTransaction",params:[{from:e.from,to:e.to,value:e.value?.toString(),gas:e.gas?.toString(),gasPrice:e.gasPrice?.toString(),nonce:e.nonce?.toString(),data:e.data}]}})},getIsSponsored:async()=>!!n,onConfirm:({transactionRequest:e})=>k({transactionRequest:e}),onSuccess:e=>{l?(0,sd.e)(en,"signTransaction","onSuccess",{signature:e.hash}):(0,sd.e)(en,"sendTransaction","onSuccess",{hash:e.hash}),c(e)},onFailure:e=>{(0,sd.e)(en,p,"onError",rp.b.TRANSACTION_FAILURE),u(e)},uiOptions:s||{},fundWalletConfig:a,requesterAppId:h},funding:t}),ef("EmbeddedWalletConnectingScreen")}});function ex(){return new Promise(async(e,t)=>{let r=await Tk();if(!r||!H)throw Error("Must have valid access token to enroll in MFA");try{await H.verifyMfa({accessToken:r}),e()}catch(e){t(e)}})}let eT=e=>e?.linkedAccounts.filter(e=>null!==e.latestVerifiedAt&&("wallet"!==e.type||"privy"!==e.walletClientType)).sort((e,t)=>t.latestVerifiedAt.getTime()-e.latestVerifiedAt.getTime())[0],ek=e=>{let t=g?.linkedAccounts.filter(t=>t.type===e).length??0,{displayName:r,loginMethod:i}=k0(e);if("passkey"===e&&t>=5||"passkey"!==e&&t>=1)throw(0,sd.e)(en,"linkAccount","onError",rp.b.CANNOT_LINK_MORE_OF_TYPE,{linkMethod:i}),new rp.a(`User already has an account of type ${r} linked.`)};async function eC({showAutomaticRecovery:e=!1,legacySetWalletPasswordFlow:t=!1}){S(null);let r=t?"setWalletPassword":"setWalletRecovery";if(!eo||!g)throw(0,sd.e)(en,r,"onError",rp.b.MUST_BE_AUTHENTICATED),Error("User must be authenticated before adding recovery method to Privy wallet");let i=(0,rc.g)(g);if(!i||!H)throw(0,sd.e)(en,r,"onError",rp.b.EMBEDDED_WALLET_NOT_FOUND),Error("Must have a Privy wallet to add a recovery method");let n=(0,rc.d)(i);if(n)throw(0,sd.e)(en,r,"onError",rp.b.UNSUPPORTED_WALLET_TYPE),new rp.a("User owned wallet recovery is only supported for on-device execution and this app uses TEE execution. Learn more https://docs.privy.io/recipes/tee-wallet-migration-guide");try{await ex()}catch(e){throw(0,sd.e)(en,r,"onError",rp.b.MISSING_MFA_CREDENTIALS),e}return new Promise((s,a)=>{let o="user-passcode"===i.recoveryMethod,l=kV({walletAction:"update",availableRecoveryMethods:d.embeddedWallets.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:t,isResettingPassword:o,showAutomaticRecovery:e}),{entropyId:c,entropyIdVerifier:u}=(0,rh.g)(g),h={recoveryMethod:i.recoveryMethod,connectingWalletAddress:i.address,onCompleteNavigateTo:l,shouldForceMFA:!1,entropyId:c,isUnifiedWallet:n,entropyIdVerifier:u,onFailure:e=>{(0,sd.e)(en,r,"onError",rp.b.UNKNOWN_CONNECT_WALLET_ERROR),a(e)}};J({setWalletPassword:{onSuccess:e=>{(0,sd.e)(en,r,"onSuccess",{method:"user-passcode",wallet:e}),s(e)},onFailure:e=>{(0,sd.e)(en,r,"onError",rp.b.USER_EXITED_SET_PASSWORD_FLOW),a(e)},callAuthOnSuccessOnClose:!1},recoverWallet:{entropyId:c,entropyIdVerifier:u,onFailure:a},connectWallet:h,recoverySelection:{isInAccountCreateFlow:!1,isResettingPassword:o,shouldCreateEth:!1,shouldCreateSol:!1}}),ef("EmbeddedWalletConnectingScreen")})}async function eP({appId:e,action:t}){let i=await Tk();if("link"===t&&!i)throw(0,sd.e)(en,"linkAccount","onError",rp.b.MUST_BE_AUTHENTICATED,{linkMethod:`privy:${e}`}),new rp.a("User must be authenticated before linking an account.");if("login"===t&&i)throw(0,sd.e)(en,"login","onError",rp.b.UNKNOWN_AUTH_ERROR),new rp.a("Attempted to log in, but user is already logged in. Use a `link` helper instead.");ed.current=`privy:${e}`,eu.current=t;let n=(0,nu.trigger)();return r.createAnalyticsEvent({eventName:"cross_app_auth_started",payload:{providerAppId:e}}),new Promise(async(i,s)=>{let{name:a,logoUrl:o}=await kz({api:r.api,providerAppId:e,requesterAppId:d.id});J({crossAppAuth:{appId:e,name:a,logoUrl:o,action:t,popup:n,onSuccess:i,onError:s}}),ef("CrossAppAuthScreen")})}let eO={ready:f,authenticated:eo,user:g,walletConnectors:r.connectors||null,connectWallet:e=>{e&&"target"in e&&e&&(e=void 0),J({externalConnectWallet:{walletList:e?.walletList&&e?.walletList.length>0?e.walletList:void 0,walletChainType:e?.walletChainType,description:e?.description,hideHeader:e?.hideHeader}}),ef("ConnectOnlyLandingScreen")},linkWallet:e=>(e&&"target"in e&&e&&(e=void 0),e_("siwe"),ed.current="siwe",eu.current="link",J({...V,externalConnectWallet:{...V.externalConnectWallet,walletList:e?.walletList,walletChainType:e?.walletChainType,description:e?.description||`Link a wallet to your ${d?.name} account`}}),ef("AuthenticateWithWalletScreen")),startCrossAppAuthFlow:eP,linkEmail:()=>{e_("email"),ek("email"),ed.current="email",eu.current="link",ef("LinkEmailScreen")},linkPhone:()=>{e_("sms"),ek("phone"),ed.current="sms",eu.current="link",ef("LinkPhoneScreen")},linkGoogle:async()=>{e_("google"),ek("google_oauth"),eu.current="link",await eR.initLoginWithOAuth("google")},linkTwitter:async()=>{e_("twitter"),ek("twitter_oauth"),eu.current="link",await eR.initLoginWithOAuth("twitter")},linkTwitch:async()=>{e_("twitch"),ek("twitch_oauth"),eu.current="link",await eR.initLoginWithOAuth("twitch")},linkDiscord:async()=>{e_("discord"),ek("discord_oauth"),eu.current="link",await eR.initLoginWithOAuth("discord")},linkGithub:async()=>{e_("github"),ek("github_oauth"),eu.current="link",await eR.initLoginWithOAuth("github")},linkSpotify:async()=>{e_("spotify"),ek("spotify_oauth"),eu.current="link",await eR.initLoginWithOAuth("spotify")},linkInstagram:async()=>{e_("instagram"),ek("instagram_oauth"),eu.current="link",await eR.initLoginWithOAuth("instagram")},linkTiktok:async()=>{e_("tiktok"),ek("tiktok_oauth"),eu.current="link",await eR.initLoginWithOAuth("tiktok")},linkLine:async()=>{e_("line"),ek("line_oauth"),eu.current="link",await eR.initLoginWithOAuth("line")},linkLinkedIn:async()=>{e_("linkedin"),ek("linkedin_oauth"),eu.current="link",await eR.initLoginWithOAuth("linkedin")},linkApple:async()=>{e_("apple"),ek("apple_oauth"),eu.current="link",await eR.initLoginWithOAuth("apple")},linkPasskey:async()=>{e_("passkey"),ek("passkey"),await eR.initLinkWithPasskey(),ef("LinkPasskeyScreen")},linkTelegram:async e=>{if(e_("telegram"),ek("telegram"),eu.current="link",ed.current="telegram",e?.launchParams)if(e.launchParams.initDataRaw){let t=new T1;r.startAuthFlow(t),t.meta.telegramAuthResult=void 0,t.meta.telegramWebAppData=T3(e.launchParams.initDataRaw),J({telegramAuthModalData:{seamlessAuth:!0}}),ef("TelegramAuthScreen")}else(0,sd.e)(en,"linkAccount","onError",rp.b.INVALID_DATA,{linkMethod:"telegram"});else await eR.initLoginWithTelegram();ef("TelegramAuthScreen")},linkFarcaster:async()=>{e_("farcaster"),ek("farcaster"),await eR.initLoginWithFarcaster(),eu.current="link",ed.current="farcaster",ef("FarcasterConnectStatusScreen")},updateEmail:()=>{if(e_("email"),!g?.email)throw new rp.a("User does not have an email linked to their account.");eu.current="update",ed.current="email",ef("UpdateEmailScreen")},updatePhone:()=>{if(e_("sms"),!g?.phone)throw new rp.a("User does not have a phone number linked to their account.");eu.current="update",ed.current="sms",ef("UpdatePhoneScreen")},login:async e=>{e&&"target"in e&&e&&(e=void 0);let t="Attempted to log in, but user is already logged in. Use a `link` helper instead.";if(!f){let e=await new Promise(e=>{G(t=>e.bind(t))});if(G(null),e)return void console.warn(t)}!g||g.isGuest?(eu.current="login",J({login:e}),ef("LandingScreen")):console.warn(t)},connectOrCreateWallet:async()=>{f||(await new Promise(e=>{G(()=>e)}),G(null)),eo?console.warn("User must be unauthenticated to `connectOrCreateWallet`"):(eu.current="connect-or-create",ef("ConnectOrCreateScreen"))},logout:async()=>{if(eu.current=null,ed.current=null,g&&r.clearProviderAcccessTokens(g),S(null),await r.logout(),g&&H)try{await H.clearMfa({userId:g.id})}catch(e){}m(null),ec(!1),R({status:"initial"}),M({status:"initial"}),P({status:"initial"}),D({status:"initial"}),L({status:"initial"}),z({status:"initial"}),(0,sd.e)(en,"logout","onSuccess"),h(!1),rf.u.del(nn.d),rf.u.del((0,nn.g)(d.id))},getAccessToken:(0,W.useCallback)(async()=>{let e=await r.getCustomerAccessToken();return e&&!eo&&ec(!0),e},[r,eo]),unlinkWallet:async e=>{let t;return m(t=e.startsWith("0x")?await r.unlinkEthereumWallet(e):await r.unlinkSolanaWallet(e)),t},unlinkEmail:async e=>{let t=await r.unlinkEmail(e);return m(t),t},unlinkPhone:async e=>{let t=await r.unlinkPhone(e);return m(t),t},unlinkGoogle:async e=>{let t=await r.unlinkOAuth("google",e);return m(t),t},unlinkTwitter:async e=>{let t=await r.unlinkOAuth("twitter",e);return m(t),t},unlinkTwitch:async e=>{let t=await r.unlinkOAuth("twitch",e);return m(t),t},unlinkDiscord:async e=>{let t=await r.unlinkOAuth("discord",e);return m(t),t},unlinkGithub:async e=>{let t=await r.unlinkOAuth("github",e);return m(t),t},unlinkSpotify:async e=>{let t=await r.unlinkOAuth("spotify",e);return m(t),t},unlinkInstagram:async e=>{let t=await r.unlinkOAuth("instagram",e);return m(t),t},unlinkTiktok:async e=>{let t=await r.unlinkOAuth("tiktok",e);return m(t),t},unlinkLine:async e=>{let t=await r.unlinkOAuth("line",e);return m(t),t},unlinkLinkedIn:async e=>{let t=await r.unlinkOAuth("linkedin",e);return m(t),t},unlinkApple:async e=>{let t=await r.unlinkOAuth("apple",e);return m(t),t},unlinkFarcaster:async e=>{let t=await r.unlinkFarcaster(e);return m(t),t},unlinkTelegram:async e=>{let t=await r.unlinkTelegram(e);return m(t),t},unlinkPasskey:async e=>{let t=await Tk();if(!t)throw Error("Must have valid access token to enroll in MFA");if(!H)throw Error("Wallet proxy not initialized.");let i=d.passkeys.shouldUnenrollMfaOnUnlink;await H.unlinkPasskeyAccount({credentialId:e,accessToken:t,removeAsMfa:i});let n=await r.getAuthenticatedUser();return m(n),n},unlinkCrossAppAccount:async({subject:e})=>{let t=g?.linkedAccounts.find(t=>"cross_app"===t.type&&t.subject===e)?.providerApp;if(!t)throw new rp.a("Invalid subject");r.storeProviderAccessToken(t.id,null);let i=await r.unlinkOAuth(`privy:${t.id}`,e);return m(i),i},setWalletRecovery:async e=>eC({legacySetWalletPasswordFlow:!1,showAutomaticRecovery:e?.showAutomaticRecovery??!1}),setWalletPassword:async()=>eC({legacySetWalletPasswordFlow:!0,showAutomaticRecovery:!1}),signMessage:(e,t)=>new Promise(async(n,s)=>{let{requesterAppId:a}=t?.uiOptions||{},o=e.message,l=t?.address?(0,rc.h)(g,t.address):(0,rc.b)(g);if(!l&&void 0!==t?.address){let e=(0,rc.k)(k4.getState().ethereum,t.address);if(e)try{let t=await e.getEthereumProvider(),r=await t.request({method:"personal_sign",params:[o,e.address]});return(0,sd.e)(en,"signMessage","onSuccess",{signature:r}),void n({signature:r})}catch(e){return(0,sd.e)(en,"signMessage","onError",rp.b.UNABLE_TO_SIGN),void s(e??new rf.P("Unable to sign message"))}}if(!l)throw new rp.a("No embedded or connected wallet found for address.");if(!eo||!g)return(0,sd.e)(en,"signMessage","onError",rp.b.MUST_BE_AUTHENTICATED),void s(Error("User must be authenticated before signing with a Privy wallet"));let c=l.address,d=l.walletIndex??0,{entropyId:u,entropyIdVerifier:h}=(0,rh.g)(g,l),p=(0,rc.d)(l);if("string"!=typeof o||o.length<1)return(0,sd.e)(en,"signMessage","onError",rp.b.INVALID_MESSAGE),void s(Error("Message must be a non-empty string"));let f=async()=>{let t;if(!eo)throw Error("User must be authenticated before signing with a Privy wallet");let n=await Tk();if(!H||!n||!await eR.recoverEmbeddedWallet({address:c}))throw Error("Unable to connect to wallet");if(r.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_started",payload:{walletAddress:c,requesterAppId:a}}),p){let r=(0,nc.isHex)(e.message,{strict:!0}),s=await (0,q.rpc)(i,async({message:e})=>await H.signWithUserSigner({accessToken:n,requesterAppId:a,message:e}),{chain_type:"ethereum",method:"personal_sign",params:r?{message:o.slice(2),encoding:"hex"}:{message:o,encoding:"utf-8"},wallet_id:l.id});if(!s.data||!("signature"in s.data))throw new rf.P("Unable to sign message");t=s.data.signature}else{let{response:e}=await H.rpc({accessToken:n,entropyId:u,entropyIdVerifier:h,chainType:"ethereum",hdWalletIndex:d,requesterAppId:a,request:{method:"personal_sign",params:[o,c]}});t=e.data}return r.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_completed",payload:{walletAddress:c,requesterAppId:a}}),t};if(ep({showWalletUIs:t?.uiOptions?.showWalletUIs}))try{let e=await f();(0,sd.e)(en,"signMessage","onSuccess",{signature:e}),n({signature:e})}catch(e){(0,sd.e)(en,"signMessage","onError",rp.b.UNABLE_TO_SIGN),s(e??new rf.P("Unable to sign message"))}else J({signMessage:{method:"personal_sign",data:o,confirmAndSign:f,onSuccess:e=>{(0,sd.e)(en,"signMessage","onSuccess",{signature:e}),n({signature:e})},onFailure:e=>{(0,sd.e)(en,"signMessage","onError",rp.b.UNABLE_TO_SIGN),s(e)},uiOptions:t?.uiOptions||{}},connectWallet:{recoveryMethod:l.recoveryMethod,connectingWalletAddress:c,entropyId:u,entropyIdVerifier:h,onCompleteNavigateTo:"SignRequestScreen",isUnifiedWallet:p,onFailure:e=>{(0,sd.e)(en,"signMessage","onError",rp.b.UNKNOWN_CONNECT_WALLET_ERROR),s(e)}}}),ef("EmbeddedWalletConnectingScreen")}),signTypedData:(e,t)=>new Promise(async(n,s)=>{let{requesterAppId:a}=t?.uiOptions||{},o=t?.address?(0,rc.h)(g,t.address):(0,rc.b)(g);if(!o&&t?.address){let r=(0,rc.k)(k4.getState().ethereum,t.address);if(r)try{let t=await r.getEthereumProvider(),i=(0,ru.m)(e),s=await t.request({method:"eth_signTypedData_v4",params:[r.address,i]});return(0,sd.e)(en,"signTypedData","onSuccess",{signature:s}),void n({signature:s})}catch(e){return(0,sd.e)(en,"signTypedData","onError",rp.b.UNABLE_TO_SIGN),void s(e??new rf.P("Unable to sign typed data "+e))}}if(!o)throw new rp.a("No embedded or connected wallet found for address.");if(!eo||!g)return(0,sd.e)(en,"signTypedData","onError",rp.b.MUST_BE_AUTHENTICATED),void s(Error("User must be authenticated before signing with a Privy wallet"));let l=o.address,c=o.walletIndex??0,{entropyId:d,entropyIdVerifier:u}=(0,rh.g)(g,o),h=(0,rc.d)(o),p=(0,ru.m)(e),f=async()=>{let e;if(!eo)throw Error("User must be authenticated before signing with a Privy wallet");let t=await Tk();if(!H||!t||!await eR.recoverEmbeddedWallet({address:l}))throw Error("Unable to connect to wallet");if(r.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_started",payload:{walletAddress:l,requesterAppId:a}}),h){let{domain:r,types:n,primaryType:s,message:l}=p,c=await (0,q.rpc)(i,async({message:e})=>await H.signWithUserSigner({accessToken:t,requesterAppId:a,message:e}),{chain_type:"ethereum",method:"eth_signTypedData_v4",params:{typed_data:{domain:r,types:n,primary_type:s,message:l}},wallet_id:o.id});if(!c.data||!("signature"in c.data))throw new rf.P("Unable to sign message");e=c.data.signature}else{let{response:r}=await H.rpc({accessToken:t,entropyId:d,entropyIdVerifier:u,chainType:"ethereum",hdWalletIndex:c,requesterAppId:a,request:{method:"eth_signTypedData_v4",params:[l,p]}});e=r.data}return r.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_completed",payload:{walletAddress:l,requesterAppId:a}}),e};if(ep({showWalletUIs:t?.uiOptions?.showWalletUIs}))try{let e=await f();(0,sd.e)(en,"signTypedData","onSuccess",{signature:e}),n({signature:e})}catch(e){(0,sd.e)(en,"signTypedData","onError",rp.b.UNABLE_TO_SIGN),s(e??new rf.P("Unable to sign message"))}else J({signMessage:{method:"eth_signTypedData_v4",data:p,confirmAndSign:f,onSuccess:e=>{(0,sd.e)(en,"signTypedData","onSuccess",{signature:e}),n({signature:e})},onFailure:e=>{(0,sd.e)(en,"signTypedData","onError",rp.b.UNABLE_TO_SIGN),s(e)},uiOptions:t?.uiOptions||{}},connectWallet:{recoveryMethod:o.recoveryMethod,connectingWalletAddress:o.address,entropyId:d,isUnifiedWallet:h,entropyIdVerifier:u,onCompleteNavigateTo:"SignRequestScreen",onFailure:e=>{(0,sd.e)(en,"signMessage","onError",rp.b.UNKNOWN_CONNECT_WALLET_ERROR),s(e)}}}),ef("EmbeddedWalletConnectingScreen")}),sendTransaction:async(e,t)=>await eI({transaction:e,sponsor:t?.sponsor,uiOptions:t?.uiOptions,fundWalletConfig:t?.fundWalletConfig,address:t?.address,signOnly:!1}),signTransaction:async(e,t)=>({signature:(await eI({transaction:e,uiOptions:t?.uiOptions,address:t?.address,signOnly:!0})).hash}),exportWallet:e=>new Promise(async(i,n)=>{if(!eo||!g)return void n(Error("User must be authenticated before exporting their Privy wallet"));e&&"target"in e&&e&&(e=void 0);let s=e?.address?(0,rc.h)(g,e.address):(0,rc.b)(g);if(!s)return void n(new rp.a("User must have an embedded wallet."));let a=s.address,{entropyId:o,entropyIdVerifier:l}=(0,rh.g)(g,s),c=(0,rc.d)(s);if(!a)return void n(Error("User does not have an HD Ethereum wallet. To export an imported wallet, pass the `address` of the wallet to `exportWallet`."));if(!(0,no.isAddress)(a))return void n(Error("Must provide a valid Ethereum address."));let d={recoveryMethod:s.recoveryMethod,connectingWalletAddress:s.address,isUnifiedWallet:c,entropyId:o,entropyIdVerifier:l,onCompleteNavigateTo:"EmbeddedWalletKeyExportScreen",onFailure:n,shouldForceMFA:!0};J(V),await Tk()&&H?H?(0,rf.i)(s)?(J({keyExport:{appId:t.appId,appClientId:t.clientId,origin:r.apiUrl,address:s.address,entropyId:o,entropyIdVerifier:l,hdWalletIndex:s.walletIndex,chainType:s.chainType,walletId:s.id,isUnifiedWallet:c,imported:s.imported,onSuccess:i,onFailure:n},connectWallet:d}),ef("EmbeddedWalletConnectingScreen")):n(Error(`Export is not supported for ${s.chainType} wallets`)):n(Error("Must have a Privy wallet before exporting")):n(Error("Must have valid access token to enroll in MFA"))}),promptMfa:ex,async init(e){switch(e){case"sms":return void await r.initMfaSmsVerification();case"passkey":return await r.initMfaPasskeyVerification();case"totp":return;default:throw Error(`Unsupported MFA method: ${e}`)}},async submit(t,r){switch(t){case"totp":case"sms":if("string"!=typeof r)throw new rp.a("Invalid MFA code");er.current?.resolve({mfaMethod:t,mfaCode:r,relyingParty:window.origin}),await new Promise((e,t)=>{ei.current={resolve:e,reject:t}});break;case"passkey":let i;if("string"==typeof r)throw new rp.a("Invalid authenticator response");let n=await e.A(492887),s={id:(i=await n.startAuthentication({optionsJSON:r})).id,raw_id:i.rawId,response:{client_data_json:i.response.clientDataJSON,authenticator_data:i.response.authenticatorData,signature:i.response.signature,user_handle:i.response.userHandle},authenticator_attachment:i.authenticatorAttachment,client_extension_results:{app_id:i.clientExtensionResults.appid,cred_props:i.clientExtensionResults.credProps,hmac_create_secret:i.clientExtensionResults.hmacCreateSecret},type:i.type};er.current?.resolve({mfaMethod:t,mfaCode:s,relyingParty:window.origin}),await new Promise((e,t)=>{ei.current={resolve:e,reject:t}});break;default:throw er.current?.reject(new rp.a("Unsupported MFA method")),new rp.a(`Unsupported MFA method: ${t}`)}},cancel(){er.current?.reject(new rp.a("MFA canceled"))},async initEnrollmentWithSms(e){let t=await Tk();if(!t||!H)throw Error("Must have valid access token to enroll in MFA");await H.initEnrollMfa({method:"sms",accessToken:t,phoneNumber:e.phoneNumber})},enrollInMfa:e=>new Promise((t,r)=>{e?(d.mfa.noPromptOnMfaRequired&&console.warn("[Privy Warning] Triggering the 'showMfaEnrollmentModal' function when 'noPromptOnMfaRequired' is set to true is unexpected. If this is intentional, ensure that you are building custom UIs for MFA verification."),J({mfaEnrollmentFlow:{mfaMethods:d.mfa.methods,shouldUnlinkOnUnenrollMfa:d.passkeys.shouldUnlinkOnUnenrollMfa,onSuccess:t,onFailure:r}}),ef("MfaEnrollmentFlowScreen")):(eR.closePrivyModal(),t())}),async initEnrollmentWithTotp(){let e=await Tk();if(!e||!H)throw Error("Must have valid access token to enroll in MFA");let t=await H.initEnrollMfa({method:"totp",accessToken:e});return{secret:t.secret,authUrl:t.authUrl}},async submitEnrollmentWithSms(e){let t=await Tk();if(!t||!H)throw Error("Must have valid access token to enroll in MFA");await H.submitEnrollMfa({method:"sms",accessToken:t,phoneNumber:e.phoneNumber,code:e.mfaCode}),m(await r.getAuthenticatedUser())},async submitEnrollmentWithTotp(e){let t=await Tk();if(!t||!H)throw Error("Must have valid access token to enroll in MFA");await H.submitEnrollMfa({method:"totp",accessToken:t,code:e.mfaCode}),m(await r.getAuthenticatedUser())},async initEnrollmentWithPasskey(){},async submitEnrollmentWithPasskey({credentialIds:e},t={}){let i=await Tk();if(!i||!H)throw Error("Must have valid access token to enroll in MFA");await H.submitEnrollMfa({method:"passkey",accessToken:i,credentialIds:e,removeForLogin:t.removeForLogin}),m(await r.getAuthenticatedUser())},async unenroll(e,t={}){let i=await Tk();if(!i||!H)throw Error("Must have valid access token to remove MFA");"passkey"===e?await H.submitEnrollMfa({method:"passkey",accessToken:i,credentialIds:[],removeForLogin:t.removeForLogin}):await H.unenrollMfa({method:e,accessToken:i}),m(await r.getAuthenticatedUser())},requestFarcasterSignerFromWarpcast:async()=>{let e=await Tk(),t=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!e)throw Error("Must have valid access token to connect with Farcaster");if(!H||!t)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,rc.d)(t))throw new rp.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eR.recoverEmbeddedWallet({address:t.address}))throw Error("Unable to connect to wallet");let i=await H.initFarcasterSigner({address:t.address,hdWalletIndex:null,accessToken:e,mfaCode:null,mfaMethod:null,relyingParty:window.origin});"approved"===i.status&&m(await r.getAuthenticatedUser()||g||null),J({farcasterSigner:i}),ef("FarcasterSignerStatusScreen")},getFarcasterSignerPublicKey:async()=>{let e,t=await Tk(),r=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!t)throw Error("Must have valid access token to connect with Farcaster");if(!H||!r)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,rc.d)(r))throw new rp.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eR.recoverEmbeddedWallet({address:r.address}))throw Error("Unable to connect to wallet");if(!g.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");return e=g.farcaster.signerPublicKey.slice(2),Uint8Array.from(e.match(/.{1,2}/g).map(e=>parseInt(e,16)))},signFarcasterMessage:async t=>{let r=await Tk(),i=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!r)throw Error("Must have valid access token to connect with Farcaster");if(!H||!i)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,rc.d)(i))throw new rp.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await eR.recoverEmbeddedWallet({address:i.address}))throw Error("Unable to connect to wallet");if(!g.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");let n=await e.A(492887),s=await H.signFarcasterMessage({address:i.address,hdWalletIndex:null,accessToken:r,mfaCode:null,mfaMethod:null,payload:{hash:n.bufferToBase64URLString(t)},fid:BigInt(g.farcaster.fid),relyingParty:window.origin});return new Uint8Array(n.base64URLStringToBuffer(s.signature))},signMessageWithCrossAppWallet(e,{address:t,chainId:i}){let n=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return kq({user:g,client:r,address:t,requesterAppId:d.id,request:{method:n?"privy_signSmartWalletMessage":"personal_sign",params:[e,t],chainId:i},reconnect:eP})},signTypedDataWithCrossAppWallet(e,{address:t,chainId:i}){let n=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t)),s=(0,ru.m)(e);return kq({user:g,client:r,address:t,requesterAppId:d.id,request:{method:n?"privy_signSmartWalletTypedData":"eth_signTypedData_v4",params:[t,s],chainId:i},reconnect:eP})},sendTransactionWithCrossAppWallet(e,{address:t}){let i=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return kq({user:g,client:r,address:t,requesterAppId:d.id,request:{method:i?"privy_sendSmartWalletTx":"eth_sendTransaction",params:[e],chainId:e.chainId},reconnect:eP})},signTransactionWithCrossAppWallet(e,{address:t}){let i=g?.linkedAccounts.some(e=>"cross_app"===e.type&&e.smartWallets.some(e=>e.address===t));return kq({user:g,client:r,address:t,requesterAppId:d.id,request:{method:i?"privy_signSmartWalletTx":"eth_signTransaction",params:[e],chainId:e.chainId},reconnect:eP})},isModalOpen:u||!!p,mfaMethods:d.mfa.methods};s=eO.signMessage,a=eO.signTypedData,l=async(e,t)=>await eI({transaction:e,...t,signOnly:!1}),o=async(e,t)=>({signature:(await eI({transaction:e,...t,signOnly:!0})).hash});let eR={privy:i,setAuthenticated:ec,setUser:m,setIsNewUser:A,isNewUserThisSession:E,pendingTransaction:null,walletConnectionStatus:T,setWalletConnectionStatus:k,connectors:r.connectors?.walletConnectors??[],rpcConfig:d.rpcConfig,chains:d.chains,appId:t.appId,showFiatPrices:"native-token"!==d.embeddedWallets.priceDisplay.primary,clientAnalyticsId:r.clientAnalyticsId,onCustomAuthAuthenticated:ey,hideWalletUIs:eh,isHeadlessSigning:(0,W.useCallback)(ep,[d.embeddedWallets.showWalletUIs]),emailOtpState:O,setEmailOtpState:R,smsOtpState:N,setSmsOtpState:M,oAuthState:j,setOAuthState:L,telegramAuthState:F,setTelegramAuthState:z,siweState:U,setSiweState:D,isHeadlessOAuthLoading:I,baseAccountSdk:b,setBaseAccountSdk:v,nativeTokenSymbolForChainId:e=>d.chains.find(t=>t.id===Number(e))?.nativeCurrency.symbol,initializeWalletProxy:async e=>{if(H)return H;let t=new Promise(e=>{Y.current=e}),r=new Promise(t=>setTimeout(()=>t(null),e)),i=await Promise.race([t,r]);return Y.current=null,i},getAuthFlow:()=>r.authFlow,getAuthMeta:()=>r.authFlow?.meta,client:r,closePrivyModal:async(e={shouldCallAuthOnSuccess:!0,isSuccess:!1})=>{let i,s=f&&eo&&g;if(s&&ed.current&&(i=eT(g)),"login"===eu.current)e.shouldCallAuthOnSuccess&&s&&ed.current?(0,sd.e)(en,"login","onComplete",{user:g,isNewUser:E,wasAlreadyAuthenticated:!1,loginMethod:ed.current,loginAccount:i??null}):(0,sd.e)(en,"login","onError",rp.b.USER_EXITED_AUTH_FLOW);else if("link"===eu.current&&i)e.isSuccess&&s&&ed.current?(0,sd.e)(en,"linkAccount","onSuccess",{user:g,linkMethod:ed.current,linkedAccount:i}):ed.current&&(0,sd.e)(en,"linkAccount","onError",rp.b.USER_EXITED_LINK_FLOW,{linkMethod:ed.current});else if("update"===eu.current&&i)e.isSuccess&&s&&ed.current?(0,sd.e)(en,"update","onSuccess",{user:g,updateMethod:ed.current,updatedAccount:i}):ed.current&&(0,sd.e)(en,"update","onError",rp.b.USER_EXITED_UPDATE_FLOW,{linkMethod:ed.current});else if("connect-or-create"===eu.current){let e=k4.getState().ethereum;e[0]?(0,sd.e)(en,"connectOrCreateWallet","onSuccess",{wallet:e[0]}):(0,sd.e)(en,"connectOrCreateWallet","onError",rp.b.USER_EXITED_AUTH_FLOW)}let a=_&&kG.has(_),o="ErrorScreen"===_&&V.errorModalData&&kG.has(V.errorModalData.previousScreen);if((a||o)&&V.funding){let e,r=kG.get(_)??null;if(o&&V.funding?.onError){let e=V.errorModalData?.error,t=e?.privyErrorCode||rp.b.UNKNOWN_FUNDING_ERROR,r=new rp.a(e?.message||"Funding failed",e,t);V.funding?.onError?.(r)}if("solana"===V.funding.chainType){let t=d.solanaRpcs[V.funding.chain];if(!t)return void console.warn("Unable to load solana rpc, skipping balance");if(n(so.S))try{e=await kQ({rpc:t.rpc,address:V.funding.address})}catch{console.error("Unable to pull wallet balance")}else console.warn("Unable to load solana plugin, skipping balance");(0,sd.e)(en,"fundSolanaWallet","onUserExited",{address:V.funding.address,fundingMethod:r,chain:V.funding.chain,balance:e})}else{let i=(0,EP.g)(V.funding.chain.id,d.chains,d.rpcConfig,{appId:t.appId});try{e=await i.getBalance({address:V.funding.address})}catch{console.error("Unable to pull wallet balance")}(0,sd.e)(en,"fundWallet","onUserExited",{address:V.funding.address,chain:V.funding.chain,fundingMethod:r,balance:e}),function(e,t){if(e.onComplete)switch(t){case"external":e.fundingResult?e.onComplete({...e.fundingResult,fundingMethod:t}):e.onComplete({status:"cancelled",address:e.address,fundingMethod:t,amount:e.amount});break;case null:e.onComplete({status:"cancelled",address:e.address,fundingMethod:void 0,amount:e.amount});break;default:e.onComplete({status:"completed",address:e.address,fundingMethod:t,amount:e.amount})}}(V.funding,r)}}J(e=>({...e,externalConnectWallet:{}})),eu.current=null,ed.current=null,A(!1),h(!1),k({status:"disconnected",connectedWallet:null,connector:null,connectError:null,connectRetry:()=>{}}),setTimeout(()=>{r.authFlow=void 0},200)},openPrivyModal:ef,connectWallet:eb,initLoginWithWallet:async(e,t,r,i)=>{(0,ru.f)(e)?(ed.current="siwe",ev(e,t,r)):(ed.current="siws",eE(e,t,r,i))},loginWithWallet:async()=>{let e,t,i;if(!f)throw new rp.g;if(r.authFlow instanceof TV?e="siwe":r.authFlow instanceof TJ&&(e="siws"),!e)throw new rp.a("Must initialize SIWE/SIWS flow first.");if(null!==await r.getAccessToken())try{({user:t}=await r.link()),ed.current=e}catch(t){throw(0,sd.e)(en,"linkAccount","onError",t.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}else try{({user:t,isNewUser:i}=await r.authenticate()),ed.current=e}catch(e){throw(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.GENERIC_CONNECT_WALLET_ERROR),e}m(t||g||null),A(i||!1),ec(!0)},delegateWallet:async({address:e,chainType:t,showDelegationUIs:r})=>new Promise(async(i,n)=>{let s=await Tk();if(!eo||!g||!s)throw new rp.a("User must be authenticated and have an embedded wallet to delegate actions.");if("solana"!==t&&"ethereum"!==t)throw new rp.a("Only Solana and Ethereum embedded wallets are supported for delegation and revocation.");let a=eR.walletProxy??await eR.initializeWalletProxy(15e3);if(!a)throw new rp.a("Wallet proxy not initialized.");if((({address:e,user:t})=>!!kL(t).find(t=>t.address===e))({address:e,user:g}))return i();let o=(0,rc.h)(g,e);if(!o)throw new rp.a("Address to delegate is not associated with current user.");if((0,rc.d)(o))throw new rp.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let l=(({address:e,user:t})=>{let r=t.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&t.address===e);if(!r)throw new rp.a("Address to delegate is not associated with current user.");if(!(0,rf.i)(r))throw new rp.a(`useDelegatedActions is not supported for ${r.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:r.address,chainType:r.chainType,walletIndex:r.walletIndex??0}})({address:e,user:g}),c=(({address:e,user:t})=>{let r=t.linkedAccounts.find(t=>"wallet"===t.type&&"privy"===t.walletClientType&&t.address===e);if(!r)throw new rp.a("Address to delegate is not associated with current user.");let i=r.imported?r:(0,rc.g)(t);if(!i)throw new rp.a("Unable to determine root address for delegated address.");if(!(0,rf.i)(i))throw new rp.a(`useDelegatedActions is not supported for ${i.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:i.address,chainType:i.chainType,imported:i.imported}})({address:e,user:g}),d=async()=>{await a.createDelegatedAction({accessToken:s,rootWallet:c,delegatedWallets:[l]}),await eR.refreshSessionAndUser()};if(await eR.recoverEmbeddedWallet({address:e}),r)J({delegatedActions:{consent:{address:e,onDelegate:d,onSuccess:async()=>{i()},onError:async e=>{n(e)}}}}),ef("DelegatedActionsConsentScreen");else try{await d(),i()}catch(e){n(e)}}),revokeDelegatedWallets:async({showDelegationUIs:e})=>new Promise(async(t,i)=>{if(!eo||!g)throw new rp.a("User must be authenticated and have an embedded wallet to revoke a delegated wallet.");let n=kL(g);if(0===n.length)throw new rp.a("User has no delegated wallets to revoke.");if(n.some(rc.d))throw new rp.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let s=async()=>{await r.revokeDelegatedWallet(),await eR.refreshSessionAndUser()};if(e)J({delegatedActions:{revoke:{onRevoke:s,onSuccess:async()=>{t()},onError:async e=>{i(e)}}}}),ef("DelegatedActionsRevokeScreen");else try{await s(),t()}catch(e){i(e)}}),initLoginWithFarcaster:async(e,t)=>{let i=new TM(e,t);r.startAuthFlow(i);try{ed.current="farcaster",await i.initializeFarcasterConnect()}catch(e){throw"login"===eu.current?(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR,{linkMethod:"farcaster"}),e}},loginWithFarcaster:async()=>{let e,t;if(!f)throw new rp.g;if(!(r.authFlow instanceof TM))throw new rp.a("Must initialize Farcaster flow first.");if(null!==await r.getAccessToken())try{({user:e}=await r.link()),ed.current="farcaster"}catch(e){throw(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"farcaster"}),e}else try{({user:e,isNewUser:t}=await r.authenticate()),ed.current="farcaster"}catch(e){throw(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}m(e||null),A(t||!1),ec(!0)},async crossAppAuthFlow({appId:e,popup:t,action:i}){let n=`privy:${e}`;ed.current=n;let{url:s,stateCode:a,codeVerifier:o}=await async function({api:e,appId:t}){let r=TW(),i=TF(),n=await Tz(r);try{let{url:s}=await e.post(nq,{provider:`privy:${t}`,redirect_to:window.location.href,code_challenge:n,state_code:i});return{url:s,stateCode:i,codeVerifier:r}}catch(e){throw(0,rp.f)(e)}}({api:r.api,appId:e});if(!s)throw r.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:"Unable to open cross-app auth popup",appId:e}}),new rp.a("No authorization URL returned for cross-app auth.");try{let l=await async function({url:e,popup:t}){return t.location=e,new Promise((e,r)=>{let i,n=setTimeout(()=>{r(new rp.a("Authorization request timed out after 2 minutes.")),s()},12e4);function s(){t?.close(),window.removeEventListener("message",o)}let a=setInterval(()=>{t?.closed&&!i&&(s(),clearInterval(a),clearTimeout(n),r(new rp.a("User rejected request")))},300);function o(t){t.data&&("PRIVY_OAUTH_RESPONSE"===t.data.type&&t.data.stateCode&&t.data.authorizationCode&&(clearTimeout(n),e(t.data),s()),"PRIVY_OAUTH_ERROR"===t.data.type&&(clearTimeout(n),r(new rp.a(t.data.error)),s()),t.data.type===kW&&((i=new BroadcastChannel(kB)).onmessage=o))}window.addEventListener("message",o)})}({url:s,popup:t,provider:n}),c=l.stateCode,d=l.authorizationCode;if(c!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:n,storedStateCode:a??"",returnedStateCode:c??""}}),new rp.a("Unexpected auth flow. This may be a phishing attempt.",void 0,rp.b.OAUTH_UNEXPECTED);let u=await async function({appId:e,stateCode:t,codeVerifier:r,authorizationCode:i,action:n,client:s}){if(!i||!t)throw new rp.a("[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.");if("undefined"===i)throw new rp.a("User denied confirmation during cross-app auth flow");try{let a=new kF({authorizationCode:i,stateCode:t,codeVerifier:r,provider:`privy:${e}`});s.startAuthFlow(a);let o="link"===n?await s.link():await s.authenticate(),l=o.oAuthTokens?.accessToken;return console.debug(),l}catch(t){let e=(0,rp.f)(t);if(e.privyErrorCode===rp.b.ACCOUNT_TRANSFER_REQUIRED)throw e;if(e.privyErrorCode)throw new rp.a(e.message||"Invalid code during cross-app auth flow.",void 0,e.privyErrorCode);if("User denied confirmation during cross-app auth flow"===e.message)throw new rp.a("Invalid code during cross-app auth flow.",void 0,rp.b.OAUTH_USER_DENIED);throw new rp.a("Invalid code during cross-app auth flow.",void 0,rp.b.UNKNOWN_AUTH_ERROR)}}({appId:e,codeVerifier:o,stateCode:c,authorizationCode:d,action:i,client:r});u&&r.storeProviderAccessToken(e,u);let h=await eR.refreshSessionAndUser();if(!h)throw new rp.a("Unable to update user");return r.createAnalyticsEvent({eventName:"cross_app_auth_completed",payload:{providerAppId:e}}),h}catch(e){throw r.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:e.toString(),provider:n}}),e}},async initLoginWithOAuth(e,t,i){if(ed.current=e,!(0,rf.e)()||"google"===e&&!d.allowOAuthInEmbeddedBrowsers&&kY(window.navigator.userAgent))return void ef("InAppBrowserLoginNotPossible");"twitter"===e&&window.opener&&window.opener.postMessage({type:kW},"*"),rf.u.del(nn.H),rf.u.del(nn.O);let n=new Tq({provider:e,disableSignup:!!i,withPrivyUi:!0,customOAuthRedirectUrl:d.customOAuthRedirectUrl});t&&n.addCaptchaToken(t),r.startAuthFlow(n);let s=await r.authFlow.getAuthorizationUrl();if(s&&s.url)if("twitter"===e&&ns.isAndroid&&(s.url=s.url.replace("x.com","twitter.com")),"chrome-extension:"===window.location.protocol&&Tj())try{let{privyOAuthCode:e,privyOAuthState:t}=await TL(s.url);ef("OAuthStatusScreen"),n.meta.stateCode=t,n.meta.authorizationCode=e}catch(e){throw console.error("OAuth in chrome extension flow failed:",e),e}else window.location.assign(s.url)},async initLoginWithTelegram(e,t){if(!f)throw new rp.g;ed.current="telegram";let i=new T1(e,t);r.startAuthFlow(i),z({status:"loading"}),i.meta.telegramWebAppData=void 0,i.meta.telegramAuthResult=await new Promise((e,t)=>d.loginConfig.telegramAuthConfiguration?window.Telegram?void window.Telegram.Login.auth({bot_id:d.loginConfig.telegramAuthConfiguration.botId,request_access:!0},r=>r?e(r):("link"===eu.current?(0,sd.e)(en,"linkAccount","onError",rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}):"login"===eu.current?(0,sd.e)(en,"login","onError",rp.b.INVALID_CREDENTIALS):"update"===eu.current&&(0,sd.e)(en,"login","onError",rp.b.FAILED_TO_UPDATE_ACCOUNT),t(new rp.a("Telegram auth failed or was canceled by the client")))):t(new rp.a("Telegram was not initialized")):t(new rp.a("Telegram Auth configuration is not loaded")))},async loginWithTelegram(e){let t,i;if(!(r.authFlow instanceof T1))throw new rp.a("Must initialize Telegram flow before calling loginWithTelegram");r.authFlow.meta.captchaToken||=e?.captchaToken;let n=await Tk(),s=e?.intent||eu.current;if("login"===s)try{let e=await r.authenticate();t=e.user,i=e.isNewUser,ed.current="telegram"}catch(e){throw(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}else{if("link"!==s)throw new rp.a("Unknown auth intent");try{t=(await r.link()).user,ed.current="telegram"}catch(e){throw(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}),e}}m(t),A(i||!1),ec(!0),z({status:"done"});let a=t?.linkedAccounts.find(({type:e})=>"telegram"===e)||null;return{user:t,isNewUser:i||!1,wasAlreadyAuthenticated:!!n,loginAccount:a}},async loginWithOAuth(e){let t,i,n;if(!(r.authFlow instanceof Tq))throw new rp.a("Must initialize OAuth flow before calling loginWithOAuth");let s=rf.u.get(nn.S),a=r.authFlow.meta.stateCode;if(s!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e,storedStateCode:s??"",returnedStateCode:a??""}}),new rp.a("Unexpected auth flow. This may be a phishing attempt.",void 0,rp.b.OAUTH_UNEXPECTED);if(null!==await r.getAccessToken())try{let i=await r.link();t=i.user,n=i.oAuthTokens,ed.current=e}catch(t){throw(0,sd.e)(en,"linkAccount","onError",t.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}else try{let s=await r.authenticate();t=s.user,i=s.isNewUser,n=s.oAuthTokens,ed.current=e}catch(t){throw"login"===eu.current?(0,sd.e)(en,"login","onError",t.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,sd.e)(en,"linkAccount","onError",t.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e}),t}return m(t),A(i||!1),ec(!0),n&&t&&(0,sd.e)(en,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:n,user:t}),n},passkeyAuthState:C,setPasskeyAuthState:P,async initSignupWithPasskey({captchaToken:e,withPrivyUi:t}){let i=new TK({captchaToken:e,setPasskeyAuthState:P,hints:d.passkeys.registration?.hints});r.startAuthFlow(i),eu.current="login";try{ed.current="passkey",P({status:"generating-challenge"}),await i.initRegisterFlow(t),P({status:"awaiting-passkey"})}catch(e){throw P({status:"error",error:e}),(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}},async signupWithPasskey(){let e,t;if(!f)throw new rp.g;if(!(r.authFlow instanceof TK))throw new rp.a("Must initialize Passkey flow first.");if("passkey"!==ed.current){let e=new rp.a("Must init login with Passkey flow first.");throw P({status:"error",error:e}),e}let i=await Tk();try{ed.current="passkey",P({status:"awaiting-passkey"}),{user:e,isNewUser:t}=await r.authenticate()}catch(e){throw P({status:"error",error:e}),(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}m(e),A(t||!1),ec(!0),P({status:"done"});let n=e?.linkedAccounts.find(({type:e})=>"passkey"===e)||null;return{user:e,isNewUser:t||!1,wasAlreadyAuthenticated:!!i,loginAccount:n}},async initLoginWithPasskey({captchaToken:e,withPrivyUi:t}){let i=new TK({captchaToken:e,setPasskeyAuthState:P,hints:void 0});r.startAuthFlow(i),eu.current="login";try{ed.current="passkey",P({status:"generating-challenge"}),await i.initAuthenticationFlow(t),P({status:"awaiting-passkey"})}catch(e){throw P({status:"error",error:e}),(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}},async loginWithPasskey(e){let t,i;if(!f)throw new rp.g;if(!(r.authFlow instanceof TK))throw new rp.a("Must initialize Passkey flow first.");if(e?.credentialIds&&(r.authFlow.meta.allowedCredentialsIds=e.credentialIds),"passkey"!==ed.current){let e=new rp.a("Must init login with Passkey flow first.");throw P({status:"error",error:e}),e}let n=await Tk();try{ed.current="passkey",P({status:"awaiting-passkey"}),{user:t,isNewUser:i}=await r.authenticate()}catch(e){throw P({status:"error",error:e}),(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}m(t),A(i||!1),ec(!0),P({status:"done"});let s=t?.linkedAccounts.find(({type:e})=>"passkey"===e)||null;return{user:t,isNewUser:i||!1,wasAlreadyAuthenticated:!!n,loginAccount:s}},async initLinkWithPasskey(e){let t=new TK({captchaToken:e,hints:d.passkeys.registration?.hints});r.startAuthFlow(t),eu.current="link",ed.current="passkey",P({status:"generating-challenge"});try{await t.initLinkFlow(),P({status:"awaiting-passkey"})}catch(e){throw(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR,{linkMethod:"passkey"}),P({status:"error",error:e}),e}},async linkWithPasskey(){let e;if(!f)throw new rp.g;if(!(r.authFlow instanceof TK))throw new rp.a("Must initialize Passkey flow first.");if("passkey"!==ed.current)throw new rp.a("Must init login with Passkey flow first.");try{ed.current="passkey",{user:e}=await r.link()}catch(e){throw(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"passkey"}),e}return m(e||g||null),P({status:"done"}),e},async initLoginWithHeadlessOAuth(e,t,i){if(!(0,rf.e)()||"google"===e&&!d.allowOAuthInEmbeddedBrowsers&&kY(window.navigator.userAgent))throw Error("It looks like you're using an in-app browser.  To log in, please try again using an external browser.");let n=new Tq({provider:e,withPrivyUi:!1,disableSignup:i??!1,customOAuthRedirectUrl:d.customOAuthRedirectUrl});t&&n.addCaptchaToken(t),L({status:"loading"});let s=await r.startAuthFlow(n).getAuthorizationUrl();if(s?.url)if("chrome-extension:"===window.location.protocol&&Tj())try{let{privyOAuthCode:e,privyOAuthState:t}=await TL(s.url);n.meta.stateCode=t,n.meta.authorizationCode=e,await this.loginWithHeadlessOAuth(n.meta)}catch(e){throw L({status:"error",error:e}),e}else window.location.assign(s.url)},async loginWithHeadlessOAuth(e){let t,i,n;x(!0),L({status:"loading"}),r.startAuthFlow(new Tq({...e,customOAuthRedirectUrl:d.customOAuthRedirectUrl}));let s=rf.u.get(nn.S),a=e.stateCode;if(s!==a)throw r.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e.provider,storedStateCode:s??"",returnedStateCode:a??""}}),x(!1),new rp.a("Unexpected auth flow. This may be a phishing attempt.",void 0,rp.b.OAUTH_UNEXPECTED);if(null!==await r.getAccessToken())try{({user:t,oAuthTokens:n}=await r.link()),ed.current=e.provider;let i=eT(t);t&&i&&(0,sd.e)(en,"linkAccount","onSuccess",{user:t,linkMethod:ed.current,linkedAccount:i})}catch(t){throw x(!1),(0,sd.e)(en,"linkAccount","onError",t.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:e.provider}),t}else try{({user:t,isNewUser:i,oAuthTokens:n}=await r.authenticate()),ed.current=e.provider;let s=eT(t);t&&s&&void 0!==i&&(0,sd.e)(en,"login","onComplete",{user:t,isNewUser:i,wasAlreadyAuthenticated:!1,loginMethod:ed.current,loginAccount:s})}catch(e){throw x(!1),L({status:"error",error:e}),(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}return m(t),A(i||!1),ec(!0),x(!1),L({status:"done"}),n&&t&&(0,sd.e)(en,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:n,user:t}),t??void 0},initLoginWithEmail:async({email:e,captchaToken:t,disableSignup:i,withPrivyUi:n})=>{let s=new TO({email:e,captchaToken:t,disableSignup:i});r.startAuthFlow(s);try{ed.current="email",R({status:"sending-code"});let e=await s.sendCodeEmail({withPrivyUi:n});if(e?.ssoRedirectUrl)return window.location.href=e.ssoRedirectUrl,void await (0,ru.k)(1e4);R({status:"awaiting-code-input"})}catch(e){throw R({status:"error",error:e}),"login"===eu.current?(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"email"}),e}},initUpdateEmail:async({oldAddress:e,newAddress:t,captchaToken:i})=>{let n=new TR(e,t,i);r.startAuthFlow(n);try{await n.sendCodeEmail({withPrivyUi:!0})}catch(e){throw(0,sd.e)(en,"update","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR,{linkMethod:ed.current}),e}},initUpdatePhone:async(e,t,i)=>{let n=new TG(e,t,i);r.startAuthFlow(n);try{await n.sendSmsCode({withPrivyUi:!0})}catch(e){(0,sd.e)(en,"update","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR,{linkMethod:ed.current})}},initLoginWithSms:async({phoneNumber:e,captchaToken:t,disableSignup:i,withPrivyUi:n})=>{M({status:"sending-code"});let s=new TZ({phoneNumber:e,captchaToken:t,disableSignup:i});r.startAuthFlow(s);try{ed.current="sms",await s.sendSmsCode({withPrivyUi:n}),M({status:"awaiting-code-input"})}catch(e){throw M({status:"error",error:e}),"login"===eu.current?(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR):"link"===eu.current&&(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"sms"}),e}},resendEmailCode:async()=>{await r.authFlow?.sendCodeEmail({withPrivyUi:!0})},resendSmsCode:async()=>{await r.authFlow?.sendSmsCode({withPrivyUi:!0})},loginWithCode:async e=>{let t,i;function n(e){r.authFlow instanceof TO?R(e):r.authFlow instanceof TZ&&M(e)}if(n({status:"submitting-code"}),!f){let e=new rp.g;throw n({status:"error",error:e}),e}if(r.authFlow instanceof TO)r.authFlow.meta.emailCode=e.trim();else{if(!(r.authFlow instanceof TZ)){let e=new rp.a("Must initialize a passwordless code flow first");throw n({status:"error",error:e}),e}r.authFlow.meta.smsCode=e.trim()}let s=await Tk();if("link"===eu.current)try{({user:t}=await r.link())}catch(e){throw n({status:"error",error:e}),(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:ed.current}),e}else if("update"===eu.current)try{({user:t}=await r.link())}catch(e){throw n({status:"error",error:e}),(0,sd.e)(en,"update","onError",e.privyErrorCode||rp.b.FAILED_TO_UPDATE_ACCOUNT,{linkMethod:ed.current}),e}else try{({user:t,isNewUser:i}=await r.authenticate())}catch(e){throw n({status:"error",error:e}),(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),e}let a=t||g;m(a||null),A(i||!1),ec(!0),n({status:"done"});let o=null;return r.authFlow instanceof TO?o=a?.linkedAccounts.find(({type:e})=>"email"===e)||null:r.authFlow instanceof TZ&&(o=a?.linkedAccounts.find(({type:e})=>"phone"===e)||null),{user:a,isNewUser:i||!1,wasAlreadyAuthenticated:!!s,linkedAccount:o}},generateSiweMessage:async({address:e,chainId:t,captchaToken:i})=>{eu.current=eo?"link":"login",ed.current="siwe",D({status:"generating-message"});let n=await r.generateSiweNonce({address:e,captchaToken:i});return D({status:"awaiting-signature"}),T$({address:e,chainId:t.replace("eip155:",""),nonce:n})},generateSiweMessageForSmartWallet:async({address:e,chainId:t})=>{let i=await r.generateSiweNonce({address:e});return T$({address:e,chainId:t.replace("eip155:",""),nonce:i})},linkSmartWallet:async({message:e,signature:t,smartWalletType:i,smartWalletVersion:n})=>{let s;s=await r.linkSmartWallet({message:e,signature:t,smartWalletType:i,smartWalletVersion:n}),m((s=await eR.refreshSessionAndUser()??s)||g||null)},loginWithSiwe:async({message:e,signature:t,captchaToken:i,disableSignup:n,walletClientType:s,connectorType:a})=>{let o,l=null;try{if(g)throw Error("User already authenticated");let c=new TV(r,void 0,i,n,{message:e,signature:t,walletClientType:s,connectorType:a});r.startAuthFlow(c),ed.current="siwe",eu.current="login",D({status:"submitting-signature"});let d=await r.authenticate();if({user:l,isNewUser:o}=d,!l)throw Error("Authentication failed - no user returned")}catch(e){throw(0,sd.e)(en,"login","onError",e.privyErrorCode||rp.b.UNKNOWN_AUTH_ERROR),D({status:"error",error:e}),e}return m(l),A(o||!1),ec(!0),D({status:"done"}),eu.current=null,ed.current=null,{user:l,isNewUser:o||!1}},linkWithSiwe:async({message:e,signature:t,chainId:i,walletClientType:n,connectorType:s})=>{let a;e_("siwe");let o=null;try{D({status:"submitting-signature"}),a=await r.linkWithSiwe({message:e,signature:t,chainId:i,walletClientType:n,connectorType:s}),a=await eR.refreshSessionAndUser()??a,D({status:"done"}),(o=eT(a)||null)&&(0,sd.e)(en,"linkAccount","onSuccess",{user:a,linkMethod:"siwe",linkedAccount:o})}catch(e){throw(0,sd.e)(en,"linkAccount","onError",e.privyErrorCode||rp.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"siwe"}),eu.current=null,ed.current=null,D({status:"error",error:e}),e}let l=a||g;return m(l||null),eu.current=null,ed.current=null,{user:l,linkedAccount:o}},refreshSessionAndUser:async()=>{let e=await r.getAuthenticatedUser();return ec(!!e),m(e),e},walletProxy:H,createAnalyticsEvent:({eventName:e,payload:t,timestamp:i})=>r.createAnalyticsEvent({eventName:e,payload:t,timestamp:i}),acceptTerms:async()=>{let e=await r.acceptTerms();return m(e),e},getUsdTokenPrice:e=>r.getUsdTokenPrice(e),getUsdPriceForSol:()=>r.getUsdPriceForSol(),getSplTokenMetadata:e=>r.getSplTokenMetadata(e),recoverEmbeddedWallet:async e=>new Promise(async(t,i)=>{if(!g)return void t(!0);let n=e?.address?(0,rc.h)(g,e.address):(0,rc.g)(g)||(0,rc.f)(g).at(0)||(0,rc.j)(g).at(0);if(!n||(0,rc.d)(n))return void t(!0);let s=await Tk();if(!s||!H||!n)return void i(Error("Must have valid access token and Privy wallet to recover wallet"));let{entropyId:a,entropyIdVerifier:o}=(0,rh.g)(g,n);try{await H.connect({accessToken:s,entropyId:a,entropyIdVerifier:o}),t(!0)}catch(e){if(k_(e)&&"privy"===n.recoveryMethod){let e;r.createAnalyticsEvent({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:n.address}});try{e=await H.recover({entropyId:a,entropyIdVerifier:o,accessToken:s})}catch(e){return void i(e)}e.entropyId||i(Error("Unable to recover wallet")),r.createAnalyticsEvent({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:n.address}}),t(!0)}else k_(e)&&"privy"!==n.recoveryMethod&&"privy-v2"!==n.recoveryMethod?(J({recoverWallet:{entropyId:a,entropyIdVerifier:o,onFailure:i,onSuccess:()=>t(!0)},recoveryOAuthStatus:{provider:n.recoveryMethod,action:"recover",shouldCreateEth:!1,shouldCreateSol:!1}}),ef(kJ(n.recoveryMethod))):i(e)}}),setReadyToTrue:e=>{y(!0),Z?.(e)},updateWallets:()=>eS(),fundWallet:async(e,t)=>{let r="FundingMethodSelectionScreen";return new Promise((i,n)=>{J({funding:{...(0,rf.p)({address:e,appConfig:d,fundWalletConfig:t,methodScreen:r,onComplete:i,onError:n})}}),ef(r)})},openModal:ef,requestFarcasterSignerStatus:async e=>{let t=await Tk(),i=g?.linkedAccounts.find(e=>"wallet"===e.type&&"privy"===e.walletClientType);if(!t)throw Error("Must have valid access token to connect with Farcaster");if(!H||!i)throw Error("Must have an embedded wallet to use Farcaster signers");if(!g?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");let n=await r.requestFarcasterSignerStatus(e);return"approved"===n.status&&m(await r.getAuthenticatedUser()||g||null),n},connectCoinbaseSmartWallet:async()=>{d.externalWallets.coinbaseWallet.config.preference={...d.externalWallets.coinbaseWallet.config.preference,options:"smartWalletOnly"};let e=r.connectors?.findWalletConnector("coinbase_wallet","coinbase_smart_wallet")||r.connectors?.findWalletConnector("coinbase_wallet","coinbase_wallet");if(e)return e.updateConnectionPreference("smartWalletOnly"),eb(e);await ew("coinbase_wallet","coinbase_smart_wallet")},connectBaseAccount:async()=>{let e=r.connectors?.findWalletConnector("base_account","base_account");if(e)return eb(e);await ew("base_account","base_account")},initiateAccountTransfer:async({nonce:e,account:t,accountType:i,externalWalletMetadata:n,telegramAuthResult:s,telegramWebAppData:a,farcasterEmbeddedAddress:o,oAuthUserInfo:l})=>{let c=await r.sendAccountTransferRequest({nonce:e,account:t,accountType:i,externalWalletMetadata:n,telegramAuthResult:s,telegramWebAppData:a,farcasterEmbeddedAddress:o,oAuthUserInfo:l});return m(c),c},inProgressAuthFlowRef:eu,inProgressLoginOrLinkMethodRef:ed};c=eR.recoverEmbeddedWallet,eR.recoverEmbeddedWallet;let eN=(0,W.useMemo)(()=>({wallets:w,ready:Q&&es}),[w,Q,es]),eM=r.authFlow instanceof T1,{siteKey:eU,enabledProvider:eD}=d.captcha,ej=!d.headless&&eD&&!eo&&(f||eM);return(0,B.jsx)(Ct.Provider,{value:!0,children:(0,B.jsx)(rc.P.Provider,{value:eO,children:(0,B.jsx)(sd.P.Provider,{value:en,children:(0,B.jsx)(rh.U.Provider,{value:eN,children:(0,B.jsx)(TX,{appId:d.id,captchaSiteKey:eU,enabledCaptchaProvider:eD,children:(0,B.jsxs)(rp.I.Provider,{value:eR,children:[(0,B.jsx)(ru.R,{children:(0,B.jsxs)(rc.M,{data:V,setModalData:J,setInitialScreen:S,initialScreen:_,authenticated:eo,open:u,children:[t.children,(0,B.jsx)(Ce,{customAuth:d.customAuth}),ej&&(0,B.jsx)(T4,{delayedExecution:!1}),(0,B.jsx)(kw,{}),(0,B.jsx)(k6,{disabled:d.embeddedWallets.disableAutomaticMigration}),(0,B.jsx)(ke,{palette:d.appearance.palette||{}}),!d.render.standalone&&(0,B.jsx)(kp,{open:u})]})}),(0,B.jsx)(kj,{appId:t.appId,appClientId:t.clientId,clientAnalyticsId:r.clientAnalyticsId,origin:r.apiUrl,mfaMethods:g?.mfaMethods,mfaPromise:er,mfaSubmitPromise:ei,onLoad:K,onLoadFailed:()=>null}),d.loginConfig.telegramAuthConfiguration&&(0,B.jsx)(ru.H,{$if:!0,children:(0,B.jsx)(km,{scriptHost:t.apiUrl||nn.D,botUsername:d.loginConfig.telegramAuthConfiguration.botName})})]})})})})})})};class Ci extends Error{constructor(e,t,r){super(e),this.code=t,this.data=r}}class Cn extends rd.default{async handleSendTransaction(e){let t;if(!e.params||!Array.isArray(e.params))throw new Ci(`Invalid params for ${e.method}`,4200);let r=e.params[0];if(!await Tk()||!this.address)throw new Ci("Disconnected",4900);let{hash:i}=await (t={address:this.address},l(r,t));return i}async handleSignTransaction(e){let t;if(!e.params||!Array.isArray(e.params))throw new Ci(`Invalid params for ${e.method}`,4200);let r=e.params[0];if(!await Tk()||!this.address)throw new Ci("Disconnected",4900);let{signature:i}=await (t={address:this.address},o(r,t));return i}handleSwitchEthereumChain(e){let t;if(!e.params||!Array.isArray(e.params))throw new Ci(`Invalid params for ${e.method}`,4200);if("string"==typeof e.params[0])t=e.params[0];else{if(!("chainId"in e.params[0])||"string"!=typeof e.params[0].chainId)throw new Ci(`Invalid params for ${e.method}`,4200);t=e.params[0].chainId}this.chainId=Number(t),this.publicClient=(0,EP.g)(this.chainId,this.chains,this.rpcConfig,{appId:this.appId}),this.emit("chainChanged",t)}async handlePersonalSign(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for personal_sign");let t=e.params[0],r=e.params[1],{signature:i}=await s({message:t},{address:r});return i}async handleSignedTypedData(e){let t;if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_signTypedData_v4");let r=e.params[0],i="string"==typeof e.params[1]?JSON.parse(e.params[1]):e.params[1],{signature:n}=await (t=(0,ru.m)(i),a(t,{address:r}));return n}async handleEstimateGas(e){if(!e.params||!Array.isArray(e.params))throw Error("Invalid params for eth_estimateGas");delete e.params[0].gasPrice,delete e.params[0].maxFeePerGas,delete e.params[0].maxPriorityFeePerGas;let t={...e.params[0],chainId:(0,ru.t)(this.chainId)};return await this.publicClient.estimateGas({account:t.from??this.address,...(0,ni.toViemTransactionSerializable)(t)})}async request(e){let t;switch(console.debug("Embedded1193Provider.request() called with args",e),e.method){case"eth_accounts":case"eth_requestAccounts":return this.address?[this.address]:[];case"eth_chainId":return(0,ru.t)(this.chainId);case"eth_estimateGas":return this.handleEstimateGas(e);case"eth_sendTransaction":return this.handleSendTransaction(e);case"eth_signTransaction":return this.handleSignTransaction(e);case"wallet_switchEthereumChain":return this.handleSwitchEthereumChain(e);case"personal_sign":return this.handlePersonalSign(e);case"eth_signTypedData_v4":return this.handleSignedTypedData(e)}if(t=e.method,!TC.includes(t))return this.publicClient.request({method:e.method,params:e.params});{let t,r=await Tk();if(await (t={address:this.address},c(t)),!r||!this.address)throw new Ci("Disconnected",4900);try{let t={method:e.method,params:e.params},i=this.walletAccount;return i&&(0,rc.d)(i)?this.handleWalletApiRequest(t,i,r):(await this.walletProxy.rpc({accessToken:r,entropyId:this.entropyId,entropyIdVerifier:this.entropyIdVerifier,chainType:"ethereum",hdWalletIndex:this.walletIndex,request:t})).response.data}catch(e){throw console.error(e),new Ci("Disconnected",4900)}}}async handleWalletApiRequest(e,t,r){let i=this.privyClient;if(!i)throw new Ci("Disconnected",4900);if("secp256k1_sign"===e.method){let n=await (0,q.rpc)(i,async({message:e})=>this.walletProxy.signWithUserSigner({accessToken:r,message:e}),{chain_type:"ethereum",method:"secp256k1_sign",wallet_id:t.id,params:{hash:e.params[0]}});if("secp256k1_sign"!==n.method)throw new Ci(`Invalid params for ${e.method}`,4200);return n.data.signature}throw new Ci(`Method not supported: ${e.method}`,4200)}constructor({walletProxy:e,address:t,entropyId:r,entropyIdVerifier:i,rpcConfig:n,chains:s,appId:a,chainId:o=1,walletIndex:l,privyClient:c,walletAccount:d}){super(),this.walletProxy=e,this.address=t,this.entropyId=r,this.entropyIdVerifier=i,this.chainId=o,this.rpcConfig=n,this.chains=s,this.publicClient=(0,EP.g)(o,this.chains,n,{appId:a}),this.rpcTimeoutDuration=(0,ru.c)(n,"privy"),this.appId=a,this.walletIndex=l,this.privyClient=c,this.walletAccount=d}}let Cs=({style:e,...t})=>(0,B.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",style:{...e},...t,children:(0,B.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25"})}),Ca=({style:e,...t})=>(0,B.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"108",height:"108",viewBox:"0 0 108 108",fill:"none",style:{height:"28px",width:"28px",...e},...t,children:[(0,B.jsx)("rect",{width:"108",height:"108",rx:"23",fill:"#AB9FF2"}),(0,B.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M46.5267 69.9229C42.0054 76.8509 34.4292 85.6182 24.348 85.6182C19.5824 85.6182 15 83.6563 15 75.1342C15 53.4305 44.6326 19.8327 72.1268 19.8327C87.768 19.8327 94 30.6846 94 43.0079C94 58.8258 83.7355 76.9122 73.5321 76.9122C70.2939 76.9122 68.7053 75.1342 68.7053 72.314C68.7053 71.5783 68.8275 70.7812 69.0719 69.9229C65.5893 75.8699 58.8685 81.3878 52.5754 81.3878C47.993 81.3878 45.6713 78.5063 45.6713 74.4598C45.6713 72.9884 45.9768 71.4556 46.5267 69.9229ZM83.6761 42.5794C83.6761 46.1704 81.5575 47.9658 79.1875 47.9658C76.7816 47.9658 74.6989 46.1704 74.6989 42.5794C74.6989 38.9885 76.7816 37.1931 79.1875 37.1931C81.5575 37.1931 83.6761 38.9885 83.6761 42.5794ZM70.2103 42.5795C70.2103 46.1704 68.0916 47.9658 65.7216 47.9658C63.3157 47.9658 61.233 46.1704 61.233 42.5795C61.233 38.9885 63.3157 37.1931 65.7216 37.1931C68.0916 37.1931 70.2103 38.9885 70.2103 42.5795Z",fill:"#FFFDF8"})]});function Co(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var Cl=0;class Cc extends ru.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return{name:this.providerDetail.info.name,icon:this.providerDetail.info.icon,id:this.providerDetail.info.rdns}}disconnect(){console.warn(`Programmatic disconnect with ${this.providerDetail.info.name} is not yet supported.`)}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new rp.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,rf.f)(e)}}constructor(e,t,r,i,n){super(n||"unknown",e,t,r),this.connectorType="injected",this.proxyProvider=new ru.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.providerDetail=i;let s=i.provider;this.proxyProvider.setWalletProvider(s)}}var Cd="__private_"+Cl+++"__walletBranding";class Cu extends ru.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(e){return e.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return Co(this,Cd)[Cd]??{name:"Browser Extension",icon:Cs,id:"extension"}}disconnect(){console.warn("Programmatic disconnect with browser wallets is not yet supported.")}async promptConnection(){try{let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new rp.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,rf.f)(e)}}constructor(e,t,r,i,n){super(n??"unknown",e,t,r),Object.defineProperty(this,Cd,{writable:!0,value:void 0}),this.connectorType="injected",this.proxyProvider=new ru.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.proxyProvider.setWalletProvider(i),"metamask"===n?Co(this,Cd)[Cd]={name:"MetaMask",icon:ru.M,id:"io.metamask"}:"phantom"===n&&(Co(this,Cd)[Cd]={name:"Phantom",icon:Ca,id:"phantom"})}}class Ch extends Cc{disconnect(){console.warn("MetaMask does not support programmatic disconnect.")}async promptConnection(){try{ns.isMobile||await this.proxyProvider.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]});let e=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!e||0===e.length||!e[0])throw new rp.P("Unable to retrieve accounts");await this.syncAccounts([e[0]])}catch(e){throw(0,rf.f)(e)}}}class Cp extends rd.default{get wallets(){let e=new Set;return this.walletConnectors.flatMap(e=>e.wallets).sort((e,t)=>e.connectedAt&&t.connectedAt?t.connectedAt-e.connectedAt:0).filter(t=>{let r=`${t.address}${t.walletClientType}${t.connectorType}${t.meta.id}`;return!e.has(r)&&(e.add(r),!0)})}async initialize(e){if(this.initialized&&!e||(e&&this.removeAllConnectors(),this.externalWalletConfig.disableAllExternalWallets))return;let t=(0,ru.o)({store:this.store,walletList:this.walletList,externalWalletConfig:this.externalWalletConfig,walletChainType:this.walletChainType}).then(e=>{e.forEach(({type:e,eip6963InjectedProvider:t,legacyInjectedProvider:r})=>{this.createEthereumWalletConnector({connectorType:"injected",walletClientType:e,providers:{eip6963InjectedProvider:t,legacyInjectedProvider:r}})})});for(let e of(this.walletList.includes("coinbase_wallet")&&this.createEthereumWalletConnector({connectorType:"coinbase_wallet",walletClientType:"coinbase_wallet"}),this.walletList.includes("base_account")&&this.createEthereumWalletConnector({connectorType:"base_account",walletClientType:"base_account"}),Object.values(ru.q)))!e.isInstalled&&this.walletList.includes(e.client)&&(["ethereum-only","ethereum-and-solana"].includes(this.walletChainType)&&e.chainTypes.includes("ethereum")&&this.createEthereumWalletConnector({connectorType:"null",walletClientType:e.client,walletConfig:e}),["ethereum-and-solana","solana-only"].includes(this.walletChainType)&&e.chainTypes.includes("solana")&&this.addSolanaWalletConnector(new ru.S({id:e.client,name:e.name})));this.externalWalletConfig.walletConnect.enabled&&(this.walletList.includes("wallet_connect_qr")||(0,ru.e)(this.walletList))&&"solana-only"!==this.walletChainType&&this.createEthereumWalletConnector({connectorType:"wallet_connect_v2",walletClientType:"unknown"});let r=this.walletList.includes("wallet_connect_qr_solana")||(0,ru.e)(this.walletList)&&"ethereum-only"!==this.walletChainType,i=this.externalWalletConfig.solana.connectors?.get()||[],n=async e=>{if(!r)return;let t=e.find(e=>"walletconnect_solana"===e.walletBranding?.id);t&&t.wallet&&await t.wallet.initialize({walletConnectCloudProjectId:this.walletConnectCloudProjectId,privyAppName:this.privyAppName})};n(i),i.filter(e=>r||"walletconnect_solana"!==e.walletBranding?.id).forEach(this.addSolanaWalletConnector),this.externalWalletConfig.solana.connectors?._setOnConnectorsUpdated?.(e=>{n(e),e?.filter(e=>r||"walletconnect_solana"!==e.walletBranding?.id).forEach(this.addSolanaWalletConnector)}),await t,this.initialized=!0}findWalletConnector(e,t,r){return"wallet_connect_v2"===e?this.walletConnectors.filter(ru.r).find(t=>t.connectorType===e&&(!r||t.wallets.some(e=>e.address===r)))??null:this.walletConnectors.filter(ru.r).find(i=>i.connectorType===e&&i.walletClientType===t&&(!r||i.wallets.some(e=>e.address===r)))??null}findSolanaWalletConnector(e){return this.walletConnectors.filter(ru.v).find(t=>"unknown"===t.walletClientType?t.walletBranding.id===e:t.walletClientType===e)??null}findEmbeddedWalletConnectors(){return this.walletConnectors.filter(e=>"embedded"===e.connectorType)}findImportedWalletConnectors(){return this.walletConnectors.filter(e=>"embedded_imported"===e.connectorType)}onInitialized(e){e.wallets.forEach(e=>{let t=this.storedConnections.find(t=>t.address===e.address&&t.connectorType===e.connectorType&&("solana"===e.type&&"unknown"===t.walletClientType&&"unknown"===e.walletClientType?e.meta.id===t.id:t.walletClientType===e.walletClientType));t&&(e.connectedAt=t.connectedAt)}),this.emit("walletsUpdated"),this.emit("connectorInitialized")}onWalletsUpdated(e){e.initialized&&this.emit("walletsUpdated")}addEmbeddedWalletConnectors({walletProxy:e,user:t,embeddedWallets:r,defaultChain:i,appId:n,privyClient:s}){let{entropyId:a,entropyIdVerifier:o}=(0,rh.g)(t);for(let t of r){let r=this.findEmbeddedWalletConnectors().find(e=>e.walletIndex===t.walletIndex);if(r&&(0,ru.r)(r))r.proxyProvider.walletProxy=e;else{let r=new TT({provider:new Cn({walletProxy:e,address:t.address,entropyId:a,entropyIdVerifier:o,rpcConfig:this.rpcConfig,chains:this.chains,appId:n,chainId:i.id,walletIndex:t.walletIndex,privyClient:s,walletAccount:t}),chains:this.chains,defaultChain:i,rpcConfig:this.rpcConfig,imported:!1,walletIndex:t.walletIndex});this.addWalletConnector(r)}}}addImportedWalletConnector(e,t,r,i){let n=this.findWalletConnector("embedded_imported","privy",t);if(n&&(0,ru.r)(n))n.proxyProvider.walletProxy=e;else{let n=new TT({provider:new Cn({walletProxy:e,address:t,entropyId:t,entropyIdVerifier:"ethereum-address-verifier",walletIndex:0,rpcConfig:this.rpcConfig,chains:this.chains,appId:i,chainId:r.id}),chains:this.chains,walletIndex:0,defaultChain:r,rpcConfig:this.rpcConfig,imported:!0});this.addWalletConnector(n)}}removeEmbeddedWalletConnectors(){this.walletConnectors=this.walletConnectors.filter(e=>"embedded"!==e.connectorType),this.storedConnections=(0,rf.l)(),this.emit("walletsUpdated")}removeImportedWalletConnectors(){let e=this.findImportedWalletConnectors();e.length&&(e.forEach(e=>{let t=this.walletConnectors.indexOf(e);this.walletConnectors.splice(t,1)}),this.storedConnections=(0,rf.l)(),this.emit("walletsUpdated"))}async createEthereumWalletConnector({connectorType:e,walletClientType:t,providers:r,walletConfig:i}){let n=this.findWalletConnector(e,t);if(n&&(0,ru.r)(n))return n instanceof kb&&n.resetConnection(t),n;let s="injected"!==e?"coinbase_wallet"===e?new TI(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.coinbaseWallet.config):"base_account"===e?new T_(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.baseAccount.config,this.setBaseAccountSdk):"null"!==e?new kb({walletConnectCloudProjectId:this.walletConnectCloudProjectId,rpcConfig:this.rpcConfig,chains:this.chains,defaultChain:this.defaultChain,shouldEnforceDefaultChainOnConnect:this.shouldEnforceDefaultChainOnConnect,privyAppId:this.privyAppId,privyAppName:this.privyAppName,walletClientType:t}):i?new ru.w({id:i.client,name:i.name,defaultChain:this.defaultChain,walletClientType:i.client}):null:"metamask"===t&&r?.eip6963InjectedProvider?new Ch(this.chains,this.defaultChain,this.rpcConfig,r?.eip6963InjectedProvider,"metamask"):"metamask"===t&&r?.legacyInjectedProvider?new Cu(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider,"metamask"):"phantom"===t&&r?.legacyInjectedProvider?new Cu(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider,"phantom"):r?.legacyInjectedProvider&&"unknown_browser_extension"===t?new Cu(this.chains,this.defaultChain,this.rpcConfig,r?.legacyInjectedProvider):r?.eip6963InjectedProvider?new Cc(this.chains,this.defaultChain,this.rpcConfig,r?.eip6963InjectedProvider,t):void 0;return s&&this.addWalletConnector(s),s||null}addWalletConnector(e){this.walletConnectors.push(e),e.on("initialized",()=>this.onInitialized(e)),e.on("walletsUpdated",()=>this.onWalletsUpdated(e)),e.initialize().catch(e=>{console.debug("Failed to initialize connector",e)})}setWalletList(e){this.walletList=e,this.initialized&&this.initialize(!0).catch(console.error)}removeAllConnectors(){for(let e of this.walletConnectors)e.removeAllListeners();this.walletConnectors=[]}constructor(e,t,r,i,n,s,a,o,l,c,d,u){super(),this.addSolanaWalletConnector=async e=>{let t=this.findSolanaWalletConnector(e.walletClientType);if(!t||"null"===t.connectorType){if("null"===t?.connectorType){let e=this.walletConnectors.indexOf(t);this.walletConnectors.splice(e,1)}this.addWalletConnector(e)}},this.privyAppId=e,this.walletConnectCloudProjectId=t,this.rpcConfig=r,this.chains=i,this.defaultChain=n,this.walletConnectors=[],this.initialized=!1,this.store=s,this.walletList=a,this.shouldEnforceDefaultChainOnConnect=o,this.externalWalletConfig=l,this.privyAppName=c,this.walletChainType=u||"ethereum-only",this.setBaseAccountSdk=d,this.storedConnections=(0,rf.l)()}}let Cf=(0,su.create)(()=>({identityToken:null})),Cy=[nh,np,n4];class Cg{async get(e,t){try{return await this.baseFetch(e,t)}catch(e){throw(0,rp.f)(e)}}async post(e,t,r){try{return await this.baseFetch(e,{method:"POST",...t?{body:t}:{},...r})}catch(e){throw(0,rp.f)(e)}}async delete(e,t){try{return await this.baseFetch(e,{method:"DELETE",...t})}catch(e){throw(0,rp.f)(e)}}constructor({appId:e,appClientId:t,client:r,defaults:i}){this.appId=e,this.appClientId=t,this.clientAnalyticsId=r.clientAnalyticsId,this.sdkVersion=nn.V,this.client=r,this.defaults=i,this.fallbackApiUrl=r.fallbackApiUrl,this.baseFetch=EO.ofetch.create({baseURL:this.defaults.baseURL,timeout:this.defaults.timeout,retry:3,retryDelay:500,retryStatusCodes:[408,409,425,500,502,503,504],credentials:"include",onRequest:async({request:e,options:t})=>{let r=new Headers(t.headers);r.set("privy-app-id",this.appId),this.appClientId&&r.set("privy-client-id",this.appClientId),r.set("privy-ca-id",this.clientAnalyticsId||""),r.set("privy-client",`react-auth:${this.sdkVersion}`);let i=Cy.includes(e.toString());if(!r.has("authorization")){let e=await this.client.getAccessToken({disableAutoRefresh:i});null!==e&&r.set("authorization",`Bearer ${e}`)}t.headers=r,t.retryDelay&&"number"==typeof t.retryDelay&&(t.retryDelay=3*t.retryDelay)},onRequestError:({error:e})=>{if(e instanceof DOMException&&"AbortError"===e.name)throw new rp.h}})}}class Cm{getOrCreateGuestCredential(e){let t=(0,nn.g)(e);if((0,rf.e)()){if(rf.u.get(t))return rf.u.get(t);{let e=e_.encode(TB(32));return rf.u.put(t,e),e}}return e_.encode(TB(32))}async authenticate(){if(!this.api)throw new rp.a("Auth flow has no API instance");try{return await this.api.post(se,{guest_credential:this.meta.guestCredential})}catch(e){throw(0,rp.f)(e)}}async link(){throw Error("Linking is not supported for the guest flow")}constructor(e){this.meta={guestCredential:this.getOrCreateGuestCredential(e)}}}function Cw(){return!(ns.isSafari&&window.location.origin.startsWith("http://localhost"))}var Cb,Cv,CE,CA,C_,CS,CI,Cx,CT,Ck,CC,CP,CO,CR,CN,CM,CU,CD,Cj,CL,CB,CW,CF,Cz,Cq,CH,CK,C$,CV,CJ,CZ,CG,CY,CQ,CX,C0,C1,C2,C3,C5,C8,C6,C4,C7,C9,Pe,Pt=((Pe={}).PRIVY="privy_access_token",Pe.CUSTOMER="customer_access_token",Pe);class Pr{get token(){return this.privyAccessToken||this.customerAccessToken}getToken(e){return"privy_access_token"===e?this.privyAccessToken:this.customerAccessToken}get customerAccessToken(){return this._getToken(nn.C)}get privyAccessToken(){return this._getToken(nn.P)}_getToken(e){try{let t=rf.u.get(e);return"string"==typeof t?Tw.throwIfNotWellFormedJwt(t):null}catch(e){return console.error(e),this.destroyLocalState(),null}}get refreshToken(){try{let e=rf.u.get(nn.R);return"string"==typeof e?e:null}catch(e){return console.error(e),this.destroyLocalState(),null}}getProviderAccessToken(e){try{let t=rf.u.get((0,nn.e)(e));if("string"!=typeof t)return null;{let r=new Tw(t);return r.isExpired()?(rf.u.del((0,nn.e)(e)),null):r.value}}catch(e){return console.error(e),null}}get mightHaveServerCookies(){try{let e=ER.default.get(nn.f);return void 0!==e&&e.length>0}catch(e){console.error(e)}return!1}hasRefreshCredentials(e="privy_access_token"){let t="string"==typeof this.getToken(e),r="string"==typeof this.refreshToken&&this.refreshToken!==nn.h;return this.mightHaveServerCookies||t&&r}hasActiveAccessToken(e){let t=Tw.parse(this.getToken(e));return null!==t&&!t.isExpired(30)}authenticate(e){return this.authenticateOnce.execute(e)}link(e){return this.linkOnce.execute(e)}refresh(){return this.refreshOnce.execute()}destroy(){return this.destroyOnce.execute()}storeProviderAccessToken(e,t){"string"==typeof t?rf.u.put((0,nn.e)(e),t):rf.u.del((0,nn.e)(e))}updateIdentityToken(e){"string"==typeof e?this.storeIdentityToken(e):this.clearIdentityToken()}async _authenticate(e){try{let t=await e.authenticate(),{user:r,is_new_user:i,oauth_tokens:n}=t;this.handleTokenResponse(t);let s=n?{provider:n.provider,accessToken:n.access_token,accessTokenExpiresInSeconds:n.access_token_expires_in_seconds,refreshToken:n.refresh_token,refreshTokenExpiresInSeconds:n.refresh_token_expires_in_seconds,scopes:n.scopes}:void 0;return this._trackAuthenticateEvents(e,i),{user:(0,rc.l)(r),isNewUser:i,oAuthTokens:s}}catch(e){throw console.warn("Error authenticating session"),(0,rp.i)(e)}}_trackAuthenticateEvents(e,t){let r=e instanceof TO?"email":e instanceof TZ?"sms":e instanceof TV?"siwe":e instanceof Cm?"guest":e instanceof k7?"custom_auth":e instanceof Tq?e.meta.provider:null;r&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate",payload:{method:r,isNewUser:t}}),"siwe"===r&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate_siwe",payload:{connectorType:e.meta.connectorType,walletClientType:e.meta.walletClientType}})}async _link(e){try{let t=await e.link(),r=t.oauth_tokens,i=r?{provider:r.provider,accessToken:r.access_token,accessTokenExpiresInSeconds:r.access_token_expires_in_seconds,refreshToken:r.refresh_token,refreshTokenExpiresInSeconds:r.refresh_token_expires_in_seconds,scopes:r.scopes}:void 0;return{user:(0,rc.l)(t),oAuthTokens:i}}catch(e){throw console.warn("Error linking account"),(0,rp.i)(e)}}async _refresh(){if(!this.api)throw new rp.a("Session has no API instance");if(!this.client)throw new rp.a("Session has no PrivyClient instance");await this.client.getAccessToken({disableAutoRefresh:!0});let e=this.token,t=this.refreshToken;if(this.client.useServerCookies&&!this.mightHaveServerCookies&&this.token&&window.location.origin===this.client.apiUrl)return this.destroyLocalState(),null;try{let r;if(!(e&&t||this.mightHaveServerCookies))return null;{let i={};e&&(i.authorization=`Bearer ${e}`),r=await this.api.post(nh,t?{refresh_token:t}:{},{headers:i})}return this.handleTokenResponse(r),(0,rc.l)(r.user)}catch(e){if(e instanceof rp.e&&e.privyErrorCode===rp.b.MISSING_OR_INVALID_TOKEN)return console.warn("Unable to refresh tokens - token is missing or no longer valid"),this.destroyLocalState(),null;throw(0,rp.i)(e)}}handleTokenResponse(e){e.session_update_action&&"set"!==e.session_update_action?"clear"===e.session_update_action?this.destroyLocalState():"ignore"===e.session_update_action&&(e.token&&(this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token)),e.identity_token&&this.storeIdentityToken(e.identity_token)):this._storeAllTokens(e)}_storeAllTokens(e){this.storeRefreshToken(e.refresh_token),this.storeCustomerAccessToken(e.token),this.storePrivyAccessToken(e.privy_access_token),e.identity_token&&this.storeIdentityToken(e.identity_token)}async _destroy(){try{await this.api?.post(np,{refresh_token:this.refreshToken})}catch(e){console.warn("Error destroying session")}this.destroyLocalState()}destroyLocalState(){this.storeRefreshToken(null),this.storeCustomerAccessToken(null),this.storePrivyAccessToken(null),this.clearIdentityToken()}storeCustomerAccessToken(e){if("string"==typeof e){let t=rf.u.get(nn.C);if(rf.u.put(nn.C,e),!this.client?.useServerCookies){let t=Tw.parse(e)?.expiration;ER.default.set(nn.i,e,{sameSite:"Strict",secure:Cw(),expires:t?new Date(1e3*t):void 0})}t!==e&&this.client?.onStoreCustomerAccessToken?.(e)}else rf.u.del(nn.C),ER.default.remove(nn.i),this.client?.onDeleteCustomerAccessToken?.()}storeRefreshToken(e){"string"==typeof e?(rf.u.put(nn.R,e),this.client?.useServerCookies||ER.default.set(nn.f,"t",{sameSite:"Strict",secure:Cw(),expires:30})):(rf.u.del(nn.R),ER.default.remove(nn.j),ER.default.remove(nn.f))}storePrivyAccessToken(e){"string"==typeof e?rf.u.put(nn.P,e):rf.u.del(nn.P)}storeIdentityToken(e){if(Cf.setState({identityToken:e}),this.client?.useServerCookies)return;rf.u.put(nn.I,e);let t=Tw.parse(e)?.expiration;ER.default.set(nn.k,e,{sameSite:"Strict",secure:Cw(),expires:t?new Date(1e3*t):void 0})}clearIdentityToken(){rf.u.del(nn.I),Cf.setState({identityToken:null}),ER.default.remove(nn.k)}constructor(){this.authenticateOnce=new TN(async e=>this._authenticate(e)),this.linkOnce=new TN(async e=>this._link(e)),this.refreshOnce=new TN(this._refresh.bind(this)),this.destroyOnce=new TN(this._destroy.bind(this))}}var Pi=0,Pn="__private_"+Pi+++"__getOrGenerateClientAnalyticsId";class Ps{getAppId(){return this.appId}initializeConnectorManager({walletConnectCloudProjectId:e,rpcConfig:t,chains:r,defaultChain:i,store:n,walletList:s,shouldEnforceDefaultChainOnConnect:a,externalWalletConfig:o,appName:l,walletChainType:c,setBaseAccountSdk:d}){this.connectors||(this.connectors=new Cp(this.appId,e,t,r,i,n,s,a,o,l,d,c))}generateApi(){let e=new Cg({appId:this.appId,appClientId:this.appClientId,client:this,defaults:{baseURL:this.apiUrl,timeout:this.timeout}});return this.session.api=e,e}updateApiUrl(e){this.apiUrl=e||this.fallbackApiUrl,this.api=this.generateApi(),e&&(this.useServerCookies=!0)}authenticate(){if(!this.authFlow)throw new rp.a("No auth flow in progress.");return this.session.authenticate(this.authFlow)}async link(){if(!this.authFlow)throw new rp.a("No auth flow in progress.");let{oAuthTokens:e}=await this.session.link(this.authFlow);return{user:await this.getAuthenticatedUser(),oAuthTokens:e}}storeProviderAccessToken(e,t){this.session.storeProviderAccessToken(e,t)}getProviderAccessToken(e){return this.session.getProviderAccessToken(e)}async logout(){await this.session.destroy(),this.authFlow=void 0}clearProviderAcccessTokens(e){e.linkedAccounts.filter(e=>"cross_app"===e.type).forEach(e=>{this.storeProviderAccessToken(e.providerApp.id,null)})}startAuthFlow(e){return e.api=this.api,this.authFlow=e,this.authFlow}async initMfaSmsVerification(){try{await this.api.post(n5,{action:"verify"})}catch(e){throw(0,rp.f)(e)}}async initMfaPasskeyVerification(){try{let e,t=await this.api.post(n8,{});return{rpId:(e=t.options).rp_id,challenge:e.challenge,allowCredentials:e.allow_credentials?.map(e=>({id:e.id,type:e.type,transports:e.transports}))||[],timeout:e.timeout,extensions:{appid:e.extensions?.app_id,credProps:e.extensions?.cred_props,hmacCreateSecret:e.extensions?.hmac_create_secret},userVerification:e.user_verification}}catch(e){throw(0,rp.f)(e)}}async getCrossAppProviderDetails(e){try{return this._cachedProviderAppDetails[e]||(this._cachedProviderAppDetails[e]=await this.api.get(`/api/v1/apps/${e}/cross-app/details`)),this._cachedProviderAppDetails[e]}catch(e){console.error("Error fetching cross app provider details",e)}}async acceptTerms(){try{let e=await this.api.post(n6,{});return(0,rc.l)(e)}catch(e){throw(0,rp.i)(e)}}async unlinkEmail(e){try{let t=await this.api.post(nM,{address:e});return await this.getAuthenticatedUser()??(0,rc.l)(t)}catch(e){throw(0,rp.i)(e)}}async unlinkPhone(e){try{let t=await this.api.post(nB,{phoneNumber:e});return await this.getAuthenticatedUser()??(0,rc.l)(t)}catch(e){throw(0,rp.i)(e)}}async unlinkEthereumWallet(e){try{let t=await this.api.post(nw,{address:e});return await this.getAuthenticatedUser()??(0,rc.l)(t)}catch(e){throw(0,rp.i)(e)}}async unlinkSolanaWallet(e){try{let t=await this.api.post(n_,{address:e});return await this.getAuthenticatedUser()??(0,rc.l)(t)}catch(e){throw(0,rp.i)(e)}}async unlinkOAuth(e,t){try{let r=await this.api.post(n$,{provider:e,subject:t});return await this.getAuthenticatedUser()??(0,rc.l)(r)}catch(e){throw(0,rp.i)(e)}}async unlinkFarcaster(e){try{let t=await this.api.post(nC,{fid:e});return await this.getAuthenticatedUser()??(0,rc.l)(t)}catch(e){throw(0,rp.i)(e)}}async unlinkTelegram(e){try{let t=await this.api.post(n2,{telegram_user_id:e});return await this.getAuthenticatedUser()??(0,rc.l)(t)}catch(e){throw(0,rp.i)(e)}}async revokeDelegatedWallet(){try{await this.api.post(sn,{})}catch(e){throw(0,rp.i)(e)}}async createAnalyticsEvent({eventName:e,payload:t,timestamp:r,options:i}){if("undefined"!=typeof window)try{this.clientAnalyticsId||console.warn("No client analytics id set, refusing to send analytics event"),await this.api.post(n4,{event_name:e,client_id:this.clientAnalyticsId,payload:{...t||{},clientTimestamp:r?r.toISOString():(new Date).toISOString()}},{retry:-1,keepalive:i?.keepAlive??!1})}catch(e){console.log("Unable to submit event. This is not an issue.")}}async signMoonpayOnRampUrl(e){try{return this.api.post(st,e)}catch(e){throw(0,rp.i)(e)}}async initCoinbaseOnRamp(e){try{return this.api.post(sr,e)}catch(e){throw(0,rp.i)(e)}}async getCoinbaseOnRampStatus({partnerUserId:e}){try{return this.api.get(`${si}?partnerUserId=${e}`)}catch(e){throw(0,rp.i)(e)}}async getAuthenticatedUser(){return this.session.hasRefreshCredentials()?this.session.refresh():null}async getAccessToken(e){return await this.getPrivyAccessToken(e)||await this.getCustomerAccessToken(e)}async getCustomerAccessToken(e){return await this._getToken(Pt.CUSTOMER,e)}async getPrivyAccessToken(e){return await this._getToken(Pt.PRIVY,e)}async _getToken(e,t){return this.session.getToken(e)?this.session.hasActiveAccessToken(e)?this.session.hasRefreshCredentials(e)?Tb.parse(this.session.getToken(e))?.appId!==this.appId?(await this.logout(),null):this.session.getToken(e):(this.session.destroyLocalState(),null):!t?.disableAutoRefresh&&this.session.hasRefreshCredentials(e)?(await this.session.refresh(),this.session.getToken(e)):null:null}async getUsdTokenPrice(e){try{return(await this.api.get(`/api/v1/token_price?chainId=${e.id}&tokenSymbol=${e.nativeCurrency.symbol}`)).usd}catch(t){return void console.error(`Unable to fetch token price for chain with id ${e.id}`)}}async getUsdPriceForSol(){try{return(await this.api.get("/api/v1/token_price?chainId=0&tokenSymbol=SOL")).usd}catch(e){return void console.error("Unable to fetch token price for SOL")}}async getSplTokenMetadata({mintAddress:e,cluster:t}){try{return await this.api.get(`/api/v1/spl_token_info?mint_address=${e}&cluster=${t}`)}catch(r){return void console.error(`Unable to fetch token metadata for ${t}:${e}`)}}async requestFarcasterSignerStatus(e){try{return await this.api.post("/api/v1/farcaster/signer/status",{ed25519_public_key:e})}catch(e){throw console.error("Unable to fetch Farcaster signer status"),e}}async generateSiweNonce({address:e,captchaToken:t}){try{return(await this.api.post(nf,{address:e,token:t})).nonce}catch(e){throw(0,rp.i)(e)}}async authenticateWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n,mode:s}){return await this.api.post(ny,{message:e,signature:t,chainId:r,walletClientType:i,connectorType:n,mode:s})}async linkWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n}){return await this.api.post(ng,{message:e,signature:t,chainId:r,walletClientType:i,connectorType:n})}async linkSmartWallet({message:e,signature:t,smartWalletType:r,smartWalletVersion:i}){try{let n=await this.api.post(nm,{message:e,signature:t,smart_wallet_type:r,smart_wallet_version:i});return(0,rc.l)(n)}catch(e){throw(0,rp.i)(e)}}async linkWithSiwe({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n}){try{let s=await this.linkWithSiweInternal({message:e,signature:t,chainId:r,walletClientType:i,connectorType:n});return(0,rc.l)(s)}catch(e){throw(0,rp.i)(e)}}async generateSiwsNonce({address:e,captchaToken:t}){try{return(await this.api.post(nv,{address:e,token:t})).nonce}catch(e){throw(0,rp.i)(e)}}async authenticateWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s="plain"}){return await this.api.post(nE,{message:e,signature:t,walletClientType:r,connectorType:i,mode:n,message_type:s})}async authenticateWithSiws({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s="plain"}){let a=await this.authenticateWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,mode:n,messageType:s});this.session.handleTokenResponse(a);let o=(0,rc.l)(a.user);if(!o)throw Error("Authentication failed - no user returned");return{user:o,isNewUser:a.is_new_user||!1}}async sendAccountTransferRequest({nonce:e,account:t,accountType:r,externalWalletMetadata:i,telegramAuthResult:n,telegramWebAppData:s,farcasterEmbeddedAddress:a,oAuthUserInfo:o}){try{let l,c;switch(r){case"email":l=nD,c={nonce:e,email:t};break;case"sms":l=nz,c={nonce:e,phoneNumber:t};break;case"siwe":if(l=nb,!i)throw Error("Wallet parameters must be defined");c={nonce:e,address:t,...i};break;case"farcaster":l=nP,c={nonce:e,farcaster_id:t,farcaster_embedded_address:a};break;case"telegram":l=n3,c={nonce:e,telegram_auth_result:n,telegram_web_app_data:s};break;case"siws":l=nS,c={nonce:e,address:t,...i};break;case"custom":case"guest":case"passkey":throw Error("Invalid transfer account type");default:l=nV,c={nonce:e,userInfo:o}}let d=await this.api.post(l,c);return await this.getAuthenticatedUser()??(0,rc.l)(d)}catch(e){throw(0,rp.i)(e)}}async linkWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n="plain"}){return await this.api.post(nA,{message:e,signature:t,walletClientType:r,connectorType:i,message_type:n})}async linkWithSiws({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n="plain"}){try{let s=await this.linkWithSiwsInternal({message:e,signature:t,walletClientType:r,connectorType:i,messageType:n});return(0,rc.l)(s)}catch(e){throw(0,rp.i)(e)}}async updateUserAndIdToken(){try{let e=await this.api.get(ss);return this.session.updateIdentityToken(e.identity_token),(0,rc.l)(e.user)}catch(e){throw(0,rp.i)(e)}}async scanTransaction(e){try{return await this.api.post(sa,e)}catch(e){throw(0,rp.i)(e)}}constructor({apiUrl:e=nn.D,appId:t,appClientId:r,timeout:i=nn.l}){Object.defineProperty(this,Pn,{value:Pa}),this._cachedProviderAppDetails={},this.apiUrl=e,this.fallbackApiUrl=this.apiUrl,this.useServerCookies=e!==nn.D&&e.startsWith("https://privy."),this.timeout=i,this.appId=t,this.appClientId=r,this.clientAnalyticsId=(function(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e})(this,Pn)[Pn](),d||(d=new Pr),this.session=d,this.api=this.generateApi(),this.session.client=this}}function Pa(){if("undefined"==typeof window)return null;try{let e=rf.u.get(nn.d);if("string"==typeof e&&e.length>0)return e}catch(e){}let e=(0,K.v4)();try{return rf.u.put(nn.d,e),e}catch(t){return e}}function Po(){if(!u)throw new rp.a("No global PrivyClient instance found. Please ensure you have initialized the PrivyProvider.");return u}let Pl=({config:e,...t})=>{(()=>{if((0,W.useContext)(Ct))throw new rp.a("Multiple PrivyProvider instances found","Found multiple instances of PrivyProvider, ensure there is only one mounted in your application tree.")})(),function(){if("undefined"==typeof window)return;let e=["localhost","127.0.0.1"].includes(window.location.hostname),t="https:"===window.location.protocol||"chrome-extension:"===window.location.protocol;if(!e&&!t)throw new rp.a("Embedded wallet is only available over HTTPS")}(),function(e){if("string"!=typeof e||25!==e.length)throw new rp.a("Cannot initialize the Privy provider with an invalid Privy app ID")}(t.appId),u||(u=new Ps({appId:t.appId,appClientId:t.clientId,apiUrl:t.apiUrl}));let r=(0,W.useMemo)(()=>new F.default({appId:t.appId,clientId:t.clientId,storage:rf.u,baseUrl:t.apiUrl,sdkVersion:"react-auth:3.10.0"}),[]),i=Po(),n=Object.assign({},e);return(0,B.jsx)(nn.m,{client:r,legacyClient:i,appClientId:t.clientId,clientConfig:n,children:(0,B.jsx)(so.P,{children:(0,B.jsx)(Cr,{...t,client:i,privy:r})})})};function Pc(){let{promptMfa:e,init:t,submit:r,cancel:i,mfaMethods:n}=(0,W.useContext)(rc.P);return{promptMfa:e,init:t,submit:r,cancel:i,mfaMethods:n}}function Pd(){let{initEnrollmentWithSms:e,initEnrollmentWithTotp:t,initEnrollmentWithPasskey:r,submitEnrollmentWithSms:i,submitEnrollmentWithTotp:n,submitEnrollmentWithPasskey:s,unenroll:a,enrollInMfa:o}=(0,W.useContext)(rc.P);return{initEnrollmentWithSms:e,initEnrollmentWithTotp:t,initEnrollmentWithPasskey:r,submitEnrollmentWithSms:i,submitEnrollmentWithTotp:n,submitEnrollmentWithPasskey:s,unenrollWithSms:()=>a("sms"),unenrollWithTotp:()=>a("totp"),unenrollWithPasskey:e=>a("passkey",e),showMfaEnrollmentModal:()=>o(!0),closeMfaEnrollmentModal:()=>o(!1)}}e.s(["A",()=>TE,"B",()=>Cs,"C",()=>TQ,"D",()=>TA,"E",()=>kV,"F",()=>Ca,"G",()=>Tv,"H",()=>Pl,"P",()=>kE,"R",()=>TN,"S",()=>TJ,"W",()=>kb,"a",()=>T0,"b",()=>TV,"c",()=>kJ,"d",()=>Pd,"e",()=>k_,"f",()=>kk,"g",()=>kx,"h",()=>kI,"i",()=>kC,"j",()=>kT,"k",()=>k3,"l",()=>TH,"m",()=>T2,"n",()=>kS,"o",()=>TW,"p",()=>k8,"q",()=>TF,"r",()=>Tz,"s",()=>k1,"t",()=>k0,"u",()=>Pc,"v",()=>k$,"w",()=>kQ,"x",()=>kZ,"y",()=>Tx,"z",()=>kY],658044)}]);