module.exports=[138129,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.toBig=c.shrSL=c.shrSH=c.rotrSL=c.rotrSH=c.rotrBL=c.rotrBH=c.rotr32L=c.rotr32H=c.rotlSL=c.rotlSH=c.rotlBL=c.rotlBH=c.add5L=c.add5H=c.add4L=c.add4H=c.add3L=c.add3H=void 0,c.add=u,c.fromBig=f,c.split=g;let d=BigInt(0x100000000-1),e=BigInt(32);function f(a,b=!1){return b?{h:Number(a&d),l:Number(a>>e&d)}:{h:0|Number(a>>e&d),l:0|Number(a&d)}}function g(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let g=0;g<c;g++){let{h:c,l:h}=f(a[g],b);[d[g],e[g]]=[c,h]}return[d,e]}let h=(a,b)=>BigInt(a>>>0)<<e|BigInt(b>>>0);c.toBig=h;let i=(a,b,c)=>a>>>c;c.shrSH=i;let j=(a,b,c)=>a<<32-c|b>>>c;c.shrSL=j;let k=(a,b,c)=>a>>>c|b<<32-c;c.rotrSH=k;let l=(a,b,c)=>a<<32-c|b>>>c;c.rotrSL=l;let m=(a,b,c)=>a<<64-c|b>>>c-32;c.rotrBH=m;let n=(a,b,c)=>a>>>c-32|b<<64-c;c.rotrBL=n;let o=(a,b)=>b;c.rotr32H=o;let p=(a,b)=>a;c.rotr32L=p;let q=(a,b,c)=>a<<c|b>>>32-c;c.rotlSH=q;let r=(a,b,c)=>b<<c|a>>>32-c;c.rotlSL=r;let s=(a,b,c)=>b<<c-32|a>>>64-c;c.rotlBH=s;let t=(a,b,c)=>a<<c-32|b>>>64-c;function u(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}c.rotlBL=t;let v=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0);c.add3L=v;let w=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0;c.add3H=w;let x=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0);c.add4L=x;let y=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0;c.add4H=y;let z=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0);c.add5L=z;let A=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0;c.add5H=A,c.default={fromBig:f,split:g,toBig:h,shrSH:i,shrSL:j,rotrSH:k,rotrSL:l,rotrBH:m,rotrBL:n,rotr32H:o,rotr32L:p,rotlSH:q,rotlSL:r,rotlBH:s,rotlBL:t,add:u,add3L:v,add3H:w,add4L:x,add4H:y,add5H:A,add5L:z}},889784,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.crypto=void 0;let d=a.r(666680);c.crypto=d&&"object"==typeof d&&"webcrypto"in d?d.webcrypto:d&&"object"==typeof d&&"randomBytes"in d?d:void 0},996418,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.wrapXOFConstructorWithOpts=c.wrapConstructorWithOpts=c.wrapConstructor=c.Hash=c.nextTick=c.swap32IfBE=c.byteSwapIfBE=c.swap8IfBE=c.isLE=void 0,c.isBytes=e,c.anumber=f,c.abytes=g,c.ahash=function(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");f(a.outputLen),f(a.blockLen)},c.aexists=function(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")},c.aoutput=function(a,b){g(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)},c.u8=function(a){return new Uint8Array(a.buffer,a.byteOffset,a.byteLength)},c.u32=function(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))},c.clean=function(...a){for(let b=0;b<a.length;b++)a[b].fill(0)},c.createView=function(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)},c.rotr=function(a,b){return a<<32-b|a>>>b},c.rotl=function(a,b){return a<<b|a>>>32-b>>>0},c.byteSwap=h,c.byteSwap32=i,c.bytesToHex=function(a){if(g(a),j)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=k[a[c]];return b},c.hexToBytes=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(j)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=l(a.charCodeAt(e)),f=l(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d},c.asyncLoop=m,c.utf8ToBytes=n,c.bytesToUtf8=function(a){return new TextDecoder().decode(a)},c.toBytes=o,c.kdfInputToBytes=function(a){return"string"==typeof a&&(a=n(a)),g(a),a},c.concatBytes=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];g(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c},c.checkOpts=function(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options should be object or undefined");return Object.assign(a,b)},c.createHasher=p,c.createOptHasher=q,c.createXOFer=r,c.randomBytes=function(a=32){if(d.crypto&&"function"==typeof d.crypto.getRandomValues)return d.crypto.getRandomValues(new Uint8Array(a));if(d.crypto&&"function"==typeof d.crypto.randomBytes)return Uint8Array.from(d.crypto.randomBytes(a));throw Error("crypto.getRandomValues must be defined")};let d=a.r(889784);function e(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function f(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function g(a,...b){if(!e(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function h(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}function i(a){for(let b=0;b<a.length;b++)a[b]=h(a[b]);return a}c.isLE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],c.swap8IfBE=c.isLE?a=>a:a=>h(a),c.byteSwapIfBE=c.swap8IfBE,c.swap32IfBE=c.isLE?a=>a:i;let j="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,k=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function l(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}async function m(a,b,d){let e=Date.now();for(let f=0;f<a;f++){d(f);let a=Date.now()-e;a>=0&&a<b||(await (0,c.nextTick)(),e+=a)}}function n(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function o(a){return"string"==typeof a&&(a=n(a)),g(a),a}function p(a){let b=b=>a().update(o(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function q(a){let b=(b,c)=>a(c).update(o(b)).digest(),c=a({});return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}function r(a){let b=(b,c)=>a(c).update(o(b)).digest(),c=a({});return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}c.nextTick=async()=>{},c.Hash=class{},c.wrapConstructor=p,c.wrapConstructorWithOpts=q,c.wrapXOFConstructorWithOpts=r},282173,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.shake256=c.shake128=c.keccak_512=c.keccak_384=c.keccak_256=c.keccak_224=c.sha3_512=c.sha3_384=c.sha3_256=c.sha3_224=c.Keccak=void 0,c.keccakP=t;let d=a.r(138129),e=a.r(996418),f=BigInt(0),g=BigInt(1),h=BigInt(2),i=BigInt(7),j=BigInt(256),k=BigInt(113),l=[],m=[],n=[];for(let a=0,b=g,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],l.push(2*(5*d+c)),m.push((a+1)*(a+2)/2%64);let e=f;for(let a=0;a<7;a++)(b=(b<<g^(b>>i)*k)%j)&h&&(e^=g<<(g<<BigInt(a))-g);n.push(e)}let o=(0,d.split)(n,!0),p=o[0],q=o[1],r=(a,b,c)=>c>32?(0,d.rotlBH)(a,b,c):(0,d.rotlSH)(a,b,c),s=(a,b,c)=>c>32?(0,d.rotlBL)(a,b,c):(0,d.rotlSL)(a,b,c);function t(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=r(f,g,1)^c[d],i=s(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=m[c],f=r(b,e,d),g=s(b,e,d),h=l[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=p[d],a[1]^=q[d]}(0,e.clean)(c)}class u extends e.Hash{constructor(a,b,c,d=!1,f=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=f,(0,e.anumber)(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=(0,e.u32)(this.state)}clone(){return this._cloneInto()}keccak(){(0,e.swap32IfBE)(this.state32),t(this.state32,this.rounds),(0,e.swap32IfBE)(this.state32),this.posOut=0,this.pos=0}update(a){(0,e.aexists)(this),a=(0,e.toBytes)(a),(0,e.abytes)(a);let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){(0,e.aexists)(this,!1),(0,e.abytes)(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return(0,e.anumber)(a),this.xofInto(new Uint8Array(a))}digestInto(a){if((0,e.aoutput)(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,(0,e.clean)(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new u(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}c.Keccak=u;let v=(a,b,c)=>(0,e.createHasher)(()=>new u(b,a,c));c.sha3_224=v(6,144,28),c.sha3_256=v(6,136,32),c.sha3_384=v(6,104,48),c.sha3_512=v(6,72,64),c.keccak_224=v(1,144,28),c.keccak_256=v(1,136,32),c.keccak_384=v(1,104,48),c.keccak_512=v(1,72,64);let w=(a,b,c)=>(0,e.createXOFer)((d={})=>new u(b,a,void 0===d.dkLen?c:d.dkLen,!0));c.shake128=w(31,168,16),c.shake256=w(31,136,32)},442674,(a,b,c)=>{let{keccak_256:d}=a.r(282173);function e(a){return Buffer.allocUnsafe(a).fill(0)}function f(a,b){let c=a.toString(16);c.length%2!=0&&(c="0"+c);let d=c.match(/.{1,2}/g).map(a=>parseInt(a,16));for(;d.length<b;)d.unshift(0);return Buffer.from(d)}function g(a,b,c){let d=e(b);return(a=h(a),c)?a.length<b?(a.copy(d),d):a.slice(0,b):a.length<b?(a.copy(d,b-a.length),d):a.slice(-b)}function h(a){if(!Buffer.isBuffer(a))if(Array.isArray(a))a=Buffer.from(a);else if("string"==typeof a){var b;a=i(a)?Buffer.from((b=j(a)).length%2?"0"+b:b,"hex"):Buffer.from(a)}else if("number"==typeof a)a=intToBuffer(a);else if(null==a)a=Buffer.allocUnsafe(0);else if("bigint"==typeof a)a=f(a);else if(a.toArray)a=Buffer.from(a.toArray());else throw Error("invalid type");return a}function i(a){return"string"==typeof a&&a.match(/^0x[0-9A-Fa-f]*$/)}function j(a){return"string"==typeof a&&a.startsWith("0x")?a.slice(2):a}b.exports={zeros:e,setLength:g,setLengthRight:function(a,b){return g(a,b,!0)},isHexString:i,stripHexPrefix:j,toBuffer:h,bufferToHex:function(a){return"0x"+(a=h(a)).toString("hex")},keccak:function(a,b){if(a=h(a),b||(b=256),256!==b)throw Error("unsupported");return Buffer.from(d(new Uint8Array(a)))},bitLengthFromBigInt:function(a){return a.toString(2).length},bufferBEFromBigInt:f,twosFromBigInt:function(a,b){return(a<0n?(~a&(1n<<BigInt(b))-1n)+1n:a)&(1n<<BigInt(b))-1n}}},365853,(a,b,c)=>{let d=a.r(442674);function e(a){if(a.startsWith("int["))return"int256"+a.slice(3);if("int"===a)return"int256";if(a.startsWith("uint["))return"uint256"+a.slice(4);if("uint"===a)return"uint256";if(a.startsWith("fixed["))return"fixed128x128"+a.slice(5);else if("fixed"===a)return"fixed128x128";else if(a.startsWith("ufixed["))return"ufixed128x128"+a.slice(6);else if("ufixed"===a)return"ufixed128x128";return a}function f(a){return Number.parseInt(/^\D+(\d+)$/.exec(a)[1],10)}function g(a){var b=/^\D+(\d+)x(\d+)$/.exec(a);return[Number.parseInt(b[1],10),Number.parseInt(b[2],10)]}function h(a){var b=a.match(/(.*)\[(.*?)\]$/);return b?""===b[2]?"dynamic":Number.parseInt(b[2],10):null}function i(a){var b=typeof a;if("string"===b||"number"===b)return BigInt(a);if("bigint"===b)return a;throw Error("Argument is not a number")}function j(a,b){if("address"===a)return j("uint160",i(b));if("bool"===a)return j("uint8",+!!b);if("string"===a)return j("bytes",new Buffer(b,"utf8"));if((m=a).lastIndexOf("]")===m.length-1){if(void 0===b.length)throw Error("Not an array?");if("dynamic"!==(c=h(a))&&0!==c&&b.length>c)throw Error("Elements exceed array size: "+c);for(l in k=[],a=a.slice(0,a.lastIndexOf("[")),"string"==typeof b&&(b=JSON.parse(b)),b)k.push(j(a,b[l]));if("dynamic"===c){var c,e,k,l,m,n=j("uint256",b.length);k.unshift(n)}return Buffer.concat(k)}else if("bytes"===a)return b=new Buffer(b),k=Buffer.concat([j("uint256",b.length),b]),b.length%32!=0&&(k=Buffer.concat([k,d.zeros(32-b.length%32)])),k;else if(a.startsWith("bytes")){if((c=f(a))<1||c>32)throw Error("Invalid bytes<N> width: "+c);return d.setLengthRight(b,32)}else if(a.startsWith("uint")){if((c=f(a))%8||c<8||c>256)throw Error("Invalid uint<N> width: "+c);e=i(b);let g=d.bitLengthFromBigInt(e);if(g>c)throw Error("Supplied uint exceeds width: "+c+" vs "+g);if(e<0)throw Error("Supplied uint is negative");return d.bufferBEFromBigInt(e,32)}else if(a.startsWith("int")){if((c=f(a))%8||c<8||c>256)throw Error("Invalid int<N> width: "+c);e=i(b);let g=d.bitLengthFromBigInt(e);if(g>c)throw Error("Supplied int exceeds width: "+c+" vs "+g);let h=d.twosFromBigInt(e,256);return d.bufferBEFromBigInt(h,32)}else if(a.startsWith("ufixed")){if(c=g(a),(e=i(b))<0)throw Error("Supplied ufixed is negative");return j("uint256",e*BigInt(2)**BigInt(c[1]))}else if(a.startsWith("fixed"))return c=g(a),j("int256",i(b)*BigInt(2)**BigInt(c[1]));throw Error("Unsupported or invalid type: "+a)}function k(a,b){if(a.length!==b.length)throw Error("Number of types are not matching the values");for(var c,g,h=[],j=0;j<a.length;j++){var k=e(a[j]),l=b[j];if("bytes"===k)h.push(l);else if("string"===k)h.push(new Buffer(l,"utf8"));else if("bool"===k)h.push(new Buffer(l?"01":"00","hex"));else if("address"===k)h.push(d.setLength(l,20));else if(k.startsWith("bytes")){if((c=f(k))<1||c>32)throw Error("Invalid bytes<N> width: "+c);h.push(d.setLengthRight(l,c))}else if(k.startsWith("uint")){if((c=f(k))%8||c<8||c>256)throw Error("Invalid uint<N> width: "+c);g=i(l);let a=d.bitLengthFromBigInt(g);if(a>c)throw Error("Supplied uint exceeds width: "+c+" vs "+a);h.push(d.bufferBEFromBigInt(g,c/8))}else if(k.startsWith("int")){if((c=f(k))%8||c<8||c>256)throw Error("Invalid int<N> width: "+c);g=i(l);let a=d.bitLengthFromBigInt(g);if(a>c)throw Error("Supplied int exceeds width: "+c+" vs "+a);let b=d.twosFromBigInt(g,c);h.push(d.bufferBEFromBigInt(b,c/8))}else throw Error("Unsupported or invalid type: "+k)}return Buffer.concat(h)}b.exports={rawEncode:function(a,b){var c=[],d=[],f=32*a.length;for(var g in a){var i=e(a[g]),k=j(i,b[g]);"string"===i||"bytes"===i||"dynamic"===h(i)?(c.push(j("uint256",f)),d.push(k),f+=k.length):c.push(k)}return Buffer.concat(c.concat(d))},solidityPack:k,soliditySHA3:function(a,b){return d.keccak(k(a,b))}}},646051,(a,b,c)=>{let d=a.r(442674),e=a.r(365853),f={type:"object",properties:{types:{type:"object",additionalProperties:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"}},required:["name","type"]}}},primaryType:{type:"string"},domain:{type:"object"},message:{type:"object"}},required:["types","primaryType","domain","message"]},g={encodeData(a,b,c,f=!0){let g=["bytes32"],h=[this.hashType(a,c)];if(f){let i=(a,b,g)=>{if(void 0!==c[b])return["bytes32",null==g?"0x0000000000000000000000000000000000000000000000000000000000000000":d.keccak(this.encodeData(b,g,c,f))];if(void 0===g)throw Error(`missing value for field ${a} of type ${b}`);if("bytes"===b)return["bytes32",d.keccak(g)];if("string"===b)return"string"==typeof g&&(g=Buffer.from(g,"utf8")),["bytes32",d.keccak(g)];if(b.lastIndexOf("]")===b.length-1){let c=b.slice(0,b.lastIndexOf("[")),f=g.map(b=>i(a,c,b));return["bytes32",d.keccak(e.rawEncode(f.map(([a])=>a),f.map(([,a])=>a)))]}return[b,g]};for(let d of c[a]){let[a,c]=i(d.name,d.type,b[d.name]);g.push(a),h.push(c)}}else for(let e of c[a]){let a=b[e.name];if(void 0!==a)if("bytes"===e.type)g.push("bytes32"),a=d.keccak(a),h.push(a);else if("string"===e.type)g.push("bytes32"),"string"==typeof a&&(a=Buffer.from(a,"utf8")),a=d.keccak(a),h.push(a);else if(void 0!==c[e.type])g.push("bytes32"),a=d.keccak(this.encodeData(e.type,a,c,f)),h.push(a);else if(e.type.lastIndexOf("]")===e.type.length-1)throw Error("Arrays currently unimplemented in encodeData");else g.push(e.type),h.push(a)}return e.rawEncode(g,h)},encodeType(a,b){let c="",d=this.findTypeDependencies(a,b).filter(b=>b!==a);for(let e of d=[a].concat(d.sort())){if(!b[e])throw Error("No type definition specified: "+e);c+=e+"("+b[e].map(({name:a,type:b})=>b+" "+a).join(",")+")"}return c},findTypeDependencies(a,b,c=[]){if(a=a.match(/^\w*/)[0],c.includes(a)||void 0===b[a])return c;for(let d of(c.push(a),b[a]))for(let a of this.findTypeDependencies(d.type,b,c))c.includes(a)||c.push(a);return c},hashStruct(a,b,c,e=!0){return d.keccak(this.encodeData(a,b,c,e))},hashType(a,b){return d.keccak(this.encodeType(a,b))},sanitizeData(a){let b={};for(let c in f.properties)a[c]&&(b[c]=a[c]);return b.types&&(b.types=Object.assign({EIP712Domain:[]},b.types)),b},hash(a,b=!0){let c=this.sanitizeData(a),e=[Buffer.from("1901","hex")];return e.push(this.hashStruct("EIP712Domain",c.domain,c.types,b)),"EIP712Domain"!==c.primaryType&&e.push(this.hashStruct(c.primaryType,c.message,c.types,b)),d.keccak(Buffer.concat(e))}};b.exports={TYPED_MESSAGE_SCHEMA:f,TypedDataUtils:g,hashForSignTypedDataLegacy:function(a){return function(a){let b=Error("Expect argument to be non-empty array");if("object"!=typeof a||!a.length)throw b;let c=a.map(function(a){return"bytes"===a.type?d.toBuffer(a.value):a.value}),f=a.map(function(a){return a.type}),g=a.map(function(a){if(!a.name)throw b;return a.type+" "+a.name});return e.soliditySHA3(["bytes32","bytes32"],[e.soliditySHA3(Array(a.length).fill("string"),g),e.soliditySHA3(f,c)])}(a.data)},hashForSignTypedData_v3:function(a){return g.hash(a.data,!1)},hashForSignTypedData_v4:function(a){return g.hash(a.data)}}},769364,(a,b,c)=>{"use strict";var d=a.r(863327),e="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b},f=d.useSyncExternalStore,g=d.useRef,h=d.useEffect,i=d.useMemo,j=d.useDebugValue;c.useSyncExternalStoreWithSelector=function(a,b,c,d,k){var l=g(null);if(null===l.current){var m={hasValue:!1,value:null};l.current=m}else m=l.current;var n=f(a,(l=i(function(){function a(a){if(!h){if(h=!0,f=a,a=d(a),void 0!==k&&m.hasValue){var b=m.value;if(k(b,a))return g=b}return g=a}if(b=g,e(f,a))return b;var c=d(a);return void 0!==k&&k(b,c)?(f=a,b):(f=a,g=c)}var f,g,h=!1,i=void 0===c?null:c;return[function(){return a(b())},null===i?void 0:function(){return a(i())}]},[b,c,d,k]))[0],l[1]);return h(function(){m.hasValue=!0,m.value=n},[n]),j(n),n}},359707,(a,b,c)=>{"use strict";b.exports=a.r(769364)},613071,(a,b,c)=>{b.exports=a.x("pino-419b157df47e3e6c",()=>require("pino-419b157df47e3e6c"))},293326,894155,351199,725600,652294,446409,299407,90598,912937,490646,614248,938379,109700,952163,554819,202130,125966,13723,211298,959958,926697,393722,38571,483914,742415,782760,818403,978519,575064,309696,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;var R=a.i(748008),S=a.i(863327),T=a.i(840741),U=a.i(673593),V=a.i(620253),W=(a.i(191470),a.i(908046));a.i(760331);a.i(122500),a.i(178825),a.s([],437235),a.i(437235);var X=a.i(500874),Y=a.i(254799);let Z=(a,b)=>(0,Y.createHash)(a).update(b).digest(),$=new TextEncoder,_=new TextDecoder;function aa(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;return a.forEach(a=>{b.set(a,c),c+=a.length}),b}function ab(a,b){return aa($.encode(a),new Uint8Array([0]),b)}function ac(a,b,c){if(b<0||b>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${b}`);a.set([b>>>24,b>>>16,b>>>8,255&b],c)}function ad(a){let b=new Uint8Array(4);return ac(b,a),b}function ae(a){return aa(ad(a.length),a)}async function af(a,b,c){let d=Math.ceil((b>>3)/32),e=new Uint8Array(32*d);for(let b=0;b<d;b++){let d=new Uint8Array(4+a.length+c.length);d.set(ad(b+1)),d.set(a,4),d.set(c,4+a.length),e.set(await Z("sha256",d),32*b)}return e.slice(0,b>>3)}b=X.Buffer.isEncoding("base64url")?a=>X.Buffer.from(a).toString("base64url"):a=>X.Buffer.from(a).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");let ag=a=>{let b;return X.Buffer.from(((b=a)instanceof Uint8Array&&(b=_.decode(b)),b),"base64")};class ah extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(a){var b;super(a),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null==(b=Error.captureStackTrace)||b.call(Error,this,this.constructor)}}class ai extends ah{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(a,b="unspecified",c="unspecified"){super(a),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=b,this.reason=c}}class aj extends ah{static get code(){return"ERR_JWT_EXPIRED"}constructor(a,b="unspecified",c="unspecified"){super(a),this.code="ERR_JWT_EXPIRED",this.claim=b,this.reason=c}}class ak extends ah{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class al extends ah{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class am extends ah{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class an extends ah{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}}class ao extends ah{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class ap extends ah{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class aq extends ah{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class ar extends ah{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class as extends ah{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class at extends ah{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class au extends ah{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}class av extends ah{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class aw extends ah{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}a.s(["JOSEAlgNotAllowed",()=>ak,"JOSEError",()=>ah,"JOSENotSupported",()=>al,"JWEDecompressionFailed",()=>an,"JWEDecryptionFailed",()=>am,"JWEInvalid",()=>ao,"JWKInvalid",()=>ar,"JWKSInvalid",()=>as,"JWKSMultipleMatchingKeys",()=>au,"JWKSNoMatchingKey",()=>at,"JWKSTimeout",()=>av,"JWSInvalid",()=>ap,"JWSSignatureVerificationFailed",()=>aw,"JWTClaimValidationFailed",()=>ai,"JWTExpired",()=>aj,"JWTInvalid",()=>aq],952798);var ax=Y;function ay(a){switch(a){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new al(`Unsupported JWE Algorithm: ${a}`)}}let az=a=>(0,ax.randomFillSync)(new Uint8Array(ay(a)>>3)),aA=(a,b)=>{if(b.length<<3!==ay(a))throw new ao("Invalid Initialization Vector length")};var aB=a.i(224361);let aC=aB.types.isKeyObject?a=>aB.types.isKeyObject(a):a=>null!=a&&a instanceof Y.KeyObject,aD=(a,b)=>{let c;switch(a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":c=parseInt(a.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":c=parseInt(a.slice(1,4),10);break;default:throw new al(`Content Encryption Algorithm ${a} is not supported either by JOSE or your javascript runtime`)}if(b instanceof Uint8Array){let a=b.byteLength<<3;if(a!==c)throw new ao(`Invalid Content Encryption Key length. Expected ${c} bits, got ${a} bits`);return}if(aC(b)&&"secret"===b.type){let a=b.symmetricKeySize<<3;if(a!==c)throw new ao(`Invalid Content Encryption Key length. Expected ${c} bits, got ${a} bits`);return}throw TypeError("Invalid Content Encryption Key type")},aE=Y.timingSafeEqual;function aF(a,b,c,d,e,f){var g;let h,i,j=aa(a,b,c,(h=Math.floor((g=a.length<<3)/0x100000000),ac(i=new Uint8Array(8),h,0),ac(i,g%0x100000000,4),i)),k=(0,Y.createHmac)(`sha${d}`,e);return k.update(j),k.digest().slice(0,f>>3)}let aG=Y.webcrypto,aH=aB.types.isCryptoKey?a=>aB.types.isCryptoKey(a):a=>!1;function aI(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function aJ(a,b){return a.name===b}function aK(a){return parseInt(a.name.slice(4),10)}function aL(a,b){if(b.length&&!b.some(b=>a.usages.includes(b))){let a="CryptoKey does not support this operation, its usages must include ";if(b.length>2){let c=b.pop();a+=`one of ${b.join(", ")}, or ${c}.`}else 2===b.length?a+=`one of ${b[0]} or ${b[1]}.`:a+=`${b[0]}.`;throw TypeError(a)}}function aM(a,b,...c){switch(b){case"A128GCM":case"A192GCM":case"A256GCM":{if(!aJ(a.algorithm,"AES-GCM"))throw aI("AES-GCM");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw aI(c,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!aJ(a.algorithm,"AES-KW"))throw aI("AES-KW");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw aI(c,"algorithm.length");break}case"ECDH":switch(a.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw aI("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!aJ(a.algorithm,"PBKDF2"))throw aI("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!aJ(a.algorithm,"RSA-OAEP"))throw aI("RSA-OAEP");let c=parseInt(b.slice(9),10)||1;if(aK(a.algorithm.hash)!==c)throw aI(`SHA-${c}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}aL(a,c)}function aN(a,b,...c){if(c.length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor&&b.constructor.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let aO=(a,...b)=>aN("Key must be ",a,...b);function aP(a,b,...c){return aN(`Key for the ${a} algorithm must be `,b,...c)}let aQ=a=>(c||(c=new Set((0,Y.getCiphers)())),c.has(a)),aR=a=>aC(a)||aH(a),aS=["KeyObject"];(globalThis.CryptoKey||(null==aG?void 0:aG.CryptoKey))&&aS.push("CryptoKey");let aT=(a,b,c,d,e,f)=>{let g;if(aH(b))aM(b,a,"decrypt"),g=Y.KeyObject.from(b);else if(b instanceof Uint8Array||aC(b))g=b;else throw TypeError(aO(b,...aS,"Uint8Array"));switch(aD(a,g),aA(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(a,b,c,d,e,f){let g,h,i=parseInt(a.slice(1,4),10);aC(b)&&(b=b.export());let j=b.subarray(i>>3),k=b.subarray(0,i>>3),l=parseInt(a.slice(-3),10),m=`aes-${i}-cbc`;if(!aQ(m))throw new al(`alg ${a} is not supported by your javascript runtime`);let n=aF(f,d,c,l,k,i);try{g=aE(e,n)}catch{}if(!g)throw new am;try{let a=(0,Y.createDecipheriv)(m,j,d);h=aa(a.update(c),a.final())}catch{}if(!h)throw new am;return h}(a,g,c,d,e,f);case"A128GCM":case"A192GCM":case"A256GCM":var h=g;let i=parseInt(a.slice(1,4),10),j=`aes-${i}-gcm`;if(!aQ(j))throw new al(`alg ${a} is not supported by your javascript runtime`);try{let a=(0,Y.createDecipheriv)(j,h,d,{authTagLength:16});a.setAuthTag(e),f.byteLength&&a.setAAD(f,{plaintextLength:c.length});let b=a.update(c);return a.final(),b}catch{throw new am}default:throw new al("Unsupported JWE Content Encryption Algorithm")}};var aU=a.i(406461);let aV=(0,aB.promisify)(aU.inflateRaw),aW=(0,aB.promisify)(aU.deflateRaw),aX=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0};function aY(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}function aZ(a,b){if(a.symmetricKeySize<<3!==parseInt(b.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${b}`)}function a$(a,b,c){if(aC(a))return a;if(a instanceof Uint8Array)return(0,Y.createSecretKey)(a);if(aH(a))return aM(a,b,c),Y.KeyObject.from(a);throw TypeError(aO(a,...aS,"Uint8Array"))}let a_=(a,b,c)=>{let d=parseInt(a.slice(1,4),10),e=`aes${d}-wrap`;if(!aQ(e))throw new al(`alg ${a} is not supported either by JOSE or your javascript runtime`);let f=a$(b,a,"wrapKey");aZ(f,a);let g=(0,Y.createCipheriv)(e,f,X.Buffer.alloc(8,166));return aa(g.update(c),g.final())},a0=(a,b,c)=>{let d=parseInt(a.slice(1,4),10),e=`aes${d}-wrap`;if(!aQ(e))throw new al(`alg ${a} is not supported either by JOSE or your javascript runtime`);let f=a$(b,a,"unwrapKey");aZ(f,a);let g=(0,Y.createDecipheriv)(e,f,X.Buffer.alloc(8,166));return aa(g.update(c),g.final())},a1=X.Buffer.from([42,134,72,206,61,3,1,7]),a2=X.Buffer.from([43,129,4,0,34]),a3=X.Buffer.from([43,129,4,0,35]),a4=X.Buffer.from([43,129,4,0,10]),a5=new WeakMap,a6=(a,b)=>{var c;let d;if(aH(a))d=Y.KeyObject.from(a);else if(aC(a))d=a;else throw TypeError(aO(a,...aS));if("secret"===d.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(d.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${d.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${d.asymmetricKeyType.slice(1)}`;case"ec":{if(a5.has(d))return a5.get(d);let a=null==(c=d.asymmetricKeyDetails)?void 0:c.namedCurve;if(a||"private"!==d.type){if(!a){let b=d.export({format:"der",type:"spki"}),c=b[1]<128?14:15,e=b[c],f=b.slice(c+1,c+1+e);if(f.equals(a1))a="prime256v1";else if(f.equals(a2))a="secp384r1";else if(f.equals(a3))a="secp521r1";else if(f.equals(a4))a="secp256k1";else throw new al("Unsupported key curve for this operation")}}else a=a6((0,Y.createPublicKey)(d),!0);if(b)return a;let e=(a=>{switch(a){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new al("Unsupported key curve for this operation")}})(a);return a5.set(d,e),e}default:throw TypeError("Invalid asymmetric key type for this operation")}},a7=(0,aB.promisify)(Y.generateKeyPair);async function a8(a,b,c,d,e=new Uint8Array(0),f=new Uint8Array(0)){let g,h;if(aH(a))aM(a,"ECDH"),g=Y.KeyObject.from(a);else if(aC(a))g=a;else throw TypeError(aO(a,...aS));if(aH(b))aM(b,"ECDH","deriveBits"),h=Y.KeyObject.from(b);else if(aC(b))h=b;else throw TypeError(aO(b,...aS));let i=aa(ae($.encode(c)),ae(e),ae(f),ad(d));return af((0,Y.diffieHellman)({privateKey:h,publicKey:g}),d,i)}async function a9(a){let b;if(aH(a))b=Y.KeyObject.from(a);else if(aC(a))b=a;else throw TypeError(aO(a,...aS));switch(b.asymmetricKeyType){case"x25519":return a7("x25519");case"x448":return a7("x448");case"ec":return a7("ec",{namedCurve:a6(b)});default:throw new al("Invalid or unsupported EPK")}}let ba=a=>["P-256","P-384","P-521","X25519","X448"].includes(a6(a));var ax=Y;function bb(a){if(!(a instanceof Uint8Array)||a.length<8)throw new ao("PBES2 Salt Input must be 8 or more octets")}let bc=(0,aB.promisify)(Y.pbkdf2);function bd(a,b){if(aC(a))return a.export();if(a instanceof Uint8Array)return a;if(aH(a))return aM(a,b,"deriveBits","deriveKey"),Y.KeyObject.from(a).export();throw TypeError(aO(a,...aS,"Uint8Array"))}let be=async(a,c,d,e=2048,f=(0,ax.randomFillSync)(new Uint8Array(16)))=>{bb(f);let g=ab(a,f),h=parseInt(a.slice(13,16),10)>>3,i=bd(c,a),j=await bc(i,g,e,h,`sha${a.slice(8,11)}`);return{encryptedKey:await a_(a.slice(-6),j,d),p2c:e,p2s:b(f)}},bf=async(a,b,c,d,e)=>{bb(e);let f=ab(a,e),g=parseInt(a.slice(13,16),10)>>3,h=bd(b,a),i=await bc(h,f,d,g,`sha${a.slice(8,11)}`);return a0(a.slice(-6),i,c)},bg=new WeakMap,bh=(a,b)=>{let c=a.readUInt8(1);if((128&c)==0)return 0===b?c:bh(a.subarray(2+c),b-1);let d=127&c;c=0;for(let b=0;b<d;b++)c<<=8,c|=a.readUInt8(2+b);return 0===b?c:bh(a.subarray(2+c),b-1)},bi=(a,b)=>{bg.set(a,b)},bj=(a,b)=>{if(2048>(a=>{var b,c,d,e;let f;if(bg.has(a))return bg.get(a);let g=null!=(c=null==(b=a.asymmetricKeyDetails)?void 0:b.modulusLength)?c:(d=a.export({format:"der",type:"pkcs1"}),e=+("private"===a.type),((128&(f=d.readUInt8(1)))==0?bh(d.subarray(2),e):bh(d.subarray(2+(127&f)),e))-1<<3);return bg.set(a,g),g})(a))throw TypeError(`${b} requires key modulusLength to be 2048 bits or larger`)},bk=(a,b)=>{if("rsa"!==a.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");bj(a,b)},bl=a=>{switch(a){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return Y.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return Y.constants.RSA_PKCS1_PADDING;default:return}},bm=a=>{switch(a){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function bn(a,b,...c){if(aC(a))return a;if(aH(a))return aM(a,b,...c),Y.KeyObject.from(a);throw TypeError(aO(a,...aS))}var ax=Y;function bo(a){switch(a){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new al(`Unsupported JWE Algorithm: ${a}`)}}let bp=a=>(0,ax.randomFillSync)(new Uint8Array(bo(a)>>3)),bq=(a,b,c)=>{let d;if(aH(c)){if(!c.extractable)throw TypeError("CryptoKey is not extractable");d=Y.KeyObject.from(c)}else if(aC(c))d=c;else throw TypeError(aO(c,...aS));if(d.type!==a)throw TypeError(`key is not a ${a} key`);return d.export({format:"pem",type:b})},br=X.Buffer.from([0]),bs=X.Buffer.from([2]),bt=X.Buffer.from([3]),bu=X.Buffer.from([48]),bv=X.Buffer.from([4]),bw=a=>{if(a<128)return X.Buffer.from([a]);let b=X.Buffer.alloc(5);b.writeUInt32BE(a,1);let c=1;for(;0===b[c];)c++;return b[c-1]=128|5-c,b.slice(c-1)},bx=new Map([["P-256",X.Buffer.from("06 08 2A 86 48 CE 3D 03 01 07".replace(/ /g,""),"hex")],["secp256k1",X.Buffer.from("06 05 2B 81 04 00 0A".replace(/ /g,""),"hex")],["P-384",X.Buffer.from("06 05 2B 81 04 00 22".replace(/ /g,""),"hex")],["P-521",X.Buffer.from("06 05 2B 81 04 00 23".replace(/ /g,""),"hex")],["ecPublicKey",X.Buffer.from("06 07 2A 86 48 CE 3D 02 01".replace(/ /g,""),"hex")],["X25519",X.Buffer.from("06 03 2B 65 6E".replace(/ /g,""),"hex")],["X448",X.Buffer.from("06 03 2B 65 6F".replace(/ /g,""),"hex")],["Ed25519",X.Buffer.from("06 03 2B 65 70".replace(/ /g,""),"hex")],["Ed448",X.Buffer.from("06 03 2B 65 71".replace(/ /g,""),"hex")]]);class by{constructor(){this.length=0,this.elements=[]}oidFor(a){let b=bx.get(a);if(!b)throw new al("Invalid or unsupported OID");this.elements.push(b),this.length+=b.length}zero(){this.elements.push(bs,X.Buffer.from([1]),br),this.length+=3}one(){this.elements.push(bs,X.Buffer.from([1]),X.Buffer.from([1])),this.length+=3}unsignedInteger(a){if(128&a[0]){let b=bw(a.length+1);this.elements.push(bs,b,br,a),this.length+=2+b.length+a.length}else{let b=0;for(;0===a[b]&&(128&a[b+1])==0;)b++;let c=bw(a.length-b);this.elements.push(bs,bw(a.length-b),a.slice(b)),this.length+=1+c.length+a.length-b}}octStr(a){let b=bw(a.length);this.elements.push(bv,bw(a.length),a),this.length+=1+b.length+a.length}bitStr(a){let b=bw(a.length+1);this.elements.push(bt,bw(a.length+1),br,a),this.length+=1+b.length+a.length+1}add(a){this.elements.push(a),this.length+=a.length}end(a=bu){let b=bw(this.length);return X.Buffer.concat([a,b,...this.elements],1+b.length+this.length)}}let[bz,bA]=process.versions.node.split(".").map(a=>parseInt(a,10)),bB=!("electron"in process.versions)&&(bz>=17||16===bz&&bA>=9),bC=bz>=16||15===bz&&bA>=9,bD=bz>=16||15===bz&&bA>=12,bE=a=>{if(bD&&"oct"!==a.kty)return a.d?(0,Y.createPrivateKey)({format:"jwk",key:a}):(0,Y.createPublicKey)({format:"jwk",key:a});switch(a.kty){case"oct":return(0,Y.createSecretKey)(ag(a.k));case"RSA":{let b=new by,c=void 0!==a.d,d=X.Buffer.from(a.n,"base64"),e=X.Buffer.from(a.e,"base64");c?(b.zero(),b.unsignedInteger(d),b.unsignedInteger(e),b.unsignedInteger(X.Buffer.from(a.d,"base64")),b.unsignedInteger(X.Buffer.from(a.p,"base64")),b.unsignedInteger(X.Buffer.from(a.q,"base64")),b.unsignedInteger(X.Buffer.from(a.dp,"base64")),b.unsignedInteger(X.Buffer.from(a.dq,"base64")),b.unsignedInteger(X.Buffer.from(a.qi,"base64"))):(b.unsignedInteger(d),b.unsignedInteger(e));let f={key:b.end(),format:"der",type:"pkcs1"},g=c?(0,Y.createPrivateKey)(f):(0,Y.createPublicKey)(f);return bi(g,d.length<<3),g}case"EC":{var b,c;let d=new by,e=void 0!==a.d,f=X.Buffer.concat([X.Buffer.alloc(1,4),X.Buffer.from(a.x,"base64"),X.Buffer.from(a.y,"base64")]);if(e){d.zero();let c=new by;c.oidFor("ecPublicKey"),c.oidFor(a.crv),d.add(c.end());let e=new by;e.one(),e.octStr(X.Buffer.from(a.d,"base64"));let g=new by;g.bitStr(f);let h=g.end(X.Buffer.from([161]));e.add(h);let i=e.end(),j=new by;j.add(i);let k=j.end(X.Buffer.from([4]));d.add(k);let l=d.end(),m=(0,Y.createPrivateKey)({key:l,format:"der",type:"pkcs8"});return b=a.crv,a5.set(m,b),m}let g=new by;g.oidFor("ecPublicKey"),g.oidFor(a.crv),d.add(g.end()),d.bitStr(f);let h=d.end(),i=(0,Y.createPublicKey)({key:h,format:"der",type:"spki"});return c=a.crv,a5.set(i,c),i}case"OKP":{let b=new by;if(void 0!==a.d){b.zero();let c=new by;c.oidFor(a.crv),b.add(c.end());let d=new by;d.octStr(X.Buffer.from(a.d,"base64"));let e=d.end(X.Buffer.from([4]));b.add(e);let f=b.end();return(0,Y.createPrivateKey)({key:f,format:"der",type:"pkcs8"})}let c=new by;c.oidFor(a.crv),b.add(c.end()),b.bitStr(X.Buffer.from(a.x,"base64"));let d=b.end();return(0,Y.createPublicKey)({key:d,format:"der",type:"spki"})}default:throw new al('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}};async function bF(a,b,c){if("string"!=typeof a||0!==a.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return(0,Y.createPublicKey)({key:X.Buffer.from(a.replace(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,""),"base64"),type:"spki",format:"der"})}async function bG(a,b,c){if("string"!=typeof a||0!==a.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');return(0,Y.createPublicKey)({key:a,type:"spki",format:"pem"})}async function bH(a,b,c){if("string"!=typeof a||0!==a.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return(0,Y.createPrivateKey)({key:X.Buffer.from(a.replace(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,""),"base64"),type:"pkcs8",format:"der"})}async function bI(a,b,c){var d;if(!aY(a))throw TypeError("JWK must be an object");switch(b||(b=a.alg),a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=c||(c=!0!==a.ext),c)return bE({...a,alg:b,ext:null!=(d=a.ext)&&d});return ag(a.k);case"RSA":if(void 0!==a.oth)throw new al('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return bE({...a,alg:b});default:throw new al('Unsupported "kty" (Key Type) Parameter value')}}let bJ=(a,b,c)=>{if(a.startsWith("HS")||"dir"===a||a.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(a)){if(!(b instanceof Uint8Array)){if(!aR(b))throw TypeError(aP(a,b,...aS,"Uint8Array"));if("secret"!==b.type)throw TypeError(`${aS.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}}else{if(!aR(b))throw TypeError(aP(a,b,...aS));if("secret"===b.type)throw TypeError(`${aS.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===c&&"public"===b.type)throw TypeError(`${aS.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===c&&"public"===b.type)throw TypeError(`${aS.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(b.algorithm&&"verify"===c&&"private"===b.type)throw TypeError(`${aS.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(b.algorithm&&"encrypt"===c&&"private"===b.type)throw TypeError(`${aS.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)}},bK=(a,b,c,d,e)=>{let f;if(aH(c))aM(c,a,"encrypt"),f=Y.KeyObject.from(c);else if(c instanceof Uint8Array||aC(c))f=c;else throw TypeError(aO(c,...aS,"Uint8Array"));switch(aD(a,f),aA(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(a,b,c,d,e){let f=parseInt(a.slice(1,4),10);aC(c)&&(c=c.export());let g=c.subarray(f>>3),h=c.subarray(0,f>>3),i=`aes-${f}-cbc`;if(!aQ(i))throw new al(`alg ${a} is not supported by your javascript runtime`);let j=(0,Y.createCipheriv)(i,g,d),k=aa(j.update(b),j.final()),l=aF(e,d,k,parseInt(a.slice(-3),10),h,f);return{ciphertext:k,tag:l}}(a,b,f,d,e);case"A128GCM":case"A192GCM":case"A256GCM":var g=f;let h=parseInt(a.slice(1,4),10),i=`aes-${h}-gcm`;if(!aQ(i))throw new al(`alg ${a} is not supported by your javascript runtime`);let j=(0,Y.createCipheriv)(i,g,d,{authTagLength:16});e.byteLength&&j.setAAD(e,{plaintextLength:b.length});let k=j.update(b);return j.final(),{ciphertext:k,tag:j.getAuthTag()};default:throw new al("Unsupported JWE Content Encryption Algorithm")}};async function bL(a,c,d,e){let f=a.slice(0,7);e||(e=az(f));let{ciphertext:g,tag:h}=await bK(f,d,c,e,new Uint8Array(0));return{encryptedKey:g,iv:b(e),tag:b(h)}}async function bM(a,b,c,d,e){return aT(a.slice(0,7),b,c,d,e,new Uint8Array(0))}async function bN(a,b,c,d,e){switch(bJ(a,b,"decrypt"),a){case"dir":if(void 0!==c)throw new ao("Encountered unexpected JWE Encrypted Key");return b;case"ECDH-ES":if(void 0!==c)throw new ao("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e,f;if(!aY(d.epk))throw new ao('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ba(b))throw new al("ECDH with the provided key is not allowed or not supported by your javascript runtime");let g=await bI(d.epk,a);if(void 0!==d.apu){if("string"!=typeof d.apu)throw new ao('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{e=ag(d.apu)}catch{throw new ao("Failed to base64url decode the apu")}}if(void 0!==d.apv){if("string"!=typeof d.apv)throw new ao('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{f=ag(d.apv)}catch{throw new ao("Failed to base64url decode the apv")}}let h=await a8(g,b,"ECDH-ES"===a?d.enc:a,"ECDH-ES"===a?bo(d.enc):parseInt(a.slice(-5,-2),10),e,f);if("ECDH-ES"===a)return h;if(void 0===c)throw new ao("JWE Encrypted Key missing");return a0(a.slice(-6),h,c)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":let f,g,h;if(void 0===c)throw new ao("JWE Encrypted Key missing");return f=bl(a),g=bm(a),bk(h=bn(b,a,"unwrapKey","decrypt"),a),(0,Y.privateDecrypt)({key:h,oaepHash:g,padding:f},c);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let f;if(void 0===c)throw new ao("JWE Encrypted Key missing");if("number"!=typeof d.p2c)throw new ao('JOSE Header "p2c" (PBES2 Count) missing or invalid');let g=(null==e?void 0:e.maxPBES2Count)||1e4;if(d.p2c>g)throw new ao('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof d.p2s)throw new ao('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=ag(d.p2s)}catch{throw new ao("Failed to base64url decode the p2s")}return bf(a,b,c,d.p2c,f)}case"A128KW":case"A192KW":case"A256KW":if(void 0===c)throw new ao("JWE Encrypted Key missing");return a0(a,b,c);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let e,f;if(void 0===c)throw new ao("JWE Encrypted Key missing");if("string"!=typeof d.iv)throw new ao('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof d.tag)throw new ao('JOSE Header "tag" (Authentication Tag) missing or invalid');try{e=ag(d.iv)}catch{throw new ao("Failed to base64url decode the iv")}try{f=ag(d.tag)}catch{throw new ao("Failed to base64url decode the tag")}return bM(a,b,c,e,f)}default:throw new al('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let bO=function(a,b,c,d,e){let f;if(void 0!==e.crit&&void 0===d.crit)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new al(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)},bP=(a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)};async function bQ(a,b,c){var d;let e,f,g,h,i,j,k;if(!aY(a))throw new ao("Flattened JWE must be an object");if(void 0===a.protected&&void 0===a.header&&void 0===a.unprotected)throw new ao("JOSE Header missing");if("string"!=typeof a.iv)throw new ao("JWE Initialization Vector missing or incorrect type");if("string"!=typeof a.ciphertext)throw new ao("JWE Ciphertext missing or incorrect type");if("string"!=typeof a.tag)throw new ao("JWE Authentication Tag missing or incorrect type");if(void 0!==a.protected&&"string"!=typeof a.protected)throw new ao("JWE Protected Header incorrect type");if(void 0!==a.encrypted_key&&"string"!=typeof a.encrypted_key)throw new ao("JWE Encrypted Key incorrect type");if(void 0!==a.aad&&"string"!=typeof a.aad)throw new ao("JWE AAD incorrect type");if(void 0!==a.header&&!aY(a.header))throw new ao("JWE Shared Unprotected Header incorrect type");if(void 0!==a.unprotected&&!aY(a.unprotected))throw new ao("JWE Per-Recipient Unprotected Header incorrect type");if(a.protected)try{let b=ag(a.protected);e=JSON.parse(_.decode(b))}catch{throw new ao("JWE Protected Header is invalid")}if(!aX(e,a.header,a.unprotected))throw new ao("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let l={...e,...a.header,...a.unprotected};if(bO(ao,new Map,null==c?void 0:c.crit,e,l),void 0!==l.zip){if(!e||!e.zip)throw new ao('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==l.zip)throw new al('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:m,enc:n}=l;if("string"!=typeof m||!m)throw new ao("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof n||!n)throw new ao("missing JWE Encryption Algorithm (enc) in JWE Header");let o=c&&bP("keyManagementAlgorithms",c.keyManagementAlgorithms),p=c&&bP("contentEncryptionAlgorithms",c.contentEncryptionAlgorithms);if(o&&!o.has(m))throw new ak('"alg" (Algorithm) Header Parameter not allowed');if(p&&!p.has(n))throw new ak('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==a.encrypted_key)try{f=ag(a.encrypted_key)}catch{throw new ao("Failed to base64url decode the encrypted_key")}let q=!1;"function"==typeof b&&(b=await b(e,a),q=!0);try{g=await bN(m,b,f,l,c)}catch(a){if(a instanceof TypeError||a instanceof ao||a instanceof al)throw a;g=bp(n)}try{h=ag(a.iv)}catch{throw new ao("Failed to base64url decode the iv")}try{i=ag(a.tag)}catch{throw new ao("Failed to base64url decode the tag")}let r=$.encode(null!=(d=a.protected)?d:"");j=void 0!==a.aad?aa(r,$.encode("."),$.encode(a.aad)):r;try{k=ag(a.ciphertext)}catch{throw new ao("Failed to base64url decode the ciphertext")}let s=await aT(n,g,k,h,i,j);"DEF"===l.zip&&(s=await ((null==c?void 0:c.inflateRaw)||(a=>aV(a,{maxOutputLength:25e4}).catch(()=>{throw new an})))(s));let t={plaintext:s};if(void 0!==a.protected&&(t.protectedHeader=e),void 0!==a.aad)try{t.additionalAuthenticatedData=ag(a.aad)}catch{throw new ao("Failed to base64url decode the aad")}return(void 0!==a.unprotected&&(t.sharedUnprotectedHeader=a.unprotected),void 0!==a.header&&(t.unprotectedHeader=a.header),q)?{...t,key:b}:t}async function bR(a,b,c){if(a instanceof Uint8Array&&(a=_.decode(a)),"string"!=typeof a)throw new ao("Compact JWE must be a string or Uint8Array");let{0:d,1:e,2:f,3:g,4:h,length:i}=a.split(".");if(5!==i)throw new ao("Invalid Compact JWE");let j=await bQ({ciphertext:g,iv:f||void 0,protected:d||void 0,tag:h||void 0,encrypted_key:e||void 0},b,c),k={plaintext:j.plaintext,protectedHeader:j.protectedHeader};return"function"==typeof b?{...k,key:j.key}:k}async function bS(a,b,c){if(!aY(a))throw new ao("General JWE must be an object");if(!Array.isArray(a.recipients)||!a.recipients.every(aY))throw new ao("JWE Recipients missing or incorrect type");if(!a.recipients.length)throw new ao("JWE Recipients has no members");for(let d of a.recipients)try{return await bQ({aad:a.aad,ciphertext:a.ciphertext,encrypted_key:d.encrypted_key,header:d.header,iv:a.iv,protected:a.protected,tag:a.tag,unprotected:a.unprotected},b,c)}catch{}throw new am}class bT{constructor(a){if(48!==a[0]||(this.buffer=a,this.offset=1,this.decodeLength()!==a.length-this.offset))throw TypeError()}decodeLength(){let a=this.buffer[this.offset++];if(128&a){let b=-129&a;a=0;for(let c=0;c<b;c++)a=a<<8|this.buffer[this.offset+c];this.offset+=b}return a}unsignedInteger(){if(2!==this.buffer[this.offset++])throw TypeError();let a=this.decodeLength();0===this.buffer[this.offset]&&(this.offset++,a--);let b=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a,b}end(){if(this.offset!==this.buffer.length)throw TypeError()}}let bU=a=>{let c;if(aH(a)){if(!a.extractable)throw TypeError("CryptoKey is not extractable");c=Y.KeyObject.from(a)}else if(aC(a))c=a;else if(a instanceof Uint8Array)return{kty:"oct",k:b(a)};else throw TypeError(aO(a,...aS,"Uint8Array"));if(bC){if("secret"!==c.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(c.asymmetricKeyType))throw new al("Unsupported key asymmetricKeyType");return c.export({format:"jwk"})}switch(c.type){case"secret":return{kty:"oct",k:b(c.export())};case"private":case"public":switch(c.asymmetricKeyType){case"rsa":{let a,d=new bT(c.export({format:"der",type:"pkcs1"}));"private"===c.type&&d.unsignedInteger();let e=b(d.unsignedInteger()),f=b(d.unsignedInteger());return"private"===c.type&&(a={d:b(d.unsignedInteger()),p:b(d.unsignedInteger()),q:b(d.unsignedInteger()),dp:b(d.unsignedInteger()),dq:b(d.unsignedInteger()),qi:b(d.unsignedInteger())}),d.end(),{kty:"RSA",n:e,e:f,...a}}case"ec":{let a,d,e,f=a6(c);switch(f){case"secp256k1":a=64,d=33,e=-1;break;case"P-256":a=64,d=36,e=-1;break;case"P-384":a=96,d=35,e=-3;break;case"P-521":a=132,d=35,e=-3;break;default:throw new al("Unsupported curve")}if("public"===c.type){let d=c.export({type:"spki",format:"der"});return{kty:"EC",crv:f,x:b(d.subarray(-a,-a/2)),y:b(d.subarray(-a/2))}}let g=c.export({type:"pkcs8",format:"der"});return g.length<100&&(d+=e),{...bU((0,Y.createPublicKey)(c)),d:b(g.subarray(d,d+a/2))}}case"ed25519":case"x25519":{let a=a6(c);if("public"===c.type)return{kty:"OKP",crv:a,x:b(c.export({type:"spki",format:"der"}).subarray(-32))};let d=c.export({type:"pkcs8",format:"der"});return{...bU((0,Y.createPublicKey)(c)),d:b(d.subarray(-32))}}case"ed448":case"x448":{let a=a6(c);if("public"===c.type)return{kty:"OKP",crv:a,x:b(c.export({type:"spki",format:"der"}).subarray("Ed448"===a?-57:-56))};let d=c.export({type:"pkcs8",format:"der"});return{...bU((0,Y.createPublicKey)(c)),d:b(d.subarray("Ed448"===a?-57:-56))}}default:throw new al("Unsupported key asymmetricKeyType")}default:throw new al("Unsupported key type")}};async function bV(a){return bq("public","spki",a)}async function bW(a){return bq("private","pkcs8",a)}async function bX(a){return bU(a)}async function bY(a,c,d,e,f={}){let g,h,i;switch(bJ(a,d,"encrypt"),a){case"dir":i=d;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ba(d))throw new al("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:j,apv:k}=f,{epk:l}=f;l||(l=(await a9(d)).privateKey);let{x:m,y:n,crv:o,kty:p}=await bX(l),q=await a8(d,l,"ECDH-ES"===a?c:a,"ECDH-ES"===a?bo(c):parseInt(a.slice(-5,-2),10),j,k);if(h={epk:{x:m,crv:o,kty:p}},"EC"===p&&(h.epk.y=n),j&&(h.apu=b(j)),k&&(h.apv=b(k)),"ECDH-ES"===a){i=q;break}i=e||bp(c);let r=a.slice(-6);g=await a_(r,q,i);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":var j;let k,l,m;i=e||bp(c),g=await (j=i,k=bl(a),l=bm(a),bk(m=bn(d,a,"wrapKey","encrypt"),a),(0,Y.publicEncrypt)({key:m,oaepHash:l,padding:k},j));break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{i=e||bp(c);let{p2c:b,p2s:j}=f;({encryptedKey:g,...h}=await be(a,d,i,b,j));break}case"A128KW":case"A192KW":case"A256KW":i=e||bp(c),g=await a_(a,d,i);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{i=e||bp(c);let{iv:b}=f;({encryptedKey:g,...h}=await bL(a,d,i,b));break}default:throw new al('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:i,encryptedKey:g,parameters:h}}let bZ=Symbol();class b${constructor(a){if(!(a instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=a}setKeyManagementParameters(a){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=a,this}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setSharedUnprotectedHeader(a){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}setAdditionalAuthenticatedData(a){return this._aad=a,this}setContentEncryptionKey(a){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=a,this}setInitializationVector(a){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=a,this}async encrypt(a,c){let d,e,f,g,h,i,j;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new ao("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!aX(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new ao("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let k={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(bO(ao,new Map,null==c?void 0:c.crit,this._protectedHeader,k),void 0!==k.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new ao('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==k.zip)throw new al('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:l,enc:m}=k;if("string"!=typeof l||!l)throw new ao('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof m||!m)throw new ao('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===l){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===l&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let b;({cek:e,encryptedKey:d,parameters:b}=await bY(l,m,a,this._cek,this._keyManagementParameters)),b&&(c&&bZ in c?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...b}:this.setUnprotectedHeader(b):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...b}:this.setProtectedHeader(b))}if(this._iv||(this._iv=az(m)),g=this._protectedHeader?$.encode(b(JSON.stringify(this._protectedHeader))):$.encode(""),this._aad?(h=b(this._aad),f=aa(g,$.encode("."),$.encode(h))):f=g,"DEF"===k.zip){let a=await ((null==c?void 0:c.deflateRaw)||(a=>aW(a)))(this._plaintext);({ciphertext:i,tag:j}=await bK(m,a,e,this._iv,f))}else({ciphertext:i,tag:j}=await bK(m,this._plaintext,e,this._iv,f));let n={ciphertext:b(i),iv:b(this._iv),tag:b(j)};return d&&(n.encrypted_key=b(d)),h&&(n.aad=h),this._protectedHeader&&(n.protected=_.decode(g)),this._sharedUnprotectedHeader&&(n.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(n.header=this._unprotectedHeader),n}}class b_{constructor(a,b,c){this.parent=a,this.key=b,this.options=c}setUnprotectedHeader(a){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=a,this}addRecipient(...a){return this.parent.addRecipient(...a)}encrypt(...a){return this.parent.encrypt(...a)}done(){return this.parent}}class b0{constructor(a){this._recipients=[],this._plaintext=a}addRecipient(a,b){let c=new b_(this,a,{crit:null==b?void 0:b.crit});return this._recipients.push(c),c}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setSharedUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}setAdditionalAuthenticatedData(a){return this._aad=a,this}async encrypt(a){var c,d,e;let f;if(!this._recipients.length)throw new ao("at least one recipient must be added");if(a={deflateRaw:null==a?void 0:a.deflateRaw},1===this._recipients.length){let[b]=this._recipients,c=await new b$(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(b.unprotectedHeader).encrypt(b.key,{...b.options,...a}),d={ciphertext:c.ciphertext,iv:c.iv,recipients:[{}],tag:c.tag};return c.aad&&(d.aad=c.aad),c.protected&&(d.protected=c.protected),c.unprotected&&(d.unprotected=c.unprotected),c.encrypted_key&&(d.recipients[0].encrypted_key=c.encrypted_key),c.header&&(d.recipients[0].header=c.header),d}for(let a=0;a<this._recipients.length;a++){let b=this._recipients[a];if(!aX(this._protectedHeader,this._unprotectedHeader,b.unprotectedHeader))throw new ao("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader,...b.unprotectedHeader},{alg:d}=c;if("string"!=typeof d||!d)throw new ao('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===d||"ECDH-ES"===d)throw new ao('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof c.enc||!c.enc)throw new ao('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(f){if(f!==c.enc)throw new ao('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else f=c.enc;if(bO(ao,new Map,b.options.crit,this._protectedHeader,c),void 0!==c.zip&&(!this._protectedHeader||!this._protectedHeader.zip))throw new ao('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let g=bp(f),h={ciphertext:"",iv:"",recipients:[],tag:""};for(let i=0;i<this._recipients.length;i++){let j=this._recipients[i],k={};h.recipients.push(k);let l=({...this._protectedHeader,...this._unprotectedHeader,...j.unprotectedHeader}).alg.startsWith("PBES2")?2048+i:void 0;if(0===i){let b=await new b$(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(g).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(j.unprotectedHeader).setKeyManagementParameters({p2c:l}).encrypt(j.key,{...j.options,...a,[bZ]:!0});h.ciphertext=b.ciphertext,h.iv=b.iv,h.tag=b.tag,b.aad&&(h.aad=b.aad),b.protected&&(h.protected=b.protected),b.unprotected&&(h.unprotected=b.unprotected),k.encrypted_key=b.encrypted_key,b.header&&(k.header=b.header);continue}let{encryptedKey:m,parameters:n}=await bY((null==(c=j.unprotectedHeader)?void 0:c.alg)||(null==(d=this._protectedHeader)?void 0:d.alg)||(null==(e=this._unprotectedHeader)?void 0:e.alg),f,j.key,g,{p2c:l});k.encrypted_key=b(m),(j.unprotectedHeader||n)&&(k.header={...j.unprotectedHeader,...n})}return h}}function b1(a){switch(a){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"EdDSA":return;default:throw new al(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}let b2={padding:Y.constants.RSA_PKCS1_PSS_PADDING,saltLength:Y.constants.RSA_PSS_SALTLEN_DIGEST},b3=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function b4(a,b){switch(a){case"EdDSA":if(!["ed25519","ed448"].includes(b.asymmetricKeyType))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");return b;case"RS256":case"RS384":case"RS512":if("rsa"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");return bj(b,a),b;case bB&&"PS256":case bB&&"PS384":case bB&&"PS512":if("rsa-pss"===b.asymmetricKeyType){let{hashAlgorithm:c,mgf1HashAlgorithm:d,saltLength:e}=b.asymmetricKeyDetails,f=parseInt(a.slice(-3),10);if(void 0!==c&&(c!==`sha${f}`||d!==c))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${a}`);if(void 0!==e&&e>f>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${a}`)}else if("rsa"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");return bj(b,a),{key:b,...b2};case!bB&&"PS256":case!bB&&"PS384":case!bB&&"PS512":if("rsa"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");return bj(b,a),{key:b,...b2};case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==b.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let c=a6(b),d=b3.get(a);if(c!==d)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${d}, got ${c}`);return{dsaEncoding:"ieee-p1363",key:b}}default:throw new al(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}function b5(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(aO(b,...aS));return(0,Y.createSecretKey)(b)}if(b instanceof Y.KeyObject)return b;if(aH(b))return!function(a,b,...c){switch(b){case"HS256":case"HS384":case"HS512":{if(!aJ(a.algorithm,"HMAC"))throw aI("HMAC");let c=parseInt(b.slice(2),10);if(aK(a.algorithm.hash)!==c)throw aI(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!aJ(a.algorithm,"RSASSA-PKCS1-v1_5"))throw aI("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(aK(a.algorithm.hash)!==c)throw aI(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!aJ(a.algorithm,"RSA-PSS"))throw aI("RSA-PSS");let c=parseInt(b.slice(2),10);if(aK(a.algorithm.hash)!==c)throw aI(`SHA-${c}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==a.algorithm.name&&"Ed448"!==a.algorithm.name)throw aI("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!aJ(a.algorithm,"ECDSA"))throw aI("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw aI(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}aL(a,c)}(b,a,c),Y.KeyObject.from(b);throw TypeError(aO(b,...aS,"Uint8Array"))}d=Y.sign.length>3?(0,aB.promisify)(Y.sign):Y.sign;let b6=async(a,b,c)=>{let e=b5(a,b,"sign");if(a.startsWith("HS")){let b=Y.createHmac(function(a){switch(a){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new al(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}(a),e);return b.update(c),b.digest()}return d(b1(a),c,b4(a,e))};e=Y.verify.length>4&&(bz>=16||15===bz&&bA>=13)?(0,aB.promisify)(Y.verify):Y.verify;let b7=async(a,b,c,d)=>{let f=b5(a,b,"verify");if(a.startsWith("HS")){let b=await b6(a,f,d);try{return Y.timingSafeEqual(c,b)}catch{return!1}}let g=b1(a),h=b4(a,f);try{return await e(g,d,h,c)}catch{return!1}};async function b8(a,b,c){var d;let e,f;if(!aY(a))throw new ap("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new ap('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new ap("JWS Protected Header incorrect type");if(void 0===a.payload)throw new ap("JWS Payload missing");if("string"!=typeof a.signature)throw new ap("JWS Signature missing or incorrect type");if(void 0!==a.header&&!aY(a.header))throw new ap("JWS Unprotected Header incorrect type");let g={};if(a.protected)try{let b=ag(a.protected);g=JSON.parse(_.decode(b))}catch{throw new ap("JWS Protected Header is invalid")}if(!aX(g,a.header))throw new ap("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let h={...g,...a.header},i=bO(ap,new Map([["b64",!0]]),null==c?void 0:c.crit,g,h),j=!0;if(i.has("b64")&&"boolean"!=typeof(j=g.b64))throw new ap('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:k}=h;if("string"!=typeof k||!k)throw new ap('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=c&&bP("algorithms",c.algorithms);if(l&&!l.has(k))throw new ak('"alg" (Algorithm) Header Parameter not allowed');if(j){if("string"!=typeof a.payload)throw new ap("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new ap("JWS Payload must be a string or an Uint8Array instance");let m=!1;"function"==typeof b&&(b=await b(g,a),m=!0),bJ(k,b,"verify");let n=aa($.encode(null!=(d=a.protected)?d:""),$.encode("."),"string"==typeof a.payload?$.encode(a.payload):a.payload);try{e=ag(a.signature)}catch{throw new ap("Failed to base64url decode the signature")}if(!await b7(k,b,e,n))throw new aw;if(j)try{f=ag(a.payload)}catch{throw new ap("Failed to base64url decode the payload")}else f="string"==typeof a.payload?$.encode(a.payload):a.payload;let o={payload:f};return(void 0!==a.protected&&(o.protectedHeader=g),void 0!==a.header&&(o.unprotectedHeader=a.header),m)?{...o,key:b}:o}async function b9(a,b,c){if(a instanceof Uint8Array&&(a=_.decode(a)),"string"!=typeof a)throw new ap("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new ap("Invalid Compact JWS");let h=await b8({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}async function ca(a,b,c){if(!aY(a))throw new ap("General JWS must be an object");if(!Array.isArray(a.signatures)||!a.signatures.every(aY))throw new ap("JWS Signatures missing or incorrect type");for(let d of a.signatures)try{return await b8({header:d.header,payload:a.payload,protected:d.protected,signature:d.signature},b,c)}catch{}throw new aw}let cb=a=>Math.floor(a.getTime()/1e3),cc=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,cd=a=>{let b=cc.exec(a);if(!b)throw TypeError("Invalid time period format");let c=parseFloat(b[1]);switch(b[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(c);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*c);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*c);case"day":case"days":case"d":return Math.round(86400*c);case"week":case"weeks":case"w":return Math.round(604800*c);default:return Math.round(0x1e187e0*c)}},ce=a=>a.toLowerCase().replace(/^application\//,""),cf=(a,b,c={})=>{var d,e;let f,g,{typ:h}=c;if(h&&("string"!=typeof a.typ||ce(a.typ)!==ce(h)))throw new ai('unexpected "typ" JWT header value',"typ","check_failed");try{f=JSON.parse(_.decode(b))}catch{}if(!aY(f))throw new aq("JWT Claims Set must be a top-level JSON object");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c;for(let a of(void 0!==m&&i.push("iat"),void 0!==l&&i.push("aud"),void 0!==k&&i.push("sub"),void 0!==j&&i.push("iss"),new Set(i.reverse())))if(!(a in f))throw new ai(`missing required "${a}" claim`,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(f.iss))throw new ai('unexpected "iss" claim value',"iss","check_failed");if(k&&f.sub!==k)throw new ai('unexpected "sub" claim value',"sub","check_failed");if(l&&(d=f.aud,e="string"==typeof l?[l]:l,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new ai('unexpected "aud" claim value',"aud","check_failed");switch(typeof c.clockTolerance){case"string":g=cd(c.clockTolerance);break;case"number":g=c.clockTolerance;break;case"undefined":g=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:n}=c,o=cb(n||new Date);if((void 0!==f.iat||m)&&"number"!=typeof f.iat)throw new ai('"iat" claim must be a number',"iat","invalid");if(void 0!==f.nbf){if("number"!=typeof f.nbf)throw new ai('"nbf" claim must be a number',"nbf","invalid");if(f.nbf>o+g)throw new ai('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==f.exp){if("number"!=typeof f.exp)throw new ai('"exp" claim must be a number',"exp","invalid");if(f.exp<=o-g)throw new aj('"exp" claim timestamp check failed',"exp","check_failed")}if(m){let a=o-f.iat;if(a-g>("number"==typeof m?m:cd(m)))throw new aj('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(a<0-g)throw new ai('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return f};async function cg(a,b,c){var d;let e=await b9(a,b,c);if((null==(d=e.protectedHeader.crit)?void 0:d.includes("b64"))&&!1===e.protectedHeader.b64)throw new aq("JWTs MUST NOT use unencoded payload");let f={payload:cf(e.protectedHeader,e.payload,c),protectedHeader:e.protectedHeader};return"function"==typeof b?{...f,key:e.key}:f}async function ch(a,b,c){let d=await bR(a,b,c),e=cf(d.protectedHeader,d.plaintext,c),{protectedHeader:f}=d;if(void 0!==f.iss&&f.iss!==e.iss)throw new ai('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==f.sub&&f.sub!==e.sub)throw new ai('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==f.aud&&JSON.stringify(f.aud)!==JSON.stringify(e.aud))throw new ai('replicated "aud" claim header parameter mismatch',"aud","mismatch");let g={payload:e,protectedHeader:f};return"function"==typeof b?{...g,key:d.key}:g}class ci{constructor(a){this._flattened=new b$(a)}setContentEncryptionKey(a){return this._flattened.setContentEncryptionKey(a),this}setInitializationVector(a){return this._flattened.setInitializationVector(a),this}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}setKeyManagementParameters(a){return this._flattened.setKeyManagementParameters(a),this}async encrypt(a,b){let c=await this._flattened.encrypt(a,b);return[c.protected,c.encrypted_key,c.iv,c.ciphertext,c.tag].join(".")}}class cj{constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=a}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}async sign(a,c){let d;if(!this._protectedHeader&&!this._unprotectedHeader)throw new ap("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!aX(this._protectedHeader,this._unprotectedHeader))throw new ap("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let e={...this._protectedHeader,...this._unprotectedHeader},f=bO(ap,new Map([["b64",!0]]),null==c?void 0:c.crit,this._protectedHeader,e),g=!0;if(f.has("b64")&&"boolean"!=typeof(g=this._protectedHeader.b64))throw new ap('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:h}=e;if("string"!=typeof h||!h)throw new ap('JWS "alg" (Algorithm) Header Parameter missing or invalid');bJ(h,a,"sign");let i=this._payload;g&&(i=$.encode(b(i)));let j=aa(d=this._protectedHeader?$.encode(b(JSON.stringify(this._protectedHeader))):$.encode(""),$.encode("."),i),k={signature:b(await b6(h,a,j)),payload:""};return g&&(k.payload=_.decode(i)),this._unprotectedHeader&&(k.header=this._unprotectedHeader),this._protectedHeader&&(k.protected=_.decode(d)),k}}class ck{constructor(a){this._flattened=new cj(a)}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}async sign(a,b){let c=await this._flattened.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}class cl{constructor(a,b,c){this.parent=a,this.key=b,this.options=c}setProtectedHeader(a){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=a,this}setUnprotectedHeader(a){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=a,this}addSignature(...a){return this.parent.addSignature(...a)}sign(...a){return this.parent.sign(...a)}done(){return this.parent}}class cm{constructor(a){this._signatures=[],this._payload=a}addSignature(a,b){let c=new cl(this,a,b);return this._signatures.push(c),c}async sign(){if(!this._signatures.length)throw new ap("at least one signature must be added");let a={signatures:[],payload:""};for(let b=0;b<this._signatures.length;b++){let c=this._signatures[b],d=new cj(this._payload);d.setProtectedHeader(c.protectedHeader),d.setUnprotectedHeader(c.unprotectedHeader);let{payload:e,...f}=await d.sign(c.key,c.options);if(0===b)a.payload=e;else if(a.payload!==e)throw new ap("inconsistent use of JWS Unencoded Payload (RFC7797)");a.signatures.push(f)}return a}}class cn{constructor(a){if(!aY(a))throw TypeError("JWT Claims Set MUST be an object");this._payload=a}setIssuer(a){return this._payload={...this._payload,iss:a},this}setSubject(a){return this._payload={...this._payload,sub:a},this}setAudience(a){return this._payload={...this._payload,aud:a},this}setJti(a){return this._payload={...this._payload,jti:a},this}setNotBefore(a){return"number"==typeof a?this._payload={...this._payload,nbf:a}:this._payload={...this._payload,nbf:cb(new Date)+cd(a)},this}setExpirationTime(a){return"number"==typeof a?this._payload={...this._payload,exp:a}:this._payload={...this._payload,exp:cb(new Date)+cd(a)},this}setIssuedAt(a){return void 0===a?this._payload={...this._payload,iat:cb(new Date)}:this._payload={...this._payload,iat:a},this}}class co extends cn{setProtectedHeader(a){return this._protectedHeader=a,this}async sign(a,b){var c;let d=new ck($.encode(JSON.stringify(this._payload)));if(d.setProtectedHeader(this._protectedHeader),Array.isArray(null==(c=this._protectedHeader)?void 0:c.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new aq("JWTs MUST NOT use unencoded payload");return d.sign(a,b)}}class cp extends cn{setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setKeyManagementParameters(a){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=a,this}setContentEncryptionKey(a){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=a,this}setInitializationVector(a){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=a,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(a,b){let c=new ci($.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),c.setProtectedHeader(this._protectedHeader),this._iv&&c.setInitializationVector(this._iv),this._cek&&c.setContentEncryptionKey(this._cek),this._keyManagementParameters&&c.setKeyManagementParameters(this._keyManagementParameters),c.encrypt(a,b)}}let cq=(a,b)=>{if("string"!=typeof a||!a)throw new ar(`${b} missing or invalid`)};async function cr(a,c){let d;if(!aY(a))throw TypeError("JWK must be an object");if(null!=c||(c="sha256"),"sha256"!==c&&"sha384"!==c&&"sha512"!==c)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(a.kty){case"EC":cq(a.crv,'"crv" (Curve) Parameter'),cq(a.x,'"x" (X Coordinate) Parameter'),cq(a.y,'"y" (Y Coordinate) Parameter'),d={crv:a.crv,kty:a.kty,x:a.x,y:a.y};break;case"OKP":cq(a.crv,'"crv" (Subtype of Key Pair) Parameter'),cq(a.x,'"x" (Public Key) Parameter'),d={crv:a.crv,kty:a.kty,x:a.x};break;case"RSA":cq(a.e,'"e" (Exponent) Parameter'),cq(a.n,'"n" (Modulus) Parameter'),d={e:a.e,kty:a.kty,n:a.n};break;case"oct":cq(a.k,'"k" (Key Value) Parameter'),d={k:a.k,kty:a.kty};break;default:throw new al('"kty" (Key Type) Parameter missing or unsupported')}let e=$.encode(JSON.stringify(d));return b(await Z(c,e))}async function cs(a,b){null!=b||(b="sha256");let c=await cr(a,b);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${b.slice(-3)}:${c}`}async function ct(a,b){let c={...a,...null==b?void 0:b.header};if(!aY(c.jwk))throw new ap('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let d=await bI({...c.jwk,ext:!0},c.alg,!0);if(d instanceof Uint8Array||"public"!==d.type)throw new ap('"jwk" (JSON Web Key) Header Parameter must be a public key');return d}function cu(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(cv)}function cv(a){return aY(a)}class cw{constructor(a){if(this._cached=new WeakMap,!cu(a))throw new as("JSON Web Key Set malformed");this._jwks=function(a){return"function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a))}(a)}async getKey(a,b){let{alg:c,kid:d}={...a,...null==b?void 0:b.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new al('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this._jwks.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&"string"==typeof a.alg&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b&&"EdDSA"===c&&(b="Ed25519"===a.crv||"Ed448"===a.crv),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES256K":b="secp256k1"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new at;if(1!==h){let a=new au,{_cached:b}=this;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await cx(b,a,c)}catch{continue}},a}return cx(this._cached,g,c)}}async function cx(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await bI({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new as("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function cy(a){let b=new cw(a);return async function(a,c){return b.getKey(a,c)}}var cz=a.i(921517),cA=a.i(524836),cB=a.i(427699);let cC=async(a,b,c)=>{let d;switch(a.protocol){case"https:":d=cA.get;break;case"http:":d=cz.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:e,headers:f}=c,g=d(a.href,{agent:e,timeout:b,headers:f}),[h]=await Promise.race([(0,cB.once)(g,"response"),(0,cB.once)(g,"timeout")]);if(!h)throw g.destroy(),new av;if(200!==h.statusCode)throw new ah("Expected 200 OK from the JSON Web Key Set HTTP response");let i=[];for await(let a of h)i.push(a);try{return JSON.parse(_.decode(aa(...i)))}catch{throw new ah("Failed to parse the JSON Web Key Set HTTP response as JSON")}};class cD extends cw{constructor(a,b){if(super({keys:[]}),this._jwks=void 0,!(a instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(a.href),this._options={agent:null==b?void 0:b.agent,headers:null==b?void 0:b.headers},this._timeoutDuration="number"==typeof(null==b?void 0:b.timeoutDuration)?null==b?void 0:b.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==b?void 0:b.cooldownDuration)?null==b?void 0:b.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==b?void 0:b.cacheMaxAge)?null==b?void 0:b.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(a,b){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(a,b)}catch(c){if(c instanceof at&&!1===this.coolingDown())return await this.reload(),super.getKey(a,b);throw c}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=cC(this._url,this._timeoutDuration,this._options).then(a=>{if(!cu(a))throw new as("JSON Web Key Set malformed");this._jwks={keys:a.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(a=>{throw this._pendingFetch=void 0,a})),await this._pendingFetch}}function cE(a,b){let c=new cD(a,b);return async function(a,b){return c.getKey(a,b)}}class cF extends cn{encode(){let a=b(JSON.stringify({alg:"none"})),c=b(JSON.stringify(this._payload));return`${a}.${c}.`}static decode(a,b){let c;if("string"!=typeof a)throw new aq("Unsecured JWT must be a string");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g||""!==f)throw new aq("Invalid Unsecured JWT");try{if(c=JSON.parse(_.decode(ag(d))),"none"!==c.alg)throw Error()}catch{throw new aq("Invalid Unsecured JWT")}return{payload:cf(c,ag(e),b),header:c}}}function cG(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(_.decode(ag(b)));if(!aY(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}function cH(a){let b,c;if("string"!=typeof a)throw new aq("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new aq("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new aq("Invalid JWT");if(!d)throw new aq("JWTs must contain a payload");try{b=ag(d)}catch{throw new aq("Failed to base64url decode the payload")}try{c=JSON.parse(_.decode(b))}catch{throw new aq("Failed to parse the decoded payload as JSON")}if(!aY(c))throw new aq("Invalid JWT Claims Set");return c}a.s(["decode",0,ag,"encode",0,b],442902);var cI=a.i(952798),ax=Y;let cJ=(0,aB.promisify)(Y.generateKeyPair);async function cK(a,b){let c;switch(a){case"HS256":case"HS384":case"HS512":case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":c=parseInt(a.slice(-3),10);break;case"A128KW":case"A192KW":case"A256KW":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":c=parseInt(a.slice(1,4),10);break;default:throw new al('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return(0,Y.createSecretKey)((0,ax.randomFillSync)(new Uint8Array(c>>3)))}async function cL(a,b){var c,d;switch(a){case"RS256":case"RS384":case"RS512":case"PS256":case"PS384":case"PS512":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":case"RSA1_5":{let a=null!=(c=null==b?void 0:b.modulusLength)?c:2048;if("number"!=typeof a||a<2048)throw new al("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");let d=await cJ("rsa",{modulusLength:a,publicExponent:65537});return bi(d.privateKey,a),bi(d.publicKey,a),d}case"ES256":return cJ("ec",{namedCurve:"P-256"});case"ES256K":return cJ("ec",{namedCurve:"secp256k1"});case"ES384":return cJ("ec",{namedCurve:"P-384"});case"ES512":return cJ("ec",{namedCurve:"P-521"});case"EdDSA":switch(null==b?void 0:b.crv){case void 0:case"Ed25519":return cJ("ed25519");case"Ed448":return cJ("ed448");default:throw new al("Invalid or unsupported crv option provided, supported values are Ed25519 and Ed448")}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":let e=null!=(d=null==b?void 0:b.crv)?d:"P-256";switch(e){case void 0:case"P-256":case"P-384":case"P-521":return cJ("ec",{namedCurve:e});case"X25519":return cJ("x25519");case"X448":return cJ("x448");default:throw new al("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}default:throw new al('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}}async function cM(a,b){return cL(a,b)}async function cN(a,b){return cK(a,b)}var cO=a.i(442902);a.s(["CompactEncrypt",()=>ci,"CompactSign",()=>ck,"EmbeddedJWK",()=>ct,"EncryptJWT",()=>cp,"FlattenedEncrypt",()=>b$,"FlattenedSign",()=>cj,"GeneralEncrypt",()=>b0,"GeneralSign",()=>cm,"SignJWT",()=>co,"UnsecuredJWT",()=>cF,"base64url",0,cO,"calculateJwkThumbprint",()=>cr,"calculateJwkThumbprintUri",()=>cs,"compactDecrypt",()=>bR,"compactVerify",()=>b9,"createLocalJWKSet",()=>cy,"createRemoteJWKSet",()=>cE,"cryptoRuntime",0,"node:crypto","decodeJwt",()=>cH,"decodeProtectedHeader",()=>cG,"errors",0,cI,"exportJWK",()=>bX,"exportPKCS8",()=>bW,"exportSPKI",()=>bV,"flattenedDecrypt",()=>bQ,"flattenedVerify",()=>b8,"generalDecrypt",()=>bS,"generalVerify",()=>ca,"generateKeyPair",()=>cM,"generateSecret",()=>cN,"importJWK",()=>bI,"importPKCS8",()=>bH,"importSPKI",()=>bF,"importX509",()=>bG,"jwtDecrypt",()=>ch,"jwtVerify",()=>cg],448984),a.i(448984);var cP=a.i(563966),cQ=a.i(846304),cR=a.i(295417),cS=a.i(94727),cT=a.i(327199),cU=a.i(915848);class cV{constructor(a,b){this.scope=a,this.module=b}storeObject(a,b){this.setItem(a,JSON.stringify(b))}loadObject(a){let b=this.getItem(a);return b?JSON.parse(b):void 0}setItem(a,b){localStorage.setItem(this.scopedKey(a),b)}getItem(a){return localStorage.getItem(this.scopedKey(a))}removeItem(a){localStorage.removeItem(this.scopedKey(a))}clear(){let a=this.scopedKey(""),b=[];for(let c=0;c<localStorage.length;c++){let d=localStorage.key(c);"string"==typeof d&&d.startsWith(a)&&b.push(d)}b.forEach(a=>localStorage.removeItem(a))}scopedKey(a){return`-${this.scope}${this.module?`:${this.module}`:""}:${a}`}static clearAll(){new cV("CBWSDK").clear(),new cV("walletlink").clear()}}let cW=-32602,cX=-32603,cY=4001,cZ=4100,c$=4200,c_=4900,c0={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."},4902:{standard:"EIP-3085",message:"Unrecognized chain ID."}},c1="Unspecified error message.";function c2(a,b=c1){if(a&&Number.isInteger(a)){var c;let b=a.toString();if(c4(c0,b))return c0[b].message;if((c=a)>=-32099&&c<=-32e3)return"Unspecified server error."}return b}function c3(a){return a&&"object"==typeof a&&!Array.isArray(a)?Object.assign({},a):a}function c4(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function c5(a,b){return"object"==typeof a&&null!==a&&b in a&&"string"==typeof a[b]}let c6=a=>dd(cW,a),c7=a=>dd(cX,a),c8=a=>de(cY,a),c9=a=>de(cZ,a),da=a=>de(c$,a),db=a=>de(c_,a),dc=a=>{if(!a||"object"!=typeof a||Array.isArray(a))throw Error("Ethereum Provider custom errors must provide single object argument.");let{code:b,message:c,data:d}=a;if(!c||"string"!=typeof c)throw Error('"message" must be a nonempty string');return new dh(b,c,d)};function dd(a,b){let[c,d]=df(b);return new dg(a,c||c2(a),d)}function de(a,b){let[c,d]=df(b);return new dh(a,c||c2(a),d)}function df(a){if(a){if("string"==typeof a)return[a];else if("object"==typeof a&&!Array.isArray(a)){let{message:b,data:c}=a;if(b&&"string"!=typeof b)throw Error("Must specify string message.");return[b||void 0,c]}}return[]}class dg extends Error{constructor(a,b,c){if(!Number.isInteger(a))throw Error('"code" must be an integer.');if(!b||"string"!=typeof b)throw Error('"message" must be a nonempty string.');super(b),this.code=a,void 0!==c&&(this.data=c)}}class dh extends dg{constructor(a,b,c){if(!function(a){return Number.isInteger(a)&&a>=1e3&&a<=4999}(a))throw Error('"code" must be an integer such that: 1000 <= code <= 4999');super(a,b,c)}}function di(a){return Math.floor(a)}let dj=/^[0-9]*$/,dk=/^[a-f0-9]*$/;function dl(a){return dm(crypto.getRandomValues(new Uint8Array(a)))}function dm(a){return[...a].map(a=>a.toString(16).padStart(2,"0")).join("")}function dn(a){return new Uint8Array(a.match(/.{1,2}/g).map(a=>Number.parseInt(a,16)))}function dp(a,b=!1){let c=a.toString("hex");return b?`0x${c}`:c}function dq(a){return dp(dz(a),!0)}function dr(a){return a.toString(10)}function ds(a){return`0x${BigInt(a).toString(16)}`}function dt(a){return a.startsWith("0x")||a.startsWith("0X")}function du(a){return dt(a)?a.slice(2):a}function dv(a){return dt(a)?`0x${a.slice(2)}`:`0x${a}`}function dw(a){if("string"!=typeof a)return!1;let b=du(a).toLowerCase();return dk.test(b)}function dx(a,b=!1){let c=function(a,b=!1){if("string"==typeof a){let c=du(a).toLowerCase();if(dk.test(c))return b?`0x${c}`:c}throw c6(`"${String(a)}" is not a hexadecimal string`)}(a,!1);return c.length%2==1&&(c=`0${c}`),b?`0x${c}`:c}function dy(a){if("string"==typeof a){let b=du(a).toLowerCase();if(dw(b)&&40===b.length)return dv(b)}throw c6(`Invalid Ethereum address: ${String(a)}`)}function dz(a){if(Buffer.isBuffer(a))return a;if("string"==typeof a){if(dw(a)){let b=dx(a,!1);return Buffer.from(b,"hex")}return Buffer.from(a,"utf8")}throw c6(`Not binary data: ${String(a)}`)}function dA(a){if("number"==typeof a&&Number.isInteger(a))return di(a);if("string"==typeof a){if(dj.test(a))return di(Number(a));if(dw(a))return di(Number(BigInt(dx(a,!0))))}throw c6(`Not an integer: ${String(a)}`)}function dB(a){if(null!==a&&("bigint"==typeof a||function(a){if(null==a||"function"!=typeof a.constructor)return!1;let{constructor:b}=a;return"function"==typeof b.config&&"number"==typeof b.EUCLID}(a)))return BigInt(a.toString(10));if("number"==typeof a)return BigInt(dA(a));if("string"==typeof a){if(dj.test(a))return BigInt(a);if(dw(a))return BigInt(dx(a,!0))}throw c6(`Not an integer: ${String(a)}`)}async function dC(){return crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"])}async function dD(a,b){return crypto.subtle.deriveKey({name:"ECDH",public:b},a,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function dE(a,b){let c=crypto.getRandomValues(new Uint8Array(12)),d=await crypto.subtle.encrypt({name:"AES-GCM",iv:c},a,new TextEncoder().encode(b));return{iv:c,cipherText:d}}async function dF(a,{iv:b,cipherText:c}){let d=await crypto.subtle.decrypt({name:"AES-GCM",iv:b},a,c);return new TextDecoder().decode(d)}function dG(a){switch(a){case"public":return"spki";case"private":return"pkcs8"}}async function dH(a,b){let c=dG(a);return dm(new Uint8Array(await crypto.subtle.exportKey(c,b)))}async function dI(a,b){let c=dG(a),d=dn(b).buffer;return await crypto.subtle.importKey(c,new Uint8Array(d),{name:"ECDH",namedCurve:"P-256"},!0,"private"===a?["deriveKey"]:[])}async function dJ(a,b){return dE(b,JSON.stringify(a,(a,b)=>b instanceof Error?Object.assign(Object.assign({},b.code?{code:b.code}:{}),{message:b.message}):b))}async function dK(a,b){return JSON.parse(await dF(b,a))}let dL={storageKey:"ownPrivateKey",keyType:"private"},dM={storageKey:"ownPublicKey",keyType:"public"},dN={storageKey:"peerPublicKey",keyType:"public"};class dO{constructor(){this.storage=new cV("CBWSDK","SCWKeyManager"),this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null}async getOwnPublicKey(){return await this.loadKeysIfNeeded(),this.ownPublicKey}async getSharedSecret(){return await this.loadKeysIfNeeded(),this.sharedSecret}async setPeerPublicKey(a){this.sharedSecret=null,this.peerPublicKey=a,await this.storeKey(dN,a),await this.loadKeysIfNeeded()}async clear(){this.ownPrivateKey=null,this.ownPublicKey=null,this.peerPublicKey=null,this.sharedSecret=null,this.storage.removeItem(dM.storageKey),this.storage.removeItem(dL.storageKey),this.storage.removeItem(dN.storageKey)}async generateKeyPair(){let a=await dC();this.ownPrivateKey=a.privateKey,this.ownPublicKey=a.publicKey,await this.storeKey(dL,a.privateKey),await this.storeKey(dM,a.publicKey)}async loadKeysIfNeeded(){null===this.ownPrivateKey&&(this.ownPrivateKey=await this.loadKey(dL)),null===this.ownPublicKey&&(this.ownPublicKey=await this.loadKey(dM)),(null===this.ownPrivateKey||null===this.ownPublicKey)&&await this.generateKeyPair(),null===this.peerPublicKey&&(this.peerPublicKey=await this.loadKey(dN)),null===this.sharedSecret&&null!==this.ownPrivateKey&&null!==this.peerPublicKey&&(this.sharedSecret=await dD(this.ownPrivateKey,this.peerPublicKey))}async loadKey(a){let b=this.storage.getItem(a.storageKey);return b?dI(a.keyType,b):null}async storeKey(a,b){let c=await dH(a.keyType,b);this.storage.setItem(a.storageKey,c)}}let dP="4.3.2",dQ="@coinbase/wallet-sdk";async function dR(a,b){let c=Object.assign(Object.assign({},a),{jsonrpc:"2.0",id:crypto.randomUUID()}),d=await window.fetch(b,{method:"POST",body:JSON.stringify(c),mode:"cors",headers:{"Content-Type":"application/json","X-Cbw-Sdk-Version":dP,"X-Cbw-Sdk-Platform":dQ}}),{result:e,error:f}=await d.json();if(f)throw f;return e}let dS="accounts",dT="activeChain",dU="availableChains",dV="walletCapabilities";class dW{constructor(a){var b,c,d;this.metadata=a.metadata,this.communicator=a.communicator,this.callback=a.callback,this.keyManager=new dO,this.storage=new cV("CBWSDK","SCWStateManager"),this.accounts=null!=(b=this.storage.loadObject(dS))?b:[],this.chain=this.storage.loadObject(dT)||{id:null!=(d=null==(c=a.metadata.appChainIds)?void 0:c[0])?d:1},this.handshake=this.handshake.bind(this),this.request=this.request.bind(this),this.createRequestMessage=this.createRequestMessage.bind(this),this.decryptResponseMessage=this.decryptResponseMessage.bind(this)}async handshake(a){var b,c,d,e;await (null==(c=(b=this.communicator).waitForPopupLoaded)?void 0:c.call(b));let f=await this.createRequestMessage({handshake:{method:a.method,params:Object.assign({},this.metadata,null!=(d=a.params)?d:{})}}),g=await this.communicator.postRequestAndWaitForResponse(f);if("failure"in g.content)throw g.content.failure;let h=await dI("public",g.sender);await this.keyManager.setPeerPublicKey(h);let i=(await this.decryptResponseMessage(g)).result;if("error"in i)throw i.error;if("eth_requestAccounts"===a.method){let a=i.value;this.accounts=a,this.storage.storeObject(dS,a),null==(e=this.callback)||e.call(this,"accountsChanged",a)}}async request(a){var b;if(0===this.accounts.length)if("wallet_sendCalls"===a.method)return this.sendRequestToPopup(a);else throw c9();switch(a.method){case"eth_requestAccounts":return null==(b=this.callback)||b.call(this,"connect",{chainId:ds(this.chain.id)}),this.accounts;case"eth_accounts":return this.accounts;case"eth_coinbase":return this.accounts[0];case"net_version":return this.chain.id;case"eth_chainId":return ds(this.chain.id);case"wallet_getCapabilities":return this.storage.loadObject(dV);case"wallet_switchEthereumChain":return this.handleSwitchChainRequest(a);case"eth_ecRecover":case"personal_sign":case"wallet_sign":case"personal_ecRecover":case"eth_signTransaction":case"eth_sendTransaction":case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":case"wallet_addEthereumChain":case"wallet_watchAsset":case"wallet_sendCalls":case"wallet_showCallsStatus":case"wallet_grantPermissions":return this.sendRequestToPopup(a);default:if(!this.chain.rpcUrl)throw c7("No RPC URL set for chain");return dR(a,this.chain.rpcUrl)}}async sendRequestToPopup(a){var b,c;await (null==(c=(b=this.communicator).waitForPopupLoaded)?void 0:c.call(b));let d=await this.sendEncryptedRequest(a),e=(await this.decryptResponseMessage(d)).result;if("error"in e)throw e.error;return e.value}async cleanup(){var a,b;this.storage.clear(),await this.keyManager.clear(),this.accounts=[],this.chain={id:null!=(b=null==(a=this.metadata.appChainIds)?void 0:a[0])?b:1}}async handleSwitchChainRequest(a){var b;let c=a.params;if(!c||!(null==(b=c[0])?void 0:b.chainId))throw c6();let d=dA(c[0].chainId);if(this.updateChain(d))return null;let e=await this.sendRequestToPopup(a);return null===e&&this.updateChain(d),e}async sendEncryptedRequest(a){let b=await this.keyManager.getSharedSecret();if(!b)throw c9("No valid session found, try requestAccounts before other methods");let c=await dJ({action:a,chainId:this.chain.id},b),d=await this.createRequestMessage({encrypted:c});return this.communicator.postRequestAndWaitForResponse(d)}async createRequestMessage(a){let b=await dH("public",await this.keyManager.getOwnPublicKey());return{id:crypto.randomUUID(),sender:b,content:a,timestamp:new Date}}async decryptResponseMessage(a){var b,c;let d=a.content;if("failure"in d)throw d.failure;let e=await this.keyManager.getSharedSecret();if(!e)throw c9("Invalid session");let f=await dK(d.encrypted,e),g=null==(b=f.data)?void 0:b.chains;if(g){let a=Object.entries(g).map(([a,b])=>({id:Number(a),rpcUrl:b}));this.storage.storeObject(dU,a),this.updateChain(this.chain.id,a)}let h=null==(c=f.data)?void 0:c.capabilities;return h&&this.storage.storeObject(dV,h),f}updateChain(a,b){var c;let d=null!=b?b:this.storage.loadObject(dU),e=null==d?void 0:d.find(b=>b.id===a);return!!e&&(e!==this.chain&&(this.chain=e,this.storage.storeObject(dT,e),null==(c=this.callback)||c.call(this,"chainChanged",ds(e.id))),!0)}}var dX=a.i(646051);let dY="Addresses";function dZ(a){return void 0!==a.errorMessage}class d${constructor(a){this.secret=a}async encrypt(a){let b=this.secret;if(64!==b.length)throw Error("secret must be 256 bits");let c=crypto.getRandomValues(new Uint8Array(12)),d=await crypto.subtle.importKey("raw",dn(b),{name:"aes-gcm"},!1,["encrypt","decrypt"]),e=new TextEncoder,f=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},d,e.encode(a)),g=f.slice(f.byteLength-16),h=f.slice(0,f.byteLength-16),i=new Uint8Array(g),j=new Uint8Array(h);return dm(new Uint8Array([...c,...i,...j]))}async decrypt(a){let b=this.secret;if(64!==b.length)throw Error("secret must be 256 bits");return new Promise((c,d)=>{!async function(){let e=await crypto.subtle.importKey("raw",dn(b),{name:"aes-gcm"},!1,["encrypt","decrypt"]),f=dn(a),g=f.slice(0,12),h=f.slice(12,28),i=new Uint8Array([...f.slice(28),...h]),j={name:"AES-GCM",iv:new Uint8Array(g)};try{let a=await window.crypto.subtle.decrypt(j,e,i),b=new TextDecoder;c(b.decode(a))}catch(a){d(a)}}()})}}class d_{constructor(a,b,c){this.linkAPIUrl=a,this.sessionId=b;const d=`${b}:${c}`;this.auth=`Basic ${btoa(d)}`}async markUnseenEventsAsSeen(a){return Promise.all(a.map(a=>fetch(`${this.linkAPIUrl}/events/${a.eventId}/seen`,{method:"POST",headers:{Authorization:this.auth}}))).catch(a=>console.error("Unabled to mark event as failed:",a))}async fetchUnseenEvents(){var a;let b=await fetch(`${this.linkAPIUrl}/events?unseen=true`,{headers:{Authorization:this.auth}});if(b.ok){let{events:c,error:d}=await b.json();if(d)throw Error(`Check unseen events failed: ${d}`);let e=null!=(a=null==c?void 0:c.filter(a=>"Web3Response"===a.event).map(a=>({type:"Event",sessionId:this.sessionId,eventId:a.id,event:a.event,data:a.data})))?a:[];return this.markUnseenEventsAsSeen(e),e}throw Error(`Check unseen events failed: ${b.status}`)}}(DP=Ed||(Ed={}))[DP.DISCONNECTED=0]="DISCONNECTED",DP[DP.CONNECTING=1]="CONNECTING",DP[DP.CONNECTED=2]="CONNECTED";class d0{setConnectionStateListener(a){this.connectionStateListener=a}setIncomingDataListener(a){this.incomingDataListener=a}constructor(a,b=WebSocket){this.WebSocketClass=b,this.webSocket=null,this.pendingData=[],this.url=a.replace(/^http/,"ws")}async connect(){if(this.webSocket)throw Error("webSocket object is not null");return new Promise((a,b)=>{var c;let d;try{this.webSocket=d=new this.WebSocketClass(this.url)}catch(a){b(a);return}null==(c=this.connectionStateListener)||c.call(this,Ed.CONNECTING),d.onclose=a=>{var c;this.clearWebSocket(),b(Error(`websocket error ${a.code}: ${a.reason}`)),null==(c=this.connectionStateListener)||c.call(this,Ed.DISCONNECTED)},d.onopen=b=>{var c;a(),null==(c=this.connectionStateListener)||c.call(this,Ed.CONNECTED),this.pendingData.length>0&&([...this.pendingData].forEach(a=>this.sendData(a)),this.pendingData=[])},d.onmessage=a=>{var b,c;if("h"===a.data)null==(b=this.incomingDataListener)||b.call(this,{type:"Heartbeat"});else try{let b=JSON.parse(a.data);null==(c=this.incomingDataListener)||c.call(this,b)}catch(a){}}})}disconnect(){var a;let{webSocket:b}=this;if(b){this.clearWebSocket(),null==(a=this.connectionStateListener)||a.call(this,Ed.DISCONNECTED),this.connectionStateListener=void 0,this.incomingDataListener=void 0;try{b.close()}catch(a){}}}sendData(a){let{webSocket:b}=this;if(!b){this.pendingData.push(a),this.connect();return}b.send(a)}clearWebSocket(){let{webSocket:a}=this;a&&(this.webSocket=null,a.onclose=null,a.onerror=null,a.onmessage=null,a.onopen=null)}}class d1{constructor({session:a,linkAPIUrl:b,listener:c}){this.destroyed=!1,this.lastHeartbeatResponse=0,this.nextReqId=di(1),this._connected=!1,this._linked=!1,this.shouldFetchUnseenEventsOnConnect=!1,this.requestResolutions=new Map,this.handleSessionMetadataUpdated=a=>{a&&new Map([["__destroyed",this.handleDestroyed],["EthereumAddress",this.handleAccountUpdated],["WalletUsername",this.handleWalletUsernameUpdated],["AppVersion",this.handleAppVersionUpdated],["ChainId",b=>a.JsonRpcUrl&&this.handleChainUpdated(b,a.JsonRpcUrl)]]).forEach((b,c)=>{let d=a[c];void 0!==d&&b(d)})},this.handleDestroyed=a=>{var b;"1"===a&&(null==(b=this.listener)||b.resetAndReload())},this.handleAccountUpdated=async a=>{var b;let c=await this.cipher.decrypt(a);null==(b=this.listener)||b.accountUpdated(c)},this.handleMetadataUpdated=async(a,b)=>{var c;let d=await this.cipher.decrypt(b);null==(c=this.listener)||c.metadataUpdated(a,d)},this.handleWalletUsernameUpdated=async a=>{this.handleMetadataUpdated("walletUsername",a)},this.handleAppVersionUpdated=async a=>{this.handleMetadataUpdated("AppVersion",a)},this.handleChainUpdated=async(a,b)=>{var c;let d=await this.cipher.decrypt(a),e=await this.cipher.decrypt(b);null==(c=this.listener)||c.chainUpdated(d,e)},this.session=a,this.cipher=new d$(a.secret),this.listener=c;const d=new d0(`${b}/rpc`,WebSocket);d.setConnectionStateListener(async a=>{let b=!1;switch(a){case Ed.DISCONNECTED:if(!this.destroyed){let a=async()=>{await new Promise(a=>setTimeout(a,5e3)),this.destroyed||d.connect().catch(()=>{a()})};a()}break;case Ed.CONNECTED:b=await this.handleConnected(),this.updateLastHeartbeat(),setInterval(()=>{this.heartbeat()},1e4),this.shouldFetchUnseenEventsOnConnect&&this.fetchUnseenEventsAPI();case Ed.CONNECTING:}this.connected!==b&&(this.connected=b)}),d.setIncomingDataListener(a=>{var b;switch(a.type){case"Heartbeat":this.updateLastHeartbeat();return;case"IsLinkedOK":case"Linked":{let b="IsLinkedOK"===a.type?a.linked:void 0;this.linked=b||a.onlineGuests>0;break}case"GetSessionConfigOK":case"SessionConfigUpdated":this.handleSessionMetadataUpdated(a.metadata);break;case"Event":this.handleIncomingEvent(a)}void 0!==a.id&&(null==(b=this.requestResolutions.get(a.id))||b(a))}),this.ws=d,this.http=new d_(b,a.id,a.key)}connect(){if(this.destroyed)throw Error("instance is destroyed");this.ws.connect()}async destroy(){this.destroyed||(await this.makeRequest({type:"SetSessionConfig",id:di(this.nextReqId++),sessionId:this.session.id,metadata:{__destroyed:"1"}},{timeout:1e3}),this.destroyed=!0,this.ws.disconnect(),this.listener=void 0)}get connected(){return this._connected}set connected(a){this._connected=a}get linked(){return this._linked}set linked(a){var b,c;this._linked=a,a&&(null==(b=this.onceLinked)||b.call(this)),null==(c=this.listener)||c.linkedUpdated(a)}setOnceLinked(a){return new Promise(b=>{this.linked?a().then(b):this.onceLinked=()=>{a().then(b),this.onceLinked=void 0}})}async handleIncomingEvent(a){var b;if("Event"!==a.type||"Web3Response"!==a.event)return;let c=JSON.parse(await this.cipher.decrypt(a.data));if("WEB3_RESPONSE"!==c.type)return;let{id:d,response:e}=c;null==(b=this.listener)||b.handleWeb3ResponseMessage(d,e)}async checkUnseenEvents(){if(!this.connected){this.shouldFetchUnseenEventsOnConnect=!0;return}await new Promise(a=>setTimeout(a,250));try{await this.fetchUnseenEventsAPI()}catch(a){console.error("Unable to check for unseen events",a)}}async fetchUnseenEventsAPI(){this.shouldFetchUnseenEventsOnConnect=!1,(await this.http.fetchUnseenEvents()).forEach(a=>this.handleIncomingEvent(a))}async publishEvent(a,b,c=!1){let d=await this.cipher.encrypt(JSON.stringify(Object.assign(Object.assign({},b),{origin:location.origin,location:location.href,relaySource:"coinbaseWalletExtension"in window&&window.coinbaseWalletExtension?"injected_sdk":"sdk"}))),e={type:"PublishEvent",id:di(this.nextReqId++),sessionId:this.session.id,event:a,data:d,callWebhook:c};return this.setOnceLinked(async()=>{let a=await this.makeRequest(e);if("Fail"===a.type)throw Error(a.error||"failed to publish event");return a.eventId})}sendData(a){this.ws.sendData(JSON.stringify(a))}updateLastHeartbeat(){this.lastHeartbeatResponse=Date.now()}heartbeat(){if(Date.now()-this.lastHeartbeatResponse>2e4)return void this.ws.disconnect();try{this.ws.sendData("h")}catch(a){}}async makeRequest(a,b={timeout:6e4}){let c,d=a.id;return this.sendData(a),Promise.race([new Promise((a,e)=>{c=window.setTimeout(()=>{e(Error(`request ${d} timed out`))},b.timeout)}),new Promise(a=>{this.requestResolutions.set(d,b=>{clearTimeout(c),a(b),this.requestResolutions.delete(d)})})])}async handleConnected(){return"Fail"!==(await this.makeRequest({type:"HostSession",id:di(this.nextReqId++),sessionId:this.session.id,sessionKey:this.session.key})).type&&(this.sendData({type:"IsLinked",id:di(this.nextReqId++),sessionId:this.session.id}),this.sendData({type:"GetSessionConfig",id:di(this.nextReqId++),sessionId:this.session.id}),!0)}}class d2{constructor(){this._nextRequestId=0,this.callbacks=new Map}makeRequestId(){this._nextRequestId=(this._nextRequestId+1)%0x7fffffff;let a=this._nextRequestId,b=dv(a.toString(16));return this.callbacks.get(b)&&this.callbacks.delete(b),a}}var d3=a.i(421795),d4=a.i(824771);let d5="session:id",d6="session:secret",d7="session:linked";class d8{constructor(a,b,c,d=!1){this.storage=a,this.id=b,this.secret=c,this.key=(0,d4.bytesToHex)((0,d3.sha256)(`${b}, ${c} WalletLink`)),this._linked=!!d}static create(a){return new d8(a,dl(16),dl(32)).save()}static load(a){let b=a.getItem(d5),c=a.getItem(d7),d=a.getItem(d6);return b&&d?new d8(a,b,d,"1"===c):null}get linked(){return this._linked}set linked(a){this._linked=a,this.persistLinked()}save(){return this.storage.setItem(d5,this.id),this.storage.setItem(d6,this.secret),this.persistLinked(),this}persistLinked(){this.storage.setItem(d7,this._linked?"1":"0")}}function d9(){var a,b;return null!=(b=null==(a=null==window?void 0:window.matchMedia)?void 0:a.call(window,"(prefers-color-scheme: dark)").matches)&&b}function ea(){let a=document.createElement("style");a.type="text/css",a.appendChild(document.createTextNode('@namespace svg "http://www.w3.org/2000/svg";.-cbwsdk-css-reset,.-cbwsdk-css-reset *{animation:none;animation-delay:0;animation-direction:normal;animation-duration:0;animation-fill-mode:none;animation-iteration-count:1;animation-name:none;animation-play-state:running;animation-timing-function:ease;backface-visibility:visible;background:0;background-attachment:scroll;background-clip:border-box;background-color:rgba(0,0,0,0);background-image:none;background-origin:padding-box;background-position:0 0;background-position-x:0;background-position-y:0;background-repeat:repeat;background-size:auto auto;border:0;border-style:none;border-width:medium;border-color:inherit;border-bottom:0;border-bottom-color:inherit;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:none;border-bottom-width:medium;border-collapse:separate;border-image:none;border-left:0;border-left-color:inherit;border-left-style:none;border-left-width:medium;border-radius:0;border-right:0;border-right-color:inherit;border-right-style:none;border-right-width:medium;border-spacing:0;border-top:0;border-top-color:inherit;border-top-left-radius:0;border-top-right-radius:0;border-top-style:none;border-top-width:medium;box-shadow:none;box-sizing:border-box;caption-side:top;clear:none;clip:auto;color:inherit;columns:auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium none currentColor;column-rule-color:currentColor;column-rule-style:none;column-rule-width:none;column-span:1;column-width:auto;counter-increment:none;counter-reset:none;direction:ltr;empty-cells:show;float:none;font:normal;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;font-size:medium;font-style:normal;font-variant:normal;font-weight:normal;height:auto;hyphens:none;letter-spacing:normal;line-height:normal;list-style:none;list-style-image:none;list-style-position:outside;list-style-type:disc;margin:0;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;opacity:1;orphans:0;outline:0;outline-color:invert;outline-style:none;outline-width:medium;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;perspective:none;perspective-origin:50% 50%;pointer-events:auto;position:static;quotes:"\\201C" "\\201D" "\\2018" "\\2019";tab-size:8;table-layout:auto;text-align:inherit;text-align-last:auto;text-decoration:none;text-decoration-color:inherit;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-shadow:none;text-transform:none;transform:none;transform-style:flat;transition:none;transition-delay:0s;transition-duration:0s;transition-property:none;transition-timing-function:ease;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:0;word-spacing:normal;z-index:auto}.-cbwsdk-css-reset strong{font-weight:bold}.-cbwsdk-css-reset *{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif;line-height:1}.-cbwsdk-css-reset [class*=container]{margin:0;padding:0}.-cbwsdk-css-reset style{display:none}')),document.documentElement.appendChild(a)}var eb=a.i(504955),ec=a.i(535514),ed=a.i(126106);class ee{constructor(){this.items=new Map,this.nextItemKey=0,this.root=null,this.darkMode=d9()}attach(a){this.root=document.createElement("div"),this.root.className="-cbwsdk-snackbar-root",a.appendChild(this.root),this.render()}presentItem(a){let b=this.nextItemKey++;return this.items.set(b,a),this.render(),()=>{this.items.delete(b),this.render()}}clear(){this.items.clear(),this.render()}render(){this.root&&(0,ec.render)((0,ec.h)("div",null,(0,ec.h)(ef,{darkMode:this.darkMode},Array.from(this.items.entries()).map(([a,b])=>(0,ec.h)(eg,Object.assign({},b,{key:a}))))),this.root)}}let ef=a=>(0,ec.h)("div",{class:(0,eb.clsx)("-cbwsdk-snackbar-container")},(0,ec.h)("style",null,".-cbwsdk-css-reset .-gear-container{margin-left:16px !important;margin-right:9px !important;display:flex;align-items:center;justify-content:center;width:24px;height:24px;transition:opacity .25s}.-cbwsdk-css-reset .-gear-container *{user-select:none}.-cbwsdk-css-reset .-gear-container svg{opacity:0;position:absolute}.-cbwsdk-css-reset .-gear-icon{height:12px;width:12px;z-index:10000}.-cbwsdk-css-reset .-cbwsdk-snackbar{align-items:flex-end;display:flex;flex-direction:column;position:fixed;right:0;top:0;z-index:2147483647}.-cbwsdk-css-reset .-cbwsdk-snackbar *{user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance{display:flex;flex-direction:column;margin:8px 16px 0 16px;overflow:visible;text-align:left;transform:translateX(0);transition:opacity .25s,transform .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header:hover .-gear-container svg{opacity:1}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header{display:flex;align-items:center;background:#fff;overflow:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-cblogo{margin:8px 8px 8px 8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-header-message{color:#000;font-size:13px;line-height:1.5;user-select:none}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu{background:#fff;transition:opacity .25s ease-in-out,transform .25s linear,visibility 0s;visibility:hidden;border:1px solid #e7ebee;box-sizing:border-box;border-radius:8px;opacity:0;flex-direction:column;padding-left:8px;padding-right:8px}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:last-child{margin-bottom:8px !important}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover{background:#f5f7f8;border-radius:6px;transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover span{color:#050f19;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item:hover svg path{fill:#000;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item{visibility:inherit;height:35px;margin-top:8px;margin-bottom:0;display:flex;flex-direction:row;align-items:center;padding:8px;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item *{visibility:inherit;cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover{background:rgba(223,95,103,.2);transition:background .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover *{cursor:pointer}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover svg path{fill:#df5f67;transition:fill .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-is-red:hover span{color:#df5f67;transition:color .25s}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-menu-item-info{color:#aaa;font-size:13px;margin:0 8px 0 32px;position:absolute}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-hidden{opacity:0;text-align:left;transform:translateX(25%);transition:opacity .5s linear}.-cbwsdk-css-reset .-cbwsdk-snackbar-instance-expanded .-cbwsdk-snackbar-instance-menu{opacity:1;display:flex;transform:translateY(8px);visibility:visible}"),(0,ec.h)("div",{class:"-cbwsdk-snackbar"},a.children)),eg=({autoExpand:a,message:b,menuItems:c})=>{let[d,e]=(0,ed.useState)(!0),[f,g]=(0,ed.useState)(null!=a&&a);return(0,ed.useEffect)(()=>{let a=[window.setTimeout(()=>{e(!1)},1),window.setTimeout(()=>{g(!0)},1e4)];return()=>{a.forEach(window.clearTimeout)}}),(0,ec.h)("div",{class:(0,eb.clsx)("-cbwsdk-snackbar-instance",d&&"-cbwsdk-snackbar-instance-hidden",f&&"-cbwsdk-snackbar-instance-expanded")},(0,ec.h)("div",{class:"-cbwsdk-snackbar-instance-header",onClick:()=>{g(!f)}},(0,ec.h)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEuNDkyIDEwLjQxOWE4LjkzIDguOTMgMCAwMTguOTMtOC45M2gxMS4xNjNhOC45MyA4LjkzIDAgMDE4LjkzIDguOTN2MTEuMTYzYTguOTMgOC45MyAwIDAxLTguOTMgOC45M0gxMC40MjJhOC45MyA4LjkzIDAgMDEtOC45My04LjkzVjEwLjQxOXoiIGZpbGw9IiMxNjUyRjAiLz48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTEwLjQxOSAwSDIxLjU4QzI3LjMzNSAwIDMyIDQuNjY1IDMyIDEwLjQxOVYyMS41OEMzMiAyNy4zMzUgMjcuMzM1IDMyIDIxLjU4MSAzMkgxMC40MkM0LjY2NSAzMiAwIDI3LjMzNSAwIDIxLjU4MVYxMC40MkMwIDQuNjY1IDQuNjY1IDAgMTAuNDE5IDB6bTAgMS40ODhhOC45MyA4LjkzIDAgMDAtOC45MyA4LjkzdjExLjE2M2E4LjkzIDguOTMgMCAwMDguOTMgOC45M0gyMS41OGE4LjkzIDguOTMgMCAwMDguOTMtOC45M1YxMC40MmE4LjkzIDguOTMgMCAwMC04LjkzLTguOTNIMTAuNDJ6IiBmaWxsPSIjZmZmIi8+PHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNS45OTggMjYuMDQ5Yy01LjU0OSAwLTEwLjA0Ny00LjQ5OC0xMC4wNDctMTAuMDQ3IDAtNS41NDggNC40OTgtMTAuMDQ2IDEwLjA0Ny0xMC4wNDYgNS41NDggMCAxMC4wNDYgNC40OTggMTAuMDQ2IDEwLjA0NiAwIDUuNTQ5LTQuNDk4IDEwLjA0Ny0xMC4wNDYgMTAuMDQ3eiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0xMi43NjIgMTQuMjU0YzAtLjgyMi42NjctMS40ODkgMS40ODktMS40ODloMy40OTdjLjgyMiAwIDEuNDg4LjY2NiAxLjQ4OCAxLjQ4OXYzLjQ5N2MwIC44MjItLjY2NiAxLjQ4OC0xLjQ4OCAxLjQ4OGgtMy40OTdhMS40ODggMS40ODggMCAwMS0xLjQ4OS0xLjQ4OHYtMy40OTh6IiBmaWxsPSIjMTY1MkYwIi8+PC9zdmc+",class:"-cbwsdk-snackbar-instance-header-cblogo"})," ",(0,ec.h)("div",{class:"-cbwsdk-snackbar-instance-header-message"},b),(0,ec.h)("div",{class:"-gear-container"},!f&&(0,ec.h)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,ec.h)("circle",{cx:"12",cy:"12",r:"12",fill:"#F5F7F8"})),(0,ec.h)("img",{src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDYuNzV2LTEuNWwtMS43Mi0uNTdjLS4wOC0uMjctLjE5LS41Mi0uMzItLjc3bC44MS0xLjYyLTEuMDYtMS4wNi0xLjYyLjgxYy0uMjQtLjEzLS41LS4yNC0uNzctLjMyTDYuNzUgMGgtMS41bC0uNTcgMS43MmMtLjI3LjA4LS41My4xOS0uNzcuMzJsLTEuNjItLjgxLTEuMDYgMS4wNi44MSAxLjYyYy0uMTMuMjQtLjI0LjUtLjMyLjc3TDAgNS4yNXYxLjVsMS43Mi41N2MuMDguMjcuMTkuNTMuMzIuNzdsLS44MSAxLjYyIDEuMDYgMS4wNiAxLjYyLS44MWMuMjQuMTMuNS4yMy43Ny4zMkw1LjI1IDEyaDEuNWwuNTctMS43MmMuMjctLjA4LjUyLS4xOS43Ny0uMzJsMS42Mi44MSAxLjA2LTEuMDYtLjgxLTEuNjJjLjEzLS4yNC4yMy0uNS4zMi0uNzdMMTIgNi43NXpNNiA4LjVhMi41IDIuNSAwIDAxMC01IDIuNSAyLjUgMCAwMTAgNXoiIGZpbGw9IiMwNTBGMTkiLz48L3N2Zz4=",class:"-gear-icon",title:"Expand"}))),c&&c.length>0&&(0,ec.h)("div",{class:"-cbwsdk-snackbar-instance-menu"},c.map((a,b)=>(0,ec.h)("div",{class:(0,eb.clsx)("-cbwsdk-snackbar-instance-menu-item",a.isRed&&"-cbwsdk-snackbar-instance-menu-item-is-red"),onClick:a.onClick,key:b},(0,ec.h)("svg",{width:a.svgWidth,height:a.svgHeight,viewBox:"0 0 10 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,ec.h)("path",{"fill-rule":a.defaultFillRule,"clip-rule":a.defaultClipRule,d:a.path,fill:"#AAAAAA"})),(0,ec.h)("span",{class:(0,eb.clsx)("-cbwsdk-snackbar-instance-menu-item-info",a.isRed&&"-cbwsdk-snackbar-instance-menu-item-info-is-red")},a.info)))))},eh="M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z";class ei{constructor(){this.attached=!1,this.snackbar=new ee}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");let a=document.documentElement,b=document.createElement("div");b.className="-cbwsdk-css-reset",a.appendChild(b),this.snackbar.attach(b),this.attached=!0,ea()}showConnecting(a){let b;return b=a.isUnlinkedErrorState?{autoExpand:!0,message:"Connection lost",menuItems:[{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:"M5.00008 0.96875C6.73133 0.96875 8.23758 1.94375 9.00008 3.375L10.0001 2.375V5.5H9.53133H7.96883H6.87508L7.80633 4.56875C7.41258 3.3875 6.31258 2.53125 5.00008 2.53125C3.76258 2.53125 2.70633 3.2875 2.25633 4.36875L0.812576 3.76875C1.50008 2.125 3.11258 0.96875 5.00008 0.96875ZM2.19375 6.43125C2.5875 7.6125 3.6875 8.46875 5 8.46875C6.2375 8.46875 7.29375 7.7125 7.74375 6.63125L9.1875 7.23125C8.5 8.875 6.8875 10.0312 5 10.0312C3.26875 10.0312 1.7625 9.05625 1 7.625L0 8.625V5.5H0.46875H2.03125H3.125L2.19375 6.43125Z",defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:a.onResetConnection}]}:{message:"Confirm on phone",menuItems:[{isRed:!0,info:"Cancel transaction",svgWidth:"11",svgHeight:"11",path:"M10.3711 1.52346L9.21775 0.370117L5.37109 4.21022L1.52444 0.370117L0.371094 1.52346L4.2112 5.37012L0.371094 9.21677L1.52444 10.3701L5.37109 6.53001L9.21775 10.3701L10.3711 9.21677L6.53099 5.37012L10.3711 1.52346Z",defaultFillRule:"inherit",defaultClipRule:"inherit",onClick:a.onCancel},{isRed:!1,info:"Reset connection",svgWidth:"10",svgHeight:"11",path:eh,defaultFillRule:"evenodd",defaultClipRule:"evenodd",onClick:a.onResetConnection}]},this.snackbar.presentItem(b)}}class ej{constructor(){this.root=null,this.darkMode=d9()}attach(){let a=document.documentElement;this.root=document.createElement("div"),this.root.className="-cbwsdk-css-reset",a.appendChild(this.root),ea()}present(a){this.render(a)}clear(){this.render(null)}render(a){!this.root||((0,ec.render)(null,this.root),a&&(0,ec.render)((0,ec.h)(ek,Object.assign({},a,{onDismiss:()=>{this.clear()},darkMode:this.darkMode})),this.root))}}let ek=({title:a,buttonText:b,darkMode:c,onButtonClick:d,onDismiss:e})=>(0,ec.h)(ef,{darkMode:c},(0,ec.h)("div",{class:"-cbwsdk-redirect-dialog"},(0,ec.h)("style",null,".-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop{position:fixed;top:0;left:0;right:0;bottom:0;transition:opacity .25s;background-color:rgba(10,11,13,.5)}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-backdrop-hidden{opacity:0}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box{display:block;position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);padding:20px;border-radius:8px;background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box p{display:block;font-weight:400;font-size:14px;line-height:20px;padding-bottom:12px;color:#5b636e}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box button{appearance:none;border:none;background:none;color:#0052ff;padding:0;text-decoration:none;display:block;font-weight:600;font-size:16px;line-height:24px}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark{background-color:#0a0b0d;color:#fff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.dark button{color:#0052ff}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light{background-color:#fff;color:#0a0b0d}.-cbwsdk-css-reset .-cbwsdk-redirect-dialog-box.light button{color:#0052ff}"),(0,ec.h)("div",{class:"-cbwsdk-redirect-dialog-backdrop",onClick:e}),(0,ec.h)("div",{class:(0,eb.clsx)("-cbwsdk-redirect-dialog-box",c?"dark":"light")},(0,ec.h)("p",null,a),(0,ec.h)("button",{onClick:d},b)))),el="https://www.walletlink.org";class em{constructor(){this.attached=!1,this.redirectDialog=new ej}attach(){if(this.attached)throw Error("Coinbase Wallet SDK UI is already attached");this.redirectDialog.attach(),this.attached=!0}redirectToCoinbaseWallet(a){let b=new URL("https://go.cb-w.com/walletlink");b.searchParams.append("redirect_url",function(){try{if(function(){try{return null!==window.frameElement}catch(a){return!1}}()&&window.top)return window.top.location;return window.location}catch(a){return window.location}}().href),a&&b.searchParams.append("wl_url",a);let c=document.createElement("a");c.target="cbw-opener",c.href=b.href,c.rel="noreferrer noopener",c.click()}openCoinbaseWalletDeeplink(a){this.redirectDialog.present({title:"Redirecting to Coinbase Wallet...",buttonText:"Open",onButtonClick:()=>{this.redirectToCoinbaseWallet(a)}}),setTimeout(()=>{this.redirectToCoinbaseWallet(a)},99)}showConnecting(a){return()=>{this.redirectDialog.clear()}}}class en{constructor(a){this.chainCallbackParams={chainId:"",jsonRpcUrl:""},this.isMobileWeb=function(){var a;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(null==(a=null==window?void 0:window.navigator)?void 0:a.userAgent)}(),this.linkedUpdated=a=>{this.isLinked=a;let b=this.storage.getItem(dY);if(a&&(this._session.linked=a),this.isUnlinkedErrorState=!1,b){let c=b.split(" "),d="true"===this.storage.getItem("IsStandaloneSigning");""===c[0]||a||!this._session.linked||d||(this.isUnlinkedErrorState=!0)}},this.metadataUpdated=(a,b)=>{this.storage.setItem(a,b)},this.chainUpdated=(a,b)=>{(this.chainCallbackParams.chainId!==a||this.chainCallbackParams.jsonRpcUrl!==b)&&(this.chainCallbackParams={chainId:a,jsonRpcUrl:b},this.chainCallback&&this.chainCallback(b,Number.parseInt(a,10)))},this.accountUpdated=a=>{this.accountsCallback&&this.accountsCallback([a]),en.accountRequestCallbackIds.size>0&&(Array.from(en.accountRequestCallbackIds.values()).forEach(b=>{this.invokeCallback(b,{method:"requestEthereumAccounts",result:[a]})}),en.accountRequestCallbackIds.clear())},this.resetAndReload=this.resetAndReload.bind(this),this.linkAPIUrl=a.linkAPIUrl,this.storage=a.storage,this.metadata=a.metadata,this.accountsCallback=a.accountsCallback,this.chainCallback=a.chainCallback;const{session:b,ui:c,connection:d}=this.subscribe();this._session=b,this.connection=d,this.relayEventManager=new d2,this.ui=c,this.ui.attach()}subscribe(){let a=d8.load(this.storage)||d8.create(this.storage),{linkAPIUrl:b}=this,c=new d1({session:a,linkAPIUrl:b,listener:this}),d=this.isMobileWeb?new em:new ei;return c.connect(),{session:a,ui:d,connection:c}}resetAndReload(){this.connection.destroy().then(()=>{let a=d8.load(this.storage);(null==a?void 0:a.id)===this._session.id&&cV.clearAll(),document.location.reload()}).catch(a=>{})}signEthereumTransaction(a){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:a.fromAddress,toAddress:a.toAddress,weiValue:dr(a.weiValue),data:dp(a.data,!0),nonce:a.nonce,gasPriceInWei:a.gasPriceInWei?dr(a.gasPriceInWei):null,maxFeePerGas:a.gasPriceInWei?dr(a.gasPriceInWei):null,maxPriorityFeePerGas:a.gasPriceInWei?dr(a.gasPriceInWei):null,gasLimit:a.gasLimit?dr(a.gasLimit):null,chainId:a.chainId,shouldSubmit:!1}})}signAndSubmitEthereumTransaction(a){return this.sendRequest({method:"signEthereumTransaction",params:{fromAddress:a.fromAddress,toAddress:a.toAddress,weiValue:dr(a.weiValue),data:dp(a.data,!0),nonce:a.nonce,gasPriceInWei:a.gasPriceInWei?dr(a.gasPriceInWei):null,maxFeePerGas:a.maxFeePerGas?dr(a.maxFeePerGas):null,maxPriorityFeePerGas:a.maxPriorityFeePerGas?dr(a.maxPriorityFeePerGas):null,gasLimit:a.gasLimit?dr(a.gasLimit):null,chainId:a.chainId,shouldSubmit:!0}})}submitEthereumTransaction(a,b){return this.sendRequest({method:"submitEthereumTransaction",params:{signedTransaction:dp(a,!0),chainId:b}})}getWalletLinkSession(){return this._session}sendRequest(a){let b=null,c=dl(8),d=d=>{this.publishWeb3RequestCanceledEvent(c),this.handleErrorResponse(c,a.method,d),null==b||b()};return new Promise((e,f)=>{b=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:d,onResetConnection:this.resetAndReload}),this.relayEventManager.callbacks.set(c,a=>{if(null==b||b(),dZ(a))return f(Error(a.errorMessage));e(a)}),this.publishWeb3RequestEvent(c,a)})}publishWeb3RequestEvent(a,b){let c={type:"WEB3_REQUEST",id:a,request:b};this.publishEvent("Web3Request",c,!0).then(a=>{}).catch(a=>{this.handleWeb3ResponseMessage(c.id,{method:b.method,errorMessage:a.message})}),this.isMobileWeb&&this.openCoinbaseWalletDeeplink(b.method)}openCoinbaseWalletDeeplink(a){if(this.ui instanceof em)switch(a){case"requestEthereumAccounts":case"switchEthereumChain":return;default:window.addEventListener("blur",()=>{window.addEventListener("focus",()=>{this.connection.checkUnseenEvents()},{once:!0})},{once:!0}),this.ui.openCoinbaseWalletDeeplink()}}publishWeb3RequestCanceledEvent(a){this.publishEvent("Web3RequestCanceled",{type:"WEB3_REQUEST_CANCELED",id:a},!1).then()}publishEvent(a,b,c){return this.connection.publishEvent(a,b,c)}handleWeb3ResponseMessage(a,b){if("requestEthereumAccounts"===b.method){en.accountRequestCallbackIds.forEach(a=>this.invokeCallback(a,b)),en.accountRequestCallbackIds.clear();return}this.invokeCallback(a,b)}handleErrorResponse(a,b,c){var d;let e=null!=(d=null==c?void 0:c.message)?d:"Unspecified error message.";this.handleWeb3ResponseMessage(a,{method:b,errorMessage:e})}invokeCallback(a,b){let c=this.relayEventManager.callbacks.get(a);c&&(c(b),this.relayEventManager.callbacks.delete(a))}requestEthereumAccounts(){let{appName:a,appLogoUrl:b}=this.metadata,c={method:"requestEthereumAccounts",params:{appName:a,appLogoUrl:b}},d=dl(8);return new Promise((a,b)=>{this.relayEventManager.callbacks.set(d,c=>{if(dZ(c))return b(Error(c.errorMessage));a(c)}),en.accountRequestCallbackIds.add(d),this.publishWeb3RequestEvent(d,c)})}watchAsset(a,b,c,d,e,f){let g={method:"watchAsset",params:{type:a,options:{address:b,symbol:c,decimals:d,image:e},chainId:f}},h=null,i=dl(8),j=a=>{this.publishWeb3RequestCanceledEvent(i),this.handleErrorResponse(i,g.method,a),null==h||h()};return h=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:j,onResetConnection:this.resetAndReload}),new Promise((a,b)=>{this.relayEventManager.callbacks.set(i,c=>{if(null==h||h(),dZ(c))return b(Error(c.errorMessage));a(c)}),this.publishWeb3RequestEvent(i,g)})}addEthereumChain(a,b,c,d,e,f){let g={method:"addEthereumChain",params:{chainId:a,rpcUrls:b,blockExplorerUrls:d,chainName:e,iconUrls:c,nativeCurrency:f}},h=null,i=dl(8),j=a=>{this.publishWeb3RequestCanceledEvent(i),this.handleErrorResponse(i,g.method,a),null==h||h()};return h=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:j,onResetConnection:this.resetAndReload}),new Promise((a,b)=>{this.relayEventManager.callbacks.set(i,c=>{if(null==h||h(),dZ(c))return b(Error(c.errorMessage));a(c)}),this.publishWeb3RequestEvent(i,g)})}switchEthereumChain(a,b){let c={method:"switchEthereumChain",params:Object.assign({chainId:a},{address:b})},d=null,e=dl(8),f=a=>{this.publishWeb3RequestCanceledEvent(e),this.handleErrorResponse(e,c.method,a),null==d||d()};return d=this.ui.showConnecting({isUnlinkedErrorState:this.isUnlinkedErrorState,onCancel:f,onResetConnection:this.resetAndReload}),new Promise((a,b)=>{this.relayEventManager.callbacks.set(e,c=>(null==d||d(),dZ(c)&&c.errorCode)?b(dc({code:c.errorCode,message:"Unrecognized chain ID. Try adding the chain using addEthereumChain first."})):dZ(c)?b(Error(c.errorMessage)):void a(c)),this.publishWeb3RequestEvent(e,c)})}}en.accountRequestCallbackIds=new Set;let eo="DefaultChainId",ep="DefaultJsonRpcUrl";class eq{constructor(a){this._relay=null,this._addresses=[],this.metadata=a.metadata,this._storage=new cV("walletlink",el),this.callback=a.callback||null;const b=this._storage.getItem(dY);if(b){const a=b.split(" ");""!==a[0]&&(this._addresses=a.map(a=>dy(a)))}this.initializeRelay()}getSession(){let{id:a,secret:b}=this.initializeRelay().getWalletLinkSession();return{id:a,secret:b}}async handshake(){await this._eth_requestAccounts()}get selectedAddress(){return this._addresses[0]||void 0}get jsonRpcUrl(){var a;return null!=(a=this._storage.getItem(ep))?a:void 0}set jsonRpcUrl(a){this._storage.setItem(ep,a)}updateProviderInfo(a,b){var c;this.jsonRpcUrl=a;let d=this.getChainId();this._storage.setItem(eo,b.toString(10)),dA(b)!==d&&(null==(c=this.callback)||c.call(this,"chainChanged",ds(b)))}async watchAsset(a){let b=Array.isArray(a)?a[0]:a;if(!b.type)throw c6("Type is required");if((null==b?void 0:b.type)!=="ERC20")throw c6(`Asset of type '${b.type}' is not supported`);if(!(null==b?void 0:b.options))throw c6("Options are required");if(!(null==b?void 0:b.options.address))throw c6("Address is required");let c=this.getChainId(),{address:d,symbol:e,image:f,decimals:g}=b.options,h=this.initializeRelay(),i=await h.watchAsset(b.type,d,e,g,f,null==c?void 0:c.toString());return!dZ(i)&&!!i.result}async addEthereumChain(a){var b,c;let d=a[0];if((null==(b=d.rpcUrls)?void 0:b.length)===0)throw c6("please pass in at least 1 rpcUrl");if(!d.chainName||""===d.chainName.trim())throw c6("chainName is a required field");if(!d.nativeCurrency)throw c6("nativeCurrency is a required field");let e=Number.parseInt(d.chainId,16);if(e===this.getChainId())return!1;let f=this.initializeRelay(),{rpcUrls:g=[],blockExplorerUrls:h=[],chainName:i,iconUrls:j=[],nativeCurrency:k}=d,l=await f.addEthereumChain(e.toString(),g,j,h,i,k);if(dZ(l))return!1;if((null==(c=l.result)?void 0:c.isApproved)===!0)return this.updateProviderInfo(g[0],e),null;throw c7("unable to add ethereum chain")}async switchEthereumChain(a){let b=Number.parseInt(a[0].chainId,16),c=this.initializeRelay(),d=await c.switchEthereumChain(b.toString(10),this.selectedAddress||void 0);if(dZ(d))throw d;let e=d.result;return e.isApproved&&e.rpcUrl.length>0&&this.updateProviderInfo(e.rpcUrl,b),null}async cleanup(){this.callback=null,this._relay&&this._relay.resetAndReload(),this._storage.clear()}_setAddresses(a,b){var c;if(!Array.isArray(a))throw Error("addresses is not an array");let d=a.map(a=>dy(a));JSON.stringify(d)!==JSON.stringify(this._addresses)&&(this._addresses=d,null==(c=this.callback)||c.call(this,"accountsChanged",d),this._storage.setItem(dY,d.join(" ")))}async request(a){let b=a.params||[];switch(a.method){case"eth_accounts":return[...this._addresses];case"eth_coinbase":return this.selectedAddress||null;case"net_version":return this.getChainId().toString(10);case"eth_chainId":return ds(this.getChainId());case"eth_requestAccounts":return this._eth_requestAccounts();case"eth_ecRecover":case"personal_ecRecover":return this.ecRecover(a);case"personal_sign":return this.personalSign(a);case"eth_signTransaction":return this._eth_signTransaction(b);case"eth_sendRawTransaction":return this._eth_sendRawTransaction(b);case"eth_sendTransaction":return this._eth_sendTransaction(b);case"eth_signTypedData_v1":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":return this.signTypedData(a);case"wallet_addEthereumChain":return this.addEthereumChain(b);case"wallet_switchEthereumChain":return this.switchEthereumChain(b);case"wallet_watchAsset":return this.watchAsset(b);default:if(!this.jsonRpcUrl)throw c7("No RPC URL set for chain");return dR(a,this.jsonRpcUrl)}}_ensureKnownAddress(a){let b=dy(a);if(!this._addresses.map(a=>dy(a)).includes(b))throw Error("Unknown Ethereum address")}_prepareTransactionParams(a){let b=a.from?dy(a.from):this.selectedAddress;if(!b)throw Error("Ethereum address is unavailable");this._ensureKnownAddress(b);let c=a.to?dy(a.to):null,d=null!=a.value?dB(a.value):BigInt(0),e=a.data?dz(a.data):Buffer.alloc(0),f=null!=a.nonce?dA(a.nonce):null,g=null!=a.gasPrice?dB(a.gasPrice):null,h=null!=a.maxFeePerGas?dB(a.maxFeePerGas):null,i=null!=a.maxPriorityFeePerGas?dB(a.maxPriorityFeePerGas):null;return{fromAddress:b,toAddress:c,weiValue:d,data:e,nonce:f,gasPriceInWei:g,maxFeePerGas:h,maxPriorityFeePerGas:i,gasLimit:null!=a.gas?dB(a.gas):null,chainId:a.chainId?dA(a.chainId):this.getChainId()}}async ecRecover(a){let{method:b,params:c}=a;if(!Array.isArray(c))throw c6();let d=this.initializeRelay(),e=await d.sendRequest({method:"ethereumAddressFromSignedMessage",params:{message:dq(c[0]),signature:dq(c[1]),addPrefix:"personal_ecRecover"===b}});if(dZ(e))throw e;return e.result}getChainId(){var a;return Number.parseInt(null!=(a=this._storage.getItem(eo))?a:"1",10)}async _eth_requestAccounts(){var a,b;if(this._addresses.length>0)return null==(a=this.callback)||a.call(this,"connect",{chainId:ds(this.getChainId())}),this._addresses;let c=this.initializeRelay(),d=await c.requestEthereumAccounts();if(dZ(d))throw d;if(!d.result)throw Error("accounts received is empty");return this._setAddresses(d.result),null==(b=this.callback)||b.call(this,"connect",{chainId:ds(this.getChainId())}),this._addresses}async personalSign({params:a}){if(!Array.isArray(a))throw c6();let b=a[1],c=a[0];this._ensureKnownAddress(b);let d=this.initializeRelay(),e=await d.sendRequest({method:"signEthereumMessage",params:{address:dy(b),message:dq(c),addPrefix:!0,typedDataJson:null}});if(dZ(e))throw e;return e.result}async _eth_signTransaction(a){let b=this._prepareTransactionParams(a[0]||{}),c=this.initializeRelay(),d=await c.signEthereumTransaction(b);if(dZ(d))throw d;return d.result}async _eth_sendRawTransaction(a){let b=dz(a[0]),c=this.initializeRelay(),d=await c.submitEthereumTransaction(b,this.getChainId());if(dZ(d))throw d;return d.result}async _eth_sendTransaction(a){let b=this._prepareTransactionParams(a[0]||{}),c=this.initializeRelay(),d=await c.signAndSubmitEthereumTransaction(b);if(dZ(d))throw d;return d.result}async signTypedData(a){let{method:b,params:c}=a;if(!Array.isArray(c))throw c6();let d=c[+("eth_signTypedData_v1"===b)],e=c[+("eth_signTypedData_v1"!==b)];this._ensureKnownAddress(d);let f=this.initializeRelay(),g=await f.sendRequest({method:"signEthereumMessage",params:{address:dy(d),message:dp(({eth_signTypedData_v1:dX.default.hashForSignTypedDataLegacy,eth_signTypedData_v3:dX.default.hashForSignTypedData_v3,eth_signTypedData_v4:dX.default.hashForSignTypedData_v4,eth_signTypedData:dX.default.hashForSignTypedData_v4})[b]({data:function(a){if("string"==typeof a)return JSON.parse(a);if("object"==typeof a)return a;throw c6(`Not a JSON string or an object: ${String(a)}`)}(e)}),!0),typedDataJson:JSON.stringify(e,null,2),addPrefix:!1}});if(dZ(g))throw g;return g.result}initializeRelay(){return this._relay||(this._relay=new en({linkAPIUrl:el,storage:this._storage,metadata:this.metadata,accountsCallback:this._setAddresses.bind(this),chainCallback:this.updateProviderInfo.bind(this)})),this._relay}}let er="SignerType",es=new cV("CBWSDK","SignerConfigurator");async function et(a){let{communicator:b,metadata:c,handshakeRequest:d,callback:e}=a;eu(b,c,e).catch(()=>{});let f={id:crypto.randomUUID(),event:"selectSignerType",data:Object.assign(Object.assign({},a.preference),{handshakeRequest:d})},{data:g}=await b.postRequestAndWaitForResponse(f);return g}async function eu(a,b,c){await a.onMessage(({event:a})=>"WalletLinkSessionRequest"===a);let d=new eq({metadata:b,callback:c});a.postMessage({event:"WalletLinkUpdate",data:{session:d.getSession()}}),await d.handshake(),a.postMessage({event:"WalletLinkUpdate",data:{connected:!0}})}let{checkCrossOriginOpenerPolicy:ev,getCrossOriginOpenerPolicy:ew}={getCrossOriginOpenerPolicy:()=>void 0===q?"undefined":q,checkCrossOriginOpenerPolicy:async()=>{q="non-browser-env"}},ex={isRed:!1,info:"Retry",svgWidth:"10",svgHeight:"11",path:eh,defaultFillRule:"evenodd",defaultClipRule:"evenodd"},ey=null;class ez{constructor({url:a="https://keys.coinbase.com/connect",metadata:b,preference:c}){this.popup=null,this.listeners=new Map,this.postMessage=async a=>{(await this.waitForPopupLoaded()).postMessage(a,this.url.origin)},this.postRequestAndWaitForResponse=async a=>{let b=this.onMessage(({requestId:b})=>b===a.id);return this.postMessage(a),await b},this.onMessage=async a=>new Promise((b,c)=>{let d=c=>{if(c.origin!==this.url.origin)return;let e=c.data;a(e)&&(b(e),window.removeEventListener("message",d),this.listeners.delete(d))};window.addEventListener("message",d),this.listeners.set(d,{reject:c})}),this.disconnect=()=>{var a;(a=this.popup)&&!a.closed&&a.close(),this.popup=null,this.listeners.forEach(({reject:a},b)=>{a(c8("Request rejected")),window.removeEventListener("message",b)}),this.listeners.clear()},this.waitForPopupLoaded=async()=>this.popup&&!this.popup.closed?(this.popup.focus(),this.popup):(this.popup=await function(a){let b=(window.innerWidth-420)/2+window.screenX,c=(window.innerHeight-540)/2+window.screenY;function d(){let d=`wallet_${crypto.randomUUID()}`,e=window.open(a,d,`width=420, height=540, left=${b}, top=${c}`);return(null==e||e.focus(),e)?e:null}var e=a;for(let[a,b]of Object.entries({sdkName:dQ,sdkVersion:dP,origin:window.location.origin,coop:ew()}))e.searchParams.append(a,b.toString());let f=d();if(!f){let a=function(){if(!ey){let a=document.createElement("div");a.className="-cbwsdk-css-reset",document.body.appendChild(a),(ey=new ee).attach(a)}return ey}();return new Promise((b,c)=>{a.presentItem({autoExpand:!0,message:"Popup was blocked. Try again.",menuItems:[Object.assign(Object.assign({},ex),{onClick:()=>{(f=d())?b(f):c(c7("Popup window was blocked")),a.clear()}})]})})}return Promise.resolve(f)}(this.url),this.onMessage(({event:a})=>"PopupUnload"===a).then(this.disconnect).catch(()=>{}),this.onMessage(({event:a})=>"PopupLoaded"===a).then(a=>{this.postMessage({requestId:a.id,data:{version:dP,metadata:this.metadata,preference:this.preference,location:window.location.toString()}})}).then(()=>{if(!this.popup)throw c7();return this.popup})),this.url=new URL(a),this.metadata=b,this.preference=c}}var eA=a.i(627613);class eB extends eA.EventEmitter{}var eC=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};class eD extends eB{constructor(a){var{metadata:b}=a,c=a.preference,{keysUrl:d}=c,e=eC(c,["keysUrl"]);super(),this.signer=null,this.isCoinbaseWallet=!0,this.metadata=b,this.preference=e,this.communicator=new ez({url:d,metadata:b,preference:e});const f=es.getItem(er);f&&(this.signer=this.initSigner(f))}async request(a){try{if(!function(a){if(!a||"object"!=typeof a||Array.isArray(a))throw c6({message:"Expected a single, non-array, object argument.",data:a});let{method:b,params:c}=a;if("string"!=typeof b||0===b.length)throw c6({message:"'args.method' must be a non-empty string.",data:a});if(void 0!==c&&!Array.isArray(c)&&("object"!=typeof c||null===c))throw c6({message:"'args.params' must be an object or array if provided.",data:a});switch(b){case"eth_sign":case"eth_signTypedData_v2":case"eth_subscribe":case"eth_unsubscribe":throw da()}}(a),!this.signer)switch(a.method){case"eth_requestAccounts":{let b=await this.requestSignerSelection(a),c=this.initSigner(b);await c.handshake(a),this.signer=c,es.setItem(er,b);break}case"wallet_sendCalls":{let b=this.initSigner("scw");await b.handshake({method:"handshake"});let c=await b.request(a);return await b.cleanup(),c}case"wallet_getCallsStatus":return dR(a,"https://rpc.wallet.coinbase.com");case"net_version":return 1;case"eth_chainId":return ds(1);default:throw c9("Must call 'eth_requestAccounts' before other methods")}return await this.signer.request(a)}catch(d){let a,b,{code:c}=d;return c===cZ&&this.disconnect(),Promise.reject((a=function(a,{shouldIncludeStack:b=!1}={}){var c,d;let e={};if(a&&"object"==typeof a&&!Array.isArray(a)&&c4(a,"code")&&Number.isInteger(c=a.code)&&(c0[c.toString()]||(d=c)>=-32099&&d<=-32e3))e.code=a.code,a.message&&"string"==typeof a.message?(e.message=a.message,c4(a,"data")&&(e.data=a.data)):(e.message=c2(e.code),e.data={originalError:c3(a)});else e.code=cX,e.message=c5(a,"message")?a.message:c1,e.data={originalError:c3(a)};return b&&(e.stack=c5(a,"stack")?a.stack:void 0),e}(function(a){var b;if("string"==typeof a)return{message:a,code:cX};if(dZ(a)){let c=a.errorMessage,d=null!=(b=a.errorCode)?b:c.match(/(denied|rejected)/i)?cY:void 0;return Object.assign(Object.assign({},a),{message:c,code:d,data:{method:a.method}})}return a}(d),{shouldIncludeStack:!0}),(b=new URL("https://docs.cloud.coinbase.com/wallet-sdk/docs/errors")).searchParams.set("version",dP),b.searchParams.set("code",a.code.toString()),b.searchParams.set("message",a.message),Object.assign(Object.assign({},a),{docUrl:b.href})))}}async enable(){return console.warn('.enable() has been deprecated. Please use .request({ method: "eth_requestAccounts" }) instead.'),await this.request({method:"eth_requestAccounts"})}async disconnect(){var a;await (null==(a=this.signer)?void 0:a.cleanup()),this.signer=null,cV.clearAll(),this.emit("disconnect",db("User initiated disconnection"))}requestSignerSelection(a){return et({communicator:this.communicator,preference:this.preference,metadata:this.metadata,handshakeRequest:a,callback:this.emit.bind(this)})}initSigner(a){return function(a){let{signerType:b,metadata:c,communicator:d,callback:e}=a;switch(b){case"scw":return new dW({metadata:c,callback:e,communicator:d});case"walletlink":return new eq({metadata:c,callback:e})}}({signerType:a,metadata:this.metadata,communicator:this.communicator,callback:this.emit.bind(this)})}}let eE={options:"all"};function eF(a){new cV("CBWSDK").setItem("VERSION",dP),ev();let b={metadata:{appName:a.appName||"Dapp",appLogoUrl:a.appLogoUrl||"",appChainIds:a.appChainIds||[]},preference:Object.assign(eE,null!=(c=a.preference)?c:{})};var c,d=b.preference;if(d){if(!["all","smartWalletOnly","eoaOnly"].includes(d.options))throw Error(`Invalid options: ${d.options}`);if(d.attribution&&void 0!==d.attribution.auto&&void 0!==d.attribution.dataSuffix)throw Error("Attribution cannot contain both auto and dataSuffix properties")}let e=null;return{getProvider:()=>{var a;let c;return e||(e=null!=(a=function({metadata:a,preference:b}){var c,d;let{appName:e,appLogoUrl:f,appChainIds:g}=a;if("smartWalletOnly"!==b.options){let a=globalThis.coinbaseWalletExtension;if(a)return null==(c=a.setAppInfo)||c.call(a,e,f,g,b),a}let h=function(){var a,b;try{let c=globalThis;return null!=(a=c.ethereum)?a:null==(b=c.top)?void 0:b.ethereum}catch(a){return}}();if(null==h?void 0:h.isCoinbaseBrowser)return null==(d=h.setAppInfo)||d.call(h,e,f,g,b),h}(c={metadata:b.metadata,preference:b.preference}))?a:new eD(c)),e}}}var eG=a.i(967107),eH=a.i(597946),eI=a.i(877069),eJ=a.i(834778),eK=a.i(385853),eL=a.i(277219),eM=a.i(669957),eN=a.i(767139),eO=a.i(47002);let eP="/api/v1/sessions",eQ="/api/v1/sessions/logout",eR="/api/v1/siwe/init",eS="/api/v1/siwe/authenticate",eT="/api/v1/siwe/link",eU="/api/v1/siwe/link_smart_wallet",eV="/api/v1/siwe/unlink",eW="/api/v1/siwe/transfer",eX="/api/v1/siws/init",eY="/api/v1/siws/authenticate",eZ="/api/v1/siws/link",e$="/api/v1/siws/unlink",e_="/api/v1/siws/transfer",e0="/api/v1/farcaster/init",e1="/api/v1/farcaster/authenticate",e2="/api/v1/farcaster/link",e3="/api/v1/farcaster/status",e4="/api/v1/farcaster/unlink",e5="/api/v1/farcaster/transfer",e6="/api/v1/passwordless/init",e7="/api/v1/passwordless/authenticate",e8="/api/v1/passwordless/link",e9="/api/v1/passwordless/unlink",fa="/api/v1/passwordless/update",fb="/api/v1/passwordless/transfer",fc="/api/v1/passwordless_sms/init",fd="/api/v1/passwordless_sms/link",fe="/api/v1/passwordless_sms/unlink",ff="/api/v1/passwordless_sms/authenticate",fg="/api/v1/passwordless_sms/update",fh="/api/v1/passwordless_sms/transfer",fi="/api/v1/oauth/init",fj="/api/v1/oauth/authenticate",fk="/api/v1/oauth/link",fl="/api/v1/oauth/unlink",fm="/api/v1/oauth/transfer",fn="/api/v1/passkeys/link/init",fo="/api/v1/passkeys/authenticate/init",fp="/api/v1/passkeys/register/init",fq="/api/v1/passkeys/link",fr="/api/v1/passkeys/authenticate",fs="/api/v1/passkeys/register",ft="/api/v1/telegram/authenticate",fu="/api/v1/telegram/link",fv="/api/v1/telegram/unlink",fw="/api/v1/telegram/transfer",fx="/api/v1/mfa/passwordless_sms/init",fy="/api/v1/mfa/passkeys/init",fz="/api/v1/users/me/accept_terms",fA="/api/v1/analytics_events",fB="/api/v1/custom_jwt_account/authenticate",fC="/api/v1/custom_jwt_account/link",fD="/api/v1/guest/authenticate",fE="/api/v1/plugins/moonpay_on_ramp/sign",fF="/api/v1/funding/coinbase_on_ramp/init",fG="/api/v1/funding/coinbase_on_ramp/status",fH="/api/v1/wallets/revoke",fI="/api/v1/users/me",fJ="/api/v1/scan/transaction";a.s(["$",()=>eW,"A",()=>eQ,"B",()=>fA,"C",()=>fD,"D",()=>fx,"E",()=>fy,"F",()=>fz,"G",()=>e9,"H",()=>fe,"I",()=>eV,"J",()=>e$,"K",()=>fl,"L",()=>e4,"M",()=>fv,"N",()=>fH,"O",()=>fE,"P",()=>fF,"Q",()=>fG,"R",()=>eR,"S",()=>eS,"T",()=>eT,"U",()=>eU,"V",()=>eX,"W",()=>eY,"X",()=>fm,"Y",()=>e_,"Z",()=>fw,"_",()=>e5,"a",()=>e8,"a0",()=>fh,"a1",()=>fb,"a2",()=>eZ,"a3",()=>fI,"a4",()=>fJ,"a5",()=>"api/v2/farcaster/init","a6",()=>"api/v2/farcaster/authenticate","a8",()=>"/api/v1/recovery/oauth/authenticate","a9",()=>"/api/v1/recovery/oauth/init_icloud","aa",()=>"/api/v1/recovery/oauth/init","b",()=>e6,"c",()=>e2,"d",()=>e0,"e",()=>e3,"f",()=>e1,"g",()=>fk,"h",()=>fi,"i",()=>fs,"j",()=>fr,"k",()=>fq,"l",()=>fp,"m",()=>fo,"n",()=>fn,"o",()=>fj,"p",()=>e7,"q",()=>ff,"r",()=>fd,"s",()=>fc,"t",()=>fg,"u",()=>fa,"v",()=>ft,"w",()=>fu,"x",()=>fB,"y",()=>fC,"z",()=>eP],894155);var fK=a.i(335831),fL=a.i(59345),fM=a.i(271789),fN=a.i(603511),fO=a.i(473382);function fP(a){"function"==typeof queueMicrotask?queueMicrotask(a):Promise.resolve().then(a).catch(a=>setTimeout(()=>{throw a}))}function fQ(){let a=[],b={addEventListener:(a,c,d,e)=>(a.addEventListener(c,d,e),b.add(()=>a.removeEventListener(c,d,e))),requestAnimationFrame(...a){let c=requestAnimationFrame(...a);return b.add(()=>cancelAnimationFrame(c))},nextFrame:(...a)=>b.requestAnimationFrame(()=>b.requestAnimationFrame(...a)),setTimeout(...a){let c=setTimeout(...a);return b.add(()=>clearTimeout(c))},microTask(...a){let c={current:!0};return fP(()=>{c.current&&a[0]()}),b.add(()=>{c.current=!1})},style(a,b,c){let d=a.style.getPropertyValue(b);return Object.assign(a.style,{[b]:c}),this.add(()=>{Object.assign(a.style,{[b]:d})})},group(a){let b=fQ();return a(b),this.add(()=>b.dispose())},add:b=>(a.includes(b)||a.push(b),()=>{let c=a.indexOf(b);if(c>=0)for(let b of a.splice(c,1))b()}),dispose(){for(let b of a.splice(0))b()}};return b}function fR(){let[a]=(0,S.useState)(fQ);return(0,S.useEffect)(()=>()=>a.dispose(),[a]),a}a.s(["disposables",()=>fQ],351199),a.s(["useDisposables",()=>fR],725600);var fS=Object.defineProperty,fT=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?fS(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c,c};let fU=new class{constructor(){fT(this,"current",this.detect()),fT(this,"handoffState","pending"),fT(this,"currentId",0)}set(a){this.current!==a&&(this.handoffState="pending",this.currentId=0,this.current=a)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return"server"===this.current}get isClient(){return"client"===this.current}detect(){return"server"}handoff(){"pending"===this.handoffState&&(this.handoffState="complete")}get isHandoffComplete(){return"complete"===this.handoffState}},fV=(a,b)=>{fU.isServer?(0,S.useEffect)(a,b):(0,S.useLayoutEffect)(a,b)};function fW(a){let b=(0,S.useRef)(a);return fV(()=>{b.current=a},[a]),b}a.s(["useIsoMorphicEffect",()=>fV],652294);let fX=function(a){let b=fW(a);return S.default.useCallback((...a)=>b.current(...a),[b])};function fY(){let a=(0,S.useRef)(!1);return fV(()=>(a.current=!0,()=>{a.current=!1}),[]),a}function fZ(){let a,b=(a="undefined"==typeof document,"useSyncExternalStore"in S&&(0,S.useSyncExternalStore)(()=>()=>{},()=>!1,()=>!a)),[c,d]=S.useState(fU.isHandoffComplete);return c&&!1===fU.isHandoffComplete&&d(!1),S.useEffect(()=>{!0!==c&&d(!0)},[c]),S.useEffect(()=>fU.handoff(),[]),!b&&c}a.s(["useEvent",()=>fX],446409);let f$=Symbol();function f_(a,b=!0){return Object.assign(a,{[f$]:b})}function f0(...a){let b=(0,S.useRef)(a);(0,S.useEffect)(()=>{b.current=a},[a]);let c=fX(a=>{for(let c of b.current)null!=c&&("function"==typeof c?c(a):c.current=a)});return a.every(a=>null==a||(null==a?void 0:a[f$]))?void 0:c}a.s(["optionalRef",()=>f_,"useSyncRefs",()=>f0],299407),"undefined"!=typeof process&&"undefined"!=typeof globalThis&&"undefined"!=typeof Element&&(null==(Ee=null==process?void 0:process.env)?void 0:Ee.NODE_ENV)==="test"&&void 0===(null==(Ef=null==Element?void 0:Element.prototype)?void 0:Ef.getAnimations)&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var f1=((r=f1||{})[r.None=0]="None",r[r.Closed=1]="Closed",r[r.Enter=2]="Enter",r[r.Leave=4]="Leave",r);function f2(a){let b={};for(let c in a)!0===a[c]&&(b[`data-${c}`]="");return b}function f3(a,b,c,d){let[e,f]=(0,S.useState)(c),{hasFlag:g,addFlag:h,removeFlag:i}=function(a=0){let[b,c]=(0,S.useState)(a),d=(0,S.useCallback)(a=>c(a),[]),e=(0,S.useCallback)(a=>c(b=>b|a),[]),f=(0,S.useCallback)(a=>(b&a)===a,[b]);return{flags:b,setFlag:d,addFlag:e,hasFlag:f,removeFlag:(0,S.useCallback)(a=>c(b=>b&~a),[]),toggleFlag:(0,S.useCallback)(a=>c(b=>b^a),[])}}(a&&e?3:0),j=(0,S.useRef)(!1),k=(0,S.useRef)(!1);return fV(()=>{var e;if(a){if(c&&f(!0),!b){c&&h(3);return}return null==(e=null==d?void 0:d.start)||e.call(d,c),function(a,{prepare:b,run:c,done:d,inFlight:e}){let f=fQ();return function(a,{inFlight:b,prepare:c}){if(null!=b&&b.current)return c();let d=a.style.transition;a.style.transition="none",c(),a.offsetHeight,a.style.transition=d}(a,{prepare:b,inFlight:e}),f.nextFrame(()=>{c(),f.requestAnimationFrame(()=>{f.add(function(a,b){var c,d;let e=fQ();if(!a)return e.dispose;let f=!1;e.add(()=>{f=!0});let g=null!=(d=null==(c=a.getAnimations)?void 0:c.call(a).filter(a=>a instanceof CSSTransition))?d:[];return 0===g.length?b():Promise.allSettled(g.map(a=>a.finished)).then(()=>{f||b()}),e.dispose}(a,d))})}),f.dispose}(b,{inFlight:j,prepare(){k.current?k.current=!1:k.current=j.current,j.current=!0,k.current||(c?(h(3),i(4)):(h(4),i(2)))},run(){k.current?c?(i(3),h(4)):(i(4),h(3)):c?i(1):h(1)},done(){var a,e,g,h;k.current&&(null!=(h=null==(g=(e=b).getAnimations)?void 0:g.call(e))?h:[]).some(a=>a instanceof CSSTransition&&"finished"!==a.playState)||(j.current=!1,i(7),c||f(!1),null==(a=null==d?void 0:d.end)||a.call(d,c))}})}},[a,c,b,fR()]),a?[e,{closed:g(1),enter:g(2),leave:g(4),transition:g(2)||g(4)}]:[c,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}a.s(["transitionDataAttributes",()=>f2,"useTransition",()=>f3],90598);let f4=(0,S.createContext)(null);f4.displayName="OpenClosedContext";var f5=((s=f5||{})[s.Open=1]="Open",s[s.Closed=2]="Closed",s[s.Closing=4]="Closing",s[s.Opening=8]="Opening",s);function f6(){return(0,S.useContext)(f4)}function f7({value:a,children:b}){return S.default.createElement(f4.Provider,{value:a},b)}function f8({children:a}){return S.default.createElement(f4.Provider,{value:null},a)}function f9(...a){return Array.from(new Set(a.flatMap(a=>"string"==typeof a?a.split(" "):[]))).filter(Boolean).join(" ")}function ga(a,b,...c){if(a in b){let d=b[a];return"function"==typeof d?d(...c):d}let d=Error(`Tried to handle "${a}" but there is no handler defined. Only defined handlers are: ${Object.keys(b).map(a=>`"${a}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(d,ga),d}a.s(["OpenClosedProvider",()=>f7,"ResetOpenClosedProvider",()=>f8,"State",()=>f5,"useOpenClosed",()=>f6],912937),a.s(["match",()=>ga],490646);var gb=((t=gb||{})[t.None=0]="None",t[t.RenderStrategy=1]="RenderStrategy",t[t.Static=2]="Static",t),gc=((u=gc||{})[u.Unmount=0]="Unmount",u[u.Hidden=1]="Hidden",u);function gd(){let a,b,c=(a=(0,S.useRef)([]),b=(0,S.useCallback)(b=>{for(let c of a.current)null!=c&&("function"==typeof c?c(b):c.current=b)},[]),(...c)=>{if(!c.every(a=>null==a))return a.current=c,b});return(0,S.useCallback)(a=>(function({ourProps:a,theirProps:b,slot:c,defaultTag:d,features:e,visible:f=!0,name:g,mergeRefs:h}){h=null!=h?h:gf;let i=gg(b,a);if(f)return ge(i,c,d,g,h);let j=null!=e?e:0;if(2&j){let{static:a=!1,...b}=i;if(a)return ge(b,c,d,g,h)}if(1&j){let{unmount:a=!0,...b}=i;return ga(+!a,{0:()=>null,1:()=>ge({...b,hidden:!0,style:{display:"none"}},c,d,g,h)})}return ge(i,c,d,g,h)})({mergeRefs:c,...a}),[c])}function ge(a,b={},c,d,e){let{as:f=c,children:g,refName:h="ref",...i}=gk(a,["unmount","static"]),j=void 0!==a.ref?{[h]:a.ref}:{},k="function"==typeof g?g(b):g;"className"in i&&i.className&&"function"==typeof i.className&&(i.className=i.className(b)),i["aria-labelledby"]&&i["aria-labelledby"]===i.id&&(i["aria-labelledby"]=void 0);let l={};if(b){let a=!1,c=[];for(let[d,e]of Object.entries(b))"boolean"==typeof e&&(a=!0),!0===e&&c.push(d.replace(/([A-Z])/g,a=>`-${a.toLowerCase()}`));if(a)for(let a of(l["data-headlessui-state"]=c.join(" "),c))l[`data-${a}`]=""}if(gl(f)&&(Object.keys(gj(i)).length>0||Object.keys(gj(l)).length>0))if(!(0,S.isValidElement)(k)||Array.isArray(k)&&k.length>1||gl(k.type)){if(Object.keys(gj(i)).length>0)throw Error(['Passing props on "Fragment"!',"",`The current component <${d} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(gj(i)).concat(Object.keys(gj(l))).map(a=>`  - ${a}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(a=>`  - ${a}`).join(`
`)].join(`
`))}else{var m;let a=k.props,b=null==a?void 0:a.className,c="function"==typeof b?(...a)=>f9(b(...a),i.className):f9(b,i.className),d=gg(k.props,gj(gk(i,["ref"])));for(let a in l)a in d&&delete l[a];return(0,S.cloneElement)(k,Object.assign({},d,l,j,{ref:e((m=k,S.default.version.split(".")[0]>="19"?m.props.ref:m.ref),j.ref)},c?{className:c}:{}))}return(0,S.createElement)(f,Object.assign({},gk(i,["ref"]),!gl(f)&&j,!gl(f)&&l),k)}function gf(...a){return a.every(a=>null==a)?void 0:b=>{for(let c of a)null!=c&&("function"==typeof c?c(b):c.current=b)}}function gg(...a){if(0===a.length)return{};if(1===a.length)return a[0];let b={},c={};for(let d of a)for(let a in d)a.startsWith("on")&&"function"==typeof d[a]?(null!=c[a]||(c[a]=[]),c[a].push(d[a])):b[a]=d[a];if(b.disabled||b["aria-disabled"])for(let a in c)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(a)&&(c[a]=[a=>{var b;return null==(b=null==a?void 0:a.preventDefault)?void 0:b.call(a)}]);for(let a in c)Object.assign(b,{[a](b,...d){for(let e of c[a]){if((b instanceof Event||(null==b?void 0:b.nativeEvent)instanceof Event)&&b.defaultPrevented)return;e(b,...d)}}});return b}function gh(...a){if(0===a.length)return{};if(1===a.length)return a[0];let b={},c={};for(let d of a)for(let a in d)a.startsWith("on")&&"function"==typeof d[a]?(null!=c[a]||(c[a]=[]),c[a].push(d[a])):b[a]=d[a];for(let a in c)Object.assign(b,{[a](...b){for(let d of c[a])null==d||d(...b)}});return b}function gi(a){var b;return Object.assign((0,S.forwardRef)(a),{displayName:null!=(b=a.displayName)?b:a.name})}function gj(a){let b=Object.assign({},a);for(let a in b)void 0===b[a]&&delete b[a];return b}function gk(a,b=[]){let c=Object.assign({},a);for(let a of b)a in c&&delete c[a];return c}function gl(a){return a===S.Fragment||a===Symbol.for("react.fragment")}function gm(a){var b;return!!(a.enter||a.enterFrom||a.enterTo||a.leave||a.leaveFrom||a.leaveTo)||!gl(null!=(b=a.as)?b:gs)||1===S.default.Children.count(a.children)}a.s(["RenderFeatures",()=>gb,"RenderStrategy",()=>gc,"compact",()=>gj,"forwardRefWithAs",()=>gi,"isFragment",()=>gl,"mergeProps",()=>gh,"useRender",()=>gd],614248);let gn=(0,S.createContext)(null);gn.displayName="TransitionContext";var go=((v=go||{}).Visible="visible",v.Hidden="hidden",v);let gp=(0,S.createContext)(null);function gq(a){return"children"in a?gq(a.children):a.current.filter(({el:a})=>null!==a.current).filter(({state:a})=>"visible"===a).length>0}function gr(a,b){let c=fW(a),d=(0,S.useRef)([]),e=fY(),f=fR(),g=fX((a,b=gc.Hidden)=>{let g=d.current.findIndex(({el:b})=>b===a);-1!==g&&(ga(b,{[gc.Unmount](){d.current.splice(g,1)},[gc.Hidden](){d.current[g].state="hidden"}}),f.microTask(()=>{var a;!gq(d)&&e.current&&(null==(a=c.current)||a.call(c))}))}),h=fX(a=>{let b=d.current.find(({el:b})=>b===a);return b?"visible"!==b.state&&(b.state="visible"):d.current.push({el:a,state:"visible"}),()=>g(a,gc.Unmount)}),i=(0,S.useRef)([]),j=(0,S.useRef)(Promise.resolve()),k=(0,S.useRef)({enter:[],leave:[]}),l=fX((a,c,d)=>{i.current.splice(0),b&&(b.chains.current[c]=b.chains.current[c].filter(([b])=>b!==a)),null==b||b.chains.current[c].push([a,new Promise(a=>{i.current.push(a)})]),null==b||b.chains.current[c].push([a,new Promise(a=>{Promise.all(k.current[c].map(([a,b])=>b)).then(()=>a())})]),"enter"===c?j.current=j.current.then(()=>null==b?void 0:b.wait.current).then(()=>d(c)):d(c)}),m=fX((a,b,c)=>{Promise.all(k.current[b].splice(0).map(([a,b])=>b)).then(()=>{var a;null==(a=i.current.shift())||a()}).then(()=>c(b))});return(0,S.useMemo)(()=>({children:d,register:h,unregister:g,onStart:l,onStop:m,wait:j,chains:k}),[h,g,d,l,m,k,j])}gp.displayName="NestingContext";let gs=S.Fragment,gt=gb.RenderStrategy,gu=gi(function(a,b){let{show:c,appear:d=!1,unmount:e=!0,...f}=a,g=(0,S.useRef)(null),h=f0(...gm(a)?[g,b]:null===b?[]:[b]);fZ();let i=f6();if(void 0===c&&null!==i&&(c=(i&f5.Open)===f5.Open),void 0===c)throw Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[j,k]=(0,S.useState)(c?"visible":"hidden"),l=gr(()=>{c||k("hidden")}),[m,n]=(0,S.useState)(!0),o=(0,S.useRef)([c]);fV(()=>{!1!==m&&o.current[o.current.length-1]!==c&&(o.current.push(c),n(!1))},[o,c]);let p=(0,S.useMemo)(()=>({show:c,appear:d,initial:m}),[c,d,m]);fV(()=>{c?k("visible"):gq(l)||null===g.current||k("hidden")},[c,l]);let q={unmount:e},r=fX(()=>{var b;m&&n(!1),null==(b=a.beforeEnter)||b.call(a)}),s=fX(()=>{var b;m&&n(!1),null==(b=a.beforeLeave)||b.call(a)}),t=gd();return S.default.createElement(gp.Provider,{value:l},S.default.createElement(gn.Provider,{value:p},t({ourProps:{...q,as:S.Fragment,children:S.default.createElement(gv,{ref:h,...q,...f,beforeEnter:r,beforeLeave:s})},theirProps:{},defaultTag:S.Fragment,features:gt,visible:"visible"===j,name:"Transition"})))}),gv=gi(function(a,b){var c,d;let{transition:e=!0,beforeEnter:f,afterEnter:g,beforeLeave:h,afterLeave:i,enter:j,enterFrom:k,enterTo:l,entered:m,leave:n,leaveFrom:o,leaveTo:p,...q}=a,[r,s]=(0,S.useState)(null),t=(0,S.useRef)(null),u=gm(a),v=f0(...u?[t,b,s]:null===b?[]:[b]),w=null==(c=q.unmount)||c?gc.Unmount:gc.Hidden,{show:x,appear:y,initial:z}=function(){let a=(0,S.useContext)(gn);if(null===a)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return a}(),[A,B]=(0,S.useState)(x?"visible":"hidden"),C=function(){let a=(0,S.useContext)(gp);if(null===a)throw Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return a}(),{register:D,unregister:E}=C;fV(()=>D(t),[D,t]),fV(()=>{if(w===gc.Hidden&&t.current)return x&&"visible"!==A?void B("visible"):ga(A,{hidden:()=>E(t),visible:()=>D(t)})},[A,t,D,E,x,w]);let F=fZ();fV(()=>{if(u&&F&&"visible"===A&&null===t.current)throw Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[t,A,F,u]);let G=z&&!y,H=y&&x&&z,I=(0,S.useRef)(!1),J=gr(()=>{I.current||(B("hidden"),E(t))},C),K=fX(a=>{I.current=!0,J.onStart(t,a?"enter":"leave",a=>{"enter"===a?null==f||f():"leave"===a&&(null==h||h())})}),L=fX(a=>{let b=a?"enter":"leave";I.current=!1,J.onStop(t,b,a=>{"enter"===a?null==g||g():"leave"===a&&(null==i||i())}),"leave"!==b||gq(J)||(B("hidden"),E(t))});(0,S.useEffect)(()=>{u&&e||(K(x),L(x))},[x,u,e]);let[,M]=f3(!(!e||!u||!F||G),r,x,{start:K,end:L}),N=gj({ref:v,className:(null==(d=f9(q.className,H&&j,H&&k,M.enter&&j,M.enter&&M.closed&&k,M.enter&&!M.closed&&l,M.leave&&n,M.leave&&!M.closed&&o,M.leave&&M.closed&&p,!M.transition&&x&&m))?void 0:d.trim())||void 0,...f2(M)}),O=0;"visible"===A&&(O|=f5.Open),"hidden"===A&&(O|=f5.Closed),x&&"hidden"===A&&(O|=f5.Opening),x||"visible"!==A||(O|=f5.Closing);let P=gd();return S.default.createElement(gp.Provider,{value:J},S.default.createElement(f7,{value:O},P({ourProps:N,theirProps:q,defaultTag:gs,features:gt,visible:"visible"===A,name:"Transition.Child"})))}),gw=gi(function(a,b){let c=null!==(0,S.useContext)(gn),d=null!==f6();return S.default.createElement(S.default.Fragment,null,!c&&d?S.default.createElement(gu,{ref:b,...a}):S.default.createElement(gv,{ref:b,...a}))}),gx=Object.assign(gu,{Child:gw,Root:gu});var gy=((w=gy||{}).Space=" ",w.Enter="Enter",w.Escape="Escape",w.Backspace="Backspace",w.Delete="Delete",w.ArrowLeft="ArrowLeft",w.ArrowUp="ArrowUp",w.ArrowRight="ArrowRight",w.ArrowDown="ArrowDown",w.Home="Home",w.End="End",w.PageUp="PageUp",w.PageDown="PageDown",w.Tab="Tab",w);function gz(a,b,c,d){let e=fW(c);(0,S.useEffect)(()=>{function c(a){e.current(a)}return(a=null!=a?a:window).addEventListener(b,c,d),()=>a.removeEventListener(b,c,d)},[a,b,d])}a.s(["Keys",()=>gy],938379);class gA extends Map{constructor(a){super(),this.factory=a}get(a){let b=super.get(a);return void 0===b&&(b=this.factory(a),this.set(a,b)),b}}var gB=Object.defineProperty,gC=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot "+c)},gD=(a,b,c)=>(gC(a,b,"read from private field"),c?c.call(a):b.get(a)),gE=(a,b,c)=>{if(b.has(a))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(a):b.set(a,c)},gF=(a,b,c,d)=>(gC(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c);class gG{constructor(a){gE(this,Eg,{}),gE(this,Eh,new gA(()=>new Set)),gE(this,Ei,new Set),((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gB(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"disposables",fQ()),gF(this,Eg,a),fU.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return gD(this,Eg)}subscribe(a,b){if(fU.isServer)return()=>{};let c={selector:a,callback:b,current:a(gD(this,Eg))};return gD(this,Ei).add(c),this.disposables.add(()=>{gD(this,Ei).delete(c)})}on(a,b){return fU.isServer?()=>{}:(gD(this,Eh).get(a).add(b),this.disposables.add(()=>{gD(this,Eh).get(a).delete(b)}))}send(a){let b=this.reduce(gD(this,Eg),a);if(b!==gD(this,Eg)){for(let a of(gF(this,Eg,b),gD(this,Ei))){let b=a.selector(gD(this,Eg));gH(a.current,b)||(a.current=b,a.callback(b))}for(let b of gD(this,Eh).get(a.type))b(gD(this,Eg),a)}}}function gH(a,b){return!!Object.is(a,b)||"object"==typeof a&&null!==a&&"object"==typeof b&&null!==b&&(Array.isArray(a)&&Array.isArray(b)?a.length===b.length&&gI(a[Symbol.iterator](),b[Symbol.iterator]()):a instanceof Map&&b instanceof Map||a instanceof Set&&b instanceof Set?a.size===b.size&&gI(a.entries(),b.entries()):!!(gJ(a)&&gJ(b))&&gI(Object.entries(a)[Symbol.iterator](),Object.entries(b)[Symbol.iterator]()))}function gI(a,b){for(;;){let c=a.next(),d=b.next();if(c.done&&d.done)return!0;if(c.done||d.done||!Object.is(c.value,d.value))return!1}}function gJ(a){if("[object Object]"!==Object.prototype.toString.call(a))return!1;let b=Object.getPrototypeOf(a);return null===b||null===Object.getPrototypeOf(b)}function gK(a){let[b,c]=a(),d=fQ();return(...a)=>{b(...a),d.dispose(),d.microTask(c)}}Eg=new WeakMap,Eh=new WeakMap,Ei=new WeakMap,a.s(["Machine",()=>gG,"batch",()=>gK,"shallowEqual",()=>gH],109700);var gL=Object.defineProperty,gM=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?gL(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c,c},gN=((x=gN||{})[x.Push=0]="Push",x[x.Pop=1]="Pop",x);let gO={0(a,b){let c=b.id,d=a.stack,e=a.stack.indexOf(c);if(-1!==e){let b=a.stack.slice();return b.splice(e,1),b.push(c),d=b,{...a,stack:d}}return{...a,stack:[...a.stack,c]}},1(a,b){let c=b.id,d=a.stack.indexOf(c);if(-1===d)return a;let e=a.stack.slice();return e.splice(d,1),{...a,stack:e}}};class gP extends gG{constructor(){super(...arguments),gM(this,"actions",{push:a=>this.send({type:0,id:a}),pop:a=>this.send({type:1,id:a})}),gM(this,"selectors",{isTop:(a,b)=>a.stack[a.stack.length-1]===b,inStack:(a,b)=>a.stack.includes(b)})}static new(){return new gP({stack:[]})}reduce(a,b){return ga(b.type,gO,a,b)}}let gQ=new gA(()=>gP.new());a.s(["ActionTypes",()=>gN,"stackMachines",()=>gQ],952163);var gR=a.i(359707);function gS(a,b,c=gH){return(0,gR.useSyncExternalStoreWithSelector)(fX(b=>a.subscribe(gT,b)),fX(()=>a.state),fX(()=>a.state),fX(b),c)}function gT(a){return a}function gU(a,b){let c=(0,S.useId)(),d=gQ.get(b),[e,f]=gS(d,(0,S.useCallback)(a=>[d.selectors.isTop(a,c),d.selectors.inStack(a,c)],[d,c]));return fV(()=>{if(a)return d.actions.push(c),()=>d.actions.pop(c)},[d,a,c]),!!a&&(!f||e)}function gV(a){var b;return fU.isServer?null:null==a?document:null!=(b=null==a?void 0:a.ownerDocument)?b:document}function gW(a){var b,c;return fU.isServer?null:null==a?document:null!=(c=null==(b=null==a?void 0:a.getRootNode)?void 0:b.call(a))?c:document}function gX(a){var b,c;return null!=(c=null==(b=gW(a))?void 0:b.activeElement)?c:null}function gY(a){return gX(a)===a}a.s(["useSlice",()=>gS],554819),a.s(["getActiveElement",()=>gX,"getOwnerDocument",()=>gV,"getRootNode",()=>gW,"isActiveElement",()=>gY],202130);let gZ=new Map,g$=new Map;function g_(a){var b;let c=null!=(b=g$.get(a))?b:0;return g$.set(a,c+1),0!==c||(gZ.set(a,{"aria-hidden":a.getAttribute("aria-hidden"),inert:a.inert}),a.setAttribute("aria-hidden","true"),a.inert=!0),()=>(function(a){var b;let c=null!=(b=g$.get(a))?b:1;if(1===c?g$.delete(a):g$.set(a,c-1),1!==c)return;let d=gZ.get(a);d&&(null===d["aria-hidden"]?a.removeAttribute("aria-hidden"):a.setAttribute("aria-hidden",d["aria-hidden"]),a.inert=d.inert,gZ.delete(a))})(a)}function g0(a,{allowed:b,disallowed:c}={}){let d=gU(a,"inert-others");fV(()=>{var a,e;if(!d)return;let f=fQ();for(let b of null!=(a=null==c?void 0:c())?a:[])b&&f.add(g_(b));let g=null!=(e=null==b?void 0:b())?e:[];for(let a of g){if(!a)continue;let b=gV(a);if(!b)continue;let c=a.parentElement;for(;c&&c!==b.body;){for(let a of c.children)g.some(b=>a.contains(b))||f.add(g_(a));c=c.parentElement}}return f.dispose},[d,b,c])}function g1(a){return"object"==typeof a&&null!==a&&"nodeType"in a}function g2(a){return g1(a)&&"tagName"in a}function g3(a){return g2(a)&&"accessKey"in a}function g4(a){return g2(a)&&"tabIndex"in a}function g5(a){return g2(a)&&"style"in a}function g6(a){return g3(a)&&"IFRAME"===a.nodeName}function g7(a){return g3(a)&&"INPUT"===a.nodeName}function g8(a){return g3(a)&&"LABEL"===a.nodeName}function g9(a){return g3(a)&&"FIELDSET"===a.nodeName}function ha(a){return g3(a)&&"LEGEND"===a.nodeName}function hb(a){return!!g2(a)&&a.matches('a[href],audio[controls],button,details,embed,iframe,img[usemap],input:not([type="hidden"]),label,select,textarea,video[controls]')}function hc(a,b,c){let d=fW(a=>{let b=a.getBoundingClientRect();0===b.x&&0===b.y&&0===b.width&&0===b.height&&c()});(0,S.useEffect)(()=>{if(!a)return;let c=null===b?null:g3(b)?b:b.current;if(!c)return;let e=fQ();if("undefined"!=typeof ResizeObserver){let a=new ResizeObserver(()=>d.current(c));a.observe(c),e.add(()=>a.disconnect())}if("undefined"!=typeof IntersectionObserver){let a=new IntersectionObserver(()=>d.current(c));a.observe(c),e.add(()=>a.disconnect())}return()=>e.dispose()},[b,d,a])}a.s(["useInertOthers",()=>g0],125966),a.s(["hasInlineStyle",()=>g5,"isElement",()=>g2,"isHTMLElement",()=>g3,"isHTMLFieldSetElement",()=>g9,"isHTMLIframeElement",()=>g6,"isHTMLInputElement",()=>g7,"isHTMLLabelElement",()=>g8,"isHTMLLegendElement",()=>ha,"isHTMLorSVGElement",()=>g4,"isInteractiveElement",()=>hb,"isNode",()=>g1],13723),a.s(["useOnDisappear",()=>hc],211298);let hd=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(a=>`${a}:not([tabindex='-1'])`).join(","),he=["[data-autofocus]"].map(a=>`${a}:not([tabindex='-1'])`).join(",");var hf=((y=hf||{})[y.First=1]="First",y[y.Previous=2]="Previous",y[y.Next=4]="Next",y[y.Last=8]="Last",y[y.WrapAround=16]="WrapAround",y[y.NoScroll=32]="NoScroll",y[y.AutoFocus=64]="AutoFocus",y),hg=((z=hg||{})[z.Error=0]="Error",z[z.Overflow=1]="Overflow",z[z.Success=2]="Success",z[z.Underflow=3]="Underflow",z),hh=((A=hh||{})[A.Previous=-1]="Previous",A[A.Next=1]="Next",A);function hi(a=document.body){return null==a?[]:Array.from(a.querySelectorAll(hd)).sort((a,b)=>Math.sign((a.tabIndex||Number.MAX_SAFE_INTEGER)-(b.tabIndex||Number.MAX_SAFE_INTEGER)))}var hj=((B=hj||{})[B.Strict=0]="Strict",B[B.Loose=1]="Loose",B);function hk(a,b=0){var c;return a!==(null==(c=gV(a))?void 0:c.body)&&ga(b,{0:()=>a.matches(hd),1(){let b=a;for(;null!==b;){if(b.matches(hd))return!0;b=b.parentElement}return!1}})}function hl(a){fQ().nextFrame(()=>{let b=gX(a);b&&g4(b)&&!hk(b,0)&&hn(a)})}var hm=((C=hm||{})[C.Keyboard=0]="Keyboard",C[C.Mouse=1]="Mouse",C);function hn(a){null==a||a.focus({preventScroll:!0})}function ho(a,b=a=>a){return a.slice().sort((a,c)=>{let d=b(a),e=b(c);if(null===d||null===e)return 0;let f=d.compareDocumentPosition(e);return f&Node.DOCUMENT_POSITION_FOLLOWING?-1:f&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function hp(a,b,c=null===a?document.body:gW(a)){return hq(hi(c),b,{relativeTo:a})}function hq(a,b,{sorted:c=!0,relativeTo:d=null,skipElements:e=[]}={}){var f,g,h;let i=Array.isArray(a)?a.length>0?gW(a[0]):document:gW(a),j=Array.isArray(a)?c?ho(a):a:64&b?function(a=document.body){return null==a?[]:Array.from(a.querySelectorAll(he)).sort((a,b)=>Math.sign((a.tabIndex||Number.MAX_SAFE_INTEGER)-(b.tabIndex||Number.MAX_SAFE_INTEGER)))}(a):hi(a);e.length>0&&j.length>1&&(j=j.filter(a=>!e.some(b=>null!=b&&"current"in b?(null==b?void 0:b.current)===a:b===a))),d=null!=d?d:null==i?void 0:i.activeElement;let k=(()=>{if(5&b)return 1;if(10&b)return -1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),l=(()=>{if(1&b)return 0;if(2&b)return Math.max(0,j.indexOf(d))-1;if(4&b)return Math.max(0,j.indexOf(d))+1;if(8&b)return j.length-1;throw Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),m=32&b?{preventScroll:!0}:{},n=0,o=j.length,p;do{if(n>=o||n+o<=0)return 0;let a=l+n;if(16&b)a=(a+o)%o;else{if(a<0)return 3;if(a>=o)return 1}null==(p=j[a])||p.focus(m),n+=k}while(p!==gX(p))return 6&b&&null!=(h=null==(g=null==(f=p)?void 0:f.matches)?void 0:g.call(f,"textarea,input"))&&h&&p.select(),2}function hr(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function hs(){return hr()||/Android/gi.test(window.navigator.userAgent)}function ht(a,b,c,d){let e=fW(c);(0,S.useEffect)(()=>{if(a)return document.addEventListener(b,c,d),()=>document.removeEventListener(b,c,d);function c(a){e.current(a)}},[a,b,d])}function hu(a,b,c,d){let e=fW(c);(0,S.useEffect)(()=>{if(a)return window.addEventListener(b,c,d),()=>window.removeEventListener(b,c,d);function c(a){e.current(a)}},[a,b,d])}function hv(a,b,c){let d=fW(c),e=(0,S.useCallback)(function(a,c){if(a.defaultPrevented)return;let e=c(a);if(null!==e&&e.getRootNode().contains(e)&&e.isConnected){for(let c of function a(b){return"function"==typeof b?a(b()):Array.isArray(b)||b instanceof Set?b:[b]}(b))if(null!==c&&(c.contains(e)||a.composed&&a.composedPath().includes(c)))return;return hk(e,hj.Loose)||-1===e.tabIndex||a.preventDefault(),d.current(a,e)}},[d,b]),f=(0,S.useRef)(null);ht(a,"pointerdown",a=>{var b,c;hs()||(f.current=(null==(c=null==(b=a.composedPath)?void 0:b.call(a))?void 0:c[0])||a.target)},!0),ht(a,"pointerup",a=>{if(hs()||!f.current)return;let b=f.current;return f.current=null,e(a,()=>b)},!0);let g=(0,S.useRef)({x:0,y:0});ht(a,"touchstart",a=>{g.current.x=a.touches[0].clientX,g.current.y=a.touches[0].clientY},!0),ht(a,"touchend",a=>{let b={x:a.changedTouches[0].clientX,y:a.changedTouches[0].clientY};if(!(Math.abs(b.x-g.current.x)>=30||Math.abs(b.y-g.current.y)>=30))return e(a,()=>g4(a.target)?a.target:null)},!0),hu(a,"blur",a=>e(a,()=>g6(window.document.activeElement)?window.document.activeElement:null),!0)}function hw(...a){return(0,S.useMemo)(()=>gV(...a),[...a])}a.s(["Focus",()=>hf,"FocusResult",()=>hg,"FocusableMode",()=>hj,"focusElement",()=>hn,"focusFrom",()=>hp,"focusIn",()=>hq,"focusableSelector",()=>hd,"isFocusableElement",()=>hk,"restoreFocusIfNecessary",()=>hl,"sortByDomNode",()=>ho],959958),a.s(["useDocumentEvent",()=>ht],926697),a.s(["useOutsideClick",()=>hv],393722),a.s(["useOwnerDocument",()=>hw],38571);var hx=((D=hx||{})[D.None=1]="None",D[D.Focusable=2]="Focusable",D[D.Hidden=4]="Hidden",D);let hy=gi(function(a,b){var c;let{features:d=1,...e}=a,f={ref:b,"aria-hidden":(2&d)==2||(null!=(c=e["aria-hidden"])?c:void 0),hidden:(4&d)==4||void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(4&d)==4&&(2&d)!=2&&{display:"none"}}};return gd()({ourProps:f,theirProps:e,slot:{},defaultTag:"span",name:"Hidden"})}),hz=(0,S.createContext)(null);function hA({children:a,node:b}){let[c,d]=(0,S.useState)(null),e=hB(null!=b?b:c);return S.default.createElement(hz.Provider,{value:e},a,null===e&&S.default.createElement(hy,{features:hx.Hidden,ref:a=>{var b,c;if(a){for(let e of null!=(c=null==(b=gV(a))?void 0:b.querySelectorAll("html > *, body > *"))?c:[])if(e!==document.body&&e!==document.head&&g2(e)&&null!=e&&e.contains(a)){d(e);break}}}}))}function hB(a=null){var b;return null!=(b=(0,S.useContext)(hz))?b:a}function hC(a){let b={};for(let c of a)Object.assign(b,c(b));return b}let hD=(DQ=()=>new Map,DR={PUSH(a,b){var c;let d=null!=(c=this.get(a))?c:{doc:a,count:0,d:fQ(),meta:new Set,computedMeta:{}};return d.count++,d.meta.add(b),d.computedMeta=hC(d.meta),this.set(a,d),this},POP(a,b){let c=this.get(a);return c&&(c.count--,c.meta.delete(b),c.computedMeta=hC(c.meta)),this},SCROLL_PREVENT(a){let b,c={doc:a.doc,d:a.d,meta:()=>a.computedMeta},d=[hr()?{before({doc:a,d:b,meta:c}){function d(a){for(let b of c().containers)for(let c of b())if(c.contains(a))return!0;return!1}b.microTask(()=>{var c;if("auto"!==window.getComputedStyle(a.documentElement).scrollBehavior){let c=fQ();c.style(a.documentElement,"scrollBehavior","auto"),b.add(()=>b.microTask(()=>c.dispose()))}let e=null!=(c=window.scrollY)?c:window.pageYOffset,f=null;b.addEventListener(a,"click",b=>{if(g4(b.target))try{let c=b.target.closest("a");if(!c)return;let{hash:e}=new URL(c.href),g=a.querySelector(e);g4(g)&&!d(g)&&(f=g)}catch{}},!0),b.group(c=>{b.addEventListener(a,"touchstart",a=>{if(c.dispose(),g4(a.target)&&g5(a.target))if(d(a.target)){let b=a.target;for(;b.parentElement&&d(b.parentElement);)b=b.parentElement;c.style(b,"overscrollBehavior","contain")}else c.style(a.target,"touchAction","none")})}),b.addEventListener(a,"touchmove",a=>{if(g4(a.target)&&!g7(a.target))if(d(a.target)){let b=a.target;for(;b.parentElement&&""!==b.dataset.headlessuiPortal&&!(b.scrollHeight>b.clientHeight||b.scrollWidth>b.clientWidth);)b=b.parentElement;""===b.dataset.headlessuiPortal&&a.preventDefault()}else a.preventDefault()},{passive:!1}),b.add(()=>{var a;e!==(null!=(a=window.scrollY)?a:window.pageYOffset)&&window.scrollTo(0,e),f&&f.isConnected&&(f.scrollIntoView({block:"nearest"}),f=null)})})}}:{},{before({doc:a}){var c;let d=a.documentElement;b=Math.max(0,(null!=(c=a.defaultView)?c:window).innerWidth-d.clientWidth)},after({doc:a,d:c}){let d=a.documentElement,e=Math.max(0,d.clientWidth-d.offsetWidth),f=Math.max(0,b-e);c.style(d,"paddingRight",`${f}px`)}},{before({doc:a,d:b}){b.style(a.documentElement,"overflow","hidden")}}];d.forEach(({before:a})=>null==a?void 0:a(c)),d.forEach(({after:a})=>null==a?void 0:a(c))},SCROLL_ALLOW({d:a}){a.dispose()},TEARDOWN({doc:a}){this.delete(a)}},E=DQ(),F=new Set,{getSnapshot:()=>E,subscribe:a=>(F.add(a),()=>F.delete(a)),dispatch(a,...b){let c=DR[a].call(E,...b);c&&(E=c,F.forEach(a=>a()))}});function hE(a,b,c=()=>[document.body]){!function(a,b,c=()=>({containers:[]})){let d=(0,S.useSyncExternalStore)(hD.subscribe,hD.getSnapshot,hD.getSnapshot),e=b?d.get(b):void 0;e&&e.count,fV(()=>{if(!(!b||!a))return hD.dispatch("PUSH",b,c),()=>hD.dispatch("POP",b,c)},[a,b])}(gU(a,"scroll-lock"),b,a=>{var b;return{containers:[...null!=(b=a.containers)?b:[],c]}})}function hF(a){return(0,S.useMemo)(()=>a,Object.values(a))}hD.subscribe(()=>{let a=hD.getSnapshot(),b=new Map;for(let[c]of a)b.set(c,c.documentElement.style.overflow);for(let c of a.values()){let a="hidden"===b.get(c.doc),d=0!==c.count;(d&&!a||!d&&a)&&hD.dispatch(c.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",c),0===c.count&&hD.dispatch("TEARDOWN",c)}}),a.s(["useScrollLock",()=>hE],483914),a.s(["useSlot",()=>hF],742415);let hG=(0,S.createContext)(()=>{});function hH({value:a,children:b}){return S.default.createElement(hG.Provider,{value:a},b)}let hI=(0,S.createContext)(!1);function hJ(a){return S.default.createElement(hI.Provider,{value:a.force},a.children)}let hK=(0,S.createContext)(void 0);function hL(){return(0,S.useContext)(hK)}a.s(["useDisabled",()=>hL],782760);let hM=(0,S.createContext)(null);function hN(){let[a,b]=(0,S.useState)([]);return[a.length>0?a.join(" "):void 0,(0,S.useMemo)(()=>function(a){let c=fX(a=>(b(b=>[...b,a]),()=>b(b=>{let c=b.slice(),d=c.indexOf(a);return -1!==d&&c.splice(d,1),c}))),d=(0,S.useMemo)(()=>({register:c,slot:a.slot,name:a.name,props:a.props,value:a.value}),[c,a.slot,a.name,a.props,a.value]);return S.default.createElement(hM.Provider,{value:d},a.children)},[b])]}hM.displayName="DescriptionContext";let hO=Object.assign(gi(function(a,b){let c=(0,S.useId)(),d=hL(),{id:e=`headlessui-description-${c}`,...f}=a,g=function a(){let b=(0,S.useContext)(hM);if(null===b){let b=Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(b,a),b}return b}(),h=f0(b);fV(()=>g.register(e),[e,g.register]);let i=hF({...g.slot,disabled:d||!1}),j={ref:h,...g.props,id:e};return gd()({ourProps:j,theirProps:f,slot:i,defaultTag:"p",name:g.name||"Description"})}),{});function hP(a){let b=fX(a),c=(0,S.useRef)(!1);(0,S.useEffect)(()=>(c.current=!1,()=>{c.current=!0,fP(()=>{c.current&&b()})}),[b])}a.s(["Description",()=>hO,"useDescriptions",()=>hN],818403),a.s(["useOnUnmount",()=>hP],978519);var hQ=((G=hQ||{})[G.Forwards=0]="Forwards",G[G.Backwards=1]="Backwards",G);function hR(a,b){let c=(0,S.useRef)([]),d=fX(a);(0,S.useEffect)(()=>{let a=[...c.current];for(let[e,f]of b.entries())if(c.current[e]!==f){let e=d(b,a);return c.current=b,e}},[d,...b])}let hS=[];function hT(a){if(!a)return new Set;if("function"==typeof a)return new Set(a());let b=new Set;for(let c of a.current)g2(c.current)&&b.add(c.current);return b}var hU=((H=hU||{})[H.None=0]="None",H[H.InitialFocus=1]="InitialFocus",H[H.TabLock=2]="TabLock",H[H.FocusLock=4]="FocusLock",H[H.RestoreFocus=8]="RestoreFocus",H[H.AutoFocus=16]="AutoFocus",H);let hV=Object.assign(gi(function(a,b){let c,d=(0,S.useRef)(null),e=f0(d,b),{initialFocus:f,initialFocusFallback:g,containers:h,features:i=15,...j}=a;fZ()||(i=0);let k=hw(d.current);!function(a,{ownerDocument:b}){let c=!!(8&a),d=function(a=!0){let b=(0,S.useRef)(hS.slice());return hR(([a],[c])=>{!0===c&&!1===a&&fP(()=>{b.current.splice(0)}),!1===c&&!0===a&&(b.current=hS.slice())},[a,hS,b]),fX(()=>{var a;return null!=(a=b.current.find(a=>null!=a&&a.isConnected))?a:null})}(c);hR(()=>{c||gY(null==b?void 0:b.body)&&hn(d())},[c]),hP(()=>{c&&hn(d())})}(i,{ownerDocument:k});let l=function(a,{ownerDocument:b,container:c,initialFocus:d,initialFocusFallback:e}){let f=(0,S.useRef)(null),g=gU(!!(1&a),"focus-trap#initial-focus"),h=fY();return hR(()=>{if(0===a)return;if(!g){null!=e&&e.current&&hn(e.current);return}let i=c.current;i&&fP(()=>{if(!h.current)return;let c=null==b?void 0:b.activeElement;if(null!=d&&d.current){if((null==d?void 0:d.current)===c){f.current=c;return}}else if(i.contains(c)){f.current=c;return}if(null!=d&&d.current)hn(d.current);else{if(16&a){if(hq(i,hf.First|hf.AutoFocus)!==hg.Error)return}else if(hq(i,hf.First)!==hg.Error)return;if(null!=e&&e.current&&(hn(e.current),(null==b?void 0:b.activeElement)===e.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}f.current=null==b?void 0:b.activeElement})},[e,g,a]),f}(i,{ownerDocument:k,container:d,initialFocus:f,initialFocusFallback:g});!function(a,{ownerDocument:b,container:c,containers:d,previousActiveElement:e}){let f=fY(),g=!!(4&a);gz(null==b?void 0:b.defaultView,"focus",a=>{if(!g||!f.current)return;let b=hT(d);g3(c.current)&&b.add(c.current);let h=e.current;if(!h)return;let i=a.target;g3(i)?hW(b,i)?(e.current=i,hn(i)):(a.preventDefault(),a.stopPropagation(),hn(h)):hn(e.current)},!0)}(i,{ownerDocument:k,container:d,containers:h,previousActiveElement:l});let m=(c=(0,S.useRef)(0),hu(!0,"keydown",a=>{"Tab"===a.key&&(c.current=+!!a.shiftKey)},!0),c),n=fX(a=>{if(!g3(d.current))return;let b=d.current;ga(m.current,{[hQ.Forwards]:()=>{hq(b,hf.First,{skipElements:[a.relatedTarget,g]})},[hQ.Backwards]:()=>{hq(b,hf.Last,{skipElements:[a.relatedTarget,g]})}})}),o=gU(!!(2&i),"focus-trap#tab-lock"),p=fR(),q=(0,S.useRef)(!1),r=gd();return S.default.createElement(S.default.Fragment,null,o&&S.default.createElement(hy,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:n,features:hx.Focusable}),r({ourProps:{ref:e,onKeyDown(a){"Tab"==a.key&&(q.current=!0,p.requestAnimationFrame(()=>{q.current=!1}))},onBlur(a){if(!(4&i))return;let b=hT(h);g3(d.current)&&b.add(d.current);let c=a.relatedTarget;g4(c)&&"true"!==c.dataset.headlessuiFocusGuard&&(hW(b,c)||(q.current?hq(d.current,ga(m.current,{[hQ.Forwards]:()=>hf.Next,[hQ.Backwards]:()=>hf.Previous})|hf.WrapAround,{relativeTo:a.target}):g4(a.target)&&hn(a.target)))}},theirProps:j,defaultTag:"div",name:"FocusTrap"}),o&&S.default.createElement(hy,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:n,features:hx.Focusable}))}),{features:hU});function hW(a,b){for(let c of a)if(c.contains(b))return!0;return!1}var hX=a.i(936188);let hY=S.Fragment,hZ=gi(function(a,b){let{ownerDocument:c=null,...d}=a,e=(0,S.useRef)(null),f=f0(f_(a=>{e.current=a}),b),g=hw(e.current),h=function(a){let b=(0,S.useContext)(hI),c=(0,S.useContext)(h_),[d,e]=(0,S.useState)(()=>{var d;if(!b&&null!==c)return null!=(d=c.current)?d:null;if(fU.isServer)return null;let e=null==a?void 0:a.getElementById("headlessui-portal-root");if(e)return e;if(null===a)return null;let f=a.createElement("div");return f.setAttribute("id","headlessui-portal-root"),a.body.appendChild(f)});return(0,S.useEffect)(()=>{null!==d&&(null!=a&&a.body.contains(d)||null==a||a.body.appendChild(d))},[d,a]),(0,S.useEffect)(()=>{b||null!==c&&e(c.current)},[c,e,b]),d}(null!=c?c:g),i=(0,S.useContext)(h0),j=fR(),k=gd();return hP(()=>{var a;h&&h.childNodes.length<=0&&(null==(a=h.parentElement)||a.removeChild(h))}),h?(0,hX.createPortal)(S.default.createElement("div",{"data-headlessui-portal":"",ref:a=>{j.dispose(),i&&a&&j.add(i.register(a))}},k({ourProps:{ref:f},theirProps:d,slot:{},defaultTag:hY,name:"Portal"})),h):null}),h$=S.Fragment,h_=(0,S.createContext)(null),h0=(0,S.createContext)(null);function h1(){let a=(0,S.useContext)(h0),b=(0,S.useRef)([]),c=fX(c=>(b.current.push(c),a&&a.register(c),()=>d(c))),d=fX(c=>{let d=b.current.indexOf(c);-1!==d&&b.current.splice(d,1),a&&a.unregister(c)}),e=(0,S.useMemo)(()=>({register:c,unregister:d,portals:b}),[c,d,b]);return[b,(0,S.useMemo)(()=>function({children:a}){return S.default.createElement(h0.Provider,{value:e},a)},[e])]}let h2=gi(function(a,b){let c=f0(b),{enabled:d=!0,ownerDocument:e,...f}=a,g=gd();return d?S.default.createElement(hZ,{...f,ownerDocument:e,ref:c}):g({ourProps:{ref:c},theirProps:f,slot:{},defaultTag:hY,name:"Portal"})}),h3=gi(function(a,b){let{target:c,...d}=a,e={ref:f0(b)},f=gd();return S.default.createElement(h_.Provider,{value:c},f({ourProps:e,theirProps:d,defaultTag:h$,name:"Popover.Group"}))}),h4=Object.assign(h2,{Group:h3});a.s(["Portal",()=>h4,"PortalGroup",()=>h3,"useNestedPortals",()=>h1],575064);var h5=((I=h5||{})[I.Open=0]="Open",I[I.Closed=1]="Closed",I),h6=((J=h6||{})[J.SetTitleId=0]="SetTitleId",J);let h7={0:(a,b)=>a.titleId===b.id?a:{...a,titleId:b.id}},h8=(0,S.createContext)(null);function h9(a){let b=(0,S.useContext)(h8);if(null===b){let b=Error(`<${a} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(b,h9),b}return b}function ia(a,b){return ga(b.type,h7,a,b)}h8.displayName="DialogContext";let ib=gi(function(a,b){let c=(0,S.useId)(),{id:d=`headlessui-dialog-${c}`,open:e,onClose:f,initialFocus:g,role:h="dialog",autoFocus:i=!0,__demoMode:j=!1,unmount:k=!1,...l}=a,m=(0,S.useRef)(!1);h="dialog"===h||"alertdialog"===h?h:(m.current||(m.current=!0,console.warn(`Invalid role [${h}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog");let n=f6();void 0===e&&null!==n&&(e=(n&f5.Open)===f5.Open);let o=(0,S.useRef)(null),p=f0(o,b),q=hw(o.current),r=+!e,[s,t]=(0,S.useReducer)(ia,{titleId:null,descriptionId:null,panelRef:(0,S.createRef)()}),u=fX(()=>f(!1)),v=fX(a=>t({type:0,id:a})),w=!!fZ()&&0===r,[x,y]=h1(),z=hB(),{resolveContainers:A}=function({defaultContainers:a=[],portals:b,mainTreeNode:c}={}){let d=fX(()=>{var d,e;let f=gV(c),g=[];for(let b of a)null!==b&&(g2(b)?g.push(b):"current"in b&&g2(b.current)&&g.push(b.current));if(null!=b&&b.current)for(let a of b.current)g.push(a);for(let a of null!=(d=null==f?void 0:f.querySelectorAll("html > *, body > *"))?d:[])a!==document.body&&a!==document.head&&g2(a)&&"headlessui-portal-root"!==a.id&&(c&&(a.contains(c)||a.contains(null==(e=null==c?void 0:c.getRootNode())?void 0:e.host))||g.some(b=>a.contains(b))||g.push(a));return g});return{resolveContainers:d,contains:fX(a=>d().some(b=>b.contains(a)))}}({mainTreeNode:z,portals:x,defaultContainers:[{get current(){var B;return null!=(B=s.panelRef.current)?B:o.current}}]}),C=null!==n&&(n&f5.Closing)===f5.Closing;g0(!j&&!C&&w,{allowed:fX(()=>{var a,b;return[null!=(b=null==(a=o.current)?void 0:a.closest("[data-headlessui-portal]"))?b:null]}),disallowed:fX(()=>{var a;return[null!=(a=null==z?void 0:z.closest("body > *:not(#headlessui-portal-root)"))?a:null]})});let D=gQ.get(null);fV(()=>{if(w)return D.actions.push(d),()=>D.actions.pop(d)},[D,d,w]);let E=gS(D,(0,S.useCallback)(a=>D.selectors.isTop(a,d),[D,d]));hv(E,A,a=>{a.preventDefault(),u()}),function(a,b="undefined"!=typeof document?document.defaultView:null,c){let d=gU(a,"escape");gz(b,"keydown",a=>{d&&(a.defaultPrevented||a.key===gy.Escape&&c(a))})}(E,null==q?void 0:q.defaultView,a=>{a.preventDefault(),a.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur(),u()}),hE(!j&&!C&&w,q,A),hc(w,o,u);let[F,G]=hN(),H=(0,S.useMemo)(()=>[{dialogState:r,close:u,setTitleId:v,unmount:k},s],[r,u,v,k,s]),I=hF({open:0===r}),J={ref:p,id:d,role:h,tabIndex:-1,"aria-modal":j?void 0:0===r||void 0,"aria-labelledby":s.titleId,"aria-describedby":F,unmount:k},K=!function(){var a;let[b]=(0,S.useState)(()=>null),[c,d]=(0,S.useState)(null!=(a=null==b?void 0:b.matches)&&a);return fV(()=>{if(b)return b.addEventListener("change",a),()=>b.removeEventListener("change",a);function a(a){d(a.matches)}},[b]),c}(),L=hU.None;w&&!j&&(L|=hU.RestoreFocus,L|=hU.TabLock,i&&(L|=hU.AutoFocus),K&&(L|=hU.InitialFocus));let M=gd();return S.default.createElement(f8,null,S.default.createElement(hJ,{force:!0},S.default.createElement(h4,null,S.default.createElement(h8.Provider,{value:H},S.default.createElement(h3,{target:o},S.default.createElement(hJ,{force:!1},S.default.createElement(G,{slot:I},S.default.createElement(y,null,S.default.createElement(hV,{initialFocus:g,initialFocusFallback:o,containers:A,features:L},S.default.createElement(hH,{value:u},M({ourProps:J,theirProps:l,slot:I,defaultTag:ic,features:id,visible:0===r,name:"Dialog"})))))))))))}),ic="div",id=gb.RenderStrategy|gb.Static,ie=gi(function(a,b){let{transition:c=!1,open:d,...e}=a,f=f6(),g=a.hasOwnProperty("open")||null!==f,h=a.hasOwnProperty("onClose");if(!g&&!h)throw Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!g)throw Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!h)throw Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!f&&"boolean"!=typeof a.open)throw Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${a.open}`);if("function"!=typeof a.onClose)throw Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${a.onClose}`);return(void 0!==d||c)&&!e.static?S.default.createElement(hA,null,S.default.createElement(gx,{show:d,transition:c,unmount:e.unmount},S.default.createElement(ib,{ref:b,...e}))):S.default.createElement(hA,null,S.default.createElement(ib,{ref:b,open:d,...e}))}),ig=gi(function(a,b){let c=(0,S.useId)(),{id:d=`headlessui-dialog-panel-${c}`,transition:e=!1,...f}=a,[{dialogState:g,unmount:h},i]=h9("Dialog.Panel"),j=f0(b,i.panelRef),k=hF({open:0===g}),l=fX(a=>{a.stopPropagation()}),m=e?gw:S.Fragment,n=gd();return S.default.createElement(m,{...e?{unmount:h}:{}},n({ourProps:{ref:j,id:d,onClick:l},theirProps:f,slot:k,defaultTag:"div",name:"Dialog.Panel"}))}),ih=Object.assign(ie,{Panel:ig,Title:(gi(function(a,b){let{transition:c=!1,...d}=a,[{dialogState:e,unmount:f}]=h9("Dialog.Backdrop"),g=hF({open:0===e}),h=c?gw:S.Fragment,i=gd();return S.default.createElement(h,{...c?{unmount:f}:{}},i({ourProps:{ref:b,"aria-hidden":!0},theirProps:d,slot:g,defaultTag:"div",name:"Dialog.Backdrop"}))}),gi(function(a,b){let c=(0,S.useId)(),{id:d=`headlessui-dialog-title-${c}`,...e}=a,[{dialogState:f,setTitleId:g}]=h9("Dialog.Title"),h=f0(b);(0,S.useEffect)(()=>(g(d),()=>g(null)),[d,g]);let i=hF({open:0===f});return gd()({ourProps:{ref:h,id:d},theirProps:e,slot:i,defaultTag:"h2",name:"Dialog.Title"})})),Description:hO});var ii=a.i(851896),ij=a.i(135037),ik=a.i(163848),il=a.i(716134),im=a.i(874068),io=a.i(857624);let ip=BigInt(0),iq=BigInt(1);function ir(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function is(a){if(!ir(a))throw Error("Uint8Array expected")}function it(a,b){if("boolean"!=typeof b)throw Error(a+" boolean expected, got "+b)}function iu(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function iv(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?ip:BigInt("0x"+a)}let iw="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,ix=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function iy(a){if(is(a),iw)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=ix[a[c]];return b}function iz(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function iA(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(iw)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=iz(a.charCodeAt(e)),f=iz(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function iB(a){return iv(iy(a))}function iC(a){return is(a),iv(iy(Uint8Array.from(a).reverse()))}function iD(a,b){return iA(a.toString(16).padStart(2*b,"0"))}function iE(a,b){return iD(a,b).reverse()}function iF(a,b,c){let d;if("string"==typeof b)try{d=iA(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(ir(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}function iG(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];is(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}let iH=a=>"bigint"==typeof a&&ip<=a;function iI(a,b,c){return iH(a)&&iH(b)&&iH(c)&&b<=a&&a<c}function iJ(a,b,c,d){if(!iI(b,c,d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}let iK=a=>(iq<<BigInt(a))-iq,iL=a=>new Uint8Array(a),iM={bigint:a=>"bigint"==typeof a,function:a=>"function"==typeof a,boolean:a=>"boolean"==typeof a,string:a=>"string"==typeof a,stringOrUint8Array:a=>"string"==typeof a||ir(a),isSafeInteger:a=>Number.isSafeInteger(a),array:a=>Array.isArray(a),field:(a,b)=>b.Fp.isValid(a),hash:a=>"function"==typeof a&&Number.isSafeInteger(a.outputLen)};function iN(a,b,c={}){let d=(b,c,d)=>{let e=iM[c];if("function"!=typeof e)throw Error("invalid validator function");let f=a[b];if((!d||void 0!==f)&&!e(f,a))throw Error("param "+String(b)+" is invalid. Expected "+c+", got "+f)};for(let[a,c]of Object.entries(b))d(a,c,!1);for(let[a,b]of Object.entries(c))d(a,b,!0);return a}function iO(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let iP=BigInt(0),iQ=BigInt(1),iR=BigInt(2),iS=BigInt(3),iT=BigInt(4),iU=BigInt(5),iV=BigInt(8);function iW(a,b){let c=a%b;return c>=iP?c:b+c}function iX(a,b,c){let d=a;for(;b-- >iP;)d*=d,d%=c;return d}function iY(a,b){if(a===iP)throw Error("invert: expected non-zero number");if(b<=iP)throw Error("invert: expected positive modulus, got "+b);let c=iW(a,b),d=b,e=iP,f=iQ,g=iQ,h=iP;for(;c!==iP;){let a=d/c,b=d%c,i=e-g*a,j=f-h*a;d=c,c=b,e=g,f=h,g=i,h=j}if(d!==iQ)throw Error("invert: does not exist");return iW(e,b)}function iZ(a,b){let c=(a.ORDER+iQ)/iT,d=a.pow(b,c);if(!a.eql(a.sqr(d),b))throw Error("Cannot find square root");return d}function i$(a,b){let c=(a.ORDER-iU)/iV,d=a.mul(b,iR),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,iR),e),h=a.mul(f,a.sub(g,a.ONE));if(!a.eql(a.sqr(h),b))throw Error("Cannot find square root");return h}let i_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function i0(a){return iN(a,i_.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"}))}function i1(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function i2(a,b){let c=(a.ORDER-iQ)/iR,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function i3(a,b){void 0!==b&&(0,d4.anumber)(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function i4(a,b,c=!1,d={}){let e;if(a<=iP)throw Error("invalid field: expected ORDER > 0, got "+a);let{nBitLength:f,nByteLength:g}=i3(a,b);if(g>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let h=Object.freeze({ORDER:a,isLE:c,BITS:f,BYTES:g,MASK:iK(f),ZERO:iP,ONE:iQ,create:b=>iW(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return iP<=b&&b<a},is0:a=>a===iP,isOdd:a=>(a&iQ)===iQ,neg:b=>iW(-b,a),eql:(a,b)=>a===b,sqr:b=>iW(b*b,a),add:(b,c)=>iW(b+c,a),sub:(b,c)=>iW(b-c,a),mul:(b,c)=>iW(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<iP)throw Error("invalid exponent, negatives unsupported");if(c===iP)return a.ONE;if(c===iQ)return b;let d=a.ONE,e=b;for(;c>iP;)c&iQ&&(d=a.mul(d,e)),e=a.sqr(e),c>>=iQ;return d})(h,a,b),div:(b,c)=>iW(b*iY(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>iY(b,a),sqrt:d.sqrt||(b=>(e||(e=a%iT===iS?iZ:a%iV===iU?i$:function(a){if(a<BigInt(3))throw Error("sqrt is not defined for small field");let b=a-iQ,c=0;for(;b%iR===iP;)b/=iR,c++;let d=iR,e=i4(a);for(;1===i2(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return iZ;let f=e.pow(d,b),g=(b+iQ)/iR;return function(a,d){if(a.is0(d))return d;if(1!==i2(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=iQ<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}(a)),e(h,b))),toBytes:a=>c?iE(a,g):iD(a,g),fromBytes:a=>{if(a.length!==g)throw Error("Field.fromBytes: expected "+g+" bytes, got "+a.length);return c?iC(a):iB(a)},invertBatch:a=>i1(h,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(h)}function i5(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function i6(a){let b=i5(a);return b+Math.ceil(b/2)}let i7=BigInt(0),i8=BigInt(1);function i9(a,b){let c=b.negate();return a?c:b}function ja(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function jb(a,b){ja(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:iK(a),maxNumber:e,shiftBy:BigInt(a)}}function jc(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=i8);let j=b*d,k=j+Math.abs(h)-1,l=0===h;return{nextN:i,offset:k,isZero:l,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let jd=new WeakMap,je=new WeakMap;function jf(a){return je.get(a)||1}function jg(a){return i0(a.Fp),iN(a,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...i3(a.n,a.nBitLength),...a,...{p:a.Fp.ORDER}})}function jh(a){void 0!==a.lowS&&it("lowS",a.lowS),void 0!==a.prehash&&it("prehash",a.prehash)}let ji={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=ji;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=iu(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?iu(e.length/2|128):"";return iu(a)+f+e+b},decode(a,b){let{Err:c}=ji,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=ji;if(a<jj)throw new b("integer: negative integers are not allowed");let c=iu(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=ji;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return iB(a)}},toSig(a){let{Err:b,_int:c,_tlv:d}=ji,e=iF("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=ji,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},jj=BigInt(0),jk=BigInt(1),jl=BigInt(2),jm=BigInt(3),jn=BigInt(4),jo=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),jp=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),jq=BigInt(0),jr=BigInt(1),js=BigInt(2),jt=(a,b)=>(a+b/js)/b,ju=i4(jo,void 0,void 0,{sqrt:function(a){let b=BigInt(3),c=BigInt(6),d=BigInt(11),e=BigInt(22),f=BigInt(23),g=BigInt(44),h=BigInt(88),i=a*a*a%jo,j=i*i*a%jo,k=iX(j,b,jo)*j%jo,l=iX(k,b,jo)*j%jo,m=iX(l,js,jo)*i%jo,n=iX(m,d,jo)*m%jo,o=iX(n,e,jo)*n%jo,p=iX(o,g,jo)*o%jo,q=iX(p,h,jo)*p%jo,r=iX(q,g,jo)*o%jo,s=iX(r,b,jo)*j%jo,t=iX(s,f,jo)*n%jo,u=iX(t,c,jo)*i%jo,v=iX(u,js,jo);if(!ju.eql(ju.sqr(v),a))throw Error("Cannot find square root");return v}}),jv=(DS={a:jq,b:BigInt(7),Fp:ju,n:jp,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:a=>{let b=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),c=-jr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),d=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),e=BigInt("0x100000000000000000000000000000000"),f=jt(b*a,jp),g=jt(-c*a,jp),h=iW(a-f*b-g*d,jp),i=iW(-f*c-g*b,jp),j=h>e,k=i>e;if(j&&(h=jp-h),k&&(i=jp-i),h>e||i>e)throw Error("splitScalar: Endomorphism failed, k="+a);return{k1neg:j,k1:h,k2neg:k,k2:i}}}},DT=im.sha256,{...(K=a=>(function(a){let b,c=(iN(b=jg(a),{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...b})),{Fp:d,n:e,nByteLength:f,nBitLength:g}=c,h=d.BYTES+1,i=2*d.BYTES+1;function j(a){return iW(a,e)}let{ProjectivePoint:k,normPrivateKeyToScalar:l,weierstrassEquation:m,isWithinCurveOrder:n}=function(a){var b;let c=function(a){let b=jg(a);iN(b,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:c,Fp:d,a:e}=b;if(c){if(!d.eql(e,d.ZERO))throw Error("invalid endo: CURVE.a must be 0");if("object"!=typeof c||"bigint"!=typeof c.beta||"function"!=typeof c.splitScalar)throw Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...b})}(a),{Fp:d}=c,e=i4(c.n,c.nBitLength),f=c.toBytes||((a,b,c)=>{let e=b.toAffine();return iG(Uint8Array.from([4]),d.toBytes(e.x),d.toBytes(e.y))}),g=c.fromBytes||(a=>{let b=a.subarray(1);return{x:d.fromBytes(b.subarray(0,d.BYTES)),y:d.fromBytes(b.subarray(d.BYTES,2*d.BYTES))}});function h(a){let{a:b,b:e}=c,f=d.sqr(a),g=d.mul(f,a);return d.add(d.add(g,d.mul(a,b)),e)}function i(a,b){let c=d.sqr(b),e=h(a);return d.eql(c,e)}if(!i(c.Gx,c.Gy))throw Error("bad curve params: generator point");let j=d.mul(d.pow(c.a,jm),jn),k=d.mul(d.sqr(c.b),BigInt(27));if(d.is0(d.add(j,k)))throw Error("bad curve params: a or b");function l(a){let b,{allowedPrivateKeyLengths:d,nByteLength:e,wrapPrivateKey:f,n:g}=c;if(d&&"bigint"!=typeof a){if(ir(a)&&(a=iy(a)),"string"!=typeof a||!d.includes(a.length))throw Error("invalid private key");a=a.padStart(2*e,"0")}try{b="bigint"==typeof a?a:iB(iF("private key",a,e))}catch(b){throw Error("invalid private key, expected hex or "+e+" bytes, got "+typeof a)}return f&&(b=iW(b,g)),iJ("private key",b,jk,g),b}function m(a){if(!(a instanceof p))throw Error("ProjectivePoint expected")}let n=iO((a,b)=>{let{px:c,py:e,pz:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),o=iO(a=>{if(a.is0()){if(c.allowInfinityPoint&&!d.is0(a.py))return;throw Error("bad point: ZERO")}let{x:b,y:e}=a.toAffine();if(!d.isValid(b)||!d.isValid(e))throw Error("bad point: x or y not FE");if(!i(b,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});class p{constructor(a,b,c){if(null==a||!d.isValid(a))throw Error("x required");if(null==b||!d.isValid(b)||d.is0(b))throw Error("y required");if(null==c||!d.isValid(c))throw Error("z required");this.px=a,this.py=b,this.pz=c,Object.freeze(this)}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof p)throw Error("projective point not allowed");let e=a=>d.eql(a,d.ZERO);return e(b)&&e(c)?p.ZERO:new p(b,c,d.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(a){let b=i1(d,a.map(a=>a.pz));return a.map((a,c)=>a.toAffine(b[c])).map(p.fromAffine)}static fromHex(a){let b=p.fromAffine(g(iF("pointHex",a)));return b.assertValidity(),b}static fromPrivateKey(a){return p.BASE.multiply(l(a))}static msm(a,b){return function(a,b,c,d){if(!Array.isArray(c))throw Error("array expected");c.forEach((b,c)=>{if(!(b instanceof a))throw Error("invalid point at index "+c)});if(!Array.isArray(d))throw Error("array of scalars expected");d.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)});let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=function(a){let b;for(b=0;a>ip;a>>=iq,b+=1);return b}(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=iK(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(p,e,a,b)}_setWindowSize(a){s.setWindowSize(this,a)}assertValidity(){o(this)}hasEvenY(){let{y:a}=this.toAffine();if(d.isOdd)return!d.isOdd(a);throw Error("Field doesn't support isOdd")}equals(a){m(a);let{px:b,py:c,pz:e}=this,{px:f,py:g,pz:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new p(this.px,d.neg(this.py),this.pz)}double(){let{a,b}=c,e=d.mul(b,jm),{px:f,py:g,pz:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(f,f),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(f,g);return o=d.add(o,o),k=d.mul(f,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(e,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(e,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new p(i,j,k=d.add(k,k))}add(a){m(a);let{px:b,py:e,pz:f}=this,{px:g,py:h,pz:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,n=c.a,o=d.mul(c.b,jm),q=d.mul(b,g),r=d.mul(e,h),s=d.mul(f,i),t=d.add(b,e),u=d.add(g,h);t=d.mul(t,u),u=d.add(q,r),t=d.sub(t,u),u=d.add(b,f);let v=d.add(g,i);return u=d.mul(u,v),v=d.add(q,s),u=d.sub(u,v),v=d.add(e,f),j=d.add(h,i),v=d.mul(v,j),j=d.add(r,s),v=d.sub(v,j),l=d.mul(n,u),j=d.mul(o,s),l=d.add(j,l),j=d.sub(r,l),l=d.add(r,l),k=d.mul(j,l),r=d.add(q,q),r=d.add(r,q),s=d.mul(n,s),u=d.mul(o,u),r=d.add(r,s),s=d.sub(q,s),s=d.mul(n,s),u=d.add(u,s),q=d.mul(r,u),k=d.add(k,q),q=d.mul(v,u),j=d.mul(t,j),j=d.sub(j,q),q=d.mul(t,r),l=d.mul(v,l),new p(j,k,l=d.add(l,q))}subtract(a){return this.add(a.negate())}is0(){return this.equals(p.ZERO)}wNAF(a){return s.wNAFCached(this,a,p.normalizeZ)}multiplyUnsafe(a){let{endo:b,n:e}=c;iJ("scalar",a,jj,e);let f=p.ZERO;if(a===jj)return f;if(this.is0()||a===jk)return this;if(!b||s.hasPrecomputes(this))return s.wNAFCachedUnsafe(this,a,p.normalizeZ);let{k1neg:g,k1:h,k2neg:i,k2:j}=b.splitScalar(a),k=f,l=f,m=this;for(;h>jj||j>jj;)h&jk&&(k=k.add(m)),j&jk&&(l=l.add(m)),m=m.double(),h>>=jk,j>>=jk;return g&&(k=k.negate()),i&&(l=l.negate()),l=new p(d.mul(l.px,b.beta),l.py,l.pz),k.add(l)}multiply(a){let b,e,{endo:f,n:g}=c;if(iJ("scalar",a,jk,g),f){let{k1neg:c,k1:g,k2neg:h,k2:i}=f.splitScalar(a),{p:j,f:k}=this.wNAF(g),{p:l,f:m}=this.wNAF(i);j=s.constTimeNegate(c,j),l=s.constTimeNegate(h,l),l=new p(d.mul(l.px,f.beta),l.py,l.pz),b=j.add(l),e=k.add(m)}else{let{p:c,f:d}=this.wNAF(a);b=c,e=d}return p.normalizeZ([b,e])[0]}multiplyAndAddUnsafe(a,b,c){let d=p.BASE,e=(a,b)=>b!==jj&&b!==jk&&a.equals(d)?a.multiply(b):a.multiplyUnsafe(b),f=e(this,b).add(e(a,c));return f.is0()?void 0:f}toAffine(a){return n(this,a)}isTorsionFree(){let{h:a,isTorsionFree:b}=c;if(a===jk)return!0;if(b)return b(p,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:a,clearCofactor:b}=c;return a===jk?this:b?b(p,this):this.multiplyUnsafe(c.h)}toRawBytes(a=!0){return it("isCompressed",a),this.assertValidity(),f(p,this,a)}toHex(a=!0){return it("isCompressed",a),iy(this.toRawBytes(a))}}p.BASE=new p(c.Gx,c.Gy,d.ONE),p.ZERO=new p(d.ZERO,d.ONE,d.ZERO);let{endo:q,nBitLength:r}=c,s=(b=q?Math.ceil(r/2):r,{constTimeNegate:i9,hasPrecomputes:a=>1!==jf(a),unsafeLadder(a,b,c=p.ZERO){let d=a;for(;b>i7;)b&i8&&(c=c.add(d)),d=d.double(),b>>=i8;return c},precomputeWindow(a,c){let{windows:d,windowSize:e}=jb(c,b),f=[],g=a,h=g;for(let a=0;a<d;a++){h=g,f.push(h);for(let a=1;a<e;a++)h=h.add(g),f.push(h);g=h.double()}return f},wNAF(a,c,d){let e=p.ZERO,f=p.BASE,g=jb(a,b);for(let a=0;a<g.windows;a++){let{nextN:b,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=jc(d,a,g);d=b,i?f=f.add(i9(k,c[l])):e=e.add(i9(j,c[h]))}return{p:e,f}},wNAFUnsafe(a,c,d,e=p.ZERO){let f=jb(a,b);for(let a=0;a<f.windows&&d!==i7;a++){let{nextN:b,offset:g,isZero:h,isNeg:i}=jc(d,a,f);if(d=b,!h){let a=c[g];e=e.add(i?a.negate():a)}}return e},getPrecomputes(a,b,c){let d=jd.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&jd.set(b,c(d))),d},wNAFCached(a,b,c){let d=jf(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)},wNAFCachedUnsafe(a,b,c,d){let e=jf(a);return 1===e?this.unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)},setWindowSize(a,c){ja(c,b),je.set(a,c),jd.delete(a)}});return{CURVE:c,ProjectivePoint:p,normPrivateKeyToScalar:l,weierstrassEquation:h,isWithinCurveOrder:function(a){return iI(a,jk,c.n)}}}({...c,toBytes(a,b,c){let e=b.toAffine(),f=d.toBytes(e.x);return(it("isCompressed",c),c)?iG(Uint8Array.from([b.hasEvenY()?2:3]),f):iG(Uint8Array.from([4]),f,d.toBytes(e.y))},fromBytes(a){let b=a.length,c=a[0],e=a.subarray(1);if(b===h&&(2===c||3===c)){let a,b=iB(e);if(!iI(b,jk,d.ORDER))throw Error("Point is not on curve");let f=m(b);try{a=d.sqrt(f)}catch(a){throw Error("Point is not on curve"+(a instanceof Error?": "+a.message:""))}return(1&c)==1!=((a&jk)===jk)&&(a=d.neg(a)),{x:b,y:a}}if(b===i&&4===c)return{x:d.fromBytes(e.subarray(0,d.BYTES)),y:d.fromBytes(e.subarray(d.BYTES,2*d.BYTES))};throw Error("invalid Point, expected length of "+h+", or uncompressed "+i+", got "+b)}}),o=(a,b,c)=>iB(a.slice(b,c));class p{constructor(a,b,c){iJ("r",a,jk,e),iJ("s",b,jk,e),this.r=a,this.s=b,null!=c&&(this.recovery=c),Object.freeze(this)}static fromCompact(a){return new p(o(a=iF("compactSignature",a,2*f),0,f),o(a,f,2*f))}static fromDER(a){let{r:b,s:c}=ji.toSig(iF("DER",a));return new p(b,c)}assertValidity(){}addRecoveryBit(a){return new p(this.r,this.s,a)}recoverPublicKey(a){let{r:b,s:f,recovery:g}=this,h=s(iF("msgHash",a));if(null==g||![0,1,2,3].includes(g))throw Error("recovery id invalid");let i=2===g||3===g?b+c.n:b;if(i>=d.ORDER)throw Error("recovery id 2 or 3 invalid");let l=(1&g)==0?"02":"03",m=k.fromHex(l+iy(iD(i,d.BYTES))),n=iY(i,e),o=j(-h*n),p=j(f*n),q=k.BASE.multiplyAndAddUnsafe(m,o,p);if(!q)throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>e>>jk}normalizeS(){return this.hasHighS()?new p(this.r,j(-this.s),this.recovery):this}toDERRawBytes(){return iA(this.toDERHex())}toDERHex(){return ji.hexFromSig(this)}toCompactRawBytes(){return iA(this.toCompactHex())}toCompactHex(){return iy(iD(this.r,f))+iy(iD(this.s,f))}}function q(a){if("bigint"==typeof a)return!1;if(a instanceof k)return!0;let b=iF("key",a).length,e=d.BYTES,g=e+1;if(!c.allowedPrivateKeyLengths&&f!==g)return b===g||b===2*e+1}let r=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=iB(a),c=8*a.length-g;return c>0?b>>BigInt(c):b},s=c.bits2int_modN||function(a){return j(r(a))},t=iK(g);function u(a){return iJ("num < 2^"+g,a,jj,t),iD(a,f)}let v={lowS:c.lowS,prehash:!1},w={lowS:c.lowS,prehash:!1};return k.BASE._setWindowSize(8),{CURVE:c,getPublicKey:function(a,b=!0){return k.fromPrivateKey(a).toRawBytes(b)},getSharedSecret:function(a,b,c=!0){if(!0===q(a))throw Error("first arg must be private key");if(!1===q(b))throw Error("second arg must be public key");return k.fromHex(b).multiply(l(a)).toRawBytes(c)},sign:function(a,b,f=v){let{seed:g,k2sig:h}=function(a,b,f=v){if(["recovered","canonical"].some(a=>a in f))throw Error("sign() legacy options not supported");let{hash:g,randomBytes:h}=c,{lowS:i,prehash:m,extraEntropy:o}=f;null==i&&(i=!0),a=iF("msgHash",a),jh(f),m&&(a=iF("prehashed msgHash",g(a)));let q=s(a),t=l(b),w=[u(t),u(q)];if(null!=o&&!1!==o){let a=!0===o?h(d.BYTES):o;w.push(iF("extraEntropy",a))}return{seed:iG(...w),k2sig:function(a){var b;let c=r(a);if(!n(c))return;let d=iY(c,e),f=k.BASE.multiply(c).toAffine(),g=j(f.x);if(g===jj)return;let h=j(d*j(q+g*t));if(h===jj)return;let l=2*(f.x!==g)|Number(f.y&jk),m=h;return i&&h>e>>jk&&(m=(b=h)>e>>jk?j(-b):b,l^=1),new p(g,m,l)}}}(a,b,f);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=iL(a),e=iL(a),f=0,g=()=>{d.fill(1),e.fill(0),f=0},h=(...a)=>c(e,d,...a),i=(a=iL(0))=>{let b;if(e=h((b=[0],Uint8Array.from(b)),a),d=h(),0!==a.length){let b;e=h((b=[1],Uint8Array.from(b)),a),d=h()}},j=()=>{if(f++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(d=h()).slice();c.push(b),a+=d.length}return iG(...c)};return(a,b)=>{let c;for(g(),i(a);!(c=b(j()));)i();return g(),c}})(c.hash.outputLen,c.nByteLength,c.hmac)(g,h)},verify:function(a,b,d,f=w){let g,h;b=iF("msgHash",b),d=iF("publicKey",d);let{lowS:i,prehash:l,format:m}=f;if(jh(f),"strict"in f)throw Error("options.strict was renamed to lowS");if(void 0!==m&&"compact"!==m&&"der"!==m)throw Error("format must be compact or der");let n="string"==typeof a||ir(a),o=!n&&!m&&"object"==typeof a&&null!==a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!n&&!o)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");try{if(o&&(h=new p(a.r,a.s)),n){try{"compact"!==m&&(h=p.fromDER(a))}catch(a){if(!(a instanceof ji.Err))throw a}h||"der"===m||(h=p.fromCompact(a))}g=k.fromHex(d)}catch(a){return!1}if(!h||i&&h.hasHighS())return!1;l&&(b=c.hash(b));let{r:q,s:r}=h,t=s(b),u=iY(r,e),v=j(t*u),x=j(q*u),y=k.BASE.multiplyAndAddUnsafe(g,v,x)?.toAffine();return!!y&&j(y.x)===q},ProjectivePoint:k,Signature:p,utils:{isValidPrivateKey(a){try{return l(a),!0}catch(a){return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{let a=i6(c.n);return function(a,b,c=!1){let d=a.length,e=i5(b),f=i6(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=iW(c?iC(a):iB(a),b-iQ)+iQ;return c?iE(g,e):iD(g,e)}(c.randomBytes(a),c.n)},precompute:(a=8,b=k.BASE)=>(b._setWindowSize(a),b.multiply(BigInt(3)),b)}}})({...DS,...{hash:a,hmac:(b,...c)=>(0,io.hmac)(a,b,(0,d4.concatBytes)(...c)),randomBytes:d4.randomBytes}}))(DT),create:K});jv.ProjectivePoint;let jw=(L=[["0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa8c7","0x7d3d4c80bc321d5b9f315cea7fd44c5d595d2fc0bf63b92dfff1044f17c6581","0x534c328d23f234e6e2a413deca25caece4506144037c40314ecbd0b53d9dd262","0x8e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38e38daaaaa88c"],["0xd35771193d94918a9ca34ccbb7b640dd86cd409542f8487d9fe6b745781eb49b","0xedadc6f64383dc1df7c4b2d51b54225406d36b641f5e41bbc52a56612a8c6d14","0x0000000000000000000000000000000000000000000000000000000000000001"],["0x4bda12f684bda12f684bda12f684bda12f684bda12f684bda12f684b8e38e23c","0xc75e0c32d5cb7c0fa9d0a54b12a0a6d5647ab046d686da6fdffc90fc201d71a3","0x29a6194691f91a73715209ef6512e576722830a201be2018a765e85a9ecee931","0x2f684bda12f684bda12f684bda12f684bda12f684bda12f684bda12f38e38d84"],["0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffff93b","0x7a06534bb8bdb49fd5e9e6632722c2989467c1bfc8e8d978dfb425d2685c2573","0x6484aa716545ca2cf3a70c3fa8fe337e0a3d21162f0d6299a7bf8192bfd2a76f","0x0000000000000000000000000000000000000000000000000000000000000001"]].map(a=>a.map(a=>BigInt(a))).map(a=>Array.from(a).reverse()),(a,b)=>{let[c,d,e,f]=L.map(b=>b.reduce((b,c)=>ju.add(ju.mul(b,a),c))),[g,h]=i1(ju,[d,f],!0);return a=ju.mul(c,g),b=ju.mul(b,ju.mul(e,h)),{x:a,y:b}}),jx=function(a,b){if(i0(a),!a.isValid(b.A)||!a.isValid(b.B)||!a.isValid(b.Z))throw Error("mapToCurveSimpleSWU: invalid opts");let c=function(a,b){let c=a.ORDER,d=jj;for(let a=c-jk;a%jl===jj;a/=jl)d+=jk;let e=d,f=jl<<e-jk-jk,g=f*jl,h=(c-jk)/g,i=(h-jk)/jl,j=g-jk,k=a.pow(b,h),l=a.pow(b,(h+jk)/jl),m=(b,c)=>{let d=k,g=a.pow(c,j),h=a.sqr(g);h=a.mul(h,c);let m=a.mul(b,h);m=a.pow(m,i),m=a.mul(m,g),g=a.mul(m,c),h=a.mul(m,b);let n=a.mul(h,g);m=a.pow(n,f);let o=a.eql(m,a.ONE);g=a.mul(h,l),m=a.mul(n,d),h=a.cmov(g,h,o),n=a.cmov(m,n,o);for(let b=e;b>jk;b--){let c=b-jl;c=jl<<c-jk;let e=a.pow(n,c),f=a.eql(e,a.ONE);g=a.mul(h,d),d=a.mul(d,d),e=a.mul(n,d),h=a.cmov(g,h,f),n=a.cmov(e,n,f)}return{isValid:o,value:h}};if(a.ORDER%jn===jm){let c=(a.ORDER-jm)/jn,d=a.sqrt(a.neg(b));m=(b,e)=>{let f=a.sqr(e),g=a.mul(b,e);f=a.mul(f,g);let h=a.pow(f,c);h=a.mul(h,g);let i=a.mul(h,d),j=a.mul(a.sqr(h),e),k=a.eql(j,b),l=a.cmov(i,h,k);return{isValid:k,value:l}}}return m}(a,b.Z);if(!a.isOdd)throw Error("Fp.isOdd is not implemented!");return d=>{let e,f,g,h,i,j,k,l;e=a.sqr(d),e=a.mul(e,b.Z),f=a.sqr(e),f=a.add(f,e),g=a.add(f,a.ONE),g=a.mul(g,b.B),h=a.cmov(b.Z,a.neg(f),!a.eql(f,a.ZERO)),h=a.mul(h,b.A),f=a.sqr(g),j=a.sqr(h),i=a.mul(j,b.A),f=a.add(f,i),f=a.mul(f,g),j=a.mul(j,h),i=a.mul(j,b.B),f=a.add(f,i),k=a.mul(e,g);let{isValid:m,value:n}=c(f,j);l=a.mul(e,d),l=a.mul(l,n),k=a.cmov(k,g,m),l=a.cmov(l,n,m);let o=a.isOdd(d)===a.isOdd(l);l=a.cmov(a.neg(l),l,o);let p=i1(a,[h],!0)[0];return{x:k=a.mul(k,p),y:l}}}(ju,{A:BigInt("0x3f8731abdd661adca08a5558f0f5d272e953d363cb6f0e5d405447c01a444533"),B:BigInt("1771"),Z:ju.create(BigInt("-11"))});!function(a,b,c){if("function"!=typeof b)throw Error("mapToCurve() must be defined")}(jv.ProjectivePoint,a=>{let{x:b,y:c}=jx(ju.create(a[0]));return jw(b,c)},(ju.ORDER,im.sha256));class jy extends Error{constructor(a,b={}){const c=(()=>{if(b.cause instanceof jy){if(b.cause.details)return b.cause.details;if(b.cause.shortMessage)return b.cause.shortMessage}return b.cause&&"details"in b.cause&&"string"==typeof b.cause.details?b.cause.details:b.cause?.message?b.cause.message:b.details})(),d=b.cause instanceof jy&&b.cause.docsPath||b.docsPath,e=`https://oxlib.sh${d??""}`;super([a||"An error occurred.",...b.metaMessages?["",...b.metaMessages]:[],...c||d?["",c?`Details: ${c}`:void 0,d?`See: ${e}`:void 0]:[]].filter(a=>"string"==typeof a).join("\n"),b.cause?{cause:b.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:"ox@0.1.1"}),this.cause=b.cause,this.details=c,this.docs=e,this.docsPath=d,this.shortMessage=a}walk(a){return function a(b,c){return c?.(b)?b:b&&"object"==typeof b&&"cause"in b&&b.cause?a(b.cause,c):c?null:b}(this,a)}}function jz(a,b){if(jJ(a)>b)throw new jO({givenSize:jJ(a),maxSize:b})}function jA(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;let e=a.replace("0x","");if(e.length>2*d)throw new jQ({size:Math.ceil(e.length/2),targetSize:d,type:"Hex"});return`0x${e["right"===c?"padEnd":"padStart"](2*d,"0")}`}function jB(a,b,c){return JSON.stringify(a,(a,c)=>"function"==typeof b?b(a,c):"bigint"==typeof c?c.toString()+"#__bigint":c,c)}let jC=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function jD(...a){return`0x${a.reduce((a,b)=>a+b.replace("0x",""),"")}`}function jE(a){return a instanceof Uint8Array?jF(a):Array.isArray(a)?jF(new Uint8Array(a)):a}function jF(a,b={}){let c="";for(let b=0;b<a.length;b++)c+=jC[a[b]];let d=`0x${c}`;return"number"==typeof b.size?(jz(d,b.size),jH(d,b.size)):d}function jG(a,b={}){var c;let d,{signed:e,size:f}=b,g=BigInt(a);f?d=e?(1n<<8n*BigInt(f)-1n)-1n:2n**(8n*BigInt(f))-1n:"number"==typeof a&&(d=BigInt(Number.MAX_SAFE_INTEGER));let h="bigint"==typeof d&&e?-d-1n:0;if(d&&g>d||g<h){let b="bigint"==typeof a?"n":"";throw new jL({max:d?`${d}${b}`:void 0,min:`${h}${b}`,signed:e,size:f,value:`${a}${b}`})}let i=(e&&g<0?(1n<<BigInt(8*f))+BigInt(g):g).toString(16),j=`0x${i}`;return f?(c=j,jA(c,{dir:"left",size:f})):j}function jH(a,b){return jA(a,{dir:"right",size:b})}function jI(a,b,c,d={}){let{strict:e}=d;if("number"==typeof b&&b>0&&b>jJ(a)-1)throw new jP({offset:b,position:"start",size:jJ(a)});let f=`0x${a.replace("0x","").slice((b??0)*2,(c??a.length)*2)}`;return e&&function(a,b,c){if("number"==typeof b&&"number"==typeof c&&jJ(a)!==c-b)throw new jP({offset:c,position:"end",size:jJ(a)})}(f,b,c),f}function jJ(a){return Math.ceil((a.length-2)/2)}function jK(a){return function(a,b={}){let{dir:c="left"}=b,d=a.replace("0x",""),e=0;for(let a=0;a<d.length-1;a++)if("0"===d["left"===c?a:d.length-a-1].toString())e++;else break;return"0"===(d="left"===c?d.slice(e):d.slice(0,d.length-e))?"0x":"right"===c&&d.length%2==1?`0x${d}0`:`0x${d}`}(a,{dir:"left"})}class jL extends jy{constructor({max:a,min:b,signed:c,size:d,value:e}){super(`Number \`${e}\` is not in safe${d?` ${8*d}-bit`:""}${c?" signed":" unsigned"} integer range ${a?`(\`${b}\` to \`${a}\`)`:`(above \`${b}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class jM extends jy{constructor(a){super(`Value \`${"object"==typeof a?jB(a):a}\` of type \`${typeof a}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class jN extends jy{constructor(a){super(`Value \`${a}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}class jO extends jy{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class jP extends jy{constructor({offset:a,position:b,size:c}){super(`Slice ${"start"===b?"starting":"ending"} at offset \`${a}\` is out-of-bounds (size: \`${c}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}class jQ extends jy{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}function jR(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}let jS=new TextEncoder;function jT(a){var b;return a instanceof Uint8Array?a:"string"==typeof a?jU(a):(b=a)instanceof Uint8Array?b:new Uint8Array(b)}function jU(a,b={}){let{size:c}=b,d=a;c&&(jz(a,c),d=jH(a,c));let e=d.slice(2);e.length%2&&(e=`0${e}`);let f=e.length/2,g=new Uint8Array(f);for(let a=0,b=0;a<f;a++){let c=jR(e.charCodeAt(b++)),d=jR(e.charCodeAt(b++));if(void 0===c||void 0===d)throw new jy(`Invalid byte sequence ("${e[b-2]}${e[b-1]}" in "${e}").`);g[a]=16*c+d}return g}class jV extends jy{constructor(a){super(`Value \`${"object"==typeof a?jB(a):a}\` of type \`${typeof a}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class jW extends jy{constructor({givenSize:a,maxSize:b}){super(`Size cannot exceed \`${b}\` bytes. Given size: \`${a}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class jX extends jy{constructor({size:a,targetSize:b,type:c}){super(`${c.charAt(0).toUpperCase()}${c.slice(1).toLowerCase()} size (\`${a}\`) exceeds padding size (\`${b}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}let jY=2n**256n-1n;function jZ(a,b={}){let{recovered:c}=b;if(void 0===a.r||void 0===a.s||c&&void 0===a.yParity)throw new ki({signature:a});if(a.r<0n||a.r>jY)throw new kj({value:a.r});if(a.s<0n||a.s>jY)throw new kk({value:a.s});if("number"==typeof a.yParity&&0!==a.yParity&&1!==a.yParity)throw new kl({value:a.yParity})}function j$(a){return j_(jF(a))}function j_(a){if(130!==a.length&&132!==a.length)throw new kh({signature:a});let b=BigInt(jI(a,0,32)),c=BigInt(jI(a,32,64)),d=(()=>{let b=Number(`0x${a.slice(130)}`);if(!Number.isNaN(b))try{return kf(b)}catch{throw new kl({value:b})}})();return void 0===d?{r:b,s:c}:{r:b,s:c,yParity:d}}function j0(a){if(void 0!==a.r&&void 0!==a.s)return j1(a)}function j1(a){let b="string"==typeof a?j_(a):a instanceof Uint8Array?j$(a):"string"==typeof a.r?j5(a):a.v?j4(a):{r:a.r,s:a.s,...void 0!==a.yParity?{yParity:a.yParity}:{}};return jZ(b),b}function j2(a){return j3(jF(a))}function j3(a){let{r:b,s:c}=jv.Signature.fromDER(jE(a).slice(2));return{r:b,s:c}}function j4(a){return{r:a.r,s:a.s,yParity:kf(a.v)}}function j5(a){let b=(()=>{let b=a.v?Number(a.v):void 0,c=a.yParity?Number(a.yParity):void 0;if("number"==typeof b&&"number"!=typeof c&&(c=kf(b)),"number"!=typeof c)throw new kl({value:a.yParity});return c})();return{r:BigInt(a.r),s:BigInt(a.s),yParity:b}}function j6(a){let[b,c,d]=a;return j1({r:"0x"===c?0n:BigInt(c),s:"0x"===d?0n:BigInt(d),yParity:"0x"===b?0:Number(b)})}function j7(a){return jU(j8(a))}function j8(a){jZ(a);let b=a.r,c=a.s;return jD(jG(b,{size:32}),jG(c,{size:32}),"number"==typeof a.yParity?jG(kg(a.yParity),{size:1}):"0x")}function j9(a){return new jv.Signature(a.r,a.s).toDERRawBytes()}function ka(a){let b=new jv.Signature(a.r,a.s);return`0x${b.toDERHex()}`}function kb(a){return{r:a.r,s:a.s,v:kg(a.yParity)}}function kc(a){let{r:b,s:c,yParity:d}=a;return{r:jG(b,{size:32}),s:jG(c,{size:32}),yParity:0===d?"0x0":"0x1"}}function kd(a){let{r:b,s:c,yParity:d}=a;return[d?"0x01":"0x",0n===b?"0x":jK(jG(b)),0n===c?"0x":jK(jG(c))]}function ke(a,b={}){try{return jZ(a,b),!0}catch{return!1}}function kf(a){if(0===a||27===a)return 0;if(1===a||28===a)return 1;if(a>=35)return+(a%2==0);throw new km({value:a})}function kg(a){if(0===a)return 27;if(1===a)return 28;throw new kl({value:a})}class kh extends jy{constructor({signature:a}){super(`Value \`${a}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${jJ(jE(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class ki extends jy{constructor({signature:a}){super(`Signature \`${jB(a)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class kj extends jy{constructor({value:a}){super(`Value \`${a}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class kk extends jy{constructor({value:a}){super(`Value \`${a}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class kl extends jy{constructor({value:a}){super(`Value \`${a}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class km extends jy{constructor({value:a}){super(`Value \`${a}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}a.s(["InvalidRError",()=>kj,"InvalidSError",()=>kk,"InvalidSerializedSizeError",()=>kh,"InvalidVError",()=>km,"InvalidYParityError",()=>kl,"MissingPropertiesError",()=>ki,"assert",()=>jZ,"extract",()=>j0,"from",()=>j1,"fromBytes",()=>j$,"fromDerBytes",()=>j2,"fromDerHex",()=>j3,"fromHex",()=>j_,"fromLegacy",()=>j4,"fromRpc",()=>j5,"fromTuple",()=>j6,"toBytes",()=>j7,"toDerBytes",()=>j9,"toDerHex",()=>ka,"toHex",()=>j8,"toLegacy",()=>kb,"toRpc",()=>kc,"toTuple",()=>kd,"vToYParity",()=>kf,"validate",()=>ke,"yParityToV",()=>kg],774457);var kn=a.i(774457),kn=kn;class ko extends Map{constructor(a){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=a}get(a){let b=super.get(a);return super.has(a)&&void 0!==b&&(this.delete(a),super.set(a,b)),b}set(a,b){if(super.set(a,b),this.maxSize&&this.size>this.maxSize){let a=this.keys().next().value;a&&this.delete(a)}return this}}let kp={checksum:new ko(8192)}.checksum;var kq=a.i(272392);function kr(a,b={}){let{as:c="string"==typeof a?"Hex":"Bytes"}=b,d=(0,kq.keccak_256)(jT(a));return"Bytes"===c?d:jF(d)}function ks(a,b={}){let{compressed:c}=b,{prefix:d,x:e,y:f}=a;if(!1===c||"bigint"==typeof e&&"bigint"==typeof f){if(4!==d)throw new kx({prefix:d,cause:new kz});return}if(!0===c||"bigint"==typeof e&&void 0===f){if(3!==d&&2!==d)throw new kx({prefix:d,cause:new ky});return}throw new kw({publicKey:a})}function kt(a){let b=(()=>{if(function(a,b={}){let{strict:c=!1}=b;try{return!function(a,b={}){let{strict:c=!1}=b;if(!a||"string"!=typeof a)throw new jM(a);if(c&&!/^0x[0-9a-fA-F]*$/.test(a)||!a.startsWith("0x"))throw new jN(a)}(a,{strict:c}),!0}catch{return!1}}(a))return ku(a);if(function(a){try{if(!(a instanceof Uint8Array)&&(!a||"object"!=typeof a||!("BYTES_PER_ELEMENT"in a)||1!==a.BYTES_PER_ELEMENT||"Uint8Array"!==a.constructor.name))throw new jV(a);return!0}catch{return!1}}(a))return ku(jF(a));let{prefix:b,x:c,y:d}=a;return"bigint"==typeof c&&"bigint"==typeof d?{prefix:b??4,x:c,y:d}:{prefix:b,x:c}})();return ks(b),b}function ku(a){if(132!==a.length&&130!==a.length&&68!==a.length)throw new kA({publicKey:a});if(130===a.length)return{prefix:4,x:BigInt(jI(a,0,32)),y:BigInt(jI(a,32,64))};if(132===a.length){let b=Number(jI(a,0,1));return{prefix:b,x:BigInt(jI(a,1,33)),y:BigInt(jI(a,33,65))}}return{prefix:Number(jI(a,0,1)),x:BigInt(jI(a,1,33))}}function kv(a,b={}){ks(a);let{prefix:c,x:d,y:e}=a,{includePrefix:f=!0}=b;return jD(f?jG(c,{size:1}):"0x",jG(d,{size:32}),"bigint"==typeof e?jG(e,{size:32}):"0x")}class kw extends jy{constructor({publicKey:a}){super(`Value \`${jB(a)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class kx extends jy{constructor({prefix:a,cause:b}){super(`Prefix "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class ky extends jy{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class kz extends jy{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}class kA extends jy{constructor({publicKey:a}){super(`Value \`${a}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${jJ(jE(a))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}}let kB=/^0x[a-fA-F0-9]{40}$/;function kC(a,b={}){let{strict:c=!0}=b;if(!kB.test(a))throw new kE({address:a,cause:new kF});if(c){if(a.toLowerCase()===a)return;if(kD(a)!==a)throw new kE({address:a,cause:new kG})}}function kD(a){if(kp.has(a))return kp.get(a);kC(a,{strict:!1});let b=a.substring(2).toLowerCase(),c=kr(function(a,b={}){let{size:c}=b,d=jS.encode(a);if("number"==typeof c){var e;if(d.length>c)throw new jW({givenSize:d.length,maxSize:c});return e=d,function(a,b={}){let{dir:c,size:d=32}=b;if(0===d)return a;if(a.length>d)throw new jX({size:a.length,targetSize:d,type:"Bytes"});let e=new Uint8Array(d);for(let b=0;b<d;b++){let f="right"===c;e[f?b:d-b-1]=a[f?b:a.length-b-1]}return e}(e,{dir:"right",size:c})}return d}(b),{as:"Bytes"}),d=b.split("");for(let a=0;a<40;a+=2)c[a>>1]>>4>=8&&d[a]&&(d[a]=d[a].toUpperCase()),(15&c[a>>1])>=8&&d[a+1]&&(d[a+1]=d[a+1].toUpperCase());let e=`0x${d.join("")}`;return kp.set(a,e),e}class kE extends jy{constructor({address:a,cause:b}){super(`Address "${a}" is invalid.`,{cause:b}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class kF extends jy{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class kG extends jy{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function kH(a={}){let{as:b="Hex"}=a,c=kK({as:b}),d=kI({privateKey:c});return{privateKey:c,publicKey:d}}function kI(a){let{privateKey:b}=a;return kt(jv.ProjectivePoint.fromPrivateKey(jE(b).slice(2)))}function kJ(a){let{as:b="Hex",privateKey:c,publicKey:d}=a,e=jv.ProjectivePoint.fromHex(kv(d).slice(2)).multiply(jv.utils.normPrivateKeyToScalar(jE(c).slice(2))).toRawBytes(!0);return"Hex"===b?jF(e):e}function kK(a={}){let{as:b="Hex"}=a,c=jv.utils.randomPrivateKey();return"Hex"===b?jF(c):c}function kL(a){return function(a,b={}){let c=kr(`0x${kv(a).slice(4)}`).substring(26);return function(a,b={}){let{checksum:c=!1}=b;return(kC(a),c)?kD(a):a}(`0x${c}`,b)}(kM(a))}function kM(a){let{payload:b,signature:c}=a,{r:d,s:e,yParity:f}=c;return kt(new jv.Signature(BigInt(d),BigInt(e)).addRecoveryBit(f).recoverPublicKey(jE(b).substring(2)))}function kN(a){let{extraEntropy:b=!1,hash:c,payload:d,privateKey:e}=a,{r:f,s:g,recovery:h}=jv.sign(jT(d),jT(e),{extraEntropy:"boolean"==typeof b?b:jE(b).slice(2),lowS:!0,...c?{prehash:!0}:{}});return{r:f,s:g,yParity:h}}function kO(a){let{address:b,hash:c,payload:d,publicKey:e,signature:f}=a;if(b){var g;return g=kL({payload:d,signature:f}),kC(b,{strict:!1}),kC(g,{strict:!1}),b.toLowerCase()===g.toLowerCase()}return jv.verify(f,jT(d),function(a,b={}){return jU(kv(a,b))}(e),...c?[{prehash:!0,lowS:!0}]:[])}a.s(["createKeyPair",()=>kH,"getPublicKey",()=>kI,"getSharedSecret",()=>kJ,"noble",0,jv,"randomPrivateKey",()=>kK,"recoverAddress",()=>kL,"recoverPublicKey",()=>kM,"sign",()=>kN,"verify",()=>kO],874805);var kP=a.i(874805),kP=kP,kQ=a.i(275730),kR=a.i(553635),kS=a.i(541597),kT=a.i(526629);a.i(875596);var kU=a.i(301704),kV=a.i(840818),kW=a.i(442468),kX=a.i(364547),kY=a.i(89941),kZ=a.i(613071),k$=a.i(911704);let k_="custom_context";var k0=Object.defineProperty,k1=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?k0(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class k2{constructor(a){k1(this,"nodeValue"),k1(this,"sizeInBytes"),k1(this,"next"),this.nodeValue=a,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class k3{constructor(a){k1(this,"lengthInNodes"),k1(this,"sizeInBytes"),k1(this,"head"),k1(this,"tail"),k1(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=a,this.sizeInBytes=0}append(a){let b=new k2(a);if(b.size>this.maxSizeInBytes)throw Error(`[LinkedList] Value too big to insert into list: ${a} with size ${b.size}`);for(;this.size+b.size>this.maxSizeInBytes;)this.shift();this.head?this.tail&&(this.tail.next=b):this.head=b,this.tail=b,this.lengthInNodes++,this.sizeInBytes+=b.size}shift(){if(!this.head)return;let a=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=a.size}toArray(){let a=[],b=this.head;for(;null!==b;)a.push(b.value),b=b.next;return a}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let a=this.head;return{next:()=>{if(!a)return{done:!0,value:null};let b=a.value;return a=a.next,{done:!1,value:b}}}}}var k4=Object.defineProperty,k5=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?k4(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class k6{constructor(a,b=1024e3){k5(this,"logs"),k5(this,"level"),k5(this,"levelValue"),k5(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=a??"error",this.levelValue=kZ.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=b,this.logs=new k3(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(a,b){b===kZ.levels.values.error?console.error(a):b===kZ.levels.values.warn?console.warn(a):b===kZ.levels.values.debug?console.debug(a):b===kZ.levels.values.trace?console.trace(a):console.log(a)}appendToLogs(a){this.logs.append((0,k$.safeJsonStringify)({timestamp:new Date().toISOString(),log:a}));let b="string"==typeof a?JSON.parse(a).level:a.level;b>=this.levelValue&&this.forwardToConsole(a,b)}getLogs(){return this.logs}clearLogs(){this.logs=new k3(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(a){let b=this.getLogArray();return b.push((0,k$.safeJsonStringify)({extraMetadata:a})),new Blob(b,{type:"application/json"})}}var k7=Object.defineProperty;class k8{constructor(a,b=1024e3){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?k7(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"baseChunkLogger"),this.baseChunkLogger=new k6(a,b)}write(a){this.baseChunkLogger.appendToLogs(a)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(a){return this.baseChunkLogger.logsToBlob(a)}}var k9=Object.defineProperty,la=Object.defineProperties,lb=Object.getOwnPropertyDescriptors,lc=Object.getOwnPropertySymbols,ld=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,lf=(a,b,c)=>b in a?k9(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lg=(a,b)=>{for(var c in b||(b={}))ld.call(b,c)&&lf(a,c,b[c]);if(lc)for(var c of lc(b))le.call(b,c)&&lf(a,c,b[c]);return a};function lh(a,b=k_){return a[b]||""}function li(a,b,c=k_){let d=function(a,b,c=k_){let d=lh(a,c);return d.trim()?`${d}/${b}`:b}(a,b,c);return function(a,b,c=k_){return a[c]=b,a}(a.child({context:d}),d,c)}function lj(a){var b;let c;return"u">typeof a.loggerOverride&&"string"!=typeof a.loggerOverride?{logger:a.loggerOverride,chunkLoggerController:null}:(c=new k8(null==(b=a.opts)?void 0:b.level,a.maxSizeInBytes),{logger:(0,kZ.default)(la(lg({},a.opts),lb({level:"trace"})),c),chunkLoggerController:c})}function lk(a){let[b,c]=a.split(":");return{namespace:b,reference:c}}function ll(a,b=[]){let c=[];return Object.keys(a).forEach(d=>{if(b.length&&!b.includes(d))return;let e=a[d];c.push(...e.accounts)}),c}function lm(a,b){return a.includes(":")?[a]:b.chains||[]}var ln=Object.defineProperty,lo=Object.defineProperties,lp=Object.getOwnPropertyDescriptors,lq=Object.getOwnPropertySymbols,lr=Object.prototype.hasOwnProperty,ls=Object.prototype.propertyIsEnumerable,lt=(a,b,c)=>b in a?ln(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,lu=(a,b)=>{for(var c in b||(b={}))lr.call(b,c)&&lt(a,c,b[c]);if(lq)for(var c of lq(b))ls.call(b,c)&&lt(a,c,b[c]);return a},lv=(a,b,c)=>lt(a,"symbol"!=typeof b?b+"":b,c);let lw="react-native",lx="node",ly="browser";function lz(){return"u">typeof process&&"u">typeof process.versions&&"u">typeof process.versions.node}function lA(){return!(0,ik.getDocument)()&&!!(0,ik.getNavigator)()&&"ReactNative"===navigator.product}function lB(){return!lz()&&!!(0,ik.getNavigator)()&&!!(0,ik.getDocument)()}function lC(){return lA()?lw:lz()?lx:lB()?ly:"unknown"}function lD(){var b;try{return lA()&&"u">typeof(null==a.g?void 0:a.g.Application)?null==(b=a.g.Application)?void 0:b.applicationId:void 0}catch{return}}function lE(){return(0,il.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function lF(b,c,d){var e;let f,g=function(){if(lC()===lw&&"u">typeof(null==a.g?void 0:a.g.Platform)){let{OS:b,Version:c}=a.g.Platform;return[b,c].join("-")}let b=(0,ii.detect)();if(null===b)return"unknown";let c=b.os?b.os.replace(" ","").toLowerCase():"unknown";return"browser"===b.type?[c,b.name,b.version].join("-"):[c,b.version].join("-")}(),h=(f=lC())===ly?[f,(null==(e=(0,ik.getLocation)())?void 0:e.host)||"unknown"].join(":"):f;return[[b,c].join("-"),["js",d].join("-"),g,h].join("/")}function lG(a,b){return a.filter(a=>b.includes(a)).length===a.length}function lH(a){return Object.fromEntries(a.entries())}function lI(a){return new Map(Object.entries(a))}function lJ(a=ij.FIVE_MINUTES,b){let c,d,e,f,g=(0,ij.toMiliseconds)(a||ij.FIVE_MINUTES);return{resolve:a=>{e&&c&&(clearTimeout(e),c(a),f=Promise.resolve(a))},reject:a=>{e&&d&&(clearTimeout(e),d(a))},done:()=>new Promise((a,h)=>{if(f)return a(f);e=setTimeout(()=>{let a=Error(b);f=Promise.reject(a),h(a)},g),c=a,d=h})}}function lK(a,b,c){return new Promise(async(d,e)=>{let f=setTimeout(()=>e(Error(c)),b);try{let b=await a;d(b)}catch(a){e(a)}clearTimeout(f)})}function lL(a,b){if("string"==typeof b&&b.startsWith(`${a}:`))return b;if("topic"===a.toLowerCase()){if("string"!=typeof b)throw Error('Value must be "string" for expirer target type: topic');return`topic:${b}`}if("id"===a.toLowerCase()){if("number"!=typeof b)throw Error('Value must be "number" for expirer target type: id');return`id:${b}`}throw Error(`Unknown expirer target type: ${a}`)}function lM(a){let[b,c]=a.split(":"),d={id:void 0,topic:void 0};if("topic"===b&&"string"==typeof c)d.topic=c;else if("id"===b&&Number.isInteger(Number(c)))d.id=Number(c);else throw Error(`Invalid target, expected id:number or topic:string, got ${b}:${c}`);return d}function lN(a,b){return(0,ij.fromMiliseconds)((b||Date.now())+(0,ij.toMiliseconds)(a))}function lO(a){return Date.now()>=(0,ij.toMiliseconds)(a)}function lP(a,b){return`${a}${b?`:${b}`:""}`}function lQ(a=[],b=[]){return[...new Set([...a,...b])]}async function lR({id:b,topic:c,wcDeepLink:d}){var e,f;try{if(!d)return;let g="string"==typeof d?JSON.parse(d):d,h=g?.href;if("string"!=typeof h)return;let i=function(a,b,c){let d=`requestId=${b}&sessionTopic=${c}`;a.endsWith("/")&&(a=a.slice(0,-1));let e=`${a}`;if(a.startsWith("https://t.me")){let b=a.includes("?")?"&startapp=":"?startapp=";e=`${e}${b}${function(a,b=!1){let c=Buffer.from(a).toString("base64");return b?c.replace(/[=]/g,""):c}(d,!0)}`}else e=`${e}/wc?${d}`;return e}(h,b,c),j=lC();if(j===ly){let a;if(!(null!=(e=(0,ik.getDocument)())&&e.hasFocus()))return void console.warn("Document does not have focus, skipping deeplink.");f=i,a="_self",!function(){try{return window.self!==window.top}catch{return!1}}()?(f.startsWith("https://")||f.startsWith("http://"))&&(a="_blank"):a="_top",window.open(f,a,"noreferrer noopener")}else j===lw&&"u">typeof(null==a.g?void 0:a.g.Linking)&&await a.g.Linking.openURL(i)}catch(a){console.error(a)}}async function lS(a,b){let c="";try{if(lB()&&(c=localStorage.getItem(b)))return c;c=await a.getItem(b)}catch(a){console.error(a)}return c}function lT(a,b){if(!a.includes(b))return null;let c=a.split(/([&,?,=])/),d=c.indexOf(b);return c[d+2]}function lU(){return"u">typeof crypto&&null!=crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function lV(){return"u">typeof process&&"true"===process.env.IS_VITEST}function lW(a){return Buffer.from(a,"base64").toString("utf-8")}class lX{constructor({limit:a}){lv(this,"limit"),lv(this,"set"),this.limit=a,this.set=new Set}add(a){if(!this.set.has(a)){if(this.set.size>=this.limit){let a=this.set.values().next().value;a&&this.set.delete(a)}this.set.add(a)}}has(a){return this.set.has(a)}}let lY=BigInt(0x100000000-1),lZ=BigInt(32);function l$(a,b=!1){return b?{h:Number(a&lY),l:Number(a>>lZ&lY)}:{h:0|Number(a>>lZ&lY),l:0|Number(a&lY)}}function l_(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=l$(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}let l0=(a,b,c)=>a>>>c,l1=(a,b,c)=>a<<32-c|b>>>c,l2=(a,b,c)=>a>>>c|b<<32-c,l3=(a,b,c)=>a<<32-c|b>>>c,l4=(a,b,c)=>a<<64-c|b>>>c-32,l5=(a,b,c)=>a>>>c-32|b<<64-c;function l6(a,b,c,d){let e=(b>>>0)+(d>>>0);return{h:a+c+(e/0x100000000|0)|0,l:0|e}}let l7=(a,b,c)=>(a>>>0)+(b>>>0)+(c>>>0),l8=(a,b,c,d)=>b+c+d+(a/0x100000000|0)|0,l9=(a,b,c,d)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0),ma=(a,b,c,d,e)=>b+c+d+e+(a/0x100000000|0)|0,mb=(a,b,c,d,e)=>(a>>>0)+(b>>>0)+(c>>>0)+(d>>>0)+(e>>>0),mc=(a,b,c,d,e,f)=>b+c+d+e+f+(a/0x100000000|0)|0,md="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function me(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function mf(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function mg(a,...b){if(!me(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function mh(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");mf(a.outputLen),mf(a.blockLen)}function mi(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function mj(a,b){mg(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}function mk(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ml(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function mm(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function mn(a,b){return a<<32-b|a>>>b}let mo=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function mp(a){return a<<24&0xff000000|a<<8&0xff0000|a>>>8&65280|a>>>24&255}let mq=mo?a=>a:a=>mp(a),mr=mo?a=>a:function(a){for(let b=0;b<a.length;b++)a[b]=mp(a[b]);return a},ms="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,mt=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function mu(a){if(mg(a),ms)return a.toHex();let b="";for(let c=0;c<a.length;c++)b+=mt[a[c]];return b}function mv(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function mw(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(ms)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=mv(a.charCodeAt(e)),f=mv(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}function mx(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function my(a){return"string"==typeof a&&(a=mx(a)),mg(a),a}function mz(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];mg(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}class mA{}function mB(a){let b=b=>a().update(my(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}function mC(a=32){if(md&&"function"==typeof md.getRandomValues)return md.getRandomValues(new Uint8Array(a));if(md&&"function"==typeof md.randomBytes)return Uint8Array.from(md.randomBytes(a));throw Error("crypto.getRandomValues must be defined")}let mD=BigInt(0),mE=BigInt(1),mF=BigInt(2),mG=BigInt(7),mH=BigInt(256),mI=BigInt(113),mJ=[],mK=[],mL=[];for(let a=0,b=mE,c=1,d=0;a<24;a++){[c,d]=[d,(2*c+3*d)%5],mJ.push(2*(5*d+c)),mK.push((a+1)*(a+2)/2%64);let e=mD;for(let a=0;a<7;a++)(b=(b<<mE^(b>>mG)*mI)%mH)&mF&&(e^=mE<<(mE<<BigInt(a))-mE);mL.push(e)}let mM=l_(mL,!0),mN=mM[0],mO=mM[1],mP=(a,b,c)=>c>32?b<<c-32|a>>>64-c:a<<c|b>>>32-c,mQ=(a,b,c)=>c>32?a<<c-32|b>>>64-c:b<<c|a>>>32-c;class mR extends mA{constructor(a,b,c,d=!1,e=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=a,this.suffix=b,this.outputLen=c,this.enableXOF=d,this.rounds=e,mf(c),!(0<a&&a<200))throw Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=mk(this.state)}clone(){return this._cloneInto()}keccak(){mr(this.state32),function(a,b=24){let c=new Uint32Array(10);for(let d=24-b;d<24;d++){for(let b=0;b<10;b++)c[b]=a[b]^a[b+10]^a[b+20]^a[b+30]^a[b+40];for(let b=0;b<10;b+=2){let d=(b+8)%10,e=(b+2)%10,f=c[e],g=c[e+1],h=mP(f,g,1)^c[d],i=mQ(f,g,1)^c[d+1];for(let c=0;c<50;c+=10)a[b+c]^=h,a[b+c+1]^=i}let b=a[2],e=a[3];for(let c=0;c<24;c++){let d=mK[c],f=mP(b,e,d),g=mQ(b,e,d),h=mJ[c];b=a[h],e=a[h+1],a[h]=f,a[h+1]=g}for(let b=0;b<50;b+=10){for(let d=0;d<10;d++)c[d]=a[b+d];for(let d=0;d<10;d++)a[b+d]^=~c[(d+2)%10]&c[(d+4)%10]}a[0]^=mN[d],a[1]^=mO[d]}ml(c)}(this.state32,this.rounds),mr(this.state32),this.posOut=0,this.pos=0}update(a){mi(this),mg(a=my(a));let{blockLen:b,state:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(b-this.pos,d-e);for(let b=0;b<f;b++)c[this.pos++]^=a[e++];this.pos===b&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:a,suffix:b,pos:c,blockLen:d}=this;a[c]^=b,(128&b)!=0&&c===d-1&&this.keccak(),a[d-1]^=128,this.keccak()}writeInto(a){mi(this,!1),mg(a),this.finish();let b=this.state,{blockLen:c}=this;for(let d=0,e=a.length;d<e;){this.posOut>=c&&this.keccak();let f=Math.min(c-this.posOut,e-d);a.set(b.subarray(this.posOut,this.posOut+f),d),this.posOut+=f,d+=f}return a}xofInto(a){if(!this.enableXOF)throw Error("XOF is not possible for this instance");return this.writeInto(a)}xof(a){return mf(a),this.xofInto(new Uint8Array(a))}digestInto(a){if(mj(a,this),this.finished)throw Error("digest() was already called");return this.writeInto(a),this.destroy(),a}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,ml(this.state)}_cloneInto(a){let{blockLen:b,suffix:c,outputLen:d,rounds:e,enableXOF:f}=this;return a||(a=new mR(b,c,d,f,e)),a.state32.set(this.state32),a.pos=this.pos,a.posOut=this.posOut,a.finished=this.finished,a.rounds=e,a.suffix=c,a.outputLen=d,a.enableXOF=f,a.destroyed=this.destroyed,a}}let mS=mB(()=>new mR(136,1,32));class mT extends mA{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=mm(this.buffer)}update(a){mi(this),mg(a=my(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=mm(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){mi(this),mj(a,this),this.finished=!0;let{buffer:b,view:c,blockLen:d,isLE:e}=this,{pos:f}=this;b[f++]=128,ml(this.buffer.subarray(f)),this.padOffset>d-f&&(this.process(c,0),f=0);for(let a=f;a<d;a++)b[a]=0;(function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)})(c,d-8,BigInt(8*this.length),e),this.process(c,0);let g=mm(a),h=this.outputLen;if(h%4)throw Error("_sha2: outputLen should be aligned to 32bit");let i=h/4,j=this.get();if(i>j.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<i;a++)g.setUint32(4*a,j[a],e)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let mU=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),mV=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),mW=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),mX=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),mY=new Uint32Array(64);class mZ extends mT{constructor(a=32){super(64,a,8,!1),this.A=0|mU[0],this.B=0|mU[1],this.C=0|mU[2],this.D=0|mU[3],this.E=0|mU[4],this.F=0|mU[5],this.G=0|mU[6],this.H=0|mU[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)mY[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=mY[a-15],c=mY[a-2],d=mn(b,7)^mn(b,18)^b>>>3,e=mn(c,17)^mn(c,19)^c>>>10;mY[a]=e+mY[a-7]+d+mY[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(mn(g,6)^mn(g,11)^mn(g,25))+((k=g)&h^~k&i)+mX[a]+mY[a]|0,o=(mn(c,2)^mn(c,13)^mn(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){ml(mY)}destroy(){this.set(0,0,0,0,0,0,0,0),ml(this.buffer)}}let m$=l_(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),m_=m$[0],m0=m$[1],m1=new Uint32Array(80),m2=new Uint32Array(80);class m3 extends mT{constructor(a=64){super(128,a,16,!1),this.Ah=0|mW[0],this.Al=0|mW[1],this.Bh=0|mW[2],this.Bl=0|mW[3],this.Ch=0|mW[4],this.Cl=0|mW[5],this.Dh=0|mW[6],this.Dl=0|mW[7],this.Eh=0|mW[8],this.El=0|mW[9],this.Fh=0|mW[10],this.Fl=0|mW[11],this.Gh=0|mW[12],this.Gl=0|mW[13],this.Hh=0|mW[14],this.Hl=0|mW[15]}get(){let{Ah:a,Al:b,Bh:c,Bl:d,Ch:e,Cl:f,Dh:g,Dl:h,Eh:i,El:j,Fh:k,Fl:l,Gh:m,Gl:n,Hh:o,Hl:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.Ah=0|a,this.Al=0|b,this.Bh=0|c,this.Bl=0|d,this.Ch=0|e,this.Cl=0|f,this.Dh=0|g,this.Dl=0|h,this.Eh=0|i,this.El=0|j,this.Fh=0|k,this.Fl=0|l,this.Gh=0|m,this.Gl=0|n,this.Hh=0|o,this.Hl=0|p}process(a,b){for(let c=0;c<16;c++,b+=4)m1[c]=a.getUint32(b),m2[c]=a.getUint32(b+=4);for(let a=16;a<80;a++){let b=0|m1[a-15],c=0|m2[a-15],d=l2(b,c,1)^l2(b,c,8)^l0(b,c,7),e=l3(b,c,1)^l3(b,c,8)^l1(b,c,7),f=0|m1[a-2],g=0|m2[a-2],h=l2(f,g,19)^l4(f,g,61)^l0(f,g,6),i=l9(e,l3(f,g,19)^l5(f,g,61)^l1(f,g,6),m2[a-7],m2[a-16]),j=ma(i,d,h,m1[a-7],m1[a-16]);m1[a]=0|j,m2[a]=0|i}let{Ah:c,Al:d,Bh:e,Bl:f,Ch:g,Cl:h,Dh:i,Dl:j,Eh:k,El:l,Fh:m,Fl:n,Gh:o,Gl:p,Hh:q,Hl:r}=this;for(let a=0;a<80;a++){let b=l2(k,l,14)^l2(k,l,18)^l4(k,l,41),s=l3(k,l,14)^l3(k,l,18)^l5(k,l,41),t=k&m^~k&o,u=mb(r,s,l&n^~l&p,m0[a],m2[a]),v=mc(u,q,b,t,m_[a],m1[a]),w=0|u,x=l2(c,d,28)^l4(c,d,34)^l4(c,d,39),y=l3(c,d,28)^l5(c,d,34)^l5(c,d,39),z=c&e^c&g^e&g,A=d&f^d&h^f&h;q=0|o,r=0|p,o=0|m,p=0|n,m=0|k,n=0|l,({h:k,l:l}=l6(0|i,0|j,0|v,0|w)),i=0|g,j=0|h,g=0|e,h=0|f,e=0|c,f=0|d;let B=l7(w,y,A);c=l8(B,v,x,z),d=0|B}({h:c,l:d}=l6(0|this.Ah,0|this.Al,0|c,0|d)),({h:e,l:f}=l6(0|this.Bh,0|this.Bl,0|e,0|f)),({h:g,l:h}=l6(0|this.Ch,0|this.Cl,0|g,0|h)),({h:i,l:j}=l6(0|this.Dh,0|this.Dl,0|i,0|j)),({h:k,l:l}=l6(0|this.Eh,0|this.El,0|k,0|l)),({h:m,l:n}=l6(0|this.Fh,0|this.Fl,0|m,0|n)),({h:o,l:p}=l6(0|this.Gh,0|this.Gl,0|o,0|p)),({h:q,l:r}=l6(0|this.Hh,0|this.Hl,0|q,0|r)),this.set(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r)}roundClean(){ml(m1,m2)}destroy(){ml(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class m4 extends m3{constructor(){super(48),this.Ah=0|mV[0],this.Al=0|mV[1],this.Bh=0|mV[2],this.Bl=0|mV[3],this.Ch=0|mV[4],this.Cl=0|mV[5],this.Dh=0|mV[6],this.Dl=0|mV[7],this.Eh=0|mV[8],this.El=0|mV[9],this.Fh=0|mV[10],this.Fl=0|mV[11],this.Gh=0|mV[12],this.Gl=0|mV[13],this.Hh=0|mV[14],this.Hl=0|mV[15]}}let m5=Uint32Array.from([0x22312194,0xfc2bf72c,0x9f555fa3,0xc84c64c2,0x2393b86b,0x6f53b151,0x96387719,0x5940eabd,0x96283ee2,0xa88effe3,0xbe5e1e25,0x53863992,0x2b0199fc,0x2c85b8aa,0xeb72ddc,0x81c52ca2]);class m6 extends m3{constructor(){super(32),this.Ah=0|m5[0],this.Al=0|m5[1],this.Bh=0|m5[2],this.Bl=0|m5[3],this.Ch=0|m5[4],this.Cl=0|m5[5],this.Dh=0|m5[6],this.Dl=0|m5[7],this.Eh=0|m5[8],this.El=0|m5[9],this.Fh=0|m5[10],this.Fl=0|m5[11],this.Gh=0|m5[12],this.Gl=0|m5[13],this.Hh=0|m5[14],this.Hl=0|m5[15]}}let m7=mB(()=>new mZ),m8=mB(()=>new m3),m9=mB(()=>new m4),na=mB(()=>new m6),nb=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),nc=Uint32Array.from([0xf3bcc908,0x6a09e667,0x84caa73b,0xbb67ae85,0xfe94f82b,0x3c6ef372,0x5f1d36f1,0xa54ff53a,0xade682d1,0x510e527f,0x2b3e6c1f,0x9b05688c,0xfb41bd6b,0x1f83d9ab,0x137e2179,0x5be0cd19]),nd=new Uint32Array(32);function ne(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=nd[2*a],j=nd[2*a+1],k=nd[2*b],l=nd[2*b+1],m=nd[2*c],n=nd[2*c+1],o=nd[2*d],p=nd[2*d+1],q=l7(i,k,g);j=l8(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:o,Dl:p}),({h:n,l:m}=l6(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:l2(l,k,24),Bl:l3(l,k,24)}),nd[2*a]=i,nd[2*a+1]=j,nd[2*b]=k,nd[2*b+1]=l,nd[2*c]=m,nd[2*c+1]=n,nd[2*d]=o,nd[2*d+1]=p}function nf(a,b,c,d,e,f){let g=e[f],h=e[f+1],i=nd[2*a],j=nd[2*a+1],k=nd[2*b],l=nd[2*b+1],m=nd[2*c],n=nd[2*c+1],o=nd[2*d],p=nd[2*d+1],q=l7(i,k,g);j=l8(q,j,l,h),i=0|q,({Dh:p,Dl:o}={Dh:p^j,Dl:o^i}),({Dh:p,Dl:o}={Dh:l2(p,o,16),Dl:l3(p,o,16)}),({h:n,l:m}=l6(n,m,p,o)),({Bh:l,Bl:k}={Bh:l^n,Bl:k^m}),({Bh:l,Bl:k}={Bh:l4(l,k,63),Bl:l5(l,k,63)}),nd[2*a]=i,nd[2*a+1]=j,nd[2*b]=k,nd[2*b+1]=l,nd[2*c]=m,nd[2*c+1]=n,nd[2*d]=o,nd[2*d+1]=p}class ng extends mA{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,mf(a),mf(b),this.blockLen=a,this.outputLen=b,this.buffer=new Uint8Array(a),this.buffer32=mk(this.buffer)}update(a){mi(this),mg(a=my(a));let{blockLen:b,buffer:c,buffer32:d}=this,e=a.length,f=a.byteOffset,g=a.buffer;for(let h=0;h<e;){this.pos===b&&(mr(d),this.compress(d,0,!1),mr(d),this.pos=0);let i=Math.min(b-this.pos,e-h),j=f+h;if(i===b&&!(j%4)&&h+i<e){let a=new Uint32Array(g,j,Math.floor((e-h)/4));mr(a);for(let c=0;h+b<e;c+=d.length,h+=b)this.length+=b,this.compress(a,c,!1);mr(a);continue}c.set(a.subarray(h,h+i),this.pos),this.pos+=i,this.length+=i,h+=i}return this}digestInto(a){mi(this),mj(a,this);let{pos:b,buffer32:c}=this;this.finished=!0,ml(this.buffer.subarray(b)),mr(c),this.compress(c,0,!0),mr(c);let d=mk(a);this.get().forEach((a,b)=>d[b]=mq(a))}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){let{buffer:b,length:c,finished:d,destroyed:e,outputLen:f,pos:g}=this;return a||(a=new this.constructor({dkLen:f})),a.set(...this.get()),a.buffer.set(b),a.destroyed=e,a.finished=d,a.length=c,a.pos=g,a.outputLen=f,a}clone(){return this._cloneInto()}}class nh extends ng{constructor(a={}){const b=void 0===a.dkLen?64:a.dkLen;super(128,b),this.v0l=0|nc[0],this.v0h=0|nc[1],this.v1l=0|nc[2],this.v1h=0|nc[3],this.v2l=0|nc[4],this.v2h=0|nc[5],this.v3l=0|nc[6],this.v3h=0|nc[7],this.v4l=0|nc[8],this.v4h=0|nc[9],this.v5l=0|nc[10],this.v5h=0|nc[11],this.v6l=0|nc[12],this.v6h=0|nc[13],this.v7l=0|nc[14],this.v7h=0|nc[15],function(a,b={},c,d,e){if(mf(64),a<0||a>64)throw Error("outputLen bigger than keyLen");let{key:f,salt:g,personalization:h}=b;if(void 0!==f&&(f.length<1||f.length>64))throw Error("key length must be undefined or 1..64");if(void 0!==g&&16!==g.length)throw Error("salt must be undefined or 16");if(void 0!==h&&16!==h.length)throw Error("personalization must be undefined or 16")}(b,a,0,0,0);let{key:c,personalization:d,salt:e}=a,f=0;if(void 0!==c&&(f=(c=my(c)).length),this.v0l^=this.outputLen|f<<8|0x1010000,void 0!==e){const a=mk(e=my(e));this.v4l^=mq(a[0]),this.v4h^=mq(a[1]),this.v5l^=mq(a[2]),this.v5h^=mq(a[3])}if(void 0!==d){const a=mk(d=my(d));this.v6l^=mq(a[0]),this.v6h^=mq(a[1]),this.v7l^=mq(a[2]),this.v7h^=mq(a[3])}if(void 0!==c){const a=new Uint8Array(this.blockLen);a.set(c),this.update(a)}}get(){let{v0l:a,v0h:b,v1l:c,v1h:d,v2l:e,v2h:f,v3l:g,v3h:h,v4l:i,v4h:j,v5l:k,v5h:l,v6l:m,v6h:n,v7l:o,v7h:p}=this;return[a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p]}set(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.v0l=0|a,this.v0h=0|b,this.v1l=0|c,this.v1h=0|d,this.v2l=0|e,this.v2h=0|f,this.v3l=0|g,this.v3h=0|h,this.v4l=0|i,this.v4h=0|j,this.v5l=0|k,this.v5h=0|l,this.v6l=0|m,this.v6h=0|n,this.v7l=0|o,this.v7h=0|p}compress(a,b,c){this.get().forEach((a,b)=>nd[b]=a),nd.set(nc,16);let{h:d,l:e}=l$(BigInt(this.length));nd[24]=nc[8]^e,nd[25]=nc[9]^d,c&&(nd[28]=~nd[28],nd[29]=~nd[29]);let f=0;for(let c=0;c<12;c++)ne(0,4,8,12,a,b+2*nb[f++]),nf(0,4,8,12,a,b+2*nb[f++]),ne(1,5,9,13,a,b+2*nb[f++]),nf(1,5,9,13,a,b+2*nb[f++]),ne(2,6,10,14,a,b+2*nb[f++]),nf(2,6,10,14,a,b+2*nb[f++]),ne(3,7,11,15,a,b+2*nb[f++]),nf(3,7,11,15,a,b+2*nb[f++]),ne(0,5,10,15,a,b+2*nb[f++]),nf(0,5,10,15,a,b+2*nb[f++]),ne(1,6,11,12,a,b+2*nb[f++]),nf(1,6,11,12,a,b+2*nb[f++]),ne(2,7,8,13,a,b+2*nb[f++]),nf(2,7,8,13,a,b+2*nb[f++]),ne(3,4,9,14,a,b+2*nb[f++]),nf(3,4,9,14,a,b+2*nb[f++]);this.v0l^=nd[0]^nd[16],this.v0h^=nd[1]^nd[17],this.v1l^=nd[2]^nd[18],this.v1h^=nd[3]^nd[19],this.v2l^=nd[4]^nd[20],this.v2h^=nd[5]^nd[21],this.v3l^=nd[6]^nd[22],this.v3h^=nd[7]^nd[23],this.v4l^=nd[8]^nd[24],this.v4h^=nd[9]^nd[25],this.v5l^=nd[10]^nd[26],this.v5h^=nd[11]^nd[27],this.v6l^=nd[12]^nd[28],this.v6h^=nd[13]^nd[29],this.v7l^=nd[14]^nd[30],this.v7h^=nd[15]^nd[31],ml(nd)}destroy(){this.destroyed=!0,ml(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}let ni=(DU=a=>new nh(a),(M=(a,b)=>DU(b).update(my(a)).digest()).outputLen=(N=DU({})).outputLen,M.blockLen=N.blockLen,M.create=a=>DU(a),M);function nj(a){let b=`Ethereum Signed Message:
${a.length}`,c=new TextEncoder().encode(b+a);return"0x"+Buffer.from(mS(c)).toString("hex")}async function nk(a,b,c,d,e,f){switch(c.t){case"eip191":var g,h,i;let j;return await (g=a,h=b,i=c.s,j=kn.fromHex(i),kP.recoverAddress({payload:nj(h),signature:j}).toLowerCase()===g.toLowerCase());case"eip1271":return await nl(a,b,c.s,d,e,f);default:throw Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${c.t}`)}}async function nl(a,b,c,d,e,f){let g=lk(d);if(!g.namespace||!g.reference)throw Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${d}`);try{let g="0x1626ba7e",h=c.substring(2),i=(h.length/2).toString(16).padStart(64,"0"),j=(b.startsWith("0x")?b:nj(b)).substring(2),k=g+j+"0000000000000000000000000000000000000000000000000000000000000040"+i+h,l=await fetch(`${f||"https://rpc.walletconnect.org/v1"}/?chainId=${d}&projectId=${e}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Date.now()+Math.floor(1e3*Math.random()),jsonrpc:"2.0",method:"eth_call",params:[{to:a,data:k},"latest"]})}),{result:m}=await l.json();return!!m&&m.slice(0,g.length).toLowerCase()===g.toLowerCase()}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function nm(a){let b=new Uint8Array(m7(function(a){if(a instanceof Uint8Array)return a;if(Array.isArray(a))return new Uint8Array(a);if("object"==typeof a&&null!=a&&a.data)return new Uint8Array(Object.values(a.data));if("object"==typeof a&&a)return new Uint8Array(Object.values(a));throw Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}(a)));return kQ.default.encode(b)}function nn(a){let b=Buffer.from(a,"base64"),c=(0,kR.decode)(b).txn;if(!c)throw Error("Invalid signed transaction: missing 'txn' field");let d=(0,kS.encode)(c),e=Buffer.from("TX"),f=na(Buffer.concat([e,Buffer.from(d)]));return fL.base32.encode(f).replace(/=+$/,"")}function no(a){let b=[],c=BigInt(a);for(;c>=BigInt(128);)b.push(Number(c&BigInt(127)|BigInt(128))),c>>=BigInt(7);return b.push(Number(c)),Buffer.from(b)}var np=Object.defineProperty,nq=Object.defineProperties,nr=Object.getOwnPropertyDescriptors,ns=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,nu=Object.prototype.propertyIsEnumerable,nv=(a,b,c)=>b in a?np(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;let nw=a=>a?.split(":"),nx=a=>{let b=a&&nw(a);if(b)return b[2]+":"+b[3]},ny=a=>{let b=a&&nw(a);if(b)return b.pop()};async function nz(a){let{cacao:b,projectId:c}=a,{s:d,p:e}=b,f=nA(e,e.iss),g=ny(e.iss);return await nk(g,f,d,nx(e.iss),c)}let nA=(a,b)=>{let c=`${a.domain} wants you to sign in with your Ethereum account:`,d=ny(b);if(!a.aud&&!a.uri)throw Error("Either `aud` or `uri` is required to construct the message");let e=a.statement||void 0,f=`URI: ${a.aud||a.uri}`,g=`Version: ${a.version}`,h=`Chain ID: ${(a=>{let b=a&&nw(a);if(b)return a.includes("did:pkh:")?b[3]:b[1]})(b)}`,i=`Nonce: ${a.nonce}`,j=`Issued At: ${a.iat}`,k=a.exp?`Expiration Time: ${a.exp}`:void 0,l=a.nbf?`Not Before: ${a.nbf}`:void 0,m=a.requestId?`Request ID: ${a.requestId}`:void 0,n=a.resources?`Resources:${a.resources.map(a=>`
- ${a}`).join("")}`:void 0,o=nG(a.resources);return o&&(e=function(a="",b){nB(b);let c="I further authorize the stated URI to perform the following actions on my behalf: ";if(a.includes(c))return a;let d=[],e=0;Object.keys(b.att).forEach(a=>{let c=Object.keys(b.att[a]).map(a=>({ability:a.split("/")[0],action:a.split("/")[1]}));c.sort((a,b)=>a.action.localeCompare(b.action));let f={};c.forEach(a=>{f[a.ability]||(f[a.ability]=[]),f[a.ability].push(a.action)});let g=Object.keys(f).map(b=>(e++,`(${e}) '${b}': '${f[b].join("', '")}' for '${a}'.`));d.push(g.join(", ").replace(".,","."))});let f=d.join(" "),g=`${c}${f}`;return`${a?a+" ":""}${g}`}(e,nD(o))),[c,d,"",e,"",f,g,h,i,j,k,l,m,n].filter(a=>null!=a).join(`
`)};function nB(a){if(!a)throw Error("No recap provided, value is undefined");if(!a.att)throw Error("No `att` property found");let b=Object.keys(a.att);if(!(null!=b&&b.length))throw Error("No resources found in `att` property");b.forEach(b=>{let c=a.att[b];if(Array.isArray(c)||"object"!=typeof c)throw Error(`Resource must be an object: ${b}`);if(!Object.keys(c).length)throw Error(`Resource object is empty: ${b}`);Object.keys(c).forEach(a=>{let b=c[a];if(!Array.isArray(b))throw Error(`Ability limits ${a} must be an array of objects, found: ${b}`);if(!b.length)throw Error(`Value of ${a} is empty array, must be an array with objects`);b.forEach(b=>{if("object"!=typeof b)throw Error(`Ability limits (${a}) must be an array of objects, found: ${b}`)})})})}function nC(a){return nB(a),`urn:recap:${Buffer.from(JSON.stringify(a)).toString("base64").replace(/=/g,"")}`}function nD(a){var b;let c=(b=a.replace("urn:recap:",""),JSON.parse(Buffer.from(b,"base64").toString("utf-8")));return nB(c),c}function nE(a){var b;let c=nD(a);nB(c);let d=null==(b=c.att)?void 0:b.eip155;return d?Object.keys(d).map(a=>a.split("/")[1]):[]}function nF(a){let b=nD(a);nB(b);let c=[];return Object.values(b.att).forEach(a=>{Object.values(a).forEach(a=>{var b;null!=(b=a?.[0])&&b.chains&&c.push(a[0].chains)})}),[...new Set(c.flat())]}function nG(a){if(!a)return;let b=a?.[a.length-1];return b&&b.includes("urn:recap:")?b:void 0}function nH(a){return a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name}function nI(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function nJ(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function nK(a,...b){if(!nH(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function nL(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function nM(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function nN(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let nO=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0];function nP(a){if("string"==typeof a)a=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(a);else if(nH(a))a=nS(a);else throw Error("Uint8Array expected, got "+typeof a);return a}function nQ(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error("invalid output length, expected "+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function nR(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function nS(a){return Uint8Array.from(a)}let nT=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),nU=nT("expand 16-byte k"),nV=nT("expand 32-byte k"),nW=nM(nU),nX=nM(nV);function nY(a,b){return a<<b|a>>>32-b}function nZ(a){return a.byteOffset%4==0}let n$=0x100000000-1,n_=new Uint32Array,n0=(a,b)=>255&a[b++]|(255&a[b++])<<8;class n1{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,nK(a=nP(a),32);const b=n0(a,0),c=n0(a,2),d=n0(a,4),e=n0(a,6),f=n0(a,8),g=n0(a,10),h=n0(a,12),i=n0(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=n0(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=n0(a,b+0),q=n0(a,b+2),r=n0(a,b+4),s=n0(a,b+6),t=n0(a,b+8),u=n0(a,b+10),v=n0(a,b+12),w=n0(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;nN(c)}update(a){nL(this),nK(a=nP(a));let{buffer:b,blockLen:c}=this,d=a.length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){nN(this.h,this.r,this.buffer,this.pad)}digestInto(a){nL(this),function(a,b){nK(a);let c=b.outputLen;if(a.length<c)throw Error("digestInto() expects output buffer of length at least "+c)}(a,this),this.finished=!0;let{buffer:b,h:c}=this,{pos:d}=this;if(d){for(b[d++]=1;d<16;d++)b[d]=0;this.process(b,0,!0)}this.finalize();let e=0;for(let b=0;b<8;b++)a[e++]=c[b]>>>0,a[e++]=c[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let n2=(DV=a=>new n1(a),(O=(a,b)=>DV(b).update(nP(a)).digest()).outputLen=(P=DV(new Uint8Array(32))).outputLen,O.blockLen=P.blockLen,O.create=a=>DV(a),O),n3=function(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return nJ(e),nJ(g),nI(f),nI(c),(b,h,i,j,k=0)=>{nK(b),nK(h),nK(i);let l=i.length;if(void 0===j&&(j=new Uint8Array(l)),nK(j),nJ(k),k<0||k>=n$)throw Error("arx: counter overflow");if(j.length<l)throw Error(`arx: output (${j.length}) is shorter than data (${l})`);let m=[],n=b.length,o,p;if(32===n)m.push(o=nS(b)),p=nX;else if(16===n&&c)(o=new Uint8Array(32)).set(b),o.set(b,16),p=nW,m.push(o);else throw Error(`arx: invalid 32-byte key, got length=${n}`);nZ(h)||m.push(h=nS(h));let q=nM(o);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(p,q,nM(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,m.push(h)}return function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=nM(j),l=nZ(e)&&nZ(f),m=l?nM(e):n_,n=l?nM(f):n_;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=n$)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,p,q,nM(h),i,j,k,g),nN(...m),j}}(function(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=nY(H^(v=v+z|0),16))|0,v=v+(z=nY(z^D,12))|0,D=D+(H=nY(H^v,8))|0,z=nY(z^D,7),E=E+(I=nY(I^(w=w+A|0),16))|0,w=w+(A=nY(A^E,12))|0,E=E+(I=nY(I^w,8))|0,A=nY(A^E,7),F=F+(J=nY(J^(x=x+B|0),16))|0,x=x+(B=nY(B^F,12))|0,F=F+(J=nY(J^x,8))|0,B=nY(B^F,7),G=G+(K=nY(K^(y=y+C|0),16))|0,y=y+(C=nY(C^G,12))|0,G=G+(K=nY(K^y,8))|0,C=nY(C^G,7),F=F+(K=nY(K^(v=v+A|0),16))|0,v=v+(A=nY(A^F,12))|0,F=F+(K=nY(K^v,8))|0,A=nY(A^F,7),G=G+(H=nY(H^(w=w+B|0),16))|0,w=w+(B=nY(B^G,12))|0,G=G+(H=nY(H^w,8))|0,B=nY(B^G,7),D=D+(I=nY(I^(x=x+C|0),16))|0,x=x+(C=nY(C^D,12))|0,D=D+(I=nY(I^x,8))|0,C=nY(C^D,7),E=E+(J=nY(J^(y=y+z|0),16))|0,y=y+(z=nY(z^E,12))|0,E=E+(J=nY(J^y,8))|0,z=nY(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0},{counterRight:!1,counterLength:4,allowShortKeys:!1}),n4=new Uint8Array(16),n5=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(n4.subarray(c))},n6=new Uint8Array(32);function n7(a,b,c,d,e){var f,g;let h,i,j=a(b,c,n6),k=n2.create(j);e&&n5(k,e),n5(k,d);let l=(f=d.length,g=e?e.length:0,nI(!0),nR(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength),0,BigInt(g),!0),nR(i,8,BigInt(f),!0),h);k.update(l);let m=k.digest();return nN(j,l),m}let n8=((a,b)=>{function c(d,...e){if(nK(d),!nO)throw Error("Non little-endian hardware is not yet supported");if(void 0!==a.nonceLength){let b=e[0];if(!b)throw Error("nonce / iv required");a.varSizeNonce?nK(b):nK(b,a.nonceLength)}let f=a.tagLength;f&&void 0!==e[1]&&nK(e[1]);let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");nK(b)}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,nK(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(nK(a),f&&a.length<f)throw Error("invalid ciphertext length: smaller than tagLength="+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:12,tagLength:16},(a,b,c)=>({encrypt(d,e){let f=d.length;(e=nQ(f+16,e,!1)).set(d);let g=e.subarray(0,-16);n3(a,b,g,g,1);let h=n7(n3,a,b,g,c);return e.set(h,f),nN(h),e},decrypt(d,e){e=nQ(d.length-16,e,!1);let f=d.subarray(0,-16),g=d.subarray(-16),h=n7(n3,a,b,f,c);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(g,h))throw Error("invalid tag");return e.set(d.subarray(0,-16)),n3(a,b,e,e,1),nN(h),e}}));class n9 extends mA{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,mh(a);const c=my(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),ml(e)}update(a){return mi(this),this.iHash.update(a),this}digestInto(a){mi(this),mg(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let oa=(a,b,c)=>new n9(a,b).update(c).digest();oa.create=(a,b)=>new n9(a,b);let ob=Uint8Array.from([0]),oc=Uint8Array.of(),od=BigInt(0),oe=BigInt(1);function of(a,b=""){if("boolean"!=typeof a)throw Error((b&&`"${b}"`)+"expected boolean, got type="+typeof a);return a}function og(a,b,c=""){let d=me(a),e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function oh(a){let b=a.toString(16);return 1&b.length?"0"+b:b}function oi(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);return""===a?od:BigInt("0x"+a)}function oj(a){return mg(a),oi(mu(Uint8Array.from(a).reverse()))}function ok(a,b){return mw(a.toString(16).padStart(2*b,"0"))}function ol(a,b){return ok(a,b).reverse()}function om(a,b,c){let d;if("string"==typeof b)try{d=mw(b)}catch(b){throw Error(a+" must be hex string or Uint8Array, cause: "+b)}else if(me(b))d=Uint8Array.from(b);else throw Error(a+" must be hex string or Uint8Array");let e=d.length;if("number"==typeof c&&e!==c)throw Error(a+" of length "+c+" expected, got "+e);return d}let on=a=>"bigint"==typeof a&&od<=a;function oo(a,b,c,d){if(!(on(b)&&on(c)&&on(d))||!(c<=b)||!(b<d))throw Error("expected valid "+a+": "+c+" <= n < "+d+", got "+b)}function op(a){let b;for(b=0;a>od;a>>=oe,b+=1);return b}let oq=a=>(oe<<BigInt(a))-oe;function or(a,b,c={}){if(!a||"object"!=typeof a)throw Error("expected valid options object");function d(b,c,d){let e=a[b];if(d&&void 0===e)return;let f=typeof e;if(f!==c||null===e)throw Error(`param "${b}" is invalid: expected ${c}, got ${f}`)}Object.entries(b).forEach(([a,b])=>d(a,b,!1)),Object.entries(c).forEach(([a,b])=>d(a,b,!0))}function os(a){let b=new WeakMap;return(c,...d)=>{let e=b.get(c);if(void 0!==e)return e;let f=a(c,...d);return b.set(c,f),f}}let ot=BigInt(0),ou=BigInt(1),ov=BigInt(2),ow=BigInt(3),ox=BigInt(4),oy=BigInt(5),oz=BigInt(7),oA=BigInt(8),oB=BigInt(9),oC=BigInt(16);function oD(a,b){let c=a%b;return c>=ot?c:b+c}function oE(a,b,c){let d=a;for(;b-- >ot;)d*=d,d%=c;return d}function oF(a,b){if(a===ot)throw Error("invert: expected non-zero number");if(b<=ot)throw Error("invert: expected positive modulus, got "+b);let c=oD(a,b),d=b,e=ot,f=ou;for(;c!==ot;){let a=d/c,b=d%c,g=e-f*a;d=c,c=b,e=f,f=g}if(d!==ou)throw Error("invert: does not exist");return oD(e,b)}function oG(a,b,c){if(!a.eql(a.sqr(b),c))throw Error("Cannot find square root")}function oH(a,b){let c=(a.ORDER+ou)/ox,d=a.pow(b,c);return oG(a,d,b),d}function oI(a,b){let c=(a.ORDER-oy)/oA,d=a.mul(b,ov),e=a.pow(d,c),f=a.mul(b,e),g=a.mul(a.mul(f,ov),e),h=a.mul(f,a.sub(g,a.ONE));return oG(a,h,b),h}function oJ(a){if(a<ow)throw Error("sqrt is not defined for small field");let b=a-ou,c=0;for(;b%ov===ot;)b/=ov,c++;let d=ov,e=oO(a);for(;1===oM(e,d);)if(d++>1e3)throw Error("Cannot find square root: probably non-prime P");if(1===c)return oH;let f=e.pow(d,b),g=(b+ou)/ov;return function(a,d){if(a.is0(d))return d;if(1!==oM(a,d))throw Error("Cannot find square root");let e=c,h=a.mul(a.ONE,f),i=a.pow(d,b),j=a.pow(d,g);for(;!a.eql(i,a.ONE);){if(a.is0(i))return a.ZERO;let b=1,c=a.sqr(i);for(;!a.eql(c,a.ONE);)if(b++,c=a.sqr(c),b===e)throw Error("Cannot find square root");let d=ou<<BigInt(e-b-1),f=a.pow(h,d);e=b,h=a.sqr(f),i=a.mul(i,h),j=a.mul(j,f)}return j}}let oK=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function oL(a,b,c=!1){let d=Array(b.length).fill(c?a.ZERO:void 0),e=b.reduce((b,c,e)=>a.is0(c)?b:(d[e]=b,a.mul(b,c)),a.ONE),f=a.inv(e);return b.reduceRight((b,c,e)=>a.is0(c)?b:(d[e]=a.mul(b,d[e]),a.mul(b,c)),f),d}function oM(a,b){let c=(a.ORDER-ou)/ov,d=a.pow(b,c),e=a.eql(d,a.ONE),f=a.eql(d,a.ZERO),g=a.eql(d,a.neg(a.ONE));if(!e&&!f&&!g)throw Error("invalid Legendre symbol result");return e?1:f?0:-1}function oN(a,b){void 0!==b&&mf(b);let c=void 0!==b?b:a.toString(2).length,d=Math.ceil(c/8);return{nBitLength:c,nByteLength:d}}function oO(a,b,c=!1,d={}){let e;if(a<=ot)throw Error("invalid field: expected ORDER > 0, got "+a);let f,g,h=!1,i;if("object"==typeof b&&null!=b){if(d.sqrt||c)throw Error("cannot specify opts in two arguments");b.BITS&&(f=b.BITS),b.sqrt&&(g=b.sqrt),"boolean"==typeof b.isLE&&(c=b.isLE),"boolean"==typeof b.modFromBytes&&(h=b.modFromBytes),i=b.allowedLengths}else"number"==typeof b&&(f=b),d.sqrt&&(g=d.sqrt);let{nBitLength:j,nByteLength:k}=oN(a,f);if(k>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let l=Object.freeze({ORDER:a,isLE:c,BITS:j,BYTES:k,MASK:oq(j),ZERO:ot,ONE:ou,allowedLengths:i,create:b=>oD(b,a),isValid:b=>{if("bigint"!=typeof b)throw Error("invalid field element: expected bigint, got "+typeof b);return ot<=b&&b<a},is0:a=>a===ot,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&ou)===ou,neg:b=>oD(-b,a),eql:(a,b)=>a===b,sqr:b=>oD(b*b,a),add:(b,c)=>oD(b+c,a),sub:(b,c)=>oD(b-c,a),mul:(b,c)=>oD(b*c,a),pow:(a,b)=>(function(a,b,c){if(c<ot)throw Error("invalid exponent, negatives unsupported");if(c===ot)return a.ONE;if(c===ou)return b;let d=a.ONE,e=b;for(;c>ot;)c&ou&&(d=a.mul(d,e)),e=a.sqr(e),c>>=ou;return d})(l,a,b),div:(b,c)=>oD(b*oF(c,a),a),sqrN:a=>a*a,addN:(a,b)=>a+b,subN:(a,b)=>a-b,mulN:(a,b)=>a*b,inv:b=>oF(b,a),sqrt:g||(b=>{let c,d,f,g,h,i;return e||(e=a%ox===ow?oH:a%oA===oy?oI:a%oC===oB?(c=oO(a),f=(d=oJ(a))(c,c.neg(c.ONE)),g=d(c,f),h=d(c,c.neg(f)),i=(a+oz)/oC,(a,b)=>{let c=a.pow(b,i),d=a.mul(c,f),e=a.mul(c,g),j=a.mul(c,h),k=a.eql(a.sqr(d),b),l=a.eql(a.sqr(e),b);c=a.cmov(c,d,k),d=a.cmov(j,e,l);let m=a.eql(a.sqr(d),b),n=a.cmov(c,d,m);return oG(a,n,b),n}):oJ(a)),e(l,b)}),toBytes:a=>c?ol(a,k):ok(a,k),fromBytes:(b,d=!0)=>{if(i){if(!i.includes(b.length)||b.length>k)throw Error("Field.fromBytes: expected "+i+" bytes, got "+b.length);let a=new Uint8Array(k);a.set(b,c?0:a.length-b.length),b=a}if(b.length!==k)throw Error("Field.fromBytes: expected "+k+" bytes, got "+b.length);let e=c?oj(b):oi(mu(b));if(h&&(e=oD(e,a)),!d&&!l.isValid(e))throw Error("invalid field element: outside of range 0..ORDER");return e},invertBatch:a=>oL(l,a),cmov:(a,b,c)=>c?b:a});return Object.freeze(l)}function oP(a){if("bigint"!=typeof a)throw Error("field order must be bigint");return Math.ceil(a.toString(2).length/8)}function oQ(a){let b=oP(a);return b+Math.ceil(b/2)}let oR=BigInt(0),oS=BigInt(1);function oT(a,b){let c=b.negate();return a?c:b}function oU(a,b){let c=oL(a.Fp,b.map(a=>a.Z));return b.map((b,d)=>a.fromAffine(b.toAffine(c[d])))}function oV(a,b){if(!Number.isSafeInteger(a)||a<=0||a>b)throw Error("invalid window size, expected [1.."+b+"], got W="+a)}function oW(a,b){oV(a,b);let c=Math.ceil(b/a)+1,d=2**(a-1),e=2**a;return{windows:c,windowSize:d,mask:oq(a),maxNumber:e,shiftBy:BigInt(a)}}function oX(a,b,c){let{windowSize:d,mask:e,maxNumber:f,shiftBy:g}=c,h=Number(a&e),i=a>>g;h>d&&(h-=f,i+=oS);let j=b*d;return{nextN:i,offset:j+Math.abs(h)-1,isZero:0===h,isNeg:h<0,isNegF:b%2!=0,offsetF:j}}let oY=new WeakMap,oZ=new WeakMap;function o$(a){return oZ.get(a)||1}function o_(a){if(a!==oR)throw Error("invalid wNAF")}class o0{constructor(a,b){this.BASE=a.BASE,this.ZERO=a.ZERO,this.Fn=a.Fn,this.bits=b}_unsafeLadder(a,b,c=this.ZERO){let d=a;for(;b>oR;)b&oS&&(c=c.add(d)),d=d.double(),b>>=oS;return c}precomputeWindow(a,b){let{windows:c,windowSize:d}=oW(b,this.bits),e=[],f=a,g=f;for(let a=0;a<c;a++){g=f,e.push(g);for(let a=1;a<d;a++)g=g.add(f),e.push(g);f=g.double()}return e}wNAF(a,b,c){if(!this.Fn.isValid(c))throw Error("invalid scalar");let d=this.ZERO,e=this.BASE,f=oW(a,this.bits);for(let a=0;a<f.windows;a++){let{nextN:g,offset:h,isZero:i,isNeg:j,isNegF:k,offsetF:l}=oX(c,a,f);c=g,i?e=e.add(oT(k,b[l])):d=d.add(oT(j,b[h]))}return o_(c),{p:d,f:e}}wNAFUnsafe(a,b,c,d=this.ZERO){let e=oW(a,this.bits);for(let a=0;a<e.windows&&c!==oR;a++){let{nextN:f,offset:g,isZero:h,isNeg:i}=oX(c,a,e);if(c=f,!h){let a=b[g];d=d.add(i?a.negate():a)}}return o_(c),d}getPrecomputes(a,b,c){let d=oY.get(b);return d||(d=this.precomputeWindow(b,a),1!==a&&("function"==typeof c&&(d=c(d)),oY.set(b,d))),d}cached(a,b,c){let d=o$(a);return this.wNAF(d,this.getPrecomputes(d,a,c),b)}unsafe(a,b,c,d){let e=o$(a);return 1===e?this._unsafeLadder(a,b,d):this.wNAFUnsafe(e,this.getPrecomputes(e,a,c),b,d)}createCache(a,b){oV(b,this.bits),oZ.set(a,b),oY.delete(a)}hasCache(a){return 1!==o$(a)}}function o1(a,b,c){if(!b)return oO(a,{isLE:c});if(b.ORDER!==a)throw Error("Field.ORDER must match order: Fp == p, Fn == n");return or(b,oK.reduce((a,b)=>(a[b]="function",a),{ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"})),b}BigInt(0),BigInt(1),BigInt(2),BigInt(8),mx("HashToScalar-");let o2=BigInt(0),o3=BigInt(1),o4=BigInt(2),o5=BigInt(1),o6=BigInt(2),o7=BigInt(3),o8=BigInt(5),o9=BigInt(8),pa=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),pb={p:pa,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:o9,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")},pc=function(a){let{P:b,type:c,adjustScalarBytes:d,powPminus2:e,randomBytes:f}=(or(a,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...a})),g="x25519"===c;if(!g&&"x448"!==c)throw Error("invalid type");let h=f||mC,i=g?255:448,j=g?32:56,k=BigInt(g?9:5),l=BigInt(g?121665:39081),m=g?o4**BigInt(254):o4**BigInt(447),n=m+(g?BigInt(8)*o4**BigInt(251)-o3:BigInt(4)*o4**BigInt(445)-o3)+o3,o=a=>oD(a,b),p=ol(o(k),j);function q(a,c){let f,h=function(a,c){oo("u",a,o2,b),oo("scalar",c,m,n);let d=o3,f=o2,g=a,h=o3,j=o2;for(let b=BigInt(i-1);b>=o2;b--){let e=c>>b&o3;j^=e,({x_2:d,x_3:g}=s(j,d,g)),({x_2:f,x_3:h}=s(j,f,h)),j=e;let i=d+f,k=o(i*i),m=d-f,n=o(m*m),p=k-n,q=g+h,r=o((g-h)*i),t=o(q*m),u=r+t,v=r-t;g=o(u*u),h=o(a*o(v*v)),d=o(k*n),f=o(p*(k+o(l*p)))}return{x_2:d,x_3:g}=s(j,d,g),{x_2:f,x_3:h}=s(j,f,h),o(d*e(f))}((f=om("u coordinate",c,j),g&&(f[31]&=127),o(oj(f))),oj(d(om("scalar",a,j))));if(h===o2)throw Error("invalid private or public key received");return ol(o(h),j)}function r(a){return q(a,p)}function s(a,b,c){let d=o(a*(b-c));return{x_2:b=o(b-d),x_3:c=o(c+d)}}let t={secretKey:j,publicKey:j,seed:j},u=(a=h(j))=>(mg(a,t.seed),a);return{keygen:function(a){let b=u(a);return{secretKey:b,publicKey:r(b)}},getSharedSecret:(a,b)=>q(a,b),getPublicKey:a=>r(a),scalarMult:q,scalarMultBase:r,utils:{randomSecretKey:u,randomPrivateKey:u},GuBytes:p.slice(),lengths:t}}({P:Q=oO(pb.p,{isLE:!0}).ORDER,type:"x25519",powPminus2:a=>{let b,c,d,e,f,g,h,i,j,k,l,m,n,o,{pow_p_5_8:p,b2:q}=(b=BigInt(10),c=BigInt(20),d=BigInt(40),e=BigInt(80),g=oE(f=a*a%pa*a%pa,o6,pa)*f%pa,h=oE(g,o5,pa)*a%pa,i=oE(h,o8,pa)*h%pa,j=oE(i,b,pa)*i%pa,k=oE(j,c,pa)*j%pa,l=oE(k,d,pa)*k%pa,m=oE(l,e,pa)*l%pa,n=oE(m,e,pa)*l%pa,o=oE(n,b,pa)*i%pa,{pow_p_5_8:oE(o,o6,pa)*a%pa,b2:f});return oD(oE(p,o7,Q)*q,Q)},adjustScalarBytes:function(a){return a[0]&=248,a[31]&=127,a[31]|=64,a}}),pd=(a,b)=>(a+(a>=0?b:-b)/pj)/b;function pe(a){if(!["compact","recovered","der"].includes(a))throw Error('Signature format must be "compact", "recovered", or "der"');return a}function pf(a,b){let c={};for(let d of Object.keys(b))c[d]=void 0===a[d]?b[d]:a[d];return of(c.lowS,"lowS"),of(c.prehash,"prehash"),void 0!==c.format&&pe(c.format),c}let pg={Err:class extends Error{constructor(a=""){super(a)}},_tlv:{encode:(a,b)=>{let{Err:c}=pg;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(1&b.length)throw new c("tlv.encode: unpadded data");let d=b.length/2,e=oh(d);if(e.length/2&128)throw new c("tlv.encode: long form length too big");let f=d>127?oh(e.length/2|128):"";return oh(a)+f+e+b},decode(a,b){let{Err:c}=pg,d=0;if(a<0||a>256)throw new c("tlv.encode: wrong tag");if(b.length<2||b[d++]!==a)throw new c("tlv.decode: wrong tlv");let e=b[d++],f=0;if(128&e){let a=127&e;if(!a)throw new c("tlv.decode(long): indefinite length not supported");if(a>4)throw new c("tlv.decode(long): byte length is too big");let g=b.subarray(d,d+a);if(g.length!==a)throw new c("tlv.decode: length bytes not complete");if(0===g[0])throw new c("tlv.decode(long): zero leftmost byte");for(let a of g)f=f<<8|a;if(d+=a,f<128)throw new c("tlv.decode(long): not minimal encoding")}else f=e;let g=b.subarray(d,d+f);if(g.length!==f)throw new c("tlv.decode: wrong value length");return{v:g,l:b.subarray(d+f)}}},_int:{encode(a){let{Err:b}=pg;if(a<ph)throw new b("integer: negative integers are not allowed");let c=oh(a);if(8&Number.parseInt(c[0],16)&&(c="00"+c),1&c.length)throw new b("unexpected DER parsing assertion: unpadded hex");return c},decode(a){let{Err:b}=pg;if(128&a[0])throw new b("invalid signature integer: negative");if(0===a[0]&&!(128&a[1]))throw new b("invalid signature integer: unnecessary leading zero");return oi(mu(a))}},toSig(a){let{Err:b,_int:c,_tlv:d}=pg,e=om("signature",a),{v:f,l:g}=d.decode(48,e);if(g.length)throw new b("invalid signature: left bytes after parsing");let{v:h,l:i}=d.decode(2,f),{v:j,l:k}=d.decode(2,i);if(k.length)throw new b("invalid signature: left bytes after parsing");return{r:c.decode(h),s:c.decode(j)}},hexFromSig(a){let{_tlv:b,_int:c}=pg,d=b.encode(2,c.encode(a.r)),e=b.encode(2,c.encode(a.s));return b.encode(48,d+e)}},ph=BigInt(0),pi=BigInt(1),pj=BigInt(2),pk=BigInt(3),pl=BigInt(4);function pm(a,b){let c,{BYTES:d}=a;if("bigint"==typeof b)c=b;else{let e=om("private key",b);try{c=a.fromBytes(e)}catch{throw Error(`invalid private key: expected ui8a of size ${d}, got ${typeof b}`)}}if(!a.isValidNot0(c))throw Error("invalid private key: out of range [1..N-1]");return c}function pn(a){return Uint8Array.of(a?2:3)}function po(a,b){return{secretKey:b.BYTES,publicKey:1+a.BYTES,publicKeyUncompressed:1+2*a.BYTES,publicKeyHasPrefix:!0,signature:2*b.BYTES}}function pp(a,b){let c=b=>(function(a){let b,{CURVE:c,curveOpts:d,hash:e,ecdsaOpts:f}=function(a){let b,c,d,e,{CURVE:f,curveOpts:g}=(b={a:a.a,b:a.b,p:a.Fp.ORDER,n:a.n,h:a.h,Gx:a.Gx,Gy:a.Gy},c=a.Fp,d=a.allowedPrivateKeyLengths?Array.from(new Set(a.allowedPrivateKeyLengths.map(a=>Math.ceil(a/2)))):void 0,e={Fp:c,Fn:oO(b.n,{BITS:a.nBitLength,allowedLengths:d,modFromBytes:a.wrapPrivateKey}),allowInfinityPoint:a.allowInfinityPoint,endo:a.endo,isTorsionFree:a.isTorsionFree,clearCofactor:a.clearCofactor,fromBytes:a.fromBytes,toBytes:a.toBytes},{CURVE:b,curveOpts:e}),h={hmac:a.hmac,randomBytes:a.randomBytes,lowS:a.lowS,bits2int:a.bits2int,bits2int_modN:a.bits2int_modN};return{CURVE:f,curveOpts:g,hash:a.hash,ecdsaOpts:h}}(a),g=function(a,b,c={}){mh(b),or(c,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let d=c.randomBytes||mC,e=c.hmac||((a,...c)=>oa(b,a,mz(...c))),{Fp:f,Fn:g}=a,{ORDER:h,BITS:i}=g,{keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n}=function(a,b={}){let{Fn:c}=a,d=b.randomBytes||mC,e=Object.assign(po(a.Fp,c),{seed:oQ(c.ORDER)});function f(a){try{return!!pm(c,a)}catch{return!1}}function g(a=d(e.seed)){return function(a,b,c=!1){let d=a.length,e=oP(b),f=oQ(b);if(d<16||d<f||d>1024)throw Error("expected "+f+"-1024 bytes of input, got "+d);let g=oD(c?oj(a):oi(mu(a)),b-ou)+ou;return c?ol(g,e):ok(g,e)}(og(a,e.seed,"seed"),c.ORDER)}function h(b,d=!0){return a.BASE.multiply(pm(c,b)).toBytes(d)}function i(b){if("bigint"==typeof b)return!1;if(b instanceof a)return!0;let{secretKey:d,publicKey:f,publicKeyUncompressed:g}=e;if(c.allowedLengths||d===f)return;let h=om("key",b).length;return h===f||h===g}return Object.freeze({getPublicKey:h,getSharedSecret:function(b,d,e=!0){if(!0===i(b))throw Error("first arg must be private key");if(!1===i(d))throw Error("second arg must be public key");let f=pm(c,b);return a.fromHex(d).multiply(f).toBytes(e)},keygen:function(a){let b=g(a);return{secretKey:b,publicKey:h(b)}},Point:a,utils:{isValidSecretKey:f,isValidPublicKey:function(b,c){let{publicKey:d,publicKeyUncompressed:f}=e;try{let e=b.length;return(!0!==c||e===d)&&(!1!==c||e===f)&&!!a.fromBytes(b)}catch{return!1}},randomSecretKey:g,isValidPrivateKey:f,randomPrivateKey:g,normPrivateKeyToScalar:a=>pm(c,a),precompute:(b=8,c=a.BASE)=>c.precompute(b,!1)},lengths:e})}(a,c),o={prehash:!1,lowS:"boolean"==typeof c.lowS&&c.lowS,format:void 0,extraEntropy:!1},p="compact";function q(a,b){if(!g.isValidNot0(b))throw Error(`invalid signature ${a}: out of range 1..Point.Fn.ORDER`);return b}class r{constructor(a,b,c){this.r=q("r",a),this.s=q("s",b),null!=c&&(this.recovery=c),Object.freeze(this)}static fromBytes(a,b=p){var c,d;let e,f;if(c=a,pe(d=b),f=n.signature,og(c,"compact"===d?f:"recovered"===d?f+1:void 0,`${d} signature`),"der"===b){let{r:b,s:c}=pg.toSig(og(a));return new r(b,c)}"recovered"===b&&(e=a[0],b="compact",a=a.subarray(1));let h=g.BYTES,i=a.subarray(0,h),j=a.subarray(h,2*h);return new r(g.fromBytes(i),g.fromBytes(j),e)}static fromHex(a,b){return this.fromBytes(mw(a),b)}addRecoveryBit(a){return new r(this.r,this.s,a)}recoverPublicKey(b){let c=f.ORDER,{r:d,s:e,recovery:i}=this;if(null==i||![0,1,2,3].includes(i))throw Error("recovery id invalid");if(h*pj<c&&i>1)throw Error("recovery id is ambiguous for h>1 curve");let j=2===i||3===i?d+h:d;if(!f.isValid(j))throw Error("recovery id 2 or 3 invalid");let k=f.toBytes(j),l=a.fromBytes(mz(pn((1&i)==0),k)),m=g.inv(j),n=t(om("msgHash",b)),o=g.create(-n*m),p=g.create(e*m),q=a.BASE.multiplyUnsafe(o).add(l.multiplyUnsafe(p));if(q.is0())throw Error("point at infinify");return q.assertValidity(),q}hasHighS(){return this.s>h>>pi}toBytes(a=p){if(pe(a),"der"===a)return mw(pg.hexFromSig(this));let b=g.toBytes(this.r),c=g.toBytes(this.s);if("recovered"===a){if(null==this.recovery)throw Error("recovery bit must be present");return mz(Uint8Array.of(this.recovery),b,c)}return mz(b,c)}toHex(a){return mu(this.toBytes(a))}assertValidity(){}static fromCompact(a){return r.fromBytes(om("sig",a),"compact")}static fromDER(a){return r.fromBytes(om("sig",a),"der")}normalizeS(){return this.hasHighS()?new r(this.r,g.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return mu(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return mu(this.toBytes("compact"))}}let s=c.bits2int||function(a){if(a.length>8192)throw Error("input is too large");let b=oi(mu(a)),c=8*a.length-i;return c>0?b>>BigInt(c):b},t=c.bits2int_modN||function(a){return g.create(s(a))},u=oq(i);function v(a){return oo("num < 2^"+i,a,ph,u),g.toBytes(a)}function w(a,c){return og(a,void 0,"message"),c?og(b(a),void 0,"prehashed message"):a}return Object.freeze({keygen:j,getPublicKey:k,getSharedSecret:l,utils:m,lengths:n,Point:a,sign:function(c,f,i={}){let{seed:j,k2sig:k}=function(b,c,e){if(["recovered","canonical"].some(a=>a in e))throw Error("sign() legacy options not supported");let{lowS:f,prehash:i,extraEntropy:j}=pf(e,o),k=t(b=w(b,i)),l=pm(g,c),m=[v(l),v(k)];if(null!=j&&!1!==j){let a=!0===j?d(n.secretKey):j;m.push(om("extraEntropy",a))}return{seed:mz(...m),k2sig:function(b){let c=s(b);if(!g.isValidNot0(c))return;let d=g.inv(c),e=a.BASE.multiply(c).toAffine(),i=g.create(e.x);if(i===ph)return;let j=g.create(d*g.create(k+i*l));if(j===ph)return;let m=2*(e.x!==i)|Number(e.y&pi),n=j;return f&&j>h>>pi&&(n=g.neg(j),m^=1),new r(i,n,m)}}}(c=om("message",c),f,i);return(function(a,b,c){if("number"!=typeof a||a<2)throw Error("hashLen must be a number");if("number"!=typeof b||b<2)throw Error("qByteLen must be a number");if("function"!=typeof c)throw Error("hmacFn must be a function");let d=a=>new Uint8Array(a),e=d(a),f=d(a),g=0,h=()=>{e.fill(1),f.fill(0),g=0},i=(...a)=>c(f,e,...a),j=(a=d(0))=>{f=i(Uint8Array.of(0),a),e=i(),0!==a.length&&(f=i(Uint8Array.of(1),a),e=i())},k=()=>{if(g++>=1e3)throw Error("drbg: tried 1000 values");let a=0,c=[];for(;a<b;){let b=(e=i()).slice();c.push(b),a+=e.length}return mz(...c)};return(a,b)=>{let c;for(h(),j(a);!(c=b(k()));)j();return h(),c}})(b.outputLen,g.BYTES,e)(j,k)},verify:function(b,c,d,e={}){let{lowS:f,prehash:h,format:i}=pf(e,o);if(d=om("publicKey",d),c=w(om("message",c),h),"strict"in e)throw Error("options.strict was renamed to lowS");let j=void 0===i?function(a){let b,c="string"==typeof a||me(a),d=!c&&null!==a&&"object"==typeof a&&"bigint"==typeof a.r&&"bigint"==typeof a.s;if(!c&&!d)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(d)b=new r(a.r,a.s);else if(c){try{b=r.fromBytes(om("sig",a),"der")}catch(a){if(!(a instanceof pg.Err))throw a}if(!b)try{b=r.fromBytes(om("sig",a),"compact")}catch{return!1}}return b||!1}(b):r.fromBytes(om("sig",b),i);if(!1===j)return!1;try{let b=a.fromBytes(d);if(f&&j.hasHighS())return!1;let{r:e,s:h}=j,i=t(c),k=g.inv(h),l=g.create(i*k),m=g.create(e*k),n=a.BASE.multiplyUnsafe(l).add(b.multiplyUnsafe(m));return!n.is0()&&g.create(n.x)===e}catch{return!1}},recoverPublicKey:function(a,b,c={}){let{prehash:d}=pf(c,o);return b=w(b,d),r.fromBytes(a,"recovered").recoverPublicKey(b).toBytes()},Signature:r,hash:b})}(function(a,b={}){let c=function(a,b,c={},d){if(void 0===d&&(d="edwards"===a),!b||"object"!=typeof b)throw Error(`expected valid ${a} CURVE object`);for(let a of["p","n","h"]){let c=b[a];if(!("bigint"==typeof c&&c>oR))throw Error(`CURVE.${a} must be positive bigint`)}let e=o1(b.p,c.Fp,d),f=o1(b.n,c.Fn,d);for(let c of["Gx","Gy","a","weierstrass"===a?"b":"d"])if(!e.isValid(b[c]))throw Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return{CURVE:b=Object.freeze(Object.assign({},b)),Fp:e,Fn:f}}("weierstrass",a,b),{Fp:d,Fn:e}=c,f=c.CURVE,{h:g,n:h}=f;or(b,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=b;if(i&&(!d.is0(f.a)||"bigint"!=typeof i.beta||!Array.isArray(i.basises)))throw Error('invalid endo: expected "beta": bigint and "basises": array');let j=po(d,e);function k(){if(!d.isOdd)throw Error("compression is not supported: Field does not have .isOdd()")}let l=b.toBytes||function(a,b,c){let{x:e,y:f}=b.toAffine(),g=d.toBytes(e);return(of(c,"isCompressed"),c)?(k(),mz(pn(!d.isOdd(f)),g)):mz(Uint8Array.of(4),g,d.toBytes(f))},m=b.fromBytes||function(a){og(a,void 0,"Point");let{publicKey:b,publicKeyUncompressed:c}=j,e=a.length,f=a[0],g=a.subarray(1);if(e===b&&(2===f||3===f)){let a,b=d.fromBytes(g);if(!d.isValid(b))throw Error("bad point: is not on curve, wrong x");let c=n(b);try{a=d.sqrt(c)}catch(a){throw Error("bad point: is not on curve, sqrt error"+(a instanceof Error?": "+a.message:""))}return k(),(1&f)==1!==d.isOdd(a)&&(a=d.neg(a)),{x:b,y:a}}if(e===c&&4===f){let a=d.BYTES,b=d.fromBytes(g.subarray(0,a)),c=d.fromBytes(g.subarray(a,2*a));if(!o(b,c))throw Error("bad point: is not on curve");return{x:b,y:c}}throw Error(`bad point: got length ${e}, expected compressed=${b} or uncompressed=${c}`)};function n(a){let b=d.sqr(a),c=d.mul(b,a);return d.add(d.add(c,d.mul(a,f.a)),f.b)}function o(a,b){let c=d.sqr(b),e=n(a);return d.eql(c,e)}if(!o(f.Gx,f.Gy))throw Error("bad curve params: generator point");let p=d.mul(d.pow(f.a,pk),pl),q=d.mul(d.sqr(f.b),BigInt(27));if(d.is0(d.add(p,q)))throw Error("bad curve params: a or b");function r(a,b,c=!1){if(!d.isValid(b)||c&&d.is0(b))throw Error(`bad point coordinate ${a}`);return b}function s(a){if(!(a instanceof x))throw Error("ProjectivePoint expected")}function t(a){if(!i||!i.basises)throw Error("no endo");return function(a,b,c){let[[d,e],[f,g]]=b,h=pd(g*a,c),i=pd(-e*a,c),j=a-h*d-i*f,k=-h*e-i*g,l=j<ph,m=k<ph;l&&(j=-j),m&&(k=-k);let n=oq(Math.ceil(op(c)/2))+pi;if(j<ph||j>=n||k<ph||k>=n)throw Error("splitScalar (endomorphism): failed, k="+a);return{k1neg:l,k1:j,k2neg:m,k2:k}}(a,i.basises,e.ORDER)}let u=os((a,b)=>{let{X:c,Y:e,Z:f}=a;if(d.eql(f,d.ONE))return{x:c,y:e};let g=a.is0();null==b&&(b=g?d.ONE:d.inv(f));let h=d.mul(c,b),i=d.mul(e,b),j=d.mul(f,b);if(g)return{x:d.ZERO,y:d.ZERO};if(!d.eql(j,d.ONE))throw Error("invZ was invalid");return{x:h,y:i}}),v=os(a=>{if(a.is0()){if(b.allowInfinityPoint&&!d.is0(a.Y))return;throw Error("bad point: ZERO")}let{x:c,y:e}=a.toAffine();if(!d.isValid(c)||!d.isValid(e))throw Error("bad point: x or y not field elements");if(!o(c,e))throw Error("bad point: equation left != right");if(!a.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0});function w(a,b,c,e,f){return c=new x(d.mul(c.X,a),c.Y,c.Z),b=oT(e,b),c=oT(f,c),b.add(c)}class x{constructor(a,b,c){this.X=r("x",a),this.Y=r("y",b,!0),this.Z=r("z",c),Object.freeze(this)}static CURVE(){return f}static fromAffine(a){let{x:b,y:c}=a||{};if(!a||!d.isValid(b)||!d.isValid(c))throw Error("invalid affine point");if(a instanceof x)throw Error("projective point not allowed");return d.is0(b)&&d.is0(c)?x.ZERO:new x(b,c,d.ONE)}static fromBytes(a){let b=x.fromAffine(m(og(a,void 0,"point")));return b.assertValidity(),b}static fromHex(a){return x.fromBytes(om("pointHex",a))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(a=8,b=!0){return z.createCache(this,a),b||this.multiply(pk),this}assertValidity(){v(this)}hasEvenY(){let{y:a}=this.toAffine();if(!d.isOdd)throw Error("Field doesn't support isOdd");return!d.isOdd(a)}equals(a){s(a);let{X:b,Y:c,Z:e}=this,{X:f,Y:g,Z:h}=a,i=d.eql(d.mul(b,h),d.mul(f,e)),j=d.eql(d.mul(c,h),d.mul(g,e));return i&&j}negate(){return new x(this.X,d.neg(this.Y),this.Z)}double(){let{a:a,b}=f,c=d.mul(b,pk),{X:e,Y:g,Z:h}=this,i=d.ZERO,j=d.ZERO,k=d.ZERO,l=d.mul(e,e),m=d.mul(g,g),n=d.mul(h,h),o=d.mul(e,g);return o=d.add(o,o),k=d.mul(e,h),k=d.add(k,k),i=d.mul(a,k),j=d.mul(c,n),j=d.add(i,j),i=d.sub(m,j),j=d.add(m,j),j=d.mul(i,j),i=d.mul(o,i),k=d.mul(c,k),n=d.mul(a,n),o=d.sub(l,n),o=d.mul(a,o),o=d.add(o,k),k=d.add(l,l),l=d.add(k,l),l=d.add(l,n),l=d.mul(l,o),j=d.add(j,l),n=d.mul(g,h),n=d.add(n,n),l=d.mul(n,o),i=d.sub(i,l),k=d.mul(n,m),k=d.add(k,k),new x(i,j,k=d.add(k,k))}add(a){s(a);let{X:b,Y:c,Z:e}=this,{X:g,Y:h,Z:i}=a,j=d.ZERO,k=d.ZERO,l=d.ZERO,m=f.a,n=d.mul(f.b,pk),o=d.mul(b,g),p=d.mul(c,h),q=d.mul(e,i),r=d.add(b,c),t=d.add(g,h);r=d.mul(r,t),t=d.add(o,p),r=d.sub(r,t),t=d.add(b,e);let u=d.add(g,i);return t=d.mul(t,u),u=d.add(o,q),t=d.sub(t,u),u=d.add(c,e),j=d.add(h,i),u=d.mul(u,j),j=d.add(p,q),u=d.sub(u,j),l=d.mul(m,t),j=d.mul(n,q),l=d.add(j,l),j=d.sub(p,l),l=d.add(p,l),k=d.mul(j,l),p=d.add(o,o),p=d.add(p,o),q=d.mul(m,q),t=d.mul(n,t),p=d.add(p,q),q=d.sub(o,q),q=d.mul(m,q),t=d.add(t,q),o=d.mul(p,t),k=d.add(k,o),o=d.mul(u,t),j=d.mul(r,j),j=d.sub(j,o),o=d.mul(r,p),l=d.mul(u,l),new x(j,k,l=d.add(l,o))}subtract(a){return this.add(a.negate())}is0(){return this.equals(x.ZERO)}multiply(a){let c,d,{endo:f}=b;if(!e.isValidNot0(a))throw Error("invalid scalar: out of range");let g=a=>z.cached(this,a,a=>oU(x,a));if(f){let{k1neg:b,k1:e,k2neg:h,k2:i}=t(a),{p:j,f:k}=g(e),{p:l,f:m}=g(i);d=k.add(m),c=w(f.beta,j,l,b,h)}else{let{p:b,f:e}=g(a);c=b,d=e}return oU(x,[c,d])[0]}multiplyUnsafe(a){let{endo:c}=b;if(!e.isValid(a))throw Error("invalid scalar: out of range");if(a===ph||this.is0())return x.ZERO;if(a===pi)return this;if(z.hasCache(this))return this.multiply(a);if(!c)return z.unsafe(this,a);{let{k1neg:b,k1:d,k2neg:e,k2:f}=t(a),{p1:g,p2:h}=function(a,b,c,d){let e=b,f=a.ZERO,g=a.ZERO;for(;c>oR||d>oR;)c&oS&&(f=f.add(e)),d&oS&&(g=g.add(e)),e=e.double(),c>>=oS,d>>=oS;return{p1:f,p2:g}}(x,this,d,f);return w(c.beta,g,h,b,e)}}multiplyAndAddUnsafe(a,b,c){let d=this.multiplyUnsafe(b).add(a.multiplyUnsafe(c));return d.is0()?void 0:d}toAffine(a){return u(this,a)}isTorsionFree(){let{isTorsionFree:a}=b;return g===pi||(a?a(x,this):z.unsafe(this,h).is0())}clearCofactor(){let{clearCofactor:a}=b;return g===pi?this:a?a(x,this):this.multiplyUnsafe(g)}isSmallOrder(){return this.multiplyUnsafe(g).is0()}toBytes(a=!0){return of(a,"isCompressed"),this.assertValidity(),l(x,this,a)}toHex(a=!0){return mu(this.toBytes(a))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(a=!0){return this.toBytes(a)}_setWindowSize(a){this.precompute(a)}static normalizeZ(a){return oU(x,a)}static msm(a,b){return function(a,b,c,d){(function(a,b){if(!Array.isArray(a))throw Error("array expected");a.forEach((a,c)=>{if(!(a instanceof b))throw Error("invalid point at index "+c)})})(c,a),function(a,b){if(!Array.isArray(a))throw Error("array of scalars expected");a.forEach((a,c)=>{if(!b.isValid(a))throw Error("invalid scalar at index "+c)})}(d,b);let e=c.length,f=d.length;if(e!==f)throw Error("arrays of points and scalars must have equal length");let g=a.ZERO,h=op(BigInt(e)),i=1;h>12?i=h-3:h>4?i=h-2:h>0&&(i=2);let j=oq(i),k=Array(Number(j)+1).fill(g),l=Math.floor((b.BITS-1)/i)*i,m=g;for(let a=l;a>=0;a-=i){k.fill(g);for(let b=0;b<f;b++){let e=Number(d[b]>>BigInt(a)&j);k[e]=k[e].add(c[b])}let b=g;for(let a=k.length-1,c=g;a>0;a--)c=c.add(k[a]),b=b.add(c);if(m=m.add(b),0!==a)for(let a=0;a<i;a++)m=m.double()}return m}(x,e,a,b)}static fromPrivateKey(a){return x.BASE.multiply(pm(e,a))}}x.BASE=new x(f.Gx,f.Gy,d.ONE),x.ZERO=new x(d.ZERO,d.ONE,d.ZERO),x.Fp=d,x.Fn=e;let y=e.BITS,z=new o0(x,b.endo?Math.ceil(y/2):y);return x.BASE.precompute(8),x}(c,d),e,f);return b=g.Point,Object.assign({},g,{ProjectivePoint:b,CURVE:Object.assign({},a,oN(b.Fn.ORDER,b.Fn.BITS))})})({...a,hash:b});return{...c(b),create:c}}let pq={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},pr={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},ps={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},pt=oO(pq.p),pu=oO(pr.p),pv=oO(ps.p),pw=pp({...pq,Fp:pt,lowS:!1},m7);pp({...pr,Fp:pu,lowS:!1},m9),pp({...ps,Fp:pv,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},m8);let px="base10",py="base16",pz="base64pad",pA="base64url",pB="utf8";function pC(){let a=mC(32);return(0,kU.toString)(a,py)}function pD(a){let b=m7((0,kV.fromString)(a,py));return(0,kU.toString)(b,py)}function pE(a){let b=m7((0,kV.fromString)(a,pB));return(0,kU.toString)(b,py)}function pF(a){return(0,kV.fromString)(`${a}`,px)}function pG(a){return Number((0,kU.toString)(a,px))}function pH(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function pI(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=(4-b.length%4)%4;return b+"=".repeat(c)}function pJ(a){if(2===pG(a.type))return(0,kU.toString)((0,kW.concat)([a.type,a.sealed]),pz);if(1===pG(a.type)){if(typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");return(0,kU.toString)((0,kW.concat)([a.type,a.senderPublicKey,a.iv,a.sealed]),pz)}return(0,kU.toString)((0,kW.concat)([a.type,a.iv,a.sealed]),pz)}function pK(a){let b=(a.encoding||pz)===pA?pI(a.encoded):a.encoded,c=(0,kV.fromString)(b,pz),d=c.slice(0,1);if(1===pG(d)){let a=c.slice(1,33),b=c.slice(33,45);return{type:d,sealed:c.slice(45),iv:b,senderPublicKey:a}}if(2===pG(d))return{type:d,sealed:c.slice(1),iv:mC(12)};let e=c.slice(1,13);return{type:d,sealed:c.slice(13),iv:e}}function pL(a){let b=a?.type||0;if(1===b){if(typeof a?.senderPublicKey>"u")throw Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw Error("missing receiver public key")}return{type:b,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function pM(a){return 1===a.type&&"string"==typeof a.senderPublicKey&&"string"==typeof a.receiverPublicKey}function pN(a){return a?.relay||{protocol:"irn"}}function pO(a){let b=kX.RELAY_JSONRPC[a];if(typeof b>"u")throw Error(`Relay Protocol not supported: ${a}`);return b}var pP=Object.defineProperty,pQ=Object.defineProperties,pR=Object.getOwnPropertyDescriptors,pS=Object.getOwnPropertySymbols,pT=Object.prototype.hasOwnProperty,pU=Object.prototype.propertyIsEnumerable,pV=(a,b,c)=>b in a?pP(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,pW=(a,b)=>{for(var c in b||(b={}))pT.call(b,c)&&pV(a,c,b[c]);if(pS)for(var c of pS(b))pU.call(b,c)&&pV(a,c,b[c]);return a};function pX(a){var b;if(!a.includes("wc:")){let b=lW(a);null!=b&&b.includes("wc:")&&(a=b)}let c=(a=(a=a.includes("wc://")?a.replace("wc://",""):a).includes("wc:")?a.replace("wc:",""):a).indexOf(":"),d=-1!==a.indexOf("?")?a.indexOf("?"):void 0,e=a.substring(0,c),f=a.substring(c+1,d).split("@"),g=Object.fromEntries(new URLSearchParams("u">typeof d?a.substring(d):"").entries()),h="string"==typeof g.methods?g.methods.split(","):void 0;return{protocol:e,topic:(b=f[0]).startsWith("//")?b.substring(2):b,version:parseInt(f[1],10),symKey:g.symKey,relay:function(a,b="-"){let c={},d="relay"+b;return Object.keys(a).forEach(b=>{if(b.startsWith(d)){let e=b.replace(d,""),f=a[b];c[e]=f}}),c}(g),methods:h,expiryTimestamp:g.expiryTimestamp?parseInt(g.expiryTimestamp,10):void 0}}function pY(a){let b=new URLSearchParams;return Object.entries(pW(pW(pQ(pW({},function(a,b="-"){let c={};return Object.keys(a).forEach(d=>{a[d]&&(c["relay"+b+d]=a[d])}),c}(a.relay)),pR({symKey:a.symKey})),a.expiryTimestamp&&{expiryTimestamp:a.expiryTimestamp.toString()}),a.methods&&{methods:a.methods.join(",")})).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,c])=>{void 0!==c&&b.append(a,String(c))}),`${a.protocol}:${a.topic}@${a.version}?${b}`}function pZ(a,b,c){return`${a}?wc_ev=${c}&topic=${b}`}var p$=Object.defineProperty,p_=Object.defineProperties,p0=Object.getOwnPropertyDescriptors,p1=Object.getOwnPropertySymbols,p2=Object.prototype.hasOwnProperty,p3=Object.prototype.propertyIsEnumerable,p4=(a,b,c)=>b in a?p$(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,p5=(a,b)=>{for(var c in b||(b={}))p2.call(b,c)&&p4(a,c,b[c]);if(p1)for(var c of p1(b))p3.call(b,c)&&p4(a,c,b[c]);return a},p6=(a,b)=>p_(a,p0(b));function p7(a){let b=[];return a.forEach(a=>{let[c,d]=a.split(":");b.push(`${c}:${d}`)}),b}function p8(a){return a.includes(":")}function p9(a){return p8(a)?a.split(":")[0]:a}function qa(a){var b,c,d;let e={};if(!qh(a))return e;for(let[f,g]of Object.entries(a)){let a=p8(f)?[f]:g.chains,h=g.methods||[],i=g.events||[],j=p9(f);e[j]=p6(p5({},e[j]),{chains:lQ(a,null==(b=e[j])?void 0:b.chains),methods:lQ(h,null==(c=e[j])?void 0:c.methods),events:lQ(i,null==(d=e[j])?void 0:d.events)})}return e}function qb(a,b){var c;let d,e=(c=b=b.map(a=>a.replace("did:pkh:","")),d={},c?.forEach(a=>{var b;let[c,e]=a.split(":");d[c]||(d[c]={accounts:[],chains:[],events:[],methods:[]}),d[c].accounts.push(a),null==(b=d[c].chains)||b.push(`${c}:${e}`)}),d);for(let[b,c]of Object.entries(e))c.methods?c.methods=lQ(c.methods,a):c.methods=a,c.events=["chainChanged","accountsChanged"];return e}let qc={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},qd={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function qe(a,b){let{message:c,code:d}=qd[a];return{message:b?`${c} ${b}`:c,code:d}}function qf(a,b){let{message:c,code:d}=qc[a];return{message:b?`${c} ${b}`:c,code:d}}function qg(a,b){return!!Array.isArray(a)&&(!("u">typeof b)||!a.length||a.every(b))}function qh(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function qi(a){return typeof a>"u"}function qj(a,b){return!!(b&&qi(a))||"string"==typeof a&&!!a.trim().length}function qk(a,b){return!!(b&&qi(a))||"number"==typeof a&&!isNaN(a)}function ql(a){return!!(qj(a,!1)&&a.includes(":"))&&2===a.split(":").length}function qm(a){let b=!0;return qg(a)?a.length&&(b=a.every(a=>qj(a,!1))):b=!1,b}function qn(a,b){let c=null;return Object.values(a).forEach(a=>{var d;let e;if(c)return;let f=(d=`${b}, namespace`,e=null,qm(a?.methods)?qm(a?.events)||(e=qf("UNSUPPORTED_EVENTS",`${d}, events should be an array of strings or empty array for no events`)):e=qf("UNSUPPORTED_METHODS",`${d}, methods should be an array of strings or empty array for no methods`),e);f&&(c=f)}),c}function qo(a,b){let c=null;if(a&&qh(a)){let d,e=qn(a,b);e&&(c=e);let f=(d=null,Object.values(a).forEach(a=>{var c,e;let f;if(d)return;let g=(c=a?.accounts,e=`${b} namespace`,f=null,qg(c)?c.forEach(a=>{f||function(a){if(qj(a,!1)&&a.includes(":")){let b=a.split(":");if(3===b.length){let a=b[0]+":"+b[1];return!!b[2]&&ql(a)}}return!1}(a)||(f=qf("UNSUPPORTED_ACCOUNTS",`${e}, account ${a} should be a string and conform to "namespace:chainId:address" format`))}):f=qf("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),f);g&&(d=g)}),d);f&&(c=f)}else c=qe("MISSING_OR_INVALID",`${b}, namespaces should be an object with data`);return c}function qp(a){return qj(a.protocol,!0)}function qq(a){return"u">typeof a}function qr(a,b){let c;return!(!ql(b)||!(c=[],Object.values(a).forEach(a=>{c.push(...p7(a.accounts))}),c).includes(b))}function qs(a,b,c){var d,e;let f,g,h=null,i=(f={},Object.keys(d=a).forEach(a=>{var b;a.includes(":")?f[a]=d[a]:null==(b=d[a].chains)||b.forEach(b=>{f[b]={methods:d[a].methods,events:d[a].events}})}),f),j=(g={},Object.keys(e=b).forEach(a=>{if(a.includes(":"))g[a]=e[a];else{let b=p7(e[a].accounts);b?.forEach(b=>{g[b]={accounts:e[a].accounts.filter(a=>a.includes(`${b}:`)),methods:e[a].methods,events:e[a].events}})}}),g),k=Object.keys(i),l=Object.keys(j),m=qt(Object.keys(a)),n=qt(Object.keys(b)),o=m.filter(a=>!n.includes(a));return o.length&&(h=qe("NON_CONFORMING_NAMESPACES",`${c} namespaces keys don't satisfy requiredNamespaces.
      Required: ${o.toString()}
      Received: ${Object.keys(b).toString()}`)),lG(k,l)||(h=qe("NON_CONFORMING_NAMESPACES",`${c} namespaces chains don't satisfy required namespaces.
      Required: ${k.toString()}
      Approved: ${l.toString()}`)),Object.keys(b).forEach(a=>{if(!a.includes(":")||h)return;let d=p7(b[a].accounts);d.includes(a)||(h=qe("NON_CONFORMING_NAMESPACES",`${c} namespaces accounts don't satisfy namespace accounts for ${a}
        Required: ${a}
        Approved: ${d.toString()}`))}),k.forEach(a=>{h||(lG(i[a].methods,j[a].methods)?lG(i[a].events,j[a].events)||(h=qe("NON_CONFORMING_NAMESPACES",`${c} namespaces events don't satisfy namespace events for ${a}`)):h=qe("NON_CONFORMING_NAMESPACES",`${c} namespaces methods don't satisfy namespace methods for ${a}`))}),h}function qt(a){return[...new Set(a.map(a=>a.includes(":")?a.split(":")[0]:a))]}function qu(){let a=lC();return new Promise(b=>{switch(a){case ly:b(lB()&&navigator?.onLine);break;case lw:b(qv());break;default:b(!0)}})}async function qv(){if(lA()&&null!=a.g&&a.g.NetInfo){let b=await (null==a.g?void 0:a.g.NetInfo.fetch());return b?.isConnected}return!0}let qw={};class qx{static get(a){return qw[a]}static set(a,b){qw[a]=b}static delete(a){delete qw[a]}}function qy(a){return new Uint8Array(a.replace(/^0x/,"").match(/.{1,2}/g).map(a=>parseInt(a,16)))}function qz({logger:a,name:b}){let c="string"==typeof a?lj({opts:{level:a,name:b}}).logger:a;return c.level="string"==typeof a?a:a.level,c}var qA=a.i(822238),qB=a.i(697984);a.i(673975);var qC=a.i(581332),qD=Object.defineProperty,qE=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?qD(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class qF extends qC.IEvents{constructor(a){super(),this.opts=a,qE(this,"protocol","wc"),qE(this,"version",2)}}var qG=Object.defineProperty;class qH extends qC.IEvents{constructor(a,b){super(),this.core=a,this.logger=b,((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?qG(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"records",new Map)}}class qI{constructor(a,b){this.logger=a,this.core=b}}class qJ extends qC.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class qK extends qC.IEvents{constructor(a){super()}}class qL{constructor(a,b,c,d){this.core=a,this.logger=b,this.name=c}}class qM extends qC.IEvents{constructor(a,b){super(),this.relayer=a,this.logger=b}}class qN extends qC.IEvents{constructor(a,b){super(),this.core=a,this.logger=b}}class qO{constructor(a,b,c){this.core=a,this.logger=b,this.store=c}}class qP{constructor(a,b){this.projectId=a,this.logger=b}}class qQ{constructor(a,b,c){this.core=a,this.logger=b,this.telemetryEnabled=c}}var qR=Object.defineProperty,qS=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?qR(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};cB.default;class qT{constructor(a){this.opts=a,qS(this,"protocol","wc"),qS(this,"version",2)}}cB.EventEmitter;class qU{constructor(a){this.client=a}}var qV=a.i(168326);a.i(371964);var qW=a.i(771167),qX=a.i(416537),qY=a.i(576863);let qZ="core",q$=`wc@2:${qZ}:`,q_={database:":memory:"},q0="client_ed25519_seed",q1=ij.ONE_DAY,q2=ij.SIX_HOURS,q3="wss://relay.walletconnect.org",q4="relayer_message",q5="relayer_message_ack",q6="relayer_connection_stalled",q7="relayer_publish",q8="payload",q9="connect",ra="disconnect",rb="error",rc="2.22.4",rd="link_mode",re="relay",rf="inbound",rg="WALLETCONNECT_LINK_MODE_APPS",rh="subscription_created",ri="subscription_deleted",rj=(ij.THIRTY_DAYS,ij.FIVE_SECONDS,ij.THIRTY_DAYS,{wc_pairingDelete:{req:{ttl:ij.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ij.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ij.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ij.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ij.ONE_DAY,prompt:!1,tag:0},res:{ttl:ij.ONE_DAY,prompt:!1,tag:0}}}),rk="pairing_create",rl="pairing_delete",rm="history_created",rn="history_updated",ro="history_deleted",rp="expirer_created",rq="expirer_deleted",rr="expirer_expired",rs=(ij.ONE_DAY,"https://verify.walletconnect.org"),rt=`${rs}/v3`,ru=["https://verify.walletconnect.com",rs],rv="malformed_pairing_uri",rw="session_approve_started";var rx=function(a,b){if(a.length>=255)throw TypeError("Alphabet too long");for(var c=new Uint8Array(256),d=0;d<c.length;d++)c[d]=255;for(var e=0;e<a.length;e++){var f=a.charAt(e),g=f.charCodeAt(0);if(255!==c[g])throw TypeError(f+" is ambiguous");c[g]=e}var h=a.length,i=a.charAt(0),j=Math.log(h)/Math.log(256),k=Math.log(256)/Math.log(h);function l(a){if("string"!=typeof a)throw TypeError("Expected String");if(0===a.length)return new Uint8Array;var b=0;if(" "!==a[0]){for(var d=0,e=0;a[b]===i;)d++,b++;for(var f=(a.length-b)*j+1>>>0,g=new Uint8Array(f);a[b];){var k=c[a.charCodeAt(b)];if(255===k)return;for(var l=0,m=f-1;(0!==k||l<e)&&-1!==m;m--,l++)k+=h*g[m]>>>0,g[m]=k%256>>>0,k=k/256>>>0;if(0!==k)throw Error("Non-zero carry");e=l,b++}if(" "!==a[b]){for(var n=f-e;n!==f&&0===g[n];)n++;for(var o=new Uint8Array(d+(f-n)),p=d;n!==f;)o[p++]=g[n++];return o}}}return{encode:function(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===b.length)return"";for(var c=0,d=0,e=0,f=b.length;e!==f&&0===b[e];)e++,c++;for(var g=(f-e)*k+1>>>0,j=new Uint8Array(g);e!==f;){for(var l=b[e],m=0,n=g-1;(0!==l||m<d)&&-1!==n;n--,m++)l+=256*j[n]>>>0,j[n]=l%h>>>0,l=l/h>>>0;if(0!==l)throw Error("Non-zero carry");d=m,e++}for(var o=g-d;o!==g&&0===j[o];)o++;for(var p=i.repeat(c);o<g;++o)p+=a.charAt(j[o]);return p},decodeUnsafe:l,decode:function(a){var c=l(a);if(c)return c;throw Error(`Non-${b} character`)}}};let ry=a=>{if(a instanceof Uint8Array&&"Uint8Array"===a.constructor.name)return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw Error("Unknown type, must be binary type")};class rz{constructor(a,b,c){this.name=a,this.prefix=b,this.baseEncode=c}encode(a){if(a instanceof Uint8Array)return`${this.prefix}${this.baseEncode(a)}`;throw Error("Unknown type, must be binary type")}}class rA{constructor(a,b,c){if(this.name=a,this.prefix=b,void 0===b.codePointAt(0))throw Error("Invalid prefix character");this.prefixCodePoint=b.codePointAt(0),this.baseDecode=c}decode(a){if("string"==typeof a){if(a.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(a)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(a.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(a){return rC(this,a)}}class rB{constructor(a){this.decoders=a}or(a){return rC(this,a)}decode(a){let b=a[0],c=this.decoders[b];if(c)return c.decode(a);throw RangeError(`Unable to decode multibase string ${JSON.stringify(a)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}let rC=(a,b)=>new rB({...a.decoders||{[a.prefix]:a},...b.decoders||{[b.prefix]:b}});class rD{constructor(a,b,c,d){this.name=a,this.prefix=b,this.baseEncode=c,this.baseDecode=d,this.encoder=new rz(a,b,c),this.decoder=new rA(a,b,d)}encode(a){return this.encoder.encode(a)}decode(a){return this.decoder.decode(a)}}let rE=({name:a,prefix:b,encode:c,decode:d})=>new rD(a,b,c,d),rF=({prefix:a,name:b,alphabet:c})=>{let{encode:d,decode:e}=rx(c,b);return rE({prefix:a,name:b,encode:d,decode:a=>ry(e(a))})},rG=({name:a,prefix:b,bitsPerChar:c,alphabet:d})=>rE({prefix:b,name:a,encode:a=>((a,b,c)=>{let d="="===b[b.length-1],e=(1<<c)-1,f="",g=0,h=0;for(let d=0;d<a.length;++d)for(h=h<<8|a[d],g+=8;g>c;)g-=c,f+=b[e&h>>g];if(g&&(f+=b[e&h<<c-g]),d)for(;f.length*c&7;)f+="=";return f})(a,d,c),decode:b=>((a,b,c,d)=>{let e={};for(let a=0;a<b.length;++a)e[b[a]]=a;let f=a.length;for(;"="===a[f-1];)--f;let g=new Uint8Array(f*c/8|0),h=0,i=0,j=0;for(let b=0;b<f;++b){let f=e[a[b]];if(void 0===f)throw SyntaxError(`Non-${d} character`);i=i<<c|f,(h+=c)>=8&&(h-=8,g[j++]=255&i>>h)}if(h>=c||255&i<<8-h)throw SyntaxError("Unexpected end of data");return g})(b,d,c,a)});var rH=Object.freeze({__proto__:null,identity:rE({prefix:"\0",name:"identity",encode:a=>new TextDecoder().decode(a),decode:a=>new TextEncoder().encode(a)})}),rI=Object.freeze({__proto__:null,base2:rG({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1})}),rJ=Object.freeze({__proto__:null,base8:rG({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3})}),rK=Object.freeze({__proto__:null,base10:rF({prefix:"9",name:"base10",alphabet:"0123456789"})}),rL=Object.freeze({__proto__:null,base16:rG({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),base16upper:rG({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4})}),rM=Object.freeze({__proto__:null,base32:rG({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),base32upper:rG({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),base32pad:rG({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),base32padupper:rG({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),base32hex:rG({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),base32hexupper:rG({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),base32hexpad:rG({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),base32hexpadupper:rG({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),base32z:rG({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})}),rN=Object.freeze({__proto__:null,base36:rF({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),base36upper:rF({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"})}),rO=Object.freeze({__proto__:null,base58btc:rF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),base58flickr:rF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})}),rP=Object.freeze({__proto__:null,base64:rG({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),base64pad:rG({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),base64url:rG({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),base64urlpad:rG({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6})});let rQ=Array.from(""),rR=rQ.reduce((a,b,c)=>(a[c]=b,a),[]),rS=rQ.reduce((a,b,c)=>(a[b.codePointAt(0)]=c,a),[]);var rT=Object.freeze({__proto__:null,base256emoji:rE({prefix:"",name:"base256emoji",encode:function(a){return a.reduce((a,b)=>a+=rR[b],"")},decode:function(a){let b=[];for(let c of a){let a=rS[c.codePointAt(0)];if(void 0===a)throw Error(`Non-base256emoji character: ${c}`);b.push(a)}return new Uint8Array(b)}})});function rU(a,b,c){b=b||[],c=c||0;for(var d=c;a>=0x80000000;)b[c++]=255&a|128,a/=128;for(;-128&a;)b[c++]=255&a|128,a>>>=7;return b[c]=0|a,rU.bytes=c-d+1,b}var rV=function(a){return a<128?1:a<16384?2:a<2097152?3:a<0x10000000?4:a<0x800000000?5:a<0x40000000000?6:a<0x2000000000000?7:a<0x100000000000000?8:a<0x8000000000000000?9:10};let rW=(a,b,c=0)=>(rU(a,b,c),b),rX=(a,b)=>{let c=b.byteLength,d=rV(a),e=d+rV(c),f=new Uint8Array(e+c);return rW(a,f,0),rW(c,f,d),f.set(b,e),new rY(a,c,b,f)};class rY{constructor(a,b,c,d){this.code=a,this.size=b,this.digest=c,this.bytes=d}}let rZ=({name:a,code:b,encode:c})=>new r$(a,b,c);class r${constructor(a,b,c){this.name=a,this.code=b,this.encode=c}digest(a){if(a instanceof Uint8Array){let b=this.encode(a);return b instanceof Uint8Array?rX(this.code,b):b.then(a=>rX(this.code,a))}throw Error("Unknown type, must be binary type")}}let r_=a=>async b=>new Uint8Array(await crypto.subtle.digest(a,b));var r0=Object.freeze({__proto__:null,sha256:rZ({name:"sha2-256",code:18,encode:r_("SHA-256")}),sha512:rZ({name:"sha2-512",code:19,encode:r_("SHA-512")})}),r1=Object.freeze({__proto__:null,identity:{code:0,name:"identity",encode:ry,digest:a=>rX(0,ry(a))}});new TextEncoder,new TextDecoder;let r2={...rH,...rI,...rJ,...rK,...rL,...rM,...rN,...rO,...rP,...rT};function r3(a){return null!=globalThis.Buffer?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function r4(a,b,c,d){return{name:a,prefix:b,encoder:{name:a,prefix:b,encode:c},decoder:{decode:d}}}({...r0,...r1});let r5=r4("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),r6=r4("ascii","a",a=>{let b="a";for(let c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},a=>{let b=function(a=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?r3(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}((a=a.substring(1)).length);for(let c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}),r7={utf8:r5,"utf-8":r5,hex:r2.base16,latin1:r6,ascii:r6,binary:r6,...r2};var r8=Object.defineProperty,r9=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?r8(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class sa{constructor(a,b){this.core=a,this.logger=b,r9(this,"keychain",new Map),r9(this,"name","keychain"),r9(this,"version","0.3"),r9(this,"initialized",!1),r9(this,"storagePrefix",q$),r9(this,"init",async()=>{if(!this.initialized){let a=await this.getKeyChain();"u">typeof a&&(this.keychain=a),this.initialized=!0}}),r9(this,"has",a=>(this.isInitialized(),this.keychain.has(a))),r9(this,"set",async(a,b)=>{this.isInitialized(),this.keychain.set(a,b),await this.persist()}),r9(this,"get",a=>{this.isInitialized();let b=this.keychain.get(a);if(typeof b>"u"){let{message:b}=qe("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}),r9(this,"del",async a=>{this.isInitialized(),this.keychain.delete(a),await this.persist()}),this.core=a,this.logger=li(b,this.name)}get context(){return lh(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(a){await this.core.storage.setItem(this.storageKey,lH(a))}async getKeyChain(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?lI(a):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}}var sb=Object.defineProperty,sc=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?sb(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class sd{constructor(a,b,c){this.core=a,this.logger=b,sc(this,"name","crypto"),sc(this,"keychain"),sc(this,"randomSessionIdentifier",pC()),sc(this,"initialized",!1),sc(this,"clientId"),sc(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),sc(this,"hasKeys",a=>(this.isInitialized(),this.keychain.has(a))),sc(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;let a=await this.getClientSeed(),b=kT.generateKeyPair(a),c=kT.encodeIss(b.publicKey);return this.clientId=c,c}),sc(this,"generateKeyPair",()=>{let a,b;this.isInitialized();let c=(a=pc.utils.randomPrivateKey(),b=pc.getPublicKey(a),{privateKey:(0,kU.toString)(a,py),publicKey:(0,kU.toString)(b,py)});return this.setPrivateKey(c.publicKey,c.privateKey)}),sc(this,"signJWT",async a=>{this.isInitialized();let b=await this.getClientSeed(),c=kT.generateKeyPair(b),d=this.randomSessionIdentifier;return await kT.signJWT(d,a,q1,c)}),sc(this,"generateSharedKey",(a,b,c)=>{var d,e,f;let g,h;this.isInitialized();let i=(d=this.getPrivateKey(a),g=pc.getSharedSecret((0,kV.fromString)(d,py),(0,kV.fromString)(b,py)),e=void 0,h=function(a,b,c,d=32){mh(a),mf(d);let e=a.outputLen;if(d>255*e)throw Error("Length should be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c&&(c=oc);let g=new Uint8Array(f*e),h=oa.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)ob[0]=a+1,i.update(0===a?oc:j).update(c).update(ob).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),ml(j,ob),g.slice(0,d)}(m7,(f=void 0,mh(m7),void 0===f&&(f=new Uint8Array(m7.outputLen)),oa(m7,my(f),my(g))),e,32),(0,kU.toString)(h,py));return this.setSymKey(i,c)}),sc(this,"setSymKey",async(a,b)=>{this.isInitialized();let c=b||pD(a);return await this.keychain.set(c,a),c}),sc(this,"deleteKeyPair",async a=>{this.isInitialized(),await this.keychain.del(a)}),sc(this,"deleteSymKey",async a=>{this.isInitialized(),await this.keychain.del(a)}),sc(this,"encode",async(a,b,c)=>{this.isInitialized();let d=pL(c),e=(0,k$.safeJsonStringify)(b);if(2===d.type){var f;let a,b,d;return f=c?.encoding,a=pF(2),b=mC(12),d=pJ({type:a,sealed:(0,kV.fromString)(e,pB),iv:b}),f===pA?pH(d):d}if(pM(d)){let b=d.senderPublicKey,c=d.receiverPublicKey;a=await this.generateSharedKey(b,c)}let g=this.getSymKey(a),{type:h,senderPublicKey:i}=d;return function(a){let b=pF("u">typeof a.type?a.type:0);if(1===pG(b)&&typeof a.senderPublicKey>"u")throw Error("Missing sender public key for type 1 envelope");let c="u">typeof a.senderPublicKey?(0,kV.fromString)(a.senderPublicKey,py):void 0,d="u">typeof a.iv?(0,kV.fromString)(a.iv,py):mC(12),e=pJ({type:b,sealed:n8((0,kV.fromString)(a.symKey,py),d).encrypt((0,kV.fromString)(a.message,pB)),iv:d,senderPublicKey:c});return a.encoding===pA?pH(e):e}({type:h,symKey:g,message:e,senderPublicKey:i,encoding:c?.encoding})}),sc(this,"decode",async(a,b,c)=>{let d;this.isInitialized();let e=pL({type:pG((d=pK({encoded:b,encoding:c?.encoding})).type),senderPublicKey:"u">typeof d.senderPublicKey?(0,kU.toString)(d.senderPublicKey,py):void 0,receiverPublicKey:c?.receiverPublicKey});if(2===e.type){let a=function(a,b){let{sealed:c}=pK({encoded:a,encoding:b});return(0,kU.toString)(c,pB)}(b,c?.encoding);return(0,k$.safeJsonParse)(a)}if(pM(e)){let b=e.receiverPublicKey,c=e.senderPublicKey;a=await this.generateSharedKey(b,c)}try{let d=this.getSymKey(a),e=function(a){let b=(0,kV.fromString)(a.symKey,py),{sealed:c,iv:d}=pK({encoded:a.encoded,encoding:a.encoding}),e=n8(b,d).decrypt(c);if(null===e)throw Error("Failed to decrypt");return(0,kU.toString)(e,pB)}({symKey:d,encoded:b,encoding:c?.encoding});return(0,k$.safeJsonParse)(e)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}}),sc(this,"getPayloadType",(a,b=pz)=>pG(pK({encoded:a,encoding:b}).type)),sc(this,"getPayloadSenderPublicKey",(a,b=pz)=>{let c=pK({encoded:a,encoding:b});return c.senderPublicKey?(0,kU.toString)(c.senderPublicKey,py):void 0}),this.core=a,this.logger=li(b,this.name),this.keychain=c||new sa(this.core,this.logger)}get context(){return lh(this.logger)}async setPrivateKey(a,b){return await this.keychain.set(a,b),a}getPrivateKey(a){return this.keychain.get(a)}async getClientSeed(){let a="";try{a=this.keychain.get(q0)}catch{a=pC(),await this.keychain.set(q0,a)}return function(a,b="utf8"){let c=r7[b];if(!c)throw Error(`Unsupported encoding "${b}"`);return("utf8"===b||"utf-8"===b)&&null!=globalThis.Buffer&&null!=globalThis.Buffer.from?r3(globalThis.Buffer.from(a,"utf-8")):c.decoder.decode(`${c.prefix}${a}`)}(a,"base16")}getSymKey(a){return this.keychain.get(a)}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}}var se=Object.defineProperty,sf=Object.defineProperties,sg=Object.getOwnPropertyDescriptors,sh=Object.getOwnPropertySymbols,si=Object.prototype.hasOwnProperty,sj=Object.prototype.propertyIsEnumerable,sk=(a,b,c)=>b in a?se(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,sl=(a,b,c)=>sk(a,"symbol"!=typeof b?b+"":b,c);class sm extends qI{constructor(a,b){super(a,b),this.logger=a,this.core=b,sl(this,"messages",new Map),sl(this,"messagesWithoutClientAck",new Map),sl(this,"name","messages"),sl(this,"version","0.3"),sl(this,"initialized",!1),sl(this,"storagePrefix",q$),sl(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let a=await this.getRelayerMessages();"u">typeof a&&(this.messages=a);let b=await this.getRelayerMessagesWithoutClientAck();"u">typeof b&&(this.messagesWithoutClientAck=b),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}finally{this.initialized=!0}}}),sl(this,"set",async(a,b,c)=>{this.isInitialized();let d=pE(b),e=this.messages.get(a);if(typeof e>"u"&&(e={}),"u">typeof e[d])return d;if(e[d]=b,this.messages.set(a,e),c===rf){let c=this.messagesWithoutClientAck.get(a)||{};this.messagesWithoutClientAck.set(a,sf(((a,b)=>{for(var c in b||(b={}))si.call(b,c)&&sk(a,c,b[c]);if(sh)for(var c of sh(b))sj.call(b,c)&&sk(a,c,b[c]);return a})({},c),sg({[d]:b})))}return await this.persist(),d}),sl(this,"get",a=>{this.isInitialized();let b=this.messages.get(a);return typeof b>"u"&&(b={}),b}),sl(this,"getWithoutAck",a=>{this.isInitialized();let b={};for(let c of a){let a=this.messagesWithoutClientAck.get(c)||{};b[c]=Object.values(a)}return b}),sl(this,"has",(a,b)=>(this.isInitialized(),"u">typeof this.get(a)[pE(b)])),sl(this,"ack",async(a,b)=>{this.isInitialized();let c=this.messagesWithoutClientAck.get(a);if(typeof c>"u")return;let d=pE(b);delete c[d],0===Object.keys(c).length?this.messagesWithoutClientAck.delete(a):this.messagesWithoutClientAck.set(a,c),await this.persist()}),sl(this,"del",async a=>{this.isInitialized(),this.messages.delete(a),this.messagesWithoutClientAck.delete(a),await this.persist()}),this.logger=li(a,this.name),this.core=b}get context(){return lh(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(a){await this.core.storage.setItem(this.storageKey,lH(a))}async setRelayerMessagesWithoutClientAck(a){await this.core.storage.setItem(this.storageKeyWithoutClientAck,lH(a))}async getRelayerMessages(){let a=await this.core.storage.getItem(this.storageKey);return"u">typeof a?lI(a):void 0}async getRelayerMessagesWithoutClientAck(){let a=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return"u">typeof a?lI(a):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}}var sn=Object.defineProperty,so=Object.defineProperties,sp=Object.getOwnPropertyDescriptors,sq=Object.getOwnPropertySymbols,sr=Object.prototype.hasOwnProperty,ss=Object.prototype.propertyIsEnumerable,st=(a,b,c)=>b in a?sn(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,su=(a,b)=>{for(var c in b||(b={}))sr.call(b,c)&&st(a,c,b[c]);if(sq)for(var c of sq(b))ss.call(b,c)&&st(a,c,b[c]);return a},sv=(a,b,c)=>st(a,"symbol"!=typeof b?b+"":b,c);class sw extends qJ{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,sv(this,"events",new cB.EventEmitter),sv(this,"name","publisher"),sv(this,"queue",new Map),sv(this,"publishTimeout",(0,ij.toMiliseconds)(ij.ONE_MINUTE)),sv(this,"initialPublishTimeout",(0,ij.toMiliseconds)(15*ij.ONE_SECOND)),sv(this,"needsTransportRestart",!1),sv(this,"publish",async(a,b,c)=>{var d,e,f,g,h;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:a,message:b,opts:c}});let i=c?.ttl||q2,j=c?.prompt||!1,k=c?.tag||0,l=c?.id||(0,qW.getBigIntRpcId)().toString(),m=pO(pN().protocol),n={id:l,method:c?.publishMethod||m.publish,params:su({topic:a,message:b,ttl:i,prompt:j,tag:k,attestation:c?.attestation},c?.tvf)},o=`Failed to publish payload, please try again. id:${l} tag:${k}`;try{qi(null==(d=n.params)?void 0:d.prompt)&&(null==(e=n.params)||delete e.prompt),qi(null==(f=n.params)?void 0:f.tag)&&(null==(g=n.params)||delete g.tag);let h=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=n.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(q7,b),a())};this.relayer.events.on(q7,b);let d=lK(new Promise((a,b)=>{this.rpcPublish(n,c).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${l} tag:${k}`);try{await d,this.events.removeListener(q7,b)}catch(a){this.queue.set(l,{request:n,opts:c,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:l,topic:a,message:b,opts:c}}),await lK(h,this.publishTimeout,o)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(h=c?.internal)&&h.throwOnFailedPublish)throw a}finally{this.queue.delete(l)}}),sv(this,"publishCustom",async a=>{var b,c,d,e,f;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:a});let{payload:g,opts:h={}}=a,{attestation:i,tvf:j,publishMethod:k,prompt:l,tag:m,ttl:n=ij.FIVE_MINUTES}=h,o=h.id||(0,qW.getBigIntRpcId)().toString(),p=pO(pN().protocol),q=k||p.publish,r={id:o,method:q,params:su(so(su({},g),sp({ttl:n,prompt:l,tag:m,attestation:i})),j)},s=`Failed to publish custom payload, please try again. id:${o} tag:${m}`;try{qi(null==(b=r.params)?void 0:b.prompt)&&(null==(c=r.params)||delete c.prompt),qi(null==(d=r.params)?void 0:d.tag)&&(null==(e=r.params)||delete e.tag);let a=new Promise(async a=>{let b=({id:c})=>{var d;(null==(d=r.id)?void 0:d.toString())===c.toString()&&(this.removeRequestFromQueue(c),this.relayer.events.removeListener(q7,b),a())};this.relayer.events.on(q7,b);let c=lK(new Promise((a,b)=>{this.rpcPublish(r,h).then(a).catch(a=>{this.logger.warn(a,a?.message),b(a)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${q} id:${o} tag:${m}`);try{await c,this.events.removeListener(q7,b)}catch(a){this.queue.set(o,{request:r,opts:h,attempt:1}),this.logger.warn(a,a?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:o,payload:g,opts:h}}),await lK(a,this.publishTimeout,s)}catch(a){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(a),null!=(f=h?.internal)&&f.throwOnFailedPublish)throw a}finally{this.queue.delete(o)}}),sv(this,"on",(a,b)=>{this.events.on(a,b)}),sv(this,"once",(a,b)=>{this.events.once(a,b)}),sv(this,"off",(a,b)=>{this.events.off(a,b)}),sv(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.relayer=a,this.logger=li(b,this.name),this.registerEventListeners()}get context(){return lh(this.logger)}async rpcPublish(a,b){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:a});let c=await this.relayer.request(a);return this.relayer.events.emit(q7,su(su({},a),b)),this.logger.debug("Successfully Published Payload"),c}removeRequestFromQueue(a){this.queue.delete(a)}checkQueue(){this.queue.forEach(async(a,b)=>{var c;let d=a.attempt+1;this.queue.set(b,so(su({},a),sp({attempt:d}))),this.logger.warn({},`Publisher: queue->publishing: ${a.request.id}, tag: ${null==(c=a.request.params)?void 0:c.tag}, attempt: ${d}`),await this.rpcPublish(a.request,a.opts),this.logger.warn({},`Publisher: queue->published: ${a.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(qA.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(q6);return}this.checkQueue()}),this.relayer.on(q5,a=>{this.removeRequestFromQueue(a.id.toString())})}}var sx=Object.defineProperty,sy=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?sx(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class sz{constructor(){sy(this,"map",new Map),sy(this,"set",(a,b)=>{let c=this.get(a);this.exists(a,b)||this.map.set(a,[...c,b])}),sy(this,"get",a=>this.map.get(a)||[]),sy(this,"exists",(a,b)=>this.get(a).includes(b)),sy(this,"delete",(a,b)=>{if(typeof b>"u")return void this.map.delete(a);if(!this.map.has(a))return;let c=this.get(a);if(!this.exists(a,b))return;let d=c.filter(a=>a!==b);d.length?this.map.set(a,d):this.map.delete(a)}),sy(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var sA=Object.defineProperty,sB=Object.defineProperties,sC=Object.getOwnPropertyDescriptors,sD=Object.getOwnPropertySymbols,sE=Object.prototype.hasOwnProperty,sF=Object.prototype.propertyIsEnumerable,sG=(a,b,c)=>b in a?sA(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,sH=(a,b)=>{for(var c in b||(b={}))sE.call(b,c)&&sG(a,c,b[c]);if(sD)for(var c of sD(b))sF.call(b,c)&&sG(a,c,b[c]);return a},sI=(a,b,c)=>sG(a,"symbol"!=typeof b?b+"":b,c);class sJ extends qM{constructor(a,b){super(a,b),this.relayer=a,this.logger=b,sI(this,"subscriptions",new Map),sI(this,"topicMap",new sz),sI(this,"events",new cB.EventEmitter),sI(this,"name","subscription"),sI(this,"version","0.3"),sI(this,"pending",new Map),sI(this,"cached",[]),sI(this,"initialized",!1),sI(this,"storagePrefix",q$),sI(this,"subscribeTimeout",(0,ij.toMiliseconds)(ij.ONE_MINUTE)),sI(this,"initialSubscribeTimeout",(0,ij.toMiliseconds)(15*ij.ONE_SECOND)),sI(this,"clientId"),sI(this,"batchSubscribeTopicsLimit",500),sI(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),sI(this,"subscribe",async(a,b)=>{var c;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}});try{let d=pN(b),e={topic:a,relay:d,transportType:b?.transportType};null!=(c=b?.internal)&&c.skipSubscribe||this.pending.set(a,e);let f=await this.rpcSubscribe(a,d,b);return"string"==typeof f&&(this.onSubscribe(f,e),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:a,opts:b}})),f}catch(a){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(a),a}}),sI(this,"unsubscribe",async(a,b)=>{this.isInitialized(),"u">typeof b?.id?await this.unsubscribeById(a,b.id,b):await this.unsubscribeByTopic(a,b)}),sI(this,"isSubscribed",a=>new Promise(b=>{b(this.topicMap.topics.includes(a))})),sI(this,"isKnownTopic",a=>new Promise(b=>{b(this.topicMap.topics.includes(a)||this.pending.has(a)||this.cached.some(b=>b.topic===a))})),sI(this,"on",(a,b)=>{this.events.on(a,b)}),sI(this,"once",(a,b)=>{this.events.once(a,b)}),sI(this,"off",(a,b)=>{this.events.off(a,b)}),sI(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),sI(this,"start",async()=>{await this.onConnect()}),sI(this,"stop",async()=>{await this.onDisconnect()}),sI(this,"restart",async()=>{await this.restore(),await this.onRestart()}),sI(this,"checkPending",async()=>{if(0===this.pending.size&&(!this.initialized||!this.relayer.connected))return;let a=[];this.pending.forEach(b=>{a.push(b)}),await this.batchSubscribe(a)}),sI(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(qA.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(rh,async a=>{this.logger.info(`Emitting ${rh}`),this.logger.debug({type:"event",event:rh,data:a}),await this.persist()}),this.events.on(ri,async a=>{this.logger.info(`Emitting ${ri}`),this.logger.debug({type:"event",event:ri,data:a}),await this.persist()})}),this.relayer=a,this.logger=li(b,this.name),this.clientId=""}get context(){return lh(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(a,b){let c=!1;try{c=this.getSubscription(a).topic===b}catch{}return c}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(a,b){let c=this.topicMap.get(a);await Promise.all(c.map(async c=>await this.unsubscribeById(a,c,b)))}async unsubscribeById(a,b,c){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}});try{let d=pN(c);await this.restartToComplete({topic:a,id:b,relay:d}),await this.rpcUnsubscribe(a,b,d);let e=qf("USER_DISCONNECTED",`${this.name}, ${a}`);await this.onUnsubscribe(a,b,e),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:a,id:b,opts:c}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(a,b,c){var d,e;let f=await this.getSubscriptionId(a);if(null!=(d=c?.internal)&&d.skipSubscribe)return f;c&&c?.transportType!==re||await this.restartToComplete({topic:a,id:a,relay:b});let g={method:pO(b.protocol).subscribe,params:{topic:a}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:g});let h=null==(e=c?.internal)?void 0:e.throwOnFailedPublish;try{if(c?.transportType===rd)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(g).catch(a=>this.logger.warn(a))},(0,ij.toMiliseconds)(ij.ONE_SECOND)),f;let b=new Promise(async b=>{let c=d=>{d.topic===a&&(this.events.removeListener(rh,c),b(d.id))};this.events.on(rh,c);try{let d=await lK(new Promise((a,b)=>{this.relayer.request(g).catch(a=>{this.logger.warn(a,a?.message),b(a)}).then(a)}),this.initialSubscribeTimeout,`Subscribing to ${a} failed, please try again`);this.events.removeListener(rh,c),b(d)}catch{}}),d=await lK(b,this.subscribeTimeout,`Subscribing to ${a} failed, please try again`);if(!d&&h)throw Error(`Subscribing to ${a} failed, please try again`);return d?f:null}catch(a){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(q6),h)throw a}return null}async rpcBatchSubscribe(a){if(!a.length)return;let b={method:pO(a[0].relay.protocol).batchSubscribe,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:b});try{await await lK(new Promise(a=>{this.relayer.request(b).catch(a=>this.logger.warn(a)).then(a)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(q6)}}async rpcBatchFetchMessages(a){let b;if(!a.length)return;let c={method:pO(a[0].relay.protocol).batchFetchMessages,params:{topics:a.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:c});try{b=await await lK(new Promise((a,b)=>{this.relayer.request(c).catch(a=>{this.logger.warn(a),b(a)}).then(a)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(q6)}return b}rpcUnsubscribe(a,b,c){let d={method:pO(c.protocol).unsubscribe,params:{topic:a,id:b}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:d}),this.relayer.request(d)}onSubscribe(a,b){this.setSubscription(a,sB(sH({},b),sC({id:a}))),this.pending.delete(b.topic)}onBatchSubscribe(a){a.length&&a.forEach(a=>{this.setSubscription(a.id,sH({},a)),this.pending.delete(a.topic)})}async onUnsubscribe(a,b,c){this.events.removeAllListeners(b),this.hasSubscription(b,a)&&this.deleteSubscription(b,c),await this.relayer.messages.del(a)}async setRelayerSubscriptions(a){await this.relayer.core.storage.setItem(this.storageKey,a)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(a,b){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:a,subscription:b}),this.addSubscription(a,b)}addSubscription(a,b){this.subscriptions.set(a,sH({},b)),this.topicMap.set(b.topic,a),this.events.emit(rh,b)}getSubscription(a){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:a});let b=this.subscriptions.get(a);if(!b){let{message:b}=qe("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}deleteSubscription(a,b){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:a,reason:b});let c=this.getSubscription(a);this.subscriptions.delete(a),this.topicMap.delete(c.topic,a),this.events.emit(ri,sB(sH({},c),sC({reason:b})))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit("subscription_sync")}async onRestart(){if(this.cached.length){let a=[...this.cached],b=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let c=0;c<b;c++){let b=a.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(b)}}this.events.emit("subscription_resubscribed")}async restore(){try{let a=await this.getRelayerSubscriptions();if(typeof a>"u"||!a.length)return;if(this.subscriptions.size&&!a.every(a=>{var b;return a.topic===(null==(b=this.subscriptions.get(a.id))?void 0:b.topic)})){let{message:a}=qe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(a){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(a)}}async batchSubscribe(a){a.length&&(await this.rpcBatchSubscribe(a),this.onBatchSubscribe(await Promise.all(a.map(async a=>sB(sH({},a),sC({id:await this.getSubscriptionId(a.topic)}))))))}async batchFetchMessages(a){var b;if(!a.length)return;this.logger.trace(`Fetching batch messages for ${a.length} subscriptions`);let c=await this.rpcBatchFetchMessages(a);c&&c.messages&&(await (b=(0,ij.toMiliseconds)(ij.ONE_SECOND),new Promise(a=>setTimeout(a,b))),await this.relayer.handleBatchMessageEvents(c.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}async restartToComplete(a){this.relayer.connected||this.relayer.connecting||(this.cached.push(a),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(a){return pE(a+await this.getClientId())}}var sK=Object.defineProperty,sL=Object.getOwnPropertySymbols,sM=Object.prototype.hasOwnProperty,sN=Object.prototype.propertyIsEnumerable,sO=(a,b,c)=>b in a?sK(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,sP=(a,b)=>{for(var c in b||(b={}))sM.call(b,c)&&sO(a,c,b[c]);if(sL)for(var c of sL(b))sN.call(b,c)&&sO(a,c,b[c]);return a},sQ=(a,b,c)=>sO(a,"symbol"!=typeof b?b+"":b,c);class sR extends qK{constructor(b){var c;super(b),sQ(this,"protocol","wc"),sQ(this,"version",2),sQ(this,"core"),sQ(this,"logger"),sQ(this,"events",new cB.EventEmitter),sQ(this,"provider"),sQ(this,"messages"),sQ(this,"subscriber"),sQ(this,"publisher"),sQ(this,"name","relayer"),sQ(this,"transportExplicitlyClosed",!1),sQ(this,"initialized",!1),sQ(this,"connectionAttemptInProgress",!1),sQ(this,"relayUrl"),sQ(this,"projectId"),sQ(this,"packageName"),sQ(this,"bundleId"),sQ(this,"hasExperiencedNetworkDisruption",!1),sQ(this,"pingTimeout"),sQ(this,"heartBeatTimeout",(0,ij.toMiliseconds)(ij.THIRTY_SECONDS+ij.FIVE_SECONDS)),sQ(this,"reconnectTimeout"),sQ(this,"connectPromise"),sQ(this,"reconnectInProgress",!1),sQ(this,"requestsInFlight",[]),sQ(this,"connectTimeout",(0,ij.toMiliseconds)(15*ij.ONE_SECOND)),sQ(this,"request",async a=>{var b,c;this.logger.debug("Publishing Request Payload");let d=a.id||(0,qW.getBigIntRpcId)().toString();await this.toEstablishConnection();try{this.logger.trace({id:d,method:a.method,topic:null==(b=a.params)?void 0:b.topic},"relayer.request - publishing...");let e=`${d}:${(null==(c=a.params)?void 0:c.tag)||""}`;this.requestsInFlight.push(e);let f=await this.provider.request(a);return this.requestsInFlight=this.requestsInFlight.filter(a=>a!==e),f}catch(a){throw this.logger.debug(`Failed to Publish Request: ${d}`),a}}),sQ(this,"resetPingTimeout",()=>{lz()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var a,b,c,d;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),null==(d=null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.terminate)||d.call(c)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),sQ(this,"onPayloadHandler",a=>{this.onProviderPayload(a),this.resetPingTimeout()}),sQ(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit("relayer_connect")}),sQ(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),sQ(this,"onProviderErrorHandler",a=>{this.logger.fatal(`Fatal socket error: ${a.message}`),this.events.emit("relayer_error",a),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),sQ(this,"registerProviderListeners",()=>{this.provider.on(q8,this.onPayloadHandler),this.provider.on(q9,this.onConnectHandler),this.provider.on(ra,this.onDisconnectHandler),this.provider.on(rb,this.onProviderErrorHandler)}),this.core=b.core,this.logger=qz({logger:null!=(c=b.logger)?c:"error",name:this.name}),this.messages=new sm(this.logger,b.core),this.subscriber=new sJ(this,this.logger),this.publisher=new sw(this,this.logger),this.projectId=b?.projectId,this.relayUrl=b?.relayUrl||q3,lA()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="android"?this.packageName=lD():lA()&&"u">typeof(null==a.g?void 0:a.g.Platform)&&(null==a.g?void 0:a.g.Platform.OS)==="ios"&&(this.bundleId=lD()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(a=>this.logger.warn(a,a?.message))}get context(){return lh(this.logger)}get connected(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===1}get connecting(){var a,b,c;return(null==(c=null==(b=null==(a=this.provider)?void 0:a.connection)?void 0:b.socket)?void 0:c.readyState)===0||void 0!==this.connectPromise}async publish(a,b,c){this.isInitialized(),await this.publisher.publish(a,b,c),await this.recordMessageEvent({topic:a,message:b,publishedAt:Date.now(),transportType:re},"outbound")}async publishCustom(a){this.isInitialized(),await this.publisher.publishCustom(a)}async subscribe(a,b){var c,d,e;this.isInitialized(),null!=b&&b.transportType&&b?.transportType!=="relay"||await this.toEstablishConnection();let f=typeof(null==(c=b?.internal)?void 0:c.throwOnFailedPublish)>"u"||(null==(d=b?.internal)?void 0:d.throwOnFailedPublish),g=(null==(e=this.subscriber.topicMap.get(a))?void 0:e[0])||"",h,i=b=>{b.topic===a&&(this.subscriber.off(rh,i),h())};return await Promise.all([new Promise(a=>{h=a,this.subscriber.on(rh,i)}),new Promise(async(c,d)=>{g=await this.subscriber.subscribe(a,sP({internal:{throwOnFailedPublish:f}},b)).catch(a=>{f&&d(a)})||g,c()})]),g}async unsubscribe(a,b){this.isInitialized(),await this.subscriber.unsubscribe(a,b)}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}off(a,b){this.events.off(a,b)}removeListener(a,b){this.events.removeListener(a,b)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await lK(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(a){if(!this.subscriber.hasAnyTopics)return void this.logger.info("Starting WS connection skipped because the client has no topics to work with.");if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(b,c)=>{await this.connect(a).then(b).catch(c).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(a){this.logger.debug({},"Restarting transport..."),this.connectionAttemptInProgress||(this.relayUrl=a||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await qu())throw Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(a){if(a?.length===0)return void this.logger.trace("Batch message events is empty. Ignoring...");let b=a.sort((a,b)=>a.publishedAt-b.publishedAt);for(let a of(this.logger.debug(`Batch of ${b.length} message events sorted`),b))try{await this.onMessageEvent(a)}catch(a){this.logger.warn(a,"Error while processing batch message event: "+a?.message)}this.logger.trace(`Batch of ${b.length} message events processed`)}async onLinkMessageEvent(a,b){let{topic:c}=a;if(!b.sessionExists){let a=lN(ij.FIVE_MINUTES);await this.core.pairing.pairings.set(c,{topic:c,expiry:a,relay:{protocol:"irn"},active:!1})}this.events.emit(q4,a),await this.recordMessageEvent(a,rf)}async connect(a){await this.confirmOnlineStateOrThrow(),a&&a!==this.relayUrl&&(this.relayUrl=a,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let b=1;for(;b<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${b}...`),await this.createProvider(),await new Promise(async(a,b)=>{let c=()=>{b(Error("Connection interrupted while trying to connect"))};this.provider.once(ra,c),await lK(new Promise((a,b)=>{this.provider.connect().then(a).catch(b)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>{b(a)}).finally(()=>{this.provider.off(ra,c),clearTimeout(this.reconnectTimeout)}),await new Promise(async(a,c)=>{let d=()=>{b(Error("Connection interrupted while trying to subscribe"))};this.provider.once(ra,d),await this.subscriber.start().then(a).catch(c).finally(()=>{this.provider.off(ra,d)})}),this.hasExperiencedNetworkDisruption=!1,a()})}catch(a){await this.subscriber.stop(),this.logger.warn({},a.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${b}`);break}await new Promise(a=>setTimeout(a,(0,ij.toMiliseconds)(+b))),b++}}startPingTimeout(){var a,b,c,d,e;if(lz())try{null!=(b=null==(a=this.provider)?void 0:a.connection)&&b.socket&&(null==(e=null==(d=null==(c=this.provider)?void 0:c.connection)?void 0:d.socket)||e.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a,a?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let a=await this.core.crypto.signJWT(this.relayUrl);this.provider=new qV.JsonRpcProvider(new qY.default(function({protocol:a,version:b,relayUrl:c,sdkVersion:d,auth:e,projectId:f,useOnCloseEvent:g,bundleId:h,packageName:i}){var j,k;let l,m=c.split("?"),n=lF(a,b,d),o=(j=m[1]||"",k={auth:e,ua:n,projectId:f,useOnCloseEvent:g||void 0,packageName:i||void 0,bundleId:h||void 0},l=new URLSearchParams(j),Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).forEach(([a,b])=>{null!=b&&l.set(a,String(b))}),l.toString());return m[0]+"?"+o}({sdkVersion:rc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:a,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(a,b){let{topic:c,message:d}=a;await this.messages.set(c,d,b)}async shouldIgnoreMessageEvent(a){let{topic:b,message:c}=a;if(!c||0===c.length)return this.logger.warn(`Ignoring invalid/empty message: ${c}`),!0;if(!await this.subscriber.isKnownTopic(b))return this.logger.warn(`Ignoring message for unknown topic ${b}`),!0;let d=this.messages.has(b,c);return d&&this.logger.warn(`Ignoring duplicate message: ${c}`),d}async onProviderPayload(a){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:a}),(0,qX.isJsonRpcRequest)(a)){if(!a.method.endsWith("_subscription"))return;let b=a.params,{topic:c,message:d,publishedAt:e,attestation:f}=b.data,g={topic:c,message:d,publishedAt:e,transportType:re,attestation:f};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(sP({type:"event",event:b.id},g)),this.events.emit(b.id,g),await this.acknowledgePayload(a),await this.onMessageEvent(g)}else(0,qX.isJsonRpcResponse)(a)&&this.events.emit(q5,a)}async onMessageEvent(a){await this.shouldIgnoreMessageEvent(a)||(await this.recordMessageEvent(a,rf),this.events.emit(q4,a))}async acknowledgePayload(a){let b=(0,qW.formatJsonRpcResult)(a.id,!0);await this.provider.connection.send(b)}unregisterProviderListeners(){this.provider.off(q8,this.onPayloadHandler),this.provider.off(q9,this.onConnectHandler),this.provider.off(ra,this.onDisconnectHandler),this.provider.off(rb,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let b=await qu();(function(b){var c,d;switch(lC()){case ly:c=b,!lA()&&lB()&&(window.addEventListener("online",()=>c(!0)),window.addEventListener("offline",()=>c(!1)));break;case lw:d=b,lA()&&null!=a.g&&a.g.NetInfo&&a.g?.NetInfo.addEventListener(a=>d(a?.isConnected))}})(async a=>{b!==a&&(b=a,a?await this.transportOpen().catch(a=>this.logger.error(a,a?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(qA.HEARTBEAT_EVENTS.pulse,async()=>{var a;if(!this.transportExplicitlyClosed&&!this.connected&&(!(lB()&&(0,ik.getDocument)())||(null==(a=(0,ik.getDocument)())?void 0:a.visibilityState)==="visible"))try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(a){this.logger.warn(a,a?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit("relayer_disconnect"),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(a=>this.logger.error(a,a?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,ij.toMiliseconds)(.1)))))}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise)return void await this.connectPromise;await this.connect()}}}function sS(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function sT(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let sU="[object Arguments]",sV="[object Object]";function sW(){}function sX(a){if(!a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&"[object Object]"===Object.prototype.toString.call(a)}var sY=Object.defineProperty,sZ=Object.getOwnPropertySymbols,s$=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,s0=(a,b,c)=>b in a?sY(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,s1=(a,b)=>{for(var c in b||(b={}))s$.call(b,c)&&s0(a,c,b[c]);if(sZ)for(var c of sZ(b))s_.call(b,c)&&s0(a,c,b[c]);return a},s2=(a,b,c)=>s0(a,"symbol"!=typeof b?b+"":b,c);class s3 extends qL{constructor(a,b,c,d=q$,e){super(a,b,c,d),this.core=a,this.logger=b,this.name=c,s2(this,"map",new Map),s2(this,"version","0.3"),s2(this,"cached",[]),s2(this,"initialized",!1),s2(this,"getKey"),s2(this,"storagePrefix",q$),s2(this,"recentlyDeleted",[]),s2(this,"recentlyDeletedLimit",200),s2(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{var b;this.getKey&&null!==a&&!qi(a)?this.map.set(this.getKey(a),a):(null==(b=a?.proposer)?void 0:b.publicKey)?this.map.set(a.id,a):a?.topic&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)}),s2(this,"set",async(a,b)=>{this.isInitialized(),this.map.has(a)?await this.update(a,b):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:b}),this.map.set(a,b),await this.persist())}),s2(this,"get",a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a))),s2(this,"getAll",a=>(this.isInitialized(),a?this.values.filter(b=>Object.keys(a).every(c=>{var d;return d=b[c],function a(b,c,d,e,f,g,h){let i=h(b,c,d,e,f,g);if(void 0!==i)return i;if(typeof b==typeof c)switch(typeof b){case"bigint":case"string":case"boolean":case"symbol":case"undefined":case"function":return b===c;case"number":return b===c||Object.is(b,c)}return function b(c,d,e,f){if(Object.is(c,d))return!0;let g=sT(c),h=sT(d);if(g===sU&&(g=sV),h===sU&&(h=sV),g!==h)return!1;switch(g){case"[object String]":return c.toString()===d.toString();case"[object Number]":{let a=c.valueOf(),b=d.valueOf();return a===b||Number.isNaN(a)&&Number.isNaN(b)}case"[object Boolean]":case"[object Date]":case"[object Symbol]":return Object.is(c.valueOf(),d.valueOf());case"[object RegExp]":return c.source===d.source&&c.flags===d.flags;case"[object Function]":return c===d}let i=(e=e??new Map).get(c),j=e.get(d);if(null!=i&&null!=j)return i===d;e.set(c,d),e.set(d,c);try{switch(g){case"[object Map]":if(c.size!==d.size)return!1;for(let[b,g]of c.entries())if(!d.has(b)||!a(g,d.get(b),b,c,d,e,f))return!1;return!0;case"[object Set]":{if(c.size!==d.size)return!1;let b=Array.from(c.values()),g=Array.from(d.values());for(let h=0;h<b.length;h++){let i=b[h],j=g.findIndex(b=>a(i,b,void 0,c,d,e,f));if(-1===j)return!1;g.splice(j,1)}return!0}case"[object Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":case"[object BigUint64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object BigInt64Array]":case"[object Float32Array]":case"[object Float64Array]":if("u">typeof Buffer&&Buffer.isBuffer(c)!==Buffer.isBuffer(d)||c.length!==d.length)return!1;for(let b=0;b<c.length;b++)if(!a(c[b],d[b],b,c,d,e,f))return!1;return!0;case"[object ArrayBuffer]":return c.byteLength===d.byteLength&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object DataView]":return c.byteLength===d.byteLength&&c.byteOffset===d.byteOffset&&b(new Uint8Array(c),new Uint8Array(d),e,f);case"[object Error]":return c.name===d.name&&c.message===d.message;case sV:{if(!(b(c.constructor,d.constructor,e,f)||sX(c)&&sX(d)))return!1;let g=[...Object.keys(c),...sS(c)],h=[...Object.keys(d),...sS(d)];if(g.length!==h.length)return!1;for(let b=0;b<g.length;b++){let h=g[b],i=c[h];if(!Object.hasOwn(d,h))return!1;let j=d[h];if(!a(i,j,h,c,d,e,f))return!1}return!0}default:return!1}}finally{e.delete(c),e.delete(d)}}(b,c,g,h)}(d,a[c],void 0,void 0,void 0,void 0,sW)})):this.values)),s2(this,"update",async(a,b)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:b});let c=s1(s1({},this.getData(a)),b);this.map.set(a,c),await this.persist()}),s2(this,"delete",async(a,b)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:b}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())}),this.logger=li(b,this.name),this.storagePrefix=d,this.getKey=e}get context(){return lh(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(a){this.recentlyDeleted.push(a),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(a){await this.core.storage.setItem(this.storageKey,a)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(a){let b=this.map.get(a);if(!b){if(this.recentlyDeleted.includes(a)){let{message:b}=qe("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${a}`);throw this.logger.error(b),Error(b)}let{message:b}=qe("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.error(b),Error(b)}return b}async persist(){await this.setDataStore(this.values)}async restore(){try{let a=await this.getDataStore();if(typeof a>"u"||!a.length)return;if(this.map.size){let{message:a}=qe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(a){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(a)}}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}}var s4=Object.defineProperty,s5=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?s4(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class s6{constructor(a,b){this.core=a,this.logger=b,s5(this,"name","pairing"),s5(this,"version","0.3"),s5(this,"events",new cB.default),s5(this,"pairings"),s5(this,"initialized",!1),s5(this,"storagePrefix",q$),s5(this,"ignoredPayloadTypes",[1]),s5(this,"registeredMethods",[]),s5(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),s5(this,"register",({methods:a})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...a])]}),s5(this,"create",async a=>{this.isInitialized();let b=pC(),c=await this.core.crypto.setSymKey(b),d=lN(ij.FIVE_MINUTES),e={protocol:"irn"},f={topic:c,expiry:d,relay:e,active:!1,methods:a?.methods},g=pY({protocol:this.core.protocol,version:this.core.version,topic:c,symKey:b,relay:e,expiryTimestamp:d,methods:a?.methods});return this.events.emit(rk,f),this.core.expirer.set(c,d),await this.pairings.set(c,f),await this.core.relayer.subscribe(c,{transportType:a?.transportType,internal:a?.internal}),{topic:c,uri:g}}),s5(this,"pair",async a=>{let b;this.isInitialized();let c=this.core.eventClient.createEvent({properties:{topic:a?.uri,trace:["pairing_started"]}});this.isValidPair(a,c);let{topic:d,symKey:e,relay:f,expiryTimestamp:g,methods:h}=pX(a.uri);if(c.props.properties.topic=d,c.addTrace("pairing_uri_validation_success"),c.addTrace("pairing_uri_not_expired"),this.pairings.keys.includes(d)){if(b=this.pairings.get(d),c.addTrace("existing_pairing"),b.active)throw c.setError("active_pairing_already_exists"),Error(`Pairing already exists: ${d}. Please try again with a new connection URI.`);c.addTrace("pairing_not_expired")}let i=g||lN(ij.FIVE_MINUTES),j={topic:d,relay:f,expiry:i,active:!1,methods:h};this.core.expirer.set(d,i),await this.pairings.set(d,j),c.addTrace("store_new_pairing"),a.activatePairing&&await this.activate({topic:d}),this.events.emit(rk,j),c.addTrace("emit_inactive_pairing"),this.core.crypto.keychain.has(d)||await this.core.crypto.setSymKey(e,d),c.addTrace("subscribing_pairing_topic");try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{c.setError("no_internet_connection")}try{await this.core.relayer.subscribe(d,{relay:f})}catch(a){throw c.setError("subscribe_pairing_topic_failure"),a}return c.addTrace("subscribe_pairing_topic_success"),j}),s5(this,"activate",async({topic:a})=>{this.isInitialized();let b=lN(ij.FIVE_MINUTES);this.core.expirer.set(a,b),await this.pairings.update(a,{active:!0,expiry:b})}),s5(this,"ping",async a=>{this.isInitialized(),await this.isValidPing(a),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:b}=a;if(this.pairings.keys.includes(b)){let a=await this.sendRequest(b,"wc_pairingPing",{}),{done:c,resolve:d,reject:e}=lJ();this.events.once(lP("pairing_ping",a),({error:a})=>{a?e(a):d()}),await c()}}),s5(this,"updateExpiry",async({topic:a,expiry:b})=>{this.isInitialized(),await this.pairings.update(a,{expiry:b})}),s5(this,"updateMetadata",async({topic:a,metadata:b})=>{this.isInitialized(),await this.pairings.update(a,{peerMetadata:b})}),s5(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),s5(this,"disconnect",async a=>{this.isInitialized(),await this.isValidDisconnect(a);let{topic:b}=a;this.pairings.keys.includes(b)&&(await this.sendRequest(b,"wc_pairingDelete",qf("USER_DISCONNECTED")),await this.deletePairing(b))}),s5(this,"formatUriFromPairing",a=>{this.isInitialized();let{topic:b,relay:c,expiry:d,methods:e}=a,f=this.core.crypto.keychain.get(b);return pY({protocol:this.core.protocol,version:this.core.version,topic:b,symKey:f,relay:c,expiryTimestamp:d,methods:e})}),s5(this,"sendRequest",async(a,b,c)=>{let d=(0,qW.formatJsonRpcRequest)(b,c),e=await this.core.crypto.encode(a,d),f=rj[b].req;return this.core.history.set(a,d),this.core.relayer.publish(a,e,f),d.id}),s5(this,"sendResult",async(a,b,c)=>{let d=(0,qW.formatJsonRpcResult)(a,c),e=await this.core.crypto.encode(b,d),f=rj[(await this.core.history.get(b,a)).request.method].res;await this.core.relayer.publish(b,e,f),await this.core.history.resolve(d)}),s5(this,"sendError",async(a,b,c)=>{let d=(0,qW.formatJsonRpcError)(a,c),e=await this.core.crypto.encode(b,d),f=(await this.core.history.get(b,a)).request.method,g=rj[f]?rj[f].res:rj.unregistered_method.res;await this.core.relayer.publish(b,e,g),await this.core.history.resolve(d)}),s5(this,"deletePairing",async(a,b)=>{await this.core.relayer.unsubscribe(a),await Promise.all([this.pairings.delete(a,qf("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(a),b?Promise.resolve():this.core.expirer.del(a)])}),s5(this,"cleanup",async()=>{let a=this.pairings.getAll().filter(a=>lO(a.expiry));await Promise.all(a.map(a=>this.deletePairing(a.topic)))}),s5(this,"onRelayEventRequest",async a=>{let{topic:b,payload:c}=a;switch(c.method){case"wc_pairingPing":return await this.onPairingPingRequest(b,c);case"wc_pairingDelete":return await this.onPairingDeleteRequest(b,c);default:return await this.onUnknownRpcMethodRequest(b,c)}}),s5(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c}=a,d=(await this.core.history.get(b,c.id)).request.method;return"wc_pairingPing"===d?this.onPairingPingResponse(b,c):this.onUnknownRpcMethodResponse(d)}),s5(this,"onPairingPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult(c,a,!0),this.events.emit("pairing_ping",{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),s5(this,"onPairingPingResponse",(a,b)=>{let{id:c}=b;setTimeout(()=>{(0,qX.isJsonRpcResult)(b)?this.events.emit(lP("pairing_ping",c),{}):(0,qX.isJsonRpcError)(b)&&this.events.emit(lP("pairing_ping",c),{error:b.error})},500)}),s5(this,"onPairingDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a}),await this.deletePairing(a),this.events.emit(rl,{id:c,topic:a})}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),s5(this,"onUnknownRpcMethodRequest",async(a,b)=>{let{id:c,method:d}=b;try{if(this.registeredMethods.includes(d))return;let b=qf("WC_METHOD_UNSUPPORTED",d);await this.sendError(c,a,b),this.logger.error(b)}catch(b){await this.sendError(c,a,b),this.logger.error(b)}}),s5(this,"onUnknownRpcMethodResponse",a=>{this.registeredMethods.includes(a)||this.logger.error(qf("WC_METHOD_UNSUPPORTED",a))}),s5(this,"isValidPair",(a,b)=>{var c;if(!qq(a)){let{message:c}=qe("MISSING_OR_INVALID",`pair() params: ${a}`);throw b.setError(rv),Error(c)}if(!function(a){function b(a){try{return"u">typeof new URL(a)}catch{return!1}}try{if(qj(a,!1)){if(b(a))return!0;let c=lW(a);return b(c)}}catch{}return!1}(a.uri)){let{message:c}=qe("MISSING_OR_INVALID",`pair() uri: ${a.uri}`);throw b.setError(rv),Error(c)}let d=pX(a?.uri);if(!(null!=(c=d?.relay)&&c.protocol)){let{message:a}=qe("MISSING_OR_INVALID","pair() uri#relay-protocol");throw b.setError(rv),Error(a)}if(!(null!=d&&d.symKey)){let{message:a}=qe("MISSING_OR_INVALID","pair() uri#symKey");throw b.setError(rv),Error(a)}if(null!=d&&d.expiryTimestamp&&(0,ij.toMiliseconds)(d?.expiryTimestamp)<Date.now()){b.setError("pairing_expired");let{message:a}=qe("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw Error(a)}}),s5(this,"isValidPing",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),s5(this,"isValidDisconnect",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidPairingTopic(b)}),s5(this,"isValidPairingTopic",async a=>{if(!qj(a,!1)){let{message:b}=qe("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.pairings.keys.includes(a)){let{message:b}=qe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(lO(this.pairings.get(a).expiry)){await this.deletePairing(a);let{message:b}=qe("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}),this.core=a,this.logger=li(b,this.name),this.pairings=new s3(this.core,this.logger,this.name,this.storagePrefix)}get context(){return lh(this.logger)}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}registerRelayerEvents(){this.core.relayer.on(q4,async a=>{let{topic:b,message:c,transportType:d}=a;if(this.pairings.keys.includes(b)&&d!==rd&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(c)))try{let a=await this.core.crypto.decode(b,c);(0,qX.isJsonRpcRequest)(a)?(this.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a})):(0,qX.isJsonRpcResponse)(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a}),this.core.history.delete(b,a.id)),await this.core.relayer.messages.ack(b,c)}catch(a){this.logger.error(a)}})}registerExpirerEvents(){this.core.expirer.on(rr,async a=>{let{topic:b}=lM(a.target);b&&this.pairings.keys.includes(b)&&(await this.deletePairing(b,!0),this.events.emit("pairing_expire",{topic:b}))})}}var s7=Object.defineProperty,s8=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?s7(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class s9 extends qH{constructor(a,b){super(a,b),this.core=a,this.logger=b,s8(this,"records",new Map),s8(this,"events",new cB.EventEmitter),s8(this,"name","history"),s8(this,"version","0.3"),s8(this,"cached",[]),s8(this,"initialized",!1),s8(this,"storagePrefix",q$),s8(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.records.set(a.id,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),s8(this,"set",(a,b,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:a,request:b,chainId:c}),this.records.has(b.id))return;let d={id:b.id,topic:a,request:{method:b.method,params:b.params||null},chainId:c,expiry:lN(ij.THIRTY_DAYS)};this.records.set(d.id,d),this.persist(),this.events.emit(rm,d)}),s8(this,"resolve",async a=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:a}),!this.records.has(a.id))return;let b=await this.getRecord(a.id);typeof b.response>"u"&&(b.response=(0,qX.isJsonRpcError)(a)?{error:a.error}:{result:a.result},this.records.set(b.id,b),this.persist(),this.events.emit(rn,b))}),s8(this,"get",async(a,b)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:a,id:b}),await this.getRecord(b))),s8(this,"delete",(a,b)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:b}),this.values.forEach(c=>{c.topic===a&&("u">typeof b&&c.id!==b||(this.records.delete(c.id),this.events.emit(ro,c)))}),this.persist()}),s8(this,"exists",async(a,b)=>(this.isInitialized(),!!this.records.has(b)&&(await this.getRecord(b)).topic===a)),s8(this,"on",(a,b)=>{this.events.on(a,b)}),s8(this,"once",(a,b)=>{this.events.once(a,b)}),s8(this,"off",(a,b)=>{this.events.off(a,b)}),s8(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=li(b,this.name)}get context(){return lh(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let a=[];return this.values.forEach(b=>{if("u">typeof b.response)return;let c={topic:b.topic,request:(0,qW.formatJsonRpcRequest)(b.request.method,b.request.params,b.id),chainId:b.chainId};return a.push(c)}),a}async setJsonRpcRecords(a){await this.core.storage.setItem(this.storageKey,a)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(a){this.isInitialized();let b=this.records.get(a);if(!b){let{message:b}=qe("NO_MATCHING_KEY",`${this.name}: ${a}`);throw Error(b)}return b}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit("history_sync")}async restore(){try{let a=await this.getJsonRpcRecords();if(typeof a>"u"||!a.length)return;if(this.records.size){let{message:a}=qe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(a){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(a)}}registerEventListeners(){this.events.on(rm,a=>{this.logger.info(`Emitting ${rm}`),this.logger.debug({type:"event",event:rm,record:a})}),this.events.on(rn,a=>{this.logger.info(`Emitting ${rn}`),this.logger.debug({type:"event",event:rn,record:a})}),this.events.on(ro,a=>{this.logger.info(`Emitting ${ro}`),this.logger.debug({type:"event",event:ro,record:a})}),this.core.heartbeat.on(qA.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let a=!1;this.records.forEach(b=>{(0,ij.toMiliseconds)(b.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${b.id}`),this.records.delete(b.id),this.events.emit(ro,b,!1),a=!0)}),a&&this.persist()}catch(a){this.logger.warn(a)}}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}}var ta=Object.defineProperty,tb=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?ta(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class tc extends qN{constructor(a,b){super(a,b),this.core=a,this.logger=b,tb(this,"expirations",new Map),tb(this,"events",new cB.EventEmitter),tb(this,"name","expirer"),tb(this,"version","0.3"),tb(this,"cached",[]),tb(this,"initialized",!1),tb(this,"storagePrefix",q$),tb(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>this.expirations.set(a.target,a)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),tb(this,"has",a=>{try{let b=this.formatTarget(a);return"u">typeof this.getExpiration(b)}catch{return!1}}),tb(this,"set",(a,b)=>{this.isInitialized();let c=this.formatTarget(a),d={target:c,expiry:b};this.expirations.set(c,d),this.checkExpiry(c,d),this.events.emit(rp,{target:c,expiration:d})}),tb(this,"get",a=>{this.isInitialized();let b=this.formatTarget(a);return this.getExpiration(b)}),tb(this,"del",a=>{if(this.isInitialized(),this.has(a)){let b=this.formatTarget(a),c=this.getExpiration(b);this.expirations.delete(b),this.events.emit(rq,{target:b,expiration:c})}}),tb(this,"on",(a,b)=>{this.events.on(a,b)}),tb(this,"once",(a,b)=>{this.events.once(a,b)}),tb(this,"off",(a,b)=>{this.events.off(a,b)}),tb(this,"removeListener",(a,b)=>{this.events.removeListener(a,b)}),this.logger=li(b,this.name)}get context(){return lh(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(a){if("string"==typeof a)return lL("topic",a);if("number"==typeof a)return lL("id",a);let{message:b}=qe("UNKNOWN_TYPE",`Target type: ${typeof a}`);throw Error(b)}async setExpirations(a){await this.core.storage.setItem(this.storageKey,a)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit("expirer_sync")}async restore(){try{let a=await this.getExpirations();if(typeof a>"u"||!a.length)return;if(this.expirations.size){let{message:a}=qe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(a),Error(a)}this.cached=a,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(a){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(a)}}getExpiration(a){let b=this.expirations.get(a);if(!b){let{message:b}=qe("NO_MATCHING_KEY",`${this.name}: ${a}`);throw this.logger.warn(b),Error(b)}return b}checkExpiry(a,b){let{expiry:c}=b;(0,ij.toMiliseconds)(c)-Date.now()<=0&&this.expire(a,b)}expire(a,b){this.expirations.delete(a),this.events.emit(rr,{target:a,expiration:b})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((a,b)=>this.checkExpiry(b,a))}registerEventListeners(){this.core.heartbeat.on(qA.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(rp,a=>{this.logger.info(`Emitting ${rp}`),this.logger.debug({type:"event",event:rp,data:a}),this.persist()}),this.events.on(rr,a=>{this.logger.info(`Emitting ${rr}`),this.logger.debug({type:"event",event:rr,data:a}),this.persist()}),this.events.on(rq,a=>{this.logger.info(`Emitting ${rq}`),this.logger.debug({type:"event",event:rq,data:a}),this.persist()})}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}}var td=Object.defineProperty,te=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?td(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class tf extends qO{constructor(a,b,c){super(a,b,c),this.core=a,this.logger=b,this.store=c,te(this,"name","verify-api"),te(this,"abortController"),te(this,"isDevEnv"),te(this,"verifyUrlV3",rt),te(this,"storagePrefix",q$),te(this,"version",2),te(this,"publicKey"),te(this,"fetchPromise"),te(this,"init",async()=>{var a;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,ij.toMiliseconds)(null==(a=this.publicKey)?void 0:a.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),te(this,"register",async a=>{if(!lB()||this.isDevEnv)return;let b=window.location.origin,{id:c,decryptedId:d}=a,e=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${b}&id=${c}&decryptedId=${d}`;try{let a=(0,ik.getDocument)(),b=this.startAbortTimer(5*ij.ONE_SECOND),d=await new Promise((d,f)=>{let g=()=>{window.removeEventListener("message",i),a.body.removeChild(h),f("attestation aborted")};this.abortController.signal.addEventListener("abort",g);let h=a.createElement("iframe");h.src=e,h.style.display="none",h.addEventListener("error",g,{signal:this.abortController.signal});let i=e=>{if(e.data&&"string"==typeof e.data)try{let f=JSON.parse(e.data);if("verify_attestation"===f.type){if((0,kT.decodeJWT)(f.attestation).payload.id!==c)return;clearInterval(b),a.body.removeChild(h),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",i),d(null===f.attestation?"":f.attestation)}}catch(a){this.logger.warn(a)}};a.body.appendChild(h),window.addEventListener("message",i,{signal:this.abortController.signal})});return this.logger.debug(d,"jwt attestation"),d}catch(a){this.logger.warn(a)}return""}),te(this,"resolve",async a=>{if(this.isDevEnv)return"";let{attestationId:b,hash:c,encryptedId:d}=a;if(""===b)return void this.logger.debug("resolve: attestationId is empty, skipping");if(b){if((0,kT.decodeJWT)(b).payload.id!==d)return;let a=await this.isValidJwtAttestation(b);if(a)return a.isVerified?a:void this.logger.warn("resolve: jwt attestation: origin url not verified")}if(!c)return;let e=this.getVerifyUrl(a?.verifyUrl);return this.fetchAttestation(c,e)}),te(this,"fetchAttestation",async(a,b)=>{this.logger.debug(`resolving attestation: ${a} from url: ${b}`);let c=this.startAbortTimer(5*ij.ONE_SECOND),d=await fetch(`${b}/attestation/${a}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(c),200===d.status?await d.json():void 0}),te(this,"getVerifyUrl",a=>{let b=a||rs;return ru.includes(b)||(this.logger.info(`verify url: ${b}, not included in trusted list, assigning default: ${rs}`),b=rs),b}),te(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let a=this.startAbortTimer(ij.FIVE_SECONDS),b=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(a),await b.json()}catch(a){this.logger.warn(a)}}),te(this,"persistPublicKey",async a=>{this.logger.debug(a,"persisting public key to local storage"),await this.store.setItem(this.storeKey,a),this.publicKey=a}),te(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),te(this,"isValidJwtAttestation",async a=>{let b=await this.getPublicKey();try{if(b)return this.validateAttestation(a,b)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let c=await this.fetchAndPersistPublicKey();try{if(c)return this.validateAttestation(a,c)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),te(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),te(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async a=>{let b=await this.fetchPublicKey();b&&(await this.persistPublicKey(b),a(b))});let a=await this.fetchPromise;return this.fetchPromise=void 0,a}),te(this,"validateAttestation",(a,b)=>{let c=function(a,b){let c,d,[e,f,g]=a.split("."),h=Buffer.from(pI(g),"base64");if(64!==h.length)throw Error("Invalid signature length");let i=h.slice(0,32),j=h.slice(32,64),k=m7(`${e}.${f}`),l=(c=Buffer.from(b.x,"base64"),d=Buffer.from(b.y,"base64"),(0,kW.concat)([new Uint8Array([4]),c,d]));if(!pw.verify((0,kW.concat)([i,j]),k,l))throw Error("Invalid signature");return(0,kT.decodeJWT)(a).payload}(a,b.publicKey),d={hasExpired:(0,ij.toMiliseconds)(c.exp)<Date.now(),payload:c};if(d.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),Error("JWT attestation expired");return{origin:d.payload.origin,isScam:d.payload.isScam,isVerified:d.payload.isVerified}}),this.logger=li(b,this.name),this.abortController=new AbortController,this.isDevEnv=lV(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return lh(this.logger)}startAbortTimer(a){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,ij.toMiliseconds)(a))}}var tg=Object.defineProperty,th=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?tg(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class ti extends qP{constructor(a,b){super(a,b),this.projectId=a,this.logger=b,th(this,"context","echo"),th(this,"registerDeviceToken",async a=>{let{clientId:b,token:c,notificationType:d,enableEncrypted:e=!1}=a,f=`https://echo.walletconnect.com/${this.projectId}/clients`;await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:b,type:d,token:c,always_raw:e})})}),this.logger=li(b,this.context)}}var tj=Object.defineProperty,tk=Object.getOwnPropertySymbols,tl=Object.prototype.hasOwnProperty,tm=Object.prototype.propertyIsEnumerable,tn=(a,b,c)=>b in a?tj(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,to=(a,b)=>{for(var c in b||(b={}))tl.call(b,c)&&tn(a,c,b[c]);if(tk)for(var c of tk(b))tm.call(b,c)&&tn(a,c,b[c]);return a},tp=(a,b,c)=>tn(a,"symbol"!=typeof b?b+"":b,c);class tq extends qQ{constructor(a,b,c=!0){super(a,b,c),this.core=a,this.logger=b,tp(this,"context","event-client"),tp(this,"storagePrefix",q$),tp(this,"storageVersion",.1),tp(this,"events",new Map),tp(this,"shouldPersist",!1),tp(this,"init",async()=>{if(!lV())try{let a={eventId:lU(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:lF(this.core.relayer.protocol,this.core.relayer.version,rc)}}};await this.sendEvent([a])}catch(a){this.logger.warn(a)}}),tp(this,"createEvent",a=>{let{event:b="ERROR",type:c="",properties:{topic:d,trace:e}}=a,f=lU(),g=this.core.projectId||"",h=to({eventId:f,timestamp:Date.now(),props:{event:b,type:c,properties:{topic:d,trace:e}},bundleId:g,domain:this.getAppDomain()},this.setMethods(f));return this.telemetryEnabled&&(this.events.set(f,h),this.shouldPersist=!0),h}),tp(this,"getEvent",a=>{let{eventId:b,topic:c}=a;if(b)return this.events.get(b);let d=Array.from(this.events.values()).find(a=>a.props.properties.topic===c);if(d)return to(to({},d),this.setMethods(d.eventId))}),tp(this,"deleteEvent",a=>{let{eventId:b}=a;this.events.delete(b),this.shouldPersist=!0}),tp(this,"setEventListeners",()=>{this.core.heartbeat.on(qA.HEARTBEAT_EVENTS.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(a=>{(0,ij.fromMiliseconds)(Date.now())-(0,ij.fromMiliseconds)(a.timestamp)>86400&&(this.events.delete(a.eventId),this.shouldPersist=!0)})})}),tp(this,"setMethods",a=>({addTrace:b=>this.addTrace(a,b),setError:b=>this.setError(a,b)})),tp(this,"addTrace",(a,b)=>{let c=this.events.get(a);c&&(c.props.properties.trace.push(b),this.events.set(a,c),this.shouldPersist=!0)}),tp(this,"setError",(a,b)=>{let c=this.events.get(a);c&&(c.props.type=b,c.timestamp=Date.now(),this.events.set(a,c),this.shouldPersist=!0)}),tp(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),tp(this,"restore",async()=>{try{let a=await this.core.storage.getItem(this.storageKey)||[];if(!a.length)return;a.forEach(a=>{this.events.set(a.eventId,to(to({},a),this.setMethods(a.eventId)))})}catch(a){this.logger.warn(a)}}),tp(this,"submit",async()=>{if(!this.telemetryEnabled||0===this.events.size)return;let a=[];for(let[b,c]of this.events)c.props.type&&a.push(c);if(0!==a.length)try{if((await this.sendEvent(a)).ok)for(let b of a)this.events.delete(b.eventId),this.shouldPersist=!0}catch(a){this.logger.warn(a)}}),tp(this,"sendEvent",async a=>{let b=this.getAppDomain()?"":"&sp=desktop";return await fetch(`https://pulse.walletconnect.org/batch?projectId=${this.core.projectId}&st=events_sdk&sv=js-${rc}${b}`,{method:"POST",body:JSON.stringify(a)})}),tp(this,"getAppDomain",()=>lE().url),this.logger=li(b,this.context),this.telemetryEnabled=c,c?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var tr=Object.defineProperty,ts=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,tu=Object.prototype.propertyIsEnumerable,tv=(a,b,c)=>b in a?tr(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,tw=(a,b)=>{for(var c in b||(b={}))tt.call(b,c)&&tv(a,c,b[c]);if(ts)for(var c of ts(b))tu.call(b,c)&&tv(a,c,b[c]);return a},tx=(a,b,c)=>tv(a,"symbol"!=typeof b?b+"":b,c);class ty extends qF{constructor(a){var b;super(a),tx(this,"protocol","wc"),tx(this,"version",2),tx(this,"name",qZ),tx(this,"relayUrl"),tx(this,"projectId"),tx(this,"customStoragePrefix"),tx(this,"events",new cB.EventEmitter),tx(this,"logger"),tx(this,"heartbeat"),tx(this,"relayer"),tx(this,"crypto"),tx(this,"storage"),tx(this,"history"),tx(this,"expirer"),tx(this,"pairing"),tx(this,"verify"),tx(this,"echoClient"),tx(this,"linkModeSupportedApps"),tx(this,"eventClient"),tx(this,"initialized",!1),tx(this,"logChunkController"),tx(this,"on",(a,b)=>this.events.on(a,b)),tx(this,"once",(a,b)=>this.events.once(a,b)),tx(this,"off",(a,b)=>this.events.off(a,b)),tx(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),tx(this,"dispatchEnvelope",({topic:a,message:b,sessionExists:c})=>{if(!a||!b)return;let d={topic:a,message:b,publishedAt:Date.now(),transportType:rd};this.relayer.onLinkMessageEvent(d,{sessionExists:c})});const c=this.getGlobalCore(a?.customStoragePrefix);if(c)try{return this.customStoragePrefix=c.customStoragePrefix,this.logger=c.logger,this.heartbeat=c.heartbeat,this.crypto=c.crypto,this.history=c.history,this.expirer=c.expirer,this.storage=c.storage,this.relayer=c.relayer,this.pairing=c.pairing,this.verify=c.verify,this.echoClient=c.echoClient,this.linkModeSupportedApps=c.linkModeSupportedApps,this.eventClient=c.eventClient,this.initialized=c.initialized,this.logChunkController=c.logChunkController,c}catch(a){console.warn("Failed to copy global core",a)}this.projectId=a?.projectId,this.relayUrl=a?.relayUrl||q3,this.customStoragePrefix=null!=a&&a.customStoragePrefix?`:${a.customStoragePrefix}`:"";const{logger:d,chunkLoggerController:e}=lj({opts:function(a){return la(lg({},a),lb({level:a?.level||"info"}))}({level:"string"==typeof a?.logger&&a.logger?a.logger:"error",name:qZ}),maxSizeInBytes:a?.maxLogBlobSizeInBytes,loggerOverride:a?.logger});this.logChunkController=e,null!=(b=this.logChunkController)&&b.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,b;null!=(a=this.logChunkController)&&a.downloadLogsBlobInBrowser&&(null==(b=this.logChunkController)||b.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=li(d,this.name),this.heartbeat=new qA.HeartBeat,this.crypto=new sd(this,this.logger,a?.keychain),this.history=new s9(this,this.logger),this.expirer=new tc(this,this.logger),this.storage=null!=a&&a.storage?a.storage:new qB.default(tw(tw({},q_),a?.storageOptions)),this.relayer=new sR({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new s6(this,this.logger),this.verify=new tf(this,this.logger,this.storage),this.echoClient=new ti(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new tq(this,this.logger,a?.telemetryEnabled),this.setGlobalCore(this)}static async init(a){let b=new ty(a);await b.initialize();let c=await b.crypto.getClientId();return await b.storage.setItem("WALLETCONNECT_CLIENT_ID",c),b}get context(){return lh(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var a;return null==(a=this.logChunkController)?void 0:a.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(a){this.linkModeSupportedApps.includes(a)||(this.linkModeSupportedApps.push(a),await this.storage.setItem(rg,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(rg)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(a){throw this.logger.warn(a,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(a.message),a}}getGlobalCore(a=""){try{if(this.isGlobalCoreDisabled())return;let b=`_walletConnectCore_${a}`,c=`${b}_count`;return globalThis[c]=(globalThis[c]||0)+1,globalThis[c]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[c]} times.`),globalThis[b]}catch(a){console.warn("Failed to get global WalletConnect core",a);return}}setGlobalCore(a){var b;try{if(this.isGlobalCoreDisabled())return;let c=`_walletConnectCore_${(null==(b=a.opts)?void 0:b.customStoragePrefix)||""}`;globalThis[c]=a}catch(a){console.warn("Failed to set global WalletConnect core",a)}}isGlobalCoreDisabled(){try{return"u">typeof process&&"true"===process.env.DISABLE_GLOBAL_CORE}catch{return!0}}}let tz="client",tA=`wc@2:${tz}:`,tB="WALLETCONNECT_DEEPLINK_CHOICE",tC=(ij.THIRTY_DAYS,"Proposal expired"),tD=ij.SEVEN_DAYS,tE={wc_sessionPropose:{req:{ttl:ij.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ij.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ij.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ij.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ij.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ij.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ij.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ij.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ij.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ij.ONE_DAY,prompt:!1,tag:1114},res:{ttl:ij.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:ij.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:ij.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:ij.FIVE_MINUTES,prompt:!1,tag:1119}}},tF={min:ij.FIVE_MINUTES,max:ij.SEVEN_DAYS},tG="IDLE",tH="ACTIVE",tI={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},tJ=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],tK="wc@1.5:auth:",tL=`${tK}:PUB_KEY`;var tM=Object.defineProperty,tN=Object.defineProperties,tO=Object.getOwnPropertyDescriptors,tP=Object.getOwnPropertySymbols,tQ=Object.prototype.hasOwnProperty,tR=Object.prototype.propertyIsEnumerable,tS=(a,b,c)=>b in a?tM(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,tT=(a,b)=>{for(var c in b||(b={}))tQ.call(b,c)&&tS(a,c,b[c]);if(tP)for(var c of tP(b))tR.call(b,c)&&tS(a,c,b[c]);return a},tU=(a,b,c)=>tS(a,"symbol"!=typeof b?b+"":b,c);class tV extends qU{constructor(b){super(b),tU(this,"name","engine"),tU(this,"events",new cB.default),tU(this,"initialized",!1),tU(this,"requestQueue",{state:tG,queue:[]}),tU(this,"sessionRequestQueue",{state:tG,queue:[]}),tU(this,"emittedSessionRequests",new lX({limit:500})),tU(this,"requestQueueDelay",ij.ONE_SECOND),tU(this,"expectedPairingMethodMap",new Map),tU(this,"recentlyDeletedMap",new Map),tU(this,"recentlyDeletedLimit",200),tU(this,"relayMessageCache",[]),tU(this,"pendingSessions",new Map),tU(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(tE)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,ij.toMiliseconds)(this.requestQueueDelay)))}),tU(this,"connect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let b=tN(tT({},a),tO({requiredNamespaces:a.requiredNamespaces||{},optionalNamespaces:a.optionalNamespaces||{}}));await this.isValidConnect(b),b.optionalNamespaces=function(a,b){var c,d,e,f,g,h;let i=qa(a),j=qa(b),k={};for(let a of Object.keys(i).concat(Object.keys(j)))k[a]={chains:lQ(null==(c=i[a])?void 0:c.chains,null==(d=j[a])?void 0:d.chains),methods:lQ(null==(e=i[a])?void 0:e.methods,null==(f=j[a])?void 0:f.methods),events:lQ(null==(g=i[a])?void 0:g.events,null==(h=j[a])?void 0:h.events)};return k}(b.requiredNamespaces,b.optionalNamespaces),b.requiredNamespaces={};let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=b,i=c,j,k=!1;try{if(i){let a=this.client.core.pairing.pairings.get(i);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),k=a.active}}catch(a){throw this.client.logger.error(`connect() -> pairing.get(${i}) failed`),a}if(!i||!k){let{topic:a,uri:b}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});i=a,j=b}if(!i){let{message:a}=qe("NO_MATCHING_KEY",`connect() pairing topic: ${i}`);throw Error(a)}let l=await this.client.core.crypto.generateKeyPair(),m=tE.wc_sessionPropose.req.ttl||ij.FIVE_MINUTES,n=lN(m),o=tN(tT(tT({requiredNamespaces:d,optionalNamespaces:e,relays:h??[{protocol:"irn"}],proposer:{publicKey:l,metadata:this.client.metadata},expiryTimestamp:n,pairingTopic:i},f&&{sessionProperties:f}),g&&{scopedProperties:g}),tO({id:(0,qW.payloadId)()})),p=lP("session_connect",o.id),{reject:q,resolve:r,done:s}=lJ(m,tC),t=({id:a})=>{a===o.id&&(this.client.events.off("proposal_expire",t),this.pendingSessions.delete(o.id),this.events.emit(p,{error:{message:tC,code:0}}))};return this.client.events.on("proposal_expire",t),this.events.once(p,({error:a,session:b})=>{this.client.events.off("proposal_expire",t),a?q(a):b&&r(b)}),await this.sendProposeSession({proposal:o,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:o.id}}}),await this.setProposal(o.id,o),{uri:j,approval:s}}),tU(this,"pair",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(a)}catch(a){throw this.client.logger.error("pair() failed"),a}}),tU(this,"approve",async a=>{var b,c,d;let e=this.client.core.eventClient.createEvent({properties:{topic:null==(b=a?.id)?void 0:b.toString(),trace:[rw]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(a){throw e.setError("no_internet_connection"),a}try{await this.isValidProposalId(a?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${a?.id}) failed`),e.setError("proposal_not_found"),b}try{await this.isValidApprove(a)}catch(a){throw this.client.logger.error("approve() -> isValidApprove() failed"),e.setError("session_approve_namespace_validation_failure"),a}let{id:f,relayProtocol:g,namespaces:h,sessionProperties:i,scopedProperties:j,sessionConfig:k}=a,l=this.client.proposal.get(f);this.client.core.eventClient.deleteEvent({eventId:e.eventId});let{pairingTopic:m,proposer:n,requiredNamespaces:o,optionalNamespaces:p}=l,q=null==(c=this.client.core.eventClient)?void 0:c.getEvent({topic:m});q||(q=null==(d=this.client.core.eventClient)?void 0:d.createEvent({type:rw,properties:{topic:m,trace:[rw,"session_namespaces_validation_success"]}}));let r=await this.client.core.crypto.generateKeyPair(),s=n.publicKey,t=await this.client.core.crypto.generateSharedKey(r,s),u=tT(tT(tT({relay:{protocol:g??"irn"},namespaces:h,controller:{publicKey:r,metadata:this.client.metadata},expiry:lN(tD)},i&&{sessionProperties:i}),j&&{scopedProperties:j}),k&&{sessionConfig:k});q.addTrace("subscribing_session_topic");try{await this.client.core.relayer.subscribe(t,{transportType:re,internal:{skipSubscribe:!0}})}catch(a){throw q.setError("subscribe_session_topic_failure"),a}q.addTrace("subscribe_session_topic_success");let v=tN(tT({},u),tO({topic:t,requiredNamespaces:o,optionalNamespaces:p,pairingTopic:m,acknowledged:!1,self:u.controller,peer:{publicKey:n.publicKey,metadata:n.metadata},controller:r,transportType:re}));await this.client.session.set(t,v),q.addTrace("store_session");try{await this.sendApproveSession({sessionTopic:t,proposal:l,pairingProposalResponse:{relay:{protocol:g??"irn"},responderPublicKey:r},sessionSettleRequest:u,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:f}}}),q.addTrace("session_approve_publish_success")}catch(a){throw this.client.logger.error(a),this.client.session.delete(t,qf("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(t),a}return this.client.core.eventClient.deleteEvent({eventId:q.eventId}),await this.client.core.pairing.updateMetadata({topic:m,metadata:n.metadata}),await this.deleteProposal(f),await this.client.core.pairing.activate({topic:m}),await this.setExpiry(t,lN(tD)),{topic:t,acknowledged:()=>Promise.resolve(this.client.session.get(t))}}),tU(this,"reject",async a=>{let b;this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(a)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}let{id:c,reason:d}=a;try{b=this.client.proposal.get(c).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${c}) failed`),a}b&&await this.sendError({id:c,topic:b,error:d,rpcOpts:tE.wc_sessionPropose.reject}),await this.deleteProposal(c)}),tU(this,"update",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(a)}catch(a){throw this.client.logger.error("update() -> isValidUpdate() failed"),a}let{topic:b,namespaces:c}=a,{done:d,resolve:e,reject:f}=lJ(),g=(0,qW.payloadId)(),h=(0,qW.getBigIntRpcId)().toString(),i=this.client.session.get(b).namespaces;return this.events.once(lP("session_update",g),({error:a})=>{a?f(a):e()}),await this.client.session.update(b,{namespaces:c}),await this.sendRequest({topic:b,method:"wc_sessionUpdate",params:{namespaces:c},throwOnFailedPublish:!0,clientRpcId:g,relayRpcId:h}).catch(a=>{this.client.logger.error(a),this.client.session.update(b,{namespaces:i}),f(a)}),{acknowledged:d}}),tU(this,"extend",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(a)}catch(a){throw this.client.logger.error("extend() -> isValidExtend() failed"),a}let{topic:b}=a,c=(0,qW.payloadId)(),{done:d,resolve:e,reject:f}=lJ();return this.events.once(lP("session_extend",c),({error:a})=>{a?f(a):e()}),await this.setExpiry(b,lN(tD)),this.sendRequest({topic:b,method:"wc_sessionExtend",params:{},clientRpcId:c,throwOnFailedPublish:!0}).catch(a=>{f(a)}),{acknowledged:d}}),tU(this,"request",async a=>{this.isInitialized();try{await this.isValidRequest(a)}catch(a){throw this.client.logger.error("request() -> isValidRequest() failed"),a}let{chainId:b,request:c,topic:d,expiry:e=tE.wc_sessionRequest.req.ttl}=a,f=this.client.session.get(d);f?.transportType===re&&await this.confirmOnlineStateOrThrow();let g=(0,qW.payloadId)(),h=(0,qW.getBigIntRpcId)().toString(),{done:i,resolve:j,reject:k}=lJ(e,"Request expired. Please try again.");this.events.once(lP("session_request",g),({error:a,result:b})=>{a?k(a):j(b)});let l="wc_sessionRequest",m=this.getAppLinkIfEnabled(f.peer.metadata,f.transportType);if(m)return await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:{request:tN(tT({},c),tO({expiryTimestamp:lN(e)})),chainId:b},expiry:e,throwOnFailedPublish:!0,appLink:m}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),await i();let n={request:tN(tT({},c),tO({expiryTimestamp:lN(e)})),chainId:b};return await Promise.all([new Promise(async a=>{await this.sendRequest({clientRpcId:g,relayRpcId:h,topic:d,method:l,params:n,expiry:e,throwOnFailedPublish:!0,tvf:this.getTVFParams(g,n)}).catch(a=>k(a)),this.client.events.emit("session_request_sent",{topic:d,request:c,chainId:b,id:g}),a()}),new Promise(async a=>{var b;if(!(null!=(b=f.sessionConfig)&&b.disableDeepLink)){let a=await lS(this.client.core.storage,tB);await lR({id:g,topic:d,wcDeepLink:a})}a()}),i()]).then(a=>a[2])}),tU(this,"respond",async a=>{var b,c;this.isInitialized();let d=this.client.core.eventClient.createEvent({properties:{topic:a?.topic||(null==(c=null==(b=a?.response)?void 0:b.id)?void 0:c.toString()),trace:["session_request_response_started"]}});try{await this.isValidRespond(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_validation_failure"),a}d.addTrace("session_request_response_validation_success");let{topic:e,response:f}=a,{id:g}=f,h=this.client.session.get(e);h.transportType===re&&await this.confirmOnlineStateOrThrow();let i=this.getAppLinkIfEnabled(h.peer.metadata,h.transportType);try{d.addTrace("session_request_response_publish_started"),(0,qX.isJsonRpcResult)(f)?await this.sendResult({id:g,topic:e,result:f.result,throwOnFailedPublish:!0,appLink:i}):(0,qX.isJsonRpcError)(f)&&await this.sendError({id:g,topic:e,error:f.error,appLink:i}),this.cleanupAfterResponse(a)}catch(a){throw d.addTrace(a?.message),d.setError("session_request_response_publish_failure"),a}}),tU(this,"ping",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(a)}catch(a){throw this.client.logger.error("ping() -> isValidPing() failed"),a}let{topic:b}=a;if(this.client.session.keys.includes(b)){let a=(0,qW.payloadId)(),c=(0,qW.getBigIntRpcId)().toString(),{done:d,resolve:e,reject:f}=lJ();this.events.once(lP("session_ping",a),({error:a})=>{a?f(a):e()}),await Promise.all([this.sendRequest({topic:b,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:a,relayRpcId:c}),d()])}else this.client.core.pairing.pairings.keys.includes(b)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:b}))}),tU(this,"emit",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(a);let{topic:b,event:c,chainId:d}=a,e=(0,qW.getBigIntRpcId)().toString(),f=(0,qW.payloadId)();await this.sendRequest({topic:b,method:"wc_sessionEvent",params:{event:c,chainId:d},throwOnFailedPublish:!0,relayRpcId:e,clientRpcId:f})}),tU(this,"disconnect",async a=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(a);let{topic:b}=a;if(this.client.session.keys.includes(b))await this.sendRequest({topic:b,method:"wc_sessionDelete",params:qf("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:b,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(b))await this.client.core.pairing.disconnect({topic:b});else{let{message:a}=qe("MISMATCHED_TOPIC",`Session or pairing topic not found: ${b}`);throw Error(a)}}),tU(this,"find",a=>(this.isInitialized(),this.client.session.getAll().filter(b=>(function(a,b){let{requiredNamespaces:c}=b,d=Object.keys(a.namespaces),e=Object.keys(c),f=!0;return!!lG(e,d)&&(d.forEach(b=>{let{accounts:d,methods:e,events:g}=a.namespaces[b],h=p7(d),i=c[b];lG(lm(b,i),h)&&lG(i.methods,e)&&lG(i.events,g)||(f=!1)}),f)})(b,a)))),tU(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),tU(this,"authenticate",async(a,b)=>{var c,d,e,f,g;let h;this.isInitialized(),this.isValidAuthenticate(a);let i=b&&this.client.core.linkModeSupportedApps.includes(b)&&(null==(c=this.client.metadata.redirect)?void 0:c.linkMode),j=i?rd:re;j===re&&await this.confirmOnlineStateOrThrow();let{chains:k,statement:l="",uri:m,domain:n,nonce:o,type:p,exp:q,nbf:r,methods:s=[],expiry:t}=a,u=[...a.resources||[]],{topic:v,uri:w}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:j});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:w}});let x=await this.client.core.crypto.generateKeyPair(),y=pD(x);if(await Promise.all([this.client.auth.authKeys.set(tL,{responseTopic:y,publicKey:x}),this.client.auth.pairingTopics.set(y,{topic:y,pairingTopic:v})]),await this.client.core.relayer.subscribe(y,{transportType:j}),this.client.logger.info(`sending request to new pairing topic: ${v}`),s.length>0){let a,b,{namespace:c}=lk(k[0]),h=nC(function(a,b,c,d={}){return c?.sort((a,b)=>a.localeCompare(b)),{att:{[a]:function(a,b,c={}){return Object.assign({},...(b=b?.sort((a,b)=>a.localeCompare(b))).map(b=>({[`${a}/${b}`]:[c]})))}(b,c,d)}}}(c,"request",s));nG(u)&&(d=h,e=u.pop(),h=nC((f=nD(d),g=nD(e),nB(f),nB(g),a=Object.keys(f.att).concat(Object.keys(g.att)).sort((a,b)=>a.localeCompare(b)),b={att:{}},a.forEach(a=>{var c,d;Object.keys((null==(c=f.att)?void 0:c[a])||{}).concat(Object.keys((null==(d=g.att)?void 0:d[a])||{})).sort((a,b)=>a.localeCompare(b)).forEach(c=>{var d,e;b.att[a]=nq(((a,b)=>{for(var c in b||(b={}))nt.call(b,c)&&nv(a,c,b[c]);if(ns)for(var c of ns(b))nu.call(b,c)&&nv(a,c,b[c]);return a})({},b.att[a]),nr({[c]:(null==(d=f.att[a])?void 0:d[c])||(null==(e=g.att[a])?void 0:e[c])}))})}),b))),u.push(h)}let z=t&&t>tE.wc_sessionAuthenticate.req.ttl?t:tE.wc_sessionAuthenticate.req.ttl,A={authPayload:{type:p??"caip122",chains:k,statement:l,aud:m,domain:n,version:"1",nonce:o,iat:new Date().toISOString(),exp:q,nbf:r,resources:u},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:lN(z)},B={requiredNamespaces:{},optionalNamespaces:{eip155:{chains:k,methods:[...new Set(["personal_sign",...s])],events:["chainChanged","accountsChanged"]}},relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:lN(tE.wc_sessionPropose.req.ttl),id:(0,qW.payloadId)()},{done:C,resolve:D,reject:E}=lJ(z,"Request expired"),F=(0,qW.payloadId)(),G=lP("session_connect",B.id),H=lP("session_request",F),I=async({error:a,session:b})=>{this.events.off(H,J),a?E(a):b&&D({session:b})},J=async a=>{var c,d,e;let f;if(await this.deletePendingAuthRequest(F,{message:"fulfilled",code:0}),a.error){let b=qf("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return a.error.code===b.code?void 0:(this.events.off(G,I),E(a.error.message))}await this.deleteProposal(B.id),this.events.off(G,I);let{cacaos:g,responder:h}=a.result,i=[],k=[];for(let a of g){await nz({cacao:a,projectId:this.client.core.projectId})||(this.client.logger.error(a,"Signature verification failed"),E(qf("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:b}=a,c=nG(b.resources),d=[nx(b.iss)],e=ny(b.iss);if(c){let a=nE(c),b=nF(c);i.push(...a),d.push(...b)}for(let a of d)k.push(`${a}:${e}`)}let l=await this.client.core.crypto.generateSharedKey(x,h.publicKey);i.length>0&&(f={topic:l,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:h,controller:h.publicKey,expiry:lN(tD),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:qb([...new Set(i)],[...new Set(k)]),transportType:j},await this.client.core.relayer.subscribe(l,{transportType:j}),await this.client.session.set(l,f),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:h.metadata}),f=this.client.session.get(l)),null!=(c=this.client.metadata.redirect)&&c.linkMode&&null!=(d=h.metadata.redirect)&&d.linkMode&&null!=(e=h.metadata.redirect)&&e.universal&&b&&(this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.session.update(l,{transportType:rd})),D({auths:g,session:f})};this.events.once(G,I),this.events.once(H,J);try{if(i){let a=(0,qW.formatJsonRpcRequest)("wc_sessionAuthenticate",A,F);this.client.core.history.set(v,a);let c=await this.client.core.crypto.encode("",a,{type:2,encoding:pA});h=pZ(b,v,c)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:A,expiry:a.expiry,throwOnFailedPublish:!0,clientRpcId:F}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:B,expiry:tE.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(a){throw this.events.off(G,I),this.events.off(H,J),a}return await this.setProposal(B.id,B),await this.setAuthRequest(F,{request:tN(tT({},A),tO({verifyContext:{}})),pairingTopic:v,transportType:j}),{uri:h??w,response:C}}),tU(this,"approveSessionAuthenticate",async a=>{let b,{id:c,auths:d}=a,e=this.client.core.eventClient.createEvent({properties:{topic:c.toString(),trace:["authenticated_session_approve_started"]}});try{this.isInitialized()}catch(a){throw e.setError("no_internet_connection"),a}let f=this.getPendingAuthRequest(c);if(!f)throw e.setError("authenticated_session_pending_request_not_found"),Error(`Could not find pending auth request with id ${c}`);let g=f.transportType||re;g===re&&await this.confirmOnlineStateOrThrow();let h=f.requester.publicKey,i=await this.client.core.crypto.generateKeyPair(),j=pD(h),k={type:1,receiverPublicKey:h,senderPublicKey:i},l=[],m=[];for(let a of d){if(!await nz({cacao:a,projectId:this.client.core.projectId})){e.setError("invalid_cacao");let a=qf("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:c,topic:j,error:a,encodeOpts:k}),Error(a.message)}e.addTrace("cacaos_verified");let{p:b}=a,d=nG(b.resources),f=[nx(b.iss)],g=ny(b.iss);if(d){let a=nE(d),b=nF(d);l.push(...a),f.push(...b)}for(let a of f)m.push(`${a}:${g}`)}let n=await this.client.core.crypto.generateSharedKey(i,h);if(e.addTrace("create_authenticated_session_topic"),l?.length>0){b={topic:n,acknowledged:!0,self:{publicKey:i,metadata:this.client.metadata},peer:{publicKey:h,metadata:f.requester.metadata},controller:h,expiry:lN(tD),authentication:d,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:f.pairingTopic,namespaces:qb([...new Set(l)],[...new Set(m)]),transportType:g},e.addTrace("subscribing_authenticated_session_topic");try{await this.client.core.relayer.subscribe(n,{transportType:g})}catch(a){throw e.setError("subscribe_authenticated_session_topic_failure"),a}e.addTrace("subscribe_authenticated_session_topic_success"),await this.client.session.set(n,b),e.addTrace("store_authenticated_session"),await this.client.core.pairing.updateMetadata({topic:f.pairingTopic,metadata:f.requester.metadata})}e.addTrace("publishing_authenticated_session_approve");try{await this.sendResult({topic:j,id:c,result:{cacaos:d,responder:{publicKey:i,metadata:this.client.metadata}},encodeOpts:k,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(f.requester.metadata,g)})}catch(a){throw e.setError("authenticated_session_approve_publish_failure"),a}return await this.client.auth.requests.delete(c,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:f.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:e.eventId}),{session:b}}),tU(this,"rejectSessionAuthenticate",async a=>{this.isInitialized();let{id:b,reason:c}=a,d=this.getPendingAuthRequest(b);if(!d)throw Error(`Could not find pending auth request with id ${b}`);d.transportType===re&&await this.confirmOnlineStateOrThrow();let e=d.requester.publicKey,f=await this.client.core.crypto.generateKeyPair(),g=pD(e);await this.sendError({id:b,topic:g,error:c,encodeOpts:{type:1,receiverPublicKey:e,senderPublicKey:f},rpcOpts:tE.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(d.requester.metadata,d.transportType)}),await this.client.auth.requests.delete(b,{message:"rejected",code:0}),await this.deleteProposal(b)}),tU(this,"formatAuthMessage",a=>{this.isInitialized();let{request:b,iss:c}=a;return nA(b,c)}),tU(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(0!==this.relayMessageCache.length)for(;this.relayMessageCache.length>0;)try{let a=this.relayMessageCache.shift();a&&await this.onRelayMessage(a)}catch(a){this.client.logger.error(a)}},50)}),tU(this,"cleanupDuplicatePairings",async a=>{if(a.pairingTopic)try{let b=this.client.core.pairing.pairings.get(a.pairingTopic),c=this.client.core.pairing.pairings.getAll().filter(c=>{var d,e;return(null==(d=c.peerMetadata)?void 0:d.url)&&(null==(e=c.peerMetadata)?void 0:e.url)===a.peer.metadata.url&&c.topic&&c.topic!==b.topic});if(0===c.length)return;this.client.logger.info(`Cleaning up ${c.length} duplicate pairing(s)`),await Promise.all(c.map(a=>this.client.core.pairing.disconnect({topic:a.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(a){this.client.logger.error(a)}}),tU(this,"deleteSession",async a=>{var b;let{topic:c,expirerHasDeleted:d=!1,emitEvent:e=!0,id:f=0}=a,{self:g}=this.client.session.get(c);await this.client.core.relayer.unsubscribe(c),await this.client.session.delete(c,qf("USER_DISCONNECTED")),this.addToRecentlyDeleted(c,"session"),this.client.core.crypto.keychain.has(g.publicKey)&&await this.client.core.crypto.deleteKeyPair(g.publicKey),this.client.core.crypto.keychain.has(c)&&await this.client.core.crypto.deleteSymKey(c),d||this.client.core.expirer.del(c),this.client.core.storage.removeItem(tB).catch(a=>this.client.logger.warn(a)),this.getPendingSessionRequests().forEach(a=>{a.topic===c&&this.deletePendingSessionRequest(a.id,qf("USER_DISCONNECTED"))}),c===(null==(b=this.sessionRequestQueue.queue[0])?void 0:b.topic)&&(this.sessionRequestQueue.state=tG),e&&this.client.events.emit("session_delete",{id:f,topic:c})}),tU(this,"deleteProposal",async(a,b)=>{if(b)try{let b=this.client.proposal.get(a),c=this.client.core.eventClient.getEvent({topic:b.pairingTopic});c?.setError("proposal_expired")}catch{}await Promise.all([this.client.proposal.delete(a,qf("USER_DISCONNECTED")),b?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"proposal")}),tU(this,"deletePendingSessionRequest",async(a,b,c=!1)=>{await Promise.all([this.client.pendingRequest.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)]),this.addToRecentlyDeleted(a,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(b=>b.id!==a),c&&(this.sessionRequestQueue.state=tG,this.client.events.emit("session_request_expire",{id:a}))}),tU(this,"deletePendingAuthRequest",async(a,b,c=!1)=>{await Promise.all([this.client.auth.requests.delete(a,b),c?Promise.resolve():this.client.core.expirer.del(a)])}),tU(this,"setExpiry",async(a,b)=>{this.client.session.keys.includes(a)&&(this.client.core.expirer.set(a,b),await this.client.session.update(a,{expiry:b}))}),tU(this,"setProposal",async(a,b)=>{this.client.core.expirer.set(a,lN(tE.wc_sessionPropose.req.ttl)),await this.client.proposal.set(a,b)}),tU(this,"setAuthRequest",async(a,b)=>{let{request:c,pairingTopic:d,transportType:e=re}=b;this.client.core.expirer.set(a,c.expiryTimestamp),await this.client.auth.requests.set(a,{authPayload:c.authPayload,requester:c.requester,expiryTimestamp:c.expiryTimestamp,id:a,pairingTopic:d,verifyContext:c.verifyContext,transportType:e})}),tU(this,"setPendingSessionRequest",async a=>{let{id:b,topic:c,params:d,verifyContext:e}=a,f=d.request.expiryTimestamp||lN(tE.wc_sessionRequest.req.ttl);this.client.core.expirer.set(b,f),await this.client.pendingRequest.set(b,{id:b,topic:c,params:d,verifyContext:e})}),tU(this,"sendRequest",async b=>{let c,d,{topic:e,method:f,params:g,expiry:h,relayRpcId:i,clientRpcId:j,throwOnFailedPublish:k,appLink:l,tvf:m,publishOpts:n={}}=b,o=(0,qW.formatJsonRpcRequest)(f,g,j),p=!!l;try{let a=p?pA:pz;c=await this.client.core.crypto.encode(e,o,{encoding:a})}catch(a){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${e} failed`),a}if(tJ.includes(f)){let a=pE(JSON.stringify(o)),b=pE(c);d=await this.client.core.verify.register({id:b,decryptedId:a})}let q=tT(tT({},tE[f].req),n);if(q.attestation=d,h&&(q.ttl=h),i&&(q.id=i),this.client.core.history.set(e,o),p){let b=pZ(l,e,c);await a.g.Linking.openURL(b,this.client.name)}else{let a;q.tvf=tN(tT({},m),tO({correlationId:o.id})),k?(a=tT({},q.internal),q.internal=tN(a,tO({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(e,c,q)):this.client.core.relayer.publish(e,c,q).catch(a=>this.client.logger.error(a))}return o.id}),tU(this,"sendProposeSession",async a=>{let{proposal:b,publishOpts:c}=a,d=(0,qW.formatJsonRpcRequest)("wc_sessionPropose",b,b.id);this.client.core.history.set(b.pairingTopic,d);let e=await this.client.core.crypto.encode(b.pairingTopic,d,{encoding:pz}),f=pE(JSON.stringify(d)),g=pE(e),h=await this.client.core.verify.register({id:g,decryptedId:f});await this.client.core.relayer.publishCustom({payload:{pairingTopic:b.pairingTopic,sessionProposal:e},opts:tN(tT({},c),tO({publishMethod:"wc_proposeSession",attestation:h}))})}),tU(this,"sendApproveSession",async a=>{let{sessionTopic:b,pairingProposalResponse:c,proposal:d,sessionSettleRequest:e,publishOpts:f}=a,g=(0,qW.formatJsonRpcResult)(d.id,c),h=await this.client.core.crypto.encode(d.pairingTopic,g,{encoding:pz}),i=(0,qW.formatJsonRpcRequest)("wc_sessionSettle",e,f?.id),j=await this.client.core.crypto.encode(b,i,{encoding:pz});this.client.core.history.set(b,i),await this.client.core.relayer.publishCustom({payload:{sessionTopic:b,pairingTopic:d.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:j},opts:tN(tT({},f),tO({publishMethod:"wc_approveSession"}))})}),tU(this,"sendResult",async b=>{let c,d,e,{id:f,topic:g,result:h,throwOnFailedPublish:i,encodeOpts:j,appLink:k}=b,l=(0,qW.formatJsonRpcResult)(f,h),m=k&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=m?pA:pz;c=await this.client.core.crypto.encode(g,l,(a=tT({},j||{}),b={encoding:d},tN(a,tO(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${g} failed`),a}try{let a=(d=await this.client.core.history.get(g,f)).request;try{e=this.getTVFParams(f,a.params,h)}catch(a){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${a?.message}`)}}catch(a){throw this.client.logger.error(`sendResult() -> history.get(${g}, ${f}) failed`),a}if(m){let b=pZ(k,g,c);await a.g.Linking.openURL(b,this.client.name)}else{let a,b=tE[d.request.method].res;b.tvf=tN(tT({},e),tO({correlationId:f})),i?(a=tT({},b.internal),b.internal=tN(a,tO({throwOnFailedPublish:!0})),await this.client.core.relayer.publish(g,c,b)):this.client.core.relayer.publish(g,c,b).catch(a=>this.client.logger.error(a))}await this.client.core.history.resolve(l)}),tU(this,"sendError",async b=>{let c,d,{id:e,topic:f,error:g,encodeOpts:h,rpcOpts:i,appLink:j}=b,k=(0,qW.formatJsonRpcError)(e,g),l=j&&"u">typeof(null==a.g?void 0:a.g.Linking);try{let a,b,d=l?pA:pz;c=await this.client.core.crypto.encode(f,k,(a=tT({},h||{}),b={encoding:d},tN(a,tO(b))))}catch(a){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${f} failed`),a}try{d=await this.client.core.history.get(f,e)}catch(a){throw this.client.logger.error(`sendError() -> history.get(${f}, ${e}) failed`),a}if(l){let b=pZ(j,f,c);await a.g.Linking.openURL(b,this.client.name)}else{let a=d.request.method,b=i||tE[a].res;this.client.core.relayer.publish(f,c,b)}await this.client.core.history.resolve(k)}),tU(this,"cleanup",async()=>{let a=[],b=[];this.client.session.getAll().forEach(b=>{let c=!1;lO(b.expiry)&&(c=!0),this.client.core.crypto.keychain.has(b.topic)||(c=!0),c&&a.push(b.topic)}),this.client.proposal.getAll().forEach(a=>{lO(a.expiryTimestamp)&&b.push(a.id)}),await Promise.all([...a.map(a=>this.deleteSession({topic:a})),...b.map(a=>this.deleteProposal(a))])}),tU(this,"onProviderMessageEvent",async a=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(a):await this.onRelayMessage(a)}),tU(this,"onRelayEventRequest",async a=>{this.requestQueue.queue.push(a),await this.processRequestsQueue()}),tU(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===tH)return void this.client.logger.info("Request queue already active, skipping...");for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=tH;let a=this.requestQueue.queue.shift();if(a)try{await this.processRequest(a)}catch(a){this.client.logger.warn(a)}}this.requestQueue.state=tG}),tU(this,"processRequest",async a=>{let{topic:b,payload:c,attestation:d,transportType:e,encryptedId:f}=a,g=c.method;if(!this.shouldIgnorePairingRequest({topic:b,requestMethod:g}))switch(g){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:b,payload:c,attestation:d,encryptedId:f});case"wc_sessionSettle":return await this.onSessionSettleRequest(b,c);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(b,c);case"wc_sessionExtend":return await this.onSessionExtendRequest(b,c);case"wc_sessionPing":return await this.onSessionPingRequest(b,c);case"wc_sessionDelete":return await this.onSessionDeleteRequest(b,c);case"wc_sessionRequest":return await this.onSessionRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});case"wc_sessionEvent":return await this.onSessionEventRequest(b,c);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:b,payload:c,attestation:d,encryptedId:f,transportType:e});default:return this.client.logger.info(`Unsupported request method ${g}`)}}),tU(this,"onRelayEventResponse",async a=>{let{topic:b,payload:c,transportType:d}=a,e=(await this.client.core.history.get(b,c.id)).request.method;switch(e){case"wc_sessionPropose":return this.onSessionProposeResponse(b,c,d);case"wc_sessionSettle":return this.onSessionSettleResponse(b,c);case"wc_sessionUpdate":return this.onSessionUpdateResponse(b,c);case"wc_sessionExtend":return this.onSessionExtendResponse(b,c);case"wc_sessionPing":return this.onSessionPingResponse(b,c);case"wc_sessionRequest":return this.onSessionRequestResponse(b,c);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(b,c);default:return this.client.logger.info(`Unsupported response method ${e}`)}}),tU(this,"onRelayEventUnknownPayload",a=>{let{topic:b}=a,{message:c}=qe("MISSING_OR_INVALID",`Decoded payload on topic ${b} is not identifiable as a JSON-RPC request or a response.`);throw Error(c)}),tU(this,"shouldIgnorePairingRequest",a=>{let{topic:b,requestMethod:c}=a,d=this.expectedPairingMethodMap.get(b);return!(!d||d.includes(c))&&!!(d.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),tU(this,"onSessionProposeRequest",async a=>{let{topic:b,payload:c,attestation:d,encryptedId:e}=a,{params:f,id:g}=c;try{let a=this.client.core.eventClient.getEvent({topic:b});0===this.client.events.listenerCount("session_proposal")&&(console.warn("No listener for session_proposal event"),a?.setError("proposal_listener_not_found")),this.isValidConnect(tT({},c.params));let h=f.expiryTimestamp||lN(tE.wc_sessionPropose.req.ttl),i=tT({id:g,pairingTopic:b,expiryTimestamp:h,attestation:d,encryptedId:e},f);await this.setProposal(g,i);let j=await this.getVerifyContext({attestationId:d,hash:pE(JSON.stringify(c)),encryptedId:e,metadata:i.proposer.metadata});a?.addTrace("emit_session_proposal"),this.client.events.emit("session_proposal",{id:g,params:i,verifyContext:j})}catch(a){await this.sendError({id:g,topic:b,error:a,rpcOpts:tE.wc_sessionPropose.autoReject}),this.client.logger.error(a)}}),tU(this,"onSessionProposeResponse",async(a,b,c)=>{let{id:d}=b;if((0,qX.isJsonRpcResult)(b)){let{result:e}=b;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:e});let f=this.client.proposal.get(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});let g=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:g});let h=e.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});let i=await this.client.core.crypto.generateSharedKey(g,h);this.pendingSessions.set(d,{sessionTopic:i,pairingTopic:a,proposalId:d,publicKey:g});let j=await this.client.core.relayer.subscribe(i,{transportType:c});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:j}),await this.client.core.pairing.activate({topic:a})}else if((0,qX.isJsonRpcError)(b)){await this.deleteProposal(d);let a=lP("session_connect",d);if(0===this.events.listenerCount(a))throw Error(`emitting ${a} without any listeners, 954`);this.events.emit(a,{error:b.error})}}),tU(this,"onSessionSettleRequest",async(a,b)=>{let{id:c,params:d}=b;try{let c,e;this.isValidSessionSettleRequest(d);let{relay:f,controller:g,expiry:h,namespaces:i,sessionProperties:j,scopedProperties:k,sessionConfig:l}=b.params,m=[...this.pendingSessions.values()].find(b=>b.sessionTopic===a);if(!m)return this.client.logger.error(`Pending session not found for topic ${a}`);let n=this.client.proposal.get(m.proposalId),o=(c=tT(tT(tT({topic:a,relay:f,expiry:h,namespaces:i,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,controller:g.publicKey,self:{publicKey:m.publicKey,metadata:this.client.metadata},peer:{publicKey:g.publicKey,metadata:g.metadata}},j&&{sessionProperties:j}),k&&{scopedProperties:k}),l&&{sessionConfig:l}),e={transportType:re},tN(c,tO(e)));await this.client.session.set(o.topic,o),await this.setExpiry(o.topic,o.expiry),await this.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:o.peer.metadata}),this.client.events.emit("session_connect",{session:o}),this.events.emit(lP("session_connect",m.proposalId),{session:o}),this.pendingSessions.delete(m.proposalId),this.deleteProposal(m.proposalId,!1),this.cleanupDuplicatePairings(o),await this.sendResult({id:b.id,topic:a,result:!0})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),tU(this,"onSessionSettleResponse",async(a,b)=>{let{id:c}=b;(0,qX.isJsonRpcResult)(b)?(await this.client.session.update(a,{acknowledged:!0}),this.events.emit(lP("session_approve",c),{})):(0,qX.isJsonRpcError)(b)&&(await this.client.session.delete(a,qf("USER_DISCONNECTED")),this.events.emit(lP("session_approve",c),{error:b.error}))}),tU(this,"onSessionUpdateRequest",async(a,b)=>{let{params:c,id:d}=b;try{let b=`${a}_session_update`,e=qx.get(b);if(e&&this.isRequestOutOfSync(e,d)){this.client.logger.warn(`Discarding out of sync request - ${d}`),this.sendError({id:d,topic:a,error:qf("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(tT({topic:a},c));try{qx.set(b,d),await this.client.session.update(a,{namespaces:c.namespaces}),await this.sendResult({id:d,topic:a,result:!0})}catch(a){throw qx.delete(b),a}this.client.events.emit("session_update",{id:d,topic:a,params:c})}catch(b){await this.sendError({id:d,topic:a,error:b}),this.client.logger.error(b)}}),tU(this,"isRequestOutOfSync",(a,b)=>b.toString().slice(0,-3)<a.toString().slice(0,-3)),tU(this,"onSessionUpdateResponse",(a,b)=>{let{id:c}=b,d=lP("session_update",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,qX.isJsonRpcResult)(b)?this.events.emit(lP("session_update",c),{}):(0,qX.isJsonRpcError)(b)&&this.events.emit(lP("session_update",c),{error:b.error})}),tU(this,"onSessionExtendRequest",async(a,b)=>{let{id:c}=b;try{this.isValidExtend({topic:a}),await this.setExpiry(a,lN(tD)),await this.sendResult({id:c,topic:a,result:!0}),this.client.events.emit("session_extend",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),tU(this,"onSessionExtendResponse",(a,b)=>{let{id:c}=b,d=lP("session_extend",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,qX.isJsonRpcResult)(b)?this.events.emit(lP("session_extend",c),{}):(0,qX.isJsonRpcError)(b)&&this.events.emit(lP("session_extend",c),{error:b.error})}),tU(this,"onSessionPingRequest",async(a,b)=>{let{id:c}=b;try{this.isValidPing({topic:a}),await this.sendResult({id:c,topic:a,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:c,topic:a})}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),tU(this,"onSessionPingResponse",(a,b)=>{let{id:c}=b,d=lP("session_ping",c);setTimeout(()=>{if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners 2176`);(0,qX.isJsonRpcResult)(b)?this.events.emit(lP("session_ping",c),{}):(0,qX.isJsonRpcError)(b)&&this.events.emit(lP("session_ping",c),{error:b.error})},500)}),tU(this,"onSessionDeleteRequest",async(a,b)=>{let{id:c}=b;try{this.isValidDisconnect({topic:a,reason:b.params}),await Promise.all([new Promise(b=>{this.client.core.relayer.once(q7,async()=>{b(await this.deleteSession({topic:a,id:c}))})}),this.sendResult({id:c,topic:a,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:a,error:qf("USER_DISCONNECTED")})]).catch(a=>this.client.logger.error(a))}catch(a){this.client.logger.error(a)}}),tU(this,"onSessionRequest",async a=>{var b,c,d;let{topic:e,payload:f,attestation:g,encryptedId:h,transportType:i}=a,{id:j,params:k}=f;try{await this.isValidRequest(tT({topic:e},k));let a=this.client.session.get(e),f=await this.getVerifyContext({attestationId:g,hash:pE(JSON.stringify((0,qW.formatJsonRpcRequest)("wc_sessionRequest",k,j))),encryptedId:h,metadata:a.peer.metadata,transportType:i}),l={id:j,topic:e,params:k,verifyContext:f};await this.setPendingSessionRequest(l),i===rd&&null!=(b=a.peer.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(null==(c=a.peer.metadata.redirect)?void 0:c.universal),null!=(d=this.client.signConfig)&&d.disableRequestQueue?this.emitSessionRequest(l):(this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue())}catch(a){await this.sendError({id:j,topic:e,error:a}),this.client.logger.error(a)}}),tU(this,"onSessionRequestResponse",(a,b)=>{let{id:c}=b,d=lP("session_request",c);if(0===this.events.listenerCount(d))throw Error(`emitting ${d} without any listeners`);(0,qX.isJsonRpcResult)(b)?this.events.emit(lP("session_request",c),{result:b.result}):(0,qX.isJsonRpcError)(b)&&this.events.emit(lP("session_request",c),{error:b.error})}),tU(this,"onSessionEventRequest",async(a,b)=>{let{id:c,params:d}=b;try{let b=`${a}_session_event_${d.event.name}`,e=qx.get(b);if(e&&this.isRequestOutOfSync(e,c))return void this.client.logger.info(`Discarding out of sync request - ${c}`);this.isValidEmit(tT({topic:a},d)),this.client.events.emit("session_event",{id:c,topic:a,params:d}),qx.set(b,c)}catch(b){await this.sendError({id:c,topic:a,error:b}),this.client.logger.error(b)}}),tU(this,"onSessionAuthenticateResponse",(a,b)=>{let{id:c}=b;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:a,payload:b}),(0,qX.isJsonRpcResult)(b)?this.events.emit(lP("session_request",c),{result:b.result}):(0,qX.isJsonRpcError)(b)&&this.events.emit(lP("session_request",c),{error:b.error})}),tU(this,"onSessionAuthenticateRequest",async a=>{var b;let{topic:c,payload:d,attestation:e,encryptedId:f,transportType:g}=a;try{let{requester:a,authPayload:h,expiryTimestamp:i}=d.params,j=await this.getVerifyContext({attestationId:e,hash:pE(JSON.stringify(d)),encryptedId:f,metadata:a.metadata,transportType:g}),k={requester:a,pairingTopic:c,id:d.id,authPayload:h,verifyContext:j,expiryTimestamp:i};await this.setAuthRequest(d.id,{request:k,pairingTopic:c,transportType:g}),g===rd&&null!=(b=a.metadata.redirect)&&b.universal&&this.client.core.addLinkModeSupportedApp(a.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:c,params:d.params,id:d.id,verifyContext:j})}catch(f){this.client.logger.error(f);let a=d.params.requester.publicKey,b=await this.client.core.crypto.generateKeyPair(),e=this.getAppLinkIfEnabled(d.params.requester.metadata,g);await this.sendError({id:d.id,topic:c,error:f,encodeOpts:{type:1,receiverPublicKey:a,senderPublicKey:b},rpcOpts:tE.wc_sessionAuthenticate.autoReject,appLink:e})}}),tU(this,"addSessionRequestToSessionRequestQueue",a=>{this.sessionRequestQueue.queue.push(a)}),tU(this,"cleanupAfterResponse",a=>{this.deletePendingSessionRequest(a.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=tG,this.processSessionRequestQueue()},(0,ij.toMiliseconds)(this.requestQueueDelay))}),tU(this,"cleanupPendingSentRequestsForTopic",({topic:a,error:b})=>{let c=this.client.core.history.pending;c.length>0&&c.filter(b=>b.topic===a&&"wc_sessionRequest"===b.request.method).forEach(a=>{let c=lP("session_request",a.request.id);if(0===this.events.listenerCount(c))throw Error(`emitting ${c} without any listeners`);this.events.emit(lP("session_request",a.request.id),{error:b})})}),tU(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===tH)return void this.client.logger.info("session request queue is already active.");let a=this.sessionRequestQueue.queue[0];if(!a)return void this.client.logger.info("session request queue is empty.");try{this.emitSessionRequest(a)}catch(a){this.client.logger.error(a)}}),tU(this,"emitSessionRequest",a=>{this.emittedSessionRequests.has(a.id)?this.client.logger.warn({id:a.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${a.id}`):(this.sessionRequestQueue.state=tH,this.emittedSessionRequests.add(a.id),this.client.events.emit("session_request",a))}),tU(this,"onPairingCreated",a=>{if(a.methods&&this.expectedPairingMethodMap.set(a.topic,a.methods),a.active)return;let b=this.client.proposal.getAll().find(b=>b.pairingTopic===a.topic);b&&this.onSessionProposeRequest({topic:a.topic,payload:(0,qW.formatJsonRpcRequest)("wc_sessionPropose",tN(tT({},b),tO({requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces,relays:b.relays,proposer:b.proposer,sessionProperties:b.sessionProperties,scopedProperties:b.scopedProperties})),b.id),attestation:b.attestation,encryptedId:b.encryptedId})}),tU(this,"isValidConnect",async a=>{let b;if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(a)}`);throw Error(b)}let{pairingTopic:c,requiredNamespaces:d,optionalNamespaces:e,sessionProperties:f,scopedProperties:g,relays:h}=a;if(qi(c)||await this.isValidPairingTopic(c),b=!1,h?h&&qg(h)&&h.length&&h.forEach(a=>{b=qp(a)}):b=!0,!b){let{message:a}=qe("MISSING_OR_INVALID",`connect() relays: ${h}`);throw Error(a)}if(d&&!qi(d)&&0!==qh(d)){let a="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(a):this.client.logger.warn(a),this.validateNamespaces(d,"requiredNamespaces")}if(e&&!qi(e)&&0!==qh(e)&&this.validateNamespaces(e,"optionalNamespaces"),f&&!qi(f)&&this.validateSessionProps(f,"sessionProperties"),g&&!qi(g)){this.validateSessionProps(g,"scopedProperties");let a=Object.keys(d||{}).concat(Object.keys(e||{}));if(!Object.keys(g).every(b=>a.includes(b.split(":")[0])))throw Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(g)}, required/optional namespaces: ${JSON.stringify(a)}`)}}),tU(this,"validateNamespaces",(a,b)=>{let c=function(a,b,c){let d=null;if(a&&qh(a)){let e,f=qn(a,b);f&&(d=f);let g=(e=null,Object.entries(a).forEach(([a,d])=>{var f,g;let h;if(e)return;let i=(f=lm(a,d),g=`${b} ${c}`,h=null,qg(f)&&f.length?f.forEach(a=>{h||ql(a)||(h=qf("UNSUPPORTED_CHAINS",`${g}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):ql(a)||(h=qf("UNSUPPORTED_CHAINS",`${g}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),h);i&&(e=i)}),e);g&&(d=g)}else d=qe("MISSING_OR_INVALID",`${b}, ${c} should be an object with data`);return d}(a,"connect()",b);if(c)throw Error(c.message)}),tU(this,"isValidApprove",async a=>{if(!qq(a))throw Error(qe("MISSING_OR_INVALID",`approve() params: ${a}`).message);let{id:b,namespaces:c,relayProtocol:d,sessionProperties:e,scopedProperties:f}=a;this.checkRecentlyDeleted(b),await this.isValidProposalId(b);let g=this.client.proposal.get(b),h=qo(c,"approve()");if(h)throw Error(h.message);let i=qs(g.requiredNamespaces,c,"approve()");if(i)throw Error(i.message);if(!qj(d,!0)){let{message:a}=qe("MISSING_OR_INVALID",`approve() relayProtocol: ${d}`);throw Error(a)}if(e&&!qi(e)&&this.validateSessionProps(e,"sessionProperties"),f&&!qi(f)){this.validateSessionProps(f,"scopedProperties");let a=new Set(Object.keys(c));if(!Object.keys(f).every(b=>a.has(b.split(":")[0])))throw Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(f)}, approved namespaces: ${Array.from(a).join(", ")}`)}}),tU(this,"isValidReject",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`reject() params: ${a}`);throw Error(b)}let{id:b,reason:c}=a;if(this.checkRecentlyDeleted(b),await this.isValidProposalId(b),!c||"object"!=typeof c||!c.code||!qk(c.code,!1)||!c.message||!qj(c.message,!1)){let{message:a}=qe("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(c)}`);throw Error(a)}}),tU(this,"isValidSessionSettleRequest",a=>{let b;if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${a}`);throw Error(b)}let{relay:c,controller:d,namespaces:e,expiry:f}=a;if(!qp(c)){let{message:a}=qe("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw Error(a)}let g=(b=null,qj(d?.publicKey,!1)||(b=qe("MISSING_OR_INVALID","onSessionSettleRequest() controller public key should be a string")),b);if(g)throw Error(g.message);let h=qo(e,"onSessionSettleRequest()");if(h)throw Error(h.message);if(lO(f)){let{message:a}=qe("EXPIRED","onSessionSettleRequest()");throw Error(a)}}),tU(this,"isValidUpdate",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`update() params: ${a}`);throw Error(b)}let{topic:b,namespaces:c}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b);let d=this.client.session.get(b),e=qo(c,"update()");if(e)throw Error(e.message);let f=qs(d.requiredNamespaces,c,"update()");if(f)throw Error(f.message)}),tU(this,"isValidExtend",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`extend() params: ${a}`);throw Error(b)}let{topic:b}=a;this.checkRecentlyDeleted(b),await this.isValidSessionTopic(b)}),tU(this,"isValidRequest",async a=>{var b;let c;if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`request() params: ${a}`);throw Error(b)}let{topic:d,request:e,chainId:f,expiry:g}=a;this.checkRecentlyDeleted(d),await this.isValidSessionTopic(d);let{namespaces:h}=this.client.session.get(d);if(!qr(h,f)){let{message:a}=qe("MISSING_OR_INVALID",`request() chainId: ${f}`);throw Error(a)}if(qi(e)||!qj(e.method,!1)){let{message:a}=qe("MISSING_OR_INVALID",`request() ${JSON.stringify(e)}`);throw Error(a)}if(!(qj(b=e.method,!1)&&(c=[],Object.values(h).forEach(a=>{p7(a.accounts).includes(f)&&c.push(...a.methods)}),c).includes(b))){let{message:a}=qe("MISSING_OR_INVALID",`request() method: ${e.method}`);throw Error(a)}if(g&&(!qk(g,!1)||!(g<=tF.max)||!(g>=tF.min))){let{message:a}=qe("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${tF.min} and ${tF.max}`);throw Error(a)}}),tU(this,"isValidRespond",async a=>{var b;if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`respond() params: ${a}`);throw Error(b)}let{topic:c,response:d}=a;try{await this.isValidSessionTopic(c)}catch(c){throw null!=(b=a?.response)&&b.id&&this.cleanupAfterResponse(a),c}if(qi(d)||qi(d.result)&&qi(d.error)||!qk(d.id,!1)||!qj(d.jsonrpc,!1)){let{message:a}=qe("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(d)}`);throw Error(a)}let e=this.client.pendingRequest.get(d.id);if(e.topic!==c){let{message:a}=qe("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${d.id}, expected topic: ${e.topic}, received topic: ${c}`);throw Error(a)}}),tU(this,"isValidPing",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`ping() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),tU(this,"isValidEmit",async a=>{var b;let c;if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`emit() params: ${a}`);throw Error(b)}let{topic:d,event:e,chainId:f}=a;await this.isValidSessionTopic(d);let{namespaces:g}=this.client.session.get(d);if(!qr(g,f)){let{message:a}=qe("MISSING_OR_INVALID",`emit() chainId: ${f}`);throw Error(a)}if(qi(e)||!qj(e.name,!1)||!(qj(b=e.name,!1)&&(c=[],Object.values(g).forEach(a=>{p7(a.accounts).includes(f)&&c.push(...a.events)}),c).includes(b))){let{message:a}=qe("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(e)}`);throw Error(a)}}),tU(this,"isValidDisconnect",async a=>{if(!qq(a)){let{message:b}=qe("MISSING_OR_INVALID",`disconnect() params: ${a}`);throw Error(b)}let{topic:b}=a;await this.isValidSessionOrPairingTopic(b)}),tU(this,"isValidAuthenticate",a=>{let{chains:b,uri:c,domain:d,nonce:e}=a;if(!Array.isArray(b)||0===b.length)throw Error("chains is required and must be a non-empty array");if(!qj(c,!1))throw Error("uri is required parameter");if(!qj(d,!1))throw Error("domain is required parameter");if(!qj(e,!1))throw Error("nonce is required parameter");if([...new Set(b.map(a=>lk(a).namespace))].length>1)throw Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:f}=lk(b[0]);if("eip155"!==f)throw Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),tU(this,"getVerifyContext",async a=>{let{attestationId:b,hash:c,encryptedId:d,metadata:e,transportType:f}=a,g={verified:{verifyUrl:e.verifyUrl||rs,validation:"UNKNOWN",origin:e.url||""}};try{if(f===rd){let a=this.getAppLinkIfEnabled(e,f);return g.verified.validation=a&&new URL(a).origin===new URL(e.url).origin?"VALID":"INVALID",g}let a=await this.client.core.verify.resolve({attestationId:b,hash:c,encryptedId:d,verifyUrl:e.verifyUrl});a&&(g.verified.origin=a.origin,g.verified.isScam=a.isScam,g.verified.validation=a.origin===new URL(e.url).origin?"VALID":"INVALID")}catch(a){this.client.logger.warn(a)}return this.client.logger.debug(`Verify context: ${JSON.stringify(g)}`),g}),tU(this,"validateSessionProps",(a,b)=>{Object.values(a).forEach((c,d)=>{if(null==c){let{message:e}=qe("MISSING_OR_INVALID",`${b} must contain an existing value for each key. Received: ${c} for key ${Object.keys(a)[d]}`);throw Error(e)}})}),tU(this,"getPendingAuthRequest",a=>{let b=this.client.auth.requests.get(a);return"object"==typeof b?b:void 0}),tU(this,"addToRecentlyDeleted",(a,b)=>{if(this.recentlyDeletedMap.set(a,b),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let a=0,b=this.recentlyDeletedLimit/2;for(let c of this.recentlyDeletedMap.keys()){if(a++>=b)break;this.recentlyDeletedMap.delete(c)}}}),tU(this,"checkRecentlyDeleted",a=>{let b=this.recentlyDeletedMap.get(a);if(b){let{message:c}=qe("MISSING_OR_INVALID",`Record was recently deleted - ${b}: ${a}`);throw Error(c)}}),tU(this,"isLinkModeEnabled",(b,c)=>{var d,e,f,g,h,i,j,k,l;return!!b&&c===rd&&(null==(e=null==(d=this.client.metadata)?void 0:d.redirect)?void 0:e.linkMode)===!0&&(null==(g=null==(f=this.client.metadata)?void 0:f.redirect)?void 0:g.universal)!==void 0&&(null==(i=null==(h=this.client.metadata)?void 0:h.redirect)?void 0:i.universal)!==""&&(null==(j=b?.redirect)?void 0:j.universal)!==void 0&&(null==(k=b?.redirect)?void 0:k.universal)!==""&&(null==(l=b?.redirect)?void 0:l.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(b.redirect.universal)&&"u">typeof(null==a.g?void 0:a.g.Linking)}),tU(this,"getAppLinkIfEnabled",(a,b)=>{var c;return this.isLinkModeEnabled(a,b)?null==(c=a?.redirect)?void 0:c.universal:void 0}),tU(this,"handleLinkModeMessage",({url:a})=>{if(!a||!a.includes("wc_ev")||!a.includes("topic"))return;let b=lT(a,"topic")||"",c=decodeURIComponent(lT(a,"wc_ev")||""),d=this.client.session.keys.includes(b);d&&this.client.session.update(b,{transportType:rd}),this.client.core.dispatchEnvelope({topic:b,message:c,sessionExists:d})}),tU(this,"registerLinkModeListeners",async()=>{var b;if(lV()||lA()&&null!=(b=this.client.metadata.redirect)&&b.linkMode){let b=null==a.g?void 0:a.g.Linking;if("u">typeof b){b.addEventListener("url",this.handleLinkModeMessage,this.client.name);let a=await b.getInitialURL();a&&setTimeout(()=>{this.handleLinkModeMessage({url:a})},50)}}}),tU(this,"getTVFParams",(a,b,c)=>{var d,e,f;if(!(null!=(d=b.request)&&d.method))return{};let g={correlationId:a,rpcMethods:[b.request.method],chainId:b.chainId};try{g.txHashes=this.extractTxHashesFromResult(b.request,c),g.contractAddresses=this.isValidContractData(b.request.params)?[null==(f=null==(e=b.request.params)?void 0:e[0])?void 0:f.to]:[]}catch(a){this.client.logger.warn(a,"Error getting TVF params")}return g}),tU(this,"isValidContractData",a=>{var b;if(!a)return!1;try{let c=a?.data||(null==(b=a?.[0])?void 0:b.data);if(!c.startsWith("0x"))return!1;let d=c.slice(2);return!!/^[0-9a-fA-F]*$/.test(d)&&d.length%2==0}catch{}return!1}),tU(this,"extractTxHashesFromResult",(a,b)=>{var c,d,e,f,g;try{if(!b)return[];let h=a.method,i=tI[h];if("sui_signTransaction"===h){let a,c,d,f;return[(e=b.transactionBytes,a=new Uint8Array(Buffer.from(e,"base64")),c=Array.from("TransactionData::").map(a=>a.charCodeAt(0)),(d=new Uint8Array(c.length+a.length)).set(c),d.set(a,c.length),f=ni(d,{dkLen:32}),kQ.default.encode(f))]}if("near_signTransaction"===h)return[nm(b)];if("near_signTransactions"===h)return b.map(a=>nm(a));if("xrpl_signTransactionFor"===h||"xrpl_signTransaction"===h)return[null==(c=b.tx_json)?void 0:c.hash];if("polkadot_signTransaction"===h){let c,e,f,g;return[(d={transaction:a.params.transactionPayload,signature:b.signature},f=Uint8Array.from(Buffer.from(d.signature,"hex")),g=function({publicKey:a,signature:b,payload:c}){var d,e,f;let g,h=qy(c.method),i=128|parseInt((null==(d=c.version)?void 0:d.toString())||"4"),j=(e=c.address,g=kQ.default.decode(e)[0],42===g?0:60===g?2:1),k="00"===c.era?new Uint8Array([0]):qy(c.era);if(1!==k.length&&2!==k.length)throw Error("Invalid era length");let l=parseInt(c.nonce,16),m=new Uint8Array([255&l,l>>8&255]),n=new Uint8Array([0,...a,j,...b,...k,...m,...function(a){if(a<BigInt(1)<<BigInt(6))return new Uint8Array([Number(a<<BigInt(2))]);if(a<BigInt(1)<<BigInt(14)){let b=a<<BigInt(2)|BigInt(1);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255))])}if(a<BigInt(1)<<BigInt(30)){let b=a<<BigInt(2)|BigInt(2);return new Uint8Array([Number(b&BigInt(255)),Number(b>>BigInt(8)&BigInt(255)),Number(b>>BigInt(16)&BigInt(255)),Number(b>>BigInt(24)&BigInt(255))])}throw Error("BigInt compact encoding not supported > 2^30")}(BigInt(`0x${(f=c.tip).startsWith("0x")?f.slice(2):f}`)),...h]);return new Uint8Array([...function(a){if(a<64)return new Uint8Array([a<<2]);if(a<16384){let b=a<<2|1;return new Uint8Array([255&b,b>>8&255])}if(a<0x40000000){let b=a<<2|2;return new Uint8Array([255&b,b>>8&255,b>>16&255,b>>24&255])}throw Error("Compact encoding > 2^30 not supported")}(n.length+1),i,...n])}({publicKey:function(a){let b=kQ.default.decode(a);if(b.length<33)throw Error("Too short to contain a public key");return b.slice(1,33)}(d.transaction.address),signature:f,payload:d.transaction}),c=qy(Buffer.from(g).toString("hex")),e=(0,kY.blake2b)(c,void 0,32),"0x"+Buffer.from(e).toString("hex"))]}if("algo_signTxn"===h)return qg(b)?b.map(a=>nn(a)):[nn(b)];if("cosmos_signDirect"===h){let a,c,d,e,f;return[(a=Buffer.from(b.signed.bodyBytes,"base64"),c=Buffer.from(b.signed.authInfoBytes,"base64"),d=Buffer.from(b.signature.signature,"base64"),(e=[]).push(Buffer.from([10])),e.push(no(a.length)),e.push(a),e.push(Buffer.from([18])),e.push(no(c.length)),e.push(c),e.push(Buffer.from([26])),e.push(no(d.length)),e.push(d),f=m7(Buffer.concat(e)),Buffer.from(f).toString("hex").toUpperCase())]}if("wallet_sendCalls"===h){let a=[];try{if("string"==typeof b)return a.push(b),a;if("object"!=typeof b)return a;null!=b&&b.id&&a.push(b.id);let c=null==(g=null==(f=b?.capabilities)?void 0:f.caip345)?void 0:g.transactionHashes;c&&a.push(...c)}catch(a){console.warn("getWalletSendCallsHashes failed: ",a)}return a}if("string"==typeof b)return[b];let j=b[i.key];if(qg(j))return"solana_signAllTransactions"===h?j.map(a=>(function(a){let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);let d=c[0];if(0===d)throw Error("No signatures found");if(c.length<1+64*d)throw Error("Transaction data too short for claimed signature count");if(c.length<100)throw Error("Transaction too short");let e=Buffer.from(a,"base64").slice(1,65);return kQ.default.encode(e)})(a)):j;if("string"==typeof j)return[j]}catch(a){this.client.logger.warn(a,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{let a=this.client.session.keys,b=this.client.core.relayer.messages.getWithoutAck(a);for(let[a,c]of Object.entries(b))for(let b of c)try{await this.onProviderMessageEvent({topic:a,message:b,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${a}, message: ${b}`)}}catch(a){this.client.logger.warn(a,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){let{message:a}=qe("NOT_INITIALIZED",this.name);throw Error(a)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(q4,a=>{this.onProviderMessageEvent(a)})}async onRelayMessage(a){let{topic:b,message:c,attestation:d,transportType:e}=a,{publicKey:f}=this.client.auth.authKeys.keys.includes(tL)?this.client.auth.authKeys.get(tL):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(b,c,{receiverPublicKey:f,encoding:e===rd?pA:pz});(0,qX.isJsonRpcRequest)(a)?(this.client.core.history.set(b,a),await this.onRelayEventRequest({topic:b,payload:a,attestation:d,transportType:e,encryptedId:pE(c)})):(0,qX.isJsonRpcResponse)(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:b,payload:a,transportType:e}),this.client.core.history.delete(b,a.id)):await this.onRelayEventUnknownPayload({topic:b,payload:a,transportType:e}),await this.client.core.relayer.messages.ack(b,c)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(rr,async a=>{let{topic:b,id:c}=lM(a.target);return c&&this.client.pendingRequest.keys.includes(c)?await this.deletePendingSessionRequest(c,qe("EXPIRED"),!0):c&&this.client.auth.requests.keys.includes(c)?await this.deletePendingAuthRequest(c,qe("EXPIRED"),!0):void(b?this.client.session.keys.includes(b)&&(await this.deleteSession({topic:b,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:b})):c&&(await this.deleteProposal(c,!0),this.client.events.emit("proposal_expire",{id:c})))})}registerPairingEvents(){this.client.core.pairing.events.on(rk,a=>this.onPairingCreated(a)),this.client.core.pairing.events.on(rl,a=>{this.addToRecentlyDeleted(a.topic,"pairing")})}isValidPairingTopic(a){if(!qj(a,!1)){let{message:b}=qe("MISSING_OR_INVALID",`pairing topic should be a string: ${a}`);throw Error(b)}if(!this.client.core.pairing.pairings.keys.includes(a)){let{message:b}=qe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${a}`);throw Error(b)}if(lO(this.client.core.pairing.pairings.get(a).expiry)){let{message:b}=qe("EXPIRED",`pairing topic: ${a}`);throw Error(b)}}async isValidSessionTopic(a){if(!qj(a,!1)){let{message:b}=qe("MISSING_OR_INVALID",`session topic should be a string: ${a}`);throw Error(b)}if(this.checkRecentlyDeleted(a),!this.client.session.keys.includes(a)){let{message:b}=qe("NO_MATCHING_KEY",`session topic doesn't exist: ${a}`);throw Error(b)}if(lO(this.client.session.get(a).expiry)){await this.deleteSession({topic:a});let{message:b}=qe("EXPIRED",`session topic: ${a}`);throw Error(b)}if(!this.client.core.crypto.keychain.has(a)){let{message:b}=qe("MISSING_OR_INVALID",`session topic does not exist in keychain: ${a}`);throw await this.deleteSession({topic:a}),Error(b)}}async isValidSessionOrPairingTopic(a){if(this.checkRecentlyDeleted(a),this.client.session.keys.includes(a))await this.isValidSessionTopic(a);else if(this.client.core.pairing.pairings.keys.includes(a))this.isValidPairingTopic(a);else if(qj(a,!1)){let{message:b}=qe("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${a}`);throw Error(b)}else{let{message:b}=qe("MISSING_OR_INVALID",`session or pairing topic should be a string: ${a}`);throw Error(b)}}async isValidProposalId(a){if("number"!=typeof a){let{message:b}=qe("MISSING_OR_INVALID",`proposal id should be a number: ${a}`);throw Error(b)}if(!this.client.proposal.keys.includes(a)){let{message:b}=qe("NO_MATCHING_KEY",`proposal id doesn't exist: ${a}`);throw Error(b)}if(lO(this.client.proposal.get(a).expiryTimestamp)){await this.deleteProposal(a);let{message:b}=qe("EXPIRED",`proposal id: ${a}`);throw Error(b)}}}class tW extends s3{constructor(a,b){super(a,b,"proposal",tA),this.core=a,this.logger=b}}class tX extends s3{constructor(a,b){super(a,b,"session",tA),this.core=a,this.logger=b}}class tY extends s3{constructor(a,b){super(a,b,"request",tA,a=>a.id),this.core=a,this.logger=b}}class tZ extends s3{constructor(a,b){super(a,b,"authKeys",tK,()=>tL),this.core=a,this.logger=b}}class t$ extends s3{constructor(a,b){super(a,b,"pairingTopics",tK),this.core=a,this.logger=b}}class t_ extends s3{constructor(a,b){super(a,b,"requests",tK,a=>a.id),this.core=a,this.logger=b}}var t0=Object.defineProperty,t1=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?t0(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class t2{constructor(a,b){this.core=a,this.logger=b,t1(this,"authKeys"),t1(this,"pairingTopics"),t1(this,"requests"),this.authKeys=new tZ(this.core,this.logger),this.pairingTopics=new t$(this.core,this.logger),this.requests=new t_(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var t3=Object.defineProperty,t4=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?t3(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class t5 extends qT{constructor(a){super(a),t4(this,"protocol","wc"),t4(this,"version",2),t4(this,"name",tz),t4(this,"metadata"),t4(this,"core"),t4(this,"logger"),t4(this,"events",new cB.EventEmitter),t4(this,"engine"),t4(this,"session"),t4(this,"proposal"),t4(this,"pendingRequest"),t4(this,"auth"),t4(this,"signConfig"),t4(this,"on",(a,b)=>this.events.on(a,b)),t4(this,"once",(a,b)=>this.events.once(a,b)),t4(this,"off",(a,b)=>this.events.off(a,b)),t4(this,"removeListener",(a,b)=>this.events.removeListener(a,b)),t4(this,"removeAllListeners",a=>this.events.removeAllListeners(a)),t4(this,"connect",async a=>{try{return await this.engine.connect(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"pair",async a=>{try{return await this.engine.pair(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"approve",async a=>{try{return await this.engine.approve(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"reject",async a=>{try{return await this.engine.reject(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"update",async a=>{try{return await this.engine.update(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"extend",async a=>{try{return await this.engine.extend(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"request",async a=>{try{return await this.engine.request(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"respond",async a=>{try{return await this.engine.respond(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"ping",async a=>{try{return await this.engine.ping(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"emit",async a=>{try{return await this.engine.emit(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"disconnect",async a=>{try{return await this.engine.disconnect(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"find",a=>{try{return this.engine.find(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(a){throw this.logger.error(a.message),a}}),t4(this,"authenticate",async(a,b)=>{try{return await this.engine.authenticate(a,b)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"formatAuthMessage",a=>{try{return this.engine.formatAuthMessage(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"approveSessionAuthenticate",async a=>{try{return await this.engine.approveSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),t4(this,"rejectSessionAuthenticate",async a=>{try{return await this.engine.rejectSessionAuthenticate(a)}catch(a){throw this.logger.error(a.message),a}}),this.name=a?.name||tz,this.metadata=function(a){var b,c;let d=lE();try{let e,f;return null!=a&&a.url&&d.url&&new URL(a.url).host!==new URL(d.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${a.url} differs from the actual page url:${d.url}. This is probably unintended and can lead to issues.`),a.url=d.url),null!=(b=a?.icons)&&b.length&&a.icons.length>0&&(a.icons=a.icons.filter(a=>""!==a)),e=lu(lu({},d),a),f={url:a?.url||d.url,name:a?.name||d.name,description:a?.description||d.description,icons:null!=(c=a?.icons)&&c.length&&a.icons.length>0?a.icons:d.icons},lo(e,lp(f))}catch(b){return console.warn("Error populating app metadata",b),a||d}}(a?.metadata),this.signConfig=a?.signConfig;const b=qz({logger:a?.logger||"error",name:this.name});this.logger=b,this.core=a?.core||new ty(a),this.session=new tX(this.core,this.logger),this.proposal=new tW(this.core,this.logger),this.pendingRequest=new tY(this.core,this.logger),this.engine=new tV(this),this.auth=new t2(this.core,this.logger)}static async init(a){let b=new t5(a);return await b.initialize(),b}get context(){return lh(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(a){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(a.message),a}}}var t6=a.i(577058);function t7(a){return null==a||"object"!=typeof a&&"function"!=typeof a}function t8(a){return Object.getOwnPropertySymbols(a).filter(b=>Object.prototype.propertyIsEnumerable.call(a,b))}function t9(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":Object.prototype.toString.call(a)}let ua="[object String]",ub="[object Number]",uc="[object Boolean]",ud="[object Arguments]";function ue(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function uf(a,b,c,d=new Map,e){let f=e?.(a,b,c,d);if(null!=f)return f;if(t7(a))return a;if(d.has(a))return d.get(a);if(Array.isArray(a)){let b=Array(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=uf(a[f],f,c,d,e);return Object.hasOwn(a,"index")&&(b.index=a.index),Object.hasOwn(a,"input")&&(b.input=a.input),b}if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp){let b=new RegExp(a.source,a.flags);return b.lastIndex=a.lastIndex,b}if(a instanceof Map){let b=new Map;for(let[f,g]of(d.set(a,b),a))b.set(f,uf(g,f,c,d,e));return b}if(a instanceof Set){let b=new Set;for(let f of(d.set(a,b),a))b.add(uf(f,void 0,c,d,e));return b}if("u">typeof Buffer&&Buffer.isBuffer(a))return a.subarray();if(ue(a)){let b=new(Object.getPrototypeOf(a)).constructor(a.length);d.set(a,b);for(let f=0;f<a.length;f++)b[f]=uf(a[f],f,c,d,e);return b}if(a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);if(a instanceof DataView){let b=new DataView(a.buffer.slice(0),a.byteOffset,a.byteLength);return d.set(a,b),ug(b,a,c,d,e),b}if("u">typeof File&&a instanceof File){let b=new File([a],a.name,{type:a.type});return d.set(a,b),ug(b,a,c,d,e),b}if(a instanceof Blob){let b=new Blob([a],{type:a.type});return d.set(a,b),ug(b,a,c,d,e),b}if(a instanceof Error){let b=new a.constructor;return d.set(a,b),b.message=a.message,b.name=a.name,b.stack=a.stack,b.cause=a.cause,ug(b,a,c,d,e),b}if("object"==typeof a&&function(a){switch(t9(a)){case ud:case"[object Array]":case"[object ArrayBuffer]":case"[object DataView]":case uc:case"[object Date]":case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Map]":case ub:case"[object Object]":case"[object RegExp]":case"[object Set]":case ua:case"[object Symbol]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return!0;default:return!1}}(a)){let b=Object.create(Object.getPrototypeOf(a));return d.set(a,b),ug(b,a,c,d,e),b}return a}function ug(a,b,c=a,d,e){let f=[...Object.keys(b),...t8(b)];for(let g=0;g<f.length;g++){let h=f[g],i=Object.getOwnPropertyDescriptor(a,h);(null==i||i.writable)&&(a[h]=uf(b[h],h,c,d,e))}}function uh(a){var b;return b=(b,c,d,e)=>{let f;if(null!=f)return f;if("object"==typeof a)switch(Object.prototype.toString.call(a)){case ub:case ua:case uc:{let b=new a.constructor(a?.valueOf());return ug(b,a),b}case ud:{let b={};return ug(b,a),b.length=a.length,b[Symbol.iterator]=a[Symbol.iterator],b}default:return}},uf(a,void 0,a,new Map,b)}function ui(a){return null!==a&&"object"==typeof a&&"[object Arguments]"===t9(a)}function uj(a){return"object"==typeof a&&null!==a}function uk(){}let ul="error",um="universal_provider",un=`wc@2:${um}:`,uo="https://rpc.walletconnect.org/v1/",up="generic",uq=`${uo}bundler`,ur="call_status",us="default_chain_changed";var ut=Object.defineProperty,uu=Object.defineProperties,uv=Object.getOwnPropertyDescriptors,uw=Object.getOwnPropertySymbols,ux=Object.prototype.hasOwnProperty,uy=Object.prototype.propertyIsEnumerable,uz=(a,b,c)=>b in a?ut(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,uA=(a,b)=>{for(var c in b||(b={}))ux.call(b,c)&&uz(a,c,b[c]);if(uw)for(var c of uw(b))uy.call(b,c)&&uz(a,c,b[c]);return a},uB=(a,b)=>uu(a,uv(b));function uC(a,b,c){var d;let e=lk(a);return(null==(d=b.rpcMap)?void 0:d[e.reference])||`${uo}?chainId=${e.namespace}:${e.reference}&projectId=${c}`}function uD(a){return a.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)}function uE(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>{var c,d;return(null==(c=b?.chains)?void 0:c.length)&&(null==(d=b?.chains)?void 0:d.length)>0}))}function uF(a={},b={}){return function(a,...b){return function(a,...b){let c=b.slice(0,-1),d=b[b.length-1],e=a;for(let a=0;a<c.length;a++)e=function a(b,c,d,e){if(t7(b)&&(b=Object(b)),null==c||"object"!=typeof c)return b;if(e.has(c))return function(a){if(t7(a))return a;if(Array.isArray(a)||ue(a)||a instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&a instanceof SharedArrayBuffer)return a.slice(0);let b=Object.getPrototypeOf(a),c=b.constructor;if(a instanceof Date||a instanceof Map||a instanceof Set)return new c(a);if(a instanceof RegExp){let b=new c(a);return b.lastIndex=a.lastIndex,b}if(a instanceof DataView)return new c(a.buffer.slice(0));if(a instanceof Error){let b=new c(a.message);return b.stack=a.stack,b.name=a.name,b.cause=a.cause,b}return"u">typeof File&&a instanceof File?new c([a],a.name,{type:a.type,lastModified:a.lastModified}):"object"==typeof a?Object.assign(Object.create(b),a):a}(e.get(c));if(e.set(c,b),Array.isArray(c)){c=c.slice();for(let a=0;a<c.length;a++)c[a]=c[a]??void 0}let f=[...Object.keys(c),...t8(c)];for(let g=0;g<f.length;g++){let h=f[g],i=c[h],j=b[h];if(ui(i)&&(i={...i}),ui(j)&&(j={...j}),"u">typeof Buffer&&Buffer.isBuffer(i)&&(i=uh(i)),Array.isArray(i))if("object"==typeof j&&null!=j){let a=[],b=Reflect.ownKeys(j);for(let c=0;c<b.length;c++){let d=b[c];a[d]=j[d]}j=a}else j=[];let k=d(j,i,h,b,c,e);null!=k?b[h]=k:Array.isArray(i)||uj(j)&&uj(i)?b[h]=a(j,i,d,e):null==j&&function(a){if("object"!=typeof a||null==a)return!1;if(null===Object.getPrototypeOf(a))return!0;if("[object Object]"!==Object.prototype.toString.call(a)){let b=a[Symbol.toStringTag];return null!=b&&!!Object.getOwnPropertyDescriptor(a,Symbol.toStringTag)?.writable&&a.toString()===`[object ${b}]`}let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}(i)?b[h]=a({},i,d,e):null==j&&ue(i)?b[h]=uh(i):(void 0===j||void 0!==i)&&(b[h]=i)}return b}(e,c[a],d,new Map);return e}(a,...b,uk)}(uE(uG(a)),uE(uG(b)))}function uG(a){var b,c,d,e,f;let g={};if(!qh(a))return g;for(let[h,i]of Object.entries(a)){let a=p8(h)?[h]:i.chains,j=i.methods||[],k=i.events||[],l=i.rpcMap||{},m=p9(h);g[m]=uB(uA(uA({},g[m]),i),{chains:lQ(a,null==(b=g[m])?void 0:b.chains),methods:lQ(j,null==(c=g[m])?void 0:c.methods),events:lQ(k,null==(d=g[m])?void 0:d.events)}),(qh(l)||qh((null==(e=g[m])?void 0:e.rpcMap)||{}))&&(g[m].rpcMap=uA(uA({},l),null==(f=g[m])?void 0:f.rpcMap))}return g}function uH(a){return a.includes(":")?a.split(":")[2]:a}function uI(a){let b={};for(let[c,d]of Object.entries(a)){let a=d.methods||[],e=d.events||[],f=d.accounts||[],g=p8(c)?[c]:d.chains?d.chains:uD(d.accounts);b[c]={chains:g,methods:a,events:e,accounts:f}}return b}function uJ(a){return"number"==typeof a?a:a.includes("0x")?parseInt(a,16):isNaN(Number(a=a.includes(":")?a.split(":")[1]:a))?a:Number(a)}let uK={},uL=a=>uK[a],uM=(a,b)=>{uK[a]=b};var uN=Object.defineProperty,uO=Object.getOwnPropertySymbols,uP=Object.prototype.hasOwnProperty,uQ=Object.prototype.propertyIsEnumerable,uR=(a,b,c)=>b in a?uN(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,uS=(a,b)=>{for(var c in b||(b={}))uP.call(b,c)&&uR(a,c,b[c]);if(uO)for(var c of uO(b))uQ.call(b,c)&&uR(a,c,b[c]);return a};let uT="eip155",uU=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],uV=a=>a&&a.startsWith("0x")?BigInt(a).toString(10):a,uW=a=>a&&a.startsWith("0x")?a:`0x${BigInt(a).toString(16)}`,uX=a=>Object.keys(a).filter(a=>uU.includes(a)).reduce((b,c)=>(b[c]=uY(a[c]),b),{}),uY=a=>"string"==typeof a&&function(a){try{let b=JSON.parse(a);return"object"==typeof b&&null!==b&&!Array.isArray(b)}catch{return!1}}(a)?JSON.parse(a):a;var uZ=Object.defineProperty;class u${constructor(a){((a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?uZ(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c})(this,"storage"),this.storage=a}async getItem(a){return await this.storage.getItem(a)}async setItem(a,b){return await this.storage.setItem(a,b)}async removeItem(a){return await this.storage.removeItem(a)}static getStorage(a){return f||(f=new u$(a)),f}}var u_=Object.defineProperty,u0=Object.defineProperties,u1=Object.getOwnPropertyDescriptors,u2=Object.getOwnPropertySymbols,u3=Object.prototype.hasOwnProperty,u4=Object.prototype.propertyIsEnumerable,u5=(a,b,c)=>b in a?u_(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c;async function u6(a,b){let c,d=lk(a.result.capabilities.caip345.caip2),e=a.result.capabilities.caip345.transactionHashes,f=await Promise.allSettled(e.map(a=>u7(d.reference,a,b))),g=f.filter(a=>"fulfilled"===a.status).map(a=>a.value).filter(a=>a);f.filter(a=>"rejected"===a.status).forEach(a=>console.warn("Failed to fetch transaction receipt:",a.reason));let h=!g.length||g.some(a=>!a),i=g.every(a=>a?.status==="0x1"),j=g.every(a=>a?.status==="0x0"),k=g.some(a=>a?.status==="0x0");return h?c=100:i?c=200:j?c=500:k&&(c=600),{id:a.result.id,version:a.request.version,atomic:a.request.atomicRequired,chainId:a.request.chainId,capabilities:a.result.capabilities,receipts:g,status:c}}async function u7(a,b,c){return await c(parseInt(a)).request((0,qW.formatJsonRpcRequest)("eth_getTransactionReceipt",[b]))}async function u8({sendCalls:a,storage:b}){let c=await b.getItem(ur);await b.setItem(ur,u0(((a,b)=>{for(var c in b||(b={}))u3.call(b,c)&&u5(a,c,b[c]);if(u2)for(var c of u2(b))u4.call(b,c)&&u5(a,c,b[c]);return a})({},c),u1({[a.result.id]:{request:a.request,result:a.result,expiry:lN(86400)}})))}async function u9({resultId:a,storage:b}){let c=await b.getItem(ur);if(c){for(let d in delete c[a],await b.setItem(ur,c),c)lO(c[d].expiry)&&delete c[d];await b.setItem(ur,c)}}async function va({resultId:a,storage:b}){let c=await b.getItem(ur),d=c?.[a];if(d&&!lO(d.expiry))return d;await u9({resultId:a,storage:b})}var vb=Object.defineProperty,vc=Object.defineProperties,vd=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,vf=Object.prototype.hasOwnProperty,vg=Object.prototype.propertyIsEnumerable,vh=(a,b,c)=>b in a?vb(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,vi=(a,b)=>{for(var c in b||(b={}))vf.call(b,c)&&vh(a,c,b[c]);if(ve)for(var c of ve(b))vg.call(b,c)&&vh(a,c,b[c]);return a},vj=(a,b,c)=>vh(a,"symbol"!=typeof b?b+"":b,c);class vk{constructor(a){vj(this,"name","eip155"),vj(this,"client"),vj(this,"chainId"),vj(this,"namespace"),vj(this,"httpProviders"),vj(this,"events"),vj(this,"storage"),this.namespace=a.namespace,this.events=uL("events"),this.client=uL("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=u$.getStorage(this.client.core.storage)}async request(a){switch(a.request.method){case"eth_requestAccounts":case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(a);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(a);case"wallet_getCallsStatus":return await this.getCallStatus(a);case"wallet_sendCalls":return await this.sendCalls(a)}return this.namespace.methods.includes(a.request.method)?await this.client.request(a):this.getHttpProvider().request(a.request)}updateNamespace(a){this.namespace=Object.assign(this.namespace,a)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(parseInt(a),b);let c=this.chainId;this.chainId=parseInt(a),this.events.emit(us,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}createHttpProvider(a,b){let c=b||uC(`${this.name}:${a}`,this.namespace,this.client.core.projectId);return new qV.JsonRpcProvider(new t6.HttpConnection(c,uL("disableProviderPing")))}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProviders(){let a={};return this.namespace.chains.forEach(b=>{var c;let d=parseInt(b.includes(":")?b.split(":")[1]:b);a[d]=this.createHttpProvider(d,null==(c=this.namespace.rpcMap)?void 0:c[b])}),a}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}getHttpProvider(a){let b=a||this.chainId;return this.httpProviders[b]||(this.httpProviders=vc(vi({},this.httpProviders),vd({[b]:this.createHttpProvider(b)})),this.httpProviders[b])}async handleSwitchChain(a){var b,c;let d=a.request.params?null==(b=a.request.params[0])?void 0:b.chainId:"0x0",e=parseInt(d=d.startsWith("0x")?d:`0x${d}`,16);if(this.isChainApproved(e))this.setDefaultChain(`${e}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:a.topic,request:{method:a.request.method,params:[{chainId:d}]},chainId:null==(c=this.namespace.chains)?void 0:c[0]}),this.setDefaultChain(`${e}`);else throw Error(`Failed to switch to chain 'eip155:${e}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(a){return this.namespace.chains.includes(`${this.name}:${a}`)}async getCapabilities(a){var b,c,d,e,f;let g,h=null==(c=null==(b=a.request)?void 0:b.params)?void 0:c[0],i=(null==(e=null==(d=a.request)?void 0:d.params)?void 0:e[1])||[];if(!h)throw Error("Missing address parameter in `wallet_getCapabilities` request");let j=this.client.session.get(a.topic),k=(null==(f=j?.sessionProperties)?void 0:f.capabilities)||{},l=`${h}${i.join(",")}`,m=k?.[l];if(m)return m;try{g=((a,b,c)=>{let{sessionProperties:d={},scopedProperties:e={}}=a,f={};if(!qh(e)&&!qh(d))return;let g=uX(d);for(let a of c){let c=uV(a);if(!c)continue;f[uW(c)]=g;let d=e?.[`${uT}:${c}`];if(d){let a=d?.[`${uT}:${c}:${b}`];f[uW(c)]=uS(uS({},f[uW(c)]),uX(a||d))}}for(let[a,b]of Object.entries(f))0===Object.keys(b).length&&delete f[a];return Object.keys(f).length>0?f:void 0})(j,h,i)}catch(a){console.warn("Failed to extract capabilities from session",a)}if(g)return g;let n=await this.client.request(a);try{let b,c,d,e;await this.client.session.update(a.topic,{sessionProperties:(d=vi({},j.sessionProperties||{}),e={capabilities:(b=vi({},k||{}),c={[l]:n},vc(b,vd(c)))},vc(d,vd(e)))})}catch(a){console.warn("Failed to update session with capabilities",a)}return n}async getCallStatus(a){var b,c,d;let e=this.client.session.get(a.topic),f=null==(b=e.sessionProperties)?void 0:b.bundler_name;if(f){let b=this.getBundlerUrl(a.chainId,f);try{return await this.getUserOperationReceipt(b,a)}catch(a){console.warn("Failed to fetch call status from bundler",a,b)}}let g=null==(c=e.sessionProperties)?void 0:c.bundler_url;if(g)try{return await this.getUserOperationReceipt(g,a)}catch(a){console.warn("Failed to fetch call status from custom bundler",a,g)}let h=await va({resultId:null==(d=a.request.params)?void 0:d[0],storage:this.storage});if(h)try{return await u6(h,this.getHttpProvider.bind(this))}catch(a){console.warn("Failed to fetch call status from stored send calls",a,h)}if(this.namespace.methods.includes(a.request.method))return await this.client.request(a);throw Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(a,b){var c;let d=new URL(a),e=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,qW.formatJsonRpcRequest)("eth_getUserOperationReceipt",[null==(c=b.request.params)?void 0:c[0]]))});if(!e.ok)throw Error(`Failed to fetch user operation receipt - ${e.status}`);return await e.json()}getBundlerUrl(a,b){return`${uq}?projectId=${this.client.core.projectId}&chainId=${a}&bundler=${b}`}async sendCalls(a){var b,c,d;let e=await this.client.request(a),f=null==(b=a.request.params)?void 0:b[0],g=e?.id,h=e?.capabilities||{},i=null==(c=h?.caip345)?void 0:c.caip2,j=null==(d=h?.caip345)?void 0:d.transactionHashes;return g&&i&&null!=j&&j.length&&await u8({sendCalls:{request:f,result:e},storage:this.storage}),e}}var vl=Object.defineProperty,vm=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?vl(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c};class vn{constructor(a){vm(this,"name",up),vm(this,"client"),vm(this,"httpProviders"),vm(this,"events"),vm(this,"namespace"),vm(this,"chainId"),this.namespace=a.namespace,this.events=uL("events"),this.client=uL("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(a){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(a.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(a.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(a.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(a.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(a){return this.namespace.methods.includes(a.request.method)?this.client.request(a):this.getHttpProvider(a.chainId).request(a.request)}setDefaultChain(a,b){this.httpProviders[a]||this.setHttpProvider(a,b);let c=this.chainId;this.chainId=a,this.events.emit(us,{currentCaipChainId:`${this.name}:${a}`,previousCaipChainId:`${this.name}:${c}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return a.split(":")[1]}getNamespaceName(){let a=this.namespace.chains[0];if(!a)throw Error("ChainId not found");return lk(a).namespace}getAccounts(){let a=this.namespace.accounts;return a?[...new Set(a.filter(a=>a.split(":")[1]===this.chainId.toString()).map(a=>a.split(":")[2]))]:[]}createHttpProviders(){var a,b;let c={};return null==(b=null==(a=this.namespace)?void 0:a.accounts)||b.forEach(a=>{var b,d;let e=lk(a),f=null==(d=null==(b=this.namespace)?void 0:b.rpcMap)?void 0:d[`${e.namespace}:${e.reference}`];c[e.reference]=this.createHttpProvider(a,f)}),c}getHttpProvider(a){let b=lk(a).reference,c=this.httpProviders[b];if(typeof c>"u")throw Error(`JSON-RPC provider for ${a} not found`);return c}setHttpProvider(a,b){let c=this.createHttpProvider(a,b);c&&(this.httpProviders[a]=c)}createHttpProvider(a,b){let c=b||uC(a,this.namespace,this.client.core.projectId);return new qV.JsonRpcProvider(new t6.default(c,uL("disableProviderPing")))}}var vo=Object.defineProperty,vp=Object.defineProperties,vq=Object.getOwnPropertyDescriptors,vr=Object.getOwnPropertySymbols,vs=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,vu=(a,b,c)=>b in a?vo(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,vv=(a,b)=>{for(var c in b||(b={}))vs.call(b,c)&&vu(a,c,b[c]);if(vr)for(var c of vr(b))vt.call(b,c)&&vu(a,c,b[c]);return a},vw=(a,b,c)=>vu(a,"symbol"!=typeof b?b+"":b,c);class vx{constructor(a){var b,c;vw(this,"client"),vw(this,"namespaces"),vw(this,"optionalNamespaces"),vw(this,"sessionProperties"),vw(this,"scopedProperties"),vw(this,"events",new cB.default),vw(this,"rpcProviders",{}),vw(this,"session"),vw(this,"providerOpts"),vw(this,"logger"),vw(this,"uri"),vw(this,"disableProviderPing",!1),this.providerOpts=a,this.logger=qz({logger:null!=(b=a.logger)?b:ul,name:null!=(c=this.providerOpts.name)?c:um}),this.disableProviderPing=a?.disableProviderPing||!1}static async init(a){let b=new vx(a);return await b.initialize(),b}async request(a,b,c){let[d,e]=this.validateChain(b);if(!this.session)throw Error("Please call connect() before request()");return await this.getProvider(d).request({request:vv({},a),chainId:`${d}:${e}`,topic:this.session.topic,expiry:c})}sendAsync(a,b,c,d){let e=new Date().getTime();this.request(a,c,d).then(a=>b(null,(0,qW.formatJsonRpcResult)(e,a))).catch(a=>b(a,void 0))}async enable(){if(!this.client)throw Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var a;if(!this.session)throw Error("Please call connect() before enable()");await this.client.disconnect({topic:null==(a=this.session)?void 0:a.topic,reason:qf("USER_DISCONNECTED")}),await this.cleanup()}async connect(a){if(!this.client)throw Error("Sign Client not initialized");if(this.setNamespaces(a),this.cleanupPendingPairings(),!a.skipPairing)return await this.pair(a.pairingTopic)}async authenticate(a,b){if(!this.client)throw Error("Sign Client not initialized");this.setNamespaces(a),await this.cleanupPendingPairings();let{uri:c,response:d}=await this.client.authenticate(a,b);c&&(this.uri=c,this.events.emit("display_uri",c));let e=await d();if(this.session=e.session,this.session){let a=uI(this.session.namespaces);this.namespaces=uF(this.namespaces,a),await this.persist("namespaces",this.namespaces),this.onConnect()}return e}on(a,b){this.events.on(a,b)}once(a,b){this.events.once(a,b)}removeListener(a,b){this.events.removeListener(a,b)}off(a,b){this.events.off(a,b)}get isWalletConnect(){return!0}async pair(a){let{uri:b,approval:c}=await this.client.connect({pairingTopic:a,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});b&&(this.uri=b,this.events.emit("display_uri",b));let d=await c();this.session=d;let e=uI(d.namespaces);return this.namespaces=uF(this.namespaces,e),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(a,b){try{if(!this.session)return;let[c,d]=this.validateChain(a);this.getProvider(c).setDefaultChain(d,b)}catch(a){if(!/Please call connect/.test(a.message))throw a}}async cleanupPendingPairings(a={}){try{this.logger.info("Cleaning up inactive pairings...");let b=this.client.pairing.getAll();if(!qg(b))return;for(let c of b)a.deletePairings?this.client.core.expirer.set(c.topic,0):await this.client.core.relayer.subscriber.unsubscribe(c.topic);this.logger.info(`Inactive pairings cleared: ${b.length}`)}catch(a){this.logger.warn(a,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var a,b;if(this.client=this.providerOpts.client||await t5.init({core:this.providerOpts.core,logger:this.providerOpts.logger||ul,relayUrl:this.providerOpts.relayUrl||"wss://relay.walletconnect.org",projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(c){throw this.logger.error(c,"Failed to get session"),Error(`The provided session: ${null==(b=null==(a=this.providerOpts)?void 0:a.session)?void 0:b.topic} doesn't exist in the Sign client`)}else{let a=this.client.session.getAll();this.session=a[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw Error("Sign Client not initialized");if(!this.session)throw Error("Session not initialized. Please call connect() before enable()");let a=[...new Set(Object.keys(this.session.namespaces).map(a=>p9(a)))];uM("client",this.client),uM("events",this.events),uM("disableProviderPing",this.disableProviderPing),a.forEach(a=>{if(!this.session)return;let b=function(a,b){let c=Object.keys(b.namespaces).filter(b=>b.includes(a));if(!c.length)return[];let d=[];return c.forEach(a=>{let c=b.namespaces[a].accounts;d.push(...c)}),d}(a,this.session);if(b?.length===0)return;let c=uD(b),d=vp(vv({},uF(this.namespaces,this.optionalNamespaces)[a]),vq({accounts:b,chains:c}));"eip155"===a?this.rpcProviders[a]=new vk({namespace:d}):this.rpcProviders[a]=new vn({namespace:d})})}registerEventListeners(){if(typeof this.client>"u")throw Error("Sign Client is not initialized");this.client.on("session_ping",a=>{var b;let{topic:c}=a;c===(null==(b=this.session)?void 0:b.topic)&&this.events.emit("session_ping",a)}),this.client.on("session_event",a=>{var b;let{params:c,topic:d}=a;if(d!==(null==(b=this.session)?void 0:b.topic))return;let{event:e}=c;if("accountsChanged"===e.name){let a=e.data;a&&qg(a)&&this.events.emit("accountsChanged",a.map(uH))}else if("chainChanged"===e.name){let a=c.chainId,b=c.event.data,d=p9(a),e=uJ(a)!==uJ(b)?`${d}:${uJ(b)}`:a;this.onChainChanged({currentCaipChainId:e})}else this.events.emit(e.name,e.data);this.events.emit("session_event",a)}),this.client.on("session_update",({topic:a,params:b})=>{var c,d;if(a!==(null==(c=this.session)?void 0:c.topic))return;let{namespaces:e}=b,f=null==(d=this.client)?void 0:d.session.get(a);this.session=vp(vv({},f),vq({namespaces:e})),this.onSessionUpdate(),this.events.emit("session_update",{topic:a,params:b})}),this.client.on("session_delete",async a=>{var b;a.topic===(null==(b=this.session)?void 0:b.topic)&&(await this.cleanup(),this.events.emit("session_delete",a),this.events.emit("disconnect",vp(vv({},qf("USER_DISCONNECTED")),vq({data:a.topic}))))}),this.on(us,a=>{this.onChainChanged(vp(vv({},a),vq({internal:!0})))})}getProvider(a){return this.rpcProviders[a]||this.rpcProviders[up]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(a=>{var b;this.getProvider(a).updateNamespace(null==(b=this.session)?void 0:b.namespaces[a])})}setNamespaces(a){let{namespaces:b={},optionalNamespaces:c={},sessionProperties:d,scopedProperties:e}=a;this.optionalNamespaces=uF(b,c),this.sessionProperties=d,this.scopedProperties=e}validateChain(a){let[b,c]=a?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[b,c];if(b&&!Object.keys(this.namespaces||{}).map(a=>p9(a)).includes(b))throw Error(`Namespace '${b}' is not configured. Please call connect() first with namespace config.`);if(b&&c)return[b,c];let d=p9(Object.keys(this.namespaces)[0]),e=this.rpcProviders[d].getDefaultChain();return[d,e]}async requestAccounts(){let[a]=this.validateChain();return await this.getProvider(a).requestAccounts()}async onChainChanged({currentCaipChainId:a,previousCaipChainId:b,internal:c=!1}){if(!this.namespaces)return;let[d,e]=this.validateChain(a);e&&(this.updateNamespaceChain(d,e),c?(this.events.emit("chainChanged",e),this.emitAccountsChangedOnChainChange({namespace:d,currentCaipChainId:a,previousCaipChainId:b})):this.getProvider(d).setDefaultChain(e),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:a,currentCaipChainId:b,previousCaipChainId:c}){var d,e;try{if(c===b)return;let f=null==(e=null==(d=this.session)?void 0:d.namespaces[a])?void 0:e.accounts;if(!f)return;let g=f.filter(a=>a.includes(`${b}:`)).map(uH);if(!qg(g))return;this.events.emit("accountsChanged",g)}catch(a){this.logger.warn(a,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(a,b){if(!this.namespaces)return;let c=this.namespaces[a]?a:`${a}:${b}`;this.namespaces[c]?this.namespaces[c]&&(this.namespaces[c].defaultChain=b):this.namespaces[c]={chains:[],methods:[],events:[],defaultChain:b}}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(a,b){var c;let d=(null==(c=this.session)?void 0:c.topic)||"";await this.client.core.storage.setItem(`${un}/${a}${d}`,b)}async getFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";return await this.client.core.storage.getItem(`${un}/${a}${c}`)}async deleteFromStore(a){var b;let c=(null==(b=this.session)?void 0:b.topic)||"";await this.client.core.storage.removeItem(`${un}/${a}${c}`)}async cleanupStorage(){var a;try{if((null==(a=this.client)?void 0:a.session.length)>0)return;for(let a of(await this.client.core.storage.getKeys()))a.startsWith(un)&&await this.client.core.storage.removeItem(a)}catch(a){this.logger.warn(a,"Failed to cleanup storage")}}}let vy=["eth_sendTransaction","personal_sign"],vz=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],vA=["chainChanged","accountsChanged"],vB=["chainChanged","accountsChanged","message","disconnect","connect"],vC=async()=>{let{createAppKit:b}=await a.A(36165);return b};var vD=Object.defineProperty,vE=Object.defineProperties,vF=Object.getOwnPropertyDescriptors,vG=Object.getOwnPropertySymbols,vH=Object.prototype.hasOwnProperty,vI=Object.prototype.propertyIsEnumerable,vJ=(a,b,c)=>b in a?vD(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,vK=(a,b)=>{for(var c in b||(b={}))vH.call(b,c)&&vJ(a,c,b[c]);if(vG)for(var c of vG(b))vI.call(b,c)&&vJ(a,c,b[c]);return a},vL=(a,b,c)=>vJ(a,"symbol"!=typeof b?b+"":b,c);function vM(a){return Number(a[0].split(":")[1])}function vN(a){return`0x${a.toString(16)}`}class vO{constructor(){vL(this,"events",new cB.EventEmitter),vL(this,"namespace","eip155"),vL(this,"accounts",[]),vL(this,"signer"),vL(this,"chainId",1),vL(this,"modal"),vL(this,"rpc"),vL(this,"STORAGE_KEY","wc@2:ethereum_provider:"),vL(this,"on",(a,b)=>(this.events.on(a,b),this)),vL(this,"once",(a,b)=>(this.events.once(a,b),this)),vL(this,"removeListener",(a,b)=>(this.events.removeListener(a,b),this)),vL(this,"off",(a,b)=>(this.events.off(a,b),this)),vL(this,"parseAccount",a=>this.isCompatibleChainId(a)?this.parseAccountId(a).address:a),this.signer={},this.rpc={}}static async init(a){let b=new vO;return await b.initialize(a),b}async request(a,b){return await this.signer.request(a,this.formatChainId(this.chainId),b)}sendAsync(a,b,c){this.signer.sendAsync(a,b,this.formatChainId(this.chainId),c)}get connected(){return!!this.signer.client&&this.signer.client.core.relayer.connected}get connecting(){return!!this.signer.client&&this.signer.client.core.relayer.connecting}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(a){var b;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts(a);let{required:c,optional:d}=function(a){let{chains:b,optionalChains:c,methods:d,optionalMethods:e,events:f,optionalEvents:g,rpcMap:h}=a;if(!qg(b))throw Error("Invalid chains");let i={chains:b,methods:d||vy,events:f||vA,rpcMap:vK({},b.length?{[vM(b)]:h[vM(b)]}:{})},j=f?.filter(a=>!vA.includes(a)),k=d?.filter(a=>!vy.includes(a));if(!c&&!g&&!e&&!(null!=j&&j.length)&&!(null!=k&&k.length))return{required:b.length?i:void 0};let l={chains:[...new Set(j?.length&&k?.length||!c?i.chains.concat(c||[]):c)],methods:[...new Set(i.methods.concat(null!=e&&e.length?e:vz))],events:[...new Set(i.events.concat(null!=g&&g.length?g:vB))],rpcMap:h};return{required:b.length?i:void 0,optional:c.length?l:void 0}}(this.rpc);try{let b=await new Promise(async(b,e)=>{var f,g;let h,i;this.rpc.showQrModal&&(null==(f=this.modal)||f.open(),null==(g=this.modal)||g.subscribeState(a=>{a.open||this.signer.session||(this.signer.abortPairingAttempt(),e(Error("Connection request reset. Please try again.")))}));let j=null!=a&&a.scopedProperties?{[this.namespace]:a.scopedProperties}:void 0;await this.signer.connect((h=vK({namespaces:vK({},c&&{[this.namespace]:c})},d&&{optionalNamespaces:{[this.namespace]:d}}),i={pairingTopic:a?.pairingTopic,scopedProperties:j},vE(h,vF(i)))).then(a=>{b(a)}).catch(a=>{var b;null==(b=this.modal)||b.showErrorMessage("Unable to connect"),e(Error(a.message))})});if(!b)return;let e=ll(b.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:e),this.setAccounts(e),this.events.emit("connect",{chainId:vN(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{null==(b=this.modal)||b.close()}}async authenticate(a,b){var c;if(!this.signer.client)throw Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:a?.chains});try{let c=await new Promise(async(c,d)=>{var e,f;let g,h;this.rpc.showQrModal&&(null==(e=this.modal)||e.open(),null==(f=this.modal)||f.subscribeState(a=>{a.open||this.signer.session||(this.signer.abortPairingAttempt(),d(Error("Connection request reset. Please try again.")))})),await this.signer.authenticate((g=vK({},a),h={chains:this.rpc.chains},vE(g,vF(h))),b).then(a=>{c(a)}).catch(a=>{var b;null==(b=this.modal)||b.showErrorMessage("Unable to connect"),d(Error(a.message))})}),d=c.session;if(d){let a=ll(d.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:a),this.setAccounts(a),this.events.emit("connect",{chainId:vN(this.chainId)})}return c}catch(a){throw this.signer.logger.error(a),a}finally{null==(c=this.modal)||c.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",a=>{let{params:b}=a,{event:c}=b;"accountsChanged"===c.name?(this.accounts=this.parseAccounts(c.data),this.events.emit("accountsChanged",this.accounts)):"chainChanged"===c.name?this.setChainId(this.formatChainId(c.data)):this.events.emit(c.name,c.data),this.events.emit("session_event",a)}),this.signer.on("accountsChanged",a=>{this.accounts=this.parseAccounts(a),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",a=>{let b=parseInt(a);this.chainId=b,this.events.emit("chainChanged",vN(this.chainId)),this.persist()}),this.signer.on("session_update",a=>{this.events.emit("session_update",a)}),this.signer.on("session_delete",a=>{this.reset(),this.events.emit("session_delete",a),this.events.emit("disconnect",vE(vK({},qf("USER_DISCONNECTED")),vF({data:a.topic,name:"USER_DISCONNECTED"})))}),this.signer.on("display_uri",a=>{this.events.emit("display_uri",a)})}switchEthereumChain(a){this.request({method:"wallet_switchEthereumChain",params:[{chainId:a.toString(16)}]})}isCompatibleChainId(a){return"string"==typeof a&&a.startsWith(`${this.namespace}:`)}formatChainId(a){return`${this.namespace}:${a}`}parseChainId(a){return Number(a.split(":")[1])}setChainIds(a){let b=a.filter(a=>this.isCompatibleChainId(a)).map(a=>this.parseChainId(a));b.length&&(this.chainId=b[0],this.events.emit("chainChanged",vN(this.chainId)),this.persist())}setChainId(a){if(this.isCompatibleChainId(a)){let b=this.parseChainId(a);this.chainId=b,this.switchEthereumChain(b)}}parseAccountId(a){let[b,c,d]=a.split(":");return{chainId:`${b}:${c}`,address:d}}setAccounts(a){this.accounts=a.filter(a=>this.parseChainId(this.parseAccountId(a).chainId)===this.chainId).map(a=>this.parseAccountId(a).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(a){var b,c;let d=null!=(b=a?.chains)?b:[],e=null!=(c=a?.optionalChains)?c:[],f=d.concat(e);if(!f.length)throw Error("No chains specified in either `chains` or `optionalChains`");let g=d.length?a?.methods||vy:[],h=d.length?a?.events||vA:[],i=a?.optionalMethods||[],j=a?.optionalEvents||[],k=a?.rpcMap||this.buildRpcMap(f,a.projectId),l=a?.qrModalOptions||void 0;return{chains:d?.map(a=>this.formatChainId(a)),optionalChains:e.map(a=>this.formatChainId(a)),methods:g,events:h,optionalMethods:i,optionalEvents:j,rpcMap:k,showQrModal:!!(null!=a&&a.showQrModal),qrModalOptions:l,projectId:a.projectId,metadata:a.metadata}}buildRpcMap(a,b){let c={};return a.forEach(a=>{c[a]=this.getRpcUrl(a,b)}),c}async initialize(a){var b;if(this.rpc=this.getRpcConfig(a),this.chainId=this.rpc.chains.length?vM(this.rpc.chains):vM(this.rpc.optionalChains),this.signer=await vx.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:a.disableProviderPing,relayUrl:a.relayUrl,storage:a.storage,storageOptions:a.storageOptions,customStoragePrefix:a.customStoragePrefix,telemetryEnabled:a.telemetryEnabled,logger:a.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let a;try{let c,d,e,f,g=await vC(),{convertWCMToAppKitOptions:h}=await Promise.resolve().then(function(){return vZ}),i=h((c=vK({},this.rpc.qrModalOptions),d={chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId},vE(c,vF(d))));if(!i.networks.length)throw Error("No networks found for WalletConnect");a=g((e=vK({},i),f={universalProvider:this.signer,manualWCControl:!0,enableMobileFullScreen:(null==(b=this.rpc.qrModalOptions)?void 0:b.enableMobileFullScreen)===!0},vE(e,vF(f))))}catch(a){throw console.warn(a),Error("To use QR modal, please install @reown/appkit package")}if(a)try{this.modal=a}catch(a){throw this.signer.logger.error(a),Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(a){if(!a)return;let{chains:b,optionalChains:c,rpcMap:d}=a;b&&qg(b)&&(this.rpc.chains=b.map(a=>this.formatChainId(a)),b.forEach(a=>{this.rpc.rpcMap[a]=d?.[a]||this.getRpcUrl(a)})),c&&qg(c)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=c?.map(a=>this.formatChainId(a)),c.forEach(a=>{this.rpc.rpcMap[a]=d?.[a]||this.getRpcUrl(a)}))}getRpcUrl(a,b){var c;return(null==(c=this.rpc.rpcMap)?void 0:c[a])||`https://rpc.walletconnect.org/v1/?chainId=eip155:${a}&projectId=${b||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{let a=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),b=this.session.namespaces[`${this.namespace}:${a}`]?this.session.namespaces[`${this.namespace}:${a}`]:this.session.namespaces[this.namespace];this.setChainIds(a?[this.formatChainId(a)]:b?.accounts),this.setAccounts(b?.accounts)}catch(a){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(a),await this.disconnect().catch(a=>this.signer.logger.warn(a))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(a){return"string"==typeof a||a instanceof String?[this.parseAccount(a)]:a.map(a=>this.parseAccount(a))}}var vP=Object.defineProperty,vQ=Object.defineProperties,vR=Object.getOwnPropertyDescriptors,vS=Object.getOwnPropertySymbols,vT=Object.prototype.hasOwnProperty,vU=Object.prototype.propertyIsEnumerable,vV=(a,b,c)=>b in a?vP(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,vW=(a,b)=>{for(var c in b||(b={}))vT.call(b,c)&&vV(a,c,b[c]);if(vS)for(var c of vS(b))vU.call(b,c)&&vV(a,c,b[c]);return a};let vX=a=>{let[b,c]=a.split(":");return vY({id:c,caipNetworkId:a,chainNamespace:b,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function vY(a){return vW({formatters:void 0,fees:void 0,serializers:void 0},a)}var vZ=Object.freeze({__proto__:null,convertWCMToAppKitOptions:function(a){var b,c,d,e,f,g,h;let i=null==(b=a.chains)?void 0:b.map(vX).filter(Boolean);if(0===i.length)throw Error("At least one chain must be specified");let j=i.find(b=>{var c;return b.id===(null==(c=a.defaultChain)?void 0:c.id)}),k={projectId:a.projectId,networks:i,themeMode:a.themeMode,themeVariables:function(a){if(a)return{"--w3m-font-family":a["--wcm-font-family"],"--w3m-accent":a["--wcm-accent-color"],"--w3m-color-mix":a["--wcm-background-color"],"--w3m-z-index":a["--wcm-z-index"]?Number(a["--wcm-z-index"]):void 0,"--w3m-qr-color":a["--wcm-accent-color"],"--w3m-font-size-master":a["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":a["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}(a.themeVariables),chainImages:a.chainImages,connectorImages:a.walletImages,defaultNetwork:j,metadata:vQ(vW({},a.metadata),vR({name:(null==(c=a.metadata)?void 0:c.name)||"WalletConnect",description:(null==(d=a.metadata)?void 0:d.description)||"Connect to WalletConnect-compatible wallets",url:(null==(e=a.metadata)?void 0:e.url)||"https://walletconnect.org",icons:(null==(f=a.metadata)?void 0:f.icons)||["https://walletconnect.org/walletconnect-logo.png"]})),showWallets:!0,featuredWalletIds:"NONE"===a.explorerRecommendedWalletIds?[]:Array.isArray(a.explorerRecommendedWalletIds)?a.explorerRecommendedWalletIds:[],excludeWalletIds:"ALL"===a.explorerExcludedWalletIds?[]:Array.isArray(a.explorerExcludedWalletIds)?a.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if(null!=(g=a.mobileWallets)&&g.length||null!=(h=a.desktopWallets)&&h.length){let b=[...(a.mobileWallets||[]).map(a=>({id:a.id,name:a.name,links:a.links})),...(a.desktopWallets||[]).map(a=>({id:a.id,name:a.name,links:{native:a.links.native,universal:a.links.universal}}))],c=[...k.featuredWalletIds||[],...k.excludeWalletIds||[]],d=b.filter(a=>!c.includes(a.id));d.length&&(k.customWallets=d)}return k},defineChain:vY}),v$=a.i(49136);a.i(329885);var v_=a.i(671538),v0=a.i(112236);a.i(500278);var v1=a.i(737795),v2=a.i(850710),v3=a.i(814465),v4=Object.defineProperty,v5=(a,b)=>{for(var c in b)v4(a,c,{get:b[c],enumerable:!0})},v6={84532:{usdcAddress:"0x036CbD53842c5426634e7929541eC2318f3dCF7e",usdcName:"USDC"},8453:{usdcAddress:"0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913",usdcName:"USD Coin"},43113:{usdcAddress:"0x5425890298aed601595a70AB815c96711a31Bc65",usdcName:"USD Coin"},43114:{usdcAddress:"0xB97EF9Ef8734C71904D8002F8b6Bc66Dd9c48a6E",usdcName:"USD Coin"},4689:{usdcAddress:"0xcdf79194c6c285077a58da47641d4dbe51f63542",usdcName:"Bridged USDC"},103:{usdcAddress:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",usdcName:"USDC"},101:{usdcAddress:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",usdcName:"USDC"},1328:{usdcAddress:"0x4fcf1784b31630811181f670aea7a7bef803eaed",usdcName:"USDC"},1329:{usdcAddress:"0xe15fc38f6d8c56af07bbcbe3baf5708a2bf42392",usdcName:"USDC"},137:{usdcAddress:"0x3c499c542cef5e3811e1192ce70d8cc03d5c3359",usdcName:"USD Coin"},80002:{usdcAddress:"0x41E94Eb019C0762f9Bfcf9Fb1E58725BfB0e7582",usdcName:"USDC"},3338:{usdcAddress:"0xbbA60da06c2c5424f03f7434542280FCAd453d10",usdcName:"USDC"},2741:{usdcAddress:"0x84a71ccd554cc1b02749b35d22f684cc8ec987e1",usdcName:"Bridged USDC"},11124:{usdcAddress:"0xe4C7fBB0a626ed208021ccabA6Be1566905E2dFc",usdcName:"Bridged USDC"},1514:{usdcAddress:"0xF1815bd50389c46847f0Bda824eC8da914045D14",usdcName:"Bridged USDC"},41923:{usdcAddress:"0x12a272A581feE5577A5dFa371afEB4b2F3a8C2F8",usdcName:"Bridged USDC (Stargate)"},0x135a9d92:{usdcAddress:"0x2e08028E3C4c2356572E096d8EF835cD5C6030bD",usdcName:"Bridged USDC (SKALE Bridge)"}},v7=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"authorizer",type:"address"},{indexed:!0,internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"AuthorizationUsed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"Blacklisted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newBlacklister",type:"address"}],name:"BlacklisterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"burner",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newMasterMinter",type:"address"}],name:"MasterMinterChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"minter",type:"address"},{indexed:!1,internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"MinterConfigured",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"oldMinter",type:"address"}],name:"MinterRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"previousOwner",type:"address"},{indexed:!1,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[],name:"Pause",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newAddress",type:"address"}],name:"PauserChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"newRescuer",type:"address"}],name:"RescuerChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"_account",type:"address"}],name:"UnBlacklisted",type:"event"},{anonymous:!1,inputs:[],name:"Unpause",type:"event"},{inputs:[],name:"CANCEL_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"RECEIVE_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"TRANSFER_WITH_AUTHORIZATION_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"}],name:"authorizationState",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"blacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"blacklister",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"_amount",type:"uint256"}],name:"burn",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"authorizer",type:"address"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"cancelAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"},{internalType:"uint256",name:"minterAllowedAmount",type:"uint256"}],name:"configureMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"currency",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"decrement",type:"uint256"}],name:"decreaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"increment",type:"uint256"}],name:"increaseAllowance",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"tokenName",type:"string"},{internalType:"string",name:"tokenSymbol",type:"string"},{internalType:"string",name:"tokenCurrency",type:"string"},{internalType:"uint8",name:"tokenDecimals",type:"uint8"},{internalType:"address",name:"newMasterMinter",type:"address"},{internalType:"address",name:"newPauser",type:"address"},{internalType:"address",name:"newBlacklister",type:"address"},{internalType:"address",name:"newOwner",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"newName",type:"string"}],name:"initializeV2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"lostAndFound",type:"address"}],name:"initializeV2_1",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"accountsToBlacklist",type:"address[]"},{internalType:"string",name:"newSymbol",type:"string"}],name:"initializeV2_2",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"isBlacklisted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"}],name:"isMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"masterMinter",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_to",type:"address"},{internalType:"uint256",name:"_amount",type:"uint256"}],name:"mint",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"minterAllowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"pauser",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"receiveWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"minter",type:"address"}],name:"removeMinter",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract IERC20",name:"tokenContract",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"rescueERC20",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"rescuer",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"validAfter",type:"uint256"},{internalType:"uint256",name:"validBefore",type:"uint256"},{internalType:"bytes32",name:"nonce",type:"bytes32"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"transferWithAuthorization",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_account",type:"address"}],name:"unBlacklist",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"unpause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newBlacklister",type:"address"}],name:"updateBlacklister",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newMasterMinter",type:"address"}],name:"updateMasterMinter",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newPauser",type:"address"}],name:"updatePauser",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newRescuer",type:"address"}],name:"updateRescuer",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"version",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"pure",type:"function"}];a.s([],628110),a.i(628110),(DW=Ej||(Ej={})).assertEqual=a=>{},DW.assertIs=function(a){},DW.assertNever=function(a){throw Error()},DW.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},DW.getValidEnumValues=a=>{let b=DW.objectKeys(a).filter(b=>"number"!=typeof a[a[b]]),c={};for(let d of b)c[d]=a[d];return DW.objectValues(c)},DW.objectValues=a=>DW.objectKeys(a).map(function(b){return a[b]}),DW.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},DW.find=(a,b)=>{for(let c of a)if(b(c))return c},DW.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,DW.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},DW.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b,(Ek||(Ek={})).mergeShapes=(a,b)=>({...a,...b});let v8=Ej.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),v9=a=>{switch(typeof a){case"undefined":return v8.undefined;case"string":return v8.string;case"number":return Number.isNaN(a)?v8.nan:v8.number;case"boolean":return v8.boolean;case"function":return v8.function;case"bigint":return v8.bigint;case"symbol":return v8.symbol;case"object":if(Array.isArray(a))return v8.array;if(null===a)return v8.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return v8.promise;if("undefined"!=typeof Map&&a instanceof Map)return v8.map;if("undefined"!=typeof Set&&a instanceof Set)return v8.set;if("undefined"!=typeof Date&&a instanceof Date)return v8.date;return v8.object;default:return v8.unknown}};a.s(["ZodParsedType",0,v8,"getParsedType",0,v9,"objectUtil",()=>Ek,"util",()=>Ej],837948);let wa=Ej.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),wb=a=>JSON.stringify(a,null,2).replace(/"([^"]+)":/g,"$1:");class wc extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof wc))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ej.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)if(d.path.length>0){let c=d.path[0];b[c]=b[c]||[],b[c].push(a(d))}else c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}wc.create=a=>new wc(a),a.s(["ZodError",()=>wc,"ZodIssueCode",0,wa,"quotelessJson",0,wb],1335);let wd=(a,b)=>{let c;switch(a.code){case wa.invalid_type:c=a.received===v8.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case wa.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,Ej.jsonStringifyReplacer)}`;break;case wa.unrecognized_keys:c=`Unrecognized key(s) in object: ${Ej.joinValues(a.keys,", ")}`;break;case wa.invalid_union:c="Invalid input";break;case wa.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${Ej.joinValues(a.options)}`;break;case wa.invalid_enum_value:c=`Invalid enum value. Expected ${Ej.joinValues(a.options)}, received '${a.received}'`;break;case wa.invalid_arguments:c="Invalid function arguments";break;case wa.invalid_return_type:c="Invalid function return type";break;case wa.invalid_date:c="Invalid date";break;case wa.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:Ej.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case wa.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type||"bigint"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case wa.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case wa.custom:c="Invalid input";break;case wa.invalid_intersection_types:c="Intersection results could not be merged";break;case wa.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case wa.not_finite:c="Number must be finite";break;default:c=b.defaultError,Ej.assertNever(a)}return{message:c}},we=wd;function wf(a){we=a}function wg(){return we}a.s(["getErrorMap",()=>wg,"setErrorMap",()=>wf],885306),a.i(885306),a.s(["defaultErrorMap",0,wd,"getErrorMap",()=>wg,"setErrorMap",()=>wf],568438),a.i(568438);let wh=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}},wi=[];function wj(a,b){let c=we,d=wh({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,c,c===wd?void 0:wd].filter(a=>!!a)});a.common.issues.push(d)}class wk{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return wl;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return wk.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return wl;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}let wl=Object.freeze({status:"aborted"}),wm=a=>({status:"dirty",value:a}),wn=a=>({status:"valid",value:a}),wo=a=>"aborted"===a.status,wp=a=>"dirty"===a.status,wq=a=>"valid"===a.status,wr=a=>"undefined"!=typeof Promise&&a instanceof Promise;a.s(["DIRTY",0,wm,"EMPTY_PATH",0,wi,"INVALID",0,wl,"OK",0,wn,"ParseStatus",()=>wk,"addIssueToContext",()=>wj,"isAborted",0,wo,"isAsync",0,wr,"isDirty",0,wp,"isValid",0,wq,"makeIssue",0,wh],649437),a.i(649437),a.s([],145263),a.i(145263),a.i(837948),(DX=El||(El={})).errToObj=a=>"string"==typeof a?{message:a}:a||{},DX.toString=a=>"string"==typeof a?a:a?.message;class ws{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let wt=(a,b)=>{if(wq(b))return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new wc(a.common.issues);return this._error=b,this._error}}};function wu(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class wv{get description(){return this._def.description}_getType(a){return v9(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:v9(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new wk,ctx:{common:a.parent.common,data:a.data,parsedType:v9(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(wr(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:v9(a)},d=this._parseSync({data:a,path:c.path,parent:c});return wt(c,d)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:v9(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return wq(c)?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>wq(a)?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:v9(a)},d=this._parse({data:a,path:c.path,parent:c});return wt(c,await (wr(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),f=()=>d.addIssue({code:wa.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"undefined"!=typeof Promise&&e instanceof Promise?e.then(a=>!!a||(f(),!1)):!!e||(f(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new xf({schema:this,typeName:Em.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return xg.create(this,this._def)}nullable(){return xh.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return w$.create(this)}promise(){return xe.create(this,this._def)}or(a){return w0.create([this,a],this._def)}and(a){return w3.create(this,a,this._def)}transform(a){return new xf({...wu(this._def),schema:this,typeName:Em.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new xi({...wu(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:Em.ZodDefault})}brand(){return new xm({typeName:Em.ZodBranded,type:this,...wu(this._def)})}catch(a){return new xj({...wu(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:Em.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return xn.create(this,a)}readonly(){return xo.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let ww=/^c[^\s-]{8,}$/i,wx=/^[0-9a-z]+$/,wy=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wz=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,wA=/^[a-z0-9_-]{21}$/i,wB=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,wC=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wD=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,wF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,wG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,wH=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,wI=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,wJ=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,wK="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",wL=RegExp(`^${wK}$`);function wM(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}function wN(a){let b=`${wK}T${wM(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)}class wO extends wv{_parse(a){var b,c,d,e;let f;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==v8.string){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.string,received:b.parsedType}),wl}let h=new wk;for(let i of this._def.checks)if("min"===i.kind)a.data.length<i.value&&(wj(f=this._getOrReturnCtx(a,f),{code:wa.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("max"===i.kind)a.data.length>i.value&&(wj(f=this._getOrReturnCtx(a,f),{code:wa.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("length"===i.kind){let b=a.data.length>i.value,c=a.data.length<i.value;(b||c)&&(f=this._getOrReturnCtx(a,f),b?wj(f,{code:wa.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&wj(f,{code:wa.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),h.dirty())}else if("email"===i.kind)wD.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"email",code:wa.invalid_string,message:i.message}),h.dirty());else if("emoji"===i.kind)g||(g=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),g.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"emoji",code:wa.invalid_string,message:i.message}),h.dirty());else if("uuid"===i.kind)wz.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"uuid",code:wa.invalid_string,message:i.message}),h.dirty());else if("nanoid"===i.kind)wA.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"nanoid",code:wa.invalid_string,message:i.message}),h.dirty());else if("cuid"===i.kind)ww.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"cuid",code:wa.invalid_string,message:i.message}),h.dirty());else if("cuid2"===i.kind)wx.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"cuid2",code:wa.invalid_string,message:i.message}),h.dirty());else if("ulid"===i.kind)wy.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"ulid",code:wa.invalid_string,message:i.message}),h.dirty());else if("url"===i.kind)try{new URL(a.data)}catch{wj(f=this._getOrReturnCtx(a,f),{validation:"url",code:wa.invalid_string,message:i.message}),h.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"regex",code:wa.invalid_string,message:i.message}),h.dirty())):"trim"===i.kind?a.data=a.data.trim():"includes"===i.kind?a.data.includes(i.value,i.position)||(wj(f=this._getOrReturnCtx(a,f),{code:wa.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),h.dirty()):"toLowerCase"===i.kind?a.data=a.data.toLowerCase():"toUpperCase"===i.kind?a.data=a.data.toUpperCase():"startsWith"===i.kind?a.data.startsWith(i.value)||(wj(f=this._getOrReturnCtx(a,f),{code:wa.invalid_string,validation:{startsWith:i.value},message:i.message}),h.dirty()):"endsWith"===i.kind?a.data.endsWith(i.value)||(wj(f=this._getOrReturnCtx(a,f),{code:wa.invalid_string,validation:{endsWith:i.value},message:i.message}),h.dirty()):"datetime"===i.kind?wN(i).test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{code:wa.invalid_string,validation:"datetime",message:i.message}),h.dirty()):"date"===i.kind?wL.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{code:wa.invalid_string,validation:"date",message:i.message}),h.dirty()):"time"===i.kind?RegExp(`^${wM(i)}$`).test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{code:wa.invalid_string,validation:"time",message:i.message}),h.dirty()):"duration"===i.kind?wC.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"duration",code:wa.invalid_string,message:i.message}),h.dirty()):"ip"===i.kind?(b=a.data,!(("v4"===(c=i.version)||!c)&&wE.test(b)||("v6"===c||!c)&&wG.test(b))&&1&&(wj(f=this._getOrReturnCtx(a,f),{validation:"ip",code:wa.invalid_string,message:i.message}),h.dirty())):"jwt"===i.kind?!function(a,b){if(!wB.test(a))return!1;try{let[c]=a.split(".");if(!c)return!1;let d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,i.alg)&&(wj(f=this._getOrReturnCtx(a,f),{validation:"jwt",code:wa.invalid_string,message:i.message}),h.dirty()):"cidr"===i.kind?(d=a.data,!(("v4"===(e=i.version)||!e)&&wF.test(d)||("v6"===e||!e)&&wH.test(d))&&1&&(wj(f=this._getOrReturnCtx(a,f),{validation:"cidr",code:wa.invalid_string,message:i.message}),h.dirty())):"base64"===i.kind?wI.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"base64",code:wa.invalid_string,message:i.message}),h.dirty()):"base64url"===i.kind?wJ.test(a.data)||(wj(f=this._getOrReturnCtx(a,f),{validation:"base64url",code:wa.invalid_string,message:i.message}),h.dirty()):Ej.assertNever(i);return{status:h.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:wa.invalid_string,...El.errToObj(c)})}_addCheck(a){return new wO({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...El.errToObj(a)})}url(a){return this._addCheck({kind:"url",...El.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...El.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...El.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...El.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...El.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...El.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...El.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...El.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...El.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...El.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...El.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...El.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...El.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...El.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...El.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...El.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...El.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...El.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...El.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...El.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...El.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...El.errToObj(b)})}nonempty(a){return this.min(1,El.errToObj(a))}trim(){return new wO({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new wO({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new wO({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}wO.create=a=>new wO({checks:[],typeName:Em.ZodString,coerce:a?.coerce??!1,...wu(a)});class wP extends wv{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==v8.number){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.number,received:b.parsedType}),wl}let c=new wk;for(let d of this._def.checks)"int"===d.kind?Ej.isInteger(a.data)||(wj(b=this._getOrReturnCtx(a,b),{code:wa.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"multipleOf"===d.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,d.value)&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):"finite"===d.kind?Number.isFinite(a.data)||(wj(b=this._getOrReturnCtx(a,b),{code:wa.not_finite,message:d.message}),c.dirty()):Ej.assertNever(d);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,El.toString(b))}gt(a,b){return this.setLimit("min",a,!1,El.toString(b))}lte(a,b){return this.setLimit("max",a,!0,El.toString(b))}lt(a,b){return this.setLimit("max",a,!1,El.toString(b))}setLimit(a,b,c,d){return new wP({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:El.toString(d)}]})}_addCheck(a){return new wP({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:El.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:El.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:El.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:El.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:El.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:El.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:El.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:El.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:El.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&Ej.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}wP.create=a=>new wP({checks:[],typeName:Em.ZodNumber,coerce:a?.coerce||!1,...wu(a)});class wQ extends wv{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==v8.bigint)return this._getInvalidInput(a);let c=new wk;for(let d of this._def.checks)"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"multipleOf"===d.kind?a.data%d.value!==BigInt(0)&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):Ej.assertNever(d);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.bigint,received:b.parsedType}),wl}gte(a,b){return this.setLimit("min",a,!0,El.toString(b))}gt(a,b){return this.setLimit("min",a,!1,El.toString(b))}lte(a,b){return this.setLimit("max",a,!0,El.toString(b))}lt(a,b){return this.setLimit("max",a,!1,El.toString(b))}setLimit(a,b,c,d){return new wQ({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:El.toString(d)}]})}_addCheck(a){return new wQ({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:El.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:El.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:El.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:El.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:El.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}wQ.create=a=>new wQ({checks:[],typeName:Em.ZodBigInt,coerce:a?.coerce??!1,...wu(a)});class wR extends wv{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==v8.boolean){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.boolean,received:b.parsedType}),wl}return wn(a.data)}}wR.create=a=>new wR({typeName:Em.ZodBoolean,coerce:a?.coerce||!1,...wu(a)});class wS extends wv{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==v8.date){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.date,received:b.parsedType}),wl}if(Number.isNaN(a.data.getTime()))return wj(this._getOrReturnCtx(a),{code:wa.invalid_date}),wl;let c=new wk;for(let d of this._def.checks)"min"===d.kind?a.data.getTime()<d.value&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),c.dirty()):"max"===d.kind?a.data.getTime()>d.value&&(wj(b=this._getOrReturnCtx(a,b),{code:wa.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),c.dirty()):Ej.assertNever(d);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(a){return new wS({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:El.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:El.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}wS.create=a=>new wS({checks:[],coerce:a?.coerce||!1,typeName:Em.ZodDate,...wu(a)});class wT extends wv{_parse(a){if(this._getType(a)!==v8.symbol){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.symbol,received:b.parsedType}),wl}return wn(a.data)}}wT.create=a=>new wT({typeName:Em.ZodSymbol,...wu(a)});class wU extends wv{_parse(a){if(this._getType(a)!==v8.undefined){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.undefined,received:b.parsedType}),wl}return wn(a.data)}}wU.create=a=>new wU({typeName:Em.ZodUndefined,...wu(a)});class wV extends wv{_parse(a){if(this._getType(a)!==v8.null){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.null,received:b.parsedType}),wl}return wn(a.data)}}wV.create=a=>new wV({typeName:Em.ZodNull,...wu(a)});class wW extends wv{constructor(){super(...arguments),this._any=!0}_parse(a){return wn(a.data)}}wW.create=a=>new wW({typeName:Em.ZodAny,...wu(a)});class wX extends wv{constructor(){super(...arguments),this._unknown=!0}_parse(a){return wn(a.data)}}wX.create=a=>new wX({typeName:Em.ZodUnknown,...wu(a)});class wY extends wv{_parse(a){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.never,received:b.parsedType}),wl}}wY.create=a=>new wY({typeName:Em.ZodNever,...wu(a)});class wZ extends wv{_parse(a){if(this._getType(a)!==v8.undefined){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.void,received:b.parsedType}),wl}return wn(a.data)}}wZ.create=a=>new wZ({typeName:Em.ZodVoid,...wu(a)});class w$ extends wv{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),d=this._def;if(b.parsedType!==v8.array)return wj(b,{code:wa.invalid_type,expected:v8.array,received:b.parsedType}),wl;if(null!==d.exactLength){let a=b.data.length>d.exactLength.value,e=b.data.length<d.exactLength.value;(a||e)&&(wj(b,{code:a?wa.too_big:wa.too_small,minimum:e?d.exactLength.value:void 0,maximum:a?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),c.dirty())}if(null!==d.minLength&&b.data.length<d.minLength.value&&(wj(b,{code:wa.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),c.dirty()),null!==d.maxLength&&b.data.length>d.maxLength.value&&(wj(b,{code:wa.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>d.type._parseAsync(new ws(b,a,b.path,c)))).then(a=>wk.mergeArray(c,a));let e=[...b.data].map((a,c)=>d.type._parseSync(new ws(b,a,b.path,c)));return wk.mergeArray(c,e)}get element(){return this._def.type}min(a,b){return new w$({...this._def,minLength:{value:a,message:El.toString(b)}})}max(a,b){return new w$({...this._def,maxLength:{value:a,message:El.toString(b)}})}length(a,b){return new w$({...this._def,exactLength:{value:a,message:El.toString(b)}})}nonempty(a){return this.min(1,a)}}w$.create=(a,b)=>new w$({type:a,minLength:null,maxLength:null,exactLength:null,typeName:Em.ZodArray,...wu(b)});class w_ extends wv{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=Ej.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==v8.object){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.object,received:b.parsedType}),wl}let{status:b,ctx:c}=this._processInputParams(a),{shape:d,keys:e}=this._getCached(),f=[];if(!(this._def.catchall instanceof wY&&"strip"===this._def.unknownKeys))for(let a in c.data)e.includes(a)||f.push(a);let g=[];for(let a of e){let b=d[a],e=c.data[a];g.push({key:{status:"valid",value:a},value:b._parse(new ws(c,e,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof wY){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of f)g.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)f.length>0&&(wj(c,{code:wa.unrecognized_keys,keys:f}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of f){let d=c.data[b];g.push({key:{status:"valid",value:b},value:a._parse(new ws(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of g){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>wk.mergeObjectSync(b,a)):wk.mergeObjectSync(b,g)}get shape(){return this._def.shape()}strict(a){return El.errToObj,new w_({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:El.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new w_({...this._def,unknownKeys:"strip"})}passthrough(){return new w_({...this._def,unknownKeys:"passthrough"})}extend(a){return new w_({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new w_({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:Em.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new w_({...this._def,catchall:a})}pick(a){let b={};for(let c of Ej.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new w_({...this._def,shape:()=>b})}omit(a){let b={};for(let c of Ej.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new w_({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof w_){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=xg.create(a(e))}return new w_({...b._def,shape:()=>c})}if(b instanceof w$)return new w$({...b._def,type:a(b.element)});if(b instanceof xg)return xg.create(a(b.unwrap()));if(b instanceof xh)return xh.create(a(b.unwrap()));if(b instanceof w4)return w4.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of Ej.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new w_({...this._def,shape:()=>b})}required(a){let b={};for(let c of Ej.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof xg;)a=a._def.innerType;b[c]=a}return new w_({...this._def,shape:()=>b})}keyof(){return xb(Ej.objectKeys(this.shape))}}w_.create=(a,b)=>new w_({shape:()=>a,unknownKeys:"strip",catchall:wY.create(),typeName:Em.ZodObject,...wu(b)}),w_.strictCreate=(a,b)=>new w_({shape:()=>a,unknownKeys:"strict",catchall:wY.create(),typeName:Em.ZodObject,...wu(b)}),w_.lazycreate=(a,b)=>new w_({shape:a,unknownKeys:"strip",catchall:wY.create(),typeName:Em.ZodObject,...wu(b)});class w0 extends wv{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new wc(a.ctx.common.issues));return wj(b,{code:wa.invalid_union,unionErrors:c}),wl});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new wc(a));return wj(b,{code:wa.invalid_union,unionErrors:e}),wl}}get options(){return this._def.options}}w0.create=(a,b)=>new w0({options:a,typeName:Em.ZodUnion,...wu(b)});let w1=a=>{if(a instanceof w9)return w1(a.schema);if(a instanceof xf)return w1(a.innerType());if(a instanceof xa)return[a.value];if(a instanceof xc)return a.options;if(a instanceof xd)return Ej.objectValues(a.enum);else if(a instanceof xi)return w1(a._def.innerType);else if(a instanceof wU)return[void 0];else if(a instanceof wV)return[null];else if(a instanceof xg)return[void 0,...w1(a.unwrap())];else if(a instanceof xh)return[null,...w1(a.unwrap())];else if(a instanceof xm)return w1(a.unwrap());else if(a instanceof xo)return w1(a.unwrap());else if(a instanceof xj)return w1(a._def.innerType);else return[]};class w2 extends wv{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==v8.object)return wj(b,{code:wa.invalid_type,expected:v8.object,received:b.parsedType}),wl;let c=this.discriminator,d=b.data[c],e=this.optionsMap.get(d);return e?b.common.async?e._parseAsync({data:b.data,path:b.path,parent:b}):e._parseSync({data:b.data,path:b.path,parent:b}):(wj(b,{code:wa.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),wl)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=w1(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new w2({typeName:Em.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...wu(c)})}}class w3 extends wv{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=(a,d)=>{if(wo(a)||wo(d))return wl;let e=function a(b,c){let d=v9(b),e=v9(c);if(b===c)return{valid:!0,data:b};if(d===v8.object&&e===v8.object){let d=Ej.objectKeys(c),e=Ej.objectKeys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};f[d]=e.data}return{valid:!0,data:f}}if(d===v8.array&&e===v8.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(d===v8.date&&e===v8.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,d.value);return e.valid?((wp(a)||wp(d))&&b.dirty(),{status:b.value,value:e.data}):(wj(c,{code:wa.invalid_intersection_types}),wl)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>d(a,b)):d(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}w3.create=(a,b,c)=>new w3({left:a,right:b,typeName:Em.ZodIntersection,...wu(c)});class w4 extends wv{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==v8.array)return wj(c,{code:wa.invalid_type,expected:v8.array,received:c.parsedType}),wl;if(c.data.length<this._def.items.length)return wj(c,{code:wa.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),wl;!this._def.rest&&c.data.length>this._def.items.length&&(wj(c,{code:wa.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let d=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new ws(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(d).then(a=>wk.mergeArray(b,a)):wk.mergeArray(b,d)}get items(){return this._def.items}rest(a){return new w4({...this._def,rest:a})}}w4.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new w4({items:a,typeName:Em.ZodTuple,rest:null,...wu(b)})};class w5 extends wv{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==v8.object)return wj(c,{code:wa.invalid_type,expected:v8.object,received:c.parsedType}),wl;let d=[],e=this._def.keyType,f=this._def.valueType;for(let a in c.data)d.push({key:e._parse(new ws(c,a,c.path,a)),value:f._parse(new ws(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?wk.mergeObjectAsync(b,d):wk.mergeObjectSync(b,d)}get element(){return this._def.valueType}static create(a,b,c){return new w5(b instanceof wv?{keyType:a,valueType:b,typeName:Em.ZodRecord,...wu(c)}:{keyType:wO.create(),valueType:a,typeName:Em.ZodRecord,...wu(b)})}}class w6 extends wv{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==v8.map)return wj(c,{code:wa.invalid_type,expected:v8.map,received:c.parsedType}),wl;let d=this._def.keyType,e=this._def.valueType,f=[...c.data.entries()].map(([a,b],f)=>({key:d._parse(new ws(c,a,c.path,[f,"key"])),value:e._parse(new ws(c,b,c.path,[f,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of f){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return wl;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of f){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return wl;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}w6.create=(a,b,c)=>new w6({valueType:b,keyType:a,typeName:Em.ZodMap,...wu(c)});class w7 extends wv{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==v8.set)return wj(c,{code:wa.invalid_type,expected:v8.set,received:c.parsedType}),wl;let d=this._def;null!==d.minSize&&c.data.size<d.minSize.value&&(wj(c,{code:wa.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),b.dirty()),null!==d.maxSize&&c.data.size>d.maxSize.value&&(wj(c,{code:wa.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),b.dirty());let e=this._def.valueType;function f(a){let c=new Set;for(let d of a){if("aborted"===d.status)return wl;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let g=[...c.data.values()].map((a,b)=>e._parse(new ws(c,a,c.path,b)));return c.common.async?Promise.all(g).then(a=>f(a)):f(g)}min(a,b){return new w7({...this._def,minSize:{value:a,message:El.toString(b)}})}max(a,b){return new w7({...this._def,maxSize:{value:a,message:El.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}w7.create=(a,b)=>new w7({valueType:a,minSize:null,maxSize:null,typeName:Em.ZodSet,...wu(b)});class w8 extends wv{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==v8.function)return wj(b,{code:wa.invalid_type,expected:v8.function,received:b.parsedType}),wl;function c(a,c){return wh({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,we,wd].filter(a=>!!a),issueData:{code:wa.invalid_arguments,argumentsError:c}})}function d(a,c){return wh({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,we,wd].filter(a=>!!a),issueData:{code:wa.invalid_return_type,returnTypeError:c}})}let e={errorMap:b.common.contextualErrorMap},f=b.data;if(this._def.returns instanceof xe){let a=this;return wn(async function(...b){let g=new wc([]),h=await a._def.args.parseAsync(b,e).catch(a=>{throw g.addIssue(c(b,a)),g}),i=await Reflect.apply(f,this,h);return await a._def.returns._def.type.parseAsync(i,e).catch(a=>{throw g.addIssue(d(i,a)),g})})}{let a=this;return wn(function(...b){let g=a._def.args.safeParse(b,e);if(!g.success)throw new wc([c(b,g.error)]);let h=Reflect.apply(f,this,g.data),i=a._def.returns.safeParse(h,e);if(!i.success)throw new wc([d(h,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new w8({...this._def,args:w4.create(a).rest(wX.create())})}returns(a){return new w8({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new w8({args:a||w4.create([]).rest(wX.create()),returns:b||wX.create(),typeName:Em.ZodFunction,...wu(c)})}}class w9 extends wv{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}w9.create=(a,b)=>new w9({getter:a,typeName:Em.ZodLazy,...wu(b)});class xa extends wv{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return wj(b,{received:b.data,code:wa.invalid_literal,expected:this._def.value}),wl}return{status:"valid",value:a.data}}get value(){return this._def.value}}function xb(a,b){return new xc({values:a,typeName:Em.ZodEnum,...wu(b)})}xa.create=(a,b)=>new xa({value:a,typeName:Em.ZodLiteral,...wu(b)});class xc extends wv{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return wj(b,{expected:Ej.joinValues(c),received:b.parsedType,code:wa.invalid_type}),wl}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return wj(b,{received:b.data,code:wa.invalid_enum_value,options:c}),wl}return wn(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return xc.create(a,{...this._def,...b})}exclude(a,b=this._def){return xc.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}xc.create=xb;class xd extends wv{_parse(a){let b=Ej.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==v8.string&&c.parsedType!==v8.number){let a=Ej.objectValues(b);return wj(c,{expected:Ej.joinValues(a),received:c.parsedType,code:wa.invalid_type}),wl}if(this._cache||(this._cache=new Set(Ej.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=Ej.objectValues(b);return wj(c,{received:c.data,code:wa.invalid_enum_value,options:a}),wl}return wn(a.data)}get enum(){return this._def.values}}xd.create=(a,b)=>new xd({values:a,typeName:Em.ZodNativeEnum,...wu(b)});class xe extends wv{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==v8.promise&&!1===b.common.async?(wj(b,{code:wa.invalid_type,expected:v8.promise,received:b.parsedType}),wl):wn((b.parsedType===v8.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}xe.create=(a,b)=>new xe({type:a,typeName:Em.ZodPromise,...wu(b)});class xf extends wv{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Em.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,e={addIssue:a=>{wj(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(e.addIssue=e.addIssue.bind(e),"preprocess"===d.type){let a=d.transform(c.data,e);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return wl;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?wl:"dirty"===d.status||"dirty"===b.value?wm(d.value):d});{if("aborted"===b.value)return wl;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?wl:"dirty"===d.status||"dirty"===b.value?wm(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,e);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?wl:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?wl:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>wq(a)?Promise.resolve(d.transform(a.value,e)).then(a=>({status:b.value,value:a})):wl);else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if(!wq(a))return wl;let f=d.transform(a.value,e);if(f instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:f}}Ej.assertNever(d)}}xf.create=(a,b,c)=>new xf({schema:a,typeName:Em.ZodEffects,effect:b,...wu(c)}),xf.createWithPreprocess=(a,b,c)=>new xf({schema:b,effect:{type:"preprocess",transform:a},typeName:Em.ZodEffects,...wu(c)});class xg extends wv{_parse(a){return this._getType(a)===v8.undefined?wn(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}xg.create=(a,b)=>new xg({innerType:a,typeName:Em.ZodOptional,...wu(b)});class xh extends wv{_parse(a){return this._getType(a)===v8.null?wn(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}xh.create=(a,b)=>new xh({innerType:a,typeName:Em.ZodNullable,...wu(b)});class xi extends wv{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===v8.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}xi.create=(a,b)=>new xi({innerType:a,typeName:Em.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...wu(b)});class xj extends wv{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return wr(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new wc(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new wc(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}xj.create=(a,b)=>new xj({innerType:a,typeName:Em.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...wu(b)});class xk extends wv{_parse(a){if(this._getType(a)!==v8.nan){let b=this._getOrReturnCtx(a);return wj(b,{code:wa.invalid_type,expected:v8.nan,received:b.parsedType}),wl}return{status:"valid",value:a.data}}}xk.create=a=>new xk({typeName:Em.ZodNaN,...wu(a)});let xl=Symbol("zod_brand");class xm extends wv{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class xn extends wv{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?wl:"dirty"===a.status?(b.dirty(),wm(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?wl:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new xn({in:a,out:b,typeName:Em.ZodPipeline})}}class xo extends wv{_parse(a){let b=this._def.innerType._parse(a),c=a=>(wq(a)&&(a.value=Object.freeze(a.value)),a);return wr(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function xp(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function xq(a,b={},c){return a?wW.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=xp(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=xp(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):wW.create()}xo.create=(a,b)=>new xo({innerType:a,typeName:Em.ZodReadonly,...wu(b)});let xr={object:w_.lazycreate};(DY=Em||(Em={})).ZodString="ZodString",DY.ZodNumber="ZodNumber",DY.ZodNaN="ZodNaN",DY.ZodBigInt="ZodBigInt",DY.ZodBoolean="ZodBoolean",DY.ZodDate="ZodDate",DY.ZodSymbol="ZodSymbol",DY.ZodUndefined="ZodUndefined",DY.ZodNull="ZodNull",DY.ZodAny="ZodAny",DY.ZodUnknown="ZodUnknown",DY.ZodNever="ZodNever",DY.ZodVoid="ZodVoid",DY.ZodArray="ZodArray",DY.ZodObject="ZodObject",DY.ZodUnion="ZodUnion",DY.ZodDiscriminatedUnion="ZodDiscriminatedUnion",DY.ZodIntersection="ZodIntersection",DY.ZodTuple="ZodTuple",DY.ZodRecord="ZodRecord",DY.ZodMap="ZodMap",DY.ZodSet="ZodSet",DY.ZodFunction="ZodFunction",DY.ZodLazy="ZodLazy",DY.ZodLiteral="ZodLiteral",DY.ZodEnum="ZodEnum",DY.ZodEffects="ZodEffects",DY.ZodNativeEnum="ZodNativeEnum",DY.ZodOptional="ZodOptional",DY.ZodNullable="ZodNullable",DY.ZodDefault="ZodDefault",DY.ZodCatch="ZodCatch",DY.ZodPromise="ZodPromise",DY.ZodBranded="ZodBranded",DY.ZodPipeline="ZodPipeline",DY.ZodReadonly="ZodReadonly";let xs=(a,b={message:`Input not instance of ${a.name}`})=>xq(b=>b instanceof a,b),xt=wO.create,xu=wP.create,xv=xk.create,xw=wQ.create,xx=wR.create,xy=wS.create,xz=wT.create,xA=wU.create,xB=wV.create,xC=wW.create,xD=wX.create,xE=wY.create,xF=wZ.create,xG=w$.create,xH=w_.create,xI=w_.strictCreate,xJ=w0.create,xK=w2.create,xL=w3.create,xM=w4.create,xN=w5.create,xO=w6.create,xP=w7.create,xQ=w8.create,xR=w9.create,xS=xa.create,xT=xc.create,xU=xd.create,xV=xe.create,xW=xf.create,xX=xg.create,xY=xh.create,xZ=xf.createWithPreprocess,x$=xn.create,x_=()=>xt().optional(),x0=()=>xu().optional(),x1=()=>xx().optional(),x2={string:a=>wO.create({...a,coerce:!0}),number:a=>wP.create({...a,coerce:!0}),boolean:a=>wR.create({...a,coerce:!0}),bigint:a=>wQ.create({...a,coerce:!0}),date:a=>wS.create({...a,coerce:!0})};a.s(["BRAND",0,xl,"NEVER",0,wl,"Schema",()=>wv,"ZodAny",()=>wW,"ZodArray",()=>w$,"ZodBigInt",()=>wQ,"ZodBoolean",()=>wR,"ZodBranded",()=>xm,"ZodCatch",()=>xj,"ZodDate",()=>wS,"ZodDefault",()=>xi,"ZodDiscriminatedUnion",()=>w2,"ZodEffects",()=>xf,"ZodEnum",()=>xc,"ZodFirstPartyTypeKind",()=>Em,"ZodFunction",()=>w8,"ZodIntersection",()=>w3,"ZodLazy",()=>w9,"ZodLiteral",()=>xa,"ZodMap",()=>w6,"ZodNaN",()=>xk,"ZodNativeEnum",()=>xd,"ZodNever",()=>wY,"ZodNull",()=>wV,"ZodNullable",()=>xh,"ZodNumber",()=>wP,"ZodObject",()=>w_,"ZodOptional",()=>xg,"ZodPipeline",()=>xn,"ZodPromise",()=>xe,"ZodReadonly",()=>xo,"ZodRecord",()=>w5,"ZodSchema",()=>wv,"ZodSet",()=>w7,"ZodString",()=>wO,"ZodSymbol",()=>wT,"ZodTransformer",()=>xf,"ZodTuple",()=>w4,"ZodType",()=>wv,"ZodUndefined",()=>wU,"ZodUnion",()=>w0,"ZodUnknown",()=>wX,"ZodVoid",()=>wZ,"any",()=>xC,"array",()=>xG,"bigint",()=>xw,"boolean",()=>xx,"coerce",0,x2,"custom",()=>xq,"date",()=>xy,"datetimeRegex",()=>wN,"discriminatedUnion",()=>xK,"effect",()=>xW,"enum",()=>xT,"function",()=>xQ,"instanceof",()=>xs,"intersection",()=>xL,"late",0,xr,"lazy",()=>xR,"literal",()=>xS,"map",()=>xO,"nan",()=>xv,"nativeEnum",()=>xU,"never",()=>xE,"null",()=>xB,"nullable",()=>xY,"number",()=>xu,"object",()=>xH,"oboolean",()=>x1,"onumber",()=>x0,"optional",()=>xX,"ostring",()=>x_,"pipeline",()=>x$,"preprocess",()=>xZ,"promise",()=>xV,"record",()=>xN,"set",()=>xP,"strictObject",()=>xI,"string",()=>xt,"symbol",()=>xz,"transformer",()=>xW,"tuple",()=>xM,"undefined",()=>xA,"union",()=>xJ,"unknown",()=>xD,"void",()=>xF],944160),a.i(944160),a.i(1335),a.s(["BRAND",0,xl,"DIRTY",0,wm,"EMPTY_PATH",0,wi,"INVALID",0,wl,"NEVER",0,wl,"OK",0,wn,"ParseStatus",()=>wk,"Schema",()=>wv,"ZodAny",()=>wW,"ZodArray",()=>w$,"ZodBigInt",()=>wQ,"ZodBoolean",()=>wR,"ZodBranded",()=>xm,"ZodCatch",()=>xj,"ZodDate",()=>wS,"ZodDefault",()=>xi,"ZodDiscriminatedUnion",()=>w2,"ZodEffects",()=>xf,"ZodEnum",()=>xc,"ZodError",()=>wc,"ZodFirstPartyTypeKind",()=>Em,"ZodFunction",()=>w8,"ZodIntersection",()=>w3,"ZodIssueCode",0,wa,"ZodLazy",()=>w9,"ZodLiteral",()=>xa,"ZodMap",()=>w6,"ZodNaN",()=>xk,"ZodNativeEnum",()=>xd,"ZodNever",()=>wY,"ZodNull",()=>wV,"ZodNullable",()=>xh,"ZodNumber",()=>wP,"ZodObject",()=>w_,"ZodOptional",()=>xg,"ZodParsedType",0,v8,"ZodPipeline",()=>xn,"ZodPromise",()=>xe,"ZodReadonly",()=>xo,"ZodRecord",()=>w5,"ZodSchema",()=>wv,"ZodSet",()=>w7,"ZodString",()=>wO,"ZodSymbol",()=>wT,"ZodTransformer",()=>xf,"ZodTuple",()=>w4,"ZodType",()=>wv,"ZodUndefined",()=>wU,"ZodUnion",()=>w0,"ZodUnknown",()=>wX,"ZodVoid",()=>wZ,"addIssueToContext",()=>wj,"any",()=>xC,"array",()=>xG,"bigint",()=>xw,"boolean",()=>xx,"coerce",0,x2,"custom",()=>xq,"date",()=>xy,"datetimeRegex",()=>wN,"defaultErrorMap",0,wd,"discriminatedUnion",()=>xK,"effect",()=>xW,"enum",()=>xT,"function",()=>xQ,"getErrorMap",()=>wg,"getParsedType",0,v9,"instanceof",()=>xs,"intersection",()=>xL,"isAborted",0,wo,"isAsync",0,wr,"isDirty",0,wp,"isValid",0,wq,"late",0,xr,"lazy",()=>xR,"literal",()=>xS,"makeIssue",0,wh,"map",()=>xO,"nan",()=>xv,"nativeEnum",()=>xU,"never",()=>xE,"null",()=>xB,"nullable",()=>xY,"number",()=>xu,"object",()=>xH,"objectUtil",()=>Ek,"oboolean",()=>x1,"onumber",()=>x0,"optional",()=>xX,"ostring",()=>x_,"pipeline",()=>x$,"preprocess",()=>xZ,"promise",()=>xV,"quotelessJson",0,wb,"record",()=>xN,"set",()=>xP,"setErrorMap",()=>wf,"strictObject",()=>xI,"string",()=>xt,"symbol",()=>xz,"transformer",()=>xW,"tuple",()=>xM,"undefined",()=>xA,"union",()=>xJ,"unknown",()=>xD,"util",()=>Ej,"void",()=>xF],553093);var x3=a.i(553093),x3=x3,x4=a.i(308493),x5=a.i(740658),x6=a.i(123240),x7=a.i(603510);let x8=(0,x7.defineChain)({id:43113,name:"Avalanche Fuji",nativeCurrency:{decimals:18,name:"Avalanche Fuji",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax-test.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://testnet.snowtrace.io",apiUrl:"https://api-testnet.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:7096959}},testnet:!0});var x9=a.i(958199);let ya=(0,x7.defineChain)({...x9.chainConfig,id:8453,name:"Base",nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},rpcUrls:{default:{http:["https://mainnet.base.org"]}},blockExplorers:{default:{name:"Basescan",url:"https://basescan.org",apiUrl:"https://api.basescan.org/api"}},contracts:{...x9.chainConfig.contracts,disputeGameFactory:{1:{address:"0x43edB88C4B80fDD2AdFF2412A7BebF9dF42cB40e"}},l2OutputOracle:{1:{address:"0x56315b90c40730925ec5485cf004d835058518A0"}},multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:5022},portal:{1:{address:"0x49048044D57e1C92A77f79988d21Fa8fAF74E97e",blockCreated:0x10ac19f}},l1StandardBridge:{1:{address:"0x3154Cf16ccdb4C6d922629664174b904d80F2C35",blockCreated:0x10ac19f}}},sourceId:1});({...ya,experimental_preconfirmationTime:200,rpcUrls:{default:{http:["https://mainnet-preconf.base.org"]}}});let yb=(0,x7.defineChain)({id:1329,name:"Sei Network",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc.sei-apis.com/"],webSocket:["wss://evm-ws.sei-apis.com/"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com",apiUrl:"https://seitrace.com/pacific-1/api"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11"}}}),yc=(0,x7.defineChain)({id:1328,name:"Sei Testnet",nativeCurrency:{name:"Sei",symbol:"SEI",decimals:18},rpcUrls:{default:{http:["https://evm-rpc-testnet.sei-apis.com"],webSocket:["wss://evm-ws-testnet.sei-apis.com"]}},blockExplorers:{default:{name:"Seitrace",url:"https://seitrace.com"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x5e201b3}},testnet:!0}),yd=(0,x7.defineChain)({id:137,name:"Polygon",blockTime:2e3,nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://polygon-rpc.com"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0x18938b0}}}),ye=(0,x7.defineChain)({id:80002,name:"Polygon Amoy",nativeCurrency:{name:"POL",symbol:"POL",decimals:18},rpcUrls:{default:{http:["https://rpc-amoy.polygon.technology"]}},blockExplorers:{default:{name:"PolygonScan",url:"https://amoy.polygonscan.com",apiUrl:"https://api.etherscan.io/v2/api"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3127388}},testnet:!0}),yf=(0,x7.defineChain)({id:3338,name:"Peaq",nativeCurrency:{decimals:18,name:"peaq",symbol:"PEAQ"},rpcUrls:{default:{http:["https://quicknode1.peaq.xyz","https://quicknode2.peaq.xyz","https://quicknode3.peaq.xyz"],webSocket:["wss://quicknode1.peaq.xyz","wss://quicknode2.peaq.xyz","wss://quicknode3.peaq.xyz"]}},blockExplorers:{default:{name:"Subscan",url:"https://peaq.subscan.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:3566354}}}),yg=(0,x7.defineChain)({id:43114,name:"Avalanche",blockTime:1700,nativeCurrency:{decimals:18,name:"Avalanche",symbol:"AVAX"},rpcUrls:{default:{http:["https://api.avax.network/ext/bc/C/rpc"]}},blockExplorers:{default:{name:"SnowTrace",url:"https://snowtrace.io",apiUrl:"https://api.snowtrace.io"}},contracts:{multicall3:{address:"0xca11bde05977b3631167028862be2a173976ca11",blockCreated:0xb5b35e}}}),yh=(0,x7.defineChain)({id:4690,name:"IoTeX Testnet",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.testnet.iotex.io"],webSocket:["wss://babel-api.testnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://testnet.iotexscan.io"}},contracts:{multicall3:{address:"0xb5cecD6894c6f473Ec726A176f1512399A2e355d",blockCreated:0x17383c8}},testnet:!0}),yi=(0,x7.defineChain)({id:4689,name:"IoTeX",nativeCurrency:{decimals:18,name:"IoTeX",symbol:"IOTX"},rpcUrls:{default:{http:["https://babel-api.mainnet.iotex.io"],webSocket:["wss://babel-api.mainnet.iotex.io"]}},blockExplorers:{default:{name:"IoTeXScan",url:"https://iotexscan.io"}},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:0x15230d6}}});var yj=a.i(769648),yk=a.i(837159),yl=a.i(505864),ym=a.i(533676),yn=a.i(793757),yo=a.i(42736),yp=a.i(143151);let yq=32n*a.i(479494).maxUint16,yr={block:(0,yl.defineBlock)({format(a){let b=a.transactions?.map(a=>{if("string"==typeof a)return a;let b=yr.transaction?.format(a);return"0x71"===b.typeHex?b.type="eip712":"0xff"===b.typeHex&&(b.type="priority"),b});return{l1BatchNumber:a.l1BatchNumber?(0,yj.hexToBigInt)(a.l1BatchNumber):null,l1BatchTimestamp:a.l1BatchTimestamp?(0,yj.hexToBigInt)(a.l1BatchTimestamp):null,transactions:b}}}),transaction:(0,yn.defineTransaction)({format(a){let b={};return"0x71"===a.type?b.type="eip712":"0xff"===a.type&&(b.type="priority"),{...b,l1BatchNumber:a.l1BatchNumber?(0,yj.hexToBigInt)(a.l1BatchNumber):null,l1BatchTxIndex:a.l1BatchTxIndex?(0,yj.hexToBigInt)(a.l1BatchTxIndex):null}}}),transactionReceipt:(0,yo.defineTransactionReceipt)({format:a=>({l1BatchNumber:a.l1BatchNumber?(0,yj.hexToBigInt)(a.l1BatchNumber):null,l1BatchTxIndex:a.l1BatchTxIndex?(0,yj.hexToBigInt)(a.l1BatchTxIndex):null,logs:a.logs.map(a=>({...(0,ym.formatLog)(a),l1BatchNumber:a.l1BatchNumber?(0,yj.hexToBigInt)(a.l1BatchNumber):null,transactionLogIndex:(0,yj.hexToNumber)(a.transactionLogIndex),logType:a.logType})),l2ToL1Logs:a.l2ToL1Logs.map(a=>({blockNumber:(0,yj.hexToBigInt)(a.blockHash),blockHash:a.blockHash,l1BatchNumber:a.l1BatchNumber?(0,yj.hexToBigInt)(a.l1BatchNumber):null,transactionIndex:(0,yj.hexToBigInt)(a.transactionIndex),shardId:(0,yj.hexToBigInt)(a.shardId),isService:a.isService,sender:a.sender,key:a.key,value:a.value,transactionHash:a.transactionHash,logIndex:(0,yj.hexToBigInt)(a.logIndex)}))})}),transactionRequest:(0,yp.defineTransactionRequest)({exclude:["customSignature","factoryDeps","gasPerPubdata","paymaster","paymasterInput"],format:a=>a.gasPerPubdata||a.paymaster&&a.paymasterInput||a.factoryDeps||a.customSignature?{eip712Meta:{...a.gasPerPubdata?{gasPerPubdata:(0,eJ.toHex)(a.gasPerPubdata)}:{gasPerPubdata:(0,eJ.toHex)(50000n)},...a.paymaster&&a.paymasterInput?{paymasterParams:{paymaster:a.paymaster,paymasterInput:Array.from((0,yk.hexToBytes)(a.paymasterInput))}}:{},...a.factoryDeps?{factoryDeps:a.factoryDeps.map(a=>Array.from((0,yk.hexToBytes)(a)))}:{},...a.customSignature?{customSignature:Array.from((0,yk.hexToBytes)(a.customSignature))}:{}},type:"0x71"}:{}})};var ys=a.i(976627),yt=a.i(442006),yu=a.i(150316),yv=a.i(92078),yw=a.i(45001),yx=a.i(82235),yy=yw;class yz extends yy.BaseError{constructor(){super('Transaction is not an EIP712 transaction.\n\nTransaction must:\n  - include `type: "eip712"`\n  - include one of the following: `customSignature`, `paymaster`, `paymasterInput`, `gasPerPubdata`, `factoryDeps`',{name:"InvalidEip712TransactionError"})}}function yA(a){return"eip712"===a.type||"customSignature"in a&&!!a.customSignature||"paymaster"in a&&!!a.paymaster||"paymasterInput"in a&&!!a.paymasterInput||"gasPerPubdata"in a&&"bigint"==typeof a.gasPerPubdata||"factoryDeps"in a&&!!a.factoryDeps||!1}function yB(a){let{chainId:b,to:c,from:d,paymaster:e,paymasterInput:f}=a;if(!yA(a))throw new yz;if(!b||b<=0)throw new yx.InvalidChainIdError({chainId:b});if(c&&!(0,eK.isAddress)(c))throw new yv.InvalidAddressError({address:c});if(d&&!(0,eK.isAddress)(d))throw new yv.InvalidAddressError({address:d});if(e&&!(0,eK.isAddress)(e))throw new yv.InvalidAddressError({address:e});if(e&&!f)throw new yw.BaseError("`paymasterInput` must be provided when `paymaster` is defined");if(!e&&f)throw new yw.BaseError("`paymaster` must be provided when `paymasterInput` is defined")}var yC=a.i(406912),yD=a.i(154301),yE=yw;class yF extends yE.BaseError{constructor({givenLength:a,maxBytecodeSize:b}){super(`Bytecode cannot be longer than ${b} bytes. Given length: ${a}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class yG extends yE.BaseError{constructor({givenLengthInWords:a}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${a}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class yH extends yE.BaseError{constructor({givenLength:a}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${a}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function yI(a){let b=(0,yk.toBytes)(a);if(b.length%32!=0)throw new yH({givenLength:b.length});if(b.length>yq)throw new yF({givenLength:b.length,maxBytecodeSize:yq});let c=(0,yD.sha256)(b),d=(0,yk.toBytes)(c),e=b.length/32;if(e%2==0)throw new yG({givenLengthInWords:e});let f=(0,yk.toBytes)(e),g=(0,yC.pad)(f,{size:2}),h=new Uint8Array([1,0]);return d.set(h,0),d.set(g,2),d}let yJ={blockTime:1e3,formatters:yr,serializers:{transaction:function(a,b){return yA(a)?function(a){let{chainId:b,gas:c,nonce:d,to:e,from:f,value:g,maxFeePerGas:h,maxPriorityFeePerGas:i,customSignature:j,factoryDeps:k,paymaster:l,paymasterInput:m,gasPerPubdata:n,data:o}=a;yB(a);let p=[d?(0,eJ.toHex)(d):"0x",i?(0,eJ.toHex)(i):"0x",h?(0,eJ.toHex)(h):"0x",c?(0,eJ.toHex)(c):"0x",e??"0x",g?(0,eJ.toHex)(g):"0x",o??"0x",(0,eJ.toHex)(b),(0,eJ.toHex)(""),(0,eJ.toHex)(""),(0,eJ.toHex)(b),f??"0x",n?(0,eJ.toHex)(n):(0,eJ.toHex)(50000n),k??[],j??"0x",l&&m?[l,m]:[]];return(0,ys.concatHex)(["0x71",(0,yt.toRlp)(p)])}(a):(0,yu.serializeTransaction)(a,b)}},custom:{getEip712Domain:a=>{yB(a);let b=function(a){let{gas:b,nonce:c,to:d,from:e,value:f,maxFeePerGas:g,maxPriorityFeePerGas:h,factoryDeps:i,paymaster:j,paymasterInput:k,gasPerPubdata:l,data:m}=a;return{txType:113n,from:BigInt(e),to:d?BigInt(d):0n,gasLimit:b??0n,gasPerPubdataByteLimit:l??50000n,maxFeePerGas:g??0n,maxPriorityFeePerGas:h??0n,paymaster:j?BigInt(j):0n,nonce:c?BigInt(c):0n,value:f??0n,data:m??"0x",factoryDeps:i?.map(a=>(0,eJ.toHex)(yI(a)))??[],paymasterInput:k||"0x"}}(a);return{domain:{name:"zkSync",version:"2",chainId:a.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:b}}}},yK=(0,x7.defineChain)({...yJ,blockTime:200,id:2741,name:"Abstract",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.mainnet.abs.xyz"],webSocket:["wss://api.mainnet.abs.xyz/ws"]}},blockExplorers:{default:{name:"Etherscan",url:"https://abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.mainnet.abs.xyz"}},contracts:{multicall3:{address:"0xAa4De41dba0Ca5dCBb288b7cC6b708F3aaC759E7",blockCreated:5288},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:5263}}}),yL=(0,x7.defineChain)({...yJ,blockTime:200,id:11124,name:"Abstract Testnet",nativeCurrency:{decimals:18,name:"ETH",symbol:"ETH"},rpcUrls:{default:{http:["https://api.testnet.abs.xyz"]}},blockExplorers:{default:{name:"Etherscan",url:"https://sepolia.abscan.org"},native:{name:"Abstract Explorer",url:"https://explorer.testnet.abs.xyz"}},testnet:!0,contracts:{multicall3:{address:"0xF9cda624FBC7e059355ce98a31693d299FACd963",blockCreated:358349},erc6492Verifier:{address:"0xfB688330379976DA81eB64Fe4BF50d7401763B9C",blockCreated:431682}}}),yM=(0,x7.defineChain)({id:1514,name:"Story",nativeCurrency:{decimals:18,name:"IP Token",symbol:"IP"},contracts:{multicall3:{address:"0xcA11bde05977b3631167028862bE2a173976CA11",blockCreated:340998},ensRegistry:{address:"0x5dc881dda4e4a8d312be3544ad13118d1a04cb17",blockCreated:648924},ensUniversalResolver:{address:"0xddfb18888a9466688235887dec2a10c4f5effee9",blockCreated:649114}},rpcUrls:{default:{http:["https://mainnet.storyrpc.io"]}},blockExplorers:{default:{name:"Story explorer",url:"https://storyscan.io",apiUrl:"https://storyscan.io/api/v2"}},ensTlds:[".ip"],testnet:!1}),yN=(0,x7.defineChain)({id:41923,name:"EDU Chain",nativeCurrency:{decimals:18,name:"EDU",symbol:"EDU"},rpcUrls:{default:{http:["https://rpc.edu-chain.raas.gelato.cloud"]}},blockExplorers:{default:{name:"EDU Chain Explorer",url:"https://educhain.blockscout.com/"}},testnet:!1});var yO=a.i(323599),yP=a.i(16158),yQ=a.i(648036);async function yR({hash:a,privateKey:b,to:c="object"}){let{r:d,s:e,recovery:f}=yO.secp256k1.sign(a.slice(2),b.slice(2),{lowS:!0,extraEntropy:!!(0,eM.isHex)(!1,{strict:!1})&&(0,yk.hexToBytes)(!1)}),g={r:(0,eJ.numberToHex)(d,{size:32}),s:(0,eJ.numberToHex)(e,{size:32}),v:f?28n:27n,yParity:f};return"bytes"===c||"hex"===c?(0,yQ.serializeSignature)({...g,to:c}):g}async function yS(a){let{chainId:b,nonce:c,privateKey:d,to:e="object"}=a,f=a.contractAddress??a.address,g=await yR({hash:(0,eN.hashAuthorization)({address:f,chainId:b,nonce:c}),privateKey:d,to:e});return"object"===e?{address:f,chainId:b,nonce:c,...g}:g}var yT=a.i(486263);async function yU({message:a,privateKey:b}){return await yR({hash:(0,yT.hashMessage)(a),privateKey:b,to:"hex"})}var yV=a.i(60519);async function yW(a){let{privateKey:b,transaction:c,serializer:d=yu.serializeTransaction}=a,e="eip4844"===c.type?{...c,sidecars:!1}:c,f=await yR({hash:(0,yV.keccak256)(await d(e)),privateKey:b});return await d(c,f)}var yX=a.i(981623);async function yY(a){let{privateKey:b,...c}=a;return await yR({hash:(0,yX.hashTypedData)(c),privateKey:b,to:"hex"})}var yZ=a.i(253697),y$=a.i(530185),y_=a.i(94260),y0=a.i(712853),y1=a.i(142746);let y2=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],name:"AccountNonceOrderingUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"accountAddress",type:"address"},{indexed:!1,internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"aaVersion",type:"uint8"}],name:"AccountVersionUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"deployerAddress",type:"address"},{indexed:!0,internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{indexed:!0,internalType:"address",name:"contractAddress",type:"address"}],name:"ContractDeployed",type:"event"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"create2",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"create2Account",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"},{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_aaVersion",type:"uint8"}],name:"createAccount",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"extendedAccountVersion",outputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_keccak256BytecodeHash",type:"bytes32"}],name:"forceDeployKeccak256",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment",name:"_deployment",type:"tuple"},{internalType:"address",name:"_sender",type:"address"}],name:"forceDeployOnAddress",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"bytecodeHash",type:"bytes32"},{internalType:"address",name:"newAddress",type:"address"},{internalType:"bool",name:"callConstructor",type:"bool"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"bytes",name:"input",type:"bytes"}],internalType:"struct ContractDeployer.ForceDeployment[]",name:"_deployments",type:"tuple[]"}],name:"forceDeployOnAddresses",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"_address",type:"address"}],name:"getAccountInfo",outputs:[{components:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"supportedAAVersion",type:"uint8"},{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"nonceOrdering",type:"uint8"}],internalType:"struct IContractDeployer.AccountInfo",name:"info",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"uint256",name:"_senderNonce",type:"uint256"}],name:"getNewAddressCreate",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_sender",type:"address"},{internalType:"bytes32",name:"_bytecodeHash",type:"bytes32"},{internalType:"bytes32",name:"_salt",type:"bytes32"},{internalType:"bytes",name:"_input",type:"bytes"}],name:"getNewAddressCreate2",outputs:[{internalType:"address",name:"newAddress",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountAbstractionVersion",name:"_version",type:"uint8"}],name:"updateAccountVersion",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"enum IContractDeployer.AccountNonceOrdering",name:"_nonceOrdering",type:"uint8"}],name:"updateNonceOrdering",outputs:[],stateMutability:"nonpayable",type:"function"}],y3="/docs/contract/encodeDeployData";function y4(a,b,c,d){let e=[b,c,d];return({create:{functionName:"create",argsContractDeployer:e},create2:{functionName:"create2",argsContractDeployer:e},createAccount:{functionName:"createAccount",argsContractDeployer:[...e,1]},create2Account:{functionName:"create2Account",argsContractDeployer:[...e,1]}})[a||"create"]}var y5=a.i(169651),y6=a.i(10217),y7=a.i(161624),y8=a.i(44130),y9=a.i(564557),za=a.i(636155),zb=a.i(599123),zc=a.i(324145),zd=a.i(179731);function ze(a){if(!yA(a))throw new yz;(0,zd.assertRequest)(a)}var zf=a.i(982489),zg=a.i(699259);async function zh(a,b){let{account:c=a.account,chain:d=a.chain,...e}=b,f=c?(0,y5.parseAccount)(c):a.account;if(!f)throw new y9.AccountNotFoundError({docsPath:"/docs/actions/wallet/signTransaction"});if(ze({account:f,chain:d,...b}),!d?.custom?.getEip712Domain)throw new yw.BaseError("`getEip712Domain` not found on chain.");if(!d?.serializers?.transaction)throw new yw.BaseError("transaction serializer not found on chain.");let g=await (0,zc.getAction)(a,y6.getChainId,"getChainId")({});null!==d&&(0,za.assertCurrentChain)({currentChainId:g,chain:d});let h=d?.custom.getEip712Domain({...e,chainId:g,from:f.address,type:"eip712"}),i=await (0,zg.signTypedData)(a,{...h,account:f});return d?.serializers?.transaction({chainId:g,...e,customSignature:i,type:"eip712"},{r:"0x0",s:"0x0",v:0n})}async function zi(a,b){return yA(b)?zh(a,b):await (0,zf.signTransaction)(a,b)}async function zj(a,b){let{account:c=a.account,chain:d=a.chain}=b,e=c?(0,y5.parseAccount)(c):a.account;if(!e)throw new y9.AccountNotFoundError({docsPath:"/docs/actions/wallet/sendTransaction"});try{let c;ze(b);let f=await (0,y7.prepareTransactionRequest)(a,{...b,nonceManager:e.nonceManager,parameters:["gas","nonce","fees"]});null!==d&&(c=await (0,zc.getAction)(a,y6.getChainId,"getChainId")({}),(0,za.assertCurrentChain)({currentChainId:c,chain:d}));let g=await zi(a,{...f,chainId:c});return await (0,zc.getAction)(a,y8.sendRawTransaction,"sendRawTransaction")({serializedTransaction:g})}catch(a){throw(0,zb.getTransactionError)(a,{...b,account:e,chain:d})}}var zk=a.i(800446);async function zl(a,b){return yA(b)?zj(a,b):(0,zk.sendTransaction)(a,b)}function zm([a,b]){return`${a}=${function a(b){return Array.isArray(b)?"%5B"+b.map(a).join("%2C%20")+"%5D":"bigint"==typeof b?`${b}n`:encodeURIComponent(String(null!=b&&null===Object.getPrototypeOf(b)?{...b}:b))}(b)}`}var zn=class extends Error{cause=this.cause;context;constructor(...[a,b]){let c,d;b&&Object.entries(Object.getOwnPropertyDescriptors(b)).forEach(([b,e])=>{"cause"===b?d={cause:e.value}:(void 0===c&&(c={__code:a}),Object.defineProperty(c,b,e))}),super(function(a,b={}){{let c,d=`Solana error #${a}; Decode this error by running \`npx @solana/errors decode -- ${a}`;return Object.keys(b).length&&(d+=` '${c=Object.entries(b).map(zm).join("&"),Buffer.from(c,"utf8").toString("base64")}'`),`${d}\``}}(a,c),d),this.context=Object.freeze(void 0===c?{__code:a}:c),this.name="SolanaError"}};function zo(...a){"captureStackTrace"in Error&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(...a)}function zp({errorCodeBaseOffset:a,getErrorContext:b,orderedErrorNames:c,rpcEnumError:d},e){let f,g;"string"==typeof d?f=d:(f=Object.keys(d)[0],g=d[f]);let h=a+c.indexOf(f),i=b(h,f,g),j=new zn(h,i);return zo(j,e),j}var zq=["GenericError","InvalidArgument","InvalidInstructionData","InvalidAccountData","AccountDataTooSmall","InsufficientFunds","IncorrectProgramId","MissingRequiredSignature","AccountAlreadyInitialized","UninitializedAccount","UnbalancedInstruction","ModifiedProgramId","ExternalAccountLamportSpend","ExternalAccountDataModified","ReadonlyLamportChange","ReadonlyDataModified","DuplicateAccountIndex","ExecutableModified","RentEpochModified","NotEnoughAccountKeys","AccountDataSizeChanged","AccountNotExecutable","AccountBorrowFailed","AccountBorrowOutstanding","DuplicateAccountOutOfSync","Custom","InvalidError","ExecutableDataModified","ExecutableLamportChange","ExecutableAccountNotRentExempt","UnsupportedProgramId","CallDepth","MissingAccount","ReentrancyNotAllowed","MaxSeedLengthExceeded","InvalidSeeds","InvalidRealloc","ComputationalBudgetExceeded","PrivilegeEscalation","ProgramEnvironmentSetupFailure","ProgramFailedToComplete","ProgramFailedToCompile","Immutable","IncorrectAuthority","BorshIoError","AccountNotRentExempt","InvalidAccountOwner","ArithmeticOverflow","UnsupportedSysvar","IllegalOwner","MaxAccountsDataAllocationsExceeded","MaxAccountsExceeded","MaxInstructionTraceLengthExceeded","BuiltinProgramsMustConsumeComputeUnits"],zr=["AccountInUse","AccountLoadedTwice","AccountNotFound","ProgramAccountNotFound","InsufficientFundsForFee","InvalidAccountForFee","AlreadyProcessed","BlockhashNotFound","CallChainTooDeep","MissingSignatureForFee","InvalidAccountIndex","SignatureFailure","InvalidProgramForExecution","SanitizeFailure","ClusterMaintenance","AccountBorrowOutstanding","WouldExceedMaxBlockCostLimit","UnsupportedVersion","InvalidWritableAccount","WouldExceedMaxAccountCostLimit","WouldExceedAccountDataBlockLimit","TooManyAccountLocks","AddressLookupTableNotFound","InvalidAddressLookupTableOwner","InvalidAddressLookupTableData","InvalidAddressLookupTableIndex","InvalidRentPayingAccount","WouldExceedMaxVoteCostLimit","WouldExceedAccountDataTotalLimit","DuplicateInstruction","InsufficientFundsForRent","MaxLoadedAccountsDataSizeExceeded","InvalidLoadedAccountsDataSizeLimit","ResanitizationNeeded","ProgramExecutionTemporarilyRestricted","UnbalancedTransaction"];function zs(a){var b;let c;if("object"==typeof(b=a)&&null!==b&&"code"in b&&"message"in b&&("number"==typeof b.code||"bigint"==typeof b.code)&&"string"==typeof b.message){let{code:b,data:d,message:e}=a,f=Number(b);if(-32002===f){let{err:a,...b}=d,e=a?{cause:function a(b){return"object"==typeof b&&"InstructionError"in b?function a(b,c){let d=Number(b);return zp({errorCodeBaseOffset:4615001,getErrorContext:(a,b,c)=>4615e3===a?{errorName:b,index:d,...void 0!==c?{instructionErrorContext:c}:null}:4615026===a?{code:Number(c),index:d}:{index:d},orderedErrorNames:zq,rpcEnumError:c},a)}(...b.InstructionError):zp({errorCodeBaseOffset:7050001,getErrorContext:(a,b,c)=>705e4===a?{errorName:b,...void 0!==c?{transactionErrorContext:c}:null}:7050030===a?{index:Number(c)}:7050031===a||7050035===a?{accountIndex:Number(c.account_index)}:void 0,orderedErrorNames:zr,rpcEnumError:b},a)}(a)}:null;c=new zn(-32002,{...b,...e})}else{let a;switch(f){case -32603:case -32602:case -32600:case -32601:case -32700:case -32012:case -32001:case -32004:case -32014:case -32010:case -32009:case -32007:case -32006:case -32015:a={__serverMessage:e};break;default:"object"!=typeof d||Array.isArray(d)||(a=d)}c=new zn(f,a)}}else{let b="object"==typeof a&&null!==a&&"message"in a&&"string"==typeof a.message?a.message:"Malformed JSON-RPC error with no message attribute";c=new zn(10,{error:a,message:b})}return zo(c,zs),c}var zt=((DZ=zt||{})[DZ.WRITABLE_SIGNER=3]="WRITABLE_SIGNER",DZ[DZ.READONLY_SIGNER=2]="READONLY_SIGNER",DZ[DZ.WRITABLE=1]="WRITABLE",DZ[DZ.READONLY=0]="READONLY",DZ);function zu(a,b){return"fixedSize"in b?b.fixedSize:b.getSizeFromValue(a)}function zv(a){return Object.freeze({...a,encode:b=>{let c=new Uint8Array(zu(b,a));return a.write(b,c,0),c}})}function zw(a){return Object.freeze({...a,decode:(b,c=0)=>a.read(b,c)[0]})}function zx(a){return"fixedSize"in a&&"number"==typeof a.fixedSize}function zy(a,b,c,d=0){let e=c.length-d;if(e<b)throw new zn(8078001,{bytesLength:e,codecDescription:a,expected:b})}function zz(a,b,c){if(b<0||b>c)throw new zn(8078014,{bytesLength:c,codecDescription:a,offset:b})}function zA(a,b){return zw({fixedSize:b,read:(c,d)=>{let e,f;zy("fixCodecSize",b,c,d),(d>0||c.length>b)&&(c=c.slice(d,d+b)),zx(a)&&(e=c,f=a.fixedSize,c=function(a,b){if(a.length>=b)return a;let c=new Uint8Array(b).fill(0);return c.set(a),c}(e.length<=f?e:e.slice(0,f),f));let[g]=a.read(c,0);return[g,d+b]}})}function zB(a,b){return zw({...a,read:(c,d)=>{let[e,f]=a.read(c,d);return[b(e,c,d),f]}})}function zC(){if(void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.subtle?.exportKey)throw new zn(3610003)}function zD(){let a;return zA((En||(a="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",En=zw({read(b,c){let d=0===c?b:b.slice(c);if(0===d.length)return["",0];let e=d.findIndex(a=>0!==a);e=-1===e?d.length:e;let f=a[0].repeat(e);return e===d.length?[f,b.length]:[f+function(a,b){let c=BigInt(b.length),d=[];for(;a>0n;)d.unshift(b[Number(a%c)]),a/=c;return d.join("")}(d.slice(e).reduce((a,b)=>256n*a+BigInt(b),0n),a),b.length]}})),En),32)}async function zE(a){if(zC(),"public"!==a.type||"Ed25519"!==a.algorithm.name)throw new zn(2800003);let b=await crypto.subtle.exportKey("raw",a);return zD().decode(new Uint8Array(b))}var zF=Object.freeze({name:"Ed25519"});async function zG(a,b=!1){let c=a.byteLength;if(32!==c)throw new zn(3704001,{actualLength:c});let d=new Uint8Array([48,46,2,1,0,48,5,6,3,43,101,112,4,34,4,32,...a]);return await crypto.subtle.importKey("pkcs8",d,zF,b,["sign"])}async function zH(a,b=!1){if(zC(),!1===a.extractable)throw new zn(3610007,{key:a});let c=await crypto.subtle.exportKey("jwk",a);return await crypto.subtle.importKey("jwk",{crv:"Ed25519",ext:b,key_ops:["verify"],kty:"OKP",x:c.x},"Ed25519",b,["verify"])}async function zI(a,b){if(void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.subtle?.sign)throw new zn(3610005);return new Uint8Array(await crypto.subtle.sign(zF,a,b))}async function zJ(a,b,c){if(void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.subtle?.verify)throw new zn(3610006);return await crypto.subtle.verify(zF,a,b,c)}async function zK(a,b=!1){if(void 0===globalThis.crypto||"function"!=typeof globalThis.crypto.getRandomValues)throw new zn(3611e3);if(64!==a.byteLength)throw new zn(3704e3,{byteLength:a.byteLength});let[c,d]=await Promise.all([crypto.subtle.importKey("raw",a.slice(32),zF,!0,["verify"]),zG(a.slice(0,32),b)]),e=new Uint8Array(32);crypto.getRandomValues(e);let f=await zI(d,e);if(!await zJ(c,f,e))throw new zn(3704004);return{privateKey:d,publicKey:c}}async function zL(a,b=!1){let c=zG(a,b),[d,e]=await Promise.all([(b?c:zG(a,!0)).then(async a=>await zH(a,!0)),c]);return{privateKey:e,publicKey:d}}function zM(a,b,c,d){if(d<b||d>c)throw new zn(8078011,{codecDescription:a,max:c,min:b,value:d})}var zN=((D$=zN||{})[D$.Little=0]="Little",D$[D$.Big=1]="Big",D$);function zO(a){return a?.endian!==1}function zP(a){return zw({fixedSize:a.size,read(b,c=0){var d,e,f;let g,h;!function(a,b,c=0){if(b.length-c<=0)throw new zn(8078e3,{codecDescription:a})}(a.name,b,c),zy(a.name,a.size,b,c);let i=new DataView((d=b,e=c,f=a.size,g=d.byteOffset+(e??0),h=f??d.byteLength,d.buffer.slice(g,g+h)));return[a.get(i,zO(a.config)),c+a.size]}})}var zQ=()=>zw({maxSize:3,read:(a,b)=>{let c=0,d=0;for(;++d;){let e=d-1,f=a[b+e];if(c|=(127&f)<<7*e,(128&f)==0)break}return[c,b+d]}}),zR=()=>zP({get:a=>a.getUint8(0),name:"u8",size:1});function zS(a){return a.reduce((a,b)=>null===a||null===b?null:a+b,0)}function zT(a){return zx(a)?a.fixedSize:null}function zU(a){return zx(a)?a.fixedSize:a.maxSize??null}function zV(a,b={}){let c=b.size??((a={})=>zP({config:a,get:(a,b)=>a.getUint32(0,b),name:"u32",size:4}))(),d=zW(c,zT(a)),e=zW(c,zU(a))??void 0;return zw({...null!==d?{fixedSize:d}:{maxSize:e},read:(b,d)=>{let e=[];if("object"==typeof c&&0===b.slice(d).length)return[e,d];if("remainder"===c){for(;d<b.length;){let[c,f]=a.read(b,d);d=f,e.push(c)}return[e,d]}let[f,g]="number"==typeof c?[c,d]:c.read(b,d);d=g;for(let c=0;c<f;c+=1){let[c,f]=a.read(b,d);d=f,e.push(c)}return[e,d]}})}function zW(a,b){return"number"!=typeof a?null:0===a?0:null===b?null:b*a}function zX(){return zv({getSizeFromValue:a=>a.length,write:(a,b,c)=>(b.set(a,c),c+a.length)})}function zY(){return zw({read:(a,b)=>{let c=a.slice(b);return[c,b+c.length]}})}function zZ(a){let b=a.map(([,a])=>a),c=zS(b.map(zT)),d=zS(b.map(zU))??void 0;return zw({...null===c?{maxSize:d}:{fixedSize:c},read:(b,c)=>{let d={};return a.forEach(([a,e])=>{let[f,g]=e.read(b,c);c=g,d[a]=f}),[d,c]}})}function z$(a,...b){return b.reduce((a,b)=>b(a),a)}function z_(){return Ep||(Ep=zR()),Ep}function z0(){return zw({maxSize:1,read:(a,b)=>{let c=a[b];if((128&c)==0)return["legacy",b];{let a=128^c;if(a>0)throw new zn(5663021,{unsupportedVersion:a});return[a,b+1]}}})}function z1(a){let b=Object.values(a);if(0===b.length)throw new zn(5663016);return b.map(a=>a||new Uint8Array(64).fill(0))}function z2(a){var b,c,d,e;let f,g,{messageBytes:h,signatures:i}=a,[j,k,l]=(f=zS((e=[z0(),(b=zR(),c=function(a,b){if(zx(a)){let c=b(a.fixedSize);if(c<0)throw new zn(8078013,{bytesLength:c,codecDescription:"resizeDecoder"});return zw({...a,fixedSize:c})}return a}(b,a=>a+2),d={postOffset:({postOffset:a})=>a+2},zw({...c,read:(a,b)=>{let e=b=>{var c,d;return c=b,0===(d=a.length)?0:(c%d+d)%d},f=d.preOffset?d.preOffset({bytes:a,preOffset:b,wrapBytes:e}):b;zz("offsetDecoder",f,a.length);let[g,h]=c.read(a,f),i=d.postOffset?d.postOffset({bytes:a,newPreOffset:f,postOffset:h,preOffset:b,wrapBytes:e}):h;return zz("offsetDecoder",i,a.length),[g,i]}})),zV(zD(),{size:zQ()})]).map(zT)),g=zS(e.map(zU))??void 0,zw({...null===f?{maxSize:g}:{fixedSize:f},read:(a,b)=>{let c=[];return e.forEach(d=>{let[e,f]=d.read(a,b);c.push(e),b=f}),[c,b]}})).decode(h),m=l.slice(0,k);if(m.length!==i.length)throw new zn(5663017,{numRequiredSignatures:k,signaturesLength:i.length,signerAddresses:m});let n={};return m.forEach((a,b)=>{let c=i[b];c.every(a=>0===a)?n[a]=null:n[a]=c}),{messageBytes:h,signatures:Object.freeze(n)}}async function z3(a,b){let c,d;if(await Promise.all(a.map(async a=>{let e=await zE(a.publicKey),f=b.signatures[e];if(void 0===f)return void(d||=new Set).add(e);if(d)return;let g=await zI(a.privateKey,b.messageBytes);null!==f&&g.length===f.length&&g.every((a,b)=>a===f[b])||((c||={})[e]=g)})),d&&d.size>0)throw new zn(5663015,{expectedAddresses:Object.keys(b.signatures),unexpectedAddresses:[...d]});return c?Object.freeze({...b,signatures:Object.freeze({...b.signatures,...c})}):b}Symbol("AddressMapTypeProperty");var z4=((D_=z4||{})[D_.Little=0]="Little",D_[D_.Big=1]="Big",D_);Object.freeze({name:"Ed25519"}),new Uint8Array([255,115,111,108,97,110,97,32,111,102,102,99,104,97,105,110]);var z5=((D0=z5||{})[D0.RESTRICTED_ASCII_1232_BYTES_MAX=0]="RESTRICTED_ASCII_1232_BYTES_MAX",D0[D0.UTF8_1232_BYTES_MAX=1]="UTF8_1232_BYTES_MAX",D0[D0.UTF8_65535_BYTES_MAX=2]="UTF8_65535_BYTES_MAX",D0);function z6(a){return"modifyAndSignTransactions"in a&&"function"==typeof a.modifyAndSignTransactions}function z7(a){return"signTransactions"in a&&"function"==typeof a.signTransactions}async function z8(a){let b=await zE(a.publicKey);return Object.freeze({address:b,keyPair:a,signMessages:c=>Promise.all(c.map(async c=>Object.freeze({[b]:await zI(a.privateKey,c.content)}))),signTransactions:c=>Promise.all(c.map(async c=>Object.freeze({[b]:(await z3([a],c)).signatures[b]})))})}async function z9(a,b){return await z8(await zK(a,b))}async function Aa(a,b){return await z8(await zL(a,b))}function Ab(a){return JSON.parse(function(a){let b=[],c=!1;for(let e=0;e<a.length;e++){let f=!1;if("\\"===a[e]&&(b.push(a[e++]),f=!f),'"'===a[e]){b.push(a[e]),f||(c=!c);continue}if(!c){let c=function(a,b){if(!a[b]?.match(/[-\d]/))return null;let c=a.slice(b).match(/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?/);return c?c[0]:null}(a,e);if(c?.length){var d;e+=c.length-1,c.match(/\.|[eE]-/)?b.push(c):b.push((d=c,`{"$n":"${d}"}`));continue}}b.push(a[e])}return b.join("")}(a),(a,b)=>{var c;return(c=b)&&"object"==typeof c&&"$n"in c&&"string"==typeof c.$n?function({$n:a}){if(a.match(/[eE]/)){let[b,c]=a.split(/[eE]/);return BigInt(b)*BigInt(10)**BigInt(c)}return BigInt(a)}(b):b})}var Ac=0n;function Ad(a){let b;return{id:(b=Ac,Ac++,b.toString()),jsonrpc:"2.0",method:a.methodName,params:a.params}}function Ae(a,b){return JSON.stringify(a,(a,b)=>{var c;return"bigint"==typeof b?(c=b,{$n:`${c}`}):b},b).replace(/\{\s*"\$n"\s*:\s*"(-?\d+)"\s*\}/g,"$1")}function Af(a){return!(null==a||"object"!=typeof a||Array.isArray(a))&&"jsonrpc"in a&&"2.0"===a.jsonrpc&&"method"in a&&"string"==typeof a.method&&"params"in a}function Ag(a){return"bigint"==typeof a?Number(a):a}var Ah={};function Ai(a){return function b(c,d){if(Array.isArray(c))return c.map((a,c)=>b(a,{...d,keyPath:[...d.keyPath,c]}));if("object"!=typeof c||null===c)return a.reduce((a,b)=>b(a,d),c);{let a={};for(let e in c){if(!Object.prototype.hasOwnProperty.call(c,e))continue;let f={...d,keyPath:[...d.keyPath,e]};a[e]=b(c[e],f)}return a}}}function Aj(a,b){return c=>{let d=Ai(a);return Object.freeze({...c,params:d(c.params,b)})}}var Ak={accountNotifications:1,blockNotifications:1,getAccountInfo:1,getBalance:1,getBlock:1,getBlockHeight:0,getBlockProduction:0,getBlocks:2,getBlocksWithLimit:2,getEpochInfo:0,getFeeForMessage:1,getInflationGovernor:0,getInflationReward:1,getLargestAccounts:0,getLatestBlockhash:0,getLeaderSchedule:1,getMinimumBalanceForRentExemption:1,getMultipleAccounts:1,getProgramAccounts:1,getSignaturesForAddress:1,getSlot:0,getSlotLeader:0,getStakeMinimumDelegation:0,getSupply:0,getTokenAccountBalance:1,getTokenAccountsByDelegate:2,getTokenAccountsByOwner:2,getTokenLargestAccounts:1,getTokenSupply:1,getTransaction:1,getTransactionCount:0,getVoteAccounts:0,isBlockhashValid:1,logsNotifications:1,programNotifications:1,requestAirdrop:2,sendTransaction:1,signatureNotifications:1,simulateTransaction:1};function Al(a){let b=a?.onIntegerOverflow;return c=>z$(c,b?a=>{var c;return Aj([(c=(...c)=>b(a,...c),(a,{keyPath:b})=>("bigint"==typeof a&&c&&(a>Number.MAX_SAFE_INTEGER||a<-Number.MAX_SAFE_INTEGER)&&c(b,a),a))],{keyPath:[]})(a)}:a=>a,Aj([Ag],{keyPath:[]}),function({defaultCommitment:a,optionsObjectPositionByMethod:b}){return c=>{let{params:d,methodName:e}=c;if(!Array.isArray(d))return c;let f=b[e];return null==f?c:Object.freeze({methodName:e,params:function({commitmentPropertyName:a,params:b,optionsObjectPositionInParams:c,overrideCommitment:d}){let e=b[c];if(void 0===e||e&&"object"==typeof e&&!Array.isArray(e)){if(e&&a in e){if(!e[a]||"finalized"===e[a]){let d=[...b],{[a]:f,...g}=e;return Object.keys(g).length>0?d[c]=g:c===d.length-1?d.length--:d[c]=void 0,d}}else if("finalized"!==d){let f=[...b];return f[c]={...e,[a]:d},f}}return b}({commitmentPropertyName:"sendTransaction"===e?"preflightCommitment":"commitment",optionsObjectPositionInParams:f,overrideCommitment:a,params:d})})}}({defaultCommitment:a?.defaultCommitment,optionsObjectPositionByMethod:Ak}))}function Am(a){var b,c;return b=[function(b,{keyPath:c}){var d;return"number"==typeof b&&Number.isInteger(b)||"bigint"==typeof b?(d=c,a.some(a=>{if(a.length!==d.length)return!1;for(let b=d.length-1;b>=0;b--){let c=d[b],e=a[b];if(e!==c&&(e!==Ah||"number"!=typeof c))return!1}return!0}))?Number(b):BigInt(b):b}],c={keyPath:[]},a=>Ai(b)(a,c)}var An=[["data","parsed","info","tokenAmount","decimals"],["data","parsed","info","tokenAmount","uiAmount"],["data","parsed","info","rentExemptReserve","decimals"],["data","parsed","info","rentExemptReserve","uiAmount"],["data","parsed","info","delegatedAmount","decimals"],["data","parsed","info","delegatedAmount","uiAmount"],["data","parsed","info","extensions",Ah,"state","olderTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",Ah,"state","newerTransferFee","transferFeeBasisPoints"],["data","parsed","info","extensions",Ah,"state","preUpdateAverageRate"],["data","parsed","info","extensions",Ah,"state","currentRate"]],Ao=[...An,["data","parsed","info","lastExtendedSlotStartIndex"],["data","parsed","info","slashPenalty"],["data","parsed","info","warmupCooldownRate"],["data","parsed","info","decimals"],["data","parsed","info","numRequiredSigners"],["data","parsed","info","numValidSigners"],["data","parsed","info","stake","delegation","warmupCooldownRate"],["data","parsed","info","exemptionThreshold"],["data","parsed","info","burnPercent"],["data","parsed","info","commission"],["data","parsed","info","votes",Ah,"confirmationCount"]],Ap=[["index"],["instructions",Ah,"accounts",Ah],["instructions",Ah,"programIdIndex"],["instructions",Ah,"stackHeight"]],Aq=[["addressTableLookups",Ah,"writableIndexes",Ah],["addressTableLookups",Ah,"readonlyIndexes",Ah],["header","numReadonlySignedAccounts"],["header","numReadonlyUnsignedAccounts"],["header","numRequiredSignatures"],["instructions",Ah,"accounts",Ah],["instructions",Ah,"programIdIndex"],["instructions",Ah,"stackHeight"]],Ar=["getAccountInfo","getBalance","getBlock","getBlockCommitment","getBlockHeight","getBlockProduction","getBlocks","getBlocksWithLimit","getBlockTime","getClusterNodes","getEpochInfo","getEpochSchedule","getFeeForMessage","getFirstAvailableBlock","getGenesisHash","getHealth","getHighestSnapshotSlot","getIdentity","getInflationGovernor","getInflationRate","getInflationReward","getLargestAccounts","getLatestBlockhash","getLeaderSchedule","getMaxRetransmitSlot","getMaxShredInsertSlot","getMinimumBalanceForRentExemption","getMultipleAccounts","getProgramAccounts","getRecentPerformanceSamples","getRecentPrioritizationFees","getSignaturesForAddress","getSignatureStatuses","getSlot","getSlotLeader","getSlotLeaders","getStakeMinimumDelegation","getSupply","getTokenAccountBalance","getTokenAccountsByDelegate","getTokenAccountsByOwner","getTokenLargestAccounts","getTokenSupply","getTransaction","getTransactionCount","getVersion","getVoteAccounts","index","isBlockhashValid","minimumLedgerSlot","requestAirdrop","sendTransaction","simulateTransaction"];function As(a){return Af(a)&&Ar.includes(a.method)}var At=Object.prototype.toString,Au=Object.keys||function(a){let b=[];for(let c in a)b.push(c);return b};function Av(a){let b=function a(b,c){let d,e,f,g,h,i,j;if(!0===b)return"true";if(!1===b)return"false";switch(typeof b){case"object":if(null===b)return null;if("toJSON"in b&&"function"==typeof b.toJSON)return a(b.toJSON(),c);if("[object Array]"===(j=At.call(b))){for(d=0,f="[",e=b.length-1;d<e;d++)f+=a(b[d],!0)+",";return e>-1&&(f+=a(b[d],!0)),f+"]"}if("[object Object]"!==j)return JSON.stringify(b);for(e=(g=Au(b).sort()).length,f="",d=0;d<e;)void 0!==(i=a(b[h=g[d]],!1))&&(f&&(f+=","),f+=JSON.stringify(h)+":"+i),d++;return"{"+f+"}";case"function":case"undefined":return c?null:void 0;case"bigint":return`${b.toString()}n`;case"string":return JSON.stringify(b);default:return isFinite(b)?b:null}}(a,!1);if(void 0!==b)return""+b}var Aw={defaultCommitment:"confirmed",onIntegerOverflow(a,b,c){throw function a(b,c,d){let e="";if("number"==typeof c[0]){let a=c[0]+1,b=a%10,d=a%100;e=1==b&&11!=d?a+"st":2==b&&12!=d?a+"nd":3==b&&13!=d?a+"rd":a+"th"}else e=`\`${c[0].toString()}\``;let f=c.length>1?c.slice(1).map(a=>"number"==typeof a?`[${a}]`:a).join("."):void 0,g=new zn(81e5,{argumentLabel:e,keyPath:c,methodName:b,optionalPathLabel:f?` at path \`${f}\``:"",value:d,...void 0!==f?{path:f}:void 0});return zo(g,a),g}(a.methodName,b,c)}},Ax=class extends globalThis.AbortController{constructor(...a){super(...a),(0,cB.setMaxListeners)(Number.MAX_SAFE_INTEGER,this.signal)}};function Ay(a){return Af(a)?Av([a.method,a.params]):void 0}function Az(a,b){var c,d,e,f,g;return d=z$(function(a){let b,{fromJson:c,headers:d,toJson:e,url:f}=a;"dispatcher_NODE_ONLY"in a&&(b={dispatcher:a.dispatcher_NODE_ONLY});let g=d&&function(a){let b={};for(let c in a)b[c.toLowerCase()]=a[c];return b}(d);return async function({payload:a,signal:d}){let h=e?e(a):JSON.stringify(a),i={...b,body:h,headers:{...g,accept:"application/json","content-length":h.length.toString(),"content-type":"application/json; charset=utf-8"},method:"POST",signal:d},j=await fetch(f,i);if(!j.ok)throw new zn(8100002,{headers:j.headers,message:j.statusText,statusCode:j.status});return c?c(await j.text(),a):await j.json()}}({...{...c={url:a,...b},headers:{"accept-encoding":"br,gzip,deflate",...c.headers?function(a){let b={};for(let c in a)b[c.toLowerCase()]=a[c];return b}(c.headers):void 0,"solana-client":"js/5.1.0"}},fromJson:(a,b)=>As(b)?Ab(a):JSON.parse(a),toJson:a=>As(a)?Ae(a):JSON.stringify(a)}),a=>{let b;return async function(c){let{payload:d,signal:e}=c,f=Ay(d);if(void 0===f)return await a(c);if(b||(queueMicrotask(()=>{b=void 0}),b={}),null==b[f]){let d=new Ax,e=(async()=>{try{return await a({...c,signal:d.signal})}catch(a){if(a===(Es||={}))return;throw a}})();b[f]={abortController:d,numConsumers:0,responsePromise:e}}let g=b[f];if(g.numConsumers++,!e)return await g.responsePromise;{let a=g.responsePromise;return await new Promise((b,c)=>{let d=a=>{e.removeEventListener("abort",d),g.numConsumers-=1,queueMicrotask(()=>{0===g.numConsumers&&g.abortController.abort(Es||={})}),c(a.target.reason)};e.addEventListener("abort",d),a.then(b).catch(c).finally(()=>{e.removeEventListener("abort",d)})})}}}),g={api:(f={requestTransformer:Al(Aw),responseTransformer:(e={allowedNumericKeyPaths:(Er||(Er={getAccountInfo:Ao.map(a=>["value",...a]),getBlock:[["transactions",Ah,"meta","preTokenBalances",Ah,"accountIndex"],["transactions",Ah,"meta","preTokenBalances",Ah,"uiTokenAmount","decimals"],["transactions",Ah,"meta","postTokenBalances",Ah,"accountIndex"],["transactions",Ah,"meta","postTokenBalances",Ah,"uiTokenAmount","decimals"],["transactions",Ah,"meta","rewards",Ah,"commission"],...Ap.map(a=>["transactions",Ah,"meta","innerInstructions",Ah,...a]),...Aq.map(a=>["transactions",Ah,"transaction","message",...a]),["rewards",Ah,"commission"]],getClusterNodes:[[Ah,"featureSet"],[Ah,"shredVersion"]],getInflationGovernor:[["initial"],["foundation"],["foundationTerm"],["taper"],["terminal"]],getInflationRate:[["foundation"],["total"],["validator"]],getInflationReward:[[Ah,"commission"]],getMultipleAccounts:Ao.map(a=>["value",Ah,...a]),getProgramAccounts:Ao.flatMap(a=>[["value",Ah,"account",...a],[Ah,"account",...a]]),getRecentPerformanceSamples:[[Ah,"samplePeriodSecs"]],getTokenAccountBalance:[["value","decimals"],["value","uiAmount"]],getTokenAccountsByDelegate:An.map(a=>["value",Ah,"account",...a]),getTokenAccountsByOwner:An.map(a=>["value",Ah,"account",...a]),getTokenLargestAccounts:[["value",Ah,"decimals"],["value",Ah,"uiAmount"]],getTokenSupply:[["value","decimals"],["value","uiAmount"]],getTransaction:[["meta","preTokenBalances",Ah,"accountIndex"],["meta","preTokenBalances",Ah,"uiTokenAmount","decimals"],["meta","postTokenBalances",Ah,"accountIndex"],["meta","postTokenBalances",Ah,"uiTokenAmount","decimals"],["meta","rewards",Ah,"commission"],...Ap.map(a=>["meta","innerInstructions",Ah,...a]),...Aq.map(a=>["transaction","message",...a])],getVersion:[["feature-set"]],getVoteAccounts:[["current",Ah,"commission"],["delinquent",Ah,"commission"]],simulateTransaction:[["value","loadedAccountsDataSize"],...Ao.map(a=>["value","accounts",Ah,...a]),...Ap.map(a=>["value","innerInstructions",Ah,...a])]}),Er)},(a,b)=>{let c=b.methodName,d=e?.allowedNumericKeyPaths&&c?e.allowedNumericKeyPaths[c]:void 0;return z$(a,a=>(a=>{if("error"in a)throw zs(a.error);return a})(a,b),a=>a.result,a=>Am(d??[])(a,b))})},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...a){let[b,c]=a,d=c.toString();return function(...a){let b=Object.freeze({methodName:d,params:a}),c=f?.requestTransformer?f?.requestTransformer(b):b;return Object.freeze({execute:async({signal:a,transport:b})=>{let d=Ad(c),e=await b({payload:d,signal:a});return f?.responseTransformer?f.responseTransformer(e,c):e}})}}})),transport:d},new Proxy(g.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(a,b,c){if("then"!==b)return function(...d){let e=b.toString(),f=Reflect.get(a,e,c);if(!f)throw new zn(8100003,{method:e,params:d});return function({transport:a},b){return{send:async c=>await b.execute({signal:c?.abortSignal,transport:a})}}(g,f(...d))}}})}var AA=class extends globalThis.AbortController{constructor(...a){super(...a),(0,cB.setMaxListeners)(Number.MAX_SAFE_INTEGER,this.signal)}},AB=class extends globalThis.EventTarget{constructor(...a){super(...a),(0,cB.setMaxListeners)(Number.MAX_SAFE_INTEGER,this)}};function AC(){return Symbol(void 0)}var AD=Symbol();function AE(a){return{on(b,c,d){function e(a){a instanceof CustomEvent?c(a.detail):c()}return a.addEventListener(b,e,d),()=>{a.removeEventListener(b,e)}}}}function AF(a){return null!==a&&("object"==typeof a||"function"==typeof a)}var AG=new WeakMap;async function AH(a){let b,c=new Promise((c,d)=>{for(let e of(b={reject:d,resolve:c},a)){if(!AF(e)){Promise.resolve(e).then(c,d);continue}let a=AG.get(e);void 0===a?((a=function(a){let b=new Set,c={deferreds:b,settled:!1};return Promise.resolve(a).then(a=>{for(let{resolve:c}of b)c(a);b.clear(),c.settled=!0},a=>{for(let{reject:c}of b)c(a);b.clear(),c.settled=!0}),c}(e)).deferreds.add(b),AG.set(e,a)):a.settled?Promise.resolve(e).then(c,d):a.deferreds.add(b)}});return await c.finally(()=>{for(let c of a)AF(c)&&AG.get(c).deferreds.delete(b)})}var AI=class extends globalThis.AbortController{constructor(...a){super(...a),(0,cB.setMaxListeners)(Number.MAX_SAFE_INTEGER,this.signal)}},AJ=new WeakMap;function AK(a,b,c){let d;if(void 0===c)return;let e=((d=AJ.get(b))||AJ.set(b,d={}),d);!e[c]&&a>0&&(e[c]=0);let f=a+e[c];return f<=0?delete e[c]:e[c]=f,f}var AL=new WeakMap;async function AM({channel:a,responseTransformer:b,signal:c,subscribeRequest:d,unsubscribeMethodName:e}){var f;let g,h,i,j,k,l,m;a.on("error",()=>{g=void 0,AJ.delete(a)},{signal:c});let n=new Promise((b,d)=>{function f(){if(0===AK(-1,a,g)){let b=Ad({methodName:e,params:[g]});g=void 0,a.send(b).catch(()=>{})}d(this.reason)}c.aborted?f.call(c):c.addEventListener("abort",f)}),o=Ad(d);await a.send(o);let p=new Promise((b,d)=>{let e=new AI;c.addEventListener("abort",e.abort.bind(e));let f={signal:e.signal};a.on("error",a=>{e.abort(),d(a)},f),a.on("message",a=>{a&&"object"==typeof a&&"id"in a&&a.id===o.id&&(e.abort(),"error"in a?d(zs(a.error)):b(a.result))},f)});if(null==(g=await AH([n,p])))throw new zn(8190001);AK(1,a,g);let q=((h=AL.get(a))||AL.set(a,h=new WeakMap),i=b??a,(j=h.get(i))||h.set(i,(f=a=>{if(!("method"in a))return;let c=b?b(a.params.result,d):a.params.result;return[`notification:${a.params.subscription}`,c]},j={...m=AE(l=new AB),on(b,c,d){k||(k={dispose:a.on("message",a=>{let b=f(a);if(!b)return;let[c,d]=b;l.dispatchEvent(new CustomEvent(c,{detail:d}))}),numSubscribers:0}),k.numSubscribers++;let e=m.on(b,c,d),g=!0;function h(){g&&(g=!1,d?.signal.removeEventListener("abort",h),k.numSubscribers--,0===k.numSubscribers&&(k.dispose(),k=void 0),e())}return d?.signal.addEventListener("abort",h),h}})),j),r=`notification:${g}`;return{on(b,c,d){switch(b){case"notification":return q.on(r,c,d);case"error":return a.on("error",c,d);default:throw new zn(9900004,{channelName:b,supportedChannelNames:["notification","error"]})}}}}var AN=a.i(762937),AO=class extends globalThis.EventTarget{constructor(...a){super(...a),(0,cB.setMaxListeners)(Number.MAX_SAFE_INTEGER,this)}},AP=globalThis.WebSocket?globalThis.WebSocket:AN.default,AQ={defaultCommitment:"confirmed",onIntegerOverflow(a,b,c){throw function a(b,c,d){let e="";if("number"==typeof c[0]){let a=c[0]+1,b=a%10,d=a%100;e=1==b&&11!=d?a+"st":2==b&&12!=d?a+"nd":3==b&&13!=d?a+"rd":a+"th"}else e=`\`${c[0].toString()}\``;let f=c.length>1?c.slice(1).map(a=>"number"==typeof a?`[${a}]`:a).join("."):void 0,g=new zn(81e5,{argumentLabel:e,keyPath:c,methodName:b,optionalPathLabel:f?` at path \`${f}\``:"",value:d,...void 0!==f?{path:f}:void 0});return zo(g,a),g}(a.methodName,b,c)}},AR=class extends globalThis.AbortController{constructor(...a){super(...a),(0,cB.setMaxListeners)(Number.MAX_SAFE_INTEGER,this.signal)}},AS={jsonrpc:"2.0",method:"ping"};function AT(a){return z$(a,a=>Object.freeze({...a,on:(b,c,d)=>"message"!==b?a.on(b,c,d):a.on("message",a=>c(Ab(a)),d)}),a=>Object.freeze({...a,send:b=>a.send(Ae(b))}))}function AU(a,b){var c,d,e,f;let g,h;return c=function({createChannel:a}){var b;return z$((b=a,async({execute:a,signal:c})=>{let d=await b({abortSignal:c});return await a({channel:d,signal:c})}),a=>{let b;return b=new Map,function(c){let{request:d,signal:e}=c,f=Av([d.methodName,d.params]),g=b.get(f);if(!g){let d=new AR,e=a({...c,signal:d.signal});e.then(a=>{a.on("error",()=>{b.delete(f),d.abort()},{signal:d.signal})}).catch(()=>{}),b.set(f,g={abortController:d,dataPublisherPromise:e,numSubscribers:0})}return g.numSubscribers++,e.addEventListener("abort",()=>{g.numSubscribers--,0===g.numSubscribers&&queueMicrotask(()=>{0===g.numSubscribers&&(b.delete(f),g.abortController.abort())})},{signal:g.abortController.signal}),g.dataPublisherPromise}})}({createChannel:function(a){if(!1===/^wss?:/i.test(a.url)){let b=a.url.match(/^([^:]+):/);throw new DOMException(b?`Failed to construct 'WebSocket': The URL's scheme must be either 'ws' or 'wss'. '${b[1]}:' is not allowed.`:`Failed to construct 'WebSocket': The URL '${a.url}' is invalid.`)}let{intervalMs:b,...c}=a;return function(a,{maxSubscriptionsPerChannel:b,minChannels:c}){let d={entries:[],freeChannelIndex:-1};function e(){let a;if(d.entries.length<c){d.freeChannelIndex=-1;return}for(let c=0;c<d.entries.length;c++){let e=(d.freeChannelIndex+c+2)%d.entries.length,f=d.entries[e];f.subscriptionCount<b&&(!a||a.subscriptionCount>=f.subscriptionCount)&&(a={poolIndex:e,subscriptionCount:f.subscriptionCount})}d.freeChannelIndex=a?.poolIndex??-1}return function({abortSignal:b}){let c;function f(){let a=d.entries.findIndex(a=>a===c);d.entries.splice(a,1),c.dispose(),e()}if(-1===d.freeChannelIndex){let b=new AR,e=a({abortSignal:b.signal});e.then(a=>{a.on("error",f,{signal:b.signal})}).catch(f),c={channel:e,dispose(){b.abort()},subscriptionCount:0},d.entries.push(c)}else c=d.entries[d.freeChannelIndex];return c.subscriptionCount++,b.addEventListener("abort",function(){c.subscriptionCount--,0===c.subscriptionCount?f():-1!==d.freeChannelIndex&&(d.freeChannelIndex--,e())}),e(),c.channel}}(({abortSignal:d})=>(function({sendBufferHighWatermark:a,signal:b,url:c}){let d,e,f;if(b.aborted)return Promise.reject(b.reason);let g=!1,h=new Set;function i(){h.forEach(a=>{a()}),h.clear()}function j(){i(),g||e(b.reason),p.readyState!==AP.CLOSED&&p.readyState!==AP.CLOSING&&p.close(1e3)}function k(a){if(!b.aborted&&!g){let b=new zn(8190004,{errorEvent:a});e(b),m.dispatchEvent(new CustomEvent("error",{detail:b}))}}function l(a){b.aborted||m.dispatchEvent(new CustomEvent("message",{detail:a.data}))}let m=new AO,n=AE(m);function o(){g=!0,f({...n,async send(b){if(p.readyState!==AP.OPEN)throw new zn(8190003);if(!d&&p.bufferedAmount>a){let b,c=new Promise((c,e)=>{let f=setInterval(()=>{p.readyState===AP.OPEN&&p.bufferedAmount>a||(clearInterval(f),d=void 0,c())},16);b=()=>{d=void 0,clearInterval(f),e(new zn(8190002))}});d={onCancel:b,promise:c}}d&&(!ArrayBuffer.isView(b)||b instanceof DataView||(b=new b.constructor(b)),await d.promise),p.send(b)}})}let p=new AP(c);return b.addEventListener("abort",j),p.addEventListener("close",function a(c){i(),d?.onCancel(),b.removeEventListener("abort",j),p.removeEventListener("close",a),p.removeEventListener("error",k),p.removeEventListener("message",l),p.removeEventListener("open",o),b.aborted||c.wasClean&&1e3===c.code||m.dispatchEvent(new CustomEvent("error",{detail:new zn(8190003,{cause:c})}))}),p.addEventListener("error",k),p.addEventListener("message",l),p.addEventListener("open",o),new Promise((a,b)=>{e=b,f=a})})({...c,sendBufferHighWatermark:a.sendBufferHighWatermark??131072,signal:d}).then(a.jsonSerializer).then(a=>(function({abortSignal:a,channel:b,intervalMs:c}){let d;function e(){b.send(AS).catch(a=>{var b;(b=a)instanceof Error&&"SolanaError"===b.name&&8190003===b.context.__code&&g.abort()})}function f(){clearInterval(d),d=setInterval(e,c)}let g=new AR;return g.signal.addEventListener("abort",()=>{clearInterval(d)}),a.addEventListener("abort",()=>{g.abort()}),b.on("error",()=>{g.abort()},{signal:g.signal}),b.on("message",f,{signal:g.signal}),f(),{...b,send:(...a)=>(g.signal.aborted||f(),b.send(...a))}})({abortSignal:d,channel:a,intervalMs:b??5e3})),{maxSubscriptionsPerChannel:a.maxSubscriptionsPerChannel??100,minChannels:a.minChannels??1})}({...b,url:a,jsonSerializer:AT})}),d={api:(g=Al(AQ),e={allowedNumericKeyPaths:(Eu||(Eu={accountNotifications:Ao.map(a=>["value",...a]),blockNotifications:[["value","block","transactions",Ah,"meta","preTokenBalances",Ah,"accountIndex"],["value","block","transactions",Ah,"meta","preTokenBalances",Ah,"uiTokenAmount","decimals"],["value","block","transactions",Ah,"meta","postTokenBalances",Ah,"accountIndex"],["value","block","transactions",Ah,"meta","postTokenBalances",Ah,"uiTokenAmount","decimals"],["value","block","transactions",Ah,"meta","rewards",Ah,"commission"],["value","block","transactions",Ah,"meta","innerInstructions",Ah,"index"],["value","block","transactions",Ah,"meta","innerInstructions",Ah,"instructions",Ah,"programIdIndex"],["value","block","transactions",Ah,"meta","innerInstructions",Ah,"instructions",Ah,"accounts",Ah],["value","block","transactions",Ah,"transaction","message","addressTableLookups",Ah,"writableIndexes",Ah],["value","block","transactions",Ah,"transaction","message","addressTableLookups",Ah,"readonlyIndexes",Ah],["value","block","transactions",Ah,"transaction","message","instructions",Ah,"programIdIndex"],["value","block","transactions",Ah,"transaction","message","instructions",Ah,"accounts",Ah],["value","block","transactions",Ah,"transaction","message","header","numReadonlySignedAccounts"],["value","block","transactions",Ah,"transaction","message","header","numReadonlyUnsignedAccounts"],["value","block","transactions",Ah,"transaction","message","header","numRequiredSignatures"],["value","block","rewards",Ah,"commission"]],programNotifications:Ao.flatMap(a=>[["value",Ah,"account",...a],[Ah,"account",...a]])}),Eu)},h=(a,b)=>{let c=b.methodName,d=e?.allowedNumericKeyPaths&&c?e.allowedNumericKeyPaths[c]:void 0;return z$(a,a=>Am(d??[])(a,b))},f={planExecutor:({request:a,...b})=>AM({...b,responseTransformer:h,subscribeRequest:{...a,methodName:a.methodName.replace(/Notifications$/,"Subscribe")},unsubscribeMethodName:a.methodName.replace(/Notifications$/,"Unsubscribe")}),requestTransformer:g},new Proxy({},{defineProperty:()=>!1,deleteProperty:()=>!1,get(...a){let[b,c]=a,d=c.toString();return function(...a){let b={methodName:d,params:a},c=f.requestTransformer?f.requestTransformer(b):b;return{execute:a=>f.planExecutor({...a,request:c}),request:c}}}})),transport:c},new Proxy(d.api,{defineProperty:()=>!1,deleteProperty:()=>!1,get(a,b,c){if("then"!==b)return function(...e){var f,g;let h=b.toString(),i=Reflect.get(a,h,c);if(!i)throw new zn(819e4,{notificationName:h});let j=i(...e);return f=d.transport,g=j,{async subscribe({abortSignal:a}){let b=await f({signal:a,...g});return function({abortSignal:a,dataChannelName:b,dataPublisher:c,errorChannelName:d}){let e=new Map;function f(a){for(let[b,c]of e.entries())c.__hasPolled?(e.delete(b),c.onError(a)):c.publishQueue.push({__type:1,err:a})}let g=new AA;a.addEventListener("abort",()=>{g.abort(),f(Et||=AC())});let h={signal:g.signal},i=AD;return c.on(d,a=>{i===AD&&(i=a,g.abort(),f(a))},h),c.on(b,a=>{e.forEach((b,c)=>{if(b.__hasPolled){let{onData:d}=b;e.set(c,{__hasPolled:!1,publishQueue:[]}),d(a)}else b.publishQueue.push({__type:0,data:a})})},h),{async *[Symbol.asyncIterator](){if(a.aborted)return;if(i!==AD)throw i;let b=Symbol();e.set(b,{__hasPolled:!1,publishQueue:[]});try{for(;;){let a=e.get(b);if(!a)throw new zn(99e5);if(a.__hasPolled)throw new zn(9900001);let c=a.publishQueue;try{if(c.length)for(let b of(a.publishQueue=[],c))if(0===b.__type)yield b.data;else throw b.err;else yield await new Promise((a,c)=>{e.set(b,{__hasPolled:!0,onData:a,onError:c})})}catch(a){if(a===(Et||=AC()))return;throw a}}}finally{e.delete(b)}}}}({abortSignal:a,dataChannelName:"notification",dataPublisher:b,errorChannelName:"error"})}}}}})}var AV=((D1=AV||{})[D1.Uninitialized=0]="Uninitialized",D1[D1.Initialized=1]="Initialized",D1[D1.Frozen=2]="Frozen",D1),AW=((D2=AW||{})[D2.MintTokens=0]="MintTokens",D2[D2.FreezeAccount=1]="FreezeAccount",D2[D2.AccountOwner=2]="AccountOwner",D2[D2.CloseAccount=3]="CloseAccount",D2),AX=((D3=AX||{})[D3.CreateAssociatedToken=0]="CreateAssociatedToken",D3[D3.CreateAssociatedTokenIdempotent=1]="CreateAssociatedTokenIdempotent",D3[D3.RecoverNestedAssociatedToken=2]="RecoverNestedAssociatedToken",D3),AY=((D4=AY||{})[D4.Mint=0]="Mint",D4[D4.Token=1]="Token",D4[D4.Multisig=2]="Multisig",D4),AZ=((D5=AZ||{})[D5.InitializeMint=0]="InitializeMint",D5[D5.InitializeAccount=1]="InitializeAccount",D5[D5.InitializeMultisig=2]="InitializeMultisig",D5[D5.Transfer=3]="Transfer",D5[D5.Approve=4]="Approve",D5[D5.Revoke=5]="Revoke",D5[D5.SetAuthority=6]="SetAuthority",D5[D5.MintTo=7]="MintTo",D5[D5.Burn=8]="Burn",D5[D5.CloseAccount=9]="CloseAccount",D5[D5.FreezeAccount=10]="FreezeAccount",D5[D5.ThawAccount=11]="ThawAccount",D5[D5.TransferChecked=12]="TransferChecked",D5[D5.ApproveChecked=13]="ApproveChecked",D5[D5.MintToChecked=14]="MintToChecked",D5[D5.BurnChecked=15]="BurnChecked",D5[D5.InitializeAccount2=16]="InitializeAccount2",D5[D5.SyncNative=17]="SyncNative",D5[D5.InitializeAccount3=18]="InitializeAccount3",D5[D5.InitializeMultisig2=19]="InitializeMultisig2",D5[D5.InitializeMint2=20]="InitializeMint2",D5[D5.GetAccountDataSize=21]="GetAccountDataSize",D5[D5.InitializeImmutableOwner=22]="InitializeImmutableOwner",D5[D5.AmountToUiAmount=23]="AmountToUiAmount",D5[D5.UiAmountToAmount=24]="UiAmountToAmount",D5),A$=((D6=A$||{})[D6.Uninitialized=0]="Uninitialized",D6[D6.Initialized=1]="Initialized",D6[D6.Frozen=2]="Frozen",D6),A_=((D7=A_||{})[D7.MintTokens=0]="MintTokens",D7[D7.FreezeAccount=1]="FreezeAccount",D7[D7.AccountOwner=2]="AccountOwner",D7[D7.CloseAccount=3]="CloseAccount",D7[D7.TransferFeeConfig=4]="TransferFeeConfig",D7[D7.WithheldWithdraw=5]="WithheldWithdraw",D7[D7.CloseMint=6]="CloseMint",D7[D7.InterestRate=7]="InterestRate",D7[D7.PermanentDelegate=8]="PermanentDelegate",D7[D7.ConfidentialTransferMint=9]="ConfidentialTransferMint",D7[D7.TransferHookProgramId=10]="TransferHookProgramId",D7[D7.ConfidentialTransferFeeConfig=11]="ConfidentialTransferFeeConfig",D7[D7.MetadataPointer=12]="MetadataPointer",D7[D7.GroupPointer=13]="GroupPointer",D7[D7.GroupMemberPointer=14]="GroupMemberPointer",D7[D7.ScaledUiAmount=15]="ScaledUiAmount",D7[D7.Pause=16]="Pause",D7),A0=((D8=A0||{})[D8.Uninitialized=0]="Uninitialized",D8[D8.TransferFeeConfig=1]="TransferFeeConfig",D8[D8.TransferFeeAmount=2]="TransferFeeAmount",D8[D8.MintCloseAuthority=3]="MintCloseAuthority",D8[D8.ConfidentialTransferMint=4]="ConfidentialTransferMint",D8[D8.ConfidentialTransferAccount=5]="ConfidentialTransferAccount",D8[D8.DefaultAccountState=6]="DefaultAccountState",D8[D8.ImmutableOwner=7]="ImmutableOwner",D8[D8.MemoTransfer=8]="MemoTransfer",D8[D8.NonTransferable=9]="NonTransferable",D8[D8.InterestBearingConfig=10]="InterestBearingConfig",D8[D8.CpiGuard=11]="CpiGuard",D8[D8.PermanentDelegate=12]="PermanentDelegate",D8[D8.NonTransferableAccount=13]="NonTransferableAccount",D8[D8.TransferHook=14]="TransferHook",D8[D8.TransferHookAccount=15]="TransferHookAccount",D8[D8.ConfidentialTransferFee=16]="ConfidentialTransferFee",D8[D8.ConfidentialTransferFeeAmount=17]="ConfidentialTransferFeeAmount",D8[D8.ScaledUiAmountConfig=18]="ScaledUiAmountConfig",D8[D8.PausableConfig=19]="PausableConfig",D8[D8.PausableAccount=20]="PausableAccount",D8[D8.MetadataPointer=21]="MetadataPointer",D8[D8.TokenMetadata=22]="TokenMetadata",D8[D8.GroupPointer=23]="GroupPointer",D8[D8.TokenGroup=24]="TokenGroup",D8[D8.GroupMemberPointer=25]="GroupMemberPointer",D8[D8.TokenGroupMember=26]="TokenGroupMember",D8),A1=((D9=A1||{})[D9.CreateAssociatedToken=0]="CreateAssociatedToken",D9[D9.CreateAssociatedTokenIdempotent=1]="CreateAssociatedTokenIdempotent",D9[D9.RecoverNestedAssociatedToken=2]="RecoverNestedAssociatedToken",D9),A2=((Ea=A2||{})[Ea.Mint=0]="Mint",Ea[Ea.Token=1]="Token",Ea[Ea.Multisig=2]="Multisig",Ea),A3=((Eb=A3||{})[Eb.InitializeMint=0]="InitializeMint",Eb[Eb.InitializeAccount=1]="InitializeAccount",Eb[Eb.InitializeMultisig=2]="InitializeMultisig",Eb[Eb.Transfer=3]="Transfer",Eb[Eb.Approve=4]="Approve",Eb[Eb.Revoke=5]="Revoke",Eb[Eb.SetAuthority=6]="SetAuthority",Eb[Eb.MintTo=7]="MintTo",Eb[Eb.Burn=8]="Burn",Eb[Eb.CloseAccount=9]="CloseAccount",Eb[Eb.FreezeAccount=10]="FreezeAccount",Eb[Eb.ThawAccount=11]="ThawAccount",Eb[Eb.TransferChecked=12]="TransferChecked",Eb[Eb.ApproveChecked=13]="ApproveChecked",Eb[Eb.MintToChecked=14]="MintToChecked",Eb[Eb.BurnChecked=15]="BurnChecked",Eb[Eb.InitializeAccount2=16]="InitializeAccount2",Eb[Eb.SyncNative=17]="SyncNative",Eb[Eb.InitializeAccount3=18]="InitializeAccount3",Eb[Eb.InitializeMultisig2=19]="InitializeMultisig2",Eb[Eb.InitializeMint2=20]="InitializeMint2",Eb[Eb.GetAccountDataSize=21]="GetAccountDataSize",Eb[Eb.InitializeImmutableOwner=22]="InitializeImmutableOwner",Eb[Eb.AmountToUiAmount=23]="AmountToUiAmount",Eb[Eb.UiAmountToAmount=24]="UiAmountToAmount",Eb[Eb.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",Eb[Eb.InitializeTransferFeeConfig=26]="InitializeTransferFeeConfig",Eb[Eb.TransferCheckedWithFee=27]="TransferCheckedWithFee",Eb[Eb.WithdrawWithheldTokensFromMint=28]="WithdrawWithheldTokensFromMint",Eb[Eb.WithdrawWithheldTokensFromAccounts=29]="WithdrawWithheldTokensFromAccounts",Eb[Eb.HarvestWithheldTokensToMint=30]="HarvestWithheldTokensToMint",Eb[Eb.SetTransferFee=31]="SetTransferFee",Eb[Eb.InitializeConfidentialTransferMint=32]="InitializeConfidentialTransferMint",Eb[Eb.UpdateConfidentialTransferMint=33]="UpdateConfidentialTransferMint",Eb[Eb.ConfigureConfidentialTransferAccount=34]="ConfigureConfidentialTransferAccount",Eb[Eb.ApproveConfidentialTransferAccount=35]="ApproveConfidentialTransferAccount",Eb[Eb.EmptyConfidentialTransferAccount=36]="EmptyConfidentialTransferAccount",Eb[Eb.ConfidentialDeposit=37]="ConfidentialDeposit",Eb[Eb.ConfidentialWithdraw=38]="ConfidentialWithdraw",Eb[Eb.ConfidentialTransfer=39]="ConfidentialTransfer",Eb[Eb.ApplyConfidentialPendingBalance=40]="ApplyConfidentialPendingBalance",Eb[Eb.EnableConfidentialCredits=41]="EnableConfidentialCredits",Eb[Eb.DisableConfidentialCredits=42]="DisableConfidentialCredits",Eb[Eb.EnableNonConfidentialCredits=43]="EnableNonConfidentialCredits",Eb[Eb.DisableNonConfidentialCredits=44]="DisableNonConfidentialCredits",Eb[Eb.ConfidentialTransferWithFee=45]="ConfidentialTransferWithFee",Eb[Eb.InitializeDefaultAccountState=46]="InitializeDefaultAccountState",Eb[Eb.UpdateDefaultAccountState=47]="UpdateDefaultAccountState",Eb[Eb.Reallocate=48]="Reallocate",Eb[Eb.EnableMemoTransfers=49]="EnableMemoTransfers",Eb[Eb.DisableMemoTransfers=50]="DisableMemoTransfers",Eb[Eb.CreateNativeMint=51]="CreateNativeMint",Eb[Eb.InitializeNonTransferableMint=52]="InitializeNonTransferableMint",Eb[Eb.InitializeInterestBearingMint=53]="InitializeInterestBearingMint",Eb[Eb.UpdateRateInterestBearingMint=54]="UpdateRateInterestBearingMint",Eb[Eb.EnableCpiGuard=55]="EnableCpiGuard",Eb[Eb.DisableCpiGuard=56]="DisableCpiGuard",Eb[Eb.InitializePermanentDelegate=57]="InitializePermanentDelegate",Eb[Eb.InitializeTransferHook=58]="InitializeTransferHook",Eb[Eb.UpdateTransferHook=59]="UpdateTransferHook",Eb[Eb.InitializeConfidentialTransferFee=60]="InitializeConfidentialTransferFee",Eb[Eb.WithdrawWithheldTokensFromMintForConfidentialTransferFee=61]="WithdrawWithheldTokensFromMintForConfidentialTransferFee",Eb[Eb.WithdrawWithheldTokensFromAccountsForConfidentialTransferFee=62]="WithdrawWithheldTokensFromAccountsForConfidentialTransferFee",Eb[Eb.HarvestWithheldTokensToMintForConfidentialTransferFee=63]="HarvestWithheldTokensToMintForConfidentialTransferFee",Eb[Eb.EnableHarvestToMint=64]="EnableHarvestToMint",Eb[Eb.DisableHarvestToMint=65]="DisableHarvestToMint",Eb[Eb.WithdrawExcessLamports=66]="WithdrawExcessLamports",Eb[Eb.InitializeMetadataPointer=67]="InitializeMetadataPointer",Eb[Eb.UpdateMetadataPointer=68]="UpdateMetadataPointer",Eb[Eb.InitializeGroupPointer=69]="InitializeGroupPointer",Eb[Eb.UpdateGroupPointer=70]="UpdateGroupPointer",Eb[Eb.InitializeGroupMemberPointer=71]="InitializeGroupMemberPointer",Eb[Eb.UpdateGroupMemberPointer=72]="UpdateGroupMemberPointer",Eb[Eb.InitializeScaledUiAmountMint=73]="InitializeScaledUiAmountMint",Eb[Eb.UpdateMultiplierScaledUiMint=74]="UpdateMultiplierScaledUiMint",Eb[Eb.InitializePausableConfig=75]="InitializePausableConfig",Eb[Eb.Pause=76]="Pause",Eb[Eb.Resume=77]="Resume",Eb[Eb.InitializeTokenMetadata=78]="InitializeTokenMetadata",Eb[Eb.UpdateTokenMetadataField=79]="UpdateTokenMetadataField",Eb[Eb.RemoveTokenMetadataKey=80]="RemoveTokenMetadataKey",Eb[Eb.UpdateTokenMetadataUpdateAuthority=81]="UpdateTokenMetadataUpdateAuthority",Eb[Eb.EmitTokenMetadata=82]="EmitTokenMetadata",Eb[Eb.InitializeTokenGroup=83]="InitializeTokenGroup",Eb[Eb.UpdateTokenGroupMaxSize=84]="UpdateTokenGroupMaxSize",Eb[Eb.UpdateTokenGroupUpdateAuthority=85]="UpdateTokenGroupUpdateAuthority",Eb[Eb.InitializeTokenGroupMember=86]="InitializeTokenGroupMember",Eb);new Uint8Array([250,166,180,250,13,12,184,70]),new Uint8Array([121,113,108,39,54,51,0,4]),new Uint8Array([152,32,222,176,223,237,116,134]),new Uint8Array([210,225,30,162,88,184,77,141]),new Uint8Array([234,18,32,56,89,141,37,181]),new Uint8Array([108,37,171,143,248,30,18,110]),new Uint8Array([161,105,88,1,237,221,216,203]),new Uint8Array([221,233,49,45,181,202,220,200]),new Uint8Array([215,228,166,228,84,100,86,123]),x3.union([x3.string().transform(a=>a.replace(/[^0-9.-]+/g,"")),x3.number()]).pipe(x3.coerce.number().min(1e-4).max(0x3b9ac9ff));var A4=x3.enum(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","solana-devnet","solana","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia"]),A5=new Map([["abstract",2741],["abstract-testnet",11124],["base-sepolia",84532],["base",8453],["avalanche-fuji",43113],["avalanche",43114],["iotex",4689],["sei",1329],["sei-testnet",1328],["polygon",137],["polygon-amoy",80002],["peaq",3338],["story",1514],["educhain",41923],["skale-base-sepolia",0x135a9d92]]),A6=["solana-devnet","solana"];Object.fromEntries(["abstract","abstract-testnet","base-sepolia","base","avalanche-fuji","avalanche","iotex","sei","sei-testnet","polygon","polygon-amoy","peaq","story","educhain","skale-base-sepolia",...A6].map(a=>[A5.get(a),a]));var A7={id:0x135a9d92,name:"SKALE Base Sepolia",nativeCurrency:{name:"Credits",symbol:"CREDITS",decimals:18},rpcUrls:{default:{http:["https://base-sepolia-testnet.skalenodes.com/v1/jubilant-horrible-ancha"]}},blockExplorers:{default:{name:"Blockscout",url:"https://base-sepolia-testnet-explorer.skalenodes.com",apiUrl:"https://base-sepolia-testnet-explorer.skalenodes.com/api"}}};function A8(a){let b=Bg(a);return(0,x4.createPublicClient)({chain:b,transport:(0,v0.http)()}).extend(x5.publicActions)}function A9(){return A8("base-sepolia")}function Ba(){return A8("avalanche-fuji")}function Bb(a,b){let c=Bg(a),d=(0,v_.createWalletClient)({chain:c,transport:(0,v0.http)(),account:function(a,b={}){let{nonceManager:c}=b,d=(0,eJ.toHex)(yO.secp256k1.getPublicKey(a.slice(2),!1));return{...function(a){if("string"==typeof a){if(!(0,eK.isAddress)(a,{strict:!1}))throw new yv.InvalidAddressError({address:a});return{address:a,type:"json-rpc"}}if(!(0,eK.isAddress)(a.address,{strict:!1}))throw new yv.InvalidAddressError({address:a.address});return{address:a.address,nonceManager:a.nonceManager,sign:a.sign,signAuthorization:a.signAuthorization,signMessage:a.signMessage,signTransaction:a.signTransaction,signTypedData:a.signTypedData,source:"custom",type:"local"}}({address:(0,yP.publicKeyToAddress)(d),nonceManager:c,sign:async({hash:b})=>yR({hash:b,privateKey:a,to:"hex"}),signAuthorization:async b=>yS({...b,privateKey:a}),signMessage:async({message:b})=>yU({message:b,privateKey:a}),signTransaction:async(b,{serializer:c}={})=>yW({privateKey:a,transaction:b,serializer:c}),signTypedData:async b=>yY({...b,privateKey:a})}),publicKey:d,source:"privateKey"}}(b)});return Bi(c)?d.extend(x5.publicActions).extend(a=>({sendTransaction:b=>zl(a,b),signTransaction:b=>zi(a,b),deployContract:b=>(function(a,b){let{abi:c,args:d,bytecode:e,deploymentType:f,salt:g,...h}=b,i=function(a){let{abi:b,args:c,bytecode:d,deploymentType:e,salt:f}=a;if(!c||0===c.length){let{functionName:a,argsContractDeployer:b}=y4(e,f??y$.zeroHash,(0,eJ.toHex)(yI(d)),"0x");return(0,y1.encodeFunctionData)({abi:y2,functionName:a,args:b})}let g=b.find(a=>"type"in a&&"constructor"===a.type);if(!g)throw new y_.AbiConstructorNotFoundError({docsPath:y3});if(!("inputs"in g)||!g.inputs||0===g.inputs.length)throw new y_.AbiConstructorParamsNotFoundError({docsPath:y3});let h=(0,y0.encodeAbiParameters)(g.inputs,c),{functionName:i,argsContractDeployer:j}=y4(e,f??y$.zeroHash,(0,eJ.toHex)(yI(d)),h);return(0,y1.encodeFunctionData)({abi:y2,functionName:i,args:j})}({abi:c,args:d,bytecode:e,deploymentType:f,salt:g});return h.factoryDeps=h.factoryDeps||[],h.factoryDeps.includes(e)||h.factoryDeps.push(e),zj(a,{...h,data:i,to:"create2"===f||"create2Account"===f?"0x0000000000000000000000000000000000010000":"0x0000000000000000000000000000000000008006"})})(a,b),writeContract:b=>(0,yZ.writeContract)(Object.assign(a,{sendTransaction:b=>zl(a,b)}),b)})):d.extend(x5.publicActions)}function Bc(a){return Bb("base-sepolia",a)}function Bd(a){return Bb("avalanche-fuji",a)}function Be(a){return"object"==typeof a&&null!==a&&"chain"in a&&"transport"in a}function Bf(a){return"object"==typeof a&&null!==a&&"string"==typeof a.address&&"string"==typeof a.type&&"function"==typeof a.sign&&"function"==typeof a.signMessage&&"function"==typeof a.signTypedData&&"function"==typeof a.signTransaction}function Bg(a){if(!a)throw Error("NETWORK environment variable is not set");switch(a){case"abstract":return yK;case"abstract-testnet":return yL;case"base":return ya;case"base-sepolia":return x6.baseSepolia;case"avalanche":return yg;case"avalanche-fuji":return x8;case"sei":return yb;case"sei-testnet":return yc;case"polygon":return yd;case"polygon-amoy":return ye;case"peaq":return yf;case"story":return yM;case"educhain":return yN;case"iotex":return yi;case"iotex-testnet":return yh;case"skale-base-sepolia":return A7;default:throw Error(`Unsupported network: ${a}`)}}var Bh=new Set([2741,11124]);function Bi(a){return Bh.has(a.id)}function Bj(a){return Az(a||"https://api.devnet.solana.com")}function Bk(a){return Az(a||"https://api.mainnet-beta.solana.com")}function Bl(a,b){if("solana-devnet"===a)return Bj(b);if("solana"===a)return Bk(b);throw Error("Invalid network")}function Bm(a,b){if("solana-devnet"===a)return AU(b?Bn(b):"wss://api.devnet.solana.com");if("solana"===a)return AU(b?Bn(b):"wss://api.mainnet-beta.solana.com");throw Error("Invalid network")}function Bn(a){return a.startsWith("http")?a.replace("http","ws"):a}function Bo(a){if(!A6.find(b=>b===a))throw Error(`Unsupported SVM network: ${a}`);return Bl(a)}async function Bp(a){let b=fL.base58.decode(a);if(64===b.length)return await z9(b);if(32===b.length)return await Aa(b);throw Error(`Unexpected key length: ${b.length}. Expected 32 or 64 bytes.`)}function Bq(a){return"object"==typeof a&&null!==a&&(z7(a)||z6(a)||"signAndSendTransactions"in a&&"function"==typeof a.signAndSendTransactions)}v5({},{authorizationPrimaryType:()=>Bs,authorizationTypes:()=>Br,config:()=>v6,createClientAvalancheFuji:()=>Ba,createClientSepolia:()=>A9,createConnectedClient:()=>A8,createSigner:()=>Bb,createSignerAvalancheFuji:()=>Bd,createSignerSepolia:()=>Bc,getChainFromNetwork:()=>Bg,isAccount:()=>Bf,isSignerWallet:()=>Be,isZkStackChain:()=>Bi,usdcABI:()=>v7});var Br={TransferWithAuthorization:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"validAfter",type:"uint256"},{name:"validBefore",type:"uint256"},{name:"nonce",type:"bytes32"}]},Bs="TransferWithAuthorization";v5({},{SvmAddressRegex:()=>Bt});var Bt=/^[1-9A-HJ-NP-Za-km-z]{32,44}$/,Bu=/^0x[0-9a-fA-F]{40}$/,Bv=/^0x[a-fA-F0-9]{40}|[A-Za-z0-9][A-Za-z0-9-]{0,34}[A-Za-z0-9]$/,Bw=["exact"],Bx=[1],By=["insufficient_funds","invalid_exact_evm_payload_authorization_valid_after","invalid_exact_evm_payload_authorization_valid_before","invalid_exact_evm_payload_authorization_value","invalid_exact_evm_payload_signature","invalid_exact_evm_payload_undeployed_smart_wallet","invalid_exact_evm_payload_recipient_mismatch","invalid_exact_svm_payload_transaction","invalid_exact_svm_payload_transaction_amount_mismatch","invalid_exact_svm_payload_transaction_create_ata_instruction","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_payee","invalid_exact_svm_payload_transaction_create_ata_instruction_incorrect_asset","invalid_exact_svm_payload_transaction_instructions","invalid_exact_svm_payload_transaction_instructions_length","invalid_exact_svm_payload_transaction_instructions_compute_limit_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction","invalid_exact_svm_payload_transaction_instructions_compute_price_instruction_too_high","invalid_exact_svm_payload_transaction_instruction_not_spl_token_transfer_checked","invalid_exact_svm_payload_transaction_instruction_not_token_2022_transfer_checked","invalid_exact_svm_payload_transaction_fee_payer_included_in_instruction_accounts","invalid_exact_svm_payload_transaction_fee_payer_transferring_funds","invalid_exact_svm_payload_transaction_not_a_transfer_instruction","invalid_exact_svm_payload_transaction_receiver_ata_not_found","invalid_exact_svm_payload_transaction_sender_ata_not_found","invalid_exact_svm_payload_transaction_simulation_failed","invalid_exact_svm_payload_transaction_transfer_to_incorrect_ata","invalid_network","invalid_payload","invalid_payment_requirements","invalid_scheme","invalid_payment","payment_expired","unsupported_scheme","invalid_x402_version","invalid_transaction_state","invalid_x402_version","settle_exact_svm_block_height_exceeded","settle_exact_svm_transaction_confirmation_timed_out","unsupported_scheme","unexpected_settle_error","unexpected_verify_error"],Bz=a=>Number.isInteger(Number(a))&&Number(a)>=0,BA=x3.string().regex(Bu).or(x3.string().regex(Bt)),BB=x3.string().regex(Bv).or(x3.string().regex(Bt)),BC=x3.object({scheme:x3.enum(Bw),network:A4,maxAmountRequired:x3.string().refine(Bz),resource:x3.string().url(),description:x3.string(),mimeType:x3.string(),outputSchema:x3.record(x3.any()).optional(),payTo:BA,maxTimeoutSeconds:x3.number().int(),asset:BB,extra:x3.record(x3.any()).optional()}),BD=x3.object({from:x3.string().regex(Bu),to:x3.string().regex(Bu),value:x3.string().refine(Bz).refine(a=>a.length<=18),validAfter:x3.string().refine(Bz),validBefore:x3.string().refine(Bz),nonce:x3.string().regex(/^0x[0-9a-fA-F]{64}$/)}),BE=x3.object({signature:x3.string().regex(/^0x[0-9a-fA-F]+$/),authorization:BD}),BF=x3.object({transaction:x3.string().regex(/^[A-Za-z0-9+/]*={0,2}$/)}),BG=x3.object({x402Version:x3.number().refine(a=>Bx.includes(a)),scheme:x3.enum(Bw),network:A4,payload:x3.union([BE,BF])});x3.object({x402Version:x3.number().refine(a=>Bx.includes(a)),error:x3.enum(By).optional(),accepts:x3.array(BC).optional(),payer:x3.string().regex(Bv).optional()});var BH=x3.enum(["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD"]),BI=x3.object({type:x3.literal("http"),method:BH,queryParams:x3.record(x3.string(),x3.string()).optional(),bodyType:x3.enum(["json","form-data","multipart-form-data","text","binary"]).optional(),bodyFields:x3.record(x3.string(),x3.any()).optional(),headerFields:x3.record(x3.string(),x3.any()).optional()});x3.discriminatedUnion("type",[BI]);var BJ=x3.object({resource:x3.string(),type:x3.enum(["http"]),x402Version:x3.number().refine(a=>Bx.includes(a)),accepts:x3.array(BC),lastUpdated:x3.date(),metadata:x3.record(x3.any()).optional()});x3.object({paymentPayload:BG,paymentRequirements:BC}),x3.object({paymentPayload:BG,paymentRequirements:BC}),x3.object({isValid:x3.boolean(),invalidReason:x3.enum(By).optional(),payer:BA.optional()}),x3.object({success:x3.boolean(),errorReason:x3.enum(By).optional(),payer:BA.optional(),transaction:x3.string().regex(Bv),network:A4}),x3.object({type:x3.string().optional(),limit:x3.number().optional(),offset:x3.number().optional()}),x3.object({x402Version:x3.number().refine(a=>Bx.includes(a)),items:x3.array(BJ),pagination:x3.object({limit:x3.number(),offset:x3.number(),total:x3.number()})});var BK=x3.object({x402Version:x3.number().refine(a=>Bx.includes(a)),scheme:x3.enum(Bw),network:A4,extra:x3.record(x3.any()).optional()});function BL(a){try{let b=zv({getSizeFromValue:a=>Buffer.from(a,"base64").length,write(a,b,c){!function(a,b,c=b){if(!b.match(RegExp(`^[${a}]*$`)))throw new zn(8078012,{alphabet:a,base:a.length,value:c})}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a.replace(/=/g,""));let d=Buffer.from(a,"base64");return b.set(d,c),d.length+c}}).encode(a.transaction);return zB(zZ([["signatures",zV(zA(zY(),64),{size:zQ()})],["messageBytes",zY()]]),z2).decode(b)}catch(a){throw console.error("error",a),Error("invalid_exact_svm_payload_transaction")}}function BM(a){let b,c=zB(zZ([["version",z0()],["header",zZ([["numSignerAccounts",z_()],["numReadonlySignerAccounts",z_()],["numReadonlyNonSignerAccounts",z_()]])],["staticAccounts",zV(zD(),{size:zQ()})],["lifetimeToken",zA((b="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",zw({read(a,c){let d=0===c?a:a.slice(c);if(0===d.length)return["",0];let e=d.findIndex(a=>0!==a);e=-1===e?d.length:e;let f=b[0].repeat(e);return e===d.length?[f,a.length]:[f+function(a,b){let c=BigInt(b.length),d=[];for(;a>0n;)d.unshift(b[Number(a%c)]),a/=c;return d.join("")}(d.slice(e).reduce((a,b)=>256n*a+BigInt(b),0n),b),a.length]}})),32)],["instructions",zV((!Eq&&(Eq=zB(zZ([["programAddressIndex",zR()],["accountIndices",zV(zR(),{size:zQ()})],["data",function(a,b){let c=(c,d)=>{let[e,f]=b.read(c,d),g=Number(e);return((d=f)>0||c.length>g)&&(c=c.slice(d,d+g)),zy("addDecoderSizePrefix",g,c),[a.decode(c),d+g]};if(zx(b)&&zx(a))return zw({...a,fixedSize:b.fixedSize+a.fixedSize,read:c});let d=zx(b)?b.fixedSize:b.maxSize??null,e=zx(a)?a.fixedSize:a.maxSize??null,f=null!==d&&null!==e?d+e:null;return zw({...a,...null!==f?{maxSize:f}:{},read:c})}(zY(),zQ())]]),a=>{if(a.accountIndices.length&&a.data.byteLength)return a;let{accountIndices:b,data:c,...d}=a;return{...d,...b.length?{accountIndices:b}:null,...c.byteLength?{data:c}:null}})),Eq),{size:zQ()})],["addressTableLookups",zV(function(){if(!Eo){let a=zV(zR(),{size:zQ()});Eo=zZ([["lookupTableAddress",zD()],["writableIndexes",a],["readonlyIndexes",a]])}return Eo}(),{size:zQ()})]]),({addressTableLookups:a,...b})=>"legacy"!==b.version&&a?.length?{...b,addressTableLookups:a}:b).decode(a.messageBytes),d=c.staticAccounts??[];for(let a of c.instructions??[]){let b=d[a.programAddressIndex].toString();if(b==="TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA".toString()||b==="TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb".toString()){let b=a.accountIndices??[];if(b.length>=4){let a=d[b[3]].toString();if(a)return a}}}return""}async function BN(a,b,c){var d,e;let f,g,h,i,j=(d=await BO(a,b),i=(g=zS((f=(e=[["signatures",function(){var a,b=function(a,b={}){let c=b.size??((a={})=>{var b;return zv({fixedSize:(b={config:a,name:"u32",range:[0,Number("0xffffffff")],set:(a,b,c)=>a.setUint32(0,Number(b),c),size:4}).size,write(a,c,d){b.range&&zM(b.name,b.range[0],b.range[1],a);let e=new ArrayBuffer(b.size);return b.set(new DataView(e),a,zO(b.config)),c.set(new Uint8Array(e),d),d+b.size}})})(),d=zW(c,zT(a)),e=zW(c,zU(a))??void 0;return zv({...null!==d?{fixedSize:d}:{getSizeFromValue:b=>("object"==typeof c?zu(b.length,c):0)+[...b].reduce((b,c)=>b+zu(c,a),0),maxSize:e},write:(b,d,e)=>("number"==typeof c&&function(a,b,c){if(b!==c)throw new zn(8078007,{actual:c,codecDescription:a,expected:b})}("array",c,b.length),"object"==typeof c&&(e=c.write(b.length,d,e)),b.forEach(b=>{e=a.write(b,d,e)}),e)})}((a=zX(),zv({fixedSize:64,write:(b,c,d)=>{let e=a.encode(b),f=e.length>64?e.slice(0,64):e;return c.set(f,d),d+64}})),{size:zv({getSizeFromValue:a=>a<=127?1:a<=16383?2:3,maxSize:3,write:(a,b,c)=>{zM("shortU16",0,65535,a);let d=[0];for(let b=0;;b+=1){let c=Number(a)>>7*b;if(0===c)break;let e=127&c;d[b]=e,b>0&&(d[b-1]|=128)}return b.set(d,c),c+d.length}})});return zv({...!zx(b)?{...b,getSizeFromValue:a=>b.getSizeFromValue(z1(a))}:b,write:(a,c,d)=>b.write(z1(a),c,d)})}()],["messageBytes",zX()]]).map(([,a])=>a)).map(zT)),h=zS(f.map(zU))??void 0,zv({...null===g?{getSizeFromValue:a=>e.map(([b,c])=>zu(a[b],c)).reduce((a,b)=>a+b,0),maxSize:h}:{fixedSize:g},write:(a,b,c)=>(e.forEach(([d,e])=>{c=e.write(a[d],b,c)}),c)})).encode(d),zw({read:(a,b=0)=>[Buffer.from(a,b).toString("base64"),a.length]}).decode(i));return await c.simulateTransaction(j,{sigVerify:!0,replaceRecentBlockhash:!1,commitment:"confirmed",encoding:"base64",accounts:void 0,innerInstructions:void 0,minContextSlot:void 0}).send()}async function BO(a,b){if(z6(a)){let[c]=await a.modifyAndSignTransactions([b]);if(!c)throw Error("transaction_signer_failed_to_return_transaction");return c}if(z7(a)){var c,d;let[e]=await a.signTransactions([b]);if(!e)throw Error("transaction_signer_failed_to_return_signatures");return c=b,d=e,Object.freeze({...c,signatures:Object.freeze({...c.signatures,...d})})}throw Error("transaction_signer_must_support_offline_signing")}x3.object({kinds:x3.array(BK)}),v5({},{createDevnetRpcClient:()=>Bj,createMainnetRpcClient:()=>Bk,createSignerFromBase58:()=>Bp,createSvmConnectedClient:()=>Bo,decodeTransactionFromPayload:()=>BL,getRpcClient:()=>Bl,getRpcSubscriptions:()=>Bm,getTokenPayerFromTransaction:()=>BM,isSignerWallet:()=>Bq,signAndSimulateTransaction:()=>BN,signTransactionWithSigner:()=>BO}),x3.object({paymentHeader:x3.string(),paymentRequirements:BC});var BP=((Ec=BP||{})[Ec.RequestUnits=0]="RequestUnits",Ec[Ec.RequestHeapFrame=1]="RequestHeapFrame",Ec[Ec.SetComputeUnitLimit=2]="SetComputeUnitLimit",Ec[Ec.SetComputeUnitPrice=3]="SetComputeUnitPrice",Ec[Ec.SetLoadedAccountsDataSizeLimit=4]="SetLoadedAccountsDataSizeLimit",Ec);a.s([],309696),a.i(389337),a.i(602275);class BQ{static parse(a){try{return new BQ(a)}catch(a){return null}}static throwIfNotWellFormedJwt(a){return cH(a),a}get subject(){return this._decoded.sub}get expiration(){return this._decoded.exp}get issuer(){return this._decoded.iss}get audience(){return this._decoded.aud}isExpired(a=0){return Date.now()>=1e3*(this.expiration-a)}constructor(a){this.value=a,this._decoded=cH(a)}}class BR extends BQ{static parse(a){try{return new BR(a)}catch(a){return null}}get appId(){return this._decoded.aid?this._decoded.aid:this.audience}}let BS=({style:a,...b})=>(0,R.jsxs)("svg",{viewBox:"0 0 1024 1024",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{height:"28px",width:"28px",...a},...b,children:[(0,R.jsx)("rect",{width:"1024",height:"1024",fill:"#0052FF",rx:100,ry:100}),(0,R.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 512C152 710.823 313.177 872 512 872C710.823 872 872 710.823 872 512C872 313.177 710.823 152 512 152C313.177 152 152 313.177 152 512ZM420 396C406.745 396 396 406.745 396 420V604C396 617.255 406.745 628 420 628H604C617.255 628 628 617.255 628 604V420C628 406.745 617.255 396 604 396H420Z",fill:"white"})]}),BT="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PScwIDAgMTAyNCAxMDI0JyBmaWxsPSdub25lJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHN0eWxlPSdoZWlnaHQ6MjhweDt3aWR0aDoyOHB4Jz48cmVjdCB3aWR0aD0nMTAyNCcgaGVpZ2h0PScxMDI0JyBmaWxsPScjMDA1MkZGJyByeD0nMTAwJyByeT0nMTAwJz48L3JlY3Q+PHBhdGggZmlsbC1ydWxlPSdldmVub2RkJyBjbGlwLXJ1bGU9J2V2ZW5vZGQnIGQ9J00xNTIgNTEyQzE1MiA3MTAuODIzIDMxMy4xNzcgODcyIDUxMiA4NzJDNzEwLjgyMyA4NzIgODcyIDcxMC44MjMgODcyIDUxMkM4NzIgMzEzLjE3NyA3MTAuODIzIDE1MiA1MTIgMTUyQzMxMy4xNzcgMTUyIDE1MiAzMTMuMTc3IDE1MiA1MTJaTTQyMCAzOTZDNDA2Ljc0NSAzOTYgMzk2IDQwNi43NDUgMzk2IDQyMFY2MDRDMzk2IDYxNy4yNTUgNDA2Ljc0NSA2MjggNDIwIDYyOEg2MDRDNjE3LjI1NSA2MjggNjI4IDYxNy4yNTUgNjI4IDYwNFY0MjBDNjI4IDQwNi43NDUgNjE3LjI1NSAzOTYgNjA0IDM5Nkg0MjBaJyBmaWxsPSd3aGl0ZSc+PC9wYXRoPjwvc3ZnPg==",BU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAALZJREFUaEPtmjEOhDAMBNc/O14GvOzys3CAKK6eAlmaVGl2Zc+kTOU685vkc9/bnD2prZK5/TZY24z9P+g4F5hNh7/GdoG37WlAA5CATwgCxHENYISwQAMQII5rACOEBRqAAHFcAxghLNAABIjjGsAIYYEGIEAc1wBGCAs0AAHiuAYwQligAQgQxzWAEcICDUCAOK4BjBAWaAACxHENYISwQAMQII6fBjr+VHkW3+u+tfyxMpJaDgYzYxb/ALZVAAAAAElFTkSuQmCC";class BV extends cR.E{async initialize(){await this.importPromise,await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(a){return a.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:BU,id:"com.coinbase.wallet"}}async promptConnection(){try{await this.importPromise;let a=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!a||0===a.length||!a[0])throw new cT.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([a[0]])}catch(a){throw(0,cU.f)(a)}}constructor(b,c,d,e,f){super("base_account",b,c,d),this.connectorType="base_account",this.walletClientType="base_account",this.displayName="Base",this.setBaseAccountSdk=f,this.proxyProvider=new cR.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.baseAccountConfig={...e,appChainIds:[c.id].concat(b.map(a=>a.id))},h?(this.proxyProvider.setWalletProvider(h.getProvider()),this.setBaseAccountSdk(h)):this.importPromise=a.A(927566).then(({createBaseAccountSDK:a})=>{h=a(this.baseAccountConfig),this.proxyProvider.setWalletProvider(h.getProvider()),this.setBaseAccountSdk(h)}).catch(console.error)}}let BW=[1,0xaa36a7,137,10,8453,84532,42161,7777777,43114,56];class BX extends cR.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(a){return a.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}disconnect(){this.proxyProvider.walletProvider.disconnect(),this.onDisconnect()}get walletBranding(){return{name:this.displayName,icon:BT,id:"com.coinbase.wallet"}}async promptConnection(){try{let a=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!a||0===a.length||!a[0])throw new cT.P("Unable to retrieve accounts");this.connected=!0,await this.syncAccounts([a[0]])}catch(a){throw(0,cU.f)(a)}}updateConnectionPreference(a){this.coinbaseWalletConfig={...this.coinbaseWalletConfig,preference:{...this.coinbaseWalletConfig.preference,options:a}},this.walletClientType="smartWalletOnly"===a?"coinbase_smart_wallet":"coinbase_wallet",i=eF({...this.coinbaseWalletConfig}),this.proxyProvider.setWalletProvider(i.getProvider())}constructor(a,b,c,d){if(super("coinbase_wallet",a,b,c),this.connectorType="coinbase_wallet",this.displayName="Coinbase Wallet",this.proxyProvider=new cR.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.coinbaseWalletConfig={...d,appChainIds:[b.id].concat(a.map(a=>a.id))},this.walletClientType="smartWalletOnly"===this.coinbaseWalletConfig.preference?.options?"coinbase_smart_wallet":"coinbase_wallet","coinbase_smart_wallet"===this.walletClientType&&(this.displayName="Coinbase Smart Wallet"),!i){let a="eoaOnly"!==this.coinbaseWalletConfig.preference?.options?(this.coinbaseWalletConfig.appChainIds??[]).filter(a=>!BW.includes(a)):[];a.length>0&&!a.every(a=>U.DEFAULT_SUPPORTED_CHAIN_IDS.has(a))&&console.info(`The configured chains are not supported by Coinbase Smart Wallet: ${a.join(", ")}`),i=eF(this.coinbaseWalletConfig)}this.proxyProvider.setWalletProvider(i.getProvider())}}let BY=({...a})=>(0,R.jsx)("svg",{width:"15",height:"15",viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a,children:(0,R.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.37126 11.0323C2.37126 12.696 3.90598 13.4421 5.40654 13.4468C8.91753 13.4468 12.8021 11.2897 12.7819 7.67984C12.7673 5.07728 10.3748 2.86167 7.54357 2.88296C4.8495 2.88296 2.21821 4.6411 2.21803 7.03628C2.21803 7.67951 2.58722 8.30178 3.55231 8.37184C2.74763 9.16826 2.37126 10.1225 2.37126 11.0323ZM7.55283 8.68012C8.11562 8.68012 8.57186 8.13217 8.57186 7.45624C8.57186 6.78032 8.11562 6.23237 7.55283 6.23237C6.99003 6.23237 6.53379 6.78032 6.53379 7.45624C6.53379 8.13217 6.99003 8.68012 7.55283 8.68012ZM10.4747 8.68012C11.0375 8.68012 11.4937 8.13217 11.4937 7.45625C11.4937 6.78032 11.0375 6.23237 10.4747 6.23237C9.91186 6.23237 9.45562 6.78032 9.45562 7.45625C9.45562 8.13217 9.91186 8.68012 10.4747 8.68012Z",fill:a.color||"var(--privy-color-foreground-3)"})});class BZ extends cR.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(a){return await this.isConnected()?(await this.proxyProvider.request({method:"wallet_switchEthereumChain",params:[(0,cR.t)(a?.chainId||"0x1")]}),this.getConnectedWallet()):null}get walletBranding(){return{name:"Privy Wallet",icon:BY,id:"io.privy.wallet"}}disconnect(){this.connected=!1}async promptConnection(){}constructor({provider:a,chains:b,defaultChain:c,rpcConfig:d,imported:e,walletIndex:f}){super("privy",b,c,d),this.connectorType="embedded",this.proxyProvider=a,this.walletIndex=f,e&&(this.connectorType="embedded_imported"),this.subscribeListeners()}}async function B$(){let a=ED();return a?a.getAccessToken():Promise.resolve(cU.u.get(eH.P)||cU.u.get(eH.C)||null)}let B_=["eth_sign","eth_populateTransactionRequest","eth_signTransaction","personal_sign","eth_signTypedData_v4","csw_signUserOperation","secp256k1_sign"];function B0(a){return a?{"privy-ui":"t"}:void 0}class B1{async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new cT.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(e7,{email:this.meta.email,code:this.meta.emailCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode)throw new cT.a("Email and email code must be set prior to calling authenticate.");try{return await this.api.post(e8,{email:this.meta.email,code:this.meta.emailCode})}catch(a){throw(0,cT.f)(a)}}async sendCodeEmail({email:a,captchaToken:b,withPrivyUi:c}){if(!this.api)throw new cT.a("Auth flow has no API instance");if(a&&(this.meta.email=a),b&&(this.meta.captchaToken=b),!this.meta.email)throw new cT.a("Email must be set when initialzing authentication.");let d=B0(c);try{return await this.api.post(e6,{email:this.meta.email,token:this.meta.captchaToken},{headers:{...d}})}catch(a){throw(0,cT.f)(a)}}constructor({email:a,captchaToken:b,disableSignup:c}){this.meta={email:a,captchaToken:b,disableSignup:c??!1}}}class B2 extends B1{async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.email||!this.meta.emailCode||!this.meta.oldAddress)throw new cT.a("Email, email code, and an old email address must be set prior to calling update.");try{return await this.api.post(fa,{oldAddress:this.meta.oldAddress,newAddress:this.meta.email,code:this.meta.emailCode})}catch(a){throw(0,cT.f)(a)}}constructor(a,b,c){super({email:b,captchaToken:c}),this.meta={email:b,captchaToken:c,oldAddress:a,disableSignup:!1}}}class B3{execute(a){return null===this.promise&&(this.promise=(async()=>{try{return await this.fn(a)}finally{this.promise=null}})()),this.promise}constructor(a){this.promise=null,this.fn=a}}class B4{get meta(){return this._meta}async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new cT.a("Auth flow must be initialized first");try{let a=await this.api.post(e1,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});if(!a)throw new cT.a("No response from authentication");return a}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(e2,{channel_token:this.meta.channelToken,message:this.message,signature:this.signature,fid:this.fid})}catch(a){throw(0,cT.f)(a)}}async _startChannelOnce(){if(!this.api)throw new cT.a("Auth flow has no API instance");let a=await this.api.post(e0,{token:this.captchaToken});eI.isMobile&&!eI.isIOS&&a.connect_uri&&(0,fK.o)(a.connect_uri,"_blank"),this._meta={...this._meta,connectUri:a.connect_uri,channelToken:a.channel_token}}async initializeFarcasterConnect(){if(!this.api)throw new cT.a("Auth flow has no API instance");await this.startChannelOnce.execute()}async _pollForReady(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.channelToken)throw new cT.a("Auth flow must be initialized first");let a=await this.api.get(e3,{headers:{"farcaster-channel-token":this.meta.channelToken}});return"completed"===a.state&&(this.message=a.message,this.signature=a.signature,this.fid=a.fid,!0)}constructor(a,b=!1){this._meta={disableSignup:!1},this.captchaToken=a,this.startChannelOnce=new B3(this._startChannelOnce.bind(this)),this.pollForReady=new B3(this._pollForReady.bind(this)),this._meta.disableSignup=b}}function B5(){}async function B6(a){return new Promise((a,b)=>{b(Error("Chrome identity API not available"))})}function B7(a){return crypto.getRandomValues(new Uint8Array(a))}function B8(){return cO.encode(B7(36))}function B9(){return B8()}async function Ca(a,b="S256"){if("S256"!=b)return a;{let b=await async function(a){let b=(new TextEncoder).encode(a);return new Uint8Array(await crypto.subtle.digest("SHA-256",b))}(a);return cO.encode(b)}}class Cb{addCaptchaToken(a){this.meta.captchaToken=a}isActive(){return!!(this.meta.authorizationCode&&this.meta.stateCode&&this.meta.provider)}async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new cT.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling authenticate.");if("undefined"===this.meta.authorizationCode)throw new cT.a("User denied confirmation during OAuth flow");let a=function(){let a=cU.u.get(eH.a);if(!a)throw new cT.a("Authentication error.");return a}();try{let b=await this.api.post(fj,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:a,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"});return cU.u.del(eH.a),cU.u.del(eH.H),cU.u.del(eH.O),b}catch(b){let a=(0,cT.f)(b);if(a.privyErrorCode)throw new cT.a(a.message||"Invalid code during OAuth flow.",void 0,a.privyErrorCode);if("User denied confirmation during OAuth flow"===a.message)throw new cT.a("Invalid code during oauth flow.",void 0,cT.b.OAUTH_USER_DENIED);throw new cT.a("Invalid code during OAuth flow.",void 0,cT.b.UNKNOWN_AUTH_ERROR)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.authorizationCode||!this.meta.stateCode)throw new cT.a("[OAuth AuthFlow] Authorization and state codes code must be set prior to calling link.");if("undefined"===this.meta.authorizationCode)throw new cT.a("User denied confirmation during OAuth flow");let a=cU.u.get(eH.a);if(!a)throw new cT.a("Authentication error.");try{let b=await this.api.post(fk,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:a});return cU.u.del(eH.a),b}catch(a){throw(0,cT.f)(a)}}async getAuthorizationUrl(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.provider)throw new cT.a("Provider must be set when initializing OAuth authentication.");let a=B8();cU.u.put(eH.a,a);let b=B9();cU.u.put(eH.S,b);let c=await Ca(a);this.meta.withPrivyUi||cU.u.put(eH.H,!0),this.meta.disableSignup?cU.u.put(eH.O,!0):cU.u.del(eH.O);let d=B0(this.meta.withPrivyUi),e=window.location.href,f=function(){let a=B5();if(a)return`https://${a}.chromiumapp.org`}();f&&(e=f);try{return await this.api.post(fi,{provider:this.meta.provider,redirect_to:this.meta.customOAuthRedirectUrl||e,token:this.meta.captchaToken,code_challenge:c,state_code:b},{headers:{...d}})}catch(a){throw(0,cT.f)(a)}}constructor(a){this.meta=a}}function Cc(){let a=new URL(window.location.href);a.searchParams.delete("privy_oauth_code"),a.searchParams.delete("privy_oauth_provider"),a.searchParams.delete("privy_oauth_state"),cU.u.del(eH.S),window.history.replaceState({},"",a)}class Cd{async initRegisterFlow(a){if(!this.api)throw new cT.a("Auth flow has no API instance");this.authenticateForRegistration=!0,this.meta.initRegisterResponse=await this.initRegisterOnce.execute(a)}async initAuthenticationFlow(a){if(!this.api)throw new cT.a("Auth flow has no API instance");this.authenticateForRegistration=!1,this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute(a)}async initLinkFlow(){if(!this.api)throw new cT.a("Auth flow has no API instance");this.meta.initLinkResponse=await this.initLinkOnce.execute()}async register(){let b=await a.A(148649);if(!this.api)throw new cT.a("Auth flow has no API instance");if(!b.browserSupportsWebAuthn())throw new cT.a("WebAuthn is not supported in this browser");this.meta.initRegisterResponse||(this.meta.initRegisterResponse=await this.initRegisterOnce.execute());try{let a=this.meta.initRegisterResponse.options,c=await b.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(a)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(fs,{relying_party:this.meta.initRegisterResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(c)})}catch(a){if("NotAllowedError"===a.name)throw new cT.a("Passkey request timed out or rejected by user.",void 0,cT.b.PASSKEY_NOT_ALLOWED);throw(0,cT.f)(a)}}async authenticate(){if(this.authenticateForRegistration)return this.register();let b=await a.A(148649);if(!this.api)throw new cT.a("Auth flow has no API instance");if(!b.browserSupportsWebAuthn())throw new cT.a("WebAuthn is not supported in this browser");this.meta.initAuthenticateResponse||(this.meta.initAuthenticateResponse=await this.initAuthenticateOnce.execute());let c=this.meta.allowedCredentialsIds?.map(a=>({type:"public-key",id:a}))??this.meta.initAuthenticateResponse.options.allow_credentials;try{let a=await b.startAuthentication({optionsJSON:this._transformInitAuthenticateOptionsToCamelCase({...this.meta.initAuthenticateResponse.options,allow_credentials:c})});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(fr,{relying_party:this.meta.initAuthenticateResponse.relying_party,challenge:this.meta.initAuthenticateResponse.options.challenge,authenticator_response:this._transformAuthenticationResponseToSnakeCase(a)})}catch(a){if("NotAllowedError"===a.name)throw new cT.a("Passkey request timed out or rejected by user.",void 0,cT.b.PASSKEY_NOT_ALLOWED);throw(0,cT.f)(a)}}async link(){let b=await a.A(148649);if(!this.api)throw new cT.a("Auth flow has no API instance");if(!b.browserSupportsWebAuthn())throw new cT.a("WebAuthn is not supported in this browser");this.meta.initLinkResponse||(this.meta.initLinkResponse=await this.initLinkOnce.execute());try{let a=this.meta.initLinkResponse.options,c=await b.startRegistration({optionsJSON:this._transformInitLinkOptionsToCamelCase(a)});return this.meta.setPasskeyAuthState?.({status:"submitting-response"}),await this.api.post(fq,{relying_party:this.meta.initLinkResponse.relying_party,authenticator_response:this._transformRegistrationResponseToSnakeCase(c)})}catch(a){if("NotAllowedError"===a.name)throw new cT.a("Passkey request timed out or rejected by user.",void 0,cT.b.PASSKEY_NOT_ALLOWED);throw(0,cT.f)(a)}}async _initRegisterOnce(a){if(!this.api)throw new cT.a("Auth flow has no API instance");let b=B0(a);return await this.api.post(fp,{token:this.meta.captchaToken},{headers:{...b}})}async _initAuthenticateOnce(a){if(!this.api)throw new cT.a("Auth flow has no API instance");let b=B0(a);return await this.api.post(fo,{token:this.meta.captchaToken},{headers:{...b}})}async _initLinkOnce(){if(!this.api)throw new cT.a("Auth flow has no API instance");return await this.api.post(fn,{})}_transformInitLinkOptionsToCamelCase(a){return{rp:a.rp,user:{id:a.user.id,name:a.user.name,displayName:a.user.display_name},challenge:a.challenge,pubKeyCredParams:a.pub_key_cred_params.map(a=>({type:a.type,alg:a.alg})),timeout:a.timeout,excludeCredentials:a.exclude_credentials?.map(a=>({id:a.id,type:a.type,transports:a.transports})),authenticatorSelection:{authenticatorAttachment:a.authenticator_selection?.authenticator_attachment,requireResidentKey:a.authenticator_selection?.require_resident_key,residentKey:a.authenticator_selection?.resident_key,userVerification:a.authenticator_selection?.user_verification},attestation:a.attestation,extensions:{appid:a.extensions?.app_id,credProps:a.extensions?.cred_props?.rk,hmacCreateSecret:a.extensions?.hmac_create_secret},hints:this.meta.hints}}_transformRegistrationResponseToSnakeCase(a){return{id:a.id,raw_id:a.rawId,response:{client_data_json:a.response.clientDataJSON,attestation_object:a.response.attestationObject,authenticator_data:a.response.authenticatorData},authenticator_attachment:a.authenticatorAttachment,client_extension_results:{app_id:a.clientExtensionResults.appid,cred_props:a.clientExtensionResults.credProps,hmac_create_secret:a.clientExtensionResults.hmacCreateSecret},type:a.type}}_transformInitAuthenticateOptionsToCamelCase(a){return{rpId:a.rp_id,challenge:a.challenge,allowCredentials:a.allow_credentials?.map(a=>({id:a.id,type:a.type,transports:a.transports}))||[],timeout:a.timeout,extensions:{appid:a.extensions?.app_id,credProps:a.extensions?.cred_props,hmacCreateSecret:a.extensions?.hmac_create_secret},userVerification:a.user_verification}}_transformAuthenticationResponseToSnakeCase(a){return{id:a.id,raw_id:a.rawId,response:{client_data_json:a.response.clientDataJSON,authenticator_data:a.response.authenticatorData,signature:a.response.signature,user_handle:a.response.userHandle},authenticator_attachment:a.authenticatorAttachment,client_extension_results:{app_id:a.clientExtensionResults.appid,cred_props:a.clientExtensionResults.credProps,hmac_create_secret:a.clientExtensionResults.hmacCreateSecret},type:a.type}}constructor({captchaToken:a,setPasskeyAuthState:b,hints:c}){this.authenticateForRegistration=!1,this.initRegisterOnce=new B3(this._initRegisterOnce.bind(this)),this.initAuthenticateOnce=new B3(this._initAuthenticateOnce.bind(this)),this.initLinkOnce=new B3(this._initLinkOnce.bind(this)),this.meta={captchaToken:a,setPasskeyAuthState:b,hints:c}}}let Ce=({address:a,chainId:b,nonce:c})=>`${window.location.host} wants you to sign in with your Ethereum account:
${a}

By signing, you are proving you own this wallet and logging in. This does not initiate a transaction or cost any fees.

URI: ${window.location.origin}
Version: 1
Chain ID: ${b}
Nonce: ${c}
Issued At: ${(new Date).toISOString()}
Resources:
- https://privy.io`;class Cf{get meta(){return{connectorType:this.wallet?.connectorType,walletClientType:this.wallet?.walletClientType,chainId:this.wallet?.chainId,address:this.wallet?.address,disableSignup:this._meta.disableSignup}}async authenticate(){if(!this.client)throw new cT.a("SiweFlow has no client instance");try{if(this.preparedMessage&&this.signature)return await this.client.authenticateWithSiweInternal({message:this.preparedMessage,signature:this.signature,chainId:this.wallet?.chainId,walletClientType:this.walletClientType??this.wallet?.walletClientType,connectorType:this.connectorType??this.wallet?.connectorType,mode:this._meta.disableSignup?"no-signup":"login-or-sign-up"});if(!this.wallet)throw new cT.a("SiweFlow has no wallet instance");let{message:a,signature:b}=await this.sign();return await this.client.authenticateWithSiweInternal({message:a,signature:b,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.client)throw new cT.a("SiweFlow has no client instance");try{if(!this.wallet)throw new cT.a("SiweFlow has no wallet instance");let{message:a,signature:b}=await this.sign();return await this.client.linkWithSiweInternal({message:a,signature:b,chainId:this.wallet.chainId,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType})}catch(a){throw(0,cT.f)(a)}}async sign(){if(!this.client)throw new cT.a("SiweFlow has no client instance");if(await this.buildMessage(),!this.preparedMessage)throw new cT.a("Could not prepare SIWE message");if(!this.wallet)throw new cT.a("SiweFlow has no wallet instance");let a=await this.wallet.sign(this.preparedMessage);return{message:this.preparedMessage,signature:a}}async _getNonceOnce(){if(!this.client)throw new cT.a("SiweFlow has no client instance");if(!this.wallet)throw new cT.a("UI SiweFlow has no wallet instance");return await this.client.generateSiweNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new cT.a("SiweFlow has no client instance");if(!this.wallet)throw new cT.a("SiweFlow has no wallet instance");let a=this.wallet.address,b=this.wallet.chainId.replace("eip155:","");return this.nonce||(this.nonce=await this.getNonceOnce.execute()),this.preparedMessage=Ce({address:a,chainId:b,nonce:this.nonce}),this.preparedMessage}constructor(a,b,c,d=!1,e){this._meta={disableSignup:!1},this.getNonceOnce=new B3(this._getNonceOnce.bind(this)),this.wallet=b,this.captchaToken=c,this.client=a,this._meta.disableSignup=d,this.preparedMessage=e?.message,this.signature=e?.signature,this.walletClientType=e?.walletClientType,this.connectorType=e?.connectorType}}class Cg{get meta(){return{connectorType:this.wallet.connectorType,walletClientType:this.wallet.walletClientType,disableSignup:this._meta.disableSignup,messageType:this._meta.messageType,address:this.wallet?.address}}set messageType(a){this._meta.messageType=a}async authenticate(){if(!this.client)throw new cT.a("SiwsFlow has no client instance");try{let{message:a,signature:b}=await this.sign();return await this.client.authenticateWithSiwsInternal({message:a,signature:b,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up",messageType:this.meta.messageType})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.client)throw new cT.a("SiwsFlow has no client instance");try{let{message:a,signature:b}=await this.sign();return await this.client.linkWithSiwsInternal({message:a,signature:b,walletClientType:this.wallet.walletClientType,connectorType:this.wallet.connectorType,messageType:this.meta.messageType})}catch(a){throw(0,cT.f)(a)}}async sign(){let a,b;if(!this.client)throw new cT.a("SiwsFlow has no client instance");await this.buildMessage();let c="transaction"===this.meta.messageType;if(!this.preparedMessage)throw new cT.a("Could not prepare SIWS message");if(!c&&!this.wallet.provider.signMessage||c&&!this.wallet.provider.signTransaction)throw new cT.a("Wallet does not support the necessary signing methods");if(c&&this._plugin){let c=await this.wallet.provider.signTransaction({transaction:fL.base64.decode(this.preparedMessage)});a=fL.base64.encode(c.signedTransaction),b=this._plugin.getSignatureFromTransaction(c.signedTransaction,this.wallet.address)}else{a=this.preparedMessage;let c=await this.wallet.provider.signMessage({message:(new TextEncoder).encode(this.preparedMessage)});b=fL.base64.encode(c.signature)}return{message:a,signature:b}}async _getNonceOnce(){if(!this.client)throw new cT.a("SiwsFlow has no client instance");return await this.client.generateSiwsNonce({address:this.wallet.address,captchaToken:this.captchaToken})}async buildMessage(){if(!this.client)throw new cT.a("SiwsFlow has no client instance");let a=this.wallet.address;return this.nonce||(this.nonce=await this.getNonceOnce.execute()),"transaction"===this.meta.messageType&&this._plugin?this.preparedMessage=this._plugin.createSiwsMemoTransaction({address:a,nonce:this.nonce}):this.preparedMessage=(0,fK.p)({address:a,nonce:this.nonce}),this.preparedMessage}constructor(a,b,c,d=!1,e="plain",f){this._meta={disableSignup:!1,messageType:"plain"},this.getNonceOnce=new B3(this._getNonceOnce.bind(this)),this.wallet=a,this.captchaToken=c,this.client=b,this._meta.disableSignup=d,this._meta.messageType=e,this._plugin=f}}class Ch{async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new cT.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(ff,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode)throw new cT.a("phone number and sms code must be set prior to calling authenticate.");try{return await this.api.post(fd,{phoneNumber:this.meta.phoneNumber,code:this.meta.smsCode})}catch(a){throw(0,cT.f)(a)}}async sendSmsCode({phoneNumber:a,captchaToken:b,withPrivyUi:c}){if(!this.api)throw new cT.a("Auth flow has no API instance");if(a&&(this.meta.phoneNumber=a),b&&(this.meta.captchaToken=b),!this.meta.phoneNumber)throw new cT.a("phone nNumber must be set when initialzing authentication.");let d=B0(c);try{return await this.api.post(fc,{phoneNumber:this.meta.phoneNumber,token:this.meta.captchaToken},{headers:{...d}})}catch(a){throw(0,cT.f)(a)}}constructor({phoneNumber:a,captchaToken:b,disableSignup:c}){this.meta={phoneNumber:a,captchaToken:b,disableSignup:c??!1}}}class Ci extends Ch{async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");if(!this.meta.phoneNumber||!this.meta.smsCode||!this.meta.oldPhoneNumber)throw new cT.a("Phone number, sms code, and an old phone number must be set prior to calling update.");try{return await this.api.post(fg,{old_phone_number:this.meta.oldPhoneNumber,new_phone_number:this.meta.phoneNumber,code:this.meta.smsCode})}catch(a){throw(0,cT.f)(a)}}constructor(a,b,c){super({phoneNumber:b,captchaToken:c}),this.meta={phoneNumber:b,captchaToken:c,oldPhoneNumber:a,disableSignup:!1}}}let Cj=(0,S.createContext)({enabled:!1,siteKey:"",provider:void 0,appId:void 0,token:void 0,error:void 0,status:"disabled",setToken:cT.n,setError:cT.n,setExecuting:cT.n,waitForResult:()=>Promise.resolve(""),ref:{current:null},remove:cT.d,reset:cT.n,execute:cT.n});class Ck extends cT.c{constructor(a,b,c){super(a||"Captcha failed"),this.type="Captcha",b instanceof Error&&(this.cause=b),this.privyErrorCode=c}}let Cl=({children:a,appId:b,captchaSiteKey:c,enabledCaptchaProvider:d})=>{let e=(0,S.useRef)(null),f=(0,S.useRef)(null),[g,h]=(0,S.useState)(),[i,j]=(0,S.useState)(),[k,l]=(0,S.useState)(!1),m=(0,S.useMemo)(()=>d?k||g||i?!k||g||i?g&&!i?{status:"success",token:g}:i?{status:"error",error:i}:{status:"ready"}:{status:"loading"}:{status:"ready"}:{status:"disabled"},[d,g,i,k]),n=(0,S.useMemo)(()=>d?"turnstile"===d?{remove:()=>{e.current?.remove(),l(!1),j(void 0),h(void 0)},reset:()=>{e.current?.reset(),l(!1),j(void 0),h(void 0)},execute:()=>{l(!0),e.current?.execute()},waitForResult:async()=>{try{return await (0,cR.p)(()=>e.current?.getResponse(),{interval:200,timeout:2e4})}catch(a){throw new Ck("Captcha failed",null,cT.b.CAPTCHA_TIMEOUT)}}}:{remove:()=>{f.current?.removeCaptcha(),l(!1),j(void 0),h(void 0)},reset:()=>{f.current?.resetCaptcha(),l(!1),j(void 0),h(void 0)},execute:()=>{l(!0),f.current?.execute()},waitForResult:async()=>{try{return await (0,cR.p)(()=>f.current?.getResponse(),{interval:200,timeout:2e4})}catch(a){throw new Ck("Captcha failed",null,cT.b.CAPTCHA_TIMEOUT)}}}:null,[d]),o=(0,S.useMemo)(()=>{if(!d||!n)return{...m,enabled:!1,siteKey:"",appId:b,setToken:cT.n,setError:cT.n,setExecuting:cT.n,waitForResult:()=>Promise.resolve(void 0),remove:cT.d,reset:cT.n,execute:cT.n,provider:void 0,ref:{current:null}};let a={...m,enabled:!0,appId:b,setToken:h,setError:j,setExecuting:l};return"turnstile"===d?{...a,provider:"turnstile",ref:e,siteKey:c.split("t:")[1]??"",...n}:{...a,provider:"hcaptcha",ref:f,siteKey:c.split("h:")[1]??"",...n}},[m,d,n,b,c]);return(0,R.jsx)(Cj.Provider,{value:o,children:a})},Cm=()=>(0,S.useContext)(Cj);class Cn{async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(ft,{captcha_token:this.meta.captchaToken,telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData,mode:this.meta.disableSignup?"no-signup":"login-or-sign-up"})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(fu,{telegram_auth_result:this.meta.telegramAuthResult,telegram_web_app_data:this.meta.telegramWebAppData})}catch(a){throw(0,cT.f)(a)}}constructor(a,b=!1){this.meta={disableSignup:!1},this.meta={captchaToken:a,disableSignup:!1},this.meta.disableSignup=b}}function Co(a){let b={detail:"",retryable:!1};return a?.privyErrorCode===cT.b.LINKED_TO_ANOTHER_USER&&(b.detail="This account has already been linked to another user."),a?.privyErrorCode===cT.b.DISALLOWED_LOGIN_METHOD&&(b.detail="Login with Telegram not allowed."),a?.privyErrorCode===cT.b.INVALID_DATA&&(b.retryable=!0,b.detail="Something went wrong. Try again."),a?.privyErrorCode===cT.b.CANNOT_LINK_MORE_OF_TYPE&&(b.retryable=!0,b.detail="Something went wrong. Try again."),a?.privyErrorCode===cT.b.INVALID_CREDENTIALS&&(b.retryable=!0,b.detail="Something went wrong. Try again."),a?.privyErrorCode===cT.b.TOO_MANY_REQUESTS&&(b.detail="Too many requests. Please wait before trying again."),a?.privyErrorCode===cT.b.TOO_MANY_REQUESTS&&a.message.includes("rate limit")&&(b.detail="Request limit reached for Telegram. Please wait a moment and try again."),a instanceof Ck&&(b.retryable=!0,b.detail="Something went wrong. Try again."),b}function Cp(a){return Object.fromEntries(decodeURIComponent(a).split("&").map(a=>a.split("=").map(decodeURIComponent)))}function Cq(){let a=new URL(window.location.href);a.searchParams.delete("id"),a.searchParams.delete("hash"),a.searchParams.delete("auth_date"),a.searchParams.delete("first_name"),a.searchParams.delete("last_name"),a.searchParams.delete("username"),a.searchParams.delete("photo_url"),a.hash="",window.history.replaceState({},"",a)}let Cr=(0,S.lazy)(()=>a.A(78921)),Cs=(0,S.lazy)(()=>a.A(443249)),Ct=a=>{let b=Cm();return(0,S.useEffect)(()=>b.remove,[b.remove]),b.enabled&&b.provider?(0,R.jsx)(S.Suspense,{fallback:null,children:(0,R.jsxs)("div",{className:"hidden h-0 w-0",children:["turnstile"===b.provider&&(0,R.jsx)(Cr,{...a,captchaContext:b}),"hcaptcha"===b.provider&&(0,R.jsx)(Cs,{...a,captchaContext:b})]})}):null};var Cu=Object.freeze({__proto__:null,AccountNotFoundScreen:()=>a.A(257721),AffirmativeConsentScreen:()=>a.A(231870),AllowlistRejectionScreen:()=>a.A(48723),AuthenticateWithWalletScreen:()=>a.A(901883),AwaitingEvmToSolBridgingScreen:()=>a.A(241210),AwaitingExternalEthereumTransferScreen:()=>a.A(949530),AwaitingPasswordlessCodeScreen:()=>a.A(642174),AwaitingSolToEvmBridgingScreen:()=>a.A(637),CaptchaScreen:()=>a.A(345531),CoinbaseOnrampStatusScreen:()=>a.A(664255),ConnectLedgerScreen:()=>a.A(644347),ConnectOnlyLandingScreen:()=>a.A(313707),ConnectOnlyStatusScreen:()=>a.A(129548),ConnectOrCreateScreen:()=>a.A(702267),ConnectionStatusScreen:()=>a.A(819342),CrossAppAuthScreen:()=>a.A(212007),DelegatedActionsConsentScreen:()=>a.A(152571),DelegatedActionsRevokeScreen:()=>a.A(639392),EmbeddedWalletConnectingScreen:()=>a.A(163636),EmbeddedWalletCreatedScreen:()=>a.A(205038),EmbeddedWalletKeyExportScreen:()=>a.A(28566),EmbeddedWalletOnAccountCreateScreen:()=>a.A(202122),EmbeddedWalletPasswordCreateScreen:()=>a.A(223124),EmbeddedWalletPasswordUpdateScreen:()=>a.A(235116),EmbeddedWalletPasswordUpdateSplashScreen:()=>a.A(340965),ErrorScreen:()=>a.A(129333),FarcasterConnectStatusScreen:()=>a.A(888882),FarcasterSignerStatusScreen:()=>a.A(913497),FundSolWalletWithExternalSolanaWallet:()=>a.A(213051),FundingAmountEditScreen:()=>a.A(564994),FundingMethodSelectionScreen:()=>a.A(419210),InAppBrowserLoginNotPossible:()=>a.A(415087),InstallWalletScreen:()=>a.A(549714),LandingScreen:()=>a.A(754015),LinkConflictScreen:()=>a.A(90608),LinkEmailScreen:()=>a.A(416739),LinkPasskeyScreen:()=>a.A(388455),LinkPhoneScreen:()=>a.A(627668),LoginFailedScreen:()=>a.A(538542),ManualTransferScreen:()=>a.A(911189),MfaAuthEnrollmentFlowScreen:()=>a.A(355183),MfaAuthVerifyFlowScreen:()=>a.A(873406),MfaEnrollmentFlowScreen:()=>a.A(407889),MoonpayStatusScreen:()=>a.A(41499),OAuthStatusScreen:()=>a.A(141168),PasskeySelectSignupOrLogin:()=>a.A(835629),PasskeyStatusScreen:()=>a.A(559234),PasswordRecoveryScreen:()=>a.A(432959),RecoveryOAuthScreen:()=>a.A(450606),RecoverySelectionScreen:()=>a.A(637389),SendTransactionScreen:()=>a.A(811320),SetAutomaticRecoveryScreen:()=>a.A(598601),SignRequestScreen:()=>a.A(17996),StandardSignAndSendTransactionScreen:()=>a.A(344440),TelegramAuthScreen:()=>a.A(680843),TransferFromWalletScreen:()=>a.A(875521),UpdateEmailScreen:()=>a.A(817237),UpdatePhoneScreen:()=>a.A(796470),UserLimitReachedScreen:()=>a.A(954059),WalletInterstitialScreen:()=>a.A(47420)});let Cv=(0,fO.create)(()=>({inProgressMfaFlow:void 0})),Cw=(0,fM.createGlobalStyle)([":root{","};"],a=>Cx(a.palette)),Cx=a=>(0,fM.css)(["",""],Object.entries({"--privy-color-background":a.background,"--privy-color-background-2":a.background2,"--privy-color-background-3":a.background3,"--privy-color-foreground":a.foreground,"--privy-color-foreground-2":a.foreground2,"--privy-color-foreground-3":a.foreground3,"--privy-color-foreground-4":a.foreground4,"--privy-color-foreground-accent":a.foregroundAccent,"--privy-color-accent":a.accent,"--privy-color-accent-light":a.accentLight,"--privy-color-accent-hover":a.accentHover,"--privy-color-accent-dark":a.accentDark,"--privy-color-accent-darkest":a.accentDarkest,"--privy-color-success":a.success,"--privy-color-success-dark":a.successDark,"--privy-color-success-light":a.successLight,"--privy-color-success-bg":a.successBg,"--privy-color-error":a.error,"--privy-color-error-light":a.errorLight,"--privy-color-error-bg":a.errorBg,"--privy-color-error-bg-hover":a.errorBgHover,"--privy-color-warn":a.warn,"--privy-color-warn-light":a.warnLight,"--privy-color-warn-bg":a.warnBg,"--privy-color-warning-dark":a.warningDark,"--privy-color-error-dark":a.errorDark,"--privy-color-info-bg":a.infoBg,"--privy-color-info-bg-hover":a.infoBgHover,"--privy-color-border-default":a.borderDefault,"--privy-color-border-hover":a.borderHover,"--privy-color-border-focus":a.borderFocus,"--privy-color-border-error":a.borderError,"--privy-color-border-success":a.borderSuccess,"--privy-color-border-warning":a.borderWarning,"--privy-color-border-info":a.borderInfo,"--privy-color-border-interactive":a.borderInteractive,"--privy-color-border-interactive-hover":a.borderInteractiveHover,"--privy-color-background-hover":a.backgroundHover,"--privy-color-background-clicked":a.backgroundClicked,"--privy-color-background-disabled":a.backgroundDisabled,"--privy-color-background-interactive":a.backgroundInteractive,"--privy-color-background-interactive-hover":a.backgroundInteractiveHover,"--privy-color-background-interactive-clicked":a.backgroundInteractiveClicked,"--privy-color-background-interactive-disabled":a.backgroundInteractiveDisabled,"--privy-color-foreground-hover":a.foregroundHover,"--privy-color-foreground-clicked":a.foregroundClicked,"--privy-color-foreground-disabled":a.foregroundDisabled,"--privy-color-foreground-interactive":a.foregroundInteractive,"--privy-color-foreground-interactive-hover":a.foregroundInteractiveHover,"--privy-link-navigation-color":a.linkNavigationColor,"--privy-link-navigation-decoration":a.linkNavigationDecoration,"--privy-accent-has-good-contrast":a.accentHasGoodContrast,"--privy-color-icon-default":a.iconDefault,"--privy-color-icon-muted":a.iconMuted,"--privy-color-icon-subtle":a.iconSubtle,"--privy-color-icon-inverse":a.iconInverse,"--privy-color-icon-success":a.iconSuccess,"--privy-color-icon-warning":a.iconWarning,"--privy-color-icon-error":a.iconError,"--privy-color-icon-interactive":a.iconInteractive,"--privy-color-icon-default-hover":a.iconDefaultHover,"--privy-color-icon-muted-hover":a.iconMutedHover,"--privy-color-icon-subtle-hover":a.iconSubtleHover,"--privy-color-icon-default-clicked":a.iconDefaultClicked,"--privy-color-icon-muted-clicked":a.iconMutedClicked,"--privy-color-icon-subtle-clicked":a.iconSubtleClicked,"--privy-color-icon-default-disabled":a.iconDefaultDisabled,"--privy-color-icon-muted-disabled":a.iconMutedDisabled,"--privy-color-icon-subtle-disabled":a.iconSubtleDisabled,"--privy-color-icon-error-hover":a.iconErrorHover,"--privy-color-icon-interactive-hover":a.iconInteractiveHover,"--privy-color-icon-error-clicked":a.iconErrorClicked,"--privy-color-icon-interactive-clicked":a.iconInteractiveClicked,"--privy-color-icon-muted-disabled-alt":a.iconMutedDisabledAlt,"--privy-color-icon-subtle-disabled-alt":a.iconSubtleDisabledAlt,"--privy-border-radius-xs":"6px","--privy-border-radius-sm":"8px","--privy-border-radius-md":"12px","--privy-border-radius-mdlg":"16px","--privy-border-radius-lg":"24px","--privy-border-radius-full":"9999px","--privy-height-modal-full":"620px","--privy-height-modal-compact":"480px"}).map(([a,b])=>`${a}: ${b};`).join("\n")),Cy=fM.styled.div.withConfig({displayName:"StylesWrapper",componentId:"sc-188229e4-0"})([""," color:var(--privy-color-foreground-2);h3{font-size:16px;line-height:24px;font-weight:500;color:var(--privy-color-foreground-2);}h4{font-size:14px;line-height:20px;font-weight:500;color:var(--privy-color-foreground);}p{font-size:13px;line-height:20px;color:var(--privy-color-foreground-2);}button:focus,input:focus,optgroup:focus,select:focus,textarea:focus{outline:none;border-color:var(--privy-color-accent-light);box-shadow:0 0 0 3px var(--privy-color-border-focus);}.mobile-only{@media (min-width:441px){display:none;}}@keyframes fadein{0%{opacity:0;}100%{opacity:1;}}"],"\n  *,\n  ::before,\n  ::after {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n  }\n\n  line-height: 1.15;\n  -webkit-text-size-adjust: 100%;\n  -moz-tab-size: 4;\n  tab-size: 4;\n  font-feature-settings: normal;\n\n  margin: 0;\n  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n\n  hr {\n    height: 0;\n    color: inherit;\n    border-top-width: 1px;\n  }\n\n  abbr:where([title]) {\n    text-decoration: underline dotted;\n  }\n\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6 {\n    font-size: inherit;\n    font-weight: inherit;\n    font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif,\n    'Apple Color Emoji', 'Segoe UI Emoji';\n    display: inline;\n  }\n\n  a {\n    color: inherit;\n    text-decoration: inherit;\n  }\n\n  b,\n  strong {\n    font-weight: bolder;\n  }\n\n  code,\n  kbd,\n  samp,\n  pre {\n    font-family: ui-monospace, SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;\n    font-size: 1em;\n  }\n\n  small {\n    font-size: 80%;\n  }\n\n  sub,\n  sup {\n    font-size: 75%;\n    line-height: 0;\n    position: relative;\n    vertical-align: baseline;\n  }\n\n  sub {\n    bottom: -0.25em;\n  }\n\n  sup {\n    top: -0.5em;\n  }\n\n  table {\n    text-indent: 0;\n    border-color: inherit;\n    border-collapse: collapse;\n  }\n\n  button,\n  input,\n  optgroup,\n  select,\n  textarea {\n    font-family: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n  }\n\n  button,\n  select {\n    text-transform: none;\n  }\n\n  button,\n  [type='button'],\n  [type='reset'],\n  [type='submit'] {\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n  }\n\n  ::-moz-focus-inner {\n    border-style: none;\n    padding: 0;\n  }\n\n  :-moz-focusring {\n    outline: 1px dotted ButtonText;\n  }\n\n  :-moz-ui-invalid {\n    box-shadow: none;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  progress {\n    vertical-align: baseline;\n  }\n\n  ::-webkit-inner-spin-button,\n  ::-webkit-outer-spin-button {\n    height: auto;\n  }\n\n  [type='search'] {\n    -webkit-appearance: textfield;\n    outline-offset: -2px;\n  }\n\n  ::-webkit-search-decoration {\n    -webkit-appearance: none;\n  }\n\n  ::-webkit-file-upload-button {\n    -webkit-appearance: button;\n    font: inherit;\n  }\n\n  summary {\n    display: list-item;\n  }\n\n  blockquote,\n  dl,\n  dd,\n  h1,\n  h2,\n  h3,\n  h4,\n  h5,\n  h6,\n  hr,\n  figure,\n  p,\n  pre {\n    margin: 0;\n  }\n\n  fieldset {\n    margin: 0;\n    padding: 0;\n  }\n\n  legend {\n    padding: 0;\n  }\n\n  ol,\n  ul,\n  menu {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  textarea {\n    resize: vertical;\n  }\n\n  input::placeholder,\n  textarea::placeholder {\n    opacity: 1;\n    color: #9ca3af;\n  }\n\n  button,\n  [role='button'] {\n    cursor: pointer;\n  }\n\n  :disabled {\n    cursor: default;\n  }\n\n  img,\n  svg,\n  video,\n  canvas,\n  audio,\n  iframe,\n  embed,\n  object {\n    display: block;\n  }\n\n  img,\n  video {\n    max-width: 100%;\n    height: auto;\n  }\n\n  [hidden] {\n    display: none;\n  }\n"),Cz=({children:a,open:b,onClick:c,...d})=>(0,R.jsx)(gx,{show:b,as:S.default.Fragment,children:(0,R.jsxs)(ih,{onClose:c,...d,as:CB,children:[(0,R.jsx)(gw,{as:S.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,R.jsx)(CA,{id:"privy-dialog-backdrop","aria-hidden":"true"})}),(0,R.jsx)(CC,{children:(0,R.jsx)(gw,{as:S.default.Fragment,enterFrom:"entering",leaveTo:"leaving",children:(0,R.jsx)(ig,{as:CD,children:a})})})]})}),CA=fM.styled.div.withConfig({displayName:"Backdrop",componentId:"sc-3cfde0b5-0"})(["position:fixed;inset:0;transition:backdrop-filter 100ms ease;backdrop-filter:blur(3px);-webkit-backdrop-filter:blur(3px);&.entering,&.leaving{backdrop-filter:unset;-webkit-backdrop-filter:unset;}"]),CB=fM.styled.div.withConfig({displayName:"DialogWrapper",componentId:"sc-3cfde0b5-1"})(["position:relative;z-index:999999;"]),CC=fM.styled.div.withConfig({displayName:"DialogContainer",componentId:"sc-3cfde0b5-2"})(["position:fixed;inset:0;display:flex;align-items:center;justify-content:center;width:100vw;min-height:100vh;"]),CD=fM.styled.div.withConfig({displayName:"Panel",componentId:"sc-3cfde0b5-3"})(["padding:0;background:transparent;border:none;width:100%;pointer-events:auto;outline:none;display:block;@media (max-width:440px){opacity:1;transform:translate3d(0,0,0);transition:transform 200ms ease-in;position:fixed;bottom:0;&.entering,&.leaving{opacity:0;transform:translate3d(0,100%,0);transition:transform 150ms ease-in 0ms,opacity 0ms ease 150ms;}}@media (min-width:441px){opacity:1;transition:opacity 100ms ease-in;&.entering,&.leaving{opacity:0;transition-delay:5ms;}margin:auto;width:360px;box-shadow:0px 8px 36px rgba(55,65,81,0.15);border-radius:var(--privy-border-radius-lg);}"]),CE=(0,S.lazy)(()=>a.A(310320)),CF=(0,S.lazy)(()=>Cu.MfaAuthVerifyFlowScreen().then(a=>({default:a.default.component}))),CG=()=>(0,R.jsx)(CM,{children:(0,R.jsx)(cR.L,{})}),CH=()=>{let{currentScreen:a}=(0,cP.a)(),b=Cv(a=>a.inProgressMfaFlow),c=()=>Cv.setState({inProgressMfaFlow:void 0}),{component:d,isLoading:e}=(()=>{let{ready:a}=(0,cP.u)(),{currentScreen:b}=(0,cP.a)(),[c,d]=(0,S.useState)(null),[e,f]=(0,S.useState)(!1),g=function(a){let[b,c]=(0,S.useState)(!1),d=(0,S.useRef)(null),e=(0,S.useRef)(null),f=(0,S.useRef)(null);return(0,S.useEffect)(()=>{if(d.current&&(clearTimeout(d.current),d.current=null),e.current&&(clearTimeout(e.current),e.current=null),a)f.current=Date.now(),d.current=setTimeout(()=>{c(!0)},150);else if(null!==f.current){let a=Date.now()-f.current;a>=150?e.current=setTimeout(()=>{c(!1),f.current=null},Math.max(0,400-(a-150))):(d.current&&(clearTimeout(d.current),d.current=null),c(!1),f.current=null)}return()=>{d.current&&clearTimeout(d.current),e.current&&clearTimeout(e.current)}},[a]),b}(e);return(0,S.useEffect)(()=>{b?(f(!0),Cu[b]().then(c=>{(!b||a||c.default.isShownBeforeReady)&&(d(()=>c.default.component),f(!1))}).catch(()=>{d(null),f(!1)})):(d(null),f(!1))},[b,a]),{component:c,isLoading:g}})();return function(){let{isModalOpen:a}=(0,cP.u)(),{headless:b}=(0,eH.u)(),{currentScreen:c}=(0,cP.a)(),{status:d,execute:e,reset:f,enabled:g}=Cm(),[h,i]=(0,S.useState)(!1);(0,S.useEffect)(()=>{!a&&g&&f()},[a,g,f]),(0,S.useEffect)(()=>{c?Cu[c]().then(a=>{i(!!a.default.isCaptchaRequired)}).catch(()=>{i(!1)}):i(!1)},[c]),(0,S.useEffect)(()=>{a&&h&&!b&&"ready"===d&&g&&e()},[a,h,b,d,g,e])}(),a||"txn"!==b?e?(0,R.jsx)(CG,{}):d?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(cR.H,{$if:!!b,children:(0,R.jsx)(S.Suspense,{children:(0,R.jsx)(d,{})})}),(0,R.jsxs)(S.Suspense,{children:["txn"===b&&(0,R.jsx)(CE,{onClose:c}),"auth"===b&&(0,R.jsx)(CF,{})]})]}):null:(0,R.jsxs)(S.Suspense,{children:[(0,R.jsx)(CE,{onClose:c}),";"]})},CI=()=>{let a=(0,S.useRef)(null);return(0,R.jsx)(CL,{style:{height:(0,cR.u)(a)},id:"privy-modal-content",children:(0,R.jsx)("div",{ref:a,children:(0,R.jsx)(CH,{})})})},CJ=({open:a})=>{var b;let c=(0,eH.u)(),{gracefulClosePrivyModal:d}=(()=>{let{closePrivyModal:a}=(0,cT.u)(),{onUserCloseViaDialogOrKeybindRef:b}=(0,cP.a)();return{gracefulClosePrivyModal:(0,S.useCallback)(()=>{if(!b?.current)return a({shouldCallAuthOnSuccess:!1});b.current()},[a])}})(),e=Cv(a=>a.inProgressMfaFlow);return b={onMfaRequired:()=>{c.mfa.noPromptOnMfaRequired||Cv.setState({inProgressMfaFlow:"txn"})}},(0,fN.u)("configureMfa",b),c.render.standalone?(0,R.jsx)(Cy,{children:(0,R.jsx)(CK,{id:"privy-modal-content",children:(0,R.jsx)(CH,{})})}):(0,R.jsx)(Cz,{open:!(!a&&!e),id:"privy-dialog","aria-label":"log in or sign up","aria-labelledby":"privy-dialog-title",onClick:()=>d(),children:(0,R.jsx)(Cy,{children:(0,R.jsx)(CI,{})})})},CK=fM.styled.div.withConfig({displayName:"ContentWrapper",componentId:"sc-9b080f09-0"})(["display:flex;flex-direction:column;text-align:center;font-size:14px;line-height:20px;width:100%;background:var(--privy-color-background);padding:0 16px;"]),CL=(0,fM.styled)(CK).withConfig({displayName:"BaseModal",componentId:"sc-9b080f09-1"})(["transition:height 150ms ease-out;overflow-x:hidden;overflow-y:auto;scrollbar-width:none;max-height:calc(100svh - 32px);border-radius:var(--privy-border-radius-lg) var(--privy-border-radius-lg) 0 0;box-shadow:0px 0px 36px rgba(55,65,81,0.15);@media (min-width:441px){box-shadow:0px 8px 36px rgba(55,65,81,0.15);border-radius:var(--privy-border-radius-lg);}"]),CM=fM.styled.div.withConfig({displayName:"LoadingScreenContainer",componentId:"sc-9b080f09-2"})(["display:flex;align-items:center;justify-content:center;min-height:300px;padding:2rem;"]);function CN(a){let b=(0,S.useRef)(null),c=(0,S.useRef)();return(0,S.useEffect)(()=>{c.current?.remove(),c.current=function({botUsername:a,scriptHost:b}){let c=document.createElement("script"),{origin:d}=new URL(b);return c.async=!0,c.src=`${d}/js/telegram-login.js`,c.setAttribute("data-telegram-login",a),c.setAttribute("data-request-access","write"),c.setAttribute("data-lang","en"),c}(a),b.current?.after(c.current)},[a]),(0,R.jsx)("div",{ref:b,hidden:!0})}let CO=()=>{let{ready:a}=(0,cS.u)(),{client:b}=(0,cT.u)();return(0,S.useEffect)(()=>{let c=()=>{if(!b.connectors||!a)return;let c=b.connectors.wallets.map(a=>({address:a.address,connectorType:a.connectorType,walletClientType:a.walletClientType,connectedAt:a.connectedAt,id:a.meta.id}));cU.u.put(eH.b,c)};return b.connectors?.on("walletsUpdated",c),()=>{b.connectors?.off("walletsUpdated",c)}},[a,b.connectors]),null};class CP extends cR.E{async initialize(){let a=await this.createProvider();this.provider=a,this.proxyProvider.setWalletProvider(a),this.subscribeListeners(),a.session&&(this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,cR.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown"),this.connected=!0,await this.syncAccounts()),this.initialized=!0,this.emit("initialized")}async connect(a){return a.showPrompt&&await this.promptConnection(),this.getConnectedWallet()}async isConnected(){return!!this.walletProvider?.connected}get walletBranding(){let a=this.walletProvider?.session?.peer.metadata.icons?.[0];return{name:(0,cR.s)(this.walletProvider?.session?.peer.metadata.name||"")||"WalletConnect",icon:"string"==typeof a?a:cU.W,id:this.walletProvider?.session?.peer.metadata.name.toLowerCase()||"wallet_connect_v2"}}async resetConnection(a){this.walletProvider&&this.walletProvider.connected&&(await this.walletProvider.disconnect(),this.walletProvider.signer.session=void 0,this.walletClientType=a,this.redirectUri=void 0,this.fallbackUniversalRedirectUri=void 0,(0,fK.d)(),this.onDisconnect())}async promptConnection(){if(this.provider)return new Promise((a,b)=>{(async()=>{let b="",c=await Promise.race([this.walletProvider?.enable(),this.proxyProvider.walletTimeout()]);if(c?.length&&(b=c[0]),!b||""===b)throw new cT.P("Unable to retrieve address");this.walletProvider?.session?.peer.metadata.url&&(this.walletEntry=(0,cR.g)(this.walletProvider?.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown",this.proxyProvider.rpcTimeoutDuration=(0,cR.c)(this.rpcConfig,this.walletClientType)),this.connected=!0,await this.syncAccounts(c),a()})().catch(a=>{b(a?(0,cU.f)(a):new cT.P("Unknown error during connection"))})})}disconnect(){this.walletProvider?.disconnect().then(()=>this.onDisconnect()).catch(()=>console.warn("Unable to disconnect WalletConnect provider"))}get walletProvider(){return this.proxyProvider.walletProvider}setWalletProvider(a){this.proxyProvider.setWalletProvider(a)}async createProvider(){let a={};for(let b of this.chains){let c=(0,cR.a)(b.id,this.chains,this.rpcConfig,this.privyAppId);c&&(a[b.id]=c)}let b=this.shouldEnforceDefaultChainOnConnect?[this.defaultChain.id]:[],c=this.chains.map(a=>a.id),d=await vO.init({projectId:this.walletConnectCloudProjectId,chains:b,optionalChains:c,optionalEvents:vB,optionalMethods:vz,rpcMap:a,showQrModal:!1,metadata:{description:this.privyAppName,name:this.privyAppName,url:window.location.origin,icons:[]}});return d.on("display_uri",a=>{if(d.signer.abortPairingAttempt(),(0,fK.r)(),!this.showPrivyQrModal)throw new cT.P("WalletConnect modal not available - Privy handles wallet connections through its own UI");if(eI.isMobile&&this.walletEntry){let{redirect:b,href:c}=(0,fK.b)(a,this.walletEntry);(0,fK.o)(b,"_self"),(0,fK.s)({href:c,name:this.walletEntry.metadata?.shortName||this.walletEntry.name});let d=(0,fK.a)(a,this.walletEntry);return this.redirectUri=b,this.fallbackUniversalRedirectUri=d?.redirect,this.showPrivyQrModal({native:b,universal:b})}if(this.redirectUri=void 0,this.walletEntry){let b=(0,fK.a)(a,this.walletEntry);this.fallbackUniversalRedirectUri=b?.redirect}this.showPrivyQrModal({native:a,universal:void 0})}),d.on("connect",()=>{d.session?.peer.metadata.url&&(this.walletEntry=(0,cR.g)(d.session?.peer.metadata.url),this.walletClientType=this.walletEntry?.slug||"unknown")}),d}async enableProvider(){return this.walletProvider?.connected?Promise.resolve(this.walletProvider.accounts):await this.walletProvider?.enable()}setWalletEntry(a,b){this.walletEntry=a,this.showPrivyQrModal=b}constructor({walletConnectCloudProjectId:a,rpcConfig:b,chains:c,defaultChain:d,shouldEnforceDefaultChainOnConnect:e,privyAppId:f,privyAppName:g,walletClientType:h}){super(h||"unknown",c,d,b),this.connectorType="wallet_connect_v2",this.privyAppId=f,this.privyAppName=g,this.walletConnectCloudProjectId=a,this.rpcConfig=b,this.shouldEnforceDefaultChainOnConnect=e,this.proxyProvider=new cR.P(void 0,this.rpcTimeoutDuration),h&&(this.walletEntry=(0,cR.b)(h),this.walletClientType=h)}}let CQ=["error","invalid_request_arguments","wallet_not_on_device","invalid_recovery_pin","insufficient_funds","missing_or_invalid_mfa","mfa_verification_max_attempts_reached","mfa_timeout","twilio_verification_failed"];class CR extends Error{constructor(a,b){super(b),this.type=a}}function CS(a){let b=a.type;return"string"==typeof b&&CQ.includes(b)}function CT(a){return CS(a)&&"wallet_not_on_device"===a.type}function CU(a){return CS(a)&&("invalid_recovery_pin"===a.type||"invalid_request_arguments"===a.type)}function CV(a){return!!CS(a)&&"mfa_timeout"===a.type}function CW(a){return!!CS(a)&&"missing_or_invalid_mfa"===a.type}function CX(a){return!!CS(a)&&"mfa_verification_max_attempts_reached"===a.type}function CY(a){return!(!CS(a)||!a.message.includes("code 429"))}function CZ(a){let b;return"string"==typeof(b=a.type)&&"client_error"===b&&"MFA canceled"===a.message}async function C$(a,b,c,d,e,f=!1){let g=f,h=async h=>{if(g&&b&&b.length>0){h===+!f?e("configureMfa","onMfaRequired",{mfaMethods:b}):d.current?.reject(new CR("missing_or_invalid_mfa","MFA verification failed, retry."));let g=await new Promise((a,b)=>{c.current={resolve:a,reject:b},setTimeout(()=>{let a=new CR("mfa_timeout","Timed out waiting for MFA code");d.current?.reject(a),b(a)},3e5)});return await a(g)}return await a()},i=null;for(let a=0;a<4;a++)try{i=await h(a),d.current?.resolve(void 0);break}catch(a){if("missing_or_invalid_mfa"!==a.type)throw d.current?.resolve(void 0),a;g=!0}if(null===i){let a=new CR("mfa_verification_max_attempts_reached","Max MFA verification attempts reached");throw d.current?.reject(a),a}return i}let C_=(Ev=0,()=>"id-"+Ev++);function C0(a){return void 0!==a.error}let C1=new class{enqueue(a,b){this.callbacks[a]=b}dequeue(a,b){let c=this.callbacks[b];if(!c)throw Error(`cannot dequeue ${a} event: no event found for id ${b}`);switch(delete this.callbacks[b],a){case"privy:iframe:ready":case"privy:user-signer:sign":case"privy:wallets:add":case"privy:wallets:import":case"privy:wallets:set-recovery":case"privy:wallets:connect":case"privy:wallets:recover":case"privy:wallets:rpc":case"privy:wallet:create":case"privy:mfa:verify":case"privy:mfa:init-enrollment":case"privy:mfa:submit-enrollment":case"privy:mfa:unenroll":case"privy:mfa:clear":case"privy:auth:unlink-passkey":case"privy:farcaster:init-signer":case"privy:farcaster:sign":case"privy:solana-wallet:create":case"privy:delegated-actions:consent":return c;default:throw Error(`invalid wallet event type ${a}`)}}constructor(){this.callbacks={}}},C2=new Map,C3=(a,b)=>"bigint"==typeof b?b.toString():b;function C4(a,b,c,d){let e=c.contentWindow;if(!e)throw Error("iframe not initialized");let f=`${a}${JSON.stringify(b,C3)}`;if("privy:wallet:create"===a){let a=C2.get(f);if(a)return a}let g=new Promise((c,f)=>{let g=C_();C1.enqueue(g,{resolve:c,reject:f}),e.postMessage({id:g,event:a,data:b},d)}).finally(()=>{C2.delete(f)});return C2.set(f,g),g}function C5(a){let b=(0,eH.c)(),c=(0,S.useRef)(null),d=(0,S.useRef)(a.mfaMethods),e=(0,fN.a)(),[f,g]=(0,S.useState)(!1);return(0,S.useEffect)(()=>{d.current=a.mfaMethods},[a.mfaMethods]),(0,S.useEffect)(()=>{if(!f)return;let b=c.current;if(!b)return;function g(b){var c;b&&b.origin===a.origin&&"string"==typeof(c=b.data).event&&/^privy:.+/.test(c.event)&&function(a){switch(a.event){case"privy:iframe:ready":let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data);case"privy:user-signer:sign":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:wallets:add":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:wallets:set-recovery":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:wallets:connect":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:wallets:recover":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:wallets:rpc":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:wallet:create":let c=C1.dequeue(a.event,a.id);return C0(a)?c.reject(new CR(a.error.type,a.error.message)):c.resolve(a.data);case"privy:wallets:import":let d=C1.dequeue(a.event,a.id);return C0(a)?d.reject(new CR(a.error.type,a.error.message)):d.resolve(a.data);case"privy:mfa:verify":let e=C1.dequeue(a.event,a.id);return C0(a)?e.reject(new CR(a.error.type,a.error.message)):e.resolve(a.data);case"privy:mfa:init-enrollment":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:mfa:submit-enrollment":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:mfa:unenroll":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:mfa:clear":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:auth:unlink-passkey":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:solana-wallet:create":let f=C1.dequeue(a.event,a.id);return C0(a)?f.reject(new CR(a.error.type,a.error.message)):f.resolve(a.data);case"privy:farcaster:init-signer":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:farcaster:sign":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}case"privy:delegated-actions:consent":{let b=C1.dequeue(a.event,a.id);return C0(a)?b.reject(new CR(a.error.type,a.error.message)):b.resolve(a.data)}default:console.warn("Unsupported wallet proxy method:",a)}}(b.data)}let h={signWithUserSigner:c=>C$(d=>C4("privy:user-signer:sign",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),addWallet:c=>C$(d=>C4("privy:wallets:add",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),setRecovery:c=>C$(d=>C4("privy:wallets:set-recovery",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),connect:c=>C$(d=>C4("privy:wallets:connect",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),recover:c=>C$(d=>C4("privy:wallets:recover",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e,!c.recoveryAccessToken&&!c.recoveryPassword&&!c.recoverySecretOverride),rpc:c=>C$(d=>C4("privy:wallets:rpc",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),create:c=>C4("privy:wallet:create",c,b,a.origin),importWallet:c=>C4("privy:wallets:import",c,b,a.origin),createSolana:c=>C$(d=>C4("privy:solana-wallet:create",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),createDelegatedAction:c=>C4("privy:delegated-actions:consent",c,b,a.origin),verifyMfa:c=>C$(d=>C4("privy:mfa:verify",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e,!0),initEnrollMfa:c=>C$(d=>C4("privy:mfa:init-enrollment",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),submitEnrollMfa:c=>C$(d=>C4("privy:mfa:submit-enrollment",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),unenrollMfa:c=>C$(d=>C4("privy:mfa:unenroll",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),clearMfa:c=>C4("privy:mfa:clear",c,b,a.origin),unlinkPasskeyAccount:c=>C$(d=>C4("privy:auth:unlink-passkey",{...c,...d},b,a.origin),d.current,a.mfaPromise,a.mfaSubmitPromise,e),initFarcasterSigner:c=>C4("privy:farcaster:init-signer",c,b,a.origin),signFarcasterMessage:c=>C4("privy:farcaster:sign",c,b,a.origin)};window.addEventListener("message",g);let i=new AbortController;return(0,cR.i)(()=>C4("privy:iframe:ready",{},b,a.origin),{abortSignal:i.signal}).then(()=>a.onLoad(h),(...b)=>{console.warn("Privy iframe failed to load: ",...b),a.onLoadFailed()}),()=>{window.removeEventListener("message",g),i.abort()}},[f]),b?(0,R.jsx)("iframe",{ref:c,width:"0",height:"0",style:{display:"none",height:"0px",width:"0px"},onLoad:()=>g(!0),src:(0,v$.constructURL)({origin:a.origin,path:`/apps/${a.appId}/embedded-wallets`,query:{caid:a.clientAnalyticsId,client_id:a.appClientId}})}):null}let C6=a=>a.linkedAccounts.filter(a=>"wallet"===a.type&&"privy"===a.walletClientType&&a.delegated),C7="popup-privy-oauth",C8="PRIVY_OAUTH_USE_BROADCAST_CHANNEL";class C9{async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(fj,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(fk,{authorization_code:this.meta.authorizationCode,state_code:this.meta.stateCode,code_verifier:this.meta.codeVerifier,provider:this.meta.provider})}catch(a){throw(0,cT.f)(a)}}constructor({authorizationCode:a,stateCode:b,codeVerifier:c,provider:d}){this.meta={authorizationCode:a,stateCode:b,codeVerifier:c,provider:d}}}async function Da({api:a,requesterAppId:b,providerAppId:c}){let d=(await a.get(`/api/v1/apps/${b}/cross-app/connections`)).connections.find(a=>a.provider_app_id===c);if(!d)throw new cT.a("Invalid connected app");return{name:d.provider_app_name,logoUrl:d.provider_app_icon_url||void 0,apiUrl:d.provider_app_custom_api_url,readOnly:d.read_only,customAuthAuthorizeUrl:d.provider_app_custom_auth_authorize_url,customAuthTransactUrl:d.provider_app_custom_auth_transact_url}}let Db=async({user:a,address:b,client:c,request:d,requesterAppId:e,reconnect:f})=>{c.createAnalyticsEvent({eventName:"cross_app_request_started",payload:{address:b,method:d.method}});let g=a?.linkedAccounts.find(a=>"cross_app"===a.type&&(a.embeddedWallets.some(a=>a.address===b)||a.smartWallets.some(a=>a.address===b)));if(!a||!g)throw c.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Cannot request a signature with this wallet address",address:b}}),new cT.a("Cannot request a signature with this wallet address");let h=c.getProviderAccessToken(g.providerApp.id),i=await Da({api:c.api,requesterAppId:e,providerAppId:g.providerApp.id});if(!h){if(i.readOnly)throw console.error("cannot transact against a read-only provider app"),new cT.a("Cannot transact against a read-only provider app");await f({appId:g.providerApp.id,action:"link"})&&(h=c.getProviderAccessToken(g.providerApp.id))}if(!h)throw c.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Transactions require a valid token",address:b}}),new cT.a("Transactions require a valid token");let j=new URL(i.customAuthTransactUrl||`${i.apiUrl}/oauth/transact`);j.searchParams.set("token",h||""),j.searchParams.set("request",Dc(d));let k=(0,eO.trigger)({location:j.href});if(!k)throw c.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Missing token",address:b}}),new cT.a("Failed to initialize signature request");return new Promise((a,e)=>{let f=setTimeout(()=>{j(),e(new cT.a("Request timeout")),c.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"Request timeout",address:b}})},12e4),h=setInterval(()=>{k.closed&&(j(),e(new cT.a("User rejected request")),c.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:"User rejected request",address:b}}))},300),i=f=>{f.data&&("set"===f.data.token?.action&&void 0!==f.data.token?.value?c.storeProviderAccessToken(g.providerApp.id,f.data.token.value):"clear"===f.data.token?.action&&c.storeProviderAccessToken(g.providerApp.id,null),"PRIVY_CROSS_APP_ACTION_RESPONSE"===f.data.type&&f.data.result&&(j(),a(f.data.result),c.createAnalyticsEvent({eventName:"cross_app_request_success",payload:{address:b,method:d.method}})),"PRIVY_CROSS_APP_ACTION_ERROR"===f.data.type&&f.data.error&&(j(),e(f.data.error),c.createAnalyticsEvent({eventName:"cross_app_request_error",payload:{error:f.data.error,address:b}})))};window.addEventListener("message",i);let j=()=>{k.close(),clearInterval(h),clearTimeout(f),window.removeEventListener("message",i)}})},Dc=a=>JSON.stringify({content:{request:{request:Dd(a,eJ.toHex)}},timestamp:Date.now(),callbackUrl:window.origin}),Dd=(a,b)=>"bigint"==typeof a?b(a):Array.isArray(a)?a.map(a=>Dd(a,b)):a&&"object"==typeof a?Object.fromEntries(Object.entries(a).map(([a,c])=>[a,Dd(c,b)])):a;function De({isCreatingWallet:a,skipSplashScreen:b}){return a?"EmbeddedWalletPasswordCreateScreen":b?"EmbeddedWalletPasswordUpdateScreen":"EmbeddedWalletPasswordUpdateSplashScreen"}function Df({walletAction:a,availableRecoveryMethods:b,legacySetWalletPasswordFlow:c,isResettingPassword:d,showAutomaticRecovery:e}){return e?"SetAutomaticRecoveryScreen":c||1===b.length?De({isCreatingWallet:"create"===a,skipSplashScreen:d}):"RecoverySelectionScreen"}function Dg(a){switch(a){case"user-passcode":return"PasswordRecoveryScreen";case"google-drive":case"icloud":return"RecoveryOAuthScreen";default:throw Error("Recovery method not supported")}}function Dh(a,b,c,d,e,f,g){return{...a,funding:a?.funding?{...a.funding,fundingResult:{status:b,address:a.funding.address,fundingMethod:void 0,transactionHash:c,amount:a.funding.amount,assetType:e?f?.symbol||"ETH":g.nativeCurrency.symbol||"ETH",metadata:{walletClientType:d}}}:void 0,solanaFundingData:a?.solanaFundingData,sendTransaction:a?.sendTransaction}}let Di=new Map([["FundingMethodSelectionScreen",null],["TransferFromWalletScreen","external"],["FundingAmountEditScreen","external"],["ConnectOnlyLandingScreen","external"],["ConnectOnlyStatusScreen","external"],["AwaitingExternalEthereumTransferScreen","external"],["AwaitingEvmToSolBridgingScreen","external"],["AwaitingSolToEvmBridgingScreen","external"],["ManualTransferScreen","manual"],["MoonpayStatusScreen","moonpay"]]);function Dj(a){let b=a.toLowerCase();return!!window?.webkit?.messageHandlers?.ReactNativeWebView||!!window?.ReactNativeWebView||["fbav","fban","instagram","snapchat","linkedinapp"].some(a=>b.includes(a))}async function Dk({rpc:a,address:b}){return(await a.getBalance(b,{commitment:"confirmed"}).send()).value??0n}let Dl={apple_oauth:"apple",custom_auth:"custom",discord_oauth:"discord",email:"email",farcaster:"farcaster",github_oauth:"github",google_oauth:"google",instagram_oauth:"instagram",linkedin_oauth:"linkedin",passkey:"passkey",phone:"sms",spotify_oauth:"spotify",telegram:"telegram",tiktok_oauth:"tiktok",line_oauth:"line",twitch_oauth:"twitch",twitter_oauth:"twitter",wallet:"siwe",smart_wallet:"siwe",cross_app:"privy:"},Dm=a=>{if((0,cP.i)(a))return{displayName:a.replace("custom:",""),loginMethod:"custom"};let b=Dl[a];return"wallet"===a||"phone"===a?{displayName:a,loginMethod:b}:{displayName:b,loginMethod:b}},Dn=(a,b)=>!(0,cP.b)(a)&&("all-users"===b||"users-without-wallets"===b&&!Do(a).length),Do=a=>a.linkedAccounts.filter(a=>"wallet"===a.type&&"ethereum"===a.chainType),Dp=(a,b)=>!(0,cP.c)(a)&&("all-users"===b||"users-without-wallets"===b&&!Dq(a).length),Dq=a=>a.linkedAccounts.filter(a=>"wallet"===a.type&&"solana"===a.chainType);async function Dr(a,b,c,d){let e=(0,eG.toViemTransactionSerializable)(a),{chain:f,...g}=await (async()=>d?await d():await b.prepareTransactionRequest({...e,account:{address:c,type:"json-rpc"}}))();return{...g,type:eG.STRING_TO_NUMBER_TXN_TYPE[g.type]}}let Ds=({disabled:a})=>{let{migrate:b}=(()=>{let a=(0,eH.u)(),{user:b}=(0,cP.u)(),{client:c,refreshSessionAndUser:d,walletProxy:e}=(0,cT.u)();return{migrate:(0,S.useCallback)(async()=>{if("legacy-embedded-wallets-only"===a.embeddedWallets.mode)return{success:!0};if(!b)throw new cT.a("User must be authenticated before migrating wallets",cT.b.MUST_BE_AUTHENTICATED);if(!e)throw new cT.a("Cannot connect to wallet proxy");let f=await c.getAccessToken();if(!f)throw new cT.a("User must be authenticated before migrating wallets",cT.b.MUST_BE_AUTHENTICATED);let g=b.linkedAccounts.filter(a=>"wallet"===a.type&&"privy"===a.walletClientType&&(0,cU.i)(a)&&!(0,cP.d)(a));if(0===g.length)return{success:!0};let h=g.filter(a=>a.imported),i=g.filter(a=>!a.imported);if(i.length>0){let a=i.find(a=>"ethereum"===a.chainType&&0===a.walletIndex)??i.find(a=>"solana"===a.chainType&&0===a.walletIndex)??null;if(!a)throw new cT.a("Primary wallet not found");let{entropyId:b,entropyIdVerifier:c}=(0,cS.t)(a);try{await e.connect({accessToken:f,entropyId:b,entropyIdVerifier:c})}catch(d){if(!CT(d)||"privy"!==a.recoveryMethod)throw d;await e.recover({accessToken:f,entropyId:b,entropyIdVerifier:c})}await e.createDelegatedAction({accessToken:f,rootWallet:{address:a.address,chainType:a.chainType,imported:!1},delegatedWallets:i.map(a=>({address:a.address,chainType:a.chainType,walletIndex:a.walletIndex??0}))})}for(let a of h){let{entropyId:b,entropyIdVerifier:c}=(0,cS.t)(a);try{await e.connect({accessToken:f,entropyId:b,entropyIdVerifier:c})}catch(d){if(!CT(d)||"privy"!==a.recoveryMethod)throw d;await e.recover({accessToken:f,entropyId:b,entropyIdVerifier:c})}await e.createDelegatedAction({accessToken:f,rootWallet:{address:a.address,chainType:a.chainType,imported:!0},delegatedWallets:[{address:a.address,chainType:a.chainType,walletIndex:a.walletIndex??0}]})}return await d(),{success:!0}},[a.embeddedWallets.mode,b,e,c,d])}})(),{user:c}=(0,cP.u)(),{walletProxy:d}=(0,cT.u)(),e=(0,S.useRef)(!1);return(0,S.useEffect)(()=>{!a&&!e.current&&c&&d&&(e.current=!0,b().catch(a=>{console.debug("Unable to migrate wallets: ",a)}).finally(()=>{e.current=!1}))},[c,d,a,b]),null},Dt=(0,fO.create)(()=>({ethereum:[]}));class Du{async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(fB,{token:this.meta.token})}catch(a){throw(0,cT.f)(a)}}async link(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(fC,{token:this.meta.token})}catch(a){throw(0,cT.f)(a)}}constructor(a){this.meta={token:a}}}let Dv=(0,fO.create)(()=>({jwtAuthFlowState:{status:"not-enabled"}}));function Dw({customAuth:a}){let{jwtAuthFlowState:b}=function({customAuth:a}){let b=(0,fN.a)(),c=(0,S.useRef)(),d=(0,S.useCallback)(a=>(c.current=a,()=>{c.current=void 0}),[]),e=a?.getCustomAccessToken??(()=>Promise.resolve(void 0)),{state:f}=function({subscribe:a,getExternalJwt:b,enabled:c=!0,onAuthenticated:d,onUnauthenticated:e,onError:f}){let{client:g,onCustomAuthAuthenticated:h}=(0,cT.u)(),{logout:i,authenticated:j,ready:k}=(0,fK.u)();if(!g)throw new cT.a("`useSyncJwtBasedAuthState` must be used within a `PrivyProvider`");let[l,m]=(0,S.useState)({status:"initial"}),n=(0,S.useRef)(),o=(0,S.useRef)(!1),p=(0,S.useRef)(b);(0,S.useEffect)(()=>{p.current=b},[b]);let q=(0,S.useRef)(d);(0,S.useEffect)(()=>{q.current=d},[d]);let r=(0,S.useRef)(e);(0,S.useEffect)(()=>{r.current=e},[e]);let s=(0,S.useRef)(f);return(0,S.useEffect)(()=>{s.current=f},[f]),(0,S.useEffect)(()=>{if(!c||!k)return;let b=async()=>{if(!o.current){o.current=!0;try{m({status:"loading"});let a=await p.current();if(void 0!==n.current&&n.current===a)return void m({status:"done"});if(!a)return j&&(await i(),r.current?.()),n.current=a,void m({status:"done"});g.startAuthFlow(new Du(a));let{user:b,isNewUser:c=!1}=await g.authenticate();if(!b)throw new cT.a("Failed to sync with custom auth provider");q.current?.({user:b,isNewUser:c}),h(b,c),n.current=a,m({status:"done"})}catch(a){if(console.warn(a),await i().catch(()=>{}),r.current?.(),a instanceof cT.e&&a.privyErrorCode===cT.b.LINKED_TO_ANOTHER_USER)return m({status:"initial"}),void setTimeout(()=>{b()},0);s.current?.(a),m({status:"error",error:a})}finally{o.current=!1}}};return b(),a(b)},[a,g,h,j,i,c,k]),c?{state:l}:{state:{status:"not-enabled"}}}({enabled:!0===a?.enabled,subscribe:d,getExternalJwt:e,onAuthenticated:({user:a,isNewUser:c})=>{b("login","onComplete",{user:a,isNewUser:c,wasAlreadyAuthenticated:!1,loginMethod:"custom",loginAccount:null}),b("customAuth","onAuthenticated",{user:a})},onUnauthenticated:()=>{b("customAuth","onUnauthenticated")},onError:a=>{b("login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR)}});return(0,S.useEffect)(()=>{(async()=>{a&&!a.isLoading&&c.current?.()})()},[a?.enabled,a?.getCustomAccessToken,a?.isLoading]),{jwtAuthFlowState:f}}({customAuth:a});return(0,S.useEffect)(()=>{Dv.setState({jwtAuthFlowState:b})},[b]),null}let Dx=(0,S.createContext)(!1),Dy=b=>{let c=b.client,d=b.privy,e=(0,fK.c)(),f=(0,eH.u)();(0,cR.d)((0,cR.e)(f?.appearance.walletList??[]));let[g,h]=(0,S.useState)(!1),i=Cv(a=>a.inProgressMfaFlow),[o,p]=(0,S.useState)(!1),[q,r]=(0,S.useState)(null),s=Dt(a=>a.ethereum),[t,u]=(0,S.useState)(void 0),[v,w]=(0,S.useState)(!1),[x,y]=(0,S.useState)(null),[z,A]=(0,S.useState)(!1),[B,C]=(0,S.useState)({status:"disconnected",connectedWallet:null,connectError:null,connector:null,connectRetry:cT.n}),[D,E]=(0,S.useState)({status:"initial"}),[F,G]=(0,S.useState)({status:"initial"}),[H,I]=(0,S.useState)({status:"initial"}),[J,K]=(0,S.useState)({status:"initial"}),[L,M]=(0,S.useState)({status:"initial"}),[N,O]=(0,S.useState)({status:"initial"}),[P,Q]=(0,S.useState)(null),T=(0,eH.c)(),[U,W]=(0,S.useState)({}),[X,Y]=(0,S.useState)(null),Z=(0,S.useRef)(null),[$,_]=(0,S.useState)(!1),[aa,ab]=(0,S.useState)(!1),ac=(0,S.useRef)(null),ad=(0,S.useRef)(null),ae=(0,S.useRef)(fN.p),[af,ag]=(0,S.useState)(!1),[ah,ai]=(0,S.useState)(!1),aj=(0,S.useCallback)(a=>{ai(a),!a&&x&&Cu[x]().then(a=>{a.default.isUnauthenticatedScreem&&y(null)})},[x]);c.onStoreCustomerAccessToken=a=>{a&&(0,fN.e)(ae,"accessToken","onAccessTokenGranted",{accessToken:a})},c.onDeleteCustomerAccessToken=()=>{r(null),aj(!1),(0,fN.e)(ae,"accessToken","onAccessTokenRemoved")};let ak=(0,S.useRef)(null),al=(0,S.useRef)(null),am=(0,S.useRef)(!1),an=({showWalletUIs:a})=>am.current?am.current:void 0!==a?!a:!f.embeddedWallets.showWalletUIs,ao=a=>{y(a),setTimeout(()=>{h(!0)},15)};(0,S.useEffect)(()=>{if(!q)return void c.connectors?.removeEmbeddedWalletConnectors();let a=(0,cP.b)(q),e=(0,cP.e)(q),g=(0,cP.f)(q);a&&e.length||c.connectors?.removeEmbeddedWalletConnectors(),g.length||c.connectors?.removeImportedWalletConnectors(),c.connectors?P?(a&&c.connectors.addEmbeddedWalletConnectors({walletProxy:P,user:q,embeddedWallets:e,defaultChain:f.defaultChain,appId:b.appId,privyClient:d}),g.forEach(a=>c.connectors?.addImportedWalletConnector(P,a.address,f.defaultChain,b.appId))):console.debug("Failed to add embedded wallet connector: Wallet proxy not initialized"):console.debug("Failed to add embedded wallet connector: Client connectors not initialized")},[P,q]),(0,S.useEffect)(()=>{P&&Z.current?.(P)},[P]);let ap=(0,S.useCallback)((a,b)=>{r(a),w(b),aj(!0),ab(!0)},[]);(0,S.useEffect)(()=>{aa&&P&&q&&(async()=>{let a=Dn(q,f.embeddedWallets.ethereum.createOnLogin),b=Dp(q,f.embeddedWallets.solana.createOnLogin),c=await B$();if(c){if(a&&b){let a=await P.create({accessToken:c});return await P.createSolana({accessToken:c,ethereumAddress:a?.address}),void ab(!1)}if(b)return await P.createSolana({accessToken:c,ethereumAddress:(0,cP.b)(q)?.address}),await aG.refreshSessionAndUser(),void ab(!1);if(a)return await P.create({accessToken:c}),void ab(!1)}})().catch(console.error)},[aa&&P&&q]),(0,S.useEffect)(()=>{if(f.externalWallets.solana.connectors)return f.externalWallets.solana.connectors.onMount(),()=>f.externalWallets.solana.connectors?.onUnmount()},[f.externalWallets.solana.connectors]),(0,S.useEffect)(()=>{!o&&T&&async function(){let a,b,d,e,g,h=aq(),i=ar(),j=(a=new Set,b=[],e=(d=()=>{})(),{_listeners:()=>a,clear(){a.forEach(a=>a([],{removed:[...b]})),b=[]},destroy(){this.clear(),a.clear(),e?.()},findProvider:({rdns:a})=>b.find(b=>b.info.rdns===a),getProviders:()=>b,reset(){this.clear(),e?.(),e=d()},subscribe:(c,{emitImmediately:d}={})=>(a.add(c),d&&c(b,{added:b}),()=>a.delete(c))});c.initializeConnectorManager({walletConnectCloudProjectId:f.walletConnectCloudProjectId,rpcConfig:f.rpcConfig,chains:f.chains,defaultChain:f.defaultChain,store:j,walletList:f.appearance.walletList,shouldEnforceDefaultChainOnConnect:f.shouldEnforceDefaultChainOnConnect,externalWalletConfig:f.externalWallets,appName:f.name??"Privy",walletChainType:f.appearance.walletChainType,setBaseAccountSdk:u}),c.connectors?.on("connectorInitialized",()=>{g&&clearTimeout(g);let a=c.connectors.walletConnectors.length,b=c.connectors.walletConnectors.reduce((a,b)=>a+ +!!b.initialized,0);b===a?ag(!0):g=setTimeout(()=>{console.debug({message:"Unable to initialize all expected connectors before timeout",initialized:b,expected:a}),ag(!0)},1500)}),c.connectors?.initialize().then(()=>{aw()});let k=await c.getAuthenticatedUser(),l=!!k;f.legal.requireUsersAcceptTerms&&k&&!k.hasAcceptedTerms?(await c.logout(),aG.setReadyToTrue(!0),(0,fN.e)(ae,"logout","onSuccess")):(f.customAuth?.enabled||(aj(!!k),k&&(0,fN.e)(ae,"login","onComplete",{user:k,isNewUser:!1,wasAlreadyAuthenticated:!0,loginMethod:null,loginAccount:null}),r(k)),h?al.current=l?"link":"login":i&&!l?(al.current="login",W({telegramAuthModalData:{seamlessAuth:!0}}),ao("TelegramAuthScreen")):aG.setReadyToTrue(!!k))}()},[c,X,o,T]),(0,S.useEffect)(()=>{if(o){if(!q||!q.linkedAccounts.find(a=>"wallet"===a.type&&"privy"===a.walletClientType))return void _(!!P);if([...s].some(a=>"privy"===a.walletClientType))return void _(!0);_(!!P)}},[o,q,s,P]),(0,S.useEffect)(()=>{c.connectors?.setWalletList(f.appearance.walletList)},[f.appearance.walletList.join()]);let aq=()=>{let a=function(){let a=new URLSearchParams(window.location.search),b=a.get("privy_oauth_code"),c=a.get("privy_oauth_state"),d=a.get("privy_oauth_provider");if(!b||!c||!d)return{inProgress:!1};let e=!1;try{e=!!window.opener.location.origin}catch{}return{inProgress:!0,authorizationCode:b,stateCode:c,provider:d,withPrivyUi:!cU.u.get(eH.H),popupFlow:null!==window.opener&&e,disableSignup:!!cU.u.get(eH.O)}}();return a.inProgress&&a.popupFlow?window.opener.location.origin!==window.location.origin?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Origins between parent and child windows do not match."}):"error"===a.authorizationCode?void window.opener.postMessage({type:"PRIVY_OAUTH_ERROR",error:"Something went wrong. Try again."}):void window.opener.postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:a.stateCode,authorizationCode:a.authorizationCode}):(a.inProgress&&a.provider.startsWith("privy:")&&!a.popupFlow&&(new BroadcastChannel(C7).postMessage({type:"PRIVY_OAUTH_RESPONSE",stateCode:a.stateCode,authorizationCode:a.authorizationCode}),window.close()),!!a.inProgress&&!!a.withPrivyUi&&(c.startAuthFlow(new Cb({...a,customOAuthRedirectUrl:f.customOAuthRedirectUrl})),ao("OAuthStatusScreen"),!0))},ar=()=>{let a,b=(a=function(){let a=new URLSearchParams(window.location.search),b=Number(a.get("id")||""),c=a.get("hash"),d=Number(a.get("auth_date")||""),e=a.get("first_name");if(b&&e&&d&&c)return Object.fromEntries(a.entries())}())?(Cq(),{flowType:"login-url",authData:a}):(a=function(){let a=window.location.hash;if(!a||!a.startsWith("#tgWebAppData"))return;let b=Cp(a.replace("#tgWebAppData=","")),{user:c,auth_date:d,hash:e}=b;return c&&d&&e?b:void 0}())?(Cq(),{flowType:"web-app",authData:a}):void 0;if(!b||!f.loginMethods.telegram||!f.loginConfig.telegramAuthConfiguration?.seamlessAuthEnabled)return;let d=new Cn;return c.startAuthFlow(d),"login-url"===b.flowType&&(d.meta.telegramWebAppData=void 0,d.meta.telegramAuthResult=b.authData),"web-app"===b.flowType&&(d.meta.telegramAuthResult=void 0,d.meta.telegramWebAppData=b.authData),!0},as=async(a,b,d,e)=>{if("solana_adapter"!==a)at(await c.connectors?.createEthereumWalletConnector({connectorType:a,walletClientType:b})||null,b,d,e);else{let a=c.connectors?.findSolanaWalletConnector(b);if(!a)return;at(a,b,d,e)}};async function at(a,b,c,d){if(!a)return C({status:"disconnected",connectedWallet:null,connectError:new cT.P("Unable to connect to wallet."),connector:null,connectRetry:cT.n}),d?.(null,c);C({status:"disconnected",connectedWallet:null,connectError:null,connector:a,connectRetry:cT.n}),a instanceof CP&&b&&await a.resetConnection(b),C({connector:a,status:"connecting",connectedWallet:null,connectError:null,connectRetry:()=>at(a,b,c,d)});try{let b=await a.connect({showPrompt:!0});if((!b||(0,cR.f)(b))&&f.shouldEnforceDefaultChainOnConnect&&!f.chains.find(a=>a.id===Number(b?.chainId.replace("eip155:","")))&&("wallet_connect_v2"!==b?.connectorType||"metamask"!==b?.walletClientType)){C(b=>({...b,connector:a,status:"switching_to_supported_chain",connectedWallet:null,connectError:null,connectRetry:cT.n}));try{await b?.switchChain(f.defaultChain.id),b&&(b.chainId=(0,cR.h)((0,eJ.toHex)(f.defaultChain.id)))}catch{console.warn(`Unable to switch to default chain: ${f.defaultChain.id}`)}}return C(a=>({...a,status:"connected",connectedWallet:b,connectError:null,connectRetry:cT.n})),b&&(0,fN.e)(ae,"connectWallet","onSuccess",{wallet:b}),d?.(b,c)}catch(a){return a instanceof cT.c?(console.warn(a.cause?a.cause:a.message),(0,fN.e)(ae,"connectWallet","onError",a.privyErrorCode||cT.b.GENERIC_CONNECT_WALLET_ERROR)):(console.warn(a),(0,fN.e)(ae,"connectWallet","onError",cT.b.UNKNOWN_CONNECT_WALLET_ERROR)),C(b=>({...b,status:"disconnected",connectedWallet:null,connectError:a})),d?.(null,c)}}let au=async(a,b,d)=>{if(null===a||!(0,cR.f)(a))return;let e=new Cf(c,a,b,d);c.startAuthFlow(e)},av=async(a,b,d,f="plain")=>{let g=e(fK.e);if("transaction"===f&&!g)throw new cT.a("useSolanaLedger plugin hook must be mounted");if(null===a||!(0,cR.l)(a))return;let h=new Cg(a,c,b,d,f,g);c.startAuthFlow(h)},aw=async()=>{let a=new URLSearchParams(window.location.search),b=a.get("privy_connector"),d=a.get("privy_wallet_client"),e="true"===a.get("privy_connect_only");if(!b||!d)return;let f=(0,cR.n)({connectorType:b,walletClientType:d});if(!f||!f.isInstalled)return ao("LoginFailedScreen");if(!c.connectors)throw new cT.a("Connector not initialized");await ao(e?"ConnectOnlyStatusScreen":"ConnectionStatusScreen");let g=new URL(window.location.href);g.searchParams.delete("privy_connector"),g.searchParams.delete("privy_wallet_client"),g.searchParams.delete("privy_connect_only"),window.history.pushState({},"",g),as(b,d,void 0,e?void 0:"solana_adapter"===b?av:au)};(0,S.useEffect)(()=>{o&&ah&&null===q&&c.getAuthenticatedUser().then(r)},[o,ah,q,c]);let ax=a=>{if(!ah)throw(0,fN.e)(ae,"linkAccount","onError",cT.b.MUST_BE_AUTHENTICATED,{linkMethod:a}),new cT.a("User must be authenticated before linking an account.")},ay=()=>{Dt.setState(a=>{let b=c.connectors?.wallets.filter(cR.f).map(a=>({...a,linked:(a=>{if(!ah||!q)return!1;if("privy"===a.walletClientType)return!0;for(let b of q.linkedAccounts)if("wallet"===b.type&&b.address===a.address&&"privy"!==b.walletClientType)return!0;return!1})(a),loginOrLink:async()=>{if(!await a.isConnected())throw new cT.a("Wallet is not connected");if("embedded"===a.connectorType&&"privy"===a.walletClientType)throw new cT.a("Cannot link or login with embedded wallet");(async a=>{let b;if(!c.connectors)throw new cT.a("Connector not initialized");b="ethereum"===a.type?c.connectors.findWalletConnector(a.connectorType,a.walletClientType)||null:c.connectors.findSolanaWalletConnector(a.walletClientType)||null,C(c=>({...c,connector:b,status:"connected",connectedWallet:a,connectError:null,connectRetry:cT.n})),f.captcha.enabledProvider&&!ah?(W({captchaModalData:{callback:b=>(0,cR.f)(a)?au(a,b):av(a,b),userIntentRequired:!1,onSuccessNavigateTo:"ConnectionStatusScreen",onErrorNavigateTo:"ErrorScreen"}}),await ao("CaptchaScreen")):((0,cR.f)(a)?await au(a):await av(a),await ao("ConnectionStatusScreen"))})(a)},fund:async b=>{await aG.fundWallet(a.address,b)},unlink:async()=>{if(!ah)throw new cT.a("User is not authenticated.");if("embedded"===a.connectorType&&"privy"===a.walletClientType)throw new cT.a("Cannot unlink an embedded wallet");r(await c.unlinkEthereumWallet(a.address))}}))||[];return(0,cR.j)(a.ethereum,b)?{}:{ethereum:b}})};(0,S.useEffect)(()=>{ay()},[q?.linkedAccounts,ah,o]),(0,S.useEffect)(()=>{if(o){if(!c.connectors)throw new cT.a("Connector not initialized");ay(),c.connectors.on("walletsUpdated",ay)}},[o]),(0,S.useEffect)(()=>{[...f.loginMethodsAndOrder?.primary??[],...f.loginMethodsAndOrder?.overflow??[]].filter(a=>a.startsWith("privy:")).forEach(a=>c.getCrossAppProviderDetails(a.replace("privy:","")))},[!!c]);let az=({transaction:a,sponsor:e,uiOptions:g,fundWalletConfig:h,address:i,signOnly:j})=>new Promise(async(k,l)=>{let{requesterAppId:m}=g||{},n=j?"signTransaction":"sendTransaction",o=i?(0,cP.h)(q,i):(0,cP.b)(q);if(!o&&i){let b=(0,cP.k)(Dt.getState().ethereum,i);if(b){if(e)throw new cT.a("Cannot sponsor transactions for externally connected wallet.");try{let c=await b.getEthereumProvider(),d={...a,from:i,chainId:a.chainId||Number(b.chainId.replace("eip155:","")),value:void 0!==a.value?(0,eJ.toHex)(a.value):void 0},e=await c.request({method:"sendTransaction"===n?"eth_sendTransaction":"eth_signTransaction",params:[d]});return(0,fN.e)(ae,n,"onSuccess",{hash:e}),void k({hash:e})}catch(a){return(0,fN.e)(ae,n,"onError",cT.b.TRANSACTION_FAILURE),void l(a??new cU.P("Unable to "+n+a))}}}if(!o)return(0,fN.e)(ae,n,"onError",cT.b.EMBEDDED_WALLET_NOT_FOUND),void l(new cT.a("No embedded or connected wallet found for address."));if(!ah||!q)return(0,fN.e)(ae,n,"onError",cT.b.MUST_BE_AUTHENTICATED),void l(Error("User must be authenticated before signing with a Privy wallet"));let p=o.address,r=o.walletIndex??0,{entropyId:s,entropyIdVerifier:t}=(0,cS.g)(q,o),u=aH.wallets.find(a=>"privy"===a.walletClientType&&(0,eL.getAddress)(a.address)===(0,eL.getAddress)(p));if(!u)return(0,fN.e)(ae,n,"onError",cT.b.EMBEDDED_WALLET_NOT_FOUND),void l(Error("Must have a Privy wallet before signing"));let v=await u.getEthereumProvider(),w=await v.request({method:"eth_chainId"}),x=a.chainId?Number(a.chainId):(0,cU.b)(w);if(!f.chains.map(a=>a.id).includes(x))throw new cT.P(`Chain ID ${x} is not supported. It must be added to the config.supportedChains property of the PrivyProvider.`,cT.b.UNSUPPORTED_CHAIN_ID);let y={...a,from:a.from??p,chainId:x},z=await B$();if(!z||!P)return(0,fN.e)(ae,n,"onError",cT.b.EMBEDDED_WALLET_NOT_FOUND),void l(Error("Must have valid access token and Privy wallet to send transaction"));let A=(0,v1.g)(y.chainId,f.chains,f.rpcConfig,{appId:b.appId}),B=(0,cP.d)(o),C=async({transactionRequest:a})=>{try{let b;if(!await aG.recoverEmbeddedWallet({address:p}))throw(0,fN.e)(ae,n,"onError",cT.b.UNKNOWN_CONNECT_WALLET_ERROR),l(Error("Unable to connect to wallet")),Error("Unable to connect to wallet");if(e){let b=await (async({transactionRequest:a})=>{if(!B)throw new cT.a("Sponsoring is only supported for wallets on the TEE stack");if(j)throw new cT.a("Cannot sponsor a sign transaction request");let b=a=>null==a?void 0:(0,eJ.toHex)(a),c=await (0,V.rpc)(d,async({message:a})=>await P.signWithUserSigner({accessToken:z,requesterAppId:m,message:a}),{chain_type:"ethereum",method:"eth_sendTransaction",caip2:(0,cR.h)((0,eJ.toHex)(a.chainId)),sponsor:!0,params:{transaction:{from:a.from,to:a.to,chain_id:b(a.chainId),data:(0,eM.isHex)(a.data)?a.data?a.data:(0,eJ.toHex)(Uint8Array.from(a.data)):void 0,value:b(a.value)}},wallet_id:o.id});if(c.data&&"hash"in c.data)return c.data.hash;throw new cU.P("Unable to sign transaction")})({transactionRequest:a});return(0,fN.e)(ae,"sendTransaction","onSuccess",{hash:b}),b}if(B){let c=a=>null==a?void 0:(0,eJ.toHex)(a),e=await (0,V.rpc)(d,async({message:a})=>await P.signWithUserSigner({accessToken:z,requesterAppId:m,message:a}),{chain_type:"ethereum",method:"eth_signTransaction",params:{transaction:{from:a.from,to:a.to,nonce:c(a.nonce),chain_id:c(a.chainId),data:(0,eM.isHex)(a.data)?a.data?a.data:(0,eJ.toHex)(Uint8Array.from(a.data)):void 0,value:c(a.value),type:a.type,gas_limit:c(a.gasLimit??a.gas),gas_price:c(a.gasPrice??a.gas),max_fee_per_gas:c(a.maxFeePerGas),max_priority_fee_per_gas:c(a.maxPriorityFeePerGas)}},wallet_id:o.id});if(!e.data||!("signed_transaction"in e.data))throw new cU.P("Unable to sign transaction");b=e.data.signed_transaction}else b=await async function({accessToken:a,entropyId:b,entropyIdVerifier:c,transactingWalletIndex:d,walletProxy:e,transactionRequest:f,requesterAppId:g}){return(await e.rpc({entropyId:b,entropyIdVerifier:c,hdWalletIndex:d??0,chainType:"ethereum",accessToken:a,requesterAppId:g,request:{method:"eth_signTransaction",params:[f]}})).response.data}({accessToken:z,entropyId:s,entropyIdVerifier:t,transactingWalletIndex:r,walletProxy:P,transactionRequest:a,requesterAppId:m});if(j)return(0,fN.e)(ae,"signTransaction","onSuccess",{signature:b}),b;{let a=await A.sendRawTransaction({serializedTransaction:b});return(0,fN.e)(ae,"sendTransaction","onSuccess",{hash:a}),a}}catch(a){throw(0,fN.e)(ae,n,"onError",cT.b.TRANSACTION_FAILURE),a}};if(an({showWalletUIs:g?.showWalletUIs})){let a=j||e?y:await Dr(y,A,y.from);try{let b=await C({transactionRequest:a});j?(0,fN.e)(ae,"signTransaction","onSuccess",{signature:b}):(0,fN.e)(ae,"sendTransaction","onSuccess",{hash:b}),k({hash:b})}catch(a){(0,fN.e)(ae,n,"onError",cT.b.TRANSACTION_FAILURE),l(a)}}else{let a={connectingWalletAddress:p,recoveryMethod:o.recoveryMethod,entropyId:s,entropyIdVerifier:t,onCompleteNavigateTo:"SendTransactionScreen",isUnifiedWallet:B,onFailure:a=>{(0,fN.e)(ae,n,"onError",cT.b.UNKNOWN_CONNECT_WALLET_ERROR),l(a)}},b=f.fundingConfig&&(0,cU.a)(f.fundingConfig.options).length>=1?(0,cU.p)({address:p,appConfig:f,fundWalletConfig:h,methodScreen:"FundingMethodSelectionScreen",chainIdOverride:y.chainId,comingFromSendTransactionScreen:!0}):void 0;W({connectWallet:a,sendTransaction:{transactionRequest:y,transactingWalletIndex:r,transactingWalletAddress:p,entropyId:s,entropyIdVerifier:t,signOnly:j,scanTransaction:async()=>{let a=await Dr(y,A,y.from);return await c.scanTransaction({metadata:{domain:f.embeddedWallets.transactionScanning.domain},chain_id:a.chainId.toString(),request:{method:"eth_sendTransaction",params:[{from:a.from,to:a.to,value:a.value?.toString(),gas:a.gas?.toString(),gasPrice:a.gasPrice?.toString(),nonce:a.nonce?.toString(),data:a.data}]}})},getIsSponsored:async()=>!!e,onConfirm:({transactionRequest:a})=>C({transactionRequest:a}),onSuccess:a=>{j?(0,fN.e)(ae,"signTransaction","onSuccess",{signature:a.hash}):(0,fN.e)(ae,"sendTransaction","onSuccess",{hash:a.hash}),k(a)},onFailure:a=>{(0,fN.e)(ae,n,"onError",cT.b.TRANSACTION_FAILURE),l(a)},uiOptions:g||{},fundWalletConfig:h,requesterAppId:m},funding:b}),ao("EmbeddedWalletConnectingScreen")}});function aA(){return new Promise(async(a,b)=>{let c=await B$();if(!c||!P)throw Error("Must have valid access token to enroll in MFA");try{await P.verifyMfa({accessToken:c}),a()}catch(a){b(a)}})}let aB=a=>a?.linkedAccounts.filter(a=>null!==a.latestVerifiedAt&&("wallet"!==a.type||"privy"!==a.walletClientType)).sort((a,b)=>b.latestVerifiedAt.getTime()-a.latestVerifiedAt.getTime())[0],aC=a=>{let b=q?.linkedAccounts.filter(b=>b.type===a).length??0,{displayName:c,loginMethod:d}=Dm(a);if("passkey"===a&&b>=5||"passkey"!==a&&b>=1)throw(0,fN.e)(ae,"linkAccount","onError",cT.b.CANNOT_LINK_MORE_OF_TYPE,{linkMethod:d}),new cT.a(`User already has an account of type ${c} linked.`)};async function aD({showAutomaticRecovery:a=!1,legacySetWalletPasswordFlow:b=!1}){y(null);let c=b?"setWalletPassword":"setWalletRecovery";if(!ah||!q)throw(0,fN.e)(ae,c,"onError",cT.b.MUST_BE_AUTHENTICATED),Error("User must be authenticated before adding recovery method to Privy wallet");let d=(0,cP.g)(q);if(!d||!P)throw(0,fN.e)(ae,c,"onError",cT.b.EMBEDDED_WALLET_NOT_FOUND),Error("Must have a Privy wallet to add a recovery method");let e=(0,cP.d)(d);if(e)throw(0,fN.e)(ae,c,"onError",cT.b.UNSUPPORTED_WALLET_TYPE),new cT.a("User owned wallet recovery is only supported for on-device execution and this app uses TEE execution. Learn more https://docs.privy.io/recipes/tee-wallet-migration-guide");try{await aA()}catch(a){throw(0,fN.e)(ae,c,"onError",cT.b.MISSING_MFA_CREDENTIALS),a}return new Promise((g,h)=>{let i="user-passcode"===d.recoveryMethod,j=Df({walletAction:"update",availableRecoveryMethods:f.embeddedWallets.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:b,isResettingPassword:i,showAutomaticRecovery:a}),{entropyId:k,entropyIdVerifier:l}=(0,cS.g)(q),m={recoveryMethod:d.recoveryMethod,connectingWalletAddress:d.address,onCompleteNavigateTo:j,shouldForceMFA:!1,entropyId:k,isUnifiedWallet:e,entropyIdVerifier:l,onFailure:a=>{(0,fN.e)(ae,c,"onError",cT.b.UNKNOWN_CONNECT_WALLET_ERROR),h(a)}};W({setWalletPassword:{onSuccess:a=>{(0,fN.e)(ae,c,"onSuccess",{method:"user-passcode",wallet:a}),g(a)},onFailure:a=>{(0,fN.e)(ae,c,"onError",cT.b.USER_EXITED_SET_PASSWORD_FLOW),h(a)},callAuthOnSuccessOnClose:!1},recoverWallet:{entropyId:k,entropyIdVerifier:l,onFailure:h},connectWallet:m,recoverySelection:{isInAccountCreateFlow:!1,isResettingPassword:i,shouldCreateEth:!1,shouldCreateSol:!1}}),ao("EmbeddedWalletConnectingScreen")})}async function aE({appId:a,action:b}){let d=await B$();if("link"===b&&!d)throw(0,fN.e)(ae,"linkAccount","onError",cT.b.MUST_BE_AUTHENTICATED,{linkMethod:`privy:${a}`}),new cT.a("User must be authenticated before linking an account.");if("login"===b&&d)throw(0,fN.e)(ae,"login","onError",cT.b.UNKNOWN_AUTH_ERROR),new cT.a("Attempted to log in, but user is already logged in. Use a `link` helper instead.");ak.current=`privy:${a}`,al.current=b;let e=(0,eO.trigger)();return c.createAnalyticsEvent({eventName:"cross_app_auth_started",payload:{providerAppId:a}}),new Promise(async(d,g)=>{let{name:h,logoUrl:i}=await Da({api:c.api,providerAppId:a,requesterAppId:f.id});W({crossAppAuth:{appId:a,name:h,logoUrl:i,action:b,popup:e,onSuccess:d,onError:g}}),ao("CrossAppAuthScreen")})}let aF={ready:o,authenticated:ah,user:q,walletConnectors:c.connectors||null,connectWallet:a=>{a&&"target"in a&&a&&(a=void 0),W({externalConnectWallet:{walletList:a?.walletList&&a?.walletList.length>0?a.walletList:void 0,walletChainType:a?.walletChainType,description:a?.description,hideHeader:a?.hideHeader}}),ao("ConnectOnlyLandingScreen")},linkWallet:a=>(a&&"target"in a&&a&&(a=void 0),ax("siwe"),ak.current="siwe",al.current="link",W({...U,externalConnectWallet:{...U.externalConnectWallet,walletList:a?.walletList,walletChainType:a?.walletChainType,description:a?.description||`Link a wallet to your ${f?.name} account`}}),ao("AuthenticateWithWalletScreen")),startCrossAppAuthFlow:aE,linkEmail:()=>{ax("email"),aC("email"),ak.current="email",al.current="link",ao("LinkEmailScreen")},linkPhone:()=>{ax("sms"),aC("phone"),ak.current="sms",al.current="link",ao("LinkPhoneScreen")},linkGoogle:async()=>{ax("google"),aC("google_oauth"),al.current="link",await aG.initLoginWithOAuth("google")},linkTwitter:async()=>{ax("twitter"),aC("twitter_oauth"),al.current="link",await aG.initLoginWithOAuth("twitter")},linkTwitch:async()=>{ax("twitch"),aC("twitch_oauth"),al.current="link",await aG.initLoginWithOAuth("twitch")},linkDiscord:async()=>{ax("discord"),aC("discord_oauth"),al.current="link",await aG.initLoginWithOAuth("discord")},linkGithub:async()=>{ax("github"),aC("github_oauth"),al.current="link",await aG.initLoginWithOAuth("github")},linkSpotify:async()=>{ax("spotify"),aC("spotify_oauth"),al.current="link",await aG.initLoginWithOAuth("spotify")},linkInstagram:async()=>{ax("instagram"),aC("instagram_oauth"),al.current="link",await aG.initLoginWithOAuth("instagram")},linkTiktok:async()=>{ax("tiktok"),aC("tiktok_oauth"),al.current="link",await aG.initLoginWithOAuth("tiktok")},linkLine:async()=>{ax("line"),aC("line_oauth"),al.current="link",await aG.initLoginWithOAuth("line")},linkLinkedIn:async()=>{ax("linkedin"),aC("linkedin_oauth"),al.current="link",await aG.initLoginWithOAuth("linkedin")},linkApple:async()=>{ax("apple"),aC("apple_oauth"),al.current="link",await aG.initLoginWithOAuth("apple")},linkPasskey:async()=>{ax("passkey"),aC("passkey"),await aG.initLinkWithPasskey(),ao("LinkPasskeyScreen")},linkTelegram:async a=>{if(ax("telegram"),aC("telegram"),al.current="link",ak.current="telegram",a?.launchParams)if(a.launchParams.initDataRaw){let b=new Cn;c.startAuthFlow(b),b.meta.telegramAuthResult=void 0,b.meta.telegramWebAppData=Cp(a.launchParams.initDataRaw),W({telegramAuthModalData:{seamlessAuth:!0}}),ao("TelegramAuthScreen")}else(0,fN.e)(ae,"linkAccount","onError",cT.b.INVALID_DATA,{linkMethod:"telegram"});else await aG.initLoginWithTelegram();ao("TelegramAuthScreen")},linkFarcaster:async()=>{ax("farcaster"),aC("farcaster"),await aG.initLoginWithFarcaster(),al.current="link",ak.current="farcaster",ao("FarcasterConnectStatusScreen")},updateEmail:()=>{if(ax("email"),!q?.email)throw new cT.a("User does not have an email linked to their account.");al.current="update",ak.current="email",ao("UpdateEmailScreen")},updatePhone:()=>{if(ax("sms"),!q?.phone)throw new cT.a("User does not have a phone number linked to their account.");al.current="update",ak.current="sms",ao("UpdatePhoneScreen")},login:async a=>{a&&"target"in a&&a&&(a=void 0);let b="Attempted to log in, but user is already logged in. Use a `link` helper instead.";if(!o){let a=await new Promise(a=>{Y(b=>a.bind(b))});if(Y(null),a)return void console.warn(b)}!q||q.isGuest?(al.current="login",W({login:a}),ao("LandingScreen")):console.warn(b)},connectOrCreateWallet:async()=>{o||(await new Promise(a=>{Y(()=>a)}),Y(null)),ah?console.warn("User must be unauthenticated to `connectOrCreateWallet`"):(al.current="connect-or-create",ao("ConnectOrCreateScreen"))},logout:async()=>{if(al.current=null,ak.current=null,q&&c.clearProviderAcccessTokens(q),y(null),await c.logout(),q&&P)try{await P.clearMfa({userId:q.id})}catch(a){}r(null),aj(!1),G({status:"initial"}),I({status:"initial"}),E({status:"initial"}),K({status:"initial"}),M({status:"initial"}),O({status:"initial"}),(0,fN.e)(ae,"logout","onSuccess"),h(!1),cU.u.del(eH.d),cU.u.del((0,eH.g)(f.id))},getAccessToken:(0,S.useCallback)(async()=>{let a=await c.getCustomerAccessToken();return a&&!ah&&aj(!0),a},[c,ah]),unlinkWallet:async a=>{let b;return r(b=a.startsWith("0x")?await c.unlinkEthereumWallet(a):await c.unlinkSolanaWallet(a)),b},unlinkEmail:async a=>{let b=await c.unlinkEmail(a);return r(b),b},unlinkPhone:async a=>{let b=await c.unlinkPhone(a);return r(b),b},unlinkGoogle:async a=>{let b=await c.unlinkOAuth("google",a);return r(b),b},unlinkTwitter:async a=>{let b=await c.unlinkOAuth("twitter",a);return r(b),b},unlinkTwitch:async a=>{let b=await c.unlinkOAuth("twitch",a);return r(b),b},unlinkDiscord:async a=>{let b=await c.unlinkOAuth("discord",a);return r(b),b},unlinkGithub:async a=>{let b=await c.unlinkOAuth("github",a);return r(b),b},unlinkSpotify:async a=>{let b=await c.unlinkOAuth("spotify",a);return r(b),b},unlinkInstagram:async a=>{let b=await c.unlinkOAuth("instagram",a);return r(b),b},unlinkTiktok:async a=>{let b=await c.unlinkOAuth("tiktok",a);return r(b),b},unlinkLine:async a=>{let b=await c.unlinkOAuth("line",a);return r(b),b},unlinkLinkedIn:async a=>{let b=await c.unlinkOAuth("linkedin",a);return r(b),b},unlinkApple:async a=>{let b=await c.unlinkOAuth("apple",a);return r(b),b},unlinkFarcaster:async a=>{let b=await c.unlinkFarcaster(a);return r(b),b},unlinkTelegram:async a=>{let b=await c.unlinkTelegram(a);return r(b),b},unlinkPasskey:async a=>{let b=await B$();if(!b)throw Error("Must have valid access token to enroll in MFA");if(!P)throw Error("Wallet proxy not initialized.");let d=f.passkeys.shouldUnenrollMfaOnUnlink;await P.unlinkPasskeyAccount({credentialId:a,accessToken:b,removeAsMfa:d});let e=await c.getAuthenticatedUser();return r(e),e},unlinkCrossAppAccount:async({subject:a})=>{let b=q?.linkedAccounts.find(b=>"cross_app"===b.type&&b.subject===a)?.providerApp;if(!b)throw new cT.a("Invalid subject");c.storeProviderAccessToken(b.id,null);let d=await c.unlinkOAuth(`privy:${b.id}`,a);return r(d),d},setWalletRecovery:async a=>aD({legacySetWalletPasswordFlow:!1,showAutomaticRecovery:a?.showAutomaticRecovery??!1}),setWalletPassword:async()=>aD({legacySetWalletPasswordFlow:!0,showAutomaticRecovery:!1}),signMessage:(a,b)=>new Promise(async(e,f)=>{let{requesterAppId:g}=b?.uiOptions||{},h=a.message,i=b?.address?(0,cP.h)(q,b.address):(0,cP.b)(q);if(!i&&void 0!==b?.address){let a=(0,cP.k)(Dt.getState().ethereum,b.address);if(a)try{let b=await a.getEthereumProvider(),c=await b.request({method:"personal_sign",params:[h,a.address]});return(0,fN.e)(ae,"signMessage","onSuccess",{signature:c}),void e({signature:c})}catch(a){return(0,fN.e)(ae,"signMessage","onError",cT.b.UNABLE_TO_SIGN),void f(a??new cU.P("Unable to sign message"))}}if(!i)throw new cT.a("No embedded or connected wallet found for address.");if(!ah||!q)return(0,fN.e)(ae,"signMessage","onError",cT.b.MUST_BE_AUTHENTICATED),void f(Error("User must be authenticated before signing with a Privy wallet"));let j=i.address,k=i.walletIndex??0,{entropyId:l,entropyIdVerifier:m}=(0,cS.g)(q,i),n=(0,cP.d)(i);if("string"!=typeof h||h.length<1)return(0,fN.e)(ae,"signMessage","onError",cT.b.INVALID_MESSAGE),void f(Error("Message must be a non-empty string"));let o=async()=>{let b;if(!ah)throw Error("User must be authenticated before signing with a Privy wallet");let e=await B$();if(!P||!e||!await aG.recoverEmbeddedWallet({address:j}))throw Error("Unable to connect to wallet");if(c.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_started",payload:{walletAddress:j,requesterAppId:g}}),n){let c=(0,eM.isHex)(a.message,{strict:!0}),f=await (0,V.rpc)(d,async({message:a})=>await P.signWithUserSigner({accessToken:e,requesterAppId:g,message:a}),{chain_type:"ethereum",method:"personal_sign",params:c?{message:h.slice(2),encoding:"hex"}:{message:h,encoding:"utf-8"},wallet_id:i.id});if(!f.data||!("signature"in f.data))throw new cU.P("Unable to sign message");b=f.data.signature}else{let{response:a}=await P.rpc({accessToken:e,entropyId:l,entropyIdVerifier:m,chainType:"ethereum",hdWalletIndex:k,requesterAppId:g,request:{method:"personal_sign",params:[h,j]}});b=a.data}return c.createAnalyticsEvent({eventName:"embedded_wallet_sign_message_completed",payload:{walletAddress:j,requesterAppId:g}}),b};if(an({showWalletUIs:b?.uiOptions?.showWalletUIs}))try{let a=await o();(0,fN.e)(ae,"signMessage","onSuccess",{signature:a}),e({signature:a})}catch(a){(0,fN.e)(ae,"signMessage","onError",cT.b.UNABLE_TO_SIGN),f(a??new cU.P("Unable to sign message"))}else W({signMessage:{method:"personal_sign",data:h,confirmAndSign:o,onSuccess:a=>{(0,fN.e)(ae,"signMessage","onSuccess",{signature:a}),e({signature:a})},onFailure:a=>{(0,fN.e)(ae,"signMessage","onError",cT.b.UNABLE_TO_SIGN),f(a)},uiOptions:b?.uiOptions||{}},connectWallet:{recoveryMethod:i.recoveryMethod,connectingWalletAddress:j,entropyId:l,entropyIdVerifier:m,onCompleteNavigateTo:"SignRequestScreen",isUnifiedWallet:n,onFailure:a=>{(0,fN.e)(ae,"signMessage","onError",cT.b.UNKNOWN_CONNECT_WALLET_ERROR),f(a)}}}),ao("EmbeddedWalletConnectingScreen")}),signTypedData:(a,b)=>new Promise(async(e,f)=>{let{requesterAppId:g}=b?.uiOptions||{},h=b?.address?(0,cP.h)(q,b.address):(0,cP.b)(q);if(!h&&b?.address){let c=(0,cP.k)(Dt.getState().ethereum,b.address);if(c)try{let b=await c.getEthereumProvider(),d=(0,cR.m)(a),f=await b.request({method:"eth_signTypedData_v4",params:[c.address,d]});return(0,fN.e)(ae,"signTypedData","onSuccess",{signature:f}),void e({signature:f})}catch(a){return(0,fN.e)(ae,"signTypedData","onError",cT.b.UNABLE_TO_SIGN),void f(a??new cU.P("Unable to sign typed data "+a))}}if(!h)throw new cT.a("No embedded or connected wallet found for address.");if(!ah||!q)return(0,fN.e)(ae,"signTypedData","onError",cT.b.MUST_BE_AUTHENTICATED),void f(Error("User must be authenticated before signing with a Privy wallet"));let i=h.address,j=h.walletIndex??0,{entropyId:k,entropyIdVerifier:l}=(0,cS.g)(q,h),m=(0,cP.d)(h),n=(0,cR.m)(a),o=async()=>{let a;if(!ah)throw Error("User must be authenticated before signing with a Privy wallet");let b=await B$();if(!P||!b||!await aG.recoverEmbeddedWallet({address:i}))throw Error("Unable to connect to wallet");if(c.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_started",payload:{walletAddress:i,requesterAppId:g}}),m){let{domain:c,types:e,primaryType:f,message:i}=n,j=await (0,V.rpc)(d,async({message:a})=>await P.signWithUserSigner({accessToken:b,requesterAppId:g,message:a}),{chain_type:"ethereum",method:"eth_signTypedData_v4",params:{typed_data:{domain:c,types:e,primary_type:f,message:i}},wallet_id:h.id});if(!j.data||!("signature"in j.data))throw new cU.P("Unable to sign message");a=j.data.signature}else{let{response:c}=await P.rpc({accessToken:b,entropyId:k,entropyIdVerifier:l,chainType:"ethereum",hdWalletIndex:j,requesterAppId:g,request:{method:"eth_signTypedData_v4",params:[i,n]}});a=c.data}return c.createAnalyticsEvent({eventName:"embedded_wallet_sign_typed_data_completed",payload:{walletAddress:i,requesterAppId:g}}),a};if(an({showWalletUIs:b?.uiOptions?.showWalletUIs}))try{let a=await o();(0,fN.e)(ae,"signTypedData","onSuccess",{signature:a}),e({signature:a})}catch(a){(0,fN.e)(ae,"signTypedData","onError",cT.b.UNABLE_TO_SIGN),f(a??new cU.P("Unable to sign message"))}else W({signMessage:{method:"eth_signTypedData_v4",data:n,confirmAndSign:o,onSuccess:a=>{(0,fN.e)(ae,"signTypedData","onSuccess",{signature:a}),e({signature:a})},onFailure:a=>{(0,fN.e)(ae,"signTypedData","onError",cT.b.UNABLE_TO_SIGN),f(a)},uiOptions:b?.uiOptions||{}},connectWallet:{recoveryMethod:h.recoveryMethod,connectingWalletAddress:h.address,entropyId:k,isUnifiedWallet:m,entropyIdVerifier:l,onCompleteNavigateTo:"SignRequestScreen",onFailure:a=>{(0,fN.e)(ae,"signMessage","onError",cT.b.UNKNOWN_CONNECT_WALLET_ERROR),f(a)}}}),ao("EmbeddedWalletConnectingScreen")}),sendTransaction:async(a,b)=>await az({transaction:a,sponsor:b?.sponsor,uiOptions:b?.uiOptions,fundWalletConfig:b?.fundWalletConfig,address:b?.address,signOnly:!1}),signTransaction:async(a,b)=>({signature:(await az({transaction:a,uiOptions:b?.uiOptions,address:b?.address,signOnly:!0})).hash}),exportWallet:a=>new Promise(async(d,e)=>{if(!ah||!q)return void e(Error("User must be authenticated before exporting their Privy wallet"));a&&"target"in a&&a&&(a=void 0);let f=a?.address?(0,cP.h)(q,a.address):(0,cP.b)(q);if(!f)return void e(new cT.a("User must have an embedded wallet."));let g=f.address,{entropyId:h,entropyIdVerifier:i}=(0,cS.g)(q,f),j=(0,cP.d)(f);if(!g)return void e(Error("User does not have an HD Ethereum wallet. To export an imported wallet, pass the `address` of the wallet to `exportWallet`."));if(!(0,eK.isAddress)(g))return void e(Error("Must provide a valid Ethereum address."));let k={recoveryMethod:f.recoveryMethod,connectingWalletAddress:f.address,isUnifiedWallet:j,entropyId:h,entropyIdVerifier:i,onCompleteNavigateTo:"EmbeddedWalletKeyExportScreen",onFailure:e,shouldForceMFA:!0};W(U),await B$()&&P?P?(0,cU.i)(f)?(W({keyExport:{appId:b.appId,appClientId:b.clientId,origin:c.apiUrl,address:f.address,entropyId:h,entropyIdVerifier:i,hdWalletIndex:f.walletIndex,chainType:f.chainType,walletId:f.id,isUnifiedWallet:j,imported:f.imported,onSuccess:d,onFailure:e},connectWallet:k}),ao("EmbeddedWalletConnectingScreen")):e(Error(`Export is not supported for ${f.chainType} wallets`)):e(Error("Must have a Privy wallet before exporting")):e(Error("Must have valid access token to enroll in MFA"))}),promptMfa:aA,async init(a){switch(a){case"sms":return void await c.initMfaSmsVerification();case"passkey":return await c.initMfaPasskeyVerification();case"totp":return;default:throw Error(`Unsupported MFA method: ${a}`)}},async submit(b,c){switch(b){case"totp":case"sms":if("string"!=typeof c)throw new cT.a("Invalid MFA code");ac.current?.resolve({mfaMethod:b,mfaCode:c,relyingParty:window.origin}),await new Promise((a,b)=>{ad.current={resolve:a,reject:b}});break;case"passkey":let d;if("string"==typeof c)throw new cT.a("Invalid authenticator response");let e=await a.A(148649),f={id:(d=await e.startAuthentication({optionsJSON:c})).id,raw_id:d.rawId,response:{client_data_json:d.response.clientDataJSON,authenticator_data:d.response.authenticatorData,signature:d.response.signature,user_handle:d.response.userHandle},authenticator_attachment:d.authenticatorAttachment,client_extension_results:{app_id:d.clientExtensionResults.appid,cred_props:d.clientExtensionResults.credProps,hmac_create_secret:d.clientExtensionResults.hmacCreateSecret},type:d.type};ac.current?.resolve({mfaMethod:b,mfaCode:f,relyingParty:window.origin}),await new Promise((a,b)=>{ad.current={resolve:a,reject:b}});break;default:throw ac.current?.reject(new cT.a("Unsupported MFA method")),new cT.a(`Unsupported MFA method: ${b}`)}},cancel(){ac.current?.reject(new cT.a("MFA canceled"))},async initEnrollmentWithSms(a){let b=await B$();if(!b||!P)throw Error("Must have valid access token to enroll in MFA");await P.initEnrollMfa({method:"sms",accessToken:b,phoneNumber:a.phoneNumber})},enrollInMfa:a=>new Promise((b,c)=>{a?(f.mfa.noPromptOnMfaRequired&&console.warn("[Privy Warning] Triggering the 'showMfaEnrollmentModal' function when 'noPromptOnMfaRequired' is set to true is unexpected. If this is intentional, ensure that you are building custom UIs for MFA verification."),W({mfaEnrollmentFlow:{mfaMethods:f.mfa.methods,shouldUnlinkOnUnenrollMfa:f.passkeys.shouldUnlinkOnUnenrollMfa,onSuccess:b,onFailure:c}}),ao("MfaEnrollmentFlowScreen")):(aG.closePrivyModal(),b())}),async initEnrollmentWithTotp(){let a=await B$();if(!a||!P)throw Error("Must have valid access token to enroll in MFA");let b=await P.initEnrollMfa({method:"totp",accessToken:a});return{secret:b.secret,authUrl:b.authUrl}},async submitEnrollmentWithSms(a){let b=await B$();if(!b||!P)throw Error("Must have valid access token to enroll in MFA");await P.submitEnrollMfa({method:"sms",accessToken:b,phoneNumber:a.phoneNumber,code:a.mfaCode}),r(await c.getAuthenticatedUser())},async submitEnrollmentWithTotp(a){let b=await B$();if(!b||!P)throw Error("Must have valid access token to enroll in MFA");await P.submitEnrollMfa({method:"totp",accessToken:b,code:a.mfaCode}),r(await c.getAuthenticatedUser())},async initEnrollmentWithPasskey(){},async submitEnrollmentWithPasskey({credentialIds:a},b={}){let d=await B$();if(!d||!P)throw Error("Must have valid access token to enroll in MFA");await P.submitEnrollMfa({method:"passkey",accessToken:d,credentialIds:a,removeForLogin:b.removeForLogin}),r(await c.getAuthenticatedUser())},async unenroll(a,b={}){let d=await B$();if(!d||!P)throw Error("Must have valid access token to remove MFA");"passkey"===a?await P.submitEnrollMfa({method:"passkey",accessToken:d,credentialIds:[],removeForLogin:b.removeForLogin}):await P.unenrollMfa({method:a,accessToken:d}),r(await c.getAuthenticatedUser())},requestFarcasterSignerFromWarpcast:async()=>{let a=await B$(),b=q?.linkedAccounts.find(a=>"wallet"===a.type&&"privy"===a.walletClientType);if(!a)throw Error("Must have valid access token to connect with Farcaster");if(!P||!b)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,cP.d)(b))throw new cT.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!q?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await aG.recoverEmbeddedWallet({address:b.address}))throw Error("Unable to connect to wallet");let d=await P.initFarcasterSigner({address:b.address,hdWalletIndex:null,accessToken:a,mfaCode:null,mfaMethod:null,relyingParty:window.origin});"approved"===d.status&&r(await c.getAuthenticatedUser()||q||null),W({farcasterSigner:d}),ao("FarcasterSignerStatusScreen")},getFarcasterSignerPublicKey:async()=>{let a,b=await B$(),c=q?.linkedAccounts.find(a=>"wallet"===a.type&&"privy"===a.walletClientType);if(!b)throw Error("Must have valid access token to connect with Farcaster");if(!P||!c)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,cP.d)(c))throw new cT.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!q?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await aG.recoverEmbeddedWallet({address:c.address}))throw Error("Unable to connect to wallet");if(!q.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");return a=q.farcaster.signerPublicKey.slice(2),Uint8Array.from(a.match(/.{1,2}/g).map(a=>parseInt(a,16)))},signFarcasterMessage:async b=>{let c=await B$(),d=q?.linkedAccounts.find(a=>"wallet"===a.type&&"privy"===a.walletClientType);if(!c)throw Error("Must have valid access token to connect with Farcaster");if(!P||!d)throw Error("Must have an embedded wallet to use Farcaster signers");if((0,cP.d)(d))throw new cT.a("Farcaster signers are only supported for on-device execution and this app uses TEE execution. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");if(!q?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");if(!await aG.recoverEmbeddedWallet({address:d.address}))throw Error("Unable to connect to wallet");if(!q.farcaster?.signerPublicKey)throw Error("Must have a Farcaster signer public key to sign");let e=await a.A(148649),f=await P.signFarcasterMessage({address:d.address,hdWalletIndex:null,accessToken:c,mfaCode:null,mfaMethod:null,payload:{hash:e.bufferToBase64URLString(b)},fid:BigInt(q.farcaster.fid),relyingParty:window.origin});return new Uint8Array(e.base64URLStringToBuffer(f.signature))},signMessageWithCrossAppWallet(a,{address:b,chainId:d}){let e=q?.linkedAccounts.some(a=>"cross_app"===a.type&&a.smartWallets.some(a=>a.address===b));return Db({user:q,client:c,address:b,requesterAppId:f.id,request:{method:e?"privy_signSmartWalletMessage":"personal_sign",params:[a,b],chainId:d},reconnect:aE})},signTypedDataWithCrossAppWallet(a,{address:b,chainId:d}){let e=q?.linkedAccounts.some(a=>"cross_app"===a.type&&a.smartWallets.some(a=>a.address===b)),g=(0,cR.m)(a);return Db({user:q,client:c,address:b,requesterAppId:f.id,request:{method:e?"privy_signSmartWalletTypedData":"eth_signTypedData_v4",params:[b,g],chainId:d},reconnect:aE})},sendTransactionWithCrossAppWallet(a,{address:b}){let d=q?.linkedAccounts.some(a=>"cross_app"===a.type&&a.smartWallets.some(a=>a.address===b));return Db({user:q,client:c,address:b,requesterAppId:f.id,request:{method:d?"privy_sendSmartWalletTx":"eth_sendTransaction",params:[a],chainId:a.chainId},reconnect:aE})},signTransactionWithCrossAppWallet(a,{address:b}){let d=q?.linkedAccounts.some(a=>"cross_app"===a.type&&a.smartWallets.some(a=>a.address===b));return Db({user:q,client:c,address:b,requesterAppId:f.id,request:{method:d?"privy_signSmartWalletTx":"eth_signTransaction",params:[a],chainId:a.chainId},reconnect:aE})},isModalOpen:g||!!i,mfaMethods:f.mfa.methods};j=aF.signMessage,k=aF.signTypedData,m=async(a,b)=>await az({transaction:a,...b,signOnly:!1}),l=async(a,b)=>({signature:(await az({transaction:a,...b,signOnly:!0})).hash});let aG={privy:d,setAuthenticated:aj,setUser:r,setIsNewUser:w,isNewUserThisSession:v,pendingTransaction:null,walletConnectionStatus:B,setWalletConnectionStatus:C,connectors:c.connectors?.walletConnectors??[],rpcConfig:f.rpcConfig,chains:f.chains,appId:b.appId,showFiatPrices:"native-token"!==f.embeddedWallets.priceDisplay.primary,clientAnalyticsId:c.clientAnalyticsId,onCustomAuthAuthenticated:ap,hideWalletUIs:am,isHeadlessSigning:(0,S.useCallback)(an,[f.embeddedWallets.showWalletUIs]),emailOtpState:F,setEmailOtpState:G,smsOtpState:H,setSmsOtpState:I,oAuthState:L,setOAuthState:M,telegramAuthState:N,setTelegramAuthState:O,siweState:J,setSiweState:K,isHeadlessOAuthLoading:z,baseAccountSdk:t,setBaseAccountSdk:u,nativeTokenSymbolForChainId:a=>f.chains.find(b=>b.id===Number(a))?.nativeCurrency.symbol,initializeWalletProxy:async a=>{if(P)return P;let b=new Promise(a=>{Z.current=a}),c=new Promise(b=>setTimeout(()=>b(null),a)),d=await Promise.race([b,c]);return Z.current=null,d},getAuthFlow:()=>c.authFlow,getAuthMeta:()=>c.authFlow?.meta,client:c,closePrivyModal:async(a={shouldCallAuthOnSuccess:!0,isSuccess:!1})=>{let d,g=o&&ah&&q;if(g&&ak.current&&(d=aB(q)),"login"===al.current)a.shouldCallAuthOnSuccess&&g&&ak.current?(0,fN.e)(ae,"login","onComplete",{user:q,isNewUser:v,wasAlreadyAuthenticated:!1,loginMethod:ak.current,loginAccount:d??null}):(0,fN.e)(ae,"login","onError",cT.b.USER_EXITED_AUTH_FLOW);else if("link"===al.current&&d)a.isSuccess&&g&&ak.current?(0,fN.e)(ae,"linkAccount","onSuccess",{user:q,linkMethod:ak.current,linkedAccount:d}):ak.current&&(0,fN.e)(ae,"linkAccount","onError",cT.b.USER_EXITED_LINK_FLOW,{linkMethod:ak.current});else if("update"===al.current&&d)a.isSuccess&&g&&ak.current?(0,fN.e)(ae,"update","onSuccess",{user:q,updateMethod:ak.current,updatedAccount:d}):ak.current&&(0,fN.e)(ae,"update","onError",cT.b.USER_EXITED_UPDATE_FLOW,{linkMethod:ak.current});else if("connect-or-create"===al.current){let a=Dt.getState().ethereum;a[0]?(0,fN.e)(ae,"connectOrCreateWallet","onSuccess",{wallet:a[0]}):(0,fN.e)(ae,"connectOrCreateWallet","onError",cT.b.USER_EXITED_AUTH_FLOW)}let i=x&&Di.has(x),j="ErrorScreen"===x&&U.errorModalData&&Di.has(U.errorModalData.previousScreen);if((i||j)&&U.funding){let a,c=Di.get(x)??null;if(j&&U.funding?.onError){let a=U.errorModalData?.error,b=a?.privyErrorCode||cT.b.UNKNOWN_FUNDING_ERROR,c=new cT.a(a?.message||"Funding failed",a,b);U.funding?.onError?.(c)}if("solana"===U.funding.chainType){let b=f.solanaRpcs[U.funding.chain];if(!b)return void console.warn("Unable to load solana rpc, skipping balance");if(e(fK.S))try{a=await Dk({rpc:b.rpc,address:U.funding.address})}catch{console.error("Unable to pull wallet balance")}else console.warn("Unable to load solana plugin, skipping balance");(0,fN.e)(ae,"fundSolanaWallet","onUserExited",{address:U.funding.address,fundingMethod:c,chain:U.funding.chain,balance:a})}else{let d=(0,v1.g)(U.funding.chain.id,f.chains,f.rpcConfig,{appId:b.appId});try{a=await d.getBalance({address:U.funding.address})}catch{console.error("Unable to pull wallet balance")}(0,fN.e)(ae,"fundWallet","onUserExited",{address:U.funding.address,chain:U.funding.chain,fundingMethod:c,balance:a}),function(a,b){if(a.onComplete)switch(b){case"external":a.fundingResult?a.onComplete({...a.fundingResult,fundingMethod:b}):a.onComplete({status:"cancelled",address:a.address,fundingMethod:b,amount:a.amount});break;case null:a.onComplete({status:"cancelled",address:a.address,fundingMethod:void 0,amount:a.amount});break;default:a.onComplete({status:"completed",address:a.address,fundingMethod:b,amount:a.amount})}}(U.funding,c)}}W(a=>({...a,externalConnectWallet:{}})),al.current=null,ak.current=null,w(!1),h(!1),C({status:"disconnected",connectedWallet:null,connector:null,connectError:null,connectRetry:()=>{}}),setTimeout(()=>{c.authFlow=void 0},200)},openPrivyModal:ao,connectWallet:at,initLoginWithWallet:async(a,b,c,d)=>{(0,cR.f)(a)?(ak.current="siwe",au(a,b,c)):(ak.current="siws",av(a,b,c,d))},loginWithWallet:async()=>{let a,b,d;if(!o)throw new cT.g;if(c.authFlow instanceof Cf?a="siwe":c.authFlow instanceof Cg&&(a="siws"),!a)throw new cT.a("Must initialize SIWE/SIWS flow first.");if(null!==await c.getAccessToken())try{({user:b}=await c.link()),ak.current=a}catch(b){throw(0,fN.e)(ae,"linkAccount","onError",b.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:a}),b}else try{({user:b,isNewUser:d}=await c.authenticate()),ak.current=a}catch(a){throw(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.GENERIC_CONNECT_WALLET_ERROR),a}r(b||q||null),w(d||!1),aj(!0)},delegateWallet:async({address:a,chainType:b,showDelegationUIs:c})=>new Promise(async(d,e)=>{let f=await B$();if(!ah||!q||!f)throw new cT.a("User must be authenticated and have an embedded wallet to delegate actions.");if("solana"!==b&&"ethereum"!==b)throw new cT.a("Only Solana and Ethereum embedded wallets are supported for delegation and revocation.");let g=aG.walletProxy??await aG.initializeWalletProxy(15e3);if(!g)throw new cT.a("Wallet proxy not initialized.");if((({address:a,user:b})=>!!C6(b).find(b=>b.address===a))({address:a,user:q}))return d();let h=(0,cP.h)(q,a);if(!h)throw new cT.a("Address to delegate is not associated with current user.");if((0,cP.d)(h))throw new cT.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let i=(({address:a,user:b})=>{let c=b.linkedAccounts.find(b=>"wallet"===b.type&&"privy"===b.walletClientType&&b.address===a);if(!c)throw new cT.a("Address to delegate is not associated with current user.");if(!(0,cU.i)(c))throw new cT.a(`useDelegatedActions is not supported for ${c.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:c.address,chainType:c.chainType,walletIndex:c.walletIndex??0}})({address:a,user:q}),j=(({address:a,user:b})=>{let c=b.linkedAccounts.find(b=>"wallet"===b.type&&"privy"===b.walletClientType&&b.address===a);if(!c)throw new cT.a("Address to delegate is not associated with current user.");let d=c.imported?c:(0,cP.g)(b);if(!d)throw new cT.a("Unable to determine root address for delegated address.");if(!(0,cU.i)(d))throw new cT.a(`useDelegatedActions is not supported for ${d.chainType} wallets. Use the useSessionSigners hook to provision server side access on behalf of your users.`);return{address:d.address,chainType:d.chainType,imported:d.imported}})({address:a,user:q}),k=async()=>{await g.createDelegatedAction({accessToken:f,rootWallet:j,delegatedWallets:[i]}),await aG.refreshSessionAndUser()};if(await aG.recoverEmbeddedWallet({address:a}),c)W({delegatedActions:{consent:{address:a,onDelegate:k,onSuccess:async()=>{d()},onError:async a=>{e(a)}}}}),ao("DelegatedActionsConsentScreen");else try{await k(),d()}catch(a){e(a)}}),revokeDelegatedWallets:async({showDelegationUIs:a})=>new Promise(async(b,d)=>{if(!ah||!q)throw new cT.a("User must be authenticated and have an embedded wallet to revoke a delegated wallet.");let e=C6(q);if(0===e.length)throw new cT.a("User has no delegated wallets to revoke.");if(e.some(cP.d))throw new cT.a("useDelegatedActions is only supported for on-device execution and this app uses TEE execution. Use the useSessionSigners hook to provision server side access on behalf of your users. Learn more at https://docs.privy.io/recipes/tee-wallet-migration-guide");let f=async()=>{await c.revokeDelegatedWallet(),await aG.refreshSessionAndUser()};if(a)W({delegatedActions:{revoke:{onRevoke:f,onSuccess:async()=>{b()},onError:async a=>{d(a)}}}}),ao("DelegatedActionsRevokeScreen");else try{await f(),b()}catch(a){d(a)}}),initLoginWithFarcaster:async(a,b)=>{let d=new B4(a,b);c.startAuthFlow(d);try{ak.current="farcaster",await d.initializeFarcasterConnect()}catch(a){throw"login"===al.current?(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR):"link"===al.current&&(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR,{linkMethod:"farcaster"}),a}},loginWithFarcaster:async()=>{let a,b;if(!o)throw new cT.g;if(!(c.authFlow instanceof B4))throw new cT.a("Must initialize Farcaster flow first.");if(null!==await c.getAccessToken())try{({user:a}=await c.link()),ak.current="farcaster"}catch(a){throw(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"farcaster"}),a}else try{({user:a,isNewUser:b}=await c.authenticate()),ak.current="farcaster"}catch(a){throw(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}r(a||null),w(b||!1),aj(!0)},async crossAppAuthFlow({appId:a,popup:b,action:d}){let e=`privy:${a}`;ak.current=e;let{url:f,stateCode:g,codeVerifier:h}=await async function({api:a,appId:b}){let c=B8(),d=B9(),e=await Ca(c);try{let{url:f}=await a.post(fi,{provider:`privy:${b}`,redirect_to:window.location.href,code_challenge:e,state_code:d});return{url:f,stateCode:d,codeVerifier:c}}catch(a){throw(0,cT.f)(a)}}({api:c.api,appId:a});if(!f)throw c.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:"Unable to open cross-app auth popup",appId:a}}),new cT.a("No authorization URL returned for cross-app auth.");try{let i=await async function({url:a,popup:b}){return b.location=a,new Promise((a,c)=>{let d,e=setTimeout(()=>{c(new cT.a("Authorization request timed out after 2 minutes.")),f()},12e4);function f(){b?.close(),window.removeEventListener("message",h)}let g=setInterval(()=>{b?.closed&&!d&&(f(),clearInterval(g),clearTimeout(e),c(new cT.a("User rejected request")))},300);function h(b){b.data&&("PRIVY_OAUTH_RESPONSE"===b.data.type&&b.data.stateCode&&b.data.authorizationCode&&(clearTimeout(e),a(b.data),f()),"PRIVY_OAUTH_ERROR"===b.data.type&&(clearTimeout(e),c(new cT.a(b.data.error)),f()),b.data.type===C8&&((d=new BroadcastChannel(C7)).onmessage=h))}window.addEventListener("message",h)})}({url:f,popup:b,provider:e}),j=i.stateCode,k=i.authorizationCode;if(j!==g)throw c.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:e,storedStateCode:g??"",returnedStateCode:j??""}}),new cT.a("Unexpected auth flow. This may be a phishing attempt.",void 0,cT.b.OAUTH_UNEXPECTED);let l=await async function({appId:a,stateCode:b,codeVerifier:c,authorizationCode:d,action:e,client:f}){if(!d||!b)throw new cT.a("[Cross-App AuthFlow] Authorization and state codes code must be set prior to calling authenicate.");if("undefined"===d)throw new cT.a("User denied confirmation during cross-app auth flow");try{let g=new C9({authorizationCode:d,stateCode:b,codeVerifier:c,provider:`privy:${a}`});f.startAuthFlow(g);let h="link"===e?await f.link():await f.authenticate(),i=h.oAuthTokens?.accessToken;return console.debug(),i}catch(b){let a=(0,cT.f)(b);if(a.privyErrorCode===cT.b.ACCOUNT_TRANSFER_REQUIRED)throw a;if(a.privyErrorCode)throw new cT.a(a.message||"Invalid code during cross-app auth flow.",void 0,a.privyErrorCode);if("User denied confirmation during cross-app auth flow"===a.message)throw new cT.a("Invalid code during cross-app auth flow.",void 0,cT.b.OAUTH_USER_DENIED);throw new cT.a("Invalid code during cross-app auth flow.",void 0,cT.b.UNKNOWN_AUTH_ERROR)}}({appId:a,codeVerifier:h,stateCode:j,authorizationCode:k,action:d,client:c});l&&c.storeProviderAccessToken(a,l);let m=await aG.refreshSessionAndUser();if(!m)throw new cT.a("Unable to update user");return c.createAnalyticsEvent({eventName:"cross_app_auth_completed",payload:{providerAppId:a}}),m}catch(a){throw c.createAnalyticsEvent({eventName:"cross_app_auth_error",payload:{error:a.toString(),provider:e}}),a}},async initLoginWithOAuth(a,b,d){if(ak.current=a,!(0,cU.e)()||"google"===a&&!f.allowOAuthInEmbeddedBrowsers&&Dj(window.navigator.userAgent))return void ao("InAppBrowserLoginNotPossible");"twitter"===a&&window.opener&&window.opener.postMessage({type:C8},"*"),cU.u.del(eH.H),cU.u.del(eH.O);let e=new Cb({provider:a,disableSignup:!!d,withPrivyUi:!0,customOAuthRedirectUrl:f.customOAuthRedirectUrl});b&&e.addCaptchaToken(b),c.startAuthFlow(e);let g=await c.authFlow.getAuthorizationUrl();if(g&&g.url)if("twitter"===a&&eI.isAndroid&&(g.url=g.url.replace("x.com","twitter.com")),"chrome-extension:"!==window.location.protocol||1)window.location.assign(g.url);else try{let{privyOAuthCode:a,privyOAuthState:b}=await B6(g.url);ao("OAuthStatusScreen"),e.meta.stateCode=b,e.meta.authorizationCode=a}catch(a){throw console.error("OAuth in chrome extension flow failed:",a),a}},async initLoginWithTelegram(a,b){if(!o)throw new cT.g;ak.current="telegram";let d=new Cn(a,b);c.startAuthFlow(d),O({status:"loading"}),d.meta.telegramWebAppData=void 0,d.meta.telegramAuthResult=await new Promise((a,b)=>f.loginConfig.telegramAuthConfiguration?window.Telegram?void window.Telegram.Login.auth({bot_id:f.loginConfig.telegramAuthConfiguration.botId,request_access:!0},c=>c?a(c):("link"===al.current?(0,fN.e)(ae,"linkAccount","onError",cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}):"login"===al.current?(0,fN.e)(ae,"login","onError",cT.b.INVALID_CREDENTIALS):"update"===al.current&&(0,fN.e)(ae,"login","onError",cT.b.FAILED_TO_UPDATE_ACCOUNT),b(new cT.a("Telegram auth failed or was canceled by the client")))):b(new cT.a("Telegram was not initialized")):b(new cT.a("Telegram Auth configuration is not loaded")))},async loginWithTelegram(a){let b,d;if(!(c.authFlow instanceof Cn))throw new cT.a("Must initialize Telegram flow before calling loginWithTelegram");c.authFlow.meta.captchaToken||=a?.captchaToken;let e=await B$(),f=a?.intent||al.current;if("login"===f)try{let a=await c.authenticate();b=a.user,d=a.isNewUser,ak.current="telegram"}catch(a){throw(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}else{if("link"!==f)throw new cT.a("Unknown auth intent");try{b=(await c.link()).user,ak.current="telegram"}catch(a){throw(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"telegram"}),a}}r(b),w(d||!1),aj(!0),O({status:"done"});let g=b?.linkedAccounts.find(({type:a})=>"telegram"===a)||null;return{user:b,isNewUser:d||!1,wasAlreadyAuthenticated:!!e,loginAccount:g}},async loginWithOAuth(a){let b,d,e;if(!(c.authFlow instanceof Cb))throw new cT.a("Must initialize OAuth flow before calling loginWithOAuth");let f=cU.u.get(eH.S),g=c.authFlow.meta.stateCode;if(f!==g)throw c.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:a,storedStateCode:f??"",returnedStateCode:g??""}}),new cT.a("Unexpected auth flow. This may be a phishing attempt.",void 0,cT.b.OAUTH_UNEXPECTED);if(null!==await c.getAccessToken())try{let d=await c.link();b=d.user,e=d.oAuthTokens,ak.current=a}catch(b){throw(0,fN.e)(ae,"linkAccount","onError",b.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:a}),b}else try{let f=await c.authenticate();b=f.user,d=f.isNewUser,e=f.oAuthTokens,ak.current=a}catch(b){throw"login"===al.current?(0,fN.e)(ae,"login","onError",b.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR):"link"===al.current&&(0,fN.e)(ae,"linkAccount","onError",b.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:a}),b}return r(b),w(d||!1),aj(!0),e&&b&&(0,fN.e)(ae,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:e,user:b}),e},passkeyAuthState:D,setPasskeyAuthState:E,async initSignupWithPasskey({captchaToken:a,withPrivyUi:b}){let d=new Cd({captchaToken:a,setPasskeyAuthState:E,hints:f.passkeys.registration?.hints});c.startAuthFlow(d),al.current="login";try{ak.current="passkey",E({status:"generating-challenge"}),await d.initRegisterFlow(b),E({status:"awaiting-passkey"})}catch(a){throw E({status:"error",error:a}),(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}},async signupWithPasskey(){let a,b;if(!o)throw new cT.g;if(!(c.authFlow instanceof Cd))throw new cT.a("Must initialize Passkey flow first.");if("passkey"!==ak.current){let a=new cT.a("Must init login with Passkey flow first.");throw E({status:"error",error:a}),a}let d=await B$();try{ak.current="passkey",E({status:"awaiting-passkey"}),{user:a,isNewUser:b}=await c.authenticate()}catch(a){throw E({status:"error",error:a}),(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}r(a),w(b||!1),aj(!0),E({status:"done"});let e=a?.linkedAccounts.find(({type:a})=>"passkey"===a)||null;return{user:a,isNewUser:b||!1,wasAlreadyAuthenticated:!!d,loginAccount:e}},async initLoginWithPasskey({captchaToken:a,withPrivyUi:b}){let d=new Cd({captchaToken:a,setPasskeyAuthState:E,hints:void 0});c.startAuthFlow(d),al.current="login";try{ak.current="passkey",E({status:"generating-challenge"}),await d.initAuthenticationFlow(b),E({status:"awaiting-passkey"})}catch(a){throw E({status:"error",error:a}),(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}},async loginWithPasskey(a){let b,d;if(!o)throw new cT.g;if(!(c.authFlow instanceof Cd))throw new cT.a("Must initialize Passkey flow first.");if(a?.credentialIds&&(c.authFlow.meta.allowedCredentialsIds=a.credentialIds),"passkey"!==ak.current){let a=new cT.a("Must init login with Passkey flow first.");throw E({status:"error",error:a}),a}let e=await B$();try{ak.current="passkey",E({status:"awaiting-passkey"}),{user:b,isNewUser:d}=await c.authenticate()}catch(a){throw E({status:"error",error:a}),(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}r(b),w(d||!1),aj(!0),E({status:"done"});let f=b?.linkedAccounts.find(({type:a})=>"passkey"===a)||null;return{user:b,isNewUser:d||!1,wasAlreadyAuthenticated:!!e,loginAccount:f}},async initLinkWithPasskey(a){let b=new Cd({captchaToken:a,hints:f.passkeys.registration?.hints});c.startAuthFlow(b),al.current="link",ak.current="passkey",E({status:"generating-challenge"});try{await b.initLinkFlow(),E({status:"awaiting-passkey"})}catch(a){throw(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR,{linkMethod:"passkey"}),E({status:"error",error:a}),a}},async linkWithPasskey(){let a;if(!o)throw new cT.g;if(!(c.authFlow instanceof Cd))throw new cT.a("Must initialize Passkey flow first.");if("passkey"!==ak.current)throw new cT.a("Must init login with Passkey flow first.");try{ak.current="passkey",{user:a}=await c.link()}catch(a){throw(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"passkey"}),a}return r(a||q||null),E({status:"done"}),a},async initLoginWithHeadlessOAuth(a,b,d){if(!(0,cU.e)()||"google"===a&&!f.allowOAuthInEmbeddedBrowsers&&Dj(window.navigator.userAgent))throw Error("It looks like you're using an in-app browser.  To log in, please try again using an external browser.");let e=new Cb({provider:a,withPrivyUi:!1,disableSignup:d??!1,customOAuthRedirectUrl:f.customOAuthRedirectUrl});b&&e.addCaptchaToken(b),M({status:"loading"});let g=await c.startAuthFlow(e).getAuthorizationUrl();if(g?.url)if("chrome-extension:"!==window.location.protocol||1)window.location.assign(g.url);else try{let{privyOAuthCode:a,privyOAuthState:b}=await B6(g.url);e.meta.stateCode=b,e.meta.authorizationCode=a,await this.loginWithHeadlessOAuth(e.meta)}catch(a){throw M({status:"error",error:a}),a}},async loginWithHeadlessOAuth(a){let b,d,e;A(!0),M({status:"loading"}),c.startAuthFlow(new Cb({...a,customOAuthRedirectUrl:f.customOAuthRedirectUrl}));let g=cU.u.get(eH.S),h=a.stateCode;if(g!==h)throw c.createAnalyticsEvent({eventName:"possible_phishing_attempt",payload:{provider:a.provider,storedStateCode:g??"",returnedStateCode:h??""}}),A(!1),new cT.a("Unexpected auth flow. This may be a phishing attempt.",void 0,cT.b.OAUTH_UNEXPECTED);if(null!==await c.getAccessToken())try{({user:b,oAuthTokens:e}=await c.link()),ak.current=a.provider;let d=aB(b);b&&d&&(0,fN.e)(ae,"linkAccount","onSuccess",{user:b,linkMethod:ak.current,linkedAccount:d})}catch(b){throw A(!1),(0,fN.e)(ae,"linkAccount","onError",b.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:a.provider}),b}else try{({user:b,isNewUser:d,oAuthTokens:e}=await c.authenticate()),ak.current=a.provider;let f=aB(b);b&&f&&void 0!==d&&(0,fN.e)(ae,"login","onComplete",{user:b,isNewUser:d,wasAlreadyAuthenticated:!1,loginMethod:ak.current,loginAccount:f})}catch(a){throw A(!1),M({status:"error",error:a}),(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}return r(b),w(d||!1),aj(!0),A(!1),M({status:"done"}),e&&b&&(0,fN.e)(ae,"oAuthAuthorization","onOAuthTokenGrant",{oAuthTokens:e,user:b}),b??void 0},initLoginWithEmail:async({email:a,captchaToken:b,disableSignup:d,withPrivyUi:e})=>{let f=new B1({email:a,captchaToken:b,disableSignup:d});c.startAuthFlow(f);try{ak.current="email",G({status:"sending-code"});let a=await f.sendCodeEmail({withPrivyUi:e});if(a?.ssoRedirectUrl)return window.location.href=a.ssoRedirectUrl,void await (0,cR.k)(1e4);G({status:"awaiting-code-input"})}catch(a){throw G({status:"error",error:a}),"login"===al.current?(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR):"link"===al.current&&(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"email"}),a}},initUpdateEmail:async({oldAddress:a,newAddress:b,captchaToken:d})=>{let e=new B2(a,b,d);c.startAuthFlow(e);try{await e.sendCodeEmail({withPrivyUi:!0})}catch(a){throw(0,fN.e)(ae,"update","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR,{linkMethod:ak.current}),a}},initUpdatePhone:async(a,b,d)=>{let e=new Ci(a,b,d);c.startAuthFlow(e);try{await e.sendSmsCode({withPrivyUi:!0})}catch(a){(0,fN.e)(ae,"update","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR,{linkMethod:ak.current})}},initLoginWithSms:async({phoneNumber:a,captchaToken:b,disableSignup:d,withPrivyUi:e})=>{I({status:"sending-code"});let f=new Ch({phoneNumber:a,captchaToken:b,disableSignup:d});c.startAuthFlow(f);try{ak.current="sms",await f.sendSmsCode({withPrivyUi:e}),I({status:"awaiting-code-input"})}catch(a){throw I({status:"error",error:a}),"login"===al.current?(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR):"link"===al.current&&(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"sms"}),a}},resendEmailCode:async()=>{await c.authFlow?.sendCodeEmail({withPrivyUi:!0})},resendSmsCode:async()=>{await c.authFlow?.sendSmsCode({withPrivyUi:!0})},loginWithCode:async a=>{let b,d;function e(a){c.authFlow instanceof B1?G(a):c.authFlow instanceof Ch&&I(a)}if(e({status:"submitting-code"}),!o){let a=new cT.g;throw e({status:"error",error:a}),a}if(c.authFlow instanceof B1)c.authFlow.meta.emailCode=a.trim();else{if(!(c.authFlow instanceof Ch)){let a=new cT.a("Must initialize a passwordless code flow first");throw e({status:"error",error:a}),a}c.authFlow.meta.smsCode=a.trim()}let f=await B$();if("link"===al.current)try{({user:b}=await c.link())}catch(a){throw e({status:"error",error:a}),(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:ak.current}),a}else if("update"===al.current)try{({user:b}=await c.link())}catch(a){throw e({status:"error",error:a}),(0,fN.e)(ae,"update","onError",a.privyErrorCode||cT.b.FAILED_TO_UPDATE_ACCOUNT,{linkMethod:ak.current}),a}else try{({user:b,isNewUser:d}=await c.authenticate())}catch(a){throw e({status:"error",error:a}),(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),a}let g=b||q;r(g||null),w(d||!1),aj(!0),e({status:"done"});let h=null;return c.authFlow instanceof B1?h=g?.linkedAccounts.find(({type:a})=>"email"===a)||null:c.authFlow instanceof Ch&&(h=g?.linkedAccounts.find(({type:a})=>"phone"===a)||null),{user:g,isNewUser:d||!1,wasAlreadyAuthenticated:!!f,linkedAccount:h}},generateSiweMessage:async({address:a,chainId:b,captchaToken:d})=>{al.current=ah?"link":"login",ak.current="siwe",K({status:"generating-message"});let e=await c.generateSiweNonce({address:a,captchaToken:d});return K({status:"awaiting-signature"}),Ce({address:a,chainId:b.replace("eip155:",""),nonce:e})},generateSiweMessageForSmartWallet:async({address:a,chainId:b})=>{let d=await c.generateSiweNonce({address:a});return Ce({address:a,chainId:b.replace("eip155:",""),nonce:d})},linkSmartWallet:async({message:a,signature:b,smartWalletType:d,smartWalletVersion:e})=>{let f;f=await c.linkSmartWallet({message:a,signature:b,smartWalletType:d,smartWalletVersion:e}),r((f=await aG.refreshSessionAndUser()??f)||q||null)},loginWithSiwe:async({message:a,signature:b,captchaToken:d,disableSignup:e,walletClientType:f,connectorType:g})=>{let h,i=null;try{if(q)throw Error("User already authenticated");let j=new Cf(c,void 0,d,e,{message:a,signature:b,walletClientType:f,connectorType:g});c.startAuthFlow(j),ak.current="siwe",al.current="login",K({status:"submitting-signature"});let k=await c.authenticate();if({user:i,isNewUser:h}=k,!i)throw Error("Authentication failed - no user returned")}catch(a){throw(0,fN.e)(ae,"login","onError",a.privyErrorCode||cT.b.UNKNOWN_AUTH_ERROR),K({status:"error",error:a}),a}return r(i),w(h||!1),aj(!0),K({status:"done"}),al.current=null,ak.current=null,{user:i,isNewUser:h||!1}},linkWithSiwe:async({message:a,signature:b,chainId:d,walletClientType:e,connectorType:f})=>{let g;ax("siwe");let h=null;try{K({status:"submitting-signature"}),g=await c.linkWithSiwe({message:a,signature:b,chainId:d,walletClientType:e,connectorType:f}),g=await aG.refreshSessionAndUser()??g,K({status:"done"}),(h=aB(g)||null)&&(0,fN.e)(ae,"linkAccount","onSuccess",{user:g,linkMethod:"siwe",linkedAccount:h})}catch(a){throw(0,fN.e)(ae,"linkAccount","onError",a.privyErrorCode||cT.b.FAILED_TO_LINK_ACCOUNT,{linkMethod:"siwe"}),al.current=null,ak.current=null,K({status:"error",error:a}),a}let i=g||q;return r(i||null),al.current=null,ak.current=null,{user:i,linkedAccount:h}},refreshSessionAndUser:async()=>{let a=await c.getAuthenticatedUser();return aj(!!a),r(a),a},walletProxy:P,createAnalyticsEvent:({eventName:a,payload:b,timestamp:d})=>c.createAnalyticsEvent({eventName:a,payload:b,timestamp:d}),acceptTerms:async()=>{let a=await c.acceptTerms();return r(a),a},getUsdTokenPrice:a=>c.getUsdTokenPrice(a),getUsdPriceForSol:()=>c.getUsdPriceForSol(),getSplTokenMetadata:a=>c.getSplTokenMetadata(a),recoverEmbeddedWallet:async a=>new Promise(async(b,d)=>{if(!q)return void b(!0);let e=a?.address?(0,cP.h)(q,a.address):(0,cP.g)(q)||(0,cP.f)(q).at(0)||(0,cP.j)(q).at(0);if(!e||(0,cP.d)(e))return void b(!0);let f=await B$();if(!f||!P||!e)return void d(Error("Must have valid access token and Privy wallet to recover wallet"));let{entropyId:g,entropyIdVerifier:h}=(0,cS.g)(q,e);try{await P.connect({accessToken:f,entropyId:g,entropyIdVerifier:h}),b(!0)}catch(a){if(CT(a)&&"privy"===e.recoveryMethod){let a;c.createAnalyticsEvent({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:e.address}});try{a=await P.recover({entropyId:g,entropyIdVerifier:h,accessToken:f})}catch(a){return void d(a)}a.entropyId||d(Error("Unable to recover wallet")),c.createAnalyticsEvent({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:e.address}}),b(!0)}else CT(a)&&"privy"!==e.recoveryMethod&&"privy-v2"!==e.recoveryMethod?(W({recoverWallet:{entropyId:g,entropyIdVerifier:h,onFailure:d,onSuccess:()=>b(!0)},recoveryOAuthStatus:{provider:e.recoveryMethod,action:"recover",shouldCreateEth:!1,shouldCreateSol:!1}}),ao(Dg(e.recoveryMethod))):d(a)}}),setReadyToTrue:a=>{p(!0),X?.(a)},updateWallets:()=>ay(),fundWallet:async(a,b)=>{let c="FundingMethodSelectionScreen";return new Promise((d,e)=>{W({funding:{...(0,cU.p)({address:a,appConfig:f,fundWalletConfig:b,methodScreen:c,onComplete:d,onError:e})}}),ao(c)})},openModal:ao,requestFarcasterSignerStatus:async a=>{let b=await B$(),d=q?.linkedAccounts.find(a=>"wallet"===a.type&&"privy"===a.walletClientType);if(!b)throw Error("Must have valid access token to connect with Farcaster");if(!P||!d)throw Error("Must have an embedded wallet to use Farcaster signers");if(!q?.farcaster?.fid)throw Error("Must have Farcaster account to use Farcaster signers");let e=await c.requestFarcasterSignerStatus(a);return"approved"===e.status&&r(await c.getAuthenticatedUser()||q||null),e},connectCoinbaseSmartWallet:async()=>{f.externalWallets.coinbaseWallet.config.preference={...f.externalWallets.coinbaseWallet.config.preference,options:"smartWalletOnly"};let a=c.connectors?.findWalletConnector("coinbase_wallet","coinbase_smart_wallet")||c.connectors?.findWalletConnector("coinbase_wallet","coinbase_wallet");if(a)return a.updateConnectionPreference("smartWalletOnly"),at(a);await as("coinbase_wallet","coinbase_smart_wallet")},connectBaseAccount:async()=>{let a=c.connectors?.findWalletConnector("base_account","base_account");if(a)return at(a);await as("base_account","base_account")},initiateAccountTransfer:async({nonce:a,account:b,accountType:d,externalWalletMetadata:e,telegramAuthResult:f,telegramWebAppData:g,farcasterEmbeddedAddress:h,oAuthUserInfo:i})=>{let j=await c.sendAccountTransferRequest({nonce:a,account:b,accountType:d,externalWalletMetadata:e,telegramAuthResult:f,telegramWebAppData:g,farcasterEmbeddedAddress:h,oAuthUserInfo:i});return r(j),j},inProgressAuthFlowRef:al,inProgressLoginOrLinkMethodRef:ak};n=aG.recoverEmbeddedWallet,aG.recoverEmbeddedWallet;let aH=(0,S.useMemo)(()=>({wallets:s,ready:$&&af}),[s,$,af]),aI=c.authFlow instanceof Cn,{siteKey:aJ,enabledProvider:aK}=f.captcha,aL=!f.headless&&aK&&!ah&&(o||aI);return(0,R.jsx)(Dx.Provider,{value:!0,children:(0,R.jsx)(cP.P.Provider,{value:aF,children:(0,R.jsx)(fN.P.Provider,{value:ae,children:(0,R.jsx)(cS.U.Provider,{value:aH,children:(0,R.jsx)(Cl,{appId:f.id,captchaSiteKey:aJ,enabledCaptchaProvider:aK,children:(0,R.jsxs)(cT.I.Provider,{value:aG,children:[(0,R.jsx)(cR.R,{children:(0,R.jsxs)(cP.M,{data:U,setModalData:W,setInitialScreen:y,initialScreen:x,authenticated:ah,open:g,children:[b.children,(0,R.jsx)(Dw,{customAuth:f.customAuth}),aL&&(0,R.jsx)(Ct,{delayedExecution:!1}),(0,R.jsx)(CO,{}),(0,R.jsx)(Ds,{disabled:f.embeddedWallets.disableAutomaticMigration}),(0,R.jsx)(Cw,{palette:f.appearance.palette||{}}),!f.render.standalone&&(0,R.jsx)(CJ,{open:g})]})}),(0,R.jsx)(C5,{appId:b.appId,appClientId:b.clientId,clientAnalyticsId:c.clientAnalyticsId,origin:c.apiUrl,mfaMethods:q?.mfaMethods,mfaPromise:ac,mfaSubmitPromise:ad,onLoad:Q,onLoadFailed:()=>null}),f.loginConfig.telegramAuthConfiguration&&(0,R.jsx)(cR.H,{$if:!0,children:(0,R.jsx)(CN,{scriptHost:b.apiUrl||eH.D,botUsername:f.loginConfig.telegramAuthConfiguration.botName})})]})})})})})})};class Dz extends Error{constructor(a,b,c){super(a),this.code=b,this.data=c}}class DA extends cQ.default{async handleSendTransaction(a){let b;if(!a.params||!Array.isArray(a.params))throw new Dz(`Invalid params for ${a.method}`,4200);let c=a.params[0];if(!await B$()||!this.address)throw new Dz("Disconnected",4900);let{hash:d}=await (b={address:this.address},m(c,b));return d}async handleSignTransaction(a){let b;if(!a.params||!Array.isArray(a.params))throw new Dz(`Invalid params for ${a.method}`,4200);let c=a.params[0];if(!await B$()||!this.address)throw new Dz("Disconnected",4900);let{signature:d}=await (b={address:this.address},l(c,b));return d}handleSwitchEthereumChain(a){let b;if(!a.params||!Array.isArray(a.params))throw new Dz(`Invalid params for ${a.method}`,4200);if("string"==typeof a.params[0])b=a.params[0];else{if(!("chainId"in a.params[0])||"string"!=typeof a.params[0].chainId)throw new Dz(`Invalid params for ${a.method}`,4200);b=a.params[0].chainId}this.chainId=Number(b),this.publicClient=(0,v1.g)(this.chainId,this.chains,this.rpcConfig,{appId:this.appId}),this.emit("chainChanged",b)}async handlePersonalSign(a){if(!a.params||!Array.isArray(a.params))throw Error("Invalid params for personal_sign");let b=a.params[0],c=a.params[1],{signature:d}=await j({message:b},{address:c});return d}async handleSignedTypedData(a){let b;if(!a.params||!Array.isArray(a.params))throw Error("Invalid params for eth_signTypedData_v4");let c=a.params[0],d="string"==typeof a.params[1]?JSON.parse(a.params[1]):a.params[1],{signature:e}=await (b=(0,cR.m)(d),k(b,{address:c}));return e}async handleEstimateGas(a){if(!a.params||!Array.isArray(a.params))throw Error("Invalid params for eth_estimateGas");delete a.params[0].gasPrice,delete a.params[0].maxFeePerGas,delete a.params[0].maxPriorityFeePerGas;let b={...a.params[0],chainId:(0,cR.t)(this.chainId)};return await this.publicClient.estimateGas({account:b.from??this.address,...(0,eG.toViemTransactionSerializable)(b)})}async request(a){let b;switch(console.debug("Embedded1193Provider.request() called with args",a),a.method){case"eth_accounts":case"eth_requestAccounts":return this.address?[this.address]:[];case"eth_chainId":return(0,cR.t)(this.chainId);case"eth_estimateGas":return this.handleEstimateGas(a);case"eth_sendTransaction":return this.handleSendTransaction(a);case"eth_signTransaction":return this.handleSignTransaction(a);case"wallet_switchEthereumChain":return this.handleSwitchEthereumChain(a);case"personal_sign":return this.handlePersonalSign(a);case"eth_signTypedData_v4":return this.handleSignedTypedData(a)}if(b=a.method,!B_.includes(b))return this.publicClient.request({method:a.method,params:a.params});{let b,c=await B$();if(await (b={address:this.address},n(b)),!c||!this.address)throw new Dz("Disconnected",4900);try{let b={method:a.method,params:a.params},d=this.walletAccount;return d&&(0,cP.d)(d)?this.handleWalletApiRequest(b,d,c):(await this.walletProxy.rpc({accessToken:c,entropyId:this.entropyId,entropyIdVerifier:this.entropyIdVerifier,chainType:"ethereum",hdWalletIndex:this.walletIndex,request:b})).response.data}catch(a){throw console.error(a),new Dz("Disconnected",4900)}}}async handleWalletApiRequest(a,b,c){let d=this.privyClient;if(!d)throw new Dz("Disconnected",4900);if("secp256k1_sign"===a.method){let e=await (0,V.rpc)(d,async({message:a})=>this.walletProxy.signWithUserSigner({accessToken:c,message:a}),{chain_type:"ethereum",method:"secp256k1_sign",wallet_id:b.id,params:{hash:a.params[0]}});if("secp256k1_sign"!==e.method)throw new Dz(`Invalid params for ${a.method}`,4200);return e.data.signature}throw new Dz(`Method not supported: ${a.method}`,4200)}constructor({walletProxy:a,address:b,entropyId:c,entropyIdVerifier:d,rpcConfig:e,chains:f,appId:g,chainId:h=1,walletIndex:i,privyClient:j,walletAccount:k}){super(),this.walletProxy=a,this.address=b,this.entropyId=c,this.entropyIdVerifier=d,this.chainId=h,this.rpcConfig=e,this.chains=f,this.publicClient=(0,v1.g)(h,this.chains,e,{appId:g}),this.rpcTimeoutDuration=(0,cR.c)(e,"privy"),this.appId=g,this.walletIndex=i,this.privyClient=j,this.walletAccount=k}}let DB=({style:a,...b})=>(0,R.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",style:{...a},...b,children:(0,R.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25"})}),DC=({style:a,...b})=>(0,R.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"108",height:"108",viewBox:"0 0 108 108",fill:"none",style:{height:"28px",width:"28px",...a},...b,children:[(0,R.jsx)("rect",{width:"108",height:"108",rx:"23",fill:"#AB9FF2"}),(0,R.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M46.5267 69.9229C42.0054 76.8509 34.4292 85.6182 24.348 85.6182C19.5824 85.6182 15 83.6563 15 75.1342C15 53.4305 44.6326 19.8327 72.1268 19.8327C87.768 19.8327 94 30.6846 94 43.0079C94 58.8258 83.7355 76.9122 73.5321 76.9122C70.2939 76.9122 68.7053 75.1342 68.7053 72.314C68.7053 71.5783 68.8275 70.7812 69.0719 69.9229C65.5893 75.8699 58.8685 81.3878 52.5754 81.3878C47.993 81.3878 45.6713 78.5063 45.6713 74.4598C45.6713 72.9884 45.9768 71.4556 46.5267 69.9229ZM83.6761 42.5794C83.6761 46.1704 81.5575 47.9658 79.1875 47.9658C76.7816 47.9658 74.6989 46.1704 74.6989 42.5794C74.6989 38.9885 76.7816 37.1931 79.1875 37.1931C81.5575 37.1931 83.6761 38.9885 83.6761 42.5794ZM70.2103 42.5795C70.2103 46.1704 68.0916 47.9658 65.7216 47.9658C63.3157 47.9658 61.233 46.1704 61.233 42.5795C61.233 38.9885 63.3157 37.1931 65.7216 37.1931C68.0916 37.1931 70.2103 38.9885 70.2103 42.5795Z",fill:"#FFFDF8"})]});function DD(a,b){if(!Object.prototype.hasOwnProperty.call(a,b))throw TypeError("attempted to use private field on non-instance");return a}var DE=0;class DF extends cR.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(a){return a.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return{name:this.providerDetail.info.name,icon:this.providerDetail.info.icon,id:this.providerDetail.info.rdns}}disconnect(){console.warn(`Programmatic disconnect with ${this.providerDetail.info.name} is not yet supported.`)}async promptConnection(){try{let a=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!a||0===a.length||!a[0])throw new cT.P("Unable to retrieve accounts");await this.syncAccounts([a[0]])}catch(a){throw(0,cU.f)(a)}}constructor(a,b,c,d,e){super(e||"unknown",a,b,c),this.connectorType="injected",this.proxyProvider=new cR.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.providerDetail=d;let f=d.provider;this.proxyProvider.setWalletProvider(f)}}var DG="__private_"+DE+++"__walletBranding";class DH extends cR.E{async initialize(){await this.syncAccounts(),this.initialized=!0,this.emit("initialized")}async connect(a){return a.showPrompt&&await this.promptConnection(),await this.isConnected()?this.getConnectedWallet():null}get walletBranding(){return DD(this,DG)[DG]??{name:"Browser Extension",icon:DB,id:"extension"}}disconnect(){console.warn("Programmatic disconnect with browser wallets is not yet supported.")}async promptConnection(){try{let a=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!a||0===a.length||!a[0])throw new cT.P("Unable to retrieve accounts");await this.syncAccounts([a[0]])}catch(a){throw(0,cU.f)(a)}}constructor(a,b,c,d,e){super(e??"unknown",a,b,c),Object.defineProperty(this,DG,{writable:!0,value:void 0}),this.connectorType="injected",this.proxyProvider=new cR.P(void 0,this.rpcTimeoutDuration),this.subscribeListeners(),this.proxyProvider.setWalletProvider(d),"metamask"===e?DD(this,DG)[DG]={name:"MetaMask",icon:cR.M,id:"io.metamask"}:"phantom"===e&&(DD(this,DG)[DG]={name:"Phantom",icon:DC,id:"phantom"})}}class DI extends DF{disconnect(){console.warn("MetaMask does not support programmatic disconnect.")}async promptConnection(){try{eI.isMobile||await this.proxyProvider.request({method:"wallet_requestPermissions",params:[{eth_accounts:{}}]});let a=await this.proxyProvider.request({method:"eth_requestAccounts"});if(!a||0===a.length||!a[0])throw new cT.P("Unable to retrieve accounts");await this.syncAccounts([a[0]])}catch(a){throw(0,cU.f)(a)}}}class DJ extends cQ.default{get wallets(){let a=new Set;return this.walletConnectors.flatMap(a=>a.wallets).sort((a,b)=>a.connectedAt&&b.connectedAt?b.connectedAt-a.connectedAt:0).filter(b=>{let c=`${b.address}${b.walletClientType}${b.connectorType}${b.meta.id}`;return!a.has(c)&&(a.add(c),!0)})}async initialize(a){if(this.initialized&&!a||(a&&this.removeAllConnectors(),this.externalWalletConfig.disableAllExternalWallets))return;let b=(0,cR.o)({store:this.store,walletList:this.walletList,externalWalletConfig:this.externalWalletConfig,walletChainType:this.walletChainType}).then(a=>{a.forEach(({type:a,eip6963InjectedProvider:b,legacyInjectedProvider:c})=>{this.createEthereumWalletConnector({connectorType:"injected",walletClientType:a,providers:{eip6963InjectedProvider:b,legacyInjectedProvider:c}})})});for(let a of(this.walletList.includes("coinbase_wallet")&&this.createEthereumWalletConnector({connectorType:"coinbase_wallet",walletClientType:"coinbase_wallet"}),this.walletList.includes("base_account")&&this.createEthereumWalletConnector({connectorType:"base_account",walletClientType:"base_account"}),Object.values(cR.q)))!a.isInstalled&&this.walletList.includes(a.client)&&(["ethereum-only","ethereum-and-solana"].includes(this.walletChainType)&&a.chainTypes.includes("ethereum")&&this.createEthereumWalletConnector({connectorType:"null",walletClientType:a.client,walletConfig:a}),["ethereum-and-solana","solana-only"].includes(this.walletChainType)&&a.chainTypes.includes("solana")&&this.addSolanaWalletConnector(new cR.S({id:a.client,name:a.name})));this.externalWalletConfig.walletConnect.enabled&&(this.walletList.includes("wallet_connect_qr")||(0,cR.e)(this.walletList))&&"solana-only"!==this.walletChainType&&this.createEthereumWalletConnector({connectorType:"wallet_connect_v2",walletClientType:"unknown"});let c=this.walletList.includes("wallet_connect_qr_solana")||(0,cR.e)(this.walletList)&&"ethereum-only"!==this.walletChainType,d=this.externalWalletConfig.solana.connectors?.get()||[],e=async a=>{if(!c)return;let b=a.find(a=>"walletconnect_solana"===a.walletBranding?.id);b&&b.wallet&&await b.wallet.initialize({walletConnectCloudProjectId:this.walletConnectCloudProjectId,privyAppName:this.privyAppName})};e(d),d.filter(a=>c||"walletconnect_solana"!==a.walletBranding?.id).forEach(this.addSolanaWalletConnector),this.externalWalletConfig.solana.connectors?._setOnConnectorsUpdated?.(a=>{e(a),a?.filter(a=>c||"walletconnect_solana"!==a.walletBranding?.id).forEach(this.addSolanaWalletConnector)}),await b,this.initialized=!0}findWalletConnector(a,b,c){return"wallet_connect_v2"===a?this.walletConnectors.filter(cR.r).find(b=>b.connectorType===a&&(!c||b.wallets.some(a=>a.address===c)))??null:this.walletConnectors.filter(cR.r).find(d=>d.connectorType===a&&d.walletClientType===b&&(!c||d.wallets.some(a=>a.address===c)))??null}findSolanaWalletConnector(a){return this.walletConnectors.filter(cR.v).find(b=>"unknown"===b.walletClientType?b.walletBranding.id===a:b.walletClientType===a)??null}findEmbeddedWalletConnectors(){return this.walletConnectors.filter(a=>"embedded"===a.connectorType)}findImportedWalletConnectors(){return this.walletConnectors.filter(a=>"embedded_imported"===a.connectorType)}onInitialized(a){a.wallets.forEach(a=>{let b=this.storedConnections.find(b=>b.address===a.address&&b.connectorType===a.connectorType&&("solana"===a.type&&"unknown"===b.walletClientType&&"unknown"===a.walletClientType?a.meta.id===b.id:b.walletClientType===a.walletClientType));b&&(a.connectedAt=b.connectedAt)}),this.emit("walletsUpdated"),this.emit("connectorInitialized")}onWalletsUpdated(a){a.initialized&&this.emit("walletsUpdated")}addEmbeddedWalletConnectors({walletProxy:a,user:b,embeddedWallets:c,defaultChain:d,appId:e,privyClient:f}){let{entropyId:g,entropyIdVerifier:h}=(0,cS.g)(b);for(let b of c){let c=this.findEmbeddedWalletConnectors().find(a=>a.walletIndex===b.walletIndex);if(c&&(0,cR.r)(c))c.proxyProvider.walletProxy=a;else{let c=new BZ({provider:new DA({walletProxy:a,address:b.address,entropyId:g,entropyIdVerifier:h,rpcConfig:this.rpcConfig,chains:this.chains,appId:e,chainId:d.id,walletIndex:b.walletIndex,privyClient:f,walletAccount:b}),chains:this.chains,defaultChain:d,rpcConfig:this.rpcConfig,imported:!1,walletIndex:b.walletIndex});this.addWalletConnector(c)}}}addImportedWalletConnector(a,b,c,d){let e=this.findWalletConnector("embedded_imported","privy",b);if(e&&(0,cR.r)(e))e.proxyProvider.walletProxy=a;else{let e=new BZ({provider:new DA({walletProxy:a,address:b,entropyId:b,entropyIdVerifier:"ethereum-address-verifier",walletIndex:0,rpcConfig:this.rpcConfig,chains:this.chains,appId:d,chainId:c.id}),chains:this.chains,walletIndex:0,defaultChain:c,rpcConfig:this.rpcConfig,imported:!0});this.addWalletConnector(e)}}removeEmbeddedWalletConnectors(){this.walletConnectors=this.walletConnectors.filter(a=>"embedded"!==a.connectorType),this.storedConnections=(0,cU.l)(),this.emit("walletsUpdated")}removeImportedWalletConnectors(){let a=this.findImportedWalletConnectors();a.length&&(a.forEach(a=>{let b=this.walletConnectors.indexOf(a);this.walletConnectors.splice(b,1)}),this.storedConnections=(0,cU.l)(),this.emit("walletsUpdated"))}async createEthereumWalletConnector({connectorType:a,walletClientType:b,providers:c,walletConfig:d}){let e=this.findWalletConnector(a,b);if(e&&(0,cR.r)(e))return e instanceof CP&&e.resetConnection(b),e;let f="injected"!==a?"coinbase_wallet"===a?new BX(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.coinbaseWallet.config):"base_account"===a?new BV(this.chains,this.defaultChain,this.rpcConfig,this.externalWalletConfig.baseAccount.config,this.setBaseAccountSdk):"null"!==a?new CP({walletConnectCloudProjectId:this.walletConnectCloudProjectId,rpcConfig:this.rpcConfig,chains:this.chains,defaultChain:this.defaultChain,shouldEnforceDefaultChainOnConnect:this.shouldEnforceDefaultChainOnConnect,privyAppId:this.privyAppId,privyAppName:this.privyAppName,walletClientType:b}):d?new cR.w({id:d.client,name:d.name,defaultChain:this.defaultChain,walletClientType:d.client}):null:"metamask"===b&&c?.eip6963InjectedProvider?new DI(this.chains,this.defaultChain,this.rpcConfig,c?.eip6963InjectedProvider,"metamask"):"metamask"===b&&c?.legacyInjectedProvider?new DH(this.chains,this.defaultChain,this.rpcConfig,c?.legacyInjectedProvider,"metamask"):"phantom"===b&&c?.legacyInjectedProvider?new DH(this.chains,this.defaultChain,this.rpcConfig,c?.legacyInjectedProvider,"phantom"):c?.legacyInjectedProvider&&"unknown_browser_extension"===b?new DH(this.chains,this.defaultChain,this.rpcConfig,c?.legacyInjectedProvider):c?.eip6963InjectedProvider?new DF(this.chains,this.defaultChain,this.rpcConfig,c?.eip6963InjectedProvider,b):void 0;return f&&this.addWalletConnector(f),f||null}addWalletConnector(a){this.walletConnectors.push(a),a.on("initialized",()=>this.onInitialized(a)),a.on("walletsUpdated",()=>this.onWalletsUpdated(a)),a.initialize().catch(a=>{console.debug("Failed to initialize connector",a)})}setWalletList(a){this.walletList=a,this.initialized&&this.initialize(!0).catch(console.error)}removeAllConnectors(){for(let a of this.walletConnectors)a.removeAllListeners();this.walletConnectors=[]}constructor(a,b,c,d,e,f,g,h,i,j,k,l){super(),this.addSolanaWalletConnector=async a=>{let b=this.findSolanaWalletConnector(a.walletClientType);if(!b||"null"===b.connectorType){if("null"===b?.connectorType){let a=this.walletConnectors.indexOf(b);this.walletConnectors.splice(a,1)}this.addWalletConnector(a)}},this.privyAppId=a,this.walletConnectCloudProjectId=b,this.rpcConfig=c,this.chains=d,this.defaultChain=e,this.walletConnectors=[],this.initialized=!1,this.store=f,this.walletList=g,this.shouldEnforceDefaultChainOnConnect=h,this.externalWalletConfig=i,this.privyAppName=j,this.walletChainType=l||"ethereum-only",this.setBaseAccountSdk=k,this.storedConnections=(0,cU.l)()}}let DK=(0,fO.create)(()=>({identityToken:null})),DL=[eP,eQ,fA];class DM{async get(a,b){try{return await this.baseFetch(a,b)}catch(a){throw(0,cT.f)(a)}}async post(a,b,c){try{return await this.baseFetch(a,{method:"POST",...b?{body:b}:{},...c})}catch(a){throw(0,cT.f)(a)}}async delete(a,b){try{return await this.baseFetch(a,{method:"DELETE",...b})}catch(a){throw(0,cT.f)(a)}}constructor({appId:a,appClientId:b,client:c,defaults:d}){this.appId=a,this.appClientId=b,this.clientAnalyticsId=c.clientAnalyticsId,this.sdkVersion=eH.V,this.client=c,this.defaults=d,this.fallbackApiUrl=c.fallbackApiUrl,this.baseFetch=v2.ofetch.create({baseURL:this.defaults.baseURL,timeout:this.defaults.timeout,retry:3,retryDelay:500,retryStatusCodes:[408,409,425,500,502,503,504],credentials:"include",onRequest:async({request:a,options:b})=>{let c=new Headers(b.headers);c.set("privy-app-id",this.appId),this.appClientId&&c.set("privy-client-id",this.appClientId),c.set("privy-ca-id",this.clientAnalyticsId||""),c.set("privy-client",`react-auth:${this.sdkVersion}`);let d=DL.includes(a.toString());if(!c.has("authorization")){let a=await this.client.getAccessToken({disableAutoRefresh:d});null!==a&&c.set("authorization",`Bearer ${a}`)}b.headers=c,b.retryDelay&&"number"==typeof b.retryDelay&&(b.retryDelay=3*b.retryDelay)},onRequestError:({error:a})=>{if(a instanceof DOMException&&"AbortError"===a.name)throw new cT.h}})}}class DN{getOrCreateGuestCredential(a){let b=(0,eH.g)(a);if((0,cU.e)()){if(cU.u.get(b))return cU.u.get(b);{let a=cO.encode(B7(32));return cU.u.put(b,a),a}}return cO.encode(B7(32))}async authenticate(){if(!this.api)throw new cT.a("Auth flow has no API instance");try{return await this.api.post(fD,{guest_credential:this.meta.guestCredential})}catch(a){throw(0,cT.f)(a)}}async link(){throw Error("Linking is not supported for the guest flow")}constructor(a){this.meta={guestCredential:this.getOrCreateGuestCredential(a)}}}function DO(){return!(eI.isSafari&&window.location.origin.startsWith("http://localhost"))}var DP,DQ,DR,DS,DT,DU,DV,DW,DX,DY,DZ,D$,D_,D0,D1,D2,D3,D4,D5,D6,D7,D8,D9,Ea,Eb,Ec,Ed,Ee,Ef,Eg,Eh,Ei,Ej,Ek,El,Em,En,Eo,Ep,Eq,Er,Es,Et,Eu,Ev,Ew,Ex=((Ew={}).PRIVY="privy_access_token",Ew.CUSTOMER="customer_access_token",Ew);class Ey{get token(){return this.privyAccessToken||this.customerAccessToken}getToken(a){return"privy_access_token"===a?this.privyAccessToken:this.customerAccessToken}get customerAccessToken(){return this._getToken(eH.C)}get privyAccessToken(){return this._getToken(eH.P)}_getToken(a){try{let b=cU.u.get(a);return"string"==typeof b?BQ.throwIfNotWellFormedJwt(b):null}catch(a){return console.error(a),this.destroyLocalState(),null}}get refreshToken(){try{let a=cU.u.get(eH.R);return"string"==typeof a?a:null}catch(a){return console.error(a),this.destroyLocalState(),null}}getProviderAccessToken(a){try{let b=cU.u.get((0,eH.e)(a));if("string"!=typeof b)return null;{let c=new BQ(b);return c.isExpired()?(cU.u.del((0,eH.e)(a)),null):c.value}}catch(a){return console.error(a),null}}get mightHaveServerCookies(){try{let a=v3.default.get(eH.f);return void 0!==a&&a.length>0}catch(a){console.error(a)}return!1}hasRefreshCredentials(a="privy_access_token"){let b="string"==typeof this.getToken(a),c="string"==typeof this.refreshToken&&this.refreshToken!==eH.h;return this.mightHaveServerCookies||b&&c}hasActiveAccessToken(a){let b=BQ.parse(this.getToken(a));return null!==b&&!b.isExpired(30)}authenticate(a){return this.authenticateOnce.execute(a)}link(a){return this.linkOnce.execute(a)}refresh(){return this.refreshOnce.execute()}destroy(){return this.destroyOnce.execute()}storeProviderAccessToken(a,b){"string"==typeof b?cU.u.put((0,eH.e)(a),b):cU.u.del((0,eH.e)(a))}updateIdentityToken(a){"string"==typeof a?this.storeIdentityToken(a):this.clearIdentityToken()}async _authenticate(a){try{let b=await a.authenticate(),{user:c,is_new_user:d,oauth_tokens:e}=b;this.handleTokenResponse(b);let f=e?{provider:e.provider,accessToken:e.access_token,accessTokenExpiresInSeconds:e.access_token_expires_in_seconds,refreshToken:e.refresh_token,refreshTokenExpiresInSeconds:e.refresh_token_expires_in_seconds,scopes:e.scopes}:void 0;return this._trackAuthenticateEvents(a,d),{user:(0,cP.l)(c),isNewUser:d,oAuthTokens:f}}catch(a){throw console.warn("Error authenticating session"),(0,cT.i)(a)}}_trackAuthenticateEvents(a,b){let c=a instanceof B1?"email":a instanceof Ch?"sms":a instanceof Cf?"siwe":a instanceof DN?"guest":a instanceof Du?"custom_auth":a instanceof Cb?a.meta.provider:null;c&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate",payload:{method:c,isNewUser:b}}),"siwe"===c&&this.client&&this.client.createAnalyticsEvent({eventName:"sdk_authenticate_siwe",payload:{connectorType:a.meta.connectorType,walletClientType:a.meta.walletClientType}})}async _link(a){try{let b=await a.link(),c=b.oauth_tokens,d=c?{provider:c.provider,accessToken:c.access_token,accessTokenExpiresInSeconds:c.access_token_expires_in_seconds,refreshToken:c.refresh_token,refreshTokenExpiresInSeconds:c.refresh_token_expires_in_seconds,scopes:c.scopes}:void 0;return{user:(0,cP.l)(b),oAuthTokens:d}}catch(a){throw console.warn("Error linking account"),(0,cT.i)(a)}}async _refresh(){if(!this.api)throw new cT.a("Session has no API instance");if(!this.client)throw new cT.a("Session has no PrivyClient instance");await this.client.getAccessToken({disableAutoRefresh:!0});let a=this.token,b=this.refreshToken;if(this.client.useServerCookies&&!this.mightHaveServerCookies&&this.token&&window.location.origin===this.client.apiUrl)return this.destroyLocalState(),null;try{let c;if(!(a&&b||this.mightHaveServerCookies))return null;{let d={};a&&(d.authorization=`Bearer ${a}`),c=await this.api.post(eP,b?{refresh_token:b}:{},{headers:d})}return this.handleTokenResponse(c),(0,cP.l)(c.user)}catch(a){if(a instanceof cT.e&&a.privyErrorCode===cT.b.MISSING_OR_INVALID_TOKEN)return console.warn("Unable to refresh tokens - token is missing or no longer valid"),this.destroyLocalState(),null;throw(0,cT.i)(a)}}handleTokenResponse(a){a.session_update_action&&"set"!==a.session_update_action?"clear"===a.session_update_action?this.destroyLocalState():"ignore"===a.session_update_action&&(a.token&&(this.storeCustomerAccessToken(a.token),this.storePrivyAccessToken(a.privy_access_token)),a.identity_token&&this.storeIdentityToken(a.identity_token)):this._storeAllTokens(a)}_storeAllTokens(a){this.storeRefreshToken(a.refresh_token),this.storeCustomerAccessToken(a.token),this.storePrivyAccessToken(a.privy_access_token),a.identity_token&&this.storeIdentityToken(a.identity_token)}async _destroy(){try{await this.api?.post(eQ,{refresh_token:this.refreshToken})}catch(a){console.warn("Error destroying session")}this.destroyLocalState()}destroyLocalState(){this.storeRefreshToken(null),this.storeCustomerAccessToken(null),this.storePrivyAccessToken(null),this.clearIdentityToken()}storeCustomerAccessToken(a){if("string"==typeof a){let b=cU.u.get(eH.C);if(cU.u.put(eH.C,a),!this.client?.useServerCookies){let b=BQ.parse(a)?.expiration;v3.default.set(eH.i,a,{sameSite:"Strict",secure:DO(),expires:b?new Date(1e3*b):void 0})}b!==a&&this.client?.onStoreCustomerAccessToken?.(a)}else cU.u.del(eH.C),v3.default.remove(eH.i),this.client?.onDeleteCustomerAccessToken?.()}storeRefreshToken(a){"string"==typeof a?(cU.u.put(eH.R,a),this.client?.useServerCookies||v3.default.set(eH.f,"t",{sameSite:"Strict",secure:DO(),expires:30})):(cU.u.del(eH.R),v3.default.remove(eH.j),v3.default.remove(eH.f))}storePrivyAccessToken(a){"string"==typeof a?cU.u.put(eH.P,a):cU.u.del(eH.P)}storeIdentityToken(a){if(DK.setState({identityToken:a}),this.client?.useServerCookies)return;cU.u.put(eH.I,a);let b=BQ.parse(a)?.expiration;v3.default.set(eH.k,a,{sameSite:"Strict",secure:DO(),expires:b?new Date(1e3*b):void 0})}clearIdentityToken(){cU.u.del(eH.I),DK.setState({identityToken:null}),v3.default.remove(eH.k)}constructor(){this.authenticateOnce=new B3(async a=>this._authenticate(a)),this.linkOnce=new B3(async a=>this._link(a)),this.refreshOnce=new B3(this._refresh.bind(this)),this.destroyOnce=new B3(this._destroy.bind(this))}}var Ez=0,EA="__private_"+Ez+++"__getOrGenerateClientAnalyticsId";class EB{getAppId(){return this.appId}initializeConnectorManager({walletConnectCloudProjectId:a,rpcConfig:b,chains:c,defaultChain:d,store:e,walletList:f,shouldEnforceDefaultChainOnConnect:g,externalWalletConfig:h,appName:i,walletChainType:j,setBaseAccountSdk:k}){this.connectors||(this.connectors=new DJ(this.appId,a,b,c,d,e,f,g,h,i,k,j))}generateApi(){let a=new DM({appId:this.appId,appClientId:this.appClientId,client:this,defaults:{baseURL:this.apiUrl,timeout:this.timeout}});return this.session.api=a,a}updateApiUrl(a){this.apiUrl=a||this.fallbackApiUrl,this.api=this.generateApi(),a&&(this.useServerCookies=!0)}authenticate(){if(!this.authFlow)throw new cT.a("No auth flow in progress.");return this.session.authenticate(this.authFlow)}async link(){if(!this.authFlow)throw new cT.a("No auth flow in progress.");let{oAuthTokens:a}=await this.session.link(this.authFlow);return{user:await this.getAuthenticatedUser(),oAuthTokens:a}}storeProviderAccessToken(a,b){this.session.storeProviderAccessToken(a,b)}getProviderAccessToken(a){return this.session.getProviderAccessToken(a)}async logout(){await this.session.destroy(),this.authFlow=void 0}clearProviderAcccessTokens(a){a.linkedAccounts.filter(a=>"cross_app"===a.type).forEach(a=>{this.storeProviderAccessToken(a.providerApp.id,null)})}startAuthFlow(a){return a.api=this.api,this.authFlow=a,this.authFlow}async initMfaSmsVerification(){try{await this.api.post(fx,{action:"verify"})}catch(a){throw(0,cT.f)(a)}}async initMfaPasskeyVerification(){try{let a,b=await this.api.post(fy,{});return{rpId:(a=b.options).rp_id,challenge:a.challenge,allowCredentials:a.allow_credentials?.map(a=>({id:a.id,type:a.type,transports:a.transports}))||[],timeout:a.timeout,extensions:{appid:a.extensions?.app_id,credProps:a.extensions?.cred_props,hmacCreateSecret:a.extensions?.hmac_create_secret},userVerification:a.user_verification}}catch(a){throw(0,cT.f)(a)}}async getCrossAppProviderDetails(a){try{return this._cachedProviderAppDetails[a]||(this._cachedProviderAppDetails[a]=await this.api.get(`/api/v1/apps/${a}/cross-app/details`)),this._cachedProviderAppDetails[a]}catch(a){console.error("Error fetching cross app provider details",a)}}async acceptTerms(){try{let a=await this.api.post(fz,{});return(0,cP.l)(a)}catch(a){throw(0,cT.i)(a)}}async unlinkEmail(a){try{let b=await this.api.post(e9,{address:a});return await this.getAuthenticatedUser()??(0,cP.l)(b)}catch(a){throw(0,cT.i)(a)}}async unlinkPhone(a){try{let b=await this.api.post(fe,{phoneNumber:a});return await this.getAuthenticatedUser()??(0,cP.l)(b)}catch(a){throw(0,cT.i)(a)}}async unlinkEthereumWallet(a){try{let b=await this.api.post(eV,{address:a});return await this.getAuthenticatedUser()??(0,cP.l)(b)}catch(a){throw(0,cT.i)(a)}}async unlinkSolanaWallet(a){try{let b=await this.api.post(e$,{address:a});return await this.getAuthenticatedUser()??(0,cP.l)(b)}catch(a){throw(0,cT.i)(a)}}async unlinkOAuth(a,b){try{let c=await this.api.post(fl,{provider:a,subject:b});return await this.getAuthenticatedUser()??(0,cP.l)(c)}catch(a){throw(0,cT.i)(a)}}async unlinkFarcaster(a){try{let b=await this.api.post(e4,{fid:a});return await this.getAuthenticatedUser()??(0,cP.l)(b)}catch(a){throw(0,cT.i)(a)}}async unlinkTelegram(a){try{let b=await this.api.post(fv,{telegram_user_id:a});return await this.getAuthenticatedUser()??(0,cP.l)(b)}catch(a){throw(0,cT.i)(a)}}async revokeDelegatedWallet(){try{await this.api.post(fH,{})}catch(a){throw(0,cT.i)(a)}}async createAnalyticsEvent({eventName:a,payload:b,timestamp:c,options:d}){}async signMoonpayOnRampUrl(a){try{return this.api.post(fE,a)}catch(a){throw(0,cT.i)(a)}}async initCoinbaseOnRamp(a){try{return this.api.post(fF,a)}catch(a){throw(0,cT.i)(a)}}async getCoinbaseOnRampStatus({partnerUserId:a}){try{return this.api.get(`${fG}?partnerUserId=${a}`)}catch(a){throw(0,cT.i)(a)}}async getAuthenticatedUser(){return this.session.hasRefreshCredentials()?this.session.refresh():null}async getAccessToken(a){return await this.getPrivyAccessToken(a)||await this.getCustomerAccessToken(a)}async getCustomerAccessToken(a){return await this._getToken(Ex.CUSTOMER,a)}async getPrivyAccessToken(a){return await this._getToken(Ex.PRIVY,a)}async _getToken(a,b){return this.session.getToken(a)?this.session.hasActiveAccessToken(a)?this.session.hasRefreshCredentials(a)?BR.parse(this.session.getToken(a))?.appId!==this.appId?(await this.logout(),null):this.session.getToken(a):(this.session.destroyLocalState(),null):!b?.disableAutoRefresh&&this.session.hasRefreshCredentials(a)?(await this.session.refresh(),this.session.getToken(a)):null:null}async getUsdTokenPrice(a){try{return(await this.api.get(`/api/v1/token_price?chainId=${a.id}&tokenSymbol=${a.nativeCurrency.symbol}`)).usd}catch(b){return void console.error(`Unable to fetch token price for chain with id ${a.id}`)}}async getUsdPriceForSol(){try{return(await this.api.get("/api/v1/token_price?chainId=0&tokenSymbol=SOL")).usd}catch(a){return void console.error("Unable to fetch token price for SOL")}}async getSplTokenMetadata({mintAddress:a,cluster:b}){try{return await this.api.get(`/api/v1/spl_token_info?mint_address=${a}&cluster=${b}`)}catch(c){return void console.error(`Unable to fetch token metadata for ${b}:${a}`)}}async requestFarcasterSignerStatus(a){try{return await this.api.post("/api/v1/farcaster/signer/status",{ed25519_public_key:a})}catch(a){throw console.error("Unable to fetch Farcaster signer status"),a}}async generateSiweNonce({address:a,captchaToken:b}){try{return(await this.api.post(eR,{address:a,token:b})).nonce}catch(a){throw(0,cT.i)(a)}}async authenticateWithSiweInternal({message:a,signature:b,chainId:c,walletClientType:d,connectorType:e,mode:f}){return await this.api.post(eS,{message:a,signature:b,chainId:c,walletClientType:d,connectorType:e,mode:f})}async linkWithSiweInternal({message:a,signature:b,chainId:c,walletClientType:d,connectorType:e}){return await this.api.post(eT,{message:a,signature:b,chainId:c,walletClientType:d,connectorType:e})}async linkSmartWallet({message:a,signature:b,smartWalletType:c,smartWalletVersion:d}){try{let e=await this.api.post(eU,{message:a,signature:b,smart_wallet_type:c,smart_wallet_version:d});return(0,cP.l)(e)}catch(a){throw(0,cT.i)(a)}}async linkWithSiwe({message:a,signature:b,chainId:c,walletClientType:d,connectorType:e}){try{let f=await this.linkWithSiweInternal({message:a,signature:b,chainId:c,walletClientType:d,connectorType:e});return(0,cP.l)(f)}catch(a){throw(0,cT.i)(a)}}async generateSiwsNonce({address:a,captchaToken:b}){try{return(await this.api.post(eX,{address:a,token:b})).nonce}catch(a){throw(0,cT.i)(a)}}async authenticateWithSiwsInternal({message:a,signature:b,walletClientType:c,connectorType:d,mode:e,messageType:f="plain"}){return await this.api.post(eY,{message:a,signature:b,walletClientType:c,connectorType:d,mode:e,message_type:f})}async authenticateWithSiws({message:a,signature:b,walletClientType:c,connectorType:d,mode:e,messageType:f="plain"}){let g=await this.authenticateWithSiwsInternal({message:a,signature:b,walletClientType:c,connectorType:d,mode:e,messageType:f});this.session.handleTokenResponse(g);let h=(0,cP.l)(g.user);if(!h)throw Error("Authentication failed - no user returned");return{user:h,isNewUser:g.is_new_user||!1}}async sendAccountTransferRequest({nonce:a,account:b,accountType:c,externalWalletMetadata:d,telegramAuthResult:e,telegramWebAppData:f,farcasterEmbeddedAddress:g,oAuthUserInfo:h}){try{let i,j;switch(c){case"email":i=fb,j={nonce:a,email:b};break;case"sms":i=fh,j={nonce:a,phoneNumber:b};break;case"siwe":if(i=eW,!d)throw Error("Wallet parameters must be defined");j={nonce:a,address:b,...d};break;case"farcaster":i=e5,j={nonce:a,farcaster_id:b,farcaster_embedded_address:g};break;case"telegram":i=fw,j={nonce:a,telegram_auth_result:e,telegram_web_app_data:f};break;case"siws":i=e_,j={nonce:a,address:b,...d};break;case"custom":case"guest":case"passkey":throw Error("Invalid transfer account type");default:i=fm,j={nonce:a,userInfo:h}}let k=await this.api.post(i,j);return await this.getAuthenticatedUser()??(0,cP.l)(k)}catch(a){throw(0,cT.i)(a)}}async linkWithSiwsInternal({message:a,signature:b,walletClientType:c,connectorType:d,messageType:e="plain"}){return await this.api.post(eZ,{message:a,signature:b,walletClientType:c,connectorType:d,message_type:e})}async linkWithSiws({message:a,signature:b,walletClientType:c,connectorType:d,messageType:e="plain"}){try{let f=await this.linkWithSiwsInternal({message:a,signature:b,walletClientType:c,connectorType:d,messageType:e});return(0,cP.l)(f)}catch(a){throw(0,cT.i)(a)}}async updateUserAndIdToken(){try{let a=await this.api.get(fI);return this.session.updateIdentityToken(a.identity_token),(0,cP.l)(a.user)}catch(a){throw(0,cT.i)(a)}}async scanTransaction(a){try{return await this.api.post(fJ,a)}catch(a){throw(0,cT.i)(a)}}constructor({apiUrl:a=eH.D,appId:b,appClientId:c,timeout:d=eH.l}){Object.defineProperty(this,EA,{value:EC}),this._cachedProviderAppDetails={},this.apiUrl=a,this.fallbackApiUrl=this.apiUrl,this.useServerCookies=a!==eH.D&&a.startsWith("https://privy."),this.timeout=d,this.appId=b,this.appClientId=c,this.clientAnalyticsId=(function(a,b){if(!Object.prototype.hasOwnProperty.call(a,b))throw TypeError("attempted to use private field on non-instance");return a})(this,EA)[EA](),o||(o=new Ey),this.session=o,this.api=this.generateApi(),this.session.client=this}}function EC(){return null}function ED(){if(!p)throw new cT.a("No global PrivyClient instance found. Please ensure you have initialized the PrivyProvider.");return p}let EE=({config:a,...b})=>{(()=>{if((0,S.useContext)(Dx))throw new cT.a("Multiple PrivyProvider instances found","Found multiple instances of PrivyProvider, ensure there is only one mounted in your application tree.")})(),function(a){if("string"!=typeof a||25!==a.length)throw new cT.a("Cannot initialize the Privy provider with an invalid Privy app ID")}(b.appId),p||(p=new EB({appId:b.appId,appClientId:b.clientId,apiUrl:b.apiUrl}));let c=(0,S.useMemo)(()=>new T.default({appId:b.appId,clientId:b.clientId,storage:cU.u,baseUrl:b.apiUrl,sdkVersion:"react-auth:3.10.0"}),[]),d=ED(),e=Object.assign({},a);return(0,R.jsx)(eH.m,{client:c,legacyClient:d,appClientId:b.clientId,clientConfig:e,children:(0,R.jsx)(fK.P,{children:(0,R.jsx)(Dy,{...b,client:d,privy:c})})})};function EF(){let{promptMfa:a,init:b,submit:c,cancel:d,mfaMethods:e}=(0,S.useContext)(cP.P);return{promptMfa:a,init:b,submit:c,cancel:d,mfaMethods:e}}function EG(){let{initEnrollmentWithSms:a,initEnrollmentWithTotp:b,initEnrollmentWithPasskey:c,submitEnrollmentWithSms:d,submitEnrollmentWithTotp:e,submitEnrollmentWithPasskey:f,unenroll:g,enrollInMfa:h}=(0,S.useContext)(cP.P);return{initEnrollmentWithSms:a,initEnrollmentWithTotp:b,initEnrollmentWithPasskey:c,submitEnrollmentWithSms:d,submitEnrollmentWithTotp:e,submitEnrollmentWithPasskey:f,unenrollWithSms:()=>g("sms"),unenrollWithTotp:()=>g("totp"),unenrollWithPasskey:a=>g("passkey",a),showMfaEnrollmentModal:()=>h(!0),closeMfaEnrollmentModal:()=>h(!1)}}a.s(["A",()=>BT,"B",()=>DB,"C",()=>Ck,"D",()=>BU,"E",()=>Df,"F",()=>DC,"G",()=>BS,"H",()=>EE,"P",()=>CR,"R",()=>B3,"S",()=>Cg,"W",()=>CP,"a",()=>Cm,"b",()=>Cf,"c",()=>Dg,"d",()=>EG,"e",()=>CT,"f",()=>CY,"g",()=>CW,"h",()=>CV,"i",()=>CZ,"j",()=>CX,"k",()=>Dp,"l",()=>Cc,"m",()=>Co,"n",()=>CU,"o",()=>B8,"p",()=>Dr,"q",()=>B9,"r",()=>Ca,"s",()=>Dn,"t",()=>Dm,"u",()=>EF,"v",()=>De,"w",()=>Dk,"x",()=>Dh,"y",()=>BY,"z",()=>Dj],293326)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fa13a340._.js.map